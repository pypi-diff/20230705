# Comparing `tmp/soapcw-0.1.7.tar.gz` & `tmp/soapcw-0.1.8.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "soapcw-0.1.7.tar", last modified: Tue Jul  4 07:46:36 2023, max compression
+gzip compressed data, was "soapcw-0.1.8.tar", last modified: Wed Jul  5 17:11:50 2023, max compression
```

## Comparing `soapcw-0.1.7.tar` & `soapcw-0.1.8.tar`

### file list

```diff
@@ -1,90 +1,91 @@
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-04 07:46:36.415026 soapcw-0.1.7/
--rw-rw-rw-   0 root         (0) root         (0)      166 2023-07-04 07:44:35.000000 soapcw-0.1.7/AUTHORS.rst
--rw-rw-rw-   0 root         (0) root         (0)     3508 2023-07-04 07:44:35.000000 soapcw-0.1.7/CONTRIBUTING.rst
--rw-rw-rw-   0 root         (0) root         (0)       89 2023-07-04 07:44:35.000000 soapcw-0.1.7/HISTORY.rst
--rw-rw-rw-   0 root         (0) root         (0)     1072 2023-07-04 07:44:35.000000 soapcw-0.1.7/LICENSE
--rw-rw-rw-   0 root         (0) root         (0)      361 2023-07-04 07:44:35.000000 soapcw-0.1.7/MANIFEST.in
--rw-r--r--   0 root         (0) root         (0)     2394 2023-07-04 07:46:36.415026 soapcw-0.1.7/PKG-INFO
--rw-rw-rw-   0 root         (0) root         (0)     1389 2023-07-04 07:44:35.000000 soapcw-0.1.7/README.rst
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-04 07:46:36.408026 soapcw-0.1.7/docs/
--rw-rw-rw-   0 root         (0) root         (0)      605 2023-07-04 07:44:35.000000 soapcw-0.1.7/docs/Makefile
--rw-rw-rw-   0 root         (0) root         (0)       28 2023-07-04 07:44:35.000000 soapcw-0.1.7/docs/authors.rst
--rwxrwxrwx   0 root         (0) root         (0)     4930 2023-07-04 07:44:35.000000 soapcw-0.1.7/docs/conf.py
--rw-rw-rw-   0 root         (0) root         (0)       33 2023-07-04 07:44:35.000000 soapcw-0.1.7/docs/contributing.rst
--rw-rw-rw-   0 root         (0) root         (0)       28 2023-07-04 07:44:35.000000 soapcw-0.1.7/docs/history.rst
--rw-rw-rw-   0 root         (0) root         (0)     1193 2023-07-04 07:44:35.000000 soapcw-0.1.7/docs/index.rst
--rw-rw-rw-   0 root         (0) root         (0)     1062 2023-07-04 07:44:35.000000 soapcw-0.1.7/docs/installation.rst
--rw-rw-rw-   0 root         (0) root         (0)      766 2023-07-04 07:44:35.000000 soapcw-0.1.7/docs/make.bat
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-04 07:46:36.408026 soapcw-0.1.7/docs/pipeline_usage/
--rw-rw-rw-   0 root         (0) root         (0)      166 2023-07-04 07:44:35.000000 soapcw-0.1.7/docs/pipeline_usage/index.rst
--rw-rw-rw-   0 root         (0) root         (0)     6317 2023-07-04 07:44:35.000000 soapcw-0.1.7/docs/pipeline_usage/run_pipeline.rst
--rw-rw-rw-   0 root         (0) root         (0)       27 2023-07-04 07:44:35.000000 soapcw-0.1.7/docs/readme.rst
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-04 07:46:36.408026 soapcw-0.1.7/docs/usage/
--rw-rw-rw-   0 root         (0) root         (0)      280 2023-07-04 07:44:35.000000 soapcw-0.1.7/docs/usage/index.rst
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-04 07:46:36.409026 soapcw-0.1.7/pipeline/
--rw-rw-rw-   0 root         (0) root         (0)        0 2023-07-04 07:44:35.000000 soapcw-0.1.7/pipeline/__init__.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-04 07:46:36.409026 soapcw-0.1.7/pipeline/css/
--rw-rw-rw-   0 root         (0) root         (0)     3163 2023-07-04 07:44:35.000000 soapcw-0.1.7/pipeline/css/general.css
--rwxrwxrwx   0 root         (0) root         (0)     7001 2023-07-04 07:44:35.000000 soapcw-0.1.7/pipeline/make_dag_files_astro.py
--rwxrwxrwx   0 root         (0) root         (0)     6963 2023-07-04 07:44:35.000000 soapcw-0.1.7/pipeline/make_dag_files_lines.py
--rw-rw-rw-   0 root         (0) root         (0)    38283 2023-07-04 07:44:35.000000 soapcw-0.1.7/pipeline/make_html_page.py
--rwxrwxrwx   0 root         (0) root         (0)    37055 2023-07-04 07:44:35.000000 soapcw-0.1.7/pipeline/run_full_soap_astro.py
--rwxrwxrwx   0 root         (0) root         (0)    40172 2023-07-04 07:44:35.000000 soapcw-0.1.7/pipeline/run_full_soap_lines.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-04 07:46:36.409026 soapcw-0.1.7/pipeline/scripts/
--rw-rw-rw-   0 root         (0) root         (0)    18806 2023-07-04 07:44:35.000000 soapcw-0.1.7/pipeline/scripts/table_scripts.js
--rw-rw-rw-   0 root         (0) root         (0)     3367 2023-07-04 07:44:35.000000 soapcw-0.1.7/pipeline/soap_config_parser.py
--rw-rw-rw-   0 root         (0) root         (0)      984 2023-07-04 07:46:36.416026 soapcw-0.1.7/setup.cfg
--rw-rw-rw-   0 root         (0) root         (0)     4209 2023-07-04 07:44:35.000000 soapcw-0.1.7/setup.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-04 07:46:36.411026 soapcw-0.1.7/soapcw/
--rw-rw-rw-   0 root         (0) root         (0)      589 2023-07-04 07:44:35.000000 soapcw-0.1.7/soapcw/__init__.py
--rw-rw-rw-   0 root         (0) root         (0)      406 2023-07-04 07:44:35.000000 soapcw-0.1.7/soapcw/cli.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-04 07:46:36.412026 soapcw-0.1.7/soapcw/cnn/
--rw-rw-rw-   0 root         (0) root         (0)       26 2023-07-04 07:44:35.000000 soapcw-0.1.7/soapcw/cnn/__init__.py
--rw-rw-rw-   0 root         (0) root         (0)     4682 2023-07-04 07:44:35.000000 soapcw-0.1.7/soapcw/cnn/cnn_data_dag_gen.py
--rwxrwxrwx   0 root         (0) root         (0)    17946 2023-07-04 07:44:35.000000 soapcw-0.1.7/soapcw/cnn/cnn_data_gen.py
--rw-rw-rw-   0 root         (0) root         (0)    12490 2023-07-04 07:44:35.000000 soapcw-0.1.7/soapcw/cnn/generate_gaussian_train_data.py
--rw-rw-rw-   0 root         (0) root         (0)    11006 2023-07-04 07:44:35.000000 soapcw-0.1.7/soapcw/cnn/generate_test_data.py
--rw-rw-rw-   0 root         (0) root         (0)    20005 2023-07-04 07:44:35.000000 soapcw-0.1.7/soapcw/cnn/generate_train_data.py
--rwxrwxrwx   0 root         (0) root         (0)     5822 2023-07-04 07:44:35.000000 soapcw-0.1.7/soapcw/cnn/narrowband_sfts.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-04 07:46:36.413026 soapcw-0.1.7/soapcw/cnn/pytorch/
--rw-rw-rw-   0 root         (0) root         (0)       43 2023-07-04 07:44:35.000000 soapcw-0.1.7/soapcw/cnn/pytorch/__init__.py
--rw-rw-rw-   0 root         (0) root         (0)     3019 2023-07-04 07:44:35.000000 soapcw-0.1.7/soapcw/cnn/pytorch/load_models.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-04 07:46:36.413026 soapcw-0.1.7/soapcw/cnn/pytorch/models/
--rw-rw-rw-   0 root         (0) root         (0)       45 2023-07-04 07:44:35.000000 soapcw-0.1.7/soapcw/cnn/pytorch/models/__init__.py
--rw-rw-rw-   0 root         (0) root         (0)     6596 2023-07-04 07:44:35.000000 soapcw-0.1.7/soapcw/cnn/pytorch/models/cnn.py
--rw-rw-rw-   0 root         (0) root         (0)     9628 2023-07-04 07:44:35.000000 soapcw-0.1.7/soapcw/cnn/pytorch/models/combined_cnn.py
--rw-rw-rw-   0 root         (0) root         (0)    11582 2023-07-04 07:44:35.000000 soapcw-0.1.7/soapcw/cnn/train_model.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-04 07:46:36.414026 soapcw-0.1.7/soapcw/cw/
--rw-rw-rw-   0 root         (0) root         (0)      197 2023-07-04 07:44:35.000000 soapcw-0.1.7/soapcw/cw/__init__.py
--rw-rw-rw-   0 root         (0) root         (0)    42241 2023-07-04 07:44:35.000000 soapcw-0.1.7/soapcw/cw/generate_data.py
--rw-rw-rw-   0 root         (0) root         (0)    19576 2023-07-04 07:44:35.000000 soapcw-0.1.7/soapcw/cw/load_sfts.py
--rw-rw-rw-   0 root         (0) root         (0)     8660 2023-07-04 07:44:35.000000 soapcw-0.1.7/soapcw/cw/make_sfts.py
--rw-rw-rw-   0 root         (0) root         (0)     9450 2023-07-04 07:44:35.000000 soapcw-0.1.7/soapcw/cw/sft.py
--rw-rw-rw-   0 root         (0) root         (0)     8567 2023-07-04 07:44:35.000000 soapcw-0.1.7/soapcw/cw/timeseries.py
--rw-rw-rw-   0 root         (0) root         (0)     1687 2023-07-04 07:44:35.000000 soapcw-0.1.7/soapcw/cw/tools.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-04 07:46:36.414026 soapcw-0.1.7/soapcw/line_aware_stat/
--rw-rw-rw-   0 root         (0) root         (0)      123 2023-07-04 07:44:35.000000 soapcw-0.1.7/soapcw/line_aware_stat/__init__.py
--rw-rw-rw-   0 root         (0) root         (0)    11721 2023-07-04 07:44:35.000000 soapcw-0.1.7/soapcw/line_aware_stat/gen_lookup.pyx
--rw-rw-rw-   0 root         (0) root         (0)    38004 2023-07-04 07:44:35.000000 soapcw-0.1.7/soapcw/line_aware_stat/gen_lookup_python.py
--rwxrwxrwx   0 root         (0) root         (0)     6514 2023-07-04 07:44:35.000000 soapcw-0.1.7/soapcw/line_aware_stat/save_lookup.py
--rw-rw-rw-   0 root         (0) root         (0)     4047 2023-07-04 07:44:35.000000 soapcw-0.1.7/soapcw/soap_config_parser.py
--rw-r--r--   0 root         (0) root         (0)  2250446 2023-07-04 07:46:35.000000 soapcw-0.1.7/soapcw/soapcw.c
--rw-rw-rw-   0 root         (0) root         (0)    63288 2023-07-04 07:44:35.000000 soapcw-0.1.7/soapcw/soapcw.pyx
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-04 07:46:36.414026 soapcw-0.1.7/soapcw/tools/
--rw-rw-rw-   0 root         (0) root         (0)        0 2023-07-04 07:44:35.000000 soapcw-0.1.7/soapcw/tools/__init__.py
--rw-rw-rw-   0 root         (0) root         (0)     2885 2023-07-04 07:44:35.000000 soapcw-0.1.7/soapcw/tools/plots.py
--rw-rw-rw-   0 root         (0) root         (0)     9044 2023-07-04 07:44:35.000000 soapcw-0.1.7/soapcw/tools/tools.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-04 07:46:36.412026 soapcw-0.1.7/soapcw.egg-info/
--rw-r--r--   0 root         (0) root         (0)     2394 2023-07-04 07:46:36.000000 soapcw-0.1.7/soapcw.egg-info/PKG-INFO
--rw-r--r--   0 root         (0) root         (0)     1822 2023-07-04 07:46:36.000000 soapcw-0.1.7/soapcw.egg-info/SOURCES.txt
--rw-r--r--   0 root         (0) root         (0)        1 2023-07-04 07:46:36.000000 soapcw-0.1.7/soapcw.egg-info/dependency_links.txt
--rw-r--r--   0 root         (0) root         (0)      484 2023-07-04 07:46:36.000000 soapcw-0.1.7/soapcw.egg-info/entry_points.txt
--rw-r--r--   0 root         (0) root         (0)        1 2023-07-04 07:46:36.000000 soapcw-0.1.7/soapcw.egg-info/not-zip-safe
--rw-r--r--   0 root         (0) root         (0)       65 2023-07-04 07:46:36.000000 soapcw-0.1.7/soapcw.egg-info/requires.txt
--rw-r--r--   0 root         (0) root         (0)       22 2023-07-04 07:46:36.000000 soapcw-0.1.7/soapcw.egg-info/top_level.txt
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-04 07:46:36.415026 soapcw-0.1.7/tests/
--rw-rw-rw-   0 root         (0) root         (0)   445283 2023-07-04 07:44:35.000000 soapcw-0.1.7/tests/SNR_injections.ipynb
--rw-rw-rw-   0 root         (0) root         (0)       59 2023-07-04 07:44:35.000000 soapcw-0.1.7/tests/__init__.py
--rw-rw-rw-   0 root         (0) root         (0)     1130 2023-07-04 07:44:35.000000 soapcw-0.1.7/tests/test_cwload.py
--rw-rw-rw-   0 root         (0) root         (0)     3602 2023-07-04 07:44:35.000000 soapcw-0.1.7/tests/test_line_aware_stat.py
--rw-rw-rw-   0 root         (0) root         (0)     4290 2023-07-04 07:44:35.000000 soapcw-0.1.7/tests/test_soap.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-05 17:11:50.229467 soapcw-0.1.8/
+-rw-rw-rw-   0 root         (0) root         (0)      166 2023-07-05 17:01:34.000000 soapcw-0.1.8/AUTHORS.rst
+-rw-rw-rw-   0 root         (0) root         (0)     3508 2023-07-05 17:01:34.000000 soapcw-0.1.8/CONTRIBUTING.rst
+-rw-rw-rw-   0 root         (0) root         (0)      153 2023-07-05 17:01:34.000000 soapcw-0.1.8/HISTORY.rst
+-rw-rw-rw-   0 root         (0) root         (0)     1072 2023-07-05 17:01:34.000000 soapcw-0.1.8/LICENSE
+-rw-rw-rw-   0 root         (0) root         (0)      361 2023-07-05 17:01:34.000000 soapcw-0.1.8/MANIFEST.in
+-rw-r--r--   0 root         (0) root         (0)     2446 2023-07-05 17:11:50.229467 soapcw-0.1.8/PKG-INFO
+-rw-rw-rw-   0 root         (0) root         (0)     1377 2023-07-05 17:01:34.000000 soapcw-0.1.8/README.rst
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-05 17:11:50.217466 soapcw-0.1.8/docs/
+-rw-rw-rw-   0 root         (0) root         (0)      605 2023-07-05 17:01:34.000000 soapcw-0.1.8/docs/Makefile
+-rw-rw-rw-   0 root         (0) root         (0)       28 2023-07-05 17:01:34.000000 soapcw-0.1.8/docs/authors.rst
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-05 17:11:50.218466 soapcw-0.1.8/docs/cnn_usage/
+-rw-rw-rw-   0 root         (0) root         (0)     5902 2023-07-05 17:01:34.000000 soapcw-0.1.8/docs/cnn_usage/data_generation.rst
+-rw-rw-rw-   0 root         (0) root         (0)      243 2023-07-05 17:01:34.000000 soapcw-0.1.8/docs/cnn_usage/index.rst
+-rw-rw-rw-   0 root         (0) root         (0)     5625 2023-07-05 17:01:34.000000 soapcw-0.1.8/docs/cnn_usage/train_model.rst
+-rwxrwxrwx   0 root         (0) root         (0)     4930 2023-07-05 17:01:34.000000 soapcw-0.1.8/docs/conf.py
+-rw-rw-rw-   0 root         (0) root         (0)       33 2023-07-05 17:01:34.000000 soapcw-0.1.8/docs/contributing.rst
+-rw-rw-rw-   0 root         (0) root         (0)       28 2023-07-05 17:01:34.000000 soapcw-0.1.8/docs/history.rst
+-rw-rw-rw-   0 root         (0) root         (0)     1213 2023-07-05 17:01:34.000000 soapcw-0.1.8/docs/index.rst
+-rw-rw-rw-   0 root         (0) root         (0)     1062 2023-07-05 17:01:34.000000 soapcw-0.1.8/docs/installation.rst
+-rw-rw-rw-   0 root         (0) root         (0)      766 2023-07-05 17:01:34.000000 soapcw-0.1.8/docs/make.bat
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-05 17:11:50.218466 soapcw-0.1.8/docs/pipeline_usage/
+-rw-rw-rw-   0 root         (0) root         (0)      166 2023-07-05 17:01:34.000000 soapcw-0.1.8/docs/pipeline_usage/index.rst
+-rw-rw-rw-   0 root         (0) root         (0)     6633 2023-07-05 17:01:34.000000 soapcw-0.1.8/docs/pipeline_usage/run_pipeline.rst
+-rw-rw-rw-   0 root         (0) root         (0)       27 2023-07-05 17:01:34.000000 soapcw-0.1.8/docs/readme.rst
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-05 17:11:50.218466 soapcw-0.1.8/docs/usage/
+-rw-rw-rw-   0 root         (0) root         (0)      280 2023-07-05 17:01:34.000000 soapcw-0.1.8/docs/usage/index.rst
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-05 17:11:50.220466 soapcw-0.1.8/pipeline/
+-rw-rw-rw-   0 root         (0) root         (0)        0 2023-07-05 17:08:40.000000 soapcw-0.1.8/pipeline/__init__.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-05 17:11:50.220466 soapcw-0.1.8/pipeline/css/
+-rw-rw-rw-   0 root         (0) root         (0)     3163 2023-07-05 17:01:34.000000 soapcw-0.1.8/pipeline/css/general.css
+-rwxrwxrwx   0 root         (0) root         (0)     7001 2023-07-05 17:01:34.000000 soapcw-0.1.8/pipeline/make_dag_files_astro.py
+-rwxrwxrwx   0 root         (0) root         (0)     6963 2023-07-05 17:01:34.000000 soapcw-0.1.8/pipeline/make_dag_files_lines.py
+-rw-rw-rw-   0 root         (0) root         (0)    38283 2023-07-05 17:01:34.000000 soapcw-0.1.8/pipeline/make_html_page.py
+-rwxrwxrwx   0 root         (0) root         (0)    37055 2023-07-05 17:01:34.000000 soapcw-0.1.8/pipeline/run_full_soap_astro.py
+-rwxrwxrwx   0 root         (0) root         (0)    40172 2023-07-05 17:01:34.000000 soapcw-0.1.8/pipeline/run_full_soap_lines.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-05 17:11:50.220466 soapcw-0.1.8/pipeline/scripts/
+-rw-rw-rw-   0 root         (0) root         (0)    18806 2023-07-05 17:01:34.000000 soapcw-0.1.8/pipeline/scripts/table_scripts.js
+-rw-rw-rw-   0 root         (0) root         (0)     3367 2023-07-05 17:01:34.000000 soapcw-0.1.8/pipeline/soap_config_parser.py
+-rw-rw-rw-   0 root         (0) root         (0)      984 2023-07-05 17:11:50.230467 soapcw-0.1.8/setup.cfg
+-rw-rw-rw-   0 root         (0) root         (0)     4209 2023-07-05 17:01:34.000000 soapcw-0.1.8/setup.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-05 17:11:50.223466 soapcw-0.1.8/soapcw/
+-rw-rw-rw-   0 root         (0) root         (0)      589 2023-07-05 17:01:34.000000 soapcw-0.1.8/soapcw/__init__.py
+-rw-rw-rw-   0 root         (0) root         (0)      406 2023-07-05 17:01:34.000000 soapcw-0.1.8/soapcw/cli.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-05 17:11:50.225467 soapcw-0.1.8/soapcw/cnn/
+-rw-rw-rw-   0 root         (0) root         (0)       26 2023-07-05 17:01:34.000000 soapcw-0.1.8/soapcw/cnn/__init__.py
+-rw-rw-rw-   0 root         (0) root         (0)     4682 2023-07-05 17:01:34.000000 soapcw-0.1.8/soapcw/cnn/cnn_data_dag_gen.py
+-rwxrwxrwx   0 root         (0) root         (0)    17946 2023-07-05 17:01:34.000000 soapcw-0.1.8/soapcw/cnn/cnn_data_gen.py
+-rw-rw-rw-   0 root         (0) root         (0)    12490 2023-07-05 17:01:34.000000 soapcw-0.1.8/soapcw/cnn/generate_gaussian_train_data.py
+-rw-rw-rw-   0 root         (0) root         (0)    11006 2023-07-05 17:01:34.000000 soapcw-0.1.8/soapcw/cnn/generate_test_data.py
+-rw-rw-rw-   0 root         (0) root         (0)    20005 2023-07-05 17:01:34.000000 soapcw-0.1.8/soapcw/cnn/generate_train_data.py
+-rwxrwxrwx   0 root         (0) root         (0)     5822 2023-07-05 17:01:34.000000 soapcw-0.1.8/soapcw/cnn/narrowband_sfts.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-05 17:11:50.226467 soapcw-0.1.8/soapcw/cnn/pytorch/
+-rw-rw-rw-   0 root         (0) root         (0)       68 2023-07-05 17:01:34.000000 soapcw-0.1.8/soapcw/cnn/pytorch/__init__.py
+-rw-rw-rw-   0 root         (0) root         (0)     4307 2023-07-05 17:01:34.000000 soapcw-0.1.8/soapcw/cnn/pytorch/load_models.py
+-rw-rw-rw-   0 root         (0) root         (0)    15950 2023-07-05 17:01:34.000000 soapcw-0.1.8/soapcw/cnn/pytorch/models.py
+-rw-rw-rw-   0 root         (0) root         (0)    14308 2023-07-05 17:01:34.000000 soapcw-0.1.8/soapcw/cnn/train_model.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-05 17:11:50.227467 soapcw-0.1.8/soapcw/cw/
+-rw-rw-rw-   0 root         (0) root         (0)      197 2023-07-05 17:01:34.000000 soapcw-0.1.8/soapcw/cw/__init__.py
+-rw-rw-rw-   0 root         (0) root         (0)    42241 2023-07-05 17:01:34.000000 soapcw-0.1.8/soapcw/cw/generate_data.py
+-rw-rw-rw-   0 root         (0) root         (0)    19576 2023-07-05 17:01:34.000000 soapcw-0.1.8/soapcw/cw/load_sfts.py
+-rw-rw-rw-   0 root         (0) root         (0)     8660 2023-07-05 17:01:34.000000 soapcw-0.1.8/soapcw/cw/make_sfts.py
+-rw-rw-rw-   0 root         (0) root         (0)     9450 2023-07-05 17:01:34.000000 soapcw-0.1.8/soapcw/cw/sft.py
+-rw-rw-rw-   0 root         (0) root         (0)     8567 2023-07-05 17:01:34.000000 soapcw-0.1.8/soapcw/cw/timeseries.py
+-rw-rw-rw-   0 root         (0) root         (0)     1687 2023-07-05 17:01:34.000000 soapcw-0.1.8/soapcw/cw/tools.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-05 17:11:50.228467 soapcw-0.1.8/soapcw/line_aware_stat/
+-rw-rw-rw-   0 root         (0) root         (0)      123 2023-07-05 17:01:34.000000 soapcw-0.1.8/soapcw/line_aware_stat/__init__.py
+-rw-rw-rw-   0 root         (0) root         (0)    11721 2023-07-05 17:01:34.000000 soapcw-0.1.8/soapcw/line_aware_stat/gen_lookup.pyx
+-rw-rw-rw-   0 root         (0) root         (0)    38004 2023-07-05 17:01:34.000000 soapcw-0.1.8/soapcw/line_aware_stat/gen_lookup_python.py
+-rwxrwxrwx   0 root         (0) root         (0)     6514 2023-07-05 17:01:34.000000 soapcw-0.1.8/soapcw/line_aware_stat/save_lookup.py
+-rw-rw-rw-   0 root         (0) root         (0)     4237 2023-07-05 17:01:34.000000 soapcw-0.1.8/soapcw/soap_config_parser.py
+-rw-r--r--   0 root         (0) root         (0)  2271838 2023-07-05 17:11:49.000000 soapcw-0.1.8/soapcw/soapcw.c
+-rw-rw-rw-   0 root         (0) root         (0)    65928 2023-07-05 17:01:34.000000 soapcw-0.1.8/soapcw/soapcw.pyx
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-05 17:11:50.228467 soapcw-0.1.8/soapcw/tools/
+-rw-rw-rw-   0 root         (0) root         (0)        0 2023-07-05 17:08:40.000000 soapcw-0.1.8/soapcw/tools/__init__.py
+-rw-rw-rw-   0 root         (0) root         (0)     2885 2023-07-05 17:01:34.000000 soapcw-0.1.8/soapcw/tools/plots.py
+-rw-rw-rw-   0 root         (0) root         (0)     9044 2023-07-05 17:01:34.000000 soapcw-0.1.8/soapcw/tools/tools.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-05 17:11:50.224466 soapcw-0.1.8/soapcw.egg-info/
+-rw-r--r--   0 root         (0) root         (0)     2446 2023-07-05 17:11:50.000000 soapcw-0.1.8/soapcw.egg-info/PKG-INFO
+-rw-r--r--   0 root         (0) root         (0)     1829 2023-07-05 17:11:50.000000 soapcw-0.1.8/soapcw.egg-info/SOURCES.txt
+-rw-r--r--   0 root         (0) root         (0)        1 2023-07-05 17:11:50.000000 soapcw-0.1.8/soapcw.egg-info/dependency_links.txt
+-rw-r--r--   0 root         (0) root         (0)      484 2023-07-05 17:11:50.000000 soapcw-0.1.8/soapcw.egg-info/entry_points.txt
+-rw-r--r--   0 root         (0) root         (0)        1 2023-07-05 17:11:50.000000 soapcw-0.1.8/soapcw.egg-info/not-zip-safe
+-rw-r--r--   0 root         (0) root         (0)       65 2023-07-05 17:11:50.000000 soapcw-0.1.8/soapcw.egg-info/requires.txt
+-rw-r--r--   0 root         (0) root         (0)       22 2023-07-05 17:11:50.000000 soapcw-0.1.8/soapcw.egg-info/top_level.txt
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-05 17:11:50.229467 soapcw-0.1.8/tests/
+-rw-rw-rw-   0 root         (0) root         (0)   445283 2023-07-05 17:01:34.000000 soapcw-0.1.8/tests/SNR_injections.ipynb
+-rw-rw-rw-   0 root         (0) root         (0)       59 2023-07-05 17:01:34.000000 soapcw-0.1.8/tests/__init__.py
+-rw-rw-rw-   0 root         (0) root         (0)     1130 2023-07-05 17:01:34.000000 soapcw-0.1.8/tests/test_cwload.py
+-rw-rw-rw-   0 root         (0) root         (0)     3602 2023-07-05 17:01:34.000000 soapcw-0.1.8/tests/test_line_aware_stat.py
+-rw-rw-rw-   0 root         (0) root         (0)     4290 2023-07-05 17:01:34.000000 soapcw-0.1.8/tests/test_soap.py
```

### Comparing `soapcw-0.1.7/CONTRIBUTING.rst` & `soapcw-0.1.8/CONTRIBUTING.rst`

 * *Files identical despite different names*

### Comparing `soapcw-0.1.7/LICENSE` & `soapcw-0.1.8/LICENSE`

 * *Files identical despite different names*

### Comparing `soapcw-0.1.7/PKG-INFO` & `soapcw-0.1.8/PKG-INFO`

 * *Files 5% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: soapcw
-Version: 0.1.7
+Version: 0.1.8
 Summary: SOAP is a rapid algorithm to search for continuous sources of gravitational waves, with a wider application to long duration narrowband signals.
 Home-page: https://git.ligo.org/joseph.bayley/soapcw
 Author: Joe Bayley
 Author-email: joseph.bayley@glasgow.ac.uk
 License: MIT license
 Download-URL: https://git.ligo.org/joseph.bayley/soapcw/-/archive/0.1.2/soapcw-0.1.2.tar.gz
 Keywords: soapcw,soap,gravitational waves,pulsars,neutron stars,continuous waves
@@ -26,15 +26,15 @@
 
 .. image:: https://img.shields.io/pypi/v/soap.svg
         :target: https://pypi.python.org/pypi/soap
 
 SOAP: Applying the Viterbi algorithm to search for sources
 of continuous gravitational waves.
 
-.. image:: https://git.ligo.org/joseph.bayley/soapcw/-/raw/master/soapcw/summary_pages/images/vitmap_ex.png
+.. image:: https://git.ligo.org/joseph.bayley/soapcw/-/raw/master/pipeline/images/vitmap_ex.png
 
 SOAP is primarily developed to search for continuous sources of
 gravitational waves, however, has a more general application to search
 for and long duration weak signal.
 
 This package also includes tools to load in standard short Fourier transforms (SFTs) and prepare them for usage with the core SOAP search.
 
@@ -71,8 +71,13 @@
 =======
 
 0.1.0 (2019-04-23)
 ------------------
 
 * First release on PyPI.
 
+0.1.8 (2023-07-05)
+------------------
+
+* New release with CNNs
+
```

### Comparing `soapcw-0.1.7/README.rst` & `soapcw-0.1.8/README.rst`

 * *Files 4% similar despite different names*

```diff
@@ -5,15 +5,15 @@
 
 .. image:: https://img.shields.io/pypi/v/soap.svg
         :target: https://pypi.python.org/pypi/soap
 
 SOAP: Applying the Viterbi algorithm to search for sources
 of continuous gravitational waves.
 
-.. image:: https://git.ligo.org/joseph.bayley/soapcw/-/raw/master/soapcw/summary_pages/images/vitmap_ex.png
+.. image:: https://git.ligo.org/joseph.bayley/soapcw/-/raw/master/pipeline/images/vitmap_ex.png
 
 SOAP is primarily developed to search for continuous sources of
 gravitational waves, however, has a more general application to search
 for and long duration weak signal.
 
 This package also includes tools to load in standard short Fourier transforms (SFTs) and prepare them for usage with the core SOAP search.
```

### Comparing `soapcw-0.1.7/docs/Makefile` & `soapcw-0.1.8/docs/Makefile`

 * *Files identical despite different names*

### Comparing `soapcw-0.1.7/docs/conf.py` & `soapcw-0.1.8/docs/conf.py`

 * *Files identical despite different names*

### Comparing `soapcw-0.1.7/docs/index.rst` & `soapcw-0.1.8/docs/index.rst`

 * *Files 10% similar despite different names*

```diff
@@ -34,14 +34,15 @@
 Usage
 =============
 
 .. toctree::
     :maxdepth: 2
    
     usage/index
+    cnn_usage/index
     pipeline_usage/index
 
 
 Info
 =========
 
 .. toctree::
```

### Comparing `soapcw-0.1.7/docs/installation.rst` & `soapcw-0.1.8/docs/installation.rst`

 * *Files identical despite different names*

### Comparing `soapcw-0.1.7/docs/make.bat` & `soapcw-0.1.8/docs/make.bat`

 * *Files identical despite different names*

### Comparing `soapcw-0.1.7/docs/pipeline_usage/run_pipeline.rst` & `soapcw-0.1.8/docs/pipeline_usage/run_pipeline.rst`

 * *Files 6% similar despite different names*

```diff
@@ -4,14 +4,16 @@
 Pipeline usage
 ============
 
 SOAP is usually run as a pipeline on the LIGO detectors, 
 both searching for astrophysical signals and as a detector characterisation tool.
 These are referenced as the astrophysical searches and the line searches.
 
+These tools were designed to run on the LIGO clusters with access to LIGO data, however may still work elsewhere.
+
 Astrophysical search
 ------------
 
 Once installed there are two scripts thats can be used to run the pipeline, first the astrophysical search:
 
 .. code-block:: console
 
@@ -185,10 +187,18 @@
 
     [scripts]
     # executables to run the search with and to generate the html pages
     search_exec=soapcw-run-soap-astro
     html_exec=soapcw-make-html-pages
 
 
+Making html pages
+------------------
+If the pages are not made automatically, they can be manually made using the html page script
+
+.. code-block:: console
+    $ soapcw-make-html-pages -c config.ini
+
+
 
 
 .. _Github repo: https://git.ligo.org/joseph.bayley/soapcw
```

### Comparing `soapcw-0.1.7/pipeline/css/general.css` & `soapcw-0.1.8/pipeline/css/general.css`

 * *Files identical despite different names*

### Comparing `soapcw-0.1.7/pipeline/make_dag_files_astro.py` & `soapcw-0.1.8/pipeline/make_dag_files_astro.py`

 * *Files identical despite different names*

### Comparing `soapcw-0.1.7/pipeline/make_dag_files_lines.py` & `soapcw-0.1.8/pipeline/make_dag_files_lines.py`

 * *Files identical despite different names*

### Comparing `soapcw-0.1.7/pipeline/make_html_page.py` & `soapcw-0.1.8/pipeline/make_html_page.py`

 * *Files identical despite different names*

### Comparing `soapcw-0.1.7/pipeline/run_full_soap_astro.py` & `soapcw-0.1.8/pipeline/run_full_soap_astro.py`

 * *Files identical despite different names*

### Comparing `soapcw-0.1.7/pipeline/run_full_soap_lines.py` & `soapcw-0.1.8/pipeline/run_full_soap_lines.py`

 * *Files identical despite different names*

### Comparing `soapcw-0.1.7/pipeline/scripts/table_scripts.js` & `soapcw-0.1.8/pipeline/scripts/table_scripts.js`

 * *Files identical despite different names*

### Comparing `soapcw-0.1.7/pipeline/soap_config_parser.py` & `soapcw-0.1.8/pipeline/soap_config_parser.py`

 * *Files identical despite different names*

### Comparing `soapcw-0.1.7/setup.cfg` & `soapcw-0.1.8/setup.cfg`

 * *Files 9% similar despite different names*

```diff
@@ -1,9 +1,9 @@
 [bumpversion]
-current_version = 0.1.7
+current_version = 0.1.8
 commit = True
 tag = True
 
 [bumpversion:file:setup.py]
 search = version='{current_version}'
 replace = version='{new_version}'
 
@@ -17,15 +17,15 @@
 [flake8]
 exclude = docs
 
 [aliases]
 
 [metadata]
 name = soapcw
-version = 0.1.7
+version = 0.1.8
 
 [options]
 packages = soapcw, pipeline
 
 [options.entry_points]
 console_scripts = 
 	soapcw-make-dag-files-lines = pipeline.make_dag_files_lines:main
```

### Comparing `soapcw-0.1.7/setup.py` & `soapcw-0.1.8/setup.py`

 * *Files identical despite different names*

### Comparing `soapcw-0.1.7/soapcw/__init__.py` & `soapcw-0.1.8/soapcw/__init__.py`

 * *Files 0% similar despite different names*

```diff
@@ -1,14 +1,14 @@
 # -*- coding: utf-8 -*-
 from __future__ import absolute_import
 """Top-level package for soapcw."""
 
 __author__ = """Joe Bayley"""
 __email__ = 'joseph.bayley@glasgow.ac.uk'
-__version__ = '0.1.0'
+__version__ = '0.1.8'
 from .soapcw import single_detector, two_detector, three_detector, single_detector_gaps
 from .tools import tools, plots
 from .cnn import __init__
 from .line_aware_stat import __init__
 from .cw import __init__
 from . import soap_config_parser
```

### Comparing `soapcw-0.1.7/soapcw/cnn/cnn_data_dag_gen.py` & `soapcw-0.1.8/soapcw/cnn/cnn_data_dag_gen.py`

 * *Files identical despite different names*

### Comparing `soapcw-0.1.7/soapcw/cnn/cnn_data_gen.py` & `soapcw-0.1.8/soapcw/cnn/cnn_data_gen.py`

 * *Files identical despite different names*

### Comparing `soapcw-0.1.7/soapcw/cnn/generate_gaussian_train_data.py` & `soapcw-0.1.8/soapcw/cnn/generate_gaussian_train_data.py`

 * *Files identical despite different names*

### Comparing `soapcw-0.1.7/soapcw/cnn/generate_test_data.py` & `soapcw-0.1.8/soapcw/cnn/generate_test_data.py`

 * *Files identical despite different names*

### Comparing `soapcw-0.1.7/soapcw/cnn/generate_train_data.py` & `soapcw-0.1.8/soapcw/cnn/generate_train_data.py`

 * *Files identical despite different names*

### Comparing `soapcw-0.1.7/soapcw/cnn/narrowband_sfts.py` & `soapcw-0.1.8/soapcw/cnn/narrowband_sfts.py`

 * *Files identical despite different names*

### Comparing `soapcw-0.1.7/soapcw/cnn/pytorch/load_models.py` & `soapcw-0.1.8/soapcw/cnn/pytorch/load_models.py`

 * *Files 22% similar despite different names*

```diff
@@ -1,13 +1,48 @@
 import pkg_resources
 import torch
 import numpy as np
-from .models import cnn
 import configparser
+import soapcw
 
+def load_model_from_config(config, weights, device="cpu"):
+    """
+    Load in model weights from config and weights
+    args
+    ---------
+    config: string
+        path to the config ini file
+    weights: string
+        path to for the checkpointed weights of network
+
+    returns
+    ---------
+    model_soap: torch.Module
+        returns a torch model with trained weights
+    config: SoapConfigParser
+        returns the parsed config file for the model
+    """
+    config = soapcw.soap_config_parser.SOAPConfig(config)
+
+    pre_model_weights = torch.load(weights, map_location=device)
+
+
+    model_soap = soapcw.cnn.pytorch.models.CNN(
+        input_dim=config["model"]["img_dim"],               # the size of the input image
+        fc_layers=config["model"]["fc_layers"],               # the size of the fully connected mlp layers 
+        conv_layers=config["model"]["conv_layers"],           # the convolutional layers (num_filters, filter_size, maxpool_size, stride)
+        inchannels=config["model"]["n_channels"], 
+        avg_pool_size=config["model"]["avg_pool_size"],                            # the size of the average pooling layer    
+        device=device).to(device)
+
+
+    model_soap.load_state_dict(pre_model_weights["model_state_dict"])
+
+    return model_soap, config
+    
 def load_vitmap_model(fmin, obs_run = "O3", checkpoint_file = None):
     """
     Load the Viterbimap model for testing
     """
     if 40 < fmin < 500:
         brange = "40_500"
         stride = 1
```

### Comparing `soapcw-0.1.7/soapcw/cnn/train_model.py` & `soapcw-0.1.8/soapcw/cnn/train_model.py`

 * *Files 23% similar despite different names*

```diff
@@ -46,14 +46,17 @@
         truths = torch.cat([torch.zeros(len(noise_data[0])), torch.ones(len(signal_data[0]))])
         if self.shuffle:
             shuffle_inds = np.arange(len(truths))
             np.random.shuffle(shuffle_inds)
             truths = truths[shuffle_inds]
             tot_data = [tot_data[i][shuffle_inds] for i in range(len(tot_data))]
 
+
+        truths = torch.nn.functional.one_hot(torch.Tensor(truths).to(torch.int32).long(), 2)
+
         return tot_data, truths 
 
     def load_file(self, fname):
         """loads in one hdf5 containing data 
 
         Args:
             fname (string): filename
@@ -99,22 +102,93 @@
 def train_batch(model, optimiser, loss_fn, batch_data, batch_labels, model_type="spectrogram", train=True, device="cpu"):
     model.train(train)
     if train:
         optimiser.zero_grad()
 
     if model_type in ["spectrogram", "vitmapspectrogram"]:
         output = model(torch.Tensor(batch_data[0]).to(device))
-        loss = loss_fn(output.flatten(), batch_labels.to(device).flatten())
+        loss = loss_fn(output, batch_labels.to(device).to(torch.float32))
         if train:
             loss.backward()
             optimiser.step()
     
     return loss.item()
 
-def train_model(model_type, save_dir, load_dir, learning_rate, img_dim, conv_layers, fc_layers, avg_pool_size=None, device="cpu", load_model=None, bandtype="even", snrmin=40,snrmax=200, fmin=20,fmax=500, n_epochs=10, save_interval=100):
+def train_multi_batch(model, optimiser, loss_fn, batch_data, batch_labels, model_type="spectrogram", train=True, device="cpu", n_train_multi_size=2):
+    """Train each batch, but train the same batch multiple times changing the length of time
+          = for use with the Adaptive average pool 
+
+    Args:
+        model (_type_): _description_
+        optimiser (_type_): _description_
+        loss_fn (_type_): _description_
+        batch_data (_type_): _description_
+        batch_labels (_type_): _description_
+        model_type (str, optional): _description_. Defaults to "spectrogram".
+        train (bool, optional): _description_. Defaults to True.
+        device (str, optional): _description_. Defaults to "cpu".
+        n_train_multi_size (int, optional): number of times to split up the time axis, 3 with split into N/1, N/2 and N/3. Defaults to 2.
+
+    Returns:
+        _type_: _description_
+    """
+    model.train(train)
+
+    nsize = batch_data[0].size(-1)
+    
+    total_loss = []
+
+    for i in range(n_train_multi_size):
+        seglen = int(nsize/(i+1))
+        # set the start indices for the subdata
+        # repeat N start indices where N in the number of times to break up data
+        start_inds = np.random.uniform(0, (nsize - seglen - 1), size=i+1).astype(int)
+
+        if train:
+            optimiser.zero_grad()
+
+        # loop over the subdata start inds and average the loss
+        temp_loss = 0
+        for sind in start_inds:
+            if model_type in ["spectrogram", "vitmapspectrogram"]:
+                output = model(torch.Tensor(batch_data[0][:,:,:,sind: sind + seglen]).to(device))
+                tloss = loss_fn(output, batch_labels.to(device).to(torch.float32))
+                temp_loss += tloss
+        
+        temp_loss = temp_loss/len(start_inds)
+        total_loss.append(temp_loss.item())
+
+        # take the backward pass after averaging loss
+        if train:
+            temp_loss.backward()
+            optimiser.step()
+    
+    return np.mean(total_loss)
+
+def train_model(
+    model_type, 
+    save_dir, 
+    load_dir, 
+    learning_rate, 
+    img_dim,
+    in_channels,
+    conv_layers, 
+    fc_layers, 
+    avg_pool_size=None, 
+    device="cpu", 
+    load_model=None, 
+    bandtype="even", 
+    snrmin=40,
+    snrmax=200, 
+    fmin=20,
+    fmax=500, 
+    n_epochs=10, 
+    save_interval=100, 
+    verbose=True,
+    n_train_multi_size=None):
     """_summary_
 
     Args:
         model_type (_type_): _description_
         save_dir (_type_): _description_
         load_dir (_type_): _description_
         learning_rate (_type_): _description_
@@ -140,64 +214,69 @@
     train_signal_dir = os.path.join(load_dir, "train", bandtype, f"band_{fmin}_{fmax}", f"snr_{float(snrmin)}_{float(snrmax)}")
 
     val_noise_dir = os.path.join(load_dir, "train", other_bandtype, f"band_{fmin}_{fmax}", "snr_0.0_0.0")
     val_signal_dir = os.path.join(load_dir, "train", other_bandtype, f"band_{fmin}_{fmax}", f"snr_{float(snrmin)}_{float(snrmax)}")
 
     if model_type == "spectrogram":
         load_types = ["H_imgs", "L_imgs"]
-        inchannels = 2
-        model = models.cnn.CNN(input_dim=img_dim, output_dim=1, fc_layers=fc_layers, conv_layers=conv_layers, inchannels=inchannels, avg_pool_size=avg_pool_size, device=device).to(device)
+        #inchannels = 2
+        model = models.CNN(input_dim=img_dim, fc_layers=fc_layers, conv_layers=conv_layers, inchannels=in_channels, avg_pool_size=avg_pool_size, device=device).to(device)
     elif model_type == "vitmap":
         load_types = ["vit_imgs"]
-        inchannels = 1
-        model = models.cnn.CNN(input_dim=img_dim, output_dim=1, fc_layers=fc_layers, conv_layers=conv_layers, inchannels=inchannels, avg_pool_size=avg_pool_size, device=device).to(device)
+        #inchannels = 1
+        model = models.CNN(input_dim=img_dim, fc_layers=fc_layers, conv_layers=conv_layers, inchannels=in_channels, avg_pool_size=avg_pool_size, device=device).to(device)
     elif model_type == "vitmapspectrogram":
         load_types = ["vit_imgs", "H_imgs", "L_imgs"]
-        inchannels = 3
-        model = models.cnn.CNN(input_dim=img_dim, output_dim=1, fc_layers=fc_layers, conv_layers=conv_layers, inchannels=inchannels, avg_pool_size=avg_pool_size, device=device).to(device)
+        #inchannels = 3
+        model = models.CNN(input_dim=img_dim, fc_layers=fc_layers, conv_layers=conv_layers, inchannels=in_channels, avg_pool_size=avg_pool_size, device=device).to(device)
     elif model_type == "vitmapspectrogramstat":
         load_types = ["vit_imgs", "H_imgs", "L_imgs", "stat"]
     else:
         raise Exception(f"Load type {model_type} not defined select from [spectrogram, vitmap, vit_imgs, vitmapspectrogram, vitmapspectstatgram]")
 
     print("model")
-    print(torchsummary.summary(model, (1, inchannels, img_dim[0], img_dim[1])))
+    print(torchsummary.summary(model, (in_channels, img_dim[0], img_dim[1])))
 
     print("model loaded")
 
     train_dataset = LoadData(train_noise_dir, train_signal_dir, load_types=load_types)
     validation_dataset = LoadData(val_noise_dir, val_signal_dir, load_types=load_types, nfile_load=2)
     print("Training data len: ", len(train_dataset))
     print("Validation data len: ", len(validation_dataset))
     trd0 = train_dataset[0]
     print("datashape: ", [np.shape(trd0[0][i]) for i in range(len(trd0[0]))])
     print(train_noise_dir)
     print("data loaded")
 
     optimiser = torch.optim.Adam(model.parameters(), lr = learning_rate)
-    loss_fn = torch.nn.BCELoss()
+    loss_fn = torch.nn.BCEWithLogitsLoss()
 
     if load_model is not None:
         checkpoint = model.load(load_model)
         model.load_state_dict(checkpoint["model_state_dict"])
         optimiser.load_state_dict(checkpoint["optimiser_state_dict"])
 
+    if n_train_multi_size is not None and avg_pool_size is None:
+        raise Exception("Train multi batch can only be used with adaptive average pooling avg_pool_size")
 
     all_losses = []
     all_val_losses = []
     print("training....")
     for epoch in range(n_epochs):
 
         epoch_start = time.time()
         losses = []
         mean_batch_time = [time.time()]
         batch_times = [time.time()]
         for batch_data, batch_labels in train_dataset:
             bt_start = batch_times[-1]
-            loss = train_batch(model, optimiser, loss_fn, batch_data, batch_labels, device=device)    
+            if n_train_multi_size is not None:
+                loss = train_multi_batch(model, optimiser, loss_fn, batch_data, batch_labels, device=device, n_train_multi_size=n_train_multi_size)
+            else:
+                loss = train_batch(model, optimiser, loss_fn, batch_data, batch_labels, device=device)    
             losses.append(loss)
             batch_times.append(time.time())
             batch_time = batch_times[-1] - bt_start
             mean_batch_time.append(batch_time)
             if verbose:
                 print(f"batch_time: {batch_time}")
 
@@ -250,19 +329,21 @@
         cfg = SOAPConfig(args.config_file)
 
     for bandtype in cfg["model"]["band_types"]:
         train_model(cfg["model"]["model_type"], 
                     cfg["model"]["save_dir"], 
                     cfg["general"]["save_dir"], 
                     cfg["model"]["learning_rate"], 
-                    cfg["model"]["img_dim"], 
+                    cfg["model"]["img_dim"],
+                    cfg["model"]["n_channels"],
                     cfg["model"]["conv_layers"], 
                     cfg["model"]["fc_layers"],
                     avg_pool_size=cfg["model"]["avg_pool_size"],
                     bandtype = bandtype,
                     n_epochs = cfg["model"]["n_epochs"],
                     device=device,
-                    save_interval=cfg["model"]["save_interval"])
+                    save_interval=cfg["model"]["save_interval"],
+                    n_train_multi_size=cfg["model"]["n_train_multi_size"])
 
 
 if __name__ == "__main__":
-    main()
+    main()
```

### Comparing `soapcw-0.1.7/soapcw/cw/generate_data.py` & `soapcw-0.1.8/soapcw/cw/generate_data.py`

 * *Files identical despite different names*

### Comparing `soapcw-0.1.7/soapcw/cw/load_sfts.py` & `soapcw-0.1.8/soapcw/cw/load_sfts.py`

 * *Files identical despite different names*

### Comparing `soapcw-0.1.7/soapcw/cw/make_sfts.py` & `soapcw-0.1.8/soapcw/cw/make_sfts.py`

 * *Files identical despite different names*

### Comparing `soapcw-0.1.7/soapcw/cw/sft.py` & `soapcw-0.1.8/soapcw/cw/sft.py`

 * *Files identical despite different names*

### Comparing `soapcw-0.1.7/soapcw/cw/timeseries.py` & `soapcw-0.1.8/soapcw/cw/timeseries.py`

 * *Files identical despite different names*

### Comparing `soapcw-0.1.7/soapcw/cw/tools.py` & `soapcw-0.1.8/soapcw/cw/tools.py`

 * *Files identical despite different names*

### Comparing `soapcw-0.1.7/soapcw/line_aware_stat/gen_lookup.pyx` & `soapcw-0.1.8/soapcw/line_aware_stat/gen_lookup.pyx`

 * *Files identical despite different names*

### Comparing `soapcw-0.1.7/soapcw/line_aware_stat/gen_lookup_python.py` & `soapcw-0.1.8/soapcw/line_aware_stat/gen_lookup_python.py`

 * *Files identical despite different names*

### Comparing `soapcw-0.1.7/soapcw/line_aware_stat/save_lookup.py` & `soapcw-0.1.8/soapcw/line_aware_stat/save_lookup.py`

 * *Files identical despite different names*

### Comparing `soapcw-0.1.7/soapcw/soap_config_parser.py` & `soapcw-0.1.8/soapcw/soap_config_parser.py`

 * *Files 4% similar despite different names*

```diff
@@ -11,23 +11,24 @@
         my_resources = importlib_resources.files("soapcw")
         cfg.read((my_resources / "cnn"/ "init_files" / "default_gauss.ini"))
 
         cfg.read(config_file)
 
         self.config_file = os.path.abspath(config_file)
         self.float_list = ["band_starts","band_ends","band_widths"]
-        self.int_list = ["strides","fc_layers","img_dim"]
+        self.int_list = ["strides","fc_layers","img_dim", "avg_pool_size"]
         self.string_list = ["load_directory","save_options","type","band_types","sft_dirs"]
         self.tuple_list = ["conv_layers"]
         self.floats = ["band_load_size", "snr_width_line", "snr_width_signal", 
                         "prob_line", "left_right_prob", "det1_prob", "det2_prob",
                         "snrmin","snrmax","learning_rate","data_load_size","tstart"]
-        self.ints = ["memory", "request_disk", "n_jobs", "avg_pool_size",
-                     "n_summed_sfts","n_epochs","save_interval","nsfts", "tstart", "tend"]
-        self.bools = ["resize_image", "overwrite_files"]
+        self.ints = ["memory", "request_disk", "n_jobs", "n_channels","nperband",
+                     "n_summed_sfts","n_epochs","save_interval","nsfts", "tstart", "tend",
+                     "n_train_multi_size"]
+        self.bools = ["resize_image", "overwrite_files", "gen_noise_only"]
         self.strings = ["save_dir", "narrowband_sft_dir", "accounting_group", "root_dir", 
                         "run", "type", "lookup_dir", "model_type","search_exec"]
 
 
         self.config = self.parse_config(cfg)
 
     def __getitem__(self, key):
@@ -61,15 +62,17 @@
     def parse_config(self, cfg):
 
         parsed_dict = {}
         for key, val in cfg.items():
             parsed_dict[key] = {}
             for key2, val2 in val.items():
                 # if comma then part of a list
-                if key2 in self.float_list:
+                if val2 in ["none", "None", None]:
+                    parsed_dict[key][key2] = None
+                elif key2 in self.float_list:
                     parsed_dict[key][key2] = self.load_list(val2, "float")
                 elif key2 in self.int_list:
                     parsed_dict[key][key2] = self.load_list(val2, "int")
                 elif key2 in self.string_list:
                     parsed_dict[key][key2] = self.load_list(val2, "string")
                 elif key2 in self.floats:
                     parsed_dict[key][key2] = float(val2)
@@ -92,8 +95,8 @@
                 else:
                     print(f"Key not in defaults: {key}, {key2}")
                     if val2 in ["none", "None"]:
                         parsed_dict[key][key2] = None
                     else:
                         parsed_dict[key][key2] = val2.replace('"','')
                 
-        return parsed_dict
+        return parsed_dict
```

### Comparing `soapcw-0.1.7/soapcw/soapcw.c` & `soapcw-0.1.8/soapcw/soapcw.c`

 * *Files 1% similar despite different names*

```diff
@@ -1,8 +1,8 @@
-/* Generated by Cython 0.29.35 */
+/* Generated by Cython 0.29.36 */
 
 /* BEGIN: Cython Metadata
 {
     "distutils": {
         "depends": [],
         "name": "soapcw.soapcw",
         "sources": [
@@ -18,16 +18,16 @@
 #endif /* PY_SSIZE_T_CLEAN */
 #include "Python.h"
 #ifndef Py_PYTHON_H
     #error Python headers needed to compile C extensions, please install development version of Python.
 #elif PY_VERSION_HEX < 0x02060000 || (0x03000000 <= PY_VERSION_HEX && PY_VERSION_HEX < 0x03030000)
     #error Cython requires Python 2.6+ or Python 3.3+.
 #else
-#define CYTHON_ABI "0_29_35"
-#define CYTHON_HEX_VERSION 0x001D23F0
+#define CYTHON_ABI "0_29_36"
+#define CYTHON_HEX_VERSION 0x001D24F0
 #define CYTHON_FUTURE_DIVISION 1
 #include <stddef.h>
 #ifndef offsetof
   #define offsetof(type, member) ( (size_t) & ((type*)0) -> member )
 #endif
 #if !defined(WIN32) && !defined(MS_WINDOWS)
   #ifndef __stdcall
@@ -94,15 +94,15 @@
   #if PY_VERSION_HEX < 0x03090000
     #undef CYTHON_PEP489_MULTI_PHASE_INIT
     #define CYTHON_PEP489_MULTI_PHASE_INIT 0
   #elif !defined(CYTHON_PEP489_MULTI_PHASE_INIT)
     #define CYTHON_PEP489_MULTI_PHASE_INIT 1
   #endif
   #undef CYTHON_USE_TP_FINALIZE
-  #define CYTHON_USE_TP_FINALIZE 0
+  #define CYTHON_USE_TP_FINALIZE (PY_VERSION_HEX >= 0x030400a1 && PYPY_VERSION_NUM >= 0x07030C00)
   #undef CYTHON_USE_DICT_VERSIONS
   #define CYTHON_USE_DICT_VERSIONS 0
   #undef CYTHON_USE_EXC_INFO_STACK
   #define CYTHON_USE_EXC_INFO_STACK 0
   #ifndef CYTHON_UPDATE_DESCRIPTOR_DOC
     #define CYTHON_UPDATE_DESCRIPTOR_DOC 0
   #endif
@@ -378,17 +378,14 @@
   #elif defined (__STDC_VERSION__) && __STDC_VERSION__ >= 199901L
     #define CYTHON_INLINE inline
   #else
     #define CYTHON_INLINE
   #endif
 #endif
 
-#if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX < 0x02070600 && !defined(Py_OptimizeFlag)
-  #define Py_OptimizeFlag 0
-#endif
 #define __PYX_BUILD_PY_SSIZE_T "n"
 #define CYTHON_FORMAT_SSIZE_T "z"
 #if PY_MAJOR_VERSION < 3
   #define __Pyx_BUILTIN_MODULE_NAME "__builtin__"
   #define __Pyx_PyCode_New(a, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)\
           PyCode_New(a+k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)
   #define __Pyx_DefaultClassType PyClass_Type
@@ -458,14 +455,19 @@
     }
 #else
   #define __Pyx_PyCode_New(a, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)\
           PyCode_New(a, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)
 #endif
   #define __Pyx_DefaultClassType PyType_Type
 #endif
+#if PY_VERSION_HEX >= 0x030900F0 && !CYTHON_COMPILING_IN_PYPY
+  #define __Pyx_PyObject_GC_IsFinalized(o) PyObject_GC_IsFinalized(o)
+#else
+  #define __Pyx_PyObject_GC_IsFinalized(o) _PyGC_FINALIZED(o)
+#endif
 #ifndef Py_TPFLAGS_CHECKTYPES
   #define Py_TPFLAGS_CHECKTYPES 0
 #endif
 #ifndef Py_TPFLAGS_HAVE_INDEX
   #define Py_TPFLAGS_HAVE_INDEX 0
 #endif
 #ifndef Py_TPFLAGS_HAVE_NEWBUFFER
@@ -1085,30 +1087,30 @@
 struct __pyx_obj_6soapcw_6soapcw___pyx_scope_struct__run;
 struct __pyx_obj_6soapcw_6soapcw___pyx_scope_struct_1_genexpr;
 struct __pyx_array_obj;
 struct __pyx_MemviewEnum_obj;
 struct __pyx_memoryview_obj;
 struct __pyx_memoryviewslice_obj;
 
-/* "soapcw/soapcw.pyx":77
+/* "soapcw/soapcw.pyx":84
  * 
  * 
- *     def run(self,double[:] tr, double[:, :] obs, lookup_file = None):             # <<<<<<<<<<<<<<
+ *     def run(self,double[:] tr, double[:, :] obs, lookup_table = None):             # <<<<<<<<<<<<<<
  *         '''
  *         Run the viterbi algorithm for given single set of data and 3x1 transition matrix.
  */
 struct __pyx_obj_6soapcw_6soapcw___pyx_scope_struct__run {
   PyObject_HEAD
   __Pyx_memviewslice __pyx_v_V;
   int __pyx_v_length;
   int __pyx_v_width;
 };
 
 
-/* "soapcw/soapcw.pyx":169
+/* "soapcw/soapcw.pyx":176
  *                     pbar+=100./len(obs)
  * 
  *         cdef double max_end_prob = max(V[length-1][i] for i in range(width))             # <<<<<<<<<<<<<<
  *         cdef int previous
  *         cdef int[:] vit_track = np.zeros(length,dtype=np.int32)
  */
 struct __pyx_obj_6soapcw_6soapcw___pyx_scope_struct_1_genexpr {
@@ -1839,14 +1841,31 @@
 #define __Pyx_TypeCheck(obj, type) PyObject_TypeCheck(obj, (PyTypeObject *)type)
 #define __Pyx_PyErr_GivenExceptionMatches(err, type) PyErr_GivenExceptionMatches(err, type)
 #define __Pyx_PyErr_GivenExceptionMatches2(err, type1, type2) (PyErr_GivenExceptionMatches(err, type1) || PyErr_GivenExceptionMatches(err, type2))
 #endif
 #define __Pyx_PyException_Check(obj) __Pyx_TypeCheck(obj, PyExc_Exception)
 
 static CYTHON_UNUSED int __pyx_memoryview_getbuffer(PyObject *__pyx_v_self, Py_buffer *__pyx_v_info, int __pyx_v_flags); /*proto*/
+/* AssertionsEnabled.proto */
+#define __Pyx_init_assertions_enabled()
+#if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX < 0x02070600 && !defined(Py_OptimizeFlag)
+  #define __pyx_assertions_enabled() (1)
+#elif PY_VERSION_HEX < 0x03080000  ||  CYTHON_COMPILING_IN_PYPY  ||  defined(Py_LIMITED_API)
+  #define __pyx_assertions_enabled() (!Py_OptimizeFlag)
+#elif CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x030900A6
+  static int __pyx_assertions_enabled_flag;
+  #define __pyx_assertions_enabled() (__pyx_assertions_enabled_flag)
+  #undef __Pyx_init_assertions_enabled
+  static void __Pyx_init_assertions_enabled(void) {
+    __pyx_assertions_enabled_flag = ! _PyInterpreterState_GetConfig(__Pyx_PyThreadState_Current->interp)->optimization_level;
+  }
+#else
+  #define __pyx_assertions_enabled() (!Py_OptimizeFlag)
+#endif
+
 /* DivInt[long].proto */
 static CYTHON_INLINE long __Pyx_div_long(long, long);
 
 /* PySequenceContains.proto */
 static CYTHON_INLINE int __Pyx_PySequence_ContainsTF(PyObject* item, PyObject* seq, int eq) {
     int result = PySequence_Contains(seq, item);
     return unlikely(result < 0) ? result : (result == (eq == Py_EQ));
@@ -2426,14 +2445,15 @@
 static const char __pyx_k_logarr[] = "logarr";
 static const char __pyx_k_module[] = "__module__";
 static const char __pyx_k_name_2[] = "__name__";
 static const char __pyx_k_object[] = "object";
 static const char __pyx_k_params[] = "params";
 static const char __pyx_k_path_m[] = "path_m";
 static const char __pyx_k_pickle[] = "pickle";
+static const char __pyx_k_powers[] = "powers";
 static const char __pyx_k_ranges[] = "ranges";
 static const char __pyx_k_reduce[] = "__reduce__";
 static const char __pyx_k_repeat[] = "repeat";
 static const char __pyx_k_result[] = "result";
 static const char __pyx_k_starts[] = "starts";
 static const char __pyx_k_stdout[] = "stdout";
 static const char __pyx_k_struct[] = "struct";
@@ -2469,15 +2489,14 @@
 static const char __pyx_k_reshape[] = "reshape";
 static const char __pyx_k_sep_len[] = "sep_len";
 static const char __pyx_k_thresh2[] = "thresh2";
 static const char __pyx_k_tr_dist[] = "tr_dist";
 static const char __pyx_k_viterbi[] = "viterbi";
 static const char __pyx_k_Ellipsis[] = "Ellipsis";
 static const char __pyx_k_diff_ind[] = "diff_ind";
-static const char __pyx_k_filename[] = "filename";
 static const char __pyx_k_frac_ind[] = "frac_ind";
 static const char __pyx_k_gappaths[] = "gappaths";
 static const char __pyx_k_gaptrack[] = "gaptrack";
 static const char __pyx_k_getstate[] = "__getstate__";
 static const char __pyx_k_indicies[] = "indicies";
 static const char __pyx_k_itemsize[] = "itemsize";
 static const char __pyx_k_length_t[] = "length_t";
@@ -2537,27 +2556,28 @@
 static const char __pyx_k_vit_track1[] = "vit_track1";
 static const char __pyx_k_vit_track2[] = "vit_track2";
 static const char __pyx_k_vit_track3[] = "vit_track3";
 static const char __pyx_k_vit_trackr[] = "vit_trackr";
 static const char __pyx_k_MemoryError[] = "MemoryError";
 static const char __pyx_k_PickleError[] = "PickleError";
 static const char __pyx_k_frac_ranges[] = "frac_ranges";
-static const char __pyx_k_lookup_file[] = "lookup_file";
 static const char __pyx_k_make_vitmap[] = "make_vitmap";
 static const char __pyx_k_obs1_ind_1d[] = "obs1_ind_1d";
 static const char __pyx_k_obs1_ind_2d[] = "obs1_ind_2d";
 static const char __pyx_k_obs2_ind_1d[] = "obs2_ind_1d";
 static const char __pyx_k_obs2_ind_2d[] = "obs2_ind_2d";
 static const char __pyx_k_obs_ind_arr[] = "obs_ind_arr";
 static const char __pyx_k_read_lookup[] = "read_lookup";
+static const char __pyx_k_lookup_table[] = "lookup_table";
 static const char __pyx_k_max_end_prob[] = "max_end_prob";
 static const char __pyx_k_obs1_ind_arr[] = "obs1_ind_arr";
 static const char __pyx_k_obs2_ind_arr[] = "obs2_ind_arr";
 static const char __pyx_k_power_ranges[] = "power_ranges";
 static const char __pyx_k_pyx_checksum[] = "__pyx_checksum";
+static const char __pyx_k_signoiseline[] = "signoiseline";
 static const char __pyx_k_stringsource[] = "stringsource";
 static const char __pyx_k_two_detector[] = "two_detector";
 static const char __pyx_k_pyx_getbuffer[] = "__pyx_getbuffer";
 static const char __pyx_k_reduce_cython[] = "__reduce_cython__";
 static const char __pyx_k_scipy_special[] = "scipy.special";
 static const char __pyx_k_soapcw_soapcw[] = "soapcw.soapcw";
 static const char __pyx_k_max_prob_index[] = "max_prob_index";
@@ -2573,17 +2593,17 @@
 static const char __pyx_k_obs2_ind_arr_1d[] = "obs2_ind_arr_1d";
 static const char __pyx_k_obs2_ind_arr_2d[] = "obs2_ind_arr_2d";
 static const char __pyx_k_pyx_PickleError[] = "__pyx_PickleError";
 static const char __pyx_k_read_lookup_amp[] = "read_lookup_amp";
 static const char __pyx_k_setstate_cython[] = "__setstate_cython__";
 static const char __pyx_k_single_detector[] = "single_detector";
 static const char __pyx_k_vit_track_times[] = "vit_track_times";
-static const char __pyx_k_lookup_file_1det[] = "lookup_file_1det";
-static const char __pyx_k_lookup_file_2det[] = "lookup_file_2det";
 static const char __pyx_k_two_detector_run[] = "two_detector.run";
+static const char __pyx_k_lookup_table_1det[] = "lookup_table_1det";
+static const char __pyx_k_lookup_table_2det[] = "lookup_table_2det";
 static const char __pyx_k_pyx_unpickle_Enum[] = "__pyx_unpickle_Enum";
 static const char __pyx_k_soapcw_soapcw_pyx[] = "soapcw/soapcw.pyx";
 static const char __pyx_k_cline_in_traceback[] = "cline_in_traceback";
 static const char __pyx_k_strided_and_direct[] = "<strided and direct>";
 static const char __pyx_k_three_detector_run[] = "three_detector.run";
 static const char __pyx_k_two_detector_mem_n[] = "two_detector_mem_n";
 static const char __pyx_k_single_detector_run[] = "single_detector.run";
@@ -2723,15 +2743,14 @@
 static PyObject *__pyx_n_s_exp;
 static PyObject *__pyx_n_s_extend;
 static PyObject *__pyx_n_s_f1;
 static PyObject *__pyx_n_s_fact;
 static PyObject *__pyx_n_s_fact_1d;
 static PyObject *__pyx_n_s_fact_2d;
 static PyObject *__pyx_n_s_fact_frac;
-static PyObject *__pyx_n_s_filename;
 static PyObject *__pyx_n_s_find_path;
 static PyObject *__pyx_n_s_flags;
 static PyObject *__pyx_n_s_floor;
 static PyObject *__pyx_n_s_flush;
 static PyObject *__pyx_n_s_format;
 static PyObject *__pyx_n_s_fortran;
 static PyObject *__pyx_n_u_fortran;
@@ -2780,17 +2799,17 @@
 static PyObject *__pyx_n_s_load;
 static PyObject *__pyx_n_s_log;
 static PyObject *__pyx_n_s_logarr;
 static PyObject *__pyx_n_s_logarr1;
 static PyObject *__pyx_n_s_logarr_1d;
 static PyObject *__pyx_n_s_logarr_2d;
 static PyObject *__pyx_n_s_logsumexp;
-static PyObject *__pyx_n_s_lookup_file;
-static PyObject *__pyx_n_s_lookup_file_1det;
-static PyObject *__pyx_n_s_lookup_file_2det;
+static PyObject *__pyx_n_s_lookup_table;
+static PyObject *__pyx_n_s_lookup_table_1det;
+static PyObject *__pyx_n_s_lookup_table_2det;
 static PyObject *__pyx_n_s_low;
 static PyObject *__pyx_n_s_m;
 static PyObject *__pyx_n_s_main;
 static PyObject *__pyx_n_s_make_vitmap;
 static PyObject *__pyx_n_s_max;
 static PyObject *__pyx_n_s_max_end_prob;
 static PyObject *__pyx_n_s_max_paths;
@@ -2859,14 +2878,15 @@
 static PyObject *__pyx_n_s_pbar;
 static PyObject *__pyx_n_s_pickle;
 static PyObject *__pyx_n_s_pos1;
 static PyObject *__pyx_n_s_pos2;
 static PyObject *__pyx_n_s_pow_fact;
 static PyObject *__pyx_n_s_pow_ranges;
 static PyObject *__pyx_n_u_power_ranges;
+static PyObject *__pyx_n_s_powers;
 static PyObject *__pyx_n_s_prepare;
 static PyObject *__pyx_n_s_prev;
 static PyObject *__pyx_n_s_previous;
 static PyObject *__pyx_n_s_previous_1;
 static PyObject *__pyx_n_s_previous_2;
 static PyObject *__pyx_n_s_prod;
 static PyObject *__pyx_n_s_product;
@@ -2907,14 +2927,15 @@
 static PyObject *__pyx_n_s_sep_dist;
 static PyObject *__pyx_n_s_sep_len;
 static PyObject *__pyx_n_s_seq;
 static PyObject *__pyx_n_s_setstate;
 static PyObject *__pyx_n_s_setstate_cython;
 static PyObject *__pyx_n_s_shape;
 static PyObject *__pyx_n_s_shp;
+static PyObject *__pyx_n_s_signoiseline;
 static PyObject *__pyx_n_s_single_detector;
 static PyObject *__pyx_n_s_single_detector___init;
 static PyObject *__pyx_n_s_single_detector_gaps;
 static PyObject *__pyx_n_s_single_detector_gaps___init;
 static PyObject *__pyx_n_s_single_detector_gaps_find_path;
 static PyObject *__pyx_n_s_single_detector_gaps_gap_run;
 static PyObject *__pyx_n_s_single_detector_gaps_get_track;
@@ -3006,25 +3027,25 @@
 static PyObject *__pyx_n_s_vitstart;
 static PyObject *__pyx_n_s_vstack;
 static PyObject *__pyx_n_s_where;
 static PyObject *__pyx_n_s_width;
 static PyObject *__pyx_n_s_write;
 static PyObject *__pyx_n_s_x;
 static PyObject *__pyx_n_s_zeros;
-static PyObject *__pyx_pf_6soapcw_6soapcw_15single_detector___init__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_tr, PyObject *__pyx_v_obs, PyObject *__pyx_v_prog, PyObject *__pyx_v_lookup_file, PyObject *__pyx_v_make_vitmap); /* proto */
+static PyObject *__pyx_pf_6soapcw_6soapcw_15single_detector___init__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_tr, PyObject *__pyx_v_obs, PyObject *__pyx_v_prog, PyObject *__pyx_v_lookup_table, PyObject *__pyx_v_make_vitmap); /* proto */
 static PyObject *__pyx_pf_6soapcw_6soapcw_15single_detector_2get_vitmap(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_log); /* proto */
-static PyObject *__pyx_pf_6soapcw_6soapcw_15single_detector_4read_lookup(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_self, PyObject *__pyx_v_filename); /* proto */
+static PyObject *__pyx_pf_6soapcw_6soapcw_15single_detector_4read_lookup(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_self, PyObject *__pyx_v_lookup_table); /* proto */
 static PyObject *__pyx_pf_6soapcw_6soapcw_15single_detector_3run_genexpr(PyObject *__pyx_self); /* proto */
-static PyObject *__pyx_pf_6soapcw_6soapcw_15single_detector_6run(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, __Pyx_memviewslice __pyx_v_tr, __Pyx_memviewslice __pyx_v_obs, PyObject *__pyx_v_lookup_file); /* proto */
-static PyObject *__pyx_pf_6soapcw_6soapcw_12two_detector___init__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_tr, PyObject *__pyx_v_obs1, PyObject *__pyx_v_obs2, PyObject *__pyx_v_lookup_file_2det, PyObject *__pyx_v_lookup_file_1det, PyObject *__pyx_v_prog, PyObject *__pyx_v_fractions, PyObject *__pyx_v_make_vitmap); /* proto */
+static PyObject *__pyx_pf_6soapcw_6soapcw_15single_detector_6run(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, __Pyx_memviewslice __pyx_v_tr, __Pyx_memviewslice __pyx_v_obs, PyObject *__pyx_v_lookup_table); /* proto */
+static PyObject *__pyx_pf_6soapcw_6soapcw_12two_detector___init__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_tr, PyObject *__pyx_v_obs1, PyObject *__pyx_v_obs2, PyObject *__pyx_v_lookup_table_2det, PyObject *__pyx_v_lookup_table_1det, PyObject *__pyx_v_prog, PyObject *__pyx_v_fractions, PyObject *__pyx_v_make_vitmap); /* proto */
 static PyObject *__pyx_pf_6soapcw_6soapcw_12two_detector_2get_vitmap(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_log); /* proto */
-static PyObject *__pyx_pf_6soapcw_6soapcw_12two_detector_4read_lookup(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_self, PyObject *__pyx_v_filename); /* proto */
-static PyObject *__pyx_pf_6soapcw_6soapcw_12two_detector_6read_lookup_amp(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_self, PyObject *__pyx_v_filename); /* proto */
-static PyObject *__pyx_pf_6soapcw_6soapcw_12two_detector_8run(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_transition, PyObject *__pyx_v_obs1, PyObject *__pyx_v_obs2, PyObject *__pyx_v_lookup_file_1det, PyObject *__pyx_v_lookup_file_2det); /* proto */
-static PyObject *__pyx_pf_6soapcw_6soapcw_12two_detector_10run_lookup_amp(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_tr1, PyObject *__pyx_v_obs11, PyObject *__pyx_v_obs21, PyObject *__pyx_v_lookup_file, PyObject *__pyx_v_fractions); /* proto */
+static PyObject *__pyx_pf_6soapcw_6soapcw_12two_detector_4read_lookup(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_self, PyObject *__pyx_v_lookup_table); /* proto */
+static PyObject *__pyx_pf_6soapcw_6soapcw_12two_detector_6read_lookup_amp(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_self, PyObject *__pyx_v_lookup_table); /* proto */
+static PyObject *__pyx_pf_6soapcw_6soapcw_12two_detector_8run(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_transition, PyObject *__pyx_v_obs1, PyObject *__pyx_v_obs2, PyObject *__pyx_v_lookup_table_1det, PyObject *__pyx_v_lookup_table_2det); /* proto */
+static PyObject *__pyx_pf_6soapcw_6soapcw_12two_detector_10run_lookup_amp(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_tr1, PyObject *__pyx_v_obs11, PyObject *__pyx_v_obs21, PyObject *__pyx_v_lookup_table, PyObject *__pyx_v_fractions); /* proto */
 static PyObject *__pyx_pf_6soapcw_6soapcw_12two_detector_12get_track(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_6soapcw_6soapcw_14three_detector___init__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_tr, PyObject *__pyx_v_obs1, PyObject *__pyx_v_obs2, PyObject *__pyx_v_obs3, PyObject *__pyx_v_prog); /* proto */
 static PyObject *__pyx_pf_6soapcw_6soapcw_14three_detector_2run(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_tr1, PyObject *__pyx_v_obs11, PyObject *__pyx_v_obs21, PyObject *__pyx_v_obs31); /* proto */
 static PyObject *__pyx_pf_6soapcw_6soapcw_21single_detector_mem_n___init__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_tr, PyObject *__pyx_v_obs, PyObject *__pyx_v_prog); /* proto */
 static PyObject *__pyx_pf_6soapcw_6soapcw_21single_detector_mem_n_2run(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_tr, PyObject *__pyx_v_obs); /* proto */
 static PyObject *__pyx_pf_6soapcw_6soapcw_18two_detector_mem_n___init__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_tr, PyObject *__pyx_v_obs1, PyObject *__pyx_v_obs2, PyObject *__pyx_v_prog); /* proto */
 static PyObject *__pyx_pf_6soapcw_6soapcw_18two_detector_mem_n_2run(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_tr, PyObject *__pyx_v_obs11, PyObject *__pyx_v_obs22); /* proto */
@@ -3190,38 +3211,38 @@
 static PyObject *__pyx_codeobj__91;
 static PyObject *__pyx_codeobj__99;
 /* Late includes */
 
 /* "soapcw/soapcw.pyx":16
  * class single_detector(object):
  * 
- *     def __init__(self, tr, obs, prog = False, lookup_file=None, make_vitmap = True):             # <<<<<<<<<<<<<<
+ *     def __init__(self, tr, obs, prog = False, lookup_table=None, make_vitmap = True):             # <<<<<<<<<<<<<<
  *         '''
  *         initialising viterbi class
  */
 
 /* Python wrapper */
 static PyObject *__pyx_pw_6soapcw_6soapcw_15single_detector_1__init__(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
 static char __pyx_doc_6soapcw_6soapcw_15single_detector___init__[] = "\n        initialising viterbi class\n        ";
 static PyMethodDef __pyx_mdef_6soapcw_6soapcw_15single_detector_1__init__ = {"__init__", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6soapcw_6soapcw_15single_detector_1__init__, METH_VARARGS|METH_KEYWORDS, __pyx_doc_6soapcw_6soapcw_15single_detector___init__};
 static PyObject *__pyx_pw_6soapcw_6soapcw_15single_detector_1__init__(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyObject *__pyx_v_self = 0;
   PyObject *__pyx_v_tr = 0;
   PyObject *__pyx_v_obs = 0;
   PyObject *__pyx_v_prog = 0;
-  PyObject *__pyx_v_lookup_file = 0;
+  PyObject *__pyx_v_lookup_table = 0;
   PyObject *__pyx_v_make_vitmap = 0;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__init__ (wrapper)", 0);
   {
-    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_self,&__pyx_n_s_tr,&__pyx_n_s_obs,&__pyx_n_s_prog,&__pyx_n_s_lookup_file,&__pyx_n_s_make_vitmap,0};
+    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_self,&__pyx_n_s_tr,&__pyx_n_s_obs,&__pyx_n_s_prog,&__pyx_n_s_lookup_table,&__pyx_n_s_make_vitmap,0};
     PyObject* values[6] = {0,0,0,0,0,0};
     values[3] = ((PyObject *)((PyObject *)Py_False));
     values[4] = ((PyObject *)((PyObject *)Py_None));
     values[5] = ((PyObject *)((PyObject *)Py_True));
     if (unlikely(__pyx_kwds)) {
       Py_ssize_t kw_args;
       const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
@@ -3263,15 +3284,15 @@
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_prog);
           if (value) { values[3] = value; kw_args--; }
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (kw_args > 0) {
-          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_lookup_file);
+          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_lookup_table);
           if (value) { values[4] = value; kw_args--; }
         }
         CYTHON_FALLTHROUGH;
         case  5:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_make_vitmap);
           if (value) { values[5] = value; kw_args--; }
@@ -3295,33 +3316,33 @@
         default: goto __pyx_L5_argtuple_error;
       }
     }
     __pyx_v_self = values[0];
     __pyx_v_tr = values[1];
     __pyx_v_obs = values[2];
     __pyx_v_prog = values[3];
-    __pyx_v_lookup_file = values[4];
+    __pyx_v_lookup_table = values[4];
     __pyx_v_make_vitmap = values[5];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
   __Pyx_RaiseArgtupleInvalid("__init__", 0, 3, 6, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 16, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("soapcw.soapcw.single_detector.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_6soapcw_6soapcw_15single_detector___init__(__pyx_self, __pyx_v_self, __pyx_v_tr, __pyx_v_obs, __pyx_v_prog, __pyx_v_lookup_file, __pyx_v_make_vitmap);
+  __pyx_r = __pyx_pf_6soapcw_6soapcw_15single_detector___init__(__pyx_self, __pyx_v_self, __pyx_v_tr, __pyx_v_obs, __pyx_v_prog, __pyx_v_lookup_table, __pyx_v_make_vitmap);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_6soapcw_6soapcw_15single_detector___init__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_tr, PyObject *__pyx_v_obs, PyObject *__pyx_v_prog, PyObject *__pyx_v_lookup_file, PyObject *__pyx_v_make_vitmap) {
+static PyObject *__pyx_pf_6soapcw_6soapcw_15single_detector___init__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_tr, PyObject *__pyx_v_obs, PyObject *__pyx_v_prog, PyObject *__pyx_v_lookup_table, PyObject *__pyx_v_make_vitmap) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
   Py_ssize_t __pyx_t_5;
@@ -3526,15 +3547,15 @@
   if (unlikely(__pyx_t_6)) {
 
     /* "soapcw/soapcw.pyx":30
  *             raise Exception("transition matrix wrong shape, should be Kx1 array")
  *         if len(np.shape(obs)) != 2:
  *             raise Exception("observation wrong shape, should be NxM array")             # <<<<<<<<<<<<<<
  * 
- *         self.run(tr, obs, lookup_file)
+ *         self.run(tr, obs, lookup_table)
  */
     __pyx_t_1 = __Pyx_PyObject_Call(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])), __pyx_tuple__2, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 30, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __PYX_ERR(0, 30, __pyx_L1_error)
 
@@ -3546,15 +3567,15 @@
  * 
  */
   }
 
   /* "soapcw/soapcw.pyx":32
  *             raise Exception("observation wrong shape, should be NxM array")
  * 
- *         self.run(tr, obs, lookup_file)             # <<<<<<<<<<<<<<
+ *         self.run(tr, obs, lookup_table)             # <<<<<<<<<<<<<<
  *         if make_vitmap:
  *             self.get_vitmap()
  */
   __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_run); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 32, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __pyx_t_4 = NULL;
   __pyx_t_7 = 0;
@@ -3566,23 +3587,23 @@
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_3, function);
       __pyx_t_7 = 1;
     }
   }
   #if CYTHON_FAST_PYCALL
   if (PyFunction_Check(__pyx_t_3)) {
-    PyObject *__pyx_temp[4] = {__pyx_t_4, __pyx_v_tr, __pyx_v_obs, __pyx_v_lookup_file};
+    PyObject *__pyx_temp[4] = {__pyx_t_4, __pyx_v_tr, __pyx_v_obs, __pyx_v_lookup_table};
     __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_7, 3+__pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 32, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_GOTREF(__pyx_t_1);
   } else
   #endif
   #if CYTHON_FAST_PYCCALL
   if (__Pyx_PyFastCFunction_Check(__pyx_t_3)) {
-    PyObject *__pyx_temp[4] = {__pyx_t_4, __pyx_v_tr, __pyx_v_obs, __pyx_v_lookup_file};
+    PyObject *__pyx_temp[4] = {__pyx_t_4, __pyx_v_tr, __pyx_v_obs, __pyx_v_lookup_table};
     __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_7, 3+__pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 32, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_GOTREF(__pyx_t_1);
   } else
   #endif
   {
     __pyx_t_2 = PyTuple_New(3+__pyx_t_7); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 32, __pyx_L1_error)
@@ -3592,36 +3613,36 @@
     }
     __Pyx_INCREF(__pyx_v_tr);
     __Pyx_GIVEREF(__pyx_v_tr);
     PyTuple_SET_ITEM(__pyx_t_2, 0+__pyx_t_7, __pyx_v_tr);
     __Pyx_INCREF(__pyx_v_obs);
     __Pyx_GIVEREF(__pyx_v_obs);
     PyTuple_SET_ITEM(__pyx_t_2, 1+__pyx_t_7, __pyx_v_obs);
-    __Pyx_INCREF(__pyx_v_lookup_file);
-    __Pyx_GIVEREF(__pyx_v_lookup_file);
-    PyTuple_SET_ITEM(__pyx_t_2, 2+__pyx_t_7, __pyx_v_lookup_file);
+    __Pyx_INCREF(__pyx_v_lookup_table);
+    __Pyx_GIVEREF(__pyx_v_lookup_table);
+    PyTuple_SET_ITEM(__pyx_t_2, 2+__pyx_t_7, __pyx_v_lookup_table);
     __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_2, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 32, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   }
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
   /* "soapcw/soapcw.pyx":33
  * 
- *         self.run(tr, obs, lookup_file)
+ *         self.run(tr, obs, lookup_table)
  *         if make_vitmap:             # <<<<<<<<<<<<<<
  *             self.get_vitmap()
  * 
  */
   __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_v_make_vitmap); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 33, __pyx_L1_error)
   if (__pyx_t_6) {
 
     /* "soapcw/soapcw.pyx":34
- *         self.run(tr, obs, lookup_file)
+ *         self.run(tr, obs, lookup_table)
  *         if make_vitmap:
  *             self.get_vitmap()             # <<<<<<<<<<<<<<
  * 
  * 
  */
     __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_get_vitmap); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 34, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
@@ -3640,25 +3661,25 @@
     if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 34, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
     /* "soapcw/soapcw.pyx":33
  * 
- *         self.run(tr, obs, lookup_file)
+ *         self.run(tr, obs, lookup_table)
  *         if make_vitmap:             # <<<<<<<<<<<<<<
  *             self.get_vitmap()
  * 
  */
   }
 
   /* "soapcw/soapcw.pyx":16
  * class single_detector(object):
  * 
- *     def __init__(self, tr, obs, prog = False, lookup_file=None, make_vitmap = True):             # <<<<<<<<<<<<<<
+ *     def __init__(self, tr, obs, prog = False, lookup_table=None, make_vitmap = True):             # <<<<<<<<<<<<<<
  *         '''
  *         initialising viterbi class
  */
 
   /* function exit code */
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
@@ -4035,34 +4056,34 @@
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* "soapcw/soapcw.pyx":60
  *     #--------------------------
  * 
- *     def read_lookup(self,filename):             # <<<<<<<<<<<<<<
+ *     def read_lookup(self,lookup_table):             # <<<<<<<<<<<<<<
  *         """
  *         Read the lookup table for chosen statistic
  */
 
 /* Python wrapper */
 static PyObject *__pyx_pw_6soapcw_6soapcw_15single_detector_5read_lookup(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
 static char __pyx_doc_6soapcw_6soapcw_15single_detector_4read_lookup[] = "\n        Read the lookup table for chosen statistic\n        ";
 static PyMethodDef __pyx_mdef_6soapcw_6soapcw_15single_detector_5read_lookup = {"read_lookup", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6soapcw_6soapcw_15single_detector_5read_lookup, METH_VARARGS|METH_KEYWORDS, __pyx_doc_6soapcw_6soapcw_15single_detector_4read_lookup};
 static PyObject *__pyx_pw_6soapcw_6soapcw_15single_detector_5read_lookup(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   CYTHON_UNUSED PyObject *__pyx_v_self = 0;
-  PyObject *__pyx_v_filename = 0;
+  PyObject *__pyx_v_lookup_table = 0;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("read_lookup (wrapper)", 0);
   {
-    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_self,&__pyx_n_s_filename,0};
+    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_self,&__pyx_n_s_lookup_table,0};
     PyObject* values[2] = {0,0};
     if (unlikely(__pyx_kwds)) {
       Py_ssize_t kw_args;
       const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
       switch (pos_args) {
         case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
         CYTHON_FALLTHROUGH;
@@ -4074,439 +4095,532 @@
       kw_args = PyDict_Size(__pyx_kwds);
       switch (pos_args) {
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
-        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_filename)) != 0)) kw_args--;
+        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_lookup_table)) != 0)) kw_args--;
         else {
           __Pyx_RaiseArgtupleInvalid("read_lookup", 1, 2, 2, 1); __PYX_ERR(0, 60, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "read_lookup") < 0)) __PYX_ERR(0, 60, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
     }
     __pyx_v_self = values[0];
-    __pyx_v_filename = values[1];
+    __pyx_v_lookup_table = values[1];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
   __Pyx_RaiseArgtupleInvalid("read_lookup", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 60, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("soapcw.soapcw.single_detector.read_lookup", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_6soapcw_6soapcw_15single_detector_4read_lookup(__pyx_self, __pyx_v_self, __pyx_v_filename);
+  __pyx_r = __pyx_pf_6soapcw_6soapcw_15single_detector_4read_lookup(__pyx_self, __pyx_v_self, __pyx_v_lookup_table);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_6soapcw_6soapcw_15single_detector_4read_lookup(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_self, PyObject *__pyx_v_filename) {
+static PyObject *__pyx_pf_6soapcw_6soapcw_15single_detector_4read_lookup(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_self, PyObject *__pyx_v_lookup_table) {
   PyObject *__pyx_v_f1 = NULL;
   PyObject *__pyx_v_likelihood = NULL;
   PyObject *__pyx_v_params = NULL;
   PyObject *__pyx_v_ranges = NULL;
   PyObject *__pyx_v_fact = NULL;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
-  PyObject *__pyx_t_1 = NULL;
-  PyObject *__pyx_t_2 = NULL;
+  int __pyx_t_1;
+  int __pyx_t_2;
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
   PyObject *__pyx_t_6 = NULL;
   PyObject *__pyx_t_7 = NULL;
   PyObject *__pyx_t_8 = NULL;
-  PyObject *(*__pyx_t_9)(PyObject *);
+  PyObject *__pyx_t_9 = NULL;
   PyObject *__pyx_t_10 = NULL;
-  int __pyx_t_11;
-  int __pyx_t_12;
+  PyObject *(*__pyx_t_11)(PyObject *);
+  PyObject *__pyx_t_12 = NULL;
   PyObject *__pyx_t_13 = NULL;
   PyObject *__pyx_t_14 = NULL;
   int __pyx_t_15;
   PyObject *__pyx_t_16 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("read_lookup", 0);
 
   /* "soapcw/soapcw.pyx":64
  *         Read the lookup table for chosen statistic
  *         """
- *         with open(filename,'rb') as f1:             # <<<<<<<<<<<<<<
- *             likelihood, params = pickle.load(f1)
- *         ranges = np.linspace(params["power_ranges"][0],params["power_ranges"][1],int(params["power_ranges"][2]))
+ *         if isinstance(lookup_table, str):             # <<<<<<<<<<<<<<
+ *             with open(lookup_table,'rb') as f1:
+ *                 likelihood, params = pickle.load(f1)
  */
-  /*with:*/ {
-    __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 64, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_1);
-    __Pyx_INCREF(__pyx_v_filename);
-    __Pyx_GIVEREF(__pyx_v_filename);
-    PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_filename);
-    __Pyx_INCREF(__pyx_n_u_rb);
-    __Pyx_GIVEREF(__pyx_n_u_rb);
-    PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_n_u_rb);
-    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_open, __pyx_t_1, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 64, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_2);
-    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_3 = __Pyx_PyObject_LookupSpecial(__pyx_t_2, __pyx_n_s_exit); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 64, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_4 = __Pyx_PyObject_LookupSpecial(__pyx_t_2, __pyx_n_s_enter); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 64, __pyx_L3_error)
-    __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_5 = NULL;
-    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
-      __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
-      if (likely(__pyx_t_5)) {
-        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
-        __Pyx_INCREF(__pyx_t_5);
-        __Pyx_INCREF(function);
-        __Pyx_DECREF_SET(__pyx_t_4, function);
-      }
-    }
-    __pyx_t_1 = (__pyx_t_5) ? __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_5) : __Pyx_PyObject_CallNoArg(__pyx_t_4);
-    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
-    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 64, __pyx_L3_error)
-    __Pyx_GOTREF(__pyx_t_1);
-    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_t_4 = __pyx_t_1;
-    __pyx_t_1 = 0;
-    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    /*try:*/ {
-      {
-        __Pyx_PyThreadState_declare
-        __Pyx_PyThreadState_assign
-        __Pyx_ExceptionSave(&__pyx_t_6, &__pyx_t_7, &__pyx_t_8);
-        __Pyx_XGOTREF(__pyx_t_6);
-        __Pyx_XGOTREF(__pyx_t_7);
-        __Pyx_XGOTREF(__pyx_t_8);
-        /*try:*/ {
-          __pyx_v_f1 = __pyx_t_4;
-          __pyx_t_4 = 0;
+  __pyx_t_1 = PyUnicode_Check(__pyx_v_lookup_table); 
+  __pyx_t_2 = (__pyx_t_1 != 0);
+  if (__pyx_t_2) {
 
-          /* "soapcw/soapcw.pyx":65
+    /* "soapcw/soapcw.pyx":65
  *         """
- *         with open(filename,'rb') as f1:
- *             likelihood, params = pickle.load(f1)             # <<<<<<<<<<<<<<
- *         ranges = np.linspace(params["power_ranges"][0],params["power_ranges"][1],int(params["power_ranges"][2]))
- *         fact = abs(1./(ranges[0] - ranges[1]))
+ *         if isinstance(lookup_table, str):
+ *             with open(lookup_table,'rb') as f1:             # <<<<<<<<<<<<<<
+ *                 likelihood, params = pickle.load(f1)
+ *             ranges = np.linspace(params["power_ranges"][0],params["power_ranges"][1],int(params["power_ranges"][2]))
  */
-          __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_pickle); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 65, __pyx_L7_error)
-          __Pyx_GOTREF(__pyx_t_2);
-          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_load); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 65, __pyx_L7_error)
-          __Pyx_GOTREF(__pyx_t_1);
-          __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-          __pyx_t_2 = NULL;
-          if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_1))) {
-            __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_1);
-            if (likely(__pyx_t_2)) {
-              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
-              __Pyx_INCREF(__pyx_t_2);
-              __Pyx_INCREF(function);
-              __Pyx_DECREF_SET(__pyx_t_1, function);
-            }
-          }
-          __pyx_t_4 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_2, __pyx_v_f1) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_v_f1);
-          __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-          if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 65, __pyx_L7_error)
-          __Pyx_GOTREF(__pyx_t_4);
-          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-          if ((likely(PyTuple_CheckExact(__pyx_t_4))) || (PyList_CheckExact(__pyx_t_4))) {
-            PyObject* sequence = __pyx_t_4;
-            Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
-            if (unlikely(size != 2)) {
-              if (size > 2) __Pyx_RaiseTooManyValuesError(2);
-              else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
-              __PYX_ERR(0, 65, __pyx_L7_error)
+    /*with:*/ {
+      __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 65, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_3);
+      __Pyx_INCREF(__pyx_v_lookup_table);
+      __Pyx_GIVEREF(__pyx_v_lookup_table);
+      PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_lookup_table);
+      __Pyx_INCREF(__pyx_n_u_rb);
+      __Pyx_GIVEREF(__pyx_n_u_rb);
+      PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_n_u_rb);
+      __pyx_t_4 = __Pyx_PyObject_Call(__pyx_builtin_open, __pyx_t_3, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 65, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_4);
+      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+      __pyx_t_5 = __Pyx_PyObject_LookupSpecial(__pyx_t_4, __pyx_n_s_exit); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 65, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_5);
+      __pyx_t_6 = __Pyx_PyObject_LookupSpecial(__pyx_t_4, __pyx_n_s_enter); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 65, __pyx_L4_error)
+      __Pyx_GOTREF(__pyx_t_6);
+      __pyx_t_7 = NULL;
+      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_6))) {
+        __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_6);
+        if (likely(__pyx_t_7)) {
+          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
+          __Pyx_INCREF(__pyx_t_7);
+          __Pyx_INCREF(function);
+          __Pyx_DECREF_SET(__pyx_t_6, function);
+        }
+      }
+      __pyx_t_3 = (__pyx_t_7) ? __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_t_7) : __Pyx_PyObject_CallNoArg(__pyx_t_6);
+      __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
+      if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 65, __pyx_L4_error)
+      __Pyx_GOTREF(__pyx_t_3);
+      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
+      __pyx_t_6 = __pyx_t_3;
+      __pyx_t_3 = 0;
+      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+      /*try:*/ {
+        {
+          __Pyx_PyThreadState_declare
+          __Pyx_PyThreadState_assign
+          __Pyx_ExceptionSave(&__pyx_t_8, &__pyx_t_9, &__pyx_t_10);
+          __Pyx_XGOTREF(__pyx_t_8);
+          __Pyx_XGOTREF(__pyx_t_9);
+          __Pyx_XGOTREF(__pyx_t_10);
+          /*try:*/ {
+            __pyx_v_f1 = __pyx_t_6;
+            __pyx_t_6 = 0;
+
+            /* "soapcw/soapcw.pyx":66
+ *         if isinstance(lookup_table, str):
+ *             with open(lookup_table,'rb') as f1:
+ *                 likelihood, params = pickle.load(f1)             # <<<<<<<<<<<<<<
+ *             ranges = np.linspace(params["power_ranges"][0],params["power_ranges"][1],int(params["power_ranges"][2]))
+ *             fact = abs(1./(ranges[0] - ranges[1]))
+ */
+            __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_pickle); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 66, __pyx_L8_error)
+            __Pyx_GOTREF(__pyx_t_4);
+            __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_load); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 66, __pyx_L8_error)
+            __Pyx_GOTREF(__pyx_t_3);
+            __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+            __pyx_t_4 = NULL;
+            if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
+              __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
+              if (likely(__pyx_t_4)) {
+                PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
+                __Pyx_INCREF(__pyx_t_4);
+                __Pyx_INCREF(function);
+                __Pyx_DECREF_SET(__pyx_t_3, function);
+              }
             }
-            #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-            if (likely(PyTuple_CheckExact(sequence))) {
-              __pyx_t_1 = PyTuple_GET_ITEM(sequence, 0); 
-              __pyx_t_2 = PyTuple_GET_ITEM(sequence, 1); 
+            __pyx_t_6 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_v_f1) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_f1);
+            __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
+            if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 66, __pyx_L8_error)
+            __Pyx_GOTREF(__pyx_t_6);
+            __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+            if ((likely(PyTuple_CheckExact(__pyx_t_6))) || (PyList_CheckExact(__pyx_t_6))) {
+              PyObject* sequence = __pyx_t_6;
+              Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
+              if (unlikely(size != 2)) {
+                if (size > 2) __Pyx_RaiseTooManyValuesError(2);
+                else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
+                __PYX_ERR(0, 66, __pyx_L8_error)
+              }
+              #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
+              if (likely(PyTuple_CheckExact(sequence))) {
+                __pyx_t_3 = PyTuple_GET_ITEM(sequence, 0); 
+                __pyx_t_4 = PyTuple_GET_ITEM(sequence, 1); 
+              } else {
+                __pyx_t_3 = PyList_GET_ITEM(sequence, 0); 
+                __pyx_t_4 = PyList_GET_ITEM(sequence, 1); 
+              }
+              __Pyx_INCREF(__pyx_t_3);
+              __Pyx_INCREF(__pyx_t_4);
+              #else
+              __pyx_t_3 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 66, __pyx_L8_error)
+              __Pyx_GOTREF(__pyx_t_3);
+              __pyx_t_4 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 66, __pyx_L8_error)
+              __Pyx_GOTREF(__pyx_t_4);
+              #endif
+              __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
             } else {
-              __pyx_t_1 = PyList_GET_ITEM(sequence, 0); 
-              __pyx_t_2 = PyList_GET_ITEM(sequence, 1); 
+              Py_ssize_t index = -1;
+              __pyx_t_7 = PyObject_GetIter(__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 66, __pyx_L8_error)
+              __Pyx_GOTREF(__pyx_t_7);
+              __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
+              __pyx_t_11 = Py_TYPE(__pyx_t_7)->tp_iternext;
+              index = 0; __pyx_t_3 = __pyx_t_11(__pyx_t_7); if (unlikely(!__pyx_t_3)) goto __pyx_L14_unpacking_failed;
+              __Pyx_GOTREF(__pyx_t_3);
+              index = 1; __pyx_t_4 = __pyx_t_11(__pyx_t_7); if (unlikely(!__pyx_t_4)) goto __pyx_L14_unpacking_failed;
+              __Pyx_GOTREF(__pyx_t_4);
+              if (__Pyx_IternextUnpackEndCheck(__pyx_t_11(__pyx_t_7), 2) < 0) __PYX_ERR(0, 66, __pyx_L8_error)
+              __pyx_t_11 = NULL;
+              __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
+              goto __pyx_L15_unpacking_done;
+              __pyx_L14_unpacking_failed:;
+              __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
+              __pyx_t_11 = NULL;
+              if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
+              __PYX_ERR(0, 66, __pyx_L8_error)
+              __pyx_L15_unpacking_done:;
             }
-            __Pyx_INCREF(__pyx_t_1);
-            __Pyx_INCREF(__pyx_t_2);
-            #else
-            __pyx_t_1 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 65, __pyx_L7_error)
-            __Pyx_GOTREF(__pyx_t_1);
-            __pyx_t_2 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 65, __pyx_L7_error)
-            __Pyx_GOTREF(__pyx_t_2);
-            #endif
-            __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-          } else {
-            Py_ssize_t index = -1;
-            __pyx_t_5 = PyObject_GetIter(__pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 65, __pyx_L7_error)
-            __Pyx_GOTREF(__pyx_t_5);
-            __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-            __pyx_t_9 = Py_TYPE(__pyx_t_5)->tp_iternext;
-            index = 0; __pyx_t_1 = __pyx_t_9(__pyx_t_5); if (unlikely(!__pyx_t_1)) goto __pyx_L13_unpacking_failed;
-            __Pyx_GOTREF(__pyx_t_1);
-            index = 1; __pyx_t_2 = __pyx_t_9(__pyx_t_5); if (unlikely(!__pyx_t_2)) goto __pyx_L13_unpacking_failed;
-            __Pyx_GOTREF(__pyx_t_2);
-            if (__Pyx_IternextUnpackEndCheck(__pyx_t_9(__pyx_t_5), 2) < 0) __PYX_ERR(0, 65, __pyx_L7_error)
-            __pyx_t_9 = NULL;
-            __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-            goto __pyx_L14_unpacking_done;
-            __pyx_L13_unpacking_failed:;
-            __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-            __pyx_t_9 = NULL;
-            if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
-            __PYX_ERR(0, 65, __pyx_L7_error)
-            __pyx_L14_unpacking_done:;
-          }
-          __pyx_v_likelihood = __pyx_t_1;
-          __pyx_t_1 = 0;
-          __pyx_v_params = __pyx_t_2;
-          __pyx_t_2 = 0;
+            __pyx_v_likelihood = __pyx_t_3;
+            __pyx_t_3 = 0;
+            __pyx_v_params = __pyx_t_4;
+            __pyx_t_4 = 0;
 
-          /* "soapcw/soapcw.pyx":64
- *         Read the lookup table for chosen statistic
+            /* "soapcw/soapcw.pyx":65
  *         """
- *         with open(filename,'rb') as f1:             # <<<<<<<<<<<<<<
- *             likelihood, params = pickle.load(f1)
- *         ranges = np.linspace(params["power_ranges"][0],params["power_ranges"][1],int(params["power_ranges"][2]))
+ *         if isinstance(lookup_table, str):
+ *             with open(lookup_table,'rb') as f1:             # <<<<<<<<<<<<<<
+ *                 likelihood, params = pickle.load(f1)
+ *             ranges = np.linspace(params["power_ranges"][0],params["power_ranges"][1],int(params["power_ranges"][2]))
  */
-        }
-        __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
-        __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
-        __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
-        goto __pyx_L12_try_end;
-        __pyx_L7_error:;
-        __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
-        __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-        __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
-        /*except:*/ {
-          __Pyx_AddTraceback("soapcw.soapcw.single_detector.read_lookup", __pyx_clineno, __pyx_lineno, __pyx_filename);
-          if (__Pyx_GetException(&__pyx_t_4, &__pyx_t_2, &__pyx_t_1) < 0) __PYX_ERR(0, 64, __pyx_L9_except_error)
-          __Pyx_GOTREF(__pyx_t_4);
-          __Pyx_GOTREF(__pyx_t_2);
-          __Pyx_GOTREF(__pyx_t_1);
-          __pyx_t_5 = PyTuple_Pack(3, __pyx_t_4, __pyx_t_2, __pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 64, __pyx_L9_except_error)
-          __Pyx_GOTREF(__pyx_t_5);
-          __pyx_t_10 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_5, NULL);
-          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-          if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 64, __pyx_L9_except_error)
-          __Pyx_GOTREF(__pyx_t_10);
-          __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_t_10);
-          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-          if (__pyx_t_11 < 0) __PYX_ERR(0, 64, __pyx_L9_except_error)
-          __pyx_t_12 = ((!(__pyx_t_11 != 0)) != 0);
-          if (__pyx_t_12) {
-            __Pyx_GIVEREF(__pyx_t_4);
-            __Pyx_GIVEREF(__pyx_t_2);
-            __Pyx_XGIVEREF(__pyx_t_1);
-            __Pyx_ErrRestoreWithState(__pyx_t_4, __pyx_t_2, __pyx_t_1);
-            __pyx_t_4 = 0; __pyx_t_2 = 0; __pyx_t_1 = 0; 
-            __PYX_ERR(0, 64, __pyx_L9_except_error)
           }
+          __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
+          __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
+          __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
+          goto __pyx_L13_try_end;
+          __pyx_L8_error:;
+          __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
           __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-          __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-          __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
-          goto __pyx_L8_exception_handled;
+          __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
+          __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
+          /*except:*/ {
+            __Pyx_AddTraceback("soapcw.soapcw.single_detector.read_lookup", __pyx_clineno, __pyx_lineno, __pyx_filename);
+            if (__Pyx_GetException(&__pyx_t_6, &__pyx_t_4, &__pyx_t_3) < 0) __PYX_ERR(0, 65, __pyx_L10_except_error)
+            __Pyx_GOTREF(__pyx_t_6);
+            __Pyx_GOTREF(__pyx_t_4);
+            __Pyx_GOTREF(__pyx_t_3);
+            __pyx_t_7 = PyTuple_Pack(3, __pyx_t_6, __pyx_t_4, __pyx_t_3); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 65, __pyx_L10_except_error)
+            __Pyx_GOTREF(__pyx_t_7);
+            __pyx_t_12 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_7, NULL);
+            __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+            __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
+            if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 65, __pyx_L10_except_error)
+            __Pyx_GOTREF(__pyx_t_12);
+            __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_12);
+            __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
+            if (__pyx_t_2 < 0) __PYX_ERR(0, 65, __pyx_L10_except_error)
+            __pyx_t_1 = ((!(__pyx_t_2 != 0)) != 0);
+            if (__pyx_t_1) {
+              __Pyx_GIVEREF(__pyx_t_6);
+              __Pyx_GIVEREF(__pyx_t_4);
+              __Pyx_XGIVEREF(__pyx_t_3);
+              __Pyx_ErrRestoreWithState(__pyx_t_6, __pyx_t_4, __pyx_t_3);
+              __pyx_t_6 = 0; __pyx_t_4 = 0; __pyx_t_3 = 0; 
+              __PYX_ERR(0, 65, __pyx_L10_except_error)
+            }
+            __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
+            __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
+            __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
+            goto __pyx_L9_exception_handled;
+          }
+          __pyx_L10_except_error:;
+          __Pyx_XGIVEREF(__pyx_t_8);
+          __Pyx_XGIVEREF(__pyx_t_9);
+          __Pyx_XGIVEREF(__pyx_t_10);
+          __Pyx_ExceptionReset(__pyx_t_8, __pyx_t_9, __pyx_t_10);
+          goto __pyx_L1_error;
+          __pyx_L9_exception_handled:;
+          __Pyx_XGIVEREF(__pyx_t_8);
+          __Pyx_XGIVEREF(__pyx_t_9);
+          __Pyx_XGIVEREF(__pyx_t_10);
+          __Pyx_ExceptionReset(__pyx_t_8, __pyx_t_9, __pyx_t_10);
+          __pyx_L13_try_end:;
         }
-        __pyx_L9_except_error:;
-        __Pyx_XGIVEREF(__pyx_t_6);
-        __Pyx_XGIVEREF(__pyx_t_7);
-        __Pyx_XGIVEREF(__pyx_t_8);
-        __Pyx_ExceptionReset(__pyx_t_6, __pyx_t_7, __pyx_t_8);
-        goto __pyx_L1_error;
-        __pyx_L8_exception_handled:;
-        __Pyx_XGIVEREF(__pyx_t_6);
-        __Pyx_XGIVEREF(__pyx_t_7);
-        __Pyx_XGIVEREF(__pyx_t_8);
-        __Pyx_ExceptionReset(__pyx_t_6, __pyx_t_7, __pyx_t_8);
-        __pyx_L12_try_end:;
       }
-    }
-    /*finally:*/ {
-      /*normal exit:*/{
-        if (__pyx_t_3) {
-          __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_tuple__3, NULL);
-          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-          if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 64, __pyx_L1_error)
-          __Pyx_GOTREF(__pyx_t_8);
-          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
+      /*finally:*/ {
+        /*normal exit:*/{
+          if (__pyx_t_5) {
+            __pyx_t_10 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_tuple__3, NULL);
+            __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+            if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 65, __pyx_L1_error)
+            __Pyx_GOTREF(__pyx_t_10);
+            __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
+          }
+          goto __pyx_L7;
         }
-        goto __pyx_L6;
+        __pyx_L7:;
       }
-      __pyx_L6:;
+      goto __pyx_L19;
+      __pyx_L4_error:;
+      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+      goto __pyx_L1_error;
+      __pyx_L19:;
     }
-    goto __pyx_L18;
-    __pyx_L3_error:;
-    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    goto __pyx_L1_error;
-    __pyx_L18:;
-  }
 
-  /* "soapcw/soapcw.pyx":66
- *         with open(filename,'rb') as f1:
- *             likelihood, params = pickle.load(f1)
- *         ranges = np.linspace(params["power_ranges"][0],params["power_ranges"][1],int(params["power_ranges"][2]))             # <<<<<<<<<<<<<<
- *         fact = abs(1./(ranges[0] - ranges[1]))
- * 
+    /* "soapcw/soapcw.pyx":67
+ *             with open(lookup_table,'rb') as f1:
+ *                 likelihood, params = pickle.load(f1)
+ *             ranges = np.linspace(params["power_ranges"][0],params["power_ranges"][1],int(params["power_ranges"][2]))             # <<<<<<<<<<<<<<
+ *             fact = abs(1./(ranges[0] - ranges[1]))
+ *         else:
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 66, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_linspace); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 66, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_4);
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (unlikely(!__pyx_v_params)) { __Pyx_RaiseUnboundLocalError("params"); __PYX_ERR(0, 66, __pyx_L1_error) }
-  __pyx_t_2 = __Pyx_PyObject_Dict_GetItem(__pyx_v_params, __pyx_n_u_power_ranges); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 66, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_2, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 66, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (unlikely(!__pyx_v_params)) { __Pyx_RaiseUnboundLocalError("params"); __PYX_ERR(0, 66, __pyx_L1_error) }
-  __pyx_t_2 = __Pyx_PyObject_Dict_GetItem(__pyx_v_params, __pyx_n_u_power_ranges); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 66, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_13 = __Pyx_GetItemInt(__pyx_t_2, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 66, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_13);
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (unlikely(!__pyx_v_params)) { __Pyx_RaiseUnboundLocalError("params"); __PYX_ERR(0, 66, __pyx_L1_error) }
-  __pyx_t_2 = __Pyx_PyObject_Dict_GetItem(__pyx_v_params, __pyx_n_u_power_ranges); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 66, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_14 = __Pyx_GetItemInt(__pyx_t_2, 2, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 66, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_14);
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyNumber_Int(__pyx_t_14); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 66, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
-  __pyx_t_14 = NULL;
-  __pyx_t_15 = 0;
-  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
-    __pyx_t_14 = PyMethod_GET_SELF(__pyx_t_4);
-    if (likely(__pyx_t_14)) {
-      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
-      __Pyx_INCREF(__pyx_t_14);
-      __Pyx_INCREF(function);
-      __Pyx_DECREF_SET(__pyx_t_4, function);
-      __pyx_t_15 = 1;
+    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 67, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_linspace); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 67, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_6);
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    if (unlikely(!__pyx_v_params)) { __Pyx_RaiseUnboundLocalError("params"); __PYX_ERR(0, 67, __pyx_L1_error) }
+    __pyx_t_4 = __Pyx_PyObject_Dict_GetItem(__pyx_v_params, __pyx_n_u_power_ranges); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 67, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __pyx_t_7 = __Pyx_GetItemInt(__pyx_t_4, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 67, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_7);
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    if (unlikely(!__pyx_v_params)) { __Pyx_RaiseUnboundLocalError("params"); __PYX_ERR(0, 67, __pyx_L1_error) }
+    __pyx_t_4 = __Pyx_PyObject_Dict_GetItem(__pyx_v_params, __pyx_n_u_power_ranges); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 67, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __pyx_t_13 = __Pyx_GetItemInt(__pyx_t_4, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 67, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_13);
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    if (unlikely(!__pyx_v_params)) { __Pyx_RaiseUnboundLocalError("params"); __PYX_ERR(0, 67, __pyx_L1_error) }
+    __pyx_t_4 = __Pyx_PyObject_Dict_GetItem(__pyx_v_params, __pyx_n_u_power_ranges); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 67, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __pyx_t_14 = __Pyx_GetItemInt(__pyx_t_4, 2, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 67, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_14);
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    __pyx_t_4 = __Pyx_PyNumber_Int(__pyx_t_14); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 67, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
+    __pyx_t_14 = NULL;
+    __pyx_t_15 = 0;
+    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_6))) {
+      __pyx_t_14 = PyMethod_GET_SELF(__pyx_t_6);
+      if (likely(__pyx_t_14)) {
+        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
+        __Pyx_INCREF(__pyx_t_14);
+        __Pyx_INCREF(function);
+        __Pyx_DECREF_SET(__pyx_t_6, function);
+        __pyx_t_15 = 1;
+      }
     }
-  }
-  #if CYTHON_FAST_PYCALL
-  if (PyFunction_Check(__pyx_t_4)) {
-    PyObject *__pyx_temp[4] = {__pyx_t_14, __pyx_t_5, __pyx_t_13, __pyx_t_2};
-    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_15, 3+__pyx_t_15); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 66, __pyx_L1_error)
-    __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
-    __Pyx_GOTREF(__pyx_t_1);
-    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  } else
-  #endif
-  #if CYTHON_FAST_PYCCALL
-  if (__Pyx_PyFastCFunction_Check(__pyx_t_4)) {
-    PyObject *__pyx_temp[4] = {__pyx_t_14, __pyx_t_5, __pyx_t_13, __pyx_t_2};
-    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_15, 3+__pyx_t_15); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 66, __pyx_L1_error)
-    __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
-    __Pyx_GOTREF(__pyx_t_1);
-    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  } else
-  #endif
-  {
-    __pyx_t_16 = PyTuple_New(3+__pyx_t_15); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 66, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_16);
-    if (__pyx_t_14) {
-      __Pyx_GIVEREF(__pyx_t_14); PyTuple_SET_ITEM(__pyx_t_16, 0, __pyx_t_14); __pyx_t_14 = NULL;
+    #if CYTHON_FAST_PYCALL
+    if (PyFunction_Check(__pyx_t_6)) {
+      PyObject *__pyx_temp[4] = {__pyx_t_14, __pyx_t_7, __pyx_t_13, __pyx_t_4};
+      __pyx_t_3 = __Pyx_PyFunction_FastCall(__pyx_t_6, __pyx_temp+1-__pyx_t_15, 3+__pyx_t_15); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 67, __pyx_L1_error)
+      __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
+      __Pyx_GOTREF(__pyx_t_3);
+      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
+      __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
+      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    } else
+    #endif
+    #if CYTHON_FAST_PYCCALL
+    if (__Pyx_PyFastCFunction_Check(__pyx_t_6)) {
+      PyObject *__pyx_temp[4] = {__pyx_t_14, __pyx_t_7, __pyx_t_13, __pyx_t_4};
+      __pyx_t_3 = __Pyx_PyCFunction_FastCall(__pyx_t_6, __pyx_temp+1-__pyx_t_15, 3+__pyx_t_15); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 67, __pyx_L1_error)
+      __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
+      __Pyx_GOTREF(__pyx_t_3);
+      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
+      __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
+      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    } else
+    #endif
+    {
+      __pyx_t_16 = PyTuple_New(3+__pyx_t_15); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 67, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_16);
+      if (__pyx_t_14) {
+        __Pyx_GIVEREF(__pyx_t_14); PyTuple_SET_ITEM(__pyx_t_16, 0, __pyx_t_14); __pyx_t_14 = NULL;
+      }
+      __Pyx_GIVEREF(__pyx_t_7);
+      PyTuple_SET_ITEM(__pyx_t_16, 0+__pyx_t_15, __pyx_t_7);
+      __Pyx_GIVEREF(__pyx_t_13);
+      PyTuple_SET_ITEM(__pyx_t_16, 1+__pyx_t_15, __pyx_t_13);
+      __Pyx_GIVEREF(__pyx_t_4);
+      PyTuple_SET_ITEM(__pyx_t_16, 2+__pyx_t_15, __pyx_t_4);
+      __pyx_t_7 = 0;
+      __pyx_t_13 = 0;
+      __pyx_t_4 = 0;
+      __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_16, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 67, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_3);
+      __Pyx_DECREF(__pyx_t_16); __pyx_t_16 = 0;
     }
-    __Pyx_GIVEREF(__pyx_t_5);
-    PyTuple_SET_ITEM(__pyx_t_16, 0+__pyx_t_15, __pyx_t_5);
-    __Pyx_GIVEREF(__pyx_t_13);
-    PyTuple_SET_ITEM(__pyx_t_16, 1+__pyx_t_15, __pyx_t_13);
-    __Pyx_GIVEREF(__pyx_t_2);
-    PyTuple_SET_ITEM(__pyx_t_16, 2+__pyx_t_15, __pyx_t_2);
-    __pyx_t_5 = 0;
-    __pyx_t_13 = 0;
-    __pyx_t_2 = 0;
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_16, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 66, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_1);
+    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
+    __pyx_v_ranges = __pyx_t_3;
+    __pyx_t_3 = 0;
+
+    /* "soapcw/soapcw.pyx":68
+ *                 likelihood, params = pickle.load(f1)
+ *             ranges = np.linspace(params["power_ranges"][0],params["power_ranges"][1],int(params["power_ranges"][2]))
+ *             fact = abs(1./(ranges[0] - ranges[1]))             # <<<<<<<<<<<<<<
+ *         else:
+ *             # if it is a line aware stat object then creat ranges from the object
+ */
+    __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_ranges, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 68, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_3);
+    __pyx_t_6 = __Pyx_GetItemInt(__pyx_v_ranges, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 68, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_6);
+    __pyx_t_16 = PyNumber_Subtract(__pyx_t_3, __pyx_t_6); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 68, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_16);
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
+    __pyx_t_6 = __Pyx_PyFloat_TrueDivideCObj(__pyx_float_1_, __pyx_t_16, 1., 0, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 68, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_16); __pyx_t_16 = 0;
+    __pyx_t_16 = __Pyx_PyNumber_Absolute(__pyx_t_6); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 68, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_16);
+    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
+    __pyx_v_fact = __pyx_t_16;
+    __pyx_t_16 = 0;
+
+    /* "soapcw/soapcw.pyx":64
+ *         Read the lookup table for chosen statistic
+ *         """
+ *         if isinstance(lookup_table, str):             # <<<<<<<<<<<<<<
+ *             with open(lookup_table,'rb') as f1:
+ *                 likelihood, params = pickle.load(f1)
+ */
+    goto __pyx_L3;
   }
-  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_v_ranges = __pyx_t_1;
-  __pyx_t_1 = 0;
 
-  /* "soapcw/soapcw.pyx":67
- *             likelihood, params = pickle.load(f1)
- *         ranges = np.linspace(params["power_ranges"][0],params["power_ranges"][1],int(params["power_ranges"][2]))
- *         fact = abs(1./(ranges[0] - ranges[1]))             # <<<<<<<<<<<<<<
+  /* "soapcw/soapcw.pyx":72
+ *             # if it is a line aware stat object then creat ranges from the object
+ *             # get the log odds ratio as the statitsic to use
+ *             likelihood = np.log(lookup_table.signoiseline)             # <<<<<<<<<<<<<<
+ *             ranges = lookup_table.powers
+ *             fact = abs(1./(ranges[0] - ranges[1]))
+ */
+  /*else*/ {
+    __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 72, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_6);
+    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_log); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 72, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_3);
+    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
+    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_lookup_table, __pyx_n_s_signoiseline); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 72, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_6);
+    __pyx_t_4 = NULL;
+    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
+      __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
+      if (likely(__pyx_t_4)) {
+        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
+        __Pyx_INCREF(__pyx_t_4);
+        __Pyx_INCREF(function);
+        __Pyx_DECREF_SET(__pyx_t_3, function);
+      }
+    }
+    __pyx_t_16 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_t_6) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_6);
+    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
+    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
+    if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 72, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_16);
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    __pyx_v_likelihood = __pyx_t_16;
+    __pyx_t_16 = 0;
+
+    /* "soapcw/soapcw.pyx":73
+ *             # get the log odds ratio as the statitsic to use
+ *             likelihood = np.log(lookup_table.signoiseline)
+ *             ranges = lookup_table.powers             # <<<<<<<<<<<<<<
+ *             fact = abs(1./(ranges[0] - ranges[1]))
+ * 
+ */
+    __pyx_t_16 = __Pyx_PyObject_GetAttrStr(__pyx_v_lookup_table, __pyx_n_s_powers); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 73, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_16);
+    __pyx_v_ranges = __pyx_t_16;
+    __pyx_t_16 = 0;
+
+    /* "soapcw/soapcw.pyx":74
+ *             likelihood = np.log(lookup_table.signoiseline)
+ *             ranges = lookup_table.powers
+ *             fact = abs(1./(ranges[0] - ranges[1]))             # <<<<<<<<<<<<<<
  * 
  *         return likelihood, ranges, fact
  */
-  __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_ranges, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 67, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = __Pyx_GetItemInt(__pyx_v_ranges, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 67, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_16 = PyNumber_Subtract(__pyx_t_1, __pyx_t_4); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 67, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_16);
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyFloat_TrueDivideCObj(__pyx_float_1_, __pyx_t_16, 1., 0, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 67, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_4);
-  __Pyx_DECREF(__pyx_t_16); __pyx_t_16 = 0;
-  __pyx_t_16 = __Pyx_PyNumber_Absolute(__pyx_t_4); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 67, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_16);
-  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_v_fact = __pyx_t_16;
-  __pyx_t_16 = 0;
+    __pyx_t_16 = __Pyx_GetItemInt(__pyx_v_ranges, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 74, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_16);
+    __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_ranges, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 74, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_3);
+    __pyx_t_6 = PyNumber_Subtract(__pyx_t_16, __pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 74, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_6);
+    __Pyx_DECREF(__pyx_t_16); __pyx_t_16 = 0;
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    __pyx_t_3 = __Pyx_PyFloat_TrueDivideCObj(__pyx_float_1_, __pyx_t_6, 1., 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 74, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_3);
+    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
+    __pyx_t_6 = __Pyx_PyNumber_Absolute(__pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 74, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_6);
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    __pyx_v_fact = __pyx_t_6;
+    __pyx_t_6 = 0;
+  }
+  __pyx_L3:;
 
-  /* "soapcw/soapcw.pyx":69
- *         fact = abs(1./(ranges[0] - ranges[1]))
+  /* "soapcw/soapcw.pyx":76
+ *             fact = abs(1./(ranges[0] - ranges[1]))
  * 
  *         return likelihood, ranges, fact             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(__pyx_r);
-  if (unlikely(!__pyx_v_likelihood)) { __Pyx_RaiseUnboundLocalError("likelihood"); __PYX_ERR(0, 69, __pyx_L1_error) }
-  __pyx_t_16 = PyTuple_New(3); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 69, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_16);
+  if (unlikely(!__pyx_v_likelihood)) { __Pyx_RaiseUnboundLocalError("likelihood"); __PYX_ERR(0, 76, __pyx_L1_error) }
+  __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 76, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_6);
   __Pyx_INCREF(__pyx_v_likelihood);
   __Pyx_GIVEREF(__pyx_v_likelihood);
-  PyTuple_SET_ITEM(__pyx_t_16, 0, __pyx_v_likelihood);
+  PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_v_likelihood);
   __Pyx_INCREF(__pyx_v_ranges);
   __Pyx_GIVEREF(__pyx_v_ranges);
-  PyTuple_SET_ITEM(__pyx_t_16, 1, __pyx_v_ranges);
+  PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_v_ranges);
   __Pyx_INCREF(__pyx_v_fact);
   __Pyx_GIVEREF(__pyx_v_fact);
-  PyTuple_SET_ITEM(__pyx_t_16, 2, __pyx_v_fact);
-  __pyx_r = __pyx_t_16;
-  __pyx_t_16 = 0;
+  PyTuple_SET_ITEM(__pyx_t_6, 2, __pyx_v_fact);
+  __pyx_r = __pyx_t_6;
+  __pyx_t_6 = 0;
   goto __pyx_L0;
 
   /* "soapcw/soapcw.pyx":60
  *     #--------------------------
  * 
- *     def read_lookup(self,filename):             # <<<<<<<<<<<<<<
+ *     def read_lookup(self,lookup_table):             # <<<<<<<<<<<<<<
  *         """
  *         Read the lookup table for chosen statistic
  */
 
   /* function exit code */
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_XDECREF(__pyx_t_3);
   __Pyx_XDECREF(__pyx_t_4);
-  __Pyx_XDECREF(__pyx_t_5);
+  __Pyx_XDECREF(__pyx_t_6);
+  __Pyx_XDECREF(__pyx_t_7);
   __Pyx_XDECREF(__pyx_t_13);
   __Pyx_XDECREF(__pyx_t_14);
   __Pyx_XDECREF(__pyx_t_16);
   __Pyx_AddTraceback("soapcw.soapcw.single_detector.read_lookup", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XDECREF(__pyx_v_f1);
@@ -4515,39 +4629,39 @@
   __Pyx_XDECREF(__pyx_v_ranges);
   __Pyx_XDECREF(__pyx_v_fact);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "soapcw/soapcw.pyx":77
+/* "soapcw/soapcw.pyx":84
  * 
  * 
- *     def run(self,double[:] tr, double[:, :] obs, lookup_file = None):             # <<<<<<<<<<<<<<
+ *     def run(self,double[:] tr, double[:, :] obs, lookup_table = None):             # <<<<<<<<<<<<<<
  *         '''
  *         Run the viterbi algorithm for given single set of data and 3x1 transition matrix.
  */
 
 /* Python wrapper */
 static PyObject *__pyx_pw_6soapcw_6soapcw_15single_detector_7run(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
 static char __pyx_doc_6soapcw_6soapcw_15single_detector_6run[] = "\n        Run the viterbi algorithm for given single set of data and 3x1 transition matrix.\n        This returns the track through the data which gives the largest sum of power.\n        Args\n        ------\n        tr: array\n            transition matrix of sixe Kx1\n        obs: array\n            observation data of size NxM\n        Returns\n        -------\n        vit_track: array\n            index of the viterbi path found in data\n        max_end_prob: float\n            maximum probability at end of path\n        V: array\n           viterbi matrix\n        prev: array\n            previous positions of paths for each bin\n        ";
 static PyMethodDef __pyx_mdef_6soapcw_6soapcw_15single_detector_7run = {"run", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6soapcw_6soapcw_15single_detector_7run, METH_VARARGS|METH_KEYWORDS, __pyx_doc_6soapcw_6soapcw_15single_detector_6run};
 static PyObject *__pyx_pw_6soapcw_6soapcw_15single_detector_7run(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyObject *__pyx_v_self = 0;
   __Pyx_memviewslice __pyx_v_tr = { 0, 0, { 0 }, { 0 }, { 0 } };
   __Pyx_memviewslice __pyx_v_obs = { 0, 0, { 0 }, { 0 }, { 0 } };
-  PyObject *__pyx_v_lookup_file = 0;
+  PyObject *__pyx_v_lookup_table = 0;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("run (wrapper)", 0);
   {
-    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_self,&__pyx_n_s_tr,&__pyx_n_s_obs,&__pyx_n_s_lookup_file,0};
+    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_self,&__pyx_n_s_tr,&__pyx_n_s_obs,&__pyx_n_s_lookup_table,0};
     PyObject* values[4] = {0,0,0,0};
     values[3] = ((PyObject *)((PyObject *)Py_None));
     if (unlikely(__pyx_kwds)) {
       Py_ssize_t kw_args;
       const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
       switch (pos_args) {
         case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
@@ -4566,65 +4680,65 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_tr)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("run", 0, 3, 4, 1); __PYX_ERR(0, 77, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("run", 0, 3, 4, 1); __PYX_ERR(0, 84, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_obs)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("run", 0, 3, 4, 2); __PYX_ERR(0, 77, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("run", 0, 3, 4, 2); __PYX_ERR(0, 84, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (kw_args > 0) {
-          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_lookup_file);
+          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_lookup_table);
           if (value) { values[3] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "run") < 0)) __PYX_ERR(0, 77, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "run") < 0)) __PYX_ERR(0, 84, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
         CYTHON_FALLTHROUGH;
         case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
         values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
         values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
         break;
         default: goto __pyx_L5_argtuple_error;
       }
     }
     __pyx_v_self = values[0];
-    __pyx_v_tr = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_tr.memview)) __PYX_ERR(0, 77, __pyx_L3_error)
-    __pyx_v_obs = __Pyx_PyObject_to_MemoryviewSlice_dsds_double(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_obs.memview)) __PYX_ERR(0, 77, __pyx_L3_error)
-    __pyx_v_lookup_file = values[3];
+    __pyx_v_tr = __Pyx_PyObject_to_MemoryviewSlice_ds_double(values[1], PyBUF_WRITABLE); if (unlikely(!__pyx_v_tr.memview)) __PYX_ERR(0, 84, __pyx_L3_error)
+    __pyx_v_obs = __Pyx_PyObject_to_MemoryviewSlice_dsds_double(values[2], PyBUF_WRITABLE); if (unlikely(!__pyx_v_obs.memview)) __PYX_ERR(0, 84, __pyx_L3_error)
+    __pyx_v_lookup_table = values[3];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("run", 0, 3, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 77, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("run", 0, 3, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 84, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("soapcw.soapcw.single_detector.run", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_6soapcw_6soapcw_15single_detector_6run(__pyx_self, __pyx_v_self, __pyx_v_tr, __pyx_v_obs, __pyx_v_lookup_file);
+  __pyx_r = __pyx_pf_6soapcw_6soapcw_15single_detector_6run(__pyx_self, __pyx_v_self, __pyx_v_tr, __pyx_v_obs, __pyx_v_lookup_table);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 static PyObject *__pyx_gb_6soapcw_6soapcw_15single_detector_3run_2generator(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value); /* proto */
 
-/* "soapcw/soapcw.pyx":169
+/* "soapcw/soapcw.pyx":176
  *                     pbar+=100./len(obs)
  * 
  *         cdef double max_end_prob = max(V[length-1][i] for i in range(width))             # <<<<<<<<<<<<<<
  *         cdef int previous
  *         cdef int[:] vit_track = np.zeros(length,dtype=np.int32)
  */
 
@@ -4636,23 +4750,23 @@
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("genexpr", 0);
   __pyx_cur_scope = (struct __pyx_obj_6soapcw_6soapcw___pyx_scope_struct_1_genexpr *)__pyx_tp_new_6soapcw_6soapcw___pyx_scope_struct_1_genexpr(__pyx_ptype_6soapcw_6soapcw___pyx_scope_struct_1_genexpr, __pyx_empty_tuple, NULL);
   if (unlikely(!__pyx_cur_scope)) {
     __pyx_cur_scope = ((struct __pyx_obj_6soapcw_6soapcw___pyx_scope_struct_1_genexpr *)Py_None);
     __Pyx_INCREF(Py_None);
-    __PYX_ERR(0, 169, __pyx_L1_error)
+    __PYX_ERR(0, 176, __pyx_L1_error)
   } else {
     __Pyx_GOTREF(__pyx_cur_scope);
   }
   __pyx_cur_scope->__pyx_outer_scope = (struct __pyx_obj_6soapcw_6soapcw___pyx_scope_struct__run *) __pyx_self;
   __Pyx_INCREF(((PyObject *)__pyx_cur_scope->__pyx_outer_scope));
   __Pyx_GIVEREF(__pyx_cur_scope->__pyx_outer_scope);
   {
-    __pyx_CoroutineObject *gen = __Pyx_Generator_New((__pyx_coroutine_body_t) __pyx_gb_6soapcw_6soapcw_15single_detector_3run_2generator, NULL, (PyObject *) __pyx_cur_scope, __pyx_n_s_genexpr, __pyx_n_s_single_detector_run_locals_genex, __pyx_n_s_soapcw_soapcw); if (unlikely(!gen)) __PYX_ERR(0, 169, __pyx_L1_error)
+    __pyx_CoroutineObject *gen = __Pyx_Generator_New((__pyx_coroutine_body_t) __pyx_gb_6soapcw_6soapcw_15single_detector_3run_2generator, NULL, (PyObject *) __pyx_cur_scope, __pyx_n_s_genexpr, __pyx_n_s_single_detector_run_locals_genex, __pyx_n_s_soapcw_soapcw); if (unlikely(!gen)) __PYX_ERR(0, 176, __pyx_L1_error)
     __Pyx_DECREF(__pyx_cur_scope);
     __Pyx_RefNannyFinishContext();
     return (PyObject *) gen;
   }
 
   /* function exit code */
   __pyx_L1_error:;
@@ -4684,36 +4798,36 @@
     case 0: goto __pyx_L3_first_run;
     case 1: goto __pyx_L6_resume_from_yield;
     default: /* CPython raises the right error here */
     __Pyx_RefNannyFinishContext();
     return NULL;
   }
   __pyx_L3_first_run:;
-  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 169, __pyx_L1_error)
+  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 176, __pyx_L1_error)
   __pyx_t_1 = __pyx_cur_scope->__pyx_outer_scope->__pyx_v_width;
   __pyx_t_2 = __pyx_t_1;
   for (__pyx_t_3 = 0; __pyx_t_3 < __pyx_t_2; __pyx_t_3+=1) {
     __pyx_cur_scope->__pyx_v_i = __pyx_t_3;
-    if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_V.memview)) { __Pyx_RaiseClosureNameError("V"); __PYX_ERR(0, 169, __pyx_L1_error) }
+    if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_V.memview)) { __Pyx_RaiseClosureNameError("V"); __PYX_ERR(0, 176, __pyx_L1_error) }
     __pyx_t_4 = (__pyx_cur_scope->__pyx_outer_scope->__pyx_v_length - 1);
     __pyx_t_5 = __pyx_cur_scope->__pyx_v_i;
     __pyx_t_6 = -1;
     if (__pyx_t_4 < 0) {
       __pyx_t_4 += __pyx_cur_scope->__pyx_outer_scope->__pyx_v_V.shape[0];
       if (unlikely(__pyx_t_4 < 0)) __pyx_t_6 = 0;
     } else if (unlikely(__pyx_t_4 >= __pyx_cur_scope->__pyx_outer_scope->__pyx_v_V.shape[0])) __pyx_t_6 = 0;
     if (__pyx_t_5 < 0) {
       __pyx_t_5 += __pyx_cur_scope->__pyx_outer_scope->__pyx_v_V.shape[1];
       if (unlikely(__pyx_t_5 < 0)) __pyx_t_6 = 1;
     } else if (unlikely(__pyx_t_5 >= __pyx_cur_scope->__pyx_outer_scope->__pyx_v_V.shape[1])) __pyx_t_6 = 1;
     if (unlikely(__pyx_t_6 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_6);
-      __PYX_ERR(0, 169, __pyx_L1_error)
+      __PYX_ERR(0, 176, __pyx_L1_error)
     }
-    __pyx_t_7 = PyFloat_FromDouble((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_cur_scope->__pyx_outer_scope->__pyx_v_V.data + __pyx_t_4 * __pyx_cur_scope->__pyx_outer_scope->__pyx_v_V.strides[0]) ) + __pyx_t_5 * __pyx_cur_scope->__pyx_outer_scope->__pyx_v_V.strides[1]) )))); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 169, __pyx_L1_error)
+    __pyx_t_7 = PyFloat_FromDouble((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_cur_scope->__pyx_outer_scope->__pyx_v_V.data + __pyx_t_4 * __pyx_cur_scope->__pyx_outer_scope->__pyx_v_V.strides[0]) ) + __pyx_t_5 * __pyx_cur_scope->__pyx_outer_scope->__pyx_v_V.strides[1]) )))); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 176, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __pyx_r = __pyx_t_7;
     __pyx_t_7 = 0;
     __pyx_cur_scope->__pyx_t_0 = __pyx_t_1;
     __pyx_cur_scope->__pyx_t_1 = __pyx_t_2;
     __pyx_cur_scope->__pyx_t_2 = __pyx_t_3;
     __Pyx_XGIVEREF(__pyx_r);
@@ -4722,15 +4836,15 @@
     /* return from generator, yielding value */
     __pyx_generator->resume_label = 1;
     return __pyx_r;
     __pyx_L6_resume_from_yield:;
     __pyx_t_1 = __pyx_cur_scope->__pyx_t_0;
     __pyx_t_2 = __pyx_cur_scope->__pyx_t_1;
     __pyx_t_3 = __pyx_cur_scope->__pyx_t_2;
-    if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 169, __pyx_L1_error)
+    if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 176, __pyx_L1_error)
   }
   CYTHON_MAYBE_UNUSED_VAR(__pyx_cur_scope);
 
   /* function exit code */
   PyErr_SetNone(PyExc_StopIteration);
   goto __pyx_L0;
   __pyx_L1_error:;
@@ -4743,23 +4857,23 @@
   #endif
   __pyx_generator->resume_label = -1;
   __Pyx_Coroutine_clear((PyObject*)__pyx_generator);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "soapcw/soapcw.pyx":77
+/* "soapcw/soapcw.pyx":84
  * 
  * 
- *     def run(self,double[:] tr, double[:, :] obs, lookup_file = None):             # <<<<<<<<<<<<<<
+ *     def run(self,double[:] tr, double[:, :] obs, lookup_table = None):             # <<<<<<<<<<<<<<
  *         '''
  *         Run the viterbi algorithm for given single set of data and 3x1 transition matrix.
  */
 
-static PyObject *__pyx_pf_6soapcw_6soapcw_15single_detector_6run(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, __Pyx_memviewslice __pyx_v_tr, __Pyx_memviewslice __pyx_v_obs, PyObject *__pyx_v_lookup_file) {
+static PyObject *__pyx_pf_6soapcw_6soapcw_15single_detector_6run(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, __Pyx_memviewslice __pyx_v_tr, __Pyx_memviewslice __pyx_v_obs, PyObject *__pyx_v_lookup_table) {
   struct __pyx_obj_6soapcw_6soapcw___pyx_scope_struct__run *__pyx_cur_scope;
   PyObject *__pyx_v_shape = NULL;
   __Pyx_memviewslice __pyx_v_prev = { 0, 0, { 0 }, { 0 }, { 0 } };
   int __pyx_v_t;
   int __pyx_v_i;
   int __pyx_v_j;
   double __pyx_v_pbar;
@@ -4816,218 +4930,218 @@
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("run", 0);
   __pyx_cur_scope = (struct __pyx_obj_6soapcw_6soapcw___pyx_scope_struct__run *)__pyx_tp_new_6soapcw_6soapcw___pyx_scope_struct__run(__pyx_ptype_6soapcw_6soapcw___pyx_scope_struct__run, __pyx_empty_tuple, NULL);
   if (unlikely(!__pyx_cur_scope)) {
     __pyx_cur_scope = ((struct __pyx_obj_6soapcw_6soapcw___pyx_scope_struct__run *)Py_None);
     __Pyx_INCREF(Py_None);
-    __PYX_ERR(0, 77, __pyx_L1_error)
+    __PYX_ERR(0, 84, __pyx_L1_error)
   } else {
     __Pyx_GOTREF(__pyx_cur_scope);
   }
 
-  /* "soapcw/soapcw.pyx":100
+  /* "soapcw/soapcw.pyx":107
  * 
  *         # find shape of the observation and create empty array for citerbi matrix and previous track positions
  *         shape = np.shape(obs)             # <<<<<<<<<<<<<<
  *         cdef double[:, :] V = np.zeros(shape)
  *         cdef int[:, :] prev = np.zeros(shape,dtype=np.int32)
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 100, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 107, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_shape); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 100, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_shape); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 107, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __pyx_memoryview_fromslice(__pyx_v_obs, 2, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 100, __pyx_L1_error)
+  __pyx_t_2 = __pyx_memoryview_fromslice(__pyx_v_obs, 2, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 107, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_4 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
     __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
     if (likely(__pyx_t_4)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
       __Pyx_INCREF(__pyx_t_4);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_3, function);
     }
   }
   __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_t_2) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_2);
   __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 100, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 107, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_v_shape = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "soapcw/soapcw.pyx":101
+  /* "soapcw/soapcw.pyx":108
  *         # find shape of the observation and create empty array for citerbi matrix and previous track positions
  *         shape = np.shape(obs)
  *         cdef double[:, :] V = np.zeros(shape)             # <<<<<<<<<<<<<<
  *         cdef int[:, :] prev = np.zeros(shape,dtype=np.int32)
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 101, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 108, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 101, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 108, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_t_3 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
     __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
     if (likely(__pyx_t_3)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
       __Pyx_INCREF(__pyx_t_3);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_2, function);
     }
   }
   __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_v_shape) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_shape);
   __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 101, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 108, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_5 = __Pyx_PyObject_to_MemoryviewSlice_dsds_double(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_5.memview)) __PYX_ERR(0, 101, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_to_MemoryviewSlice_dsds_double(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_5.memview)) __PYX_ERR(0, 108, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_cur_scope->__pyx_v_V = __pyx_t_5;
   __pyx_t_5.memview = NULL;
   __pyx_t_5.data = NULL;
 
-  /* "soapcw/soapcw.pyx":102
+  /* "soapcw/soapcw.pyx":109
  *         shape = np.shape(obs)
  *         cdef double[:, :] V = np.zeros(shape)
  *         cdef int[:, :] prev = np.zeros(shape,dtype=np.int32)             # <<<<<<<<<<<<<<
  * 
  *         # defining variables
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 102, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 109, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 102, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 109, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 102, __pyx_L1_error)
+  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 109, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_INCREF(__pyx_v_shape);
   __Pyx_GIVEREF(__pyx_v_shape);
   PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_shape);
-  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 102, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 109, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 102, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 109, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_int32); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 102, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_int32); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 109, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 102, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 109, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 102, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 109, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_dsds_int(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 102, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_dsds_int(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 109, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_v_prev = __pyx_t_7;
   __pyx_t_7.memview = NULL;
   __pyx_t_7.data = NULL;
 
-  /* "soapcw/soapcw.pyx":106
+  /* "soapcw/soapcw.pyx":113
  *         # defining variables
  *         cdef int t,i,j         # indexes
  *         cdef double pbar = 0   # progress bar             # <<<<<<<<<<<<<<
  *         cdef double pt
  * 
  */
   __pyx_v_pbar = 0.0;
 
-  /* "soapcw/soapcw.pyx":110
+  /* "soapcw/soapcw.pyx":117
  * 
  *         # finding length and width of observation
  *         cdef int length = shape[0]#len(obs)             # <<<<<<<<<<<<<<
  *         cdef int width = shape[1]#len(obs[0])
  * 
  */
-  __pyx_t_6 = __Pyx_GetItemInt(__pyx_v_shape, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 110, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_GetItemInt(__pyx_v_shape, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 117, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_8 = __Pyx_PyInt_As_int(__pyx_t_6); if (unlikely((__pyx_t_8 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 110, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyInt_As_int(__pyx_t_6); if (unlikely((__pyx_t_8 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 117, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_cur_scope->__pyx_v_length = __pyx_t_8;
 
-  /* "soapcw/soapcw.pyx":111
+  /* "soapcw/soapcw.pyx":118
  *         # finding length and width of observation
  *         cdef int length = shape[0]#len(obs)
  *         cdef int width = shape[1]#len(obs[0])             # <<<<<<<<<<<<<<
  * 
  *         # find size of the transition matrix
  */
-  __pyx_t_6 = __Pyx_GetItemInt(__pyx_v_shape, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 111, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_GetItemInt(__pyx_v_shape, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 118, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_8 = __Pyx_PyInt_As_int(__pyx_t_6); if (unlikely((__pyx_t_8 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 111, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyInt_As_int(__pyx_t_6); if (unlikely((__pyx_t_8 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 118, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_cur_scope->__pyx_v_width = __pyx_t_8;
 
-  /* "soapcw/soapcw.pyx":114
+  /* "soapcw/soapcw.pyx":121
  * 
  *         # find size of the transition matrix
  *         cdef int tr_length = len(tr)             # <<<<<<<<<<<<<<
  *         # find half width of transntion, i.e. number of bins up and down it can move
  *         cdef int tr_width = int((tr_length-1)/2 )
  */
   __pyx_t_9 = __Pyx_MemoryView_Len(__pyx_v_tr); 
   __pyx_v_tr_length = __pyx_t_9;
 
-  /* "soapcw/soapcw.pyx":116
+  /* "soapcw/soapcw.pyx":123
  *         cdef int tr_length = len(tr)
  *         # find half width of transntion, i.e. number of bins up and down it can move
  *         cdef int tr_width = int((tr_length-1)/2 )             # <<<<<<<<<<<<<<
  * 
  *         # vectors to store lookup tables
  */
   __pyx_v_tr_width = ((int)(((double)(__pyx_v_tr_length - 1)) / 2.0));
 
-  /* "soapcw/soapcw.pyx":122
+  /* "soapcw/soapcw.pyx":129
  *         cdef double fact
  *         cdef int[:,:] obs_ind
- *         if lookup_file is not None:             # <<<<<<<<<<<<<<
+ *         if lookup_table is not None:             # <<<<<<<<<<<<<<
  *             # get log statistic, the ranges of lookuptable and spacing factor
- *             logarr, ranges, fact = self.read_lookup(lookup_file)
+ *             logarr, ranges, fact = self.read_lookup(lookup_table)
  */
-  __pyx_t_10 = (__pyx_v_lookup_file != Py_None);
+  __pyx_t_10 = (__pyx_v_lookup_table != Py_None);
   __pyx_t_11 = (__pyx_t_10 != 0);
   if (__pyx_t_11) {
 
-    /* "soapcw/soapcw.pyx":124
- *         if lookup_file is not None:
+    /* "soapcw/soapcw.pyx":131
+ *         if lookup_table is not None:
  *             # get log statistic, the ranges of lookuptable and spacing factor
- *             logarr, ranges, fact = self.read_lookup(lookup_file)             # <<<<<<<<<<<<<<
+ *             logarr, ranges, fact = self.read_lookup(lookup_table)             # <<<<<<<<<<<<<<
  *             # shift observation to index for array
  *             obs_ind_arr = (obs - ranges[0])*fact
  */
-    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_read_lookup); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 124, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_read_lookup); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 131, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __pyx_t_1 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
       __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_3);
       if (likely(__pyx_t_1)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
         __Pyx_INCREF(__pyx_t_1);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_3, function);
       }
     }
-    __pyx_t_6 = (__pyx_t_1) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_1, __pyx_v_lookup_file) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_lookup_file);
+    __pyx_t_6 = (__pyx_t_1) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_1, __pyx_v_lookup_table) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_lookup_table);
     __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
-    if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 124, __pyx_L1_error)
+    if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 131, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     if ((likely(PyTuple_CheckExact(__pyx_t_6))) || (PyList_CheckExact(__pyx_t_6))) {
       PyObject* sequence = __pyx_t_6;
       Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
       if (unlikely(size != 3)) {
         if (size > 3) __Pyx_RaiseTooManyValuesError(3);
         else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
-        __PYX_ERR(0, 124, __pyx_L1_error)
+        __PYX_ERR(0, 131, __pyx_L1_error)
       }
       #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
       if (likely(PyTuple_CheckExact(sequence))) {
         __pyx_t_3 = PyTuple_GET_ITEM(sequence, 0); 
         __pyx_t_1 = PyTuple_GET_ITEM(sequence, 1); 
         __pyx_t_2 = PyTuple_GET_ITEM(sequence, 2); 
       } else {
@@ -5035,143 +5149,143 @@
         __pyx_t_1 = PyList_GET_ITEM(sequence, 1); 
         __pyx_t_2 = PyList_GET_ITEM(sequence, 2); 
       }
       __Pyx_INCREF(__pyx_t_3);
       __Pyx_INCREF(__pyx_t_1);
       __Pyx_INCREF(__pyx_t_2);
       #else
-      __pyx_t_3 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 124, __pyx_L1_error)
+      __pyx_t_3 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 131, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
-      __pyx_t_1 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 124, __pyx_L1_error)
+      __pyx_t_1 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 131, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
-      __pyx_t_2 = PySequence_ITEM(sequence, 2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 124, __pyx_L1_error)
+      __pyx_t_2 = PySequence_ITEM(sequence, 2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 131, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
       #endif
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     } else {
       Py_ssize_t index = -1;
-      __pyx_t_4 = PyObject_GetIter(__pyx_t_6); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 124, __pyx_L1_error)
+      __pyx_t_4 = PyObject_GetIter(__pyx_t_6); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 131, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
       __pyx_t_12 = Py_TYPE(__pyx_t_4)->tp_iternext;
       index = 0; __pyx_t_3 = __pyx_t_12(__pyx_t_4); if (unlikely(!__pyx_t_3)) goto __pyx_L4_unpacking_failed;
       __Pyx_GOTREF(__pyx_t_3);
       index = 1; __pyx_t_1 = __pyx_t_12(__pyx_t_4); if (unlikely(!__pyx_t_1)) goto __pyx_L4_unpacking_failed;
       __Pyx_GOTREF(__pyx_t_1);
       index = 2; __pyx_t_2 = __pyx_t_12(__pyx_t_4); if (unlikely(!__pyx_t_2)) goto __pyx_L4_unpacking_failed;
       __Pyx_GOTREF(__pyx_t_2);
-      if (__Pyx_IternextUnpackEndCheck(__pyx_t_12(__pyx_t_4), 3) < 0) __PYX_ERR(0, 124, __pyx_L1_error)
+      if (__Pyx_IternextUnpackEndCheck(__pyx_t_12(__pyx_t_4), 3) < 0) __PYX_ERR(0, 131, __pyx_L1_error)
       __pyx_t_12 = NULL;
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
       goto __pyx_L5_unpacking_done;
       __pyx_L4_unpacking_failed:;
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
       __pyx_t_12 = NULL;
       if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
-      __PYX_ERR(0, 124, __pyx_L1_error)
+      __PYX_ERR(0, 131, __pyx_L1_error)
       __pyx_L5_unpacking_done:;
     }
-    __pyx_t_13 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_3, PyBUF_WRITABLE); if (unlikely(!__pyx_t_13.memview)) __PYX_ERR(0, 124, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_3, PyBUF_WRITABLE); if (unlikely(!__pyx_t_13.memview)) __PYX_ERR(0, 131, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_t_14 = __pyx_PyFloat_AsDouble(__pyx_t_2); if (unlikely((__pyx_t_14 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 124, __pyx_L1_error)
+    __pyx_t_14 = __pyx_PyFloat_AsDouble(__pyx_t_2); if (unlikely((__pyx_t_14 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 131, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __pyx_v_logarr = __pyx_t_13;
     __pyx_t_13.memview = NULL;
     __pyx_t_13.data = NULL;
     __pyx_v_ranges = __pyx_t_1;
     __pyx_t_1 = 0;
     __pyx_v_fact = __pyx_t_14;
 
-    /* "soapcw/soapcw.pyx":126
- *             logarr, ranges, fact = self.read_lookup(lookup_file)
+    /* "soapcw/soapcw.pyx":133
+ *             logarr, ranges, fact = self.read_lookup(lookup_table)
  *             # shift observation to index for array
  *             obs_ind_arr = (obs - ranges[0])*fact             # <<<<<<<<<<<<<<
  *             obs_ind_arr[obs_ind_arr >= len(ranges)] = len(ranges)-1
  *             obs_ind_arr[obs_ind_arr < 0] = 0
  */
-    __pyx_t_6 = __pyx_memoryview_fromslice(__pyx_v_obs, 2, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 126, __pyx_L1_error)
+    __pyx_t_6 = __pyx_memoryview_fromslice(__pyx_v_obs, 2, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 133, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
-    __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_ranges, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 126, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_ranges, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 133, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_1 = PyNumber_Subtract(__pyx_t_6, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 126, __pyx_L1_error)
+    __pyx_t_1 = PyNumber_Subtract(__pyx_t_6, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 133, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __pyx_t_2 = PyFloat_FromDouble(__pyx_v_fact); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 126, __pyx_L1_error)
+    __pyx_t_2 = PyFloat_FromDouble(__pyx_v_fact); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 133, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_6 = PyNumber_Multiply(__pyx_t_1, __pyx_t_2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 126, __pyx_L1_error)
+    __pyx_t_6 = PyNumber_Multiply(__pyx_t_1, __pyx_t_2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 133, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __pyx_v_obs_ind_arr = __pyx_t_6;
     __pyx_t_6 = 0;
 
-    /* "soapcw/soapcw.pyx":127
+    /* "soapcw/soapcw.pyx":134
  *             # shift observation to index for array
  *             obs_ind_arr = (obs - ranges[0])*fact
  *             obs_ind_arr[obs_ind_arr >= len(ranges)] = len(ranges)-1             # <<<<<<<<<<<<<<
  *             obs_ind_arr[obs_ind_arr < 0] = 0
  *             # save array to vector
  */
-    __pyx_t_15 = PyObject_Length(__pyx_v_ranges); if (unlikely(__pyx_t_15 == ((Py_ssize_t)-1))) __PYX_ERR(0, 127, __pyx_L1_error)
-    __pyx_t_6 = PyInt_FromSsize_t((__pyx_t_15 - 1)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 127, __pyx_L1_error)
+    __pyx_t_15 = PyObject_Length(__pyx_v_ranges); if (unlikely(__pyx_t_15 == ((Py_ssize_t)-1))) __PYX_ERR(0, 134, __pyx_L1_error)
+    __pyx_t_6 = PyInt_FromSsize_t((__pyx_t_15 - 1)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 134, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
-    __pyx_t_15 = PyObject_Length(__pyx_v_ranges); if (unlikely(__pyx_t_15 == ((Py_ssize_t)-1))) __PYX_ERR(0, 127, __pyx_L1_error)
-    __pyx_t_2 = PyInt_FromSsize_t(__pyx_t_15); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 127, __pyx_L1_error)
+    __pyx_t_15 = PyObject_Length(__pyx_v_ranges); if (unlikely(__pyx_t_15 == ((Py_ssize_t)-1))) __PYX_ERR(0, 134, __pyx_L1_error)
+    __pyx_t_2 = PyInt_FromSsize_t(__pyx_t_15); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 134, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_1 = PyObject_RichCompare(__pyx_v_obs_ind_arr, __pyx_t_2, Py_GE); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 127, __pyx_L1_error)
+    __pyx_t_1 = PyObject_RichCompare(__pyx_v_obs_ind_arr, __pyx_t_2, Py_GE); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 134, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    if (unlikely(PyObject_SetItem(__pyx_v_obs_ind_arr, __pyx_t_1, __pyx_t_6) < 0)) __PYX_ERR(0, 127, __pyx_L1_error)
+    if (unlikely(PyObject_SetItem(__pyx_v_obs_ind_arr, __pyx_t_1, __pyx_t_6) < 0)) __PYX_ERR(0, 134, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
 
-    /* "soapcw/soapcw.pyx":128
+    /* "soapcw/soapcw.pyx":135
  *             obs_ind_arr = (obs - ranges[0])*fact
  *             obs_ind_arr[obs_ind_arr >= len(ranges)] = len(ranges)-1
  *             obs_ind_arr[obs_ind_arr < 0] = 0             # <<<<<<<<<<<<<<
  *             # save array to vector
  *             obs_ind = np.array(obs_ind_arr).astype(np.int32)
  */
-    __pyx_t_6 = PyObject_RichCompare(__pyx_v_obs_ind_arr, __pyx_int_0, Py_LT); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 128, __pyx_L1_error)
-    if (unlikely(PyObject_SetItem(__pyx_v_obs_ind_arr, __pyx_t_6, __pyx_int_0) < 0)) __PYX_ERR(0, 128, __pyx_L1_error)
+    __pyx_t_6 = PyObject_RichCompare(__pyx_v_obs_ind_arr, __pyx_int_0, Py_LT); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 135, __pyx_L1_error)
+    if (unlikely(PyObject_SetItem(__pyx_v_obs_ind_arr, __pyx_t_6, __pyx_int_0) < 0)) __PYX_ERR(0, 135, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
 
-    /* "soapcw/soapcw.pyx":130
+    /* "soapcw/soapcw.pyx":137
  *             obs_ind_arr[obs_ind_arr < 0] = 0
  *             # save array to vector
  *             obs_ind = np.array(obs_ind_arr).astype(np.int32)             # <<<<<<<<<<<<<<
  *             del obs_ind_arr
  *         else:
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 130, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 137, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_array); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 130, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_array); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 137, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __pyx_t_2 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
       __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
       if (likely(__pyx_t_2)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
         __Pyx_INCREF(__pyx_t_2);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_3, function);
       }
     }
     __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_2, __pyx_v_obs_ind_arr) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_obs_ind_arr);
     __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 130, __pyx_L1_error)
+    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 137, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_astype); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 130, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_astype); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 137, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 130, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 137, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_int32); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 130, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_int32); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 137, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __pyx_t_1 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
       __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_3);
       if (likely(__pyx_t_1)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
@@ -5179,74 +5293,74 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_3, function);
       }
     }
     __pyx_t_6 = (__pyx_t_1) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_1, __pyx_t_2) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_2);
     __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 130, __pyx_L1_error)
+    if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 137, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_dsds_int(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 130, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_dsds_int(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 137, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     __pyx_v_obs_ind = __pyx_t_7;
     __pyx_t_7.memview = NULL;
     __pyx_t_7.data = NULL;
 
-    /* "soapcw/soapcw.pyx":131
+    /* "soapcw/soapcw.pyx":138
  *             # save array to vector
  *             obs_ind = np.array(obs_ind_arr).astype(np.int32)
  *             del obs_ind_arr             # <<<<<<<<<<<<<<
  *         else:
  *             # if using the sum of power, set element of index to 2d array
  */
     __Pyx_DECREF(__pyx_v_obs_ind_arr);
     __pyx_v_obs_ind_arr = NULL;
 
-    /* "soapcw/soapcw.pyx":122
+    /* "soapcw/soapcw.pyx":129
  *         cdef double fact
  *         cdef int[:,:] obs_ind
- *         if lookup_file is not None:             # <<<<<<<<<<<<<<
+ *         if lookup_table is not None:             # <<<<<<<<<<<<<<
  *             # get log statistic, the ranges of lookuptable and spacing factor
- *             logarr, ranges, fact = self.read_lookup(lookup_file)
+ *             logarr, ranges, fact = self.read_lookup(lookup_table)
  */
     goto __pyx_L3;
   }
 
-  /* "soapcw/soapcw.pyx":134
+  /* "soapcw/soapcw.pyx":141
  *         else:
  *             # if using the sum of power, set element of index to 2d array
  *             obs_ind = np.arange(np.prod(shape)).reshape(shape).astype(np.int32)             # <<<<<<<<<<<<<<
  *             # flatten input spectrogram for access in 1d
  *             logarr = np.ravel(obs)
  */
   /*else*/ {
-    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 134, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 141, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_arange); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 134, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_arange); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 141, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __Pyx_GetModuleGlobalName(__pyx_t_16, __pyx_n_s_np); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 134, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_16, __pyx_n_s_np); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 141, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_16);
-    __pyx_t_17 = __Pyx_PyObject_GetAttrStr(__pyx_t_16, __pyx_n_s_prod); if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 134, __pyx_L1_error)
+    __pyx_t_17 = __Pyx_PyObject_GetAttrStr(__pyx_t_16, __pyx_n_s_prod); if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 141, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_17);
     __Pyx_DECREF(__pyx_t_16); __pyx_t_16 = 0;
     __pyx_t_16 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_17))) {
       __pyx_t_16 = PyMethod_GET_SELF(__pyx_t_17);
       if (likely(__pyx_t_16)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_17);
         __Pyx_INCREF(__pyx_t_16);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_17, function);
       }
     }
     __pyx_t_1 = (__pyx_t_16) ? __Pyx_PyObject_Call2Args(__pyx_t_17, __pyx_t_16, __pyx_v_shape) : __Pyx_PyObject_CallOneArg(__pyx_t_17, __pyx_v_shape);
     __Pyx_XDECREF(__pyx_t_16); __pyx_t_16 = 0;
-    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 134, __pyx_L1_error)
+    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 141, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_17); __pyx_t_17 = 0;
     __pyx_t_17 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
       __pyx_t_17 = PyMethod_GET_SELF(__pyx_t_4);
       if (likely(__pyx_t_17)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
@@ -5254,41 +5368,41 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_4, function);
       }
     }
     __pyx_t_2 = (__pyx_t_17) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_17, __pyx_t_1) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_1);
     __Pyx_XDECREF(__pyx_t_17); __pyx_t_17 = 0;
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 134, __pyx_L1_error)
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 141, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_reshape); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 134, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_reshape); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 141, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __pyx_t_2 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
       __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_4);
       if (likely(__pyx_t_2)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
         __Pyx_INCREF(__pyx_t_2);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_4, function);
       }
     }
     __pyx_t_3 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_2, __pyx_v_shape) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_v_shape);
     __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 134, __pyx_L1_error)
+    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 141, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_astype); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 134, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_astype); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 141, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 134, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 141, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_int32); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 134, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_int32); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 141, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_t_3 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
       __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_4);
       if (likely(__pyx_t_3)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
@@ -5296,74 +5410,74 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_4, function);
       }
     }
     __pyx_t_6 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_3, __pyx_t_2) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_2);
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 134, __pyx_L1_error)
+    if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 141, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_dsds_int(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 134, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_dsds_int(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 141, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     __pyx_v_obs_ind = __pyx_t_7;
     __pyx_t_7.memview = NULL;
     __pyx_t_7.data = NULL;
 
-    /* "soapcw/soapcw.pyx":136
+    /* "soapcw/soapcw.pyx":143
  *             obs_ind = np.arange(np.prod(shape)).reshape(shape).astype(np.int32)
  *             # flatten input spectrogram for access in 1d
  *             logarr = np.ravel(obs)             # <<<<<<<<<<<<<<
  * 
  *         # run for first time index, i.e. fill with observation
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 136, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 143, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_ravel); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 136, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_ravel); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 143, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_t_4 = __pyx_memoryview_fromslice(__pyx_v_obs, 2, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 136, __pyx_L1_error)
+    __pyx_t_4 = __pyx_memoryview_fromslice(__pyx_v_obs, 2, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 143, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __pyx_t_3 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
       __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
       if (likely(__pyx_t_3)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
         __Pyx_INCREF(__pyx_t_3);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_2, function);
       }
     }
     __pyx_t_6 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_4);
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 136, __pyx_L1_error)
+    if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 143, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __pyx_t_13 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_13.memview)) __PYX_ERR(0, 136, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_13.memview)) __PYX_ERR(0, 143, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     __pyx_v_logarr = __pyx_t_13;
     __pyx_t_13.memview = NULL;
     __pyx_t_13.data = NULL;
   }
   __pyx_L3:;
 
-  /* "soapcw/soapcw.pyx":139
+  /* "soapcw/soapcw.pyx":146
  * 
  *         # run for first time index, i.e. fill with observation
  *         for i in range(width):             # <<<<<<<<<<<<<<
  *             V[0][i] = logarr[obs_ind[0][i]]
  *             prev[0][i] = 1
  */
   __pyx_t_8 = __pyx_cur_scope->__pyx_v_width;
   __pyx_t_18 = __pyx_t_8;
   for (__pyx_t_19 = 0; __pyx_t_19 < __pyx_t_18; __pyx_t_19+=1) {
     __pyx_v_i = __pyx_t_19;
 
-    /* "soapcw/soapcw.pyx":140
+    /* "soapcw/soapcw.pyx":147
  *         # run for first time index, i.e. fill with observation
  *         for i in range(width):
  *             V[0][i] = logarr[obs_ind[0][i]]             # <<<<<<<<<<<<<<
  *             prev[0][i] = 1
  * 
  */
     __pyx_t_20 = 0;
@@ -5375,44 +5489,44 @@
     } else if (unlikely(__pyx_t_20 >= __pyx_v_obs_ind.shape[0])) __pyx_t_22 = 0;
     if (__pyx_t_21 < 0) {
       __pyx_t_21 += __pyx_v_obs_ind.shape[1];
       if (unlikely(__pyx_t_21 < 0)) __pyx_t_22 = 1;
     } else if (unlikely(__pyx_t_21 >= __pyx_v_obs_ind.shape[1])) __pyx_t_22 = 1;
     if (unlikely(__pyx_t_22 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_22);
-      __PYX_ERR(0, 140, __pyx_L1_error)
+      __PYX_ERR(0, 147, __pyx_L1_error)
     }
     __pyx_t_23 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_obs_ind.data + __pyx_t_20 * __pyx_v_obs_ind.strides[0]) ) + __pyx_t_21 * __pyx_v_obs_ind.strides[1]) )));
     __pyx_t_22 = -1;
     if (__pyx_t_23 < 0) {
       __pyx_t_23 += __pyx_v_logarr.shape[0];
       if (unlikely(__pyx_t_23 < 0)) __pyx_t_22 = 0;
     } else if (unlikely(__pyx_t_23 >= __pyx_v_logarr.shape[0])) __pyx_t_22 = 0;
     if (unlikely(__pyx_t_22 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_22);
-      __PYX_ERR(0, 140, __pyx_L1_error)
+      __PYX_ERR(0, 147, __pyx_L1_error)
     }
     __pyx_t_24 = 0;
     __pyx_t_25 = __pyx_v_i;
     __pyx_t_22 = -1;
     if (__pyx_t_24 < 0) {
       __pyx_t_24 += __pyx_cur_scope->__pyx_v_V.shape[0];
       if (unlikely(__pyx_t_24 < 0)) __pyx_t_22 = 0;
     } else if (unlikely(__pyx_t_24 >= __pyx_cur_scope->__pyx_v_V.shape[0])) __pyx_t_22 = 0;
     if (__pyx_t_25 < 0) {
       __pyx_t_25 += __pyx_cur_scope->__pyx_v_V.shape[1];
       if (unlikely(__pyx_t_25 < 0)) __pyx_t_22 = 1;
     } else if (unlikely(__pyx_t_25 >= __pyx_cur_scope->__pyx_v_V.shape[1])) __pyx_t_22 = 1;
     if (unlikely(__pyx_t_22 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_22);
-      __PYX_ERR(0, 140, __pyx_L1_error)
+      __PYX_ERR(0, 147, __pyx_L1_error)
     }
     *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_cur_scope->__pyx_v_V.data + __pyx_t_24 * __pyx_cur_scope->__pyx_v_V.strides[0]) ) + __pyx_t_25 * __pyx_cur_scope->__pyx_v_V.strides[1]) )) = (*((double *) ( /* dim=0 */ (__pyx_v_logarr.data + __pyx_t_23 * __pyx_v_logarr.strides[0]) )));
 
-    /* "soapcw/soapcw.pyx":141
+    /* "soapcw/soapcw.pyx":148
  *         for i in range(width):
  *             V[0][i] = logarr[obs_ind[0][i]]
  *             prev[0][i] = 1             # <<<<<<<<<<<<<<
  * 
  *         # run iterative part of algorithm
  */
     __pyx_t_21 = 0;
@@ -5424,79 +5538,79 @@
     } else if (unlikely(__pyx_t_21 >= __pyx_v_prev.shape[0])) __pyx_t_22 = 0;
     if (__pyx_t_20 < 0) {
       __pyx_t_20 += __pyx_v_prev.shape[1];
       if (unlikely(__pyx_t_20 < 0)) __pyx_t_22 = 1;
     } else if (unlikely(__pyx_t_20 >= __pyx_v_prev.shape[1])) __pyx_t_22 = 1;
     if (unlikely(__pyx_t_22 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_22);
-      __PYX_ERR(0, 141, __pyx_L1_error)
+      __PYX_ERR(0, 148, __pyx_L1_error)
     }
     *((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_prev.data + __pyx_t_21 * __pyx_v_prev.strides[0]) ) + __pyx_t_20 * __pyx_v_prev.strides[1]) )) = 1;
   }
 
-  /* "soapcw/soapcw.pyx":144
+  /* "soapcw/soapcw.pyx":151
  * 
  *         # run iterative part of algorithm
  *         for t in range(1,length):             # <<<<<<<<<<<<<<
  *             pt = t/(length)*100
  *             for i in range(width):
  */
   __pyx_t_8 = __pyx_cur_scope->__pyx_v_length;
   __pyx_t_18 = __pyx_t_8;
   for (__pyx_t_19 = 1; __pyx_t_19 < __pyx_t_18; __pyx_t_19+=1) {
     __pyx_v_t = __pyx_t_19;
 
-    /* "soapcw/soapcw.pyx":145
+    /* "soapcw/soapcw.pyx":152
  *         # run iterative part of algorithm
  *         for t in range(1,length):
  *             pt = t/(length)*100             # <<<<<<<<<<<<<<
  *             for i in range(width):
  *                 temp = -1e6
  */
     if (unlikely(__pyx_cur_scope->__pyx_v_length == 0)) {
       PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-      __PYX_ERR(0, 145, __pyx_L1_error)
+      __PYX_ERR(0, 152, __pyx_L1_error)
     }
     __pyx_v_pt = ((((double)__pyx_v_t) / ((double)__pyx_cur_scope->__pyx_v_length)) * 100.0);
 
-    /* "soapcw/soapcw.pyx":146
+    /* "soapcw/soapcw.pyx":153
  *         for t in range(1,length):
  *             pt = t/(length)*100
  *             for i in range(width):             # <<<<<<<<<<<<<<
  *                 temp = -1e6
  *                 for j in range(tr_length):
  */
     __pyx_t_22 = __pyx_cur_scope->__pyx_v_width;
     __pyx_t_26 = __pyx_t_22;
     for (__pyx_t_27 = 0; __pyx_t_27 < __pyx_t_26; __pyx_t_27+=1) {
       __pyx_v_i = __pyx_t_27;
 
-      /* "soapcw/soapcw.pyx":147
+      /* "soapcw/soapcw.pyx":154
  *             pt = t/(length)*100
  *             for i in range(width):
  *                 temp = -1e6             # <<<<<<<<<<<<<<
  *                 for j in range(tr_length):
  *                     if i+j-tr_width>=0 and i+j-tr_width<=width-1:
  */
       __Pyx_INCREF(__pyx_float_neg_1e6);
       __Pyx_XDECREF_SET(__pyx_v_temp, __pyx_float_neg_1e6);
 
-      /* "soapcw/soapcw.pyx":148
+      /* "soapcw/soapcw.pyx":155
  *             for i in range(width):
  *                 temp = -1e6
  *                 for j in range(tr_length):             # <<<<<<<<<<<<<<
  *                     if i+j-tr_width>=0 and i+j-tr_width<=width-1:
  *                         o = obs_ind[t][i]
  */
       __pyx_t_28 = __pyx_v_tr_length;
       __pyx_t_29 = __pyx_t_28;
       for (__pyx_t_30 = 0; __pyx_t_30 < __pyx_t_29; __pyx_t_30+=1) {
         __pyx_v_j = __pyx_t_30;
 
-        /* "soapcw/soapcw.pyx":149
+        /* "soapcw/soapcw.pyx":156
  *                 temp = -1e6
  *                 for j in range(tr_length):
  *                     if i+j-tr_width>=0 and i+j-tr_width<=width-1:             # <<<<<<<<<<<<<<
  *                         o = obs_ind[t][i]
  *                         value = tr[j] + logarr[o] + V[t-1][i+j-tr_width]
  */
         __pyx_t_10 = ((((__pyx_v_i + __pyx_v_j) - __pyx_v_tr_width) >= 0) != 0);
@@ -5506,15 +5620,15 @@
           goto __pyx_L15_bool_binop_done;
         }
         __pyx_t_10 = ((((__pyx_v_i + __pyx_v_j) - __pyx_v_tr_width) <= (__pyx_cur_scope->__pyx_v_width - 1)) != 0);
         __pyx_t_11 = __pyx_t_10;
         __pyx_L15_bool_binop_done:;
         if (__pyx_t_11) {
 
-          /* "soapcw/soapcw.pyx":150
+          /* "soapcw/soapcw.pyx":157
  *                 for j in range(tr_length):
  *                     if i+j-tr_width>=0 and i+j-tr_width<=width-1:
  *                         o = obs_ind[t][i]             # <<<<<<<<<<<<<<
  *                         value = tr[j] + logarr[o] + V[t-1][i+j-tr_width]
  * 
  */
           __pyx_t_20 = __pyx_v_t;
@@ -5526,117 +5640,117 @@
           } else if (unlikely(__pyx_t_20 >= __pyx_v_obs_ind.shape[0])) __pyx_t_31 = 0;
           if (__pyx_t_21 < 0) {
             __pyx_t_21 += __pyx_v_obs_ind.shape[1];
             if (unlikely(__pyx_t_21 < 0)) __pyx_t_31 = 1;
           } else if (unlikely(__pyx_t_21 >= __pyx_v_obs_ind.shape[1])) __pyx_t_31 = 1;
           if (unlikely(__pyx_t_31 != -1)) {
             __Pyx_RaiseBufferIndexError(__pyx_t_31);
-            __PYX_ERR(0, 150, __pyx_L1_error)
+            __PYX_ERR(0, 157, __pyx_L1_error)
           }
-          __pyx_t_6 = __Pyx_PyInt_From_int((*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_obs_ind.data + __pyx_t_20 * __pyx_v_obs_ind.strides[0]) ) + __pyx_t_21 * __pyx_v_obs_ind.strides[1]) )))); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 150, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyInt_From_int((*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_obs_ind.data + __pyx_t_20 * __pyx_v_obs_ind.strides[0]) ) + __pyx_t_21 * __pyx_v_obs_ind.strides[1]) )))); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 157, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
           __Pyx_XDECREF_SET(__pyx_v_o, __pyx_t_6);
           __pyx_t_6 = 0;
 
-          /* "soapcw/soapcw.pyx":151
+          /* "soapcw/soapcw.pyx":158
  *                     if i+j-tr_width>=0 and i+j-tr_width<=width-1:
  *                         o = obs_ind[t][i]
  *                         value = tr[j] + logarr[o] + V[t-1][i+j-tr_width]             # <<<<<<<<<<<<<<
  * 
  *                         if value>temp:
  */
           __pyx_t_21 = __pyx_v_j;
           __pyx_t_31 = -1;
           if (__pyx_t_21 < 0) {
             __pyx_t_21 += __pyx_v_tr.shape[0];
             if (unlikely(__pyx_t_21 < 0)) __pyx_t_31 = 0;
           } else if (unlikely(__pyx_t_21 >= __pyx_v_tr.shape[0])) __pyx_t_31 = 0;
           if (unlikely(__pyx_t_31 != -1)) {
             __Pyx_RaiseBufferIndexError(__pyx_t_31);
-            __PYX_ERR(0, 151, __pyx_L1_error)
+            __PYX_ERR(0, 158, __pyx_L1_error)
           }
-          __pyx_t_15 = __Pyx_PyIndex_AsSsize_t(__pyx_v_o); if (unlikely((__pyx_t_15 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 151, __pyx_L1_error)
+          __pyx_t_15 = __Pyx_PyIndex_AsSsize_t(__pyx_v_o); if (unlikely((__pyx_t_15 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 158, __pyx_L1_error)
           __pyx_t_20 = __pyx_t_15;
           __pyx_t_31 = -1;
           if (__pyx_t_20 < 0) {
             __pyx_t_20 += __pyx_v_logarr.shape[0];
             if (unlikely(__pyx_t_20 < 0)) __pyx_t_31 = 0;
           } else if (unlikely(__pyx_t_20 >= __pyx_v_logarr.shape[0])) __pyx_t_31 = 0;
           if (unlikely(__pyx_t_31 != -1)) {
             __Pyx_RaiseBufferIndexError(__pyx_t_31);
-            __PYX_ERR(0, 151, __pyx_L1_error)
+            __PYX_ERR(0, 158, __pyx_L1_error)
           }
           __pyx_t_23 = (__pyx_v_t - 1);
           __pyx_t_25 = ((__pyx_v_i + __pyx_v_j) - __pyx_v_tr_width);
           __pyx_t_31 = -1;
           if (__pyx_t_23 < 0) {
             __pyx_t_23 += __pyx_cur_scope->__pyx_v_V.shape[0];
             if (unlikely(__pyx_t_23 < 0)) __pyx_t_31 = 0;
           } else if (unlikely(__pyx_t_23 >= __pyx_cur_scope->__pyx_v_V.shape[0])) __pyx_t_31 = 0;
           if (__pyx_t_25 < 0) {
             __pyx_t_25 += __pyx_cur_scope->__pyx_v_V.shape[1];
             if (unlikely(__pyx_t_25 < 0)) __pyx_t_31 = 1;
           } else if (unlikely(__pyx_t_25 >= __pyx_cur_scope->__pyx_v_V.shape[1])) __pyx_t_31 = 1;
           if (unlikely(__pyx_t_31 != -1)) {
             __Pyx_RaiseBufferIndexError(__pyx_t_31);
-            __PYX_ERR(0, 151, __pyx_L1_error)
+            __PYX_ERR(0, 158, __pyx_L1_error)
           }
-          __pyx_t_6 = PyFloat_FromDouble((((*((double *) ( /* dim=0 */ (__pyx_v_tr.data + __pyx_t_21 * __pyx_v_tr.strides[0]) ))) + (*((double *) ( /* dim=0 */ (__pyx_v_logarr.data + __pyx_t_20 * __pyx_v_logarr.strides[0]) )))) + (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_cur_scope->__pyx_v_V.data + __pyx_t_23 * __pyx_cur_scope->__pyx_v_V.strides[0]) ) + __pyx_t_25 * __pyx_cur_scope->__pyx_v_V.strides[1]) ))))); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 151, __pyx_L1_error)
+          __pyx_t_6 = PyFloat_FromDouble((((*((double *) ( /* dim=0 */ (__pyx_v_tr.data + __pyx_t_21 * __pyx_v_tr.strides[0]) ))) + (*((double *) ( /* dim=0 */ (__pyx_v_logarr.data + __pyx_t_20 * __pyx_v_logarr.strides[0]) )))) + (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_cur_scope->__pyx_v_V.data + __pyx_t_23 * __pyx_cur_scope->__pyx_v_V.strides[0]) ) + __pyx_t_25 * __pyx_cur_scope->__pyx_v_V.strides[1]) ))))); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 158, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
           __Pyx_XDECREF_SET(__pyx_v_value, __pyx_t_6);
           __pyx_t_6 = 0;
 
-          /* "soapcw/soapcw.pyx":153
+          /* "soapcw/soapcw.pyx":160
  *                         value = tr[j] + logarr[o] + V[t-1][i+j-tr_width]
  * 
  *                         if value>temp:             # <<<<<<<<<<<<<<
  *                             temp = value
  *                             V[t][i] = temp
  */
-          __pyx_t_6 = PyObject_RichCompare(__pyx_v_value, __pyx_v_temp, Py_GT); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 153, __pyx_L1_error)
-          __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_11 < 0)) __PYX_ERR(0, 153, __pyx_L1_error)
+          __pyx_t_6 = PyObject_RichCompare(__pyx_v_value, __pyx_v_temp, Py_GT); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 160, __pyx_L1_error)
+          __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_11 < 0)) __PYX_ERR(0, 160, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           if (__pyx_t_11) {
 
-            /* "soapcw/soapcw.pyx":154
+            /* "soapcw/soapcw.pyx":161
  * 
  *                         if value>temp:
  *                             temp = value             # <<<<<<<<<<<<<<
  *                             V[t][i] = temp
  *                             prev[t][i] = i+j-tr_width
  */
             __Pyx_INCREF(__pyx_v_value);
             __Pyx_DECREF_SET(__pyx_v_temp, __pyx_v_value);
 
-            /* "soapcw/soapcw.pyx":155
+            /* "soapcw/soapcw.pyx":162
  *                         if value>temp:
  *                             temp = value
  *                             V[t][i] = temp             # <<<<<<<<<<<<<<
  *                             prev[t][i] = i+j-tr_width
  *                         elif value == temp and j == int(tr_length/2.):
  */
-            __pyx_t_14 = __pyx_PyFloat_AsDouble(__pyx_v_temp); if (unlikely((__pyx_t_14 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 155, __pyx_L1_error)
+            __pyx_t_14 = __pyx_PyFloat_AsDouble(__pyx_v_temp); if (unlikely((__pyx_t_14 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 162, __pyx_L1_error)
             __pyx_t_25 = __pyx_v_t;
             __pyx_t_23 = __pyx_v_i;
             __pyx_t_31 = -1;
             if (__pyx_t_25 < 0) {
               __pyx_t_25 += __pyx_cur_scope->__pyx_v_V.shape[0];
               if (unlikely(__pyx_t_25 < 0)) __pyx_t_31 = 0;
             } else if (unlikely(__pyx_t_25 >= __pyx_cur_scope->__pyx_v_V.shape[0])) __pyx_t_31 = 0;
             if (__pyx_t_23 < 0) {
               __pyx_t_23 += __pyx_cur_scope->__pyx_v_V.shape[1];
               if (unlikely(__pyx_t_23 < 0)) __pyx_t_31 = 1;
             } else if (unlikely(__pyx_t_23 >= __pyx_cur_scope->__pyx_v_V.shape[1])) __pyx_t_31 = 1;
             if (unlikely(__pyx_t_31 != -1)) {
               __Pyx_RaiseBufferIndexError(__pyx_t_31);
-              __PYX_ERR(0, 155, __pyx_L1_error)
+              __PYX_ERR(0, 162, __pyx_L1_error)
             }
             *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_cur_scope->__pyx_v_V.data + __pyx_t_25 * __pyx_cur_scope->__pyx_v_V.strides[0]) ) + __pyx_t_23 * __pyx_cur_scope->__pyx_v_V.strides[1]) )) = __pyx_t_14;
 
-            /* "soapcw/soapcw.pyx":156
+            /* "soapcw/soapcw.pyx":163
  *                             temp = value
  *                             V[t][i] = temp
  *                             prev[t][i] = i+j-tr_width             # <<<<<<<<<<<<<<
  *                         elif value == temp and j == int(tr_length/2.):
  *                             temp = value
  */
             __pyx_t_23 = __pyx_v_t;
@@ -5648,92 +5762,92 @@
             } else if (unlikely(__pyx_t_23 >= __pyx_v_prev.shape[0])) __pyx_t_31 = 0;
             if (__pyx_t_25 < 0) {
               __pyx_t_25 += __pyx_v_prev.shape[1];
               if (unlikely(__pyx_t_25 < 0)) __pyx_t_31 = 1;
             } else if (unlikely(__pyx_t_25 >= __pyx_v_prev.shape[1])) __pyx_t_31 = 1;
             if (unlikely(__pyx_t_31 != -1)) {
               __Pyx_RaiseBufferIndexError(__pyx_t_31);
-              __PYX_ERR(0, 156, __pyx_L1_error)
+              __PYX_ERR(0, 163, __pyx_L1_error)
             }
             *((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_prev.data + __pyx_t_23 * __pyx_v_prev.strides[0]) ) + __pyx_t_25 * __pyx_v_prev.strides[1]) )) = ((__pyx_v_i + __pyx_v_j) - __pyx_v_tr_width);
 
-            /* "soapcw/soapcw.pyx":153
+            /* "soapcw/soapcw.pyx":160
  *                         value = tr[j] + logarr[o] + V[t-1][i+j-tr_width]
  * 
  *                         if value>temp:             # <<<<<<<<<<<<<<
  *                             temp = value
  *                             V[t][i] = temp
  */
             goto __pyx_L17;
           }
 
-          /* "soapcw/soapcw.pyx":157
+          /* "soapcw/soapcw.pyx":164
  *                             V[t][i] = temp
  *                             prev[t][i] = i+j-tr_width
  *                         elif value == temp and j == int(tr_length/2.):             # <<<<<<<<<<<<<<
  *                             temp = value
  *                             V[t][i] = temp
  */
-          __pyx_t_6 = PyObject_RichCompare(__pyx_v_value, __pyx_v_temp, Py_EQ); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 157, __pyx_L1_error)
-          __pyx_t_10 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_10 < 0)) __PYX_ERR(0, 157, __pyx_L1_error)
+          __pyx_t_6 = PyObject_RichCompare(__pyx_v_value, __pyx_v_temp, Py_EQ); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 164, __pyx_L1_error)
+          __pyx_t_10 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_10 < 0)) __PYX_ERR(0, 164, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           if (__pyx_t_10) {
           } else {
             __pyx_t_11 = __pyx_t_10;
             goto __pyx_L18_bool_binop_done;
           }
-          __pyx_t_6 = __Pyx_PyInt_From_int(__pyx_v_j); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 157, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyInt_From_int(__pyx_v_j); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 164, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_2 = __Pyx_PyInt_FromDouble((((double)__pyx_v_tr_length) / 2.)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 157, __pyx_L1_error)
+          __pyx_t_2 = __Pyx_PyInt_FromDouble((((double)__pyx_v_tr_length) / 2.)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 164, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_2);
-          __pyx_t_4 = PyObject_RichCompare(__pyx_t_6, __pyx_t_2, Py_EQ); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 157, __pyx_L1_error)
+          __pyx_t_4 = PyObject_RichCompare(__pyx_t_6, __pyx_t_2, Py_EQ); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 164, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-          __pyx_t_10 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_10 < 0)) __PYX_ERR(0, 157, __pyx_L1_error)
+          __pyx_t_10 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_10 < 0)) __PYX_ERR(0, 164, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
           __pyx_t_11 = __pyx_t_10;
           __pyx_L18_bool_binop_done:;
           if (__pyx_t_11) {
 
-            /* "soapcw/soapcw.pyx":158
+            /* "soapcw/soapcw.pyx":165
  *                             prev[t][i] = i+j-tr_width
  *                         elif value == temp and j == int(tr_length/2.):
  *                             temp = value             # <<<<<<<<<<<<<<
  *                             V[t][i] = temp
  *                             prev[t][i] = i+j-tr_width
  */
             __Pyx_INCREF(__pyx_v_value);
             __Pyx_DECREF_SET(__pyx_v_temp, __pyx_v_value);
 
-            /* "soapcw/soapcw.pyx":159
+            /* "soapcw/soapcw.pyx":166
  *                         elif value == temp and j == int(tr_length/2.):
  *                             temp = value
  *                             V[t][i] = temp             # <<<<<<<<<<<<<<
  *                             prev[t][i] = i+j-tr_width
  * 
  */
-            __pyx_t_14 = __pyx_PyFloat_AsDouble(__pyx_v_temp); if (unlikely((__pyx_t_14 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 159, __pyx_L1_error)
+            __pyx_t_14 = __pyx_PyFloat_AsDouble(__pyx_v_temp); if (unlikely((__pyx_t_14 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 166, __pyx_L1_error)
             __pyx_t_25 = __pyx_v_t;
             __pyx_t_23 = __pyx_v_i;
             __pyx_t_31 = -1;
             if (__pyx_t_25 < 0) {
               __pyx_t_25 += __pyx_cur_scope->__pyx_v_V.shape[0];
               if (unlikely(__pyx_t_25 < 0)) __pyx_t_31 = 0;
             } else if (unlikely(__pyx_t_25 >= __pyx_cur_scope->__pyx_v_V.shape[0])) __pyx_t_31 = 0;
             if (__pyx_t_23 < 0) {
               __pyx_t_23 += __pyx_cur_scope->__pyx_v_V.shape[1];
               if (unlikely(__pyx_t_23 < 0)) __pyx_t_31 = 1;
             } else if (unlikely(__pyx_t_23 >= __pyx_cur_scope->__pyx_v_V.shape[1])) __pyx_t_31 = 1;
             if (unlikely(__pyx_t_31 != -1)) {
               __Pyx_RaiseBufferIndexError(__pyx_t_31);
-              __PYX_ERR(0, 159, __pyx_L1_error)
+              __PYX_ERR(0, 166, __pyx_L1_error)
             }
             *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_cur_scope->__pyx_v_V.data + __pyx_t_25 * __pyx_cur_scope->__pyx_v_V.strides[0]) ) + __pyx_t_23 * __pyx_cur_scope->__pyx_v_V.strides[1]) )) = __pyx_t_14;
 
-            /* "soapcw/soapcw.pyx":160
+            /* "soapcw/soapcw.pyx":167
  *                             temp = value
  *                             V[t][i] = temp
  *                             prev[t][i] = i+j-tr_width             # <<<<<<<<<<<<<<
  * 
  * 
  */
             __pyx_t_23 = __pyx_v_t;
@@ -5745,81 +5859,81 @@
             } else if (unlikely(__pyx_t_23 >= __pyx_v_prev.shape[0])) __pyx_t_31 = 0;
             if (__pyx_t_25 < 0) {
               __pyx_t_25 += __pyx_v_prev.shape[1];
               if (unlikely(__pyx_t_25 < 0)) __pyx_t_31 = 1;
             } else if (unlikely(__pyx_t_25 >= __pyx_v_prev.shape[1])) __pyx_t_31 = 1;
             if (unlikely(__pyx_t_31 != -1)) {
               __Pyx_RaiseBufferIndexError(__pyx_t_31);
-              __PYX_ERR(0, 160, __pyx_L1_error)
+              __PYX_ERR(0, 167, __pyx_L1_error)
             }
             *((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_prev.data + __pyx_t_23 * __pyx_v_prev.strides[0]) ) + __pyx_t_25 * __pyx_v_prev.strides[1]) )) = ((__pyx_v_i + __pyx_v_j) - __pyx_v_tr_width);
 
-            /* "soapcw/soapcw.pyx":157
+            /* "soapcw/soapcw.pyx":164
  *                             V[t][i] = temp
  *                             prev[t][i] = i+j-tr_width
  *                         elif value == temp and j == int(tr_length/2.):             # <<<<<<<<<<<<<<
  *                             temp = value
  *                             V[t][i] = temp
  */
           }
           __pyx_L17:;
 
-          /* "soapcw/soapcw.pyx":149
+          /* "soapcw/soapcw.pyx":156
  *                 temp = -1e6
  *                 for j in range(tr_length):
  *                     if i+j-tr_width>=0 and i+j-tr_width<=width-1:             # <<<<<<<<<<<<<<
  *                         o = obs_ind[t][i]
  *                         value = tr[j] + logarr[o] + V[t-1][i+j-tr_width]
  */
         }
       }
     }
 
-    /* "soapcw/soapcw.pyx":163
+    /* "soapcw/soapcw.pyx":170
  * 
  * 
  *             if self.prog == True:             # <<<<<<<<<<<<<<
  *                 if pt>pbar:
  *                     stdout.write('\r{} %'.format(round(pt)))
  */
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_prog); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 163, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_prog); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 170, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_2 = PyObject_RichCompare(__pyx_t_4, Py_True, Py_EQ); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 163, __pyx_L1_error)
+    __pyx_t_2 = PyObject_RichCompare(__pyx_t_4, Py_True, Py_EQ); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 170, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_11 < 0)) __PYX_ERR(0, 163, __pyx_L1_error)
+    __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_11 < 0)) __PYX_ERR(0, 170, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     if (__pyx_t_11) {
 
-      /* "soapcw/soapcw.pyx":164
+      /* "soapcw/soapcw.pyx":171
  * 
  *             if self.prog == True:
  *                 if pt>pbar:             # <<<<<<<<<<<<<<
  *                     stdout.write('\r{} %'.format(round(pt)))
  *                     stdout.flush()
  */
       __pyx_t_11 = ((__pyx_v_pt > __pyx_v_pbar) != 0);
       if (__pyx_t_11) {
 
-        /* "soapcw/soapcw.pyx":165
+        /* "soapcw/soapcw.pyx":172
  *             if self.prog == True:
  *                 if pt>pbar:
  *                     stdout.write('\r{} %'.format(round(pt)))             # <<<<<<<<<<<<<<
  *                     stdout.flush()
  *                     pbar+=100./len(obs)
  */
-        __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_stdout); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 165, __pyx_L1_error)
+        __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_stdout); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 172, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_write); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 165, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_write); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 172, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-        __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u__4, __pyx_n_s_format); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 165, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u__4, __pyx_n_s_format); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 172, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
-        __pyx_t_1 = PyFloat_FromDouble(__pyx_v_pt); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 165, __pyx_L1_error)
+        __pyx_t_1 = PyFloat_FromDouble(__pyx_v_pt); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 172, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
-        __pyx_t_17 = __Pyx_PyObject_CallOneArg(__pyx_builtin_round, __pyx_t_1); if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 165, __pyx_L1_error)
+        __pyx_t_17 = __Pyx_PyObject_CallOneArg(__pyx_builtin_round, __pyx_t_1); if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 172, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_17);
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         __pyx_t_1 = NULL;
         if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_3);
           if (likely(__pyx_t_1)) {
             PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
@@ -5827,15 +5941,15 @@
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_4 = (__pyx_t_1) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_1, __pyx_t_17) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_17);
         __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
         __Pyx_DECREF(__pyx_t_17); __pyx_t_17 = 0;
-        if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 165, __pyx_L1_error)
+        if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 172, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         __pyx_t_3 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_6))) {
           __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_6);
           if (likely(__pyx_t_3)) {
             PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
@@ -5843,149 +5957,149 @@
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_6, function);
           }
         }
         __pyx_t_2 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_6, __pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_t_4);
         __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
         __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 165, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 172, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-        /* "soapcw/soapcw.pyx":166
+        /* "soapcw/soapcw.pyx":173
  *                 if pt>pbar:
  *                     stdout.write('\r{} %'.format(round(pt)))
  *                     stdout.flush()             # <<<<<<<<<<<<<<
  *                     pbar+=100./len(obs)
  * 
  */
-        __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_stdout); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 166, __pyx_L1_error)
+        __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_stdout); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 173, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_flush); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 166, __pyx_L1_error)
+        __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_flush); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 173, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __pyx_t_6 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
           __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_4);
           if (likely(__pyx_t_6)) {
             PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
             __Pyx_INCREF(__pyx_t_6);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_4, function);
           }
         }
         __pyx_t_2 = (__pyx_t_6) ? __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_6) : __Pyx_PyObject_CallNoArg(__pyx_t_4);
         __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 166, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 173, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-        /* "soapcw/soapcw.pyx":167
+        /* "soapcw/soapcw.pyx":174
  *                     stdout.write('\r{} %'.format(round(pt)))
  *                     stdout.flush()
  *                     pbar+=100./len(obs)             # <<<<<<<<<<<<<<
  * 
  *         cdef double max_end_prob = max(V[length-1][i] for i in range(width))
  */
         __pyx_t_9 = __Pyx_MemoryView_Len(__pyx_v_obs); 
         if (unlikely(__pyx_t_9 == 0)) {
           PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-          __PYX_ERR(0, 167, __pyx_L1_error)
+          __PYX_ERR(0, 174, __pyx_L1_error)
         }
         __pyx_v_pbar = (__pyx_v_pbar + (100. / ((double)__pyx_t_9)));
 
-        /* "soapcw/soapcw.pyx":164
+        /* "soapcw/soapcw.pyx":171
  * 
  *             if self.prog == True:
  *                 if pt>pbar:             # <<<<<<<<<<<<<<
  *                     stdout.write('\r{} %'.format(round(pt)))
  *                     stdout.flush()
  */
       }
 
-      /* "soapcw/soapcw.pyx":163
+      /* "soapcw/soapcw.pyx":170
  * 
  * 
  *             if self.prog == True:             # <<<<<<<<<<<<<<
  *                 if pt>pbar:
  *                     stdout.write('\r{} %'.format(round(pt)))
  */
     }
   }
 
-  /* "soapcw/soapcw.pyx":169
+  /* "soapcw/soapcw.pyx":176
  *                     pbar+=100./len(obs)
  * 
  *         cdef double max_end_prob = max(V[length-1][i] for i in range(width))             # <<<<<<<<<<<<<<
  *         cdef int previous
  *         cdef int[:] vit_track = np.zeros(length,dtype=np.int32)
  */
-  __pyx_t_2 = __pyx_pf_6soapcw_6soapcw_15single_detector_3run_genexpr(((PyObject*)__pyx_cur_scope)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 169, __pyx_L1_error)
+  __pyx_t_2 = __pyx_pf_6soapcw_6soapcw_15single_detector_3run_genexpr(((PyObject*)__pyx_cur_scope)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 176, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_builtin_max, __pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 169, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_builtin_max, __pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 176, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_14 = __pyx_PyFloat_AsDouble(__pyx_t_4); if (unlikely((__pyx_t_14 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 169, __pyx_L1_error)
+  __pyx_t_14 = __pyx_PyFloat_AsDouble(__pyx_t_4); if (unlikely((__pyx_t_14 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 176, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_v_max_end_prob = __pyx_t_14;
 
-  /* "soapcw/soapcw.pyx":171
+  /* "soapcw/soapcw.pyx":178
  *         cdef double max_end_prob = max(V[length-1][i] for i in range(width))
  *         cdef int previous
  *         cdef int[:] vit_track = np.zeros(length,dtype=np.int32)             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 171, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 178, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 171, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 178, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyInt_From_int(__pyx_cur_scope->__pyx_v_length); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 171, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_int(__pyx_cur_scope->__pyx_v_length); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 178, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 171, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 178, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_4);
   PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_4);
   __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 171, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 178, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 171, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 178, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_17 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_int32); if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 171, __pyx_L1_error)
+  __pyx_t_17 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_int32); if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 178, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_17);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_dtype, __pyx_t_17) < 0) __PYX_ERR(0, 171, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_dtype, __pyx_t_17) < 0) __PYX_ERR(0, 178, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_17); __pyx_t_17 = 0;
-  __pyx_t_17 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_6, __pyx_t_4); if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 171, __pyx_L1_error)
+  __pyx_t_17 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_6, __pyx_t_4); if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 178, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_17);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_32 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_17, PyBUF_WRITABLE); if (unlikely(!__pyx_t_32.memview)) __PYX_ERR(0, 171, __pyx_L1_error)
+  __pyx_t_32 = __Pyx_PyObject_to_MemoryviewSlice_ds_int(__pyx_t_17, PyBUF_WRITABLE); if (unlikely(!__pyx_t_32.memview)) __PYX_ERR(0, 178, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_17); __pyx_t_17 = 0;
   __pyx_v_vit_track = __pyx_t_32;
   __pyx_t_32.memview = NULL;
   __pyx_t_32.data = NULL;
 
-  /* "soapcw/soapcw.pyx":174
+  /* "soapcw/soapcw.pyx":181
  * 
  * 
  *         for i in range(width):             # <<<<<<<<<<<<<<
  *             if V[length-1][i] == max_end_prob:
  *                 vit_track[length-1] = i # appends maximum path value from final step
  */
   __pyx_t_8 = __pyx_cur_scope->__pyx_v_width;
   __pyx_t_18 = __pyx_t_8;
   for (__pyx_t_19 = 0; __pyx_t_19 < __pyx_t_18; __pyx_t_19+=1) {
     __pyx_v_i = __pyx_t_19;
 
-    /* "soapcw/soapcw.pyx":175
+    /* "soapcw/soapcw.pyx":182
  * 
  *         for i in range(width):
  *             if V[length-1][i] == max_end_prob:             # <<<<<<<<<<<<<<
  *                 vit_track[length-1] = i # appends maximum path value from final step
  *                 previous = prev[length-1][i]
  */
     __pyx_t_25 = (__pyx_cur_scope->__pyx_v_length - 1);
@@ -5997,39 +6111,39 @@
     } else if (unlikely(__pyx_t_25 >= __pyx_cur_scope->__pyx_v_V.shape[0])) __pyx_t_22 = 0;
     if (__pyx_t_23 < 0) {
       __pyx_t_23 += __pyx_cur_scope->__pyx_v_V.shape[1];
       if (unlikely(__pyx_t_23 < 0)) __pyx_t_22 = 1;
     } else if (unlikely(__pyx_t_23 >= __pyx_cur_scope->__pyx_v_V.shape[1])) __pyx_t_22 = 1;
     if (unlikely(__pyx_t_22 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_22);
-      __PYX_ERR(0, 175, __pyx_L1_error)
+      __PYX_ERR(0, 182, __pyx_L1_error)
     }
     __pyx_t_11 = (((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_cur_scope->__pyx_v_V.data + __pyx_t_25 * __pyx_cur_scope->__pyx_v_V.strides[0]) ) + __pyx_t_23 * __pyx_cur_scope->__pyx_v_V.strides[1]) ))) == __pyx_v_max_end_prob) != 0);
     if (__pyx_t_11) {
 
-      /* "soapcw/soapcw.pyx":176
+      /* "soapcw/soapcw.pyx":183
  *         for i in range(width):
  *             if V[length-1][i] == max_end_prob:
  *                 vit_track[length-1] = i # appends maximum path value from final step             # <<<<<<<<<<<<<<
  *                 previous = prev[length-1][i]
  *                 break
  */
       __pyx_t_23 = (__pyx_cur_scope->__pyx_v_length - 1);
       __pyx_t_22 = -1;
       if (__pyx_t_23 < 0) {
         __pyx_t_23 += __pyx_v_vit_track.shape[0];
         if (unlikely(__pyx_t_23 < 0)) __pyx_t_22 = 0;
       } else if (unlikely(__pyx_t_23 >= __pyx_v_vit_track.shape[0])) __pyx_t_22 = 0;
       if (unlikely(__pyx_t_22 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_22);
-        __PYX_ERR(0, 176, __pyx_L1_error)
+        __PYX_ERR(0, 183, __pyx_L1_error)
       }
       *((int *) ( /* dim=0 */ (__pyx_v_vit_track.data + __pyx_t_23 * __pyx_v_vit_track.strides[0]) )) = __pyx_v_i;
 
-      /* "soapcw/soapcw.pyx":177
+      /* "soapcw/soapcw.pyx":184
  *             if V[length-1][i] == max_end_prob:
  *                 vit_track[length-1] = i # appends maximum path value from final step
  *                 previous = prev[length-1][i]             # <<<<<<<<<<<<<<
  *                 break
  * 
  */
       __pyx_t_23 = (__pyx_cur_scope->__pyx_v_length - 1);
@@ -6041,69 +6155,69 @@
       } else if (unlikely(__pyx_t_23 >= __pyx_v_prev.shape[0])) __pyx_t_22 = 0;
       if (__pyx_t_25 < 0) {
         __pyx_t_25 += __pyx_v_prev.shape[1];
         if (unlikely(__pyx_t_25 < 0)) __pyx_t_22 = 1;
       } else if (unlikely(__pyx_t_25 >= __pyx_v_prev.shape[1])) __pyx_t_22 = 1;
       if (unlikely(__pyx_t_22 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_22);
-        __PYX_ERR(0, 177, __pyx_L1_error)
+        __PYX_ERR(0, 184, __pyx_L1_error)
       }
       __pyx_v_previous = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_prev.data + __pyx_t_23 * __pyx_v_prev.strides[0]) ) + __pyx_t_25 * __pyx_v_prev.strides[1]) )));
 
-      /* "soapcw/soapcw.pyx":178
+      /* "soapcw/soapcw.pyx":185
  *                 vit_track[length-1] = i # appends maximum path value from final step
  *                 previous = prev[length-1][i]
  *                 break             # <<<<<<<<<<<<<<
  * 
  *         for t in range(len(V)-2,-1,-1):
  */
       goto __pyx_L23_break;
 
-      /* "soapcw/soapcw.pyx":175
+      /* "soapcw/soapcw.pyx":182
  * 
  *         for i in range(width):
  *             if V[length-1][i] == max_end_prob:             # <<<<<<<<<<<<<<
  *                 vit_track[length-1] = i # appends maximum path value from final step
  *                 previous = prev[length-1][i]
  */
     }
   }
   __pyx_L23_break:;
 
-  /* "soapcw/soapcw.pyx":180
+  /* "soapcw/soapcw.pyx":187
  *                 break
  * 
  *         for t in range(len(V)-2,-1,-1):             # <<<<<<<<<<<<<<
  *             vit_track[t] = previous # insert previous step
  *             previous = prev[t][previous]
  */
   __pyx_t_9 = __Pyx_MemoryView_Len(__pyx_cur_scope->__pyx_v_V); 
   for (__pyx_t_8 = (__pyx_t_9 - 2); __pyx_t_8 > -1; __pyx_t_8-=1) {
     __pyx_v_t = __pyx_t_8;
 
-    /* "soapcw/soapcw.pyx":181
+    /* "soapcw/soapcw.pyx":188
  * 
  *         for t in range(len(V)-2,-1,-1):
  *             vit_track[t] = previous # insert previous step             # <<<<<<<<<<<<<<
  *             previous = prev[t][previous]
  * 
  */
     __pyx_t_25 = __pyx_v_t;
     __pyx_t_18 = -1;
     if (__pyx_t_25 < 0) {
       __pyx_t_25 += __pyx_v_vit_track.shape[0];
       if (unlikely(__pyx_t_25 < 0)) __pyx_t_18 = 0;
     } else if (unlikely(__pyx_t_25 >= __pyx_v_vit_track.shape[0])) __pyx_t_18 = 0;
     if (unlikely(__pyx_t_18 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_18);
-      __PYX_ERR(0, 181, __pyx_L1_error)
+      __PYX_ERR(0, 188, __pyx_L1_error)
     }
     *((int *) ( /* dim=0 */ (__pyx_v_vit_track.data + __pyx_t_25 * __pyx_v_vit_track.strides[0]) )) = __pyx_v_previous;
 
-    /* "soapcw/soapcw.pyx":182
+    /* "soapcw/soapcw.pyx":189
  *         for t in range(len(V)-2,-1,-1):
  *             vit_track[t] = previous # insert previous step
  *             previous = prev[t][previous]             # <<<<<<<<<<<<<<
  * 
  *         self.vit_track = np.array(vit_track)
  */
     __pyx_t_25 = __pyx_v_t;
@@ -6115,134 +6229,134 @@
     } else if (unlikely(__pyx_t_25 >= __pyx_v_prev.shape[0])) __pyx_t_18 = 0;
     if (__pyx_t_23 < 0) {
       __pyx_t_23 += __pyx_v_prev.shape[1];
       if (unlikely(__pyx_t_23 < 0)) __pyx_t_18 = 1;
     } else if (unlikely(__pyx_t_23 >= __pyx_v_prev.shape[1])) __pyx_t_18 = 1;
     if (unlikely(__pyx_t_18 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_18);
-      __PYX_ERR(0, 182, __pyx_L1_error)
+      __PYX_ERR(0, 189, __pyx_L1_error)
     }
     __pyx_v_previous = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_prev.data + __pyx_t_25 * __pyx_v_prev.strides[0]) ) + __pyx_t_23 * __pyx_v_prev.strides[1]) )));
   }
 
-  /* "soapcw/soapcw.pyx":184
+  /* "soapcw/soapcw.pyx":191
  *             previous = prev[t][previous]
  * 
  *         self.vit_track = np.array(vit_track)             # <<<<<<<<<<<<<<
  *         self.max_end_prob = max_end_prob
  *         self.V = np.array(V)
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 191, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_array); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_array); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 191, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_memoryview_fromslice(__pyx_v_vit_track, 1, (PyObject *(*)(char *)) __pyx_memview_get_int, (int (*)(char *, PyObject *)) __pyx_memview_set_int, 0);; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_t_4 = __pyx_memoryview_fromslice(__pyx_v_vit_track, 1, (PyObject *(*)(char *)) __pyx_memview_get_int, (int (*)(char *, PyObject *)) __pyx_memview_set_int, 0);; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 191, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __pyx_t_2 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_6))) {
     __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_6);
     if (likely(__pyx_t_2)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
       __Pyx_INCREF(__pyx_t_2);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_6, function);
     }
   }
   __pyx_t_17 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_6, __pyx_t_2, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_t_4);
   __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 184, __pyx_L1_error)
+  if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 191, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_17);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_vit_track, __pyx_t_17) < 0) __PYX_ERR(0, 184, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_vit_track, __pyx_t_17) < 0) __PYX_ERR(0, 191, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_17); __pyx_t_17 = 0;
 
-  /* "soapcw/soapcw.pyx":185
+  /* "soapcw/soapcw.pyx":192
  * 
  *         self.vit_track = np.array(vit_track)
  *         self.max_end_prob = max_end_prob             # <<<<<<<<<<<<<<
  *         self.V = np.array(V)
  *         self.prev = np.array(prev)
  */
-  __pyx_t_17 = PyFloat_FromDouble(__pyx_v_max_end_prob); if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 185, __pyx_L1_error)
+  __pyx_t_17 = PyFloat_FromDouble(__pyx_v_max_end_prob); if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 192, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_17);
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_max_end_prob, __pyx_t_17) < 0) __PYX_ERR(0, 185, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_max_end_prob, __pyx_t_17) < 0) __PYX_ERR(0, 192, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_17); __pyx_t_17 = 0;
 
-  /* "soapcw/soapcw.pyx":186
+  /* "soapcw/soapcw.pyx":193
  *         self.vit_track = np.array(vit_track)
  *         self.max_end_prob = max_end_prob
  *         self.V = np.array(V)             # <<<<<<<<<<<<<<
  *         self.prev = np.array(prev)
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 186, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 193, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_array); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 186, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_array); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 193, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __pyx_memoryview_fromslice(__pyx_cur_scope->__pyx_v_V, 2, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 186, __pyx_L1_error)
+  __pyx_t_6 = __pyx_memoryview_fromslice(__pyx_cur_scope->__pyx_v_V, 2, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 193, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __pyx_t_2 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
     __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_4);
     if (likely(__pyx_t_2)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
       __Pyx_INCREF(__pyx_t_2);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_4, function);
     }
   }
   __pyx_t_17 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_2, __pyx_t_6) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_6);
   __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 186, __pyx_L1_error)
+  if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 193, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_17);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_V, __pyx_t_17) < 0) __PYX_ERR(0, 186, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_V, __pyx_t_17) < 0) __PYX_ERR(0, 193, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_17); __pyx_t_17 = 0;
 
-  /* "soapcw/soapcw.pyx":187
+  /* "soapcw/soapcw.pyx":194
  *         self.max_end_prob = max_end_prob
  *         self.V = np.array(V)
  *         self.prev = np.array(prev)             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 187, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 194, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_array); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 187, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_array); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 194, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_memoryview_fromslice(__pyx_v_prev, 2, (PyObject *(*)(char *)) __pyx_memview_get_int, (int (*)(char *, PyObject *)) __pyx_memview_set_int, 0);; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 187, __pyx_L1_error)
+  __pyx_t_4 = __pyx_memoryview_fromslice(__pyx_v_prev, 2, (PyObject *(*)(char *)) __pyx_memview_get_int, (int (*)(char *, PyObject *)) __pyx_memview_set_int, 0);; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 194, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __pyx_t_2 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_6))) {
     __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_6);
     if (likely(__pyx_t_2)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
       __Pyx_INCREF(__pyx_t_2);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_6, function);
     }
   }
   __pyx_t_17 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_6, __pyx_t_2, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_t_4);
   __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 187, __pyx_L1_error)
+  if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 194, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_17);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_prev, __pyx_t_17) < 0) __PYX_ERR(0, 187, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_prev, __pyx_t_17) < 0) __PYX_ERR(0, 194, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_17); __pyx_t_17 = 0;
 
-  /* "soapcw/soapcw.pyx":77
+  /* "soapcw/soapcw.pyx":84
  * 
  * 
- *     def run(self,double[:] tr, double[:, :] obs, lookup_file = None):             # <<<<<<<<<<<<<<
+ *     def run(self,double[:] tr, double[:, :] obs, lookup_table = None):             # <<<<<<<<<<<<<<
  *         '''
  *         Run the viterbi algorithm for given single set of data and 3x1 transition matrix.
  */
 
   /* function exit code */
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
@@ -6276,44 +6390,44 @@
   __PYX_XDEC_MEMVIEW(&__pyx_v_obs, 1);
   __Pyx_DECREF(((PyObject *)__pyx_cur_scope));
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "soapcw/soapcw.pyx":192
+/* "soapcw/soapcw.pyx":199
  * class two_detector(object):
  * 
- *     def __init__(self, tr, obs1, obs2, lookup_file_2det = None, lookup_file_1det = None, prog = False,fractions=None, make_vitmap=True):             # <<<<<<<<<<<<<<
+ *     def __init__(self, tr, obs1, obs2, lookup_table_2det = None, lookup_table_1det = None, prog = False,fractions=None, make_vitmap=True):             # <<<<<<<<<<<<<<
  *         '''
  *         viterbi algorithm for two detectors with an optional line aware statistic
  */
 
 /* Python wrapper */
 static PyObject *__pyx_pw_6soapcw_6soapcw_12two_detector_1__init__(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static char __pyx_doc_6soapcw_6soapcw_12two_detector___init__[] = "\n        viterbi algorithm for two detectors with an optional line aware statistic\n        uses S = \014rac{p(ss \\mid x)}{p(nn \\mid x)+p(ns \\mid x)+p(sn \\mid x)}\n        [currently configured for averaging over 48 SFT need to change to correctly use any]\n        Args\n        ---------\n        tr1: array\n            transition matrix\n        obs11: array\n            observation from detector 1 (float64 array)\n        obs21: array\n            observation from detector 2 (float64 array)\n        lookup_file_1det: string (optional)\n            filepath of lookup table for the one detector case\n        lookup_file_2det: string ( optional)\n            filepath of lookup table for the two detector case\n        prog: bool (optional)\n            show progress bar if True \n        fractions: array (optional)\n            array of the ratio of the noise floor and amount of data between detectors\n        returns\n        -----------\n        vit_track1: array\n            path in detector 1\n        vit_track2: array\n            path in detector2\n        vit_track_ref: array\n            path in reference detector\n        V: array\n            viterbi values in reference detector\n        prev: array\n            previous positions before jump\n        max_prob: double\n            maximum end path probability\n\n        ";
+static char __pyx_doc_6soapcw_6soapcw_12two_detector___init__[] = "\n        viterbi algorithm for two detectors with an optional line aware statistic\n        uses S = \014rac{p(ss \\mid x)}{p(nn \\mid x)+p(ns \\mid x)+p(sn \\mid x)}\n        [currently configured for averaging over 48 SFT need to change to correctly use any]\n        Args\n        ---------\n        tr1: array\n            transition matrix\n        obs11: array\n            observation from detector 1 (float64 array)\n        obs21: array\n            observation from detector 2 (float64 array)\n        lookup_table_1det: string (optional)\n            filepath of lookup table for the one detector case or LineAwareStatistic claess\n        lookup_table_2det: string ( optional)\n            filepath of lookup table for the two detector caseor LineAwareStatistic claess \n        prog: bool (optional)\n            show progress bar if True \n        fractions: array (optional)\n            array of the ratio of the noise floor and amount of data between detectors\n        returns\n        -----------\n        vit_track1: array\n            path in detector 1\n        vit_track2: array\n            path in detector2\n        vit_track_ref: array\n            path in reference detector\n        V: array\n            viterbi values in reference detector\n        prev: array\n            previous positions before jump\n        max_prob: double\n            maximum end path probability\n\n        ";
 static PyMethodDef __pyx_mdef_6soapcw_6soapcw_12two_detector_1__init__ = {"__init__", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6soapcw_6soapcw_12two_detector_1__init__, METH_VARARGS|METH_KEYWORDS, __pyx_doc_6soapcw_6soapcw_12two_detector___init__};
 static PyObject *__pyx_pw_6soapcw_6soapcw_12two_detector_1__init__(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyObject *__pyx_v_self = 0;
   PyObject *__pyx_v_tr = 0;
   PyObject *__pyx_v_obs1 = 0;
   PyObject *__pyx_v_obs2 = 0;
-  PyObject *__pyx_v_lookup_file_2det = 0;
-  PyObject *__pyx_v_lookup_file_1det = 0;
+  PyObject *__pyx_v_lookup_table_2det = 0;
+  PyObject *__pyx_v_lookup_table_1det = 0;
   PyObject *__pyx_v_prog = 0;
   PyObject *__pyx_v_fractions = 0;
   PyObject *__pyx_v_make_vitmap = 0;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__init__ (wrapper)", 0);
   {
-    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_self,&__pyx_n_s_tr,&__pyx_n_s_obs1,&__pyx_n_s_obs2,&__pyx_n_s_lookup_file_2det,&__pyx_n_s_lookup_file_1det,&__pyx_n_s_prog,&__pyx_n_s_fractions,&__pyx_n_s_make_vitmap,0};
+    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_self,&__pyx_n_s_tr,&__pyx_n_s_obs1,&__pyx_n_s_obs2,&__pyx_n_s_lookup_table_2det,&__pyx_n_s_lookup_table_1det,&__pyx_n_s_prog,&__pyx_n_s_fractions,&__pyx_n_s_make_vitmap,0};
     PyObject* values[9] = {0,0,0,0,0,0,0,0,0};
     values[4] = ((PyObject *)((PyObject *)Py_None));
     values[5] = ((PyObject *)((PyObject *)Py_None));
     values[6] = ((PyObject *)((PyObject *)Py_False));
     values[7] = ((PyObject *)((PyObject *)Py_None));
     values[8] = ((PyObject *)((PyObject *)Py_True));
     if (unlikely(__pyx_kwds)) {
@@ -6346,38 +6460,38 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_tr)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__init__", 0, 4, 9, 1); __PYX_ERR(0, 192, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__init__", 0, 4, 9, 1); __PYX_ERR(0, 199, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_obs1)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__init__", 0, 4, 9, 2); __PYX_ERR(0, 192, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__init__", 0, 4, 9, 2); __PYX_ERR(0, 199, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_obs2)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__init__", 0, 4, 9, 3); __PYX_ERR(0, 192, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__init__", 0, 4, 9, 3); __PYX_ERR(0, 199, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (kw_args > 0) {
-          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_lookup_file_2det);
+          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_lookup_table_2det);
           if (value) { values[4] = value; kw_args--; }
         }
         CYTHON_FALLTHROUGH;
         case  5:
         if (kw_args > 0) {
-          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_lookup_file_1det);
+          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_lookup_table_1det);
           if (value) { values[5] = value; kw_args--; }
         }
         CYTHON_FALLTHROUGH;
         case  6:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_prog);
           if (value) { values[6] = value; kw_args--; }
@@ -6392,15 +6506,15 @@
         case  8:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_make_vitmap);
           if (value) { values[8] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) __PYX_ERR(0, 192, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) __PYX_ERR(0, 199, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  9: values[8] = PyTuple_GET_ITEM(__pyx_args, 8);
         CYTHON_FALLTHROUGH;
         case  8: values[7] = PyTuple_GET_ITEM(__pyx_args, 7);
         CYTHON_FALLTHROUGH;
@@ -6418,36 +6532,36 @@
         default: goto __pyx_L5_argtuple_error;
       }
     }
     __pyx_v_self = values[0];
     __pyx_v_tr = values[1];
     __pyx_v_obs1 = values[2];
     __pyx_v_obs2 = values[3];
-    __pyx_v_lookup_file_2det = values[4];
-    __pyx_v_lookup_file_1det = values[5];
+    __pyx_v_lookup_table_2det = values[4];
+    __pyx_v_lookup_table_1det = values[5];
     __pyx_v_prog = values[6];
     __pyx_v_fractions = values[7];
     __pyx_v_make_vitmap = values[8];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__init__", 0, 4, 9, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 192, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("__init__", 0, 4, 9, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 199, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("soapcw.soapcw.two_detector.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_6soapcw_6soapcw_12two_detector___init__(__pyx_self, __pyx_v_self, __pyx_v_tr, __pyx_v_obs1, __pyx_v_obs2, __pyx_v_lookup_file_2det, __pyx_v_lookup_file_1det, __pyx_v_prog, __pyx_v_fractions, __pyx_v_make_vitmap);
+  __pyx_r = __pyx_pf_6soapcw_6soapcw_12two_detector___init__(__pyx_self, __pyx_v_self, __pyx_v_tr, __pyx_v_obs1, __pyx_v_obs2, __pyx_v_lookup_table_2det, __pyx_v_lookup_table_1det, __pyx_v_prog, __pyx_v_fractions, __pyx_v_make_vitmap);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_6soapcw_6soapcw_12two_detector___init__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_tr, PyObject *__pyx_v_obs1, PyObject *__pyx_v_obs2, PyObject *__pyx_v_lookup_file_2det, PyObject *__pyx_v_lookup_file_1det, PyObject *__pyx_v_prog, PyObject *__pyx_v_fractions, PyObject *__pyx_v_make_vitmap) {
+static PyObject *__pyx_pf_6soapcw_6soapcw_12two_detector___init__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_tr, PyObject *__pyx_v_obs1, PyObject *__pyx_v_obs2, PyObject *__pyx_v_lookup_table_2det, PyObject *__pyx_v_lookup_table_1det, PyObject *__pyx_v_prog, PyObject *__pyx_v_fractions, PyObject *__pyx_v_make_vitmap) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   int __pyx_t_1;
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
   Py_ssize_t __pyx_t_5;
@@ -6458,497 +6572,497 @@
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__init__", 0);
   __Pyx_INCREF(__pyx_v_tr);
   __Pyx_INCREF(__pyx_v_obs1);
   __Pyx_INCREF(__pyx_v_obs2);
 
-  /* "soapcw/soapcw.pyx":230
+  /* "soapcw/soapcw.pyx":237
  *         '''
  * 
  *         if len(np.shape(obs1)) < 2 or len(np.shape(obs1)) < 2:             # <<<<<<<<<<<<<<
  *             raise Exception("Please input 2D array for observation data")
  *         if np.shape(obs1) != np.shape(obs2):
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 230, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 237, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_shape); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 230, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_shape); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 237, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_t_3 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
     __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_4);
     if (likely(__pyx_t_3)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
       __Pyx_INCREF(__pyx_t_3);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_4, function);
     }
   }
   __pyx_t_2 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_3, __pyx_v_obs1) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_v_obs1);
   __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 230, __pyx_L1_error)
+  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 237, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_5 = PyObject_Length(__pyx_t_2); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 230, __pyx_L1_error)
+  __pyx_t_5 = PyObject_Length(__pyx_t_2); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 237, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_t_6 = ((__pyx_t_5 < 2) != 0);
   if (!__pyx_t_6) {
   } else {
     __pyx_t_1 = __pyx_t_6;
     goto __pyx_L4_bool_binop_done;
   }
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 230, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 237, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_shape); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 230, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_shape); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 237, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_t_4 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
     __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
     if (likely(__pyx_t_4)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
       __Pyx_INCREF(__pyx_t_4);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_3, function);
     }
   }
   __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_v_obs1) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_obs1);
   __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 230, __pyx_L1_error)
+  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 237, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_5 = PyObject_Length(__pyx_t_2); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 230, __pyx_L1_error)
+  __pyx_t_5 = PyObject_Length(__pyx_t_2); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 237, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_t_6 = ((__pyx_t_5 < 2) != 0);
   __pyx_t_1 = __pyx_t_6;
   __pyx_L4_bool_binop_done:;
   if (unlikely(__pyx_t_1)) {
 
-    /* "soapcw/soapcw.pyx":231
+    /* "soapcw/soapcw.pyx":238
  * 
  *         if len(np.shape(obs1)) < 2 or len(np.shape(obs1)) < 2:
  *             raise Exception("Please input 2D array for observation data")             # <<<<<<<<<<<<<<
  *         if np.shape(obs1) != np.shape(obs2):
  *             raise Exception("Please make sure teh two input data have the same dimensions")
  */
-    __pyx_t_2 = __Pyx_PyObject_Call(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])), __pyx_tuple__5, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 231, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_Call(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])), __pyx_tuple__5, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 238, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_Raise(__pyx_t_2, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __PYX_ERR(0, 231, __pyx_L1_error)
+    __PYX_ERR(0, 238, __pyx_L1_error)
 
-    /* "soapcw/soapcw.pyx":230
+    /* "soapcw/soapcw.pyx":237
  *         '''
  * 
  *         if len(np.shape(obs1)) < 2 or len(np.shape(obs1)) < 2:             # <<<<<<<<<<<<<<
  *             raise Exception("Please input 2D array for observation data")
  *         if np.shape(obs1) != np.shape(obs2):
  */
   }
 
-  /* "soapcw/soapcw.pyx":232
+  /* "soapcw/soapcw.pyx":239
  *         if len(np.shape(obs1)) < 2 or len(np.shape(obs1)) < 2:
  *             raise Exception("Please input 2D array for observation data")
  *         if np.shape(obs1) != np.shape(obs2):             # <<<<<<<<<<<<<<
  *             raise Exception("Please make sure teh two input data have the same dimensions")
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 232, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 239, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_shape); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 232, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_shape); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 239, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_t_3 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
     __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_4);
     if (likely(__pyx_t_3)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
       __Pyx_INCREF(__pyx_t_3);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_4, function);
     }
   }
   __pyx_t_2 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_3, __pyx_v_obs1) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_v_obs1);
   __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 232, __pyx_L1_error)
+  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 239, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 232, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 239, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_shape); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 232, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_shape); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 239, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_t_3 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_7))) {
     __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_7);
     if (likely(__pyx_t_3)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
       __Pyx_INCREF(__pyx_t_3);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_7, function);
     }
   }
   __pyx_t_4 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_7, __pyx_t_3, __pyx_v_obs2) : __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_v_obs2);
   __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 232, __pyx_L1_error)
+  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 239, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = PyObject_RichCompare(__pyx_t_2, __pyx_t_4, Py_NE); __Pyx_XGOTREF(__pyx_t_7); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 232, __pyx_L1_error)
+  __pyx_t_7 = PyObject_RichCompare(__pyx_t_2, __pyx_t_4, Py_NE); __Pyx_XGOTREF(__pyx_t_7); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 239, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 232, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 239, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   if (unlikely(__pyx_t_1)) {
 
-    /* "soapcw/soapcw.pyx":233
+    /* "soapcw/soapcw.pyx":240
  *             raise Exception("Please input 2D array for observation data")
  *         if np.shape(obs1) != np.shape(obs2):
  *             raise Exception("Please make sure teh two input data have the same dimensions")             # <<<<<<<<<<<<<<
  * 
  *         tr = np.array(tr).astype('double')
  */
-    __pyx_t_7 = __Pyx_PyObject_Call(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])), __pyx_tuple__6, NULL); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 233, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyObject_Call(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])), __pyx_tuple__6, NULL); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 240, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_Raise(__pyx_t_7, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-    __PYX_ERR(0, 233, __pyx_L1_error)
+    __PYX_ERR(0, 240, __pyx_L1_error)
 
-    /* "soapcw/soapcw.pyx":232
+    /* "soapcw/soapcw.pyx":239
  *         if len(np.shape(obs1)) < 2 or len(np.shape(obs1)) < 2:
  *             raise Exception("Please input 2D array for observation data")
  *         if np.shape(obs1) != np.shape(obs2):             # <<<<<<<<<<<<<<
  *             raise Exception("Please make sure teh two input data have the same dimensions")
  * 
  */
   }
 
-  /* "soapcw/soapcw.pyx":235
+  /* "soapcw/soapcw.pyx":242
  *             raise Exception("Please make sure teh two input data have the same dimensions")
  * 
  *         tr = np.array(tr).astype('double')             # <<<<<<<<<<<<<<
  *         obs1 = np.array(obs1).astype('double')
  *         obs2 = np.array(obs2).astype('double')
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 235, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 242, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_array); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 235, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_array); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 242, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_t_2 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
     __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
     if (likely(__pyx_t_2)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
       __Pyx_INCREF(__pyx_t_2);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_3, function);
     }
   }
   __pyx_t_4 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_2, __pyx_v_tr) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_tr);
   __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 235, __pyx_L1_error)
+  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 242, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_astype); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 235, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_astype); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 242, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_t_4 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
     __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
     if (likely(__pyx_t_4)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
       __Pyx_INCREF(__pyx_t_4);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_3, function);
     }
   }
   __pyx_t_7 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_n_u_double) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_n_u_double);
   __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 235, __pyx_L1_error)
+  if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 242, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF_SET(__pyx_v_tr, __pyx_t_7);
   __pyx_t_7 = 0;
 
-  /* "soapcw/soapcw.pyx":236
+  /* "soapcw/soapcw.pyx":243
  * 
  *         tr = np.array(tr).astype('double')
  *         obs1 = np.array(obs1).astype('double')             # <<<<<<<<<<<<<<
  *         obs2 = np.array(obs2).astype('double')
  *         self.prog = prog
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 236, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 243, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_array); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 236, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_array); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 243, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_t_4 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
     __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
     if (likely(__pyx_t_4)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
       __Pyx_INCREF(__pyx_t_4);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_2, function);
     }
   }
   __pyx_t_3 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_4, __pyx_v_obs1) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_obs1);
   __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 236, __pyx_L1_error)
+  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 243, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_astype); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 236, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_astype); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 243, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_t_3 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
     __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
     if (likely(__pyx_t_3)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
       __Pyx_INCREF(__pyx_t_3);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_2, function);
     }
   }
   __pyx_t_7 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_n_u_double) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_n_u_double);
   __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 236, __pyx_L1_error)
+  if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 243, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF_SET(__pyx_v_obs1, __pyx_t_7);
   __pyx_t_7 = 0;
 
-  /* "soapcw/soapcw.pyx":237
+  /* "soapcw/soapcw.pyx":244
  *         tr = np.array(tr).astype('double')
  *         obs1 = np.array(obs1).astype('double')
  *         obs2 = np.array(obs2).astype('double')             # <<<<<<<<<<<<<<
  *         self.prog = prog
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 237, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 244, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_array); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 237, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_array); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 244, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_t_3 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
     __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_4);
     if (likely(__pyx_t_3)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
       __Pyx_INCREF(__pyx_t_3);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_4, function);
     }
   }
   __pyx_t_2 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_3, __pyx_v_obs2) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_v_obs2);
   __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 237, __pyx_L1_error)
+  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 244, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_astype); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 237, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_astype); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 244, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_t_2 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
     __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_4);
     if (likely(__pyx_t_2)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
       __Pyx_INCREF(__pyx_t_2);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_4, function);
     }
   }
   __pyx_t_7 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_2, __pyx_n_u_double) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_n_u_double);
   __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 237, __pyx_L1_error)
+  if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 244, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF_SET(__pyx_v_obs2, __pyx_t_7);
   __pyx_t_7 = 0;
 
-  /* "soapcw/soapcw.pyx":238
+  /* "soapcw/soapcw.pyx":245
  *         obs1 = np.array(obs1).astype('double')
  *         obs2 = np.array(obs2).astype('double')
  *         self.prog = prog             # <<<<<<<<<<<<<<
  * 
- *         if fractions is not None and lookup_file_2det is not None:
+ *         if fractions is not None and lookup_table_2det is not None:
  */
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_prog, __pyx_v_prog) < 0) __PYX_ERR(0, 238, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_prog, __pyx_v_prog) < 0) __PYX_ERR(0, 245, __pyx_L1_error)
 
-  /* "soapcw/soapcw.pyx":240
+  /* "soapcw/soapcw.pyx":247
  *         self.prog = prog
  * 
- *         if fractions is not None and lookup_file_2det is not None:             # <<<<<<<<<<<<<<
- *             self.run_lookup_amp(tr, obs1, obs2,lookup_file=lookup_file_2det,fractions=fractions)
+ *         if fractions is not None and lookup_table_2det is not None:             # <<<<<<<<<<<<<<
+ *             self.run_lookup_amp(tr, obs1, obs2,lookup_table=lookup_table_2det,fractions=fractions)
  *         else:
  */
   __pyx_t_6 = (__pyx_v_fractions != Py_None);
   __pyx_t_8 = (__pyx_t_6 != 0);
   if (__pyx_t_8) {
   } else {
     __pyx_t_1 = __pyx_t_8;
     goto __pyx_L8_bool_binop_done;
   }
-  __pyx_t_8 = (__pyx_v_lookup_file_2det != Py_None);
+  __pyx_t_8 = (__pyx_v_lookup_table_2det != Py_None);
   __pyx_t_6 = (__pyx_t_8 != 0);
   __pyx_t_1 = __pyx_t_6;
   __pyx_L8_bool_binop_done:;
   if (__pyx_t_1) {
 
-    /* "soapcw/soapcw.pyx":241
+    /* "soapcw/soapcw.pyx":248
  * 
- *         if fractions is not None and lookup_file_2det is not None:
- *             self.run_lookup_amp(tr, obs1, obs2,lookup_file=lookup_file_2det,fractions=fractions)             # <<<<<<<<<<<<<<
+ *         if fractions is not None and lookup_table_2det is not None:
+ *             self.run_lookup_amp(tr, obs1, obs2,lookup_table=lookup_table_2det,fractions=fractions)             # <<<<<<<<<<<<<<
  *         else:
- *             self.run(tr, obs1, obs2,lookup_file_1det=lookup_file_1det, lookup_file_2det=lookup_file_2det)
+ *             self.run(tr, obs1, obs2,lookup_table_1det=lookup_table_1det, lookup_table_2det=lookup_table_2det)
  */
-    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_run_lookup_amp); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 241, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_run_lookup_amp); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 248, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
-    __pyx_t_4 = PyTuple_New(3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 241, __pyx_L1_error)
+    __pyx_t_4 = PyTuple_New(3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 248, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_INCREF(__pyx_v_tr);
     __Pyx_GIVEREF(__pyx_v_tr);
     PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_v_tr);
     __Pyx_INCREF(__pyx_v_obs1);
     __Pyx_GIVEREF(__pyx_v_obs1);
     PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_v_obs1);
     __Pyx_INCREF(__pyx_v_obs2);
     __Pyx_GIVEREF(__pyx_v_obs2);
     PyTuple_SET_ITEM(__pyx_t_4, 2, __pyx_v_obs2);
-    __pyx_t_2 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 241, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 248, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_lookup_file, __pyx_v_lookup_file_2det) < 0) __PYX_ERR(0, 241, __pyx_L1_error)
-    if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_fractions, __pyx_v_fractions) < 0) __PYX_ERR(0, 241, __pyx_L1_error)
-    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_4, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 241, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_lookup_table, __pyx_v_lookup_table_2det) < 0) __PYX_ERR(0, 248, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_fractions, __pyx_v_fractions) < 0) __PYX_ERR(0, 248, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_4, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 248, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-    /* "soapcw/soapcw.pyx":240
+    /* "soapcw/soapcw.pyx":247
  *         self.prog = prog
  * 
- *         if fractions is not None and lookup_file_2det is not None:             # <<<<<<<<<<<<<<
- *             self.run_lookup_amp(tr, obs1, obs2,lookup_file=lookup_file_2det,fractions=fractions)
+ *         if fractions is not None and lookup_table_2det is not None:             # <<<<<<<<<<<<<<
+ *             self.run_lookup_amp(tr, obs1, obs2,lookup_table=lookup_table_2det,fractions=fractions)
  *         else:
  */
     goto __pyx_L7;
   }
 
-  /* "soapcw/soapcw.pyx":243
- *             self.run_lookup_amp(tr, obs1, obs2,lookup_file=lookup_file_2det,fractions=fractions)
+  /* "soapcw/soapcw.pyx":250
+ *             self.run_lookup_amp(tr, obs1, obs2,lookup_table=lookup_table_2det,fractions=fractions)
  *         else:
- *             self.run(tr, obs1, obs2,lookup_file_1det=lookup_file_1det, lookup_file_2det=lookup_file_2det)             # <<<<<<<<<<<<<<
+ *             self.run(tr, obs1, obs2,lookup_table_1det=lookup_table_1det, lookup_table_2det=lookup_table_2det)             # <<<<<<<<<<<<<<
  * 
  *         self.get_track()
  */
   /*else*/ {
-    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_run); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 243, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_run); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 250, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_2 = PyTuple_New(3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 243, __pyx_L1_error)
+    __pyx_t_2 = PyTuple_New(3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 250, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_INCREF(__pyx_v_tr);
     __Pyx_GIVEREF(__pyx_v_tr);
     PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_tr);
     __Pyx_INCREF(__pyx_v_obs1);
     __Pyx_GIVEREF(__pyx_v_obs1);
     PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_obs1);
     __Pyx_INCREF(__pyx_v_obs2);
     __Pyx_GIVEREF(__pyx_v_obs2);
     PyTuple_SET_ITEM(__pyx_t_2, 2, __pyx_v_obs2);
-    __pyx_t_4 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 243, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 250, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_lookup_file_1det, __pyx_v_lookup_file_1det) < 0) __PYX_ERR(0, 243, __pyx_L1_error)
-    if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_lookup_file_2det, __pyx_v_lookup_file_2det) < 0) __PYX_ERR(0, 243, __pyx_L1_error)
-    __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_2, __pyx_t_4); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 243, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_lookup_table_1det, __pyx_v_lookup_table_1det) < 0) __PYX_ERR(0, 250, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_lookup_table_2det, __pyx_v_lookup_table_2det) < 0) __PYX_ERR(0, 250, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_2, __pyx_t_4); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 250, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   }
   __pyx_L7:;
 
-  /* "soapcw/soapcw.pyx":245
- *             self.run(tr, obs1, obs2,lookup_file_1det=lookup_file_1det, lookup_file_2det=lookup_file_2det)
+  /* "soapcw/soapcw.pyx":252
+ *             self.run(tr, obs1, obs2,lookup_table_1det=lookup_table_1det, lookup_table_2det=lookup_table_2det)
  * 
  *         self.get_track()             # <<<<<<<<<<<<<<
  *         if make_vitmap:
  *             self.get_vitmap()
  */
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_get_track); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 245, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_get_track); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 252, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __pyx_t_2 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
     __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_4);
     if (likely(__pyx_t_2)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
       __Pyx_INCREF(__pyx_t_2);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_4, function);
     }
   }
   __pyx_t_7 = (__pyx_t_2) ? __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_2) : __Pyx_PyObject_CallNoArg(__pyx_t_4);
   __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 245, __pyx_L1_error)
+  if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 252, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
 
-  /* "soapcw/soapcw.pyx":246
+  /* "soapcw/soapcw.pyx":253
  * 
  *         self.get_track()
  *         if make_vitmap:             # <<<<<<<<<<<<<<
  *             self.get_vitmap()
  * 
  */
-  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_make_vitmap); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 246, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_make_vitmap); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 253, __pyx_L1_error)
   if (__pyx_t_1) {
 
-    /* "soapcw/soapcw.pyx":247
+    /* "soapcw/soapcw.pyx":254
  *         self.get_track()
  *         if make_vitmap:
  *             self.get_vitmap()             # <<<<<<<<<<<<<<
  * 
  *     #------------------------------------------------------------------------------------------------
  */
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_get_vitmap); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 247, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_get_vitmap); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 254, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __pyx_t_2 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
       __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_4);
       if (likely(__pyx_t_2)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
         __Pyx_INCREF(__pyx_t_2);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_4, function);
       }
     }
     __pyx_t_7 = (__pyx_t_2) ? __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_2) : __Pyx_PyObject_CallNoArg(__pyx_t_4);
     __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-    if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 247, __pyx_L1_error)
+    if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 254, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
 
-    /* "soapcw/soapcw.pyx":246
+    /* "soapcw/soapcw.pyx":253
  * 
  *         self.get_track()
  *         if make_vitmap:             # <<<<<<<<<<<<<<
  *             self.get_vitmap()
  * 
  */
   }
 
-  /* "soapcw/soapcw.pyx":192
+  /* "soapcw/soapcw.pyx":199
  * class two_detector(object):
  * 
- *     def __init__(self, tr, obs1, obs2, lookup_file_2det = None, lookup_file_1det = None, prog = False,fractions=None, make_vitmap=True):             # <<<<<<<<<<<<<<
+ *     def __init__(self, tr, obs1, obs2, lookup_table_2det = None, lookup_table_1det = None, prog = False,fractions=None, make_vitmap=True):             # <<<<<<<<<<<<<<
  *         '''
  *         viterbi algorithm for two detectors with an optional line aware statistic
  */
 
   /* function exit code */
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
@@ -6964,15 +7078,15 @@
   __Pyx_XDECREF(__pyx_v_obs1);
   __Pyx_XDECREF(__pyx_v_obs2);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "soapcw/soapcw.pyx":253
+/* "soapcw/soapcw.pyx":260
  *     #------------------------------------------------------------------------------------------------
  * 
  *     def get_vitmap(self,log=False):             # <<<<<<<<<<<<<<
  *         """
  *         normalise the viterbi output such that the sum of eah column is 1
  */
 
@@ -7013,15 +7127,15 @@
         case  1:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_log);
           if (value) { values[1] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "get_vitmap") < 0)) __PYX_ERR(0, 253, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "get_vitmap") < 0)) __PYX_ERR(0, 260, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
         CYTHON_FALLTHROUGH;
         case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
         break;
@@ -7029,15 +7143,15 @@
       }
     }
     __pyx_v_self = values[0];
     __pyx_v_log = values[1];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("get_vitmap", 0, 1, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 253, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("get_vitmap", 0, 1, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 260, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("soapcw.soapcw.two_detector.get_vitmap", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6soapcw_6soapcw_12two_detector_2get_vitmap(__pyx_self, __pyx_v_self, __pyx_v_log);
 
@@ -7063,246 +7177,246 @@
   int __pyx_t_8;
   int __pyx_t_9;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("get_vitmap", 0);
 
-  /* "soapcw/soapcw.pyx":257
+  /* "soapcw/soapcw.pyx":264
  *         normalise the viterbi output such that the sum of eah column is 1
  *         """
  *         path_m = []             # <<<<<<<<<<<<<<
  *         for i in self.V:
  *             sump = logsumexp(i)
  */
-  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 257, __pyx_L1_error)
+  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 264, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_path_m = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "soapcw/soapcw.pyx":258
+  /* "soapcw/soapcw.pyx":265
  *         """
  *         path_m = []
  *         for i in self.V:             # <<<<<<<<<<<<<<
  *             sump = logsumexp(i)
  *             val = np.exp(i-sump)
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_V); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 258, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_V); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 265, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   if (likely(PyList_CheckExact(__pyx_t_1)) || PyTuple_CheckExact(__pyx_t_1)) {
     __pyx_t_2 = __pyx_t_1; __Pyx_INCREF(__pyx_t_2); __pyx_t_3 = 0;
     __pyx_t_4 = NULL;
   } else {
-    __pyx_t_3 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 258, __pyx_L1_error)
+    __pyx_t_3 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 265, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_4 = Py_TYPE(__pyx_t_2)->tp_iternext; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 258, __pyx_L1_error)
+    __pyx_t_4 = Py_TYPE(__pyx_t_2)->tp_iternext; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 265, __pyx_L1_error)
   }
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   for (;;) {
     if (likely(!__pyx_t_4)) {
       if (likely(PyList_CheckExact(__pyx_t_2))) {
         if (__pyx_t_3 >= PyList_GET_SIZE(__pyx_t_2)) break;
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_1 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_3); __Pyx_INCREF(__pyx_t_1); __pyx_t_3++; if (unlikely(0 < 0)) __PYX_ERR(0, 258, __pyx_L1_error)
+        __pyx_t_1 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_3); __Pyx_INCREF(__pyx_t_1); __pyx_t_3++; if (unlikely(0 < 0)) __PYX_ERR(0, 265, __pyx_L1_error)
         #else
-        __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_3); __pyx_t_3++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 258, __pyx_L1_error)
+        __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_3); __pyx_t_3++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 265, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
         #endif
       } else {
         if (__pyx_t_3 >= PyTuple_GET_SIZE(__pyx_t_2)) break;
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_3); __Pyx_INCREF(__pyx_t_1); __pyx_t_3++; if (unlikely(0 < 0)) __PYX_ERR(0, 258, __pyx_L1_error)
+        __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_3); __Pyx_INCREF(__pyx_t_1); __pyx_t_3++; if (unlikely(0 < 0)) __PYX_ERR(0, 265, __pyx_L1_error)
         #else
-        __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_3); __pyx_t_3++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 258, __pyx_L1_error)
+        __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_3); __pyx_t_3++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 265, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
         #endif
       }
     } else {
       __pyx_t_1 = __pyx_t_4(__pyx_t_2);
       if (unlikely(!__pyx_t_1)) {
         PyObject* exc_type = PyErr_Occurred();
         if (exc_type) {
           if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-          else __PYX_ERR(0, 258, __pyx_L1_error)
+          else __PYX_ERR(0, 265, __pyx_L1_error)
         }
         break;
       }
       __Pyx_GOTREF(__pyx_t_1);
     }
     __Pyx_XDECREF_SET(__pyx_v_i, __pyx_t_1);
     __pyx_t_1 = 0;
 
-    /* "soapcw/soapcw.pyx":259
+    /* "soapcw/soapcw.pyx":266
  *         path_m = []
  *         for i in self.V:
  *             sump = logsumexp(i)             # <<<<<<<<<<<<<<
  *             val = np.exp(i-sump)
  *             path_m.append(val)
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_logsumexp); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 259, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_logsumexp); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 266, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __pyx_t_6 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
       __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_5);
       if (likely(__pyx_t_6)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
         __Pyx_INCREF(__pyx_t_6);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_5, function);
       }
     }
     __pyx_t_1 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_6, __pyx_v_i) : __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_v_i);
     __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
-    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 259, __pyx_L1_error)
+    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 266, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     __Pyx_XDECREF_SET(__pyx_v_sump, __pyx_t_1);
     __pyx_t_1 = 0;
 
-    /* "soapcw/soapcw.pyx":260
+    /* "soapcw/soapcw.pyx":267
  *         for i in self.V:
  *             sump = logsumexp(i)
  *             val = np.exp(i-sump)             # <<<<<<<<<<<<<<
  *             path_m.append(val)
  *         path_m = np.array(path_m)
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 260, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 267, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_exp); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 260, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_exp); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 267, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __pyx_t_5 = PyNumber_Subtract(__pyx_v_i, __pyx_v_sump); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 260, __pyx_L1_error)
+    __pyx_t_5 = PyNumber_Subtract(__pyx_v_i, __pyx_v_sump); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 267, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __pyx_t_7 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_6))) {
       __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_6);
       if (likely(__pyx_t_7)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
         __Pyx_INCREF(__pyx_t_7);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_6, function);
       }
     }
     __pyx_t_1 = (__pyx_t_7) ? __Pyx_PyObject_Call2Args(__pyx_t_6, __pyx_t_7, __pyx_t_5) : __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_t_5);
     __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 260, __pyx_L1_error)
+    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 267, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_XDECREF_SET(__pyx_v_val, __pyx_t_1);
     __pyx_t_1 = 0;
 
-    /* "soapcw/soapcw.pyx":261
+    /* "soapcw/soapcw.pyx":268
  *             sump = logsumexp(i)
  *             val = np.exp(i-sump)
  *             path_m.append(val)             # <<<<<<<<<<<<<<
  *         path_m = np.array(path_m)
  *         if log:
  */
-    __pyx_t_8 = __Pyx_PyObject_Append(__pyx_v_path_m, __pyx_v_val); if (unlikely(__pyx_t_8 == ((int)-1))) __PYX_ERR(0, 261, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyObject_Append(__pyx_v_path_m, __pyx_v_val); if (unlikely(__pyx_t_8 == ((int)-1))) __PYX_ERR(0, 268, __pyx_L1_error)
 
-    /* "soapcw/soapcw.pyx":258
+    /* "soapcw/soapcw.pyx":265
  *         """
  *         path_m = []
  *         for i in self.V:             # <<<<<<<<<<<<<<
  *             sump = logsumexp(i)
  *             val = np.exp(i-sump)
  */
   }
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "soapcw/soapcw.pyx":262
+  /* "soapcw/soapcw.pyx":269
  *             val = np.exp(i-sump)
  *             path_m.append(val)
  *         path_m = np.array(path_m)             # <<<<<<<<<<<<<<
  *         if log:
  *             path_m = np.log(path_m)
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 262, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 269, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_array); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 262, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_array); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 269, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_t_1 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_6))) {
     __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_6);
     if (likely(__pyx_t_1)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
       __Pyx_INCREF(__pyx_t_1);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_6, function);
     }
   }
   __pyx_t_2 = (__pyx_t_1) ? __Pyx_PyObject_Call2Args(__pyx_t_6, __pyx_t_1, __pyx_v_path_m) : __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_v_path_m);
   __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
-  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 262, __pyx_L1_error)
+  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 269, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF_SET(__pyx_v_path_m, __pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "soapcw/soapcw.pyx":263
+  /* "soapcw/soapcw.pyx":270
  *             path_m.append(val)
  *         path_m = np.array(path_m)
  *         if log:             # <<<<<<<<<<<<<<
  *             path_m = np.log(path_m)
  * 
  */
-  __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_v_log); if (unlikely(__pyx_t_9 < 0)) __PYX_ERR(0, 263, __pyx_L1_error)
+  __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_v_log); if (unlikely(__pyx_t_9 < 0)) __PYX_ERR(0, 270, __pyx_L1_error)
   if (__pyx_t_9) {
 
-    /* "soapcw/soapcw.pyx":264
+    /* "soapcw/soapcw.pyx":271
  *         path_m = np.array(path_m)
  *         if log:
  *             path_m = np.log(path_m)             # <<<<<<<<<<<<<<
  * 
  *         self.vitmap = path_m
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 264, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 271, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
-    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_log); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 264, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_log); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 271, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     __pyx_t_6 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_1))) {
       __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_1);
       if (likely(__pyx_t_6)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
         __Pyx_INCREF(__pyx_t_6);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_1, function);
       }
     }
     __pyx_t_2 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_6, __pyx_v_path_m) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_v_path_m);
     __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
-    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 264, __pyx_L1_error)
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 271, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_DECREF_SET(__pyx_v_path_m, __pyx_t_2);
     __pyx_t_2 = 0;
 
-    /* "soapcw/soapcw.pyx":263
+    /* "soapcw/soapcw.pyx":270
  *             path_m.append(val)
  *         path_m = np.array(path_m)
  *         if log:             # <<<<<<<<<<<<<<
  *             path_m = np.log(path_m)
  * 
  */
   }
 
-  /* "soapcw/soapcw.pyx":266
+  /* "soapcw/soapcw.pyx":273
  *             path_m = np.log(path_m)
  * 
  *         self.vitmap = path_m             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_vitmap, __pyx_v_path_m) < 0) __PYX_ERR(0, 266, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_vitmap, __pyx_v_path_m) < 0) __PYX_ERR(0, 273, __pyx_L1_error)
 
-  /* "soapcw/soapcw.pyx":253
+  /* "soapcw/soapcw.pyx":260
  *     #------------------------------------------------------------------------------------------------
  * 
  *     def get_vitmap(self,log=False):             # <<<<<<<<<<<<<<
  *         """
  *         normalise the viterbi output such that the sum of eah column is 1
  */
 
@@ -7323,36 +7437,37 @@
   __Pyx_XDECREF(__pyx_v_sump);
   __Pyx_XDECREF(__pyx_v_val);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "soapcw/soapcw.pyx":273
+/* "soapcw/soapcw.pyx":280
  *     #--------------------------------------------------------
  * 
- *     def read_lookup(self,filename):             # <<<<<<<<<<<<<<
- * 
- *         with open(filename,'rb') as f1:
+ *     def read_lookup(self,lookup_table):             # <<<<<<<<<<<<<<
+ *         """
+ *         Read a lookup table from a file of a LineAwareStatistic object
  */
 
 /* Python wrapper */
 static PyObject *__pyx_pw_6soapcw_6soapcw_12two_detector_5read_lookup(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_mdef_6soapcw_6soapcw_12two_detector_5read_lookup = {"read_lookup", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6soapcw_6soapcw_12two_detector_5read_lookup, METH_VARARGS|METH_KEYWORDS, 0};
+static char __pyx_doc_6soapcw_6soapcw_12two_detector_4read_lookup[] = "\n        Read a lookup table from a file of a LineAwareStatistic object\n        args \n        ------\n        lookup_table: string or LineAwareStatistic\n            filename to saved lookupt table or lineaware statistic object\n        returns\n        ---------\n        likelihood: array\n            returns odds ratio from file to use as statistic\n        ranges: array\n            ranges of the x,y axis of the odds ratio\n        fact: float\n            spacing of the ranges\n        ";
+static PyMethodDef __pyx_mdef_6soapcw_6soapcw_12two_detector_5read_lookup = {"read_lookup", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6soapcw_6soapcw_12two_detector_5read_lookup, METH_VARARGS|METH_KEYWORDS, __pyx_doc_6soapcw_6soapcw_12two_detector_4read_lookup};
 static PyObject *__pyx_pw_6soapcw_6soapcw_12two_detector_5read_lookup(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   CYTHON_UNUSED PyObject *__pyx_v_self = 0;
-  PyObject *__pyx_v_filename = 0;
+  PyObject *__pyx_v_lookup_table = 0;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("read_lookup (wrapper)", 0);
   {
-    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_self,&__pyx_n_s_filename,0};
+    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_self,&__pyx_n_s_lookup_table,0};
     PyObject* values[2] = {0,0};
     if (unlikely(__pyx_kwds)) {
       Py_ssize_t kw_args;
       const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
       switch (pos_args) {
         case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
         CYTHON_FALLTHROUGH;
@@ -7364,439 +7479,532 @@
       kw_args = PyDict_Size(__pyx_kwds);
       switch (pos_args) {
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
-        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_filename)) != 0)) kw_args--;
+        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_lookup_table)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("read_lookup", 1, 2, 2, 1); __PYX_ERR(0, 273, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("read_lookup", 1, 2, 2, 1); __PYX_ERR(0, 280, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "read_lookup") < 0)) __PYX_ERR(0, 273, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "read_lookup") < 0)) __PYX_ERR(0, 280, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
     }
     __pyx_v_self = values[0];
-    __pyx_v_filename = values[1];
+    __pyx_v_lookup_table = values[1];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("read_lookup", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 273, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("read_lookup", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 280, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("soapcw.soapcw.two_detector.read_lookup", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_6soapcw_6soapcw_12two_detector_4read_lookup(__pyx_self, __pyx_v_self, __pyx_v_filename);
+  __pyx_r = __pyx_pf_6soapcw_6soapcw_12two_detector_4read_lookup(__pyx_self, __pyx_v_self, __pyx_v_lookup_table);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_6soapcw_6soapcw_12two_detector_4read_lookup(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_self, PyObject *__pyx_v_filename) {
+static PyObject *__pyx_pf_6soapcw_6soapcw_12two_detector_4read_lookup(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_self, PyObject *__pyx_v_lookup_table) {
   PyObject *__pyx_v_f1 = NULL;
   PyObject *__pyx_v_likelihood = NULL;
   PyObject *__pyx_v_params = NULL;
   PyObject *__pyx_v_ranges = NULL;
   PyObject *__pyx_v_fact = NULL;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
-  PyObject *__pyx_t_1 = NULL;
-  PyObject *__pyx_t_2 = NULL;
+  int __pyx_t_1;
+  int __pyx_t_2;
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
   PyObject *__pyx_t_6 = NULL;
   PyObject *__pyx_t_7 = NULL;
   PyObject *__pyx_t_8 = NULL;
-  PyObject *(*__pyx_t_9)(PyObject *);
+  PyObject *__pyx_t_9 = NULL;
   PyObject *__pyx_t_10 = NULL;
-  int __pyx_t_11;
-  int __pyx_t_12;
+  PyObject *(*__pyx_t_11)(PyObject *);
+  PyObject *__pyx_t_12 = NULL;
   PyObject *__pyx_t_13 = NULL;
   PyObject *__pyx_t_14 = NULL;
   int __pyx_t_15;
   PyObject *__pyx_t_16 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("read_lookup", 0);
 
-  /* "soapcw/soapcw.pyx":275
- *     def read_lookup(self,filename):
- * 
- *         with open(filename,'rb') as f1:             # <<<<<<<<<<<<<<
- *             likelihood, params = pickle.load(f1)
+  /* "soapcw/soapcw.pyx":297
+ *         """
  * 
+ *         if isinstance(lookup_table, str):             # <<<<<<<<<<<<<<
+ *             # if it is a filename the load the file and create ranges from that
+ *             with open(lookup_table,'rb') as f1:
  */
-  /*with:*/ {
-    __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 275, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_1);
-    __Pyx_INCREF(__pyx_v_filename);
-    __Pyx_GIVEREF(__pyx_v_filename);
-    PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_filename);
-    __Pyx_INCREF(__pyx_n_u_rb);
-    __Pyx_GIVEREF(__pyx_n_u_rb);
-    PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_n_u_rb);
-    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_open, __pyx_t_1, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 275, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_2);
-    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_3 = __Pyx_PyObject_LookupSpecial(__pyx_t_2, __pyx_n_s_exit); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 275, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_4 = __Pyx_PyObject_LookupSpecial(__pyx_t_2, __pyx_n_s_enter); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 275, __pyx_L3_error)
-    __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_5 = NULL;
-    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
-      __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
-      if (likely(__pyx_t_5)) {
-        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
-        __Pyx_INCREF(__pyx_t_5);
-        __Pyx_INCREF(function);
-        __Pyx_DECREF_SET(__pyx_t_4, function);
-      }
-    }
-    __pyx_t_1 = (__pyx_t_5) ? __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_5) : __Pyx_PyObject_CallNoArg(__pyx_t_4);
-    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
-    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 275, __pyx_L3_error)
-    __Pyx_GOTREF(__pyx_t_1);
-    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_t_4 = __pyx_t_1;
-    __pyx_t_1 = 0;
-    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    /*try:*/ {
-      {
-        __Pyx_PyThreadState_declare
-        __Pyx_PyThreadState_assign
-        __Pyx_ExceptionSave(&__pyx_t_6, &__pyx_t_7, &__pyx_t_8);
-        __Pyx_XGOTREF(__pyx_t_6);
-        __Pyx_XGOTREF(__pyx_t_7);
-        __Pyx_XGOTREF(__pyx_t_8);
-        /*try:*/ {
-          __pyx_v_f1 = __pyx_t_4;
-          __pyx_t_4 = 0;
+  __pyx_t_1 = PyUnicode_Check(__pyx_v_lookup_table); 
+  __pyx_t_2 = (__pyx_t_1 != 0);
+  if (__pyx_t_2) {
 
-          /* "soapcw/soapcw.pyx":276
- * 
- *         with open(filename,'rb') as f1:
- *             likelihood, params = pickle.load(f1)             # <<<<<<<<<<<<<<
+    /* "soapcw/soapcw.pyx":299
+ *         if isinstance(lookup_table, str):
+ *             # if it is a filename the load the file and create ranges from that
+ *             with open(lookup_table,'rb') as f1:             # <<<<<<<<<<<<<<
+ *                 likelihood, params = pickle.load(f1)
  * 
- *         ranges = np.linspace(params["power_ranges"][0],params["power_ranges"][1],int(params["power_ranges"][2]))
  */
-          __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_pickle); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 276, __pyx_L7_error)
-          __Pyx_GOTREF(__pyx_t_2);
-          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_load); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 276, __pyx_L7_error)
-          __Pyx_GOTREF(__pyx_t_1);
-          __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-          __pyx_t_2 = NULL;
-          if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_1))) {
-            __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_1);
-            if (likely(__pyx_t_2)) {
-              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
-              __Pyx_INCREF(__pyx_t_2);
-              __Pyx_INCREF(function);
-              __Pyx_DECREF_SET(__pyx_t_1, function);
-            }
-          }
-          __pyx_t_4 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_2, __pyx_v_f1) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_v_f1);
-          __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-          if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 276, __pyx_L7_error)
-          __Pyx_GOTREF(__pyx_t_4);
-          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-          if ((likely(PyTuple_CheckExact(__pyx_t_4))) || (PyList_CheckExact(__pyx_t_4))) {
-            PyObject* sequence = __pyx_t_4;
-            Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
-            if (unlikely(size != 2)) {
-              if (size > 2) __Pyx_RaiseTooManyValuesError(2);
-              else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
-              __PYX_ERR(0, 276, __pyx_L7_error)
+    /*with:*/ {
+      __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 299, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_3);
+      __Pyx_INCREF(__pyx_v_lookup_table);
+      __Pyx_GIVEREF(__pyx_v_lookup_table);
+      PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_lookup_table);
+      __Pyx_INCREF(__pyx_n_u_rb);
+      __Pyx_GIVEREF(__pyx_n_u_rb);
+      PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_n_u_rb);
+      __pyx_t_4 = __Pyx_PyObject_Call(__pyx_builtin_open, __pyx_t_3, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 299, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_4);
+      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+      __pyx_t_5 = __Pyx_PyObject_LookupSpecial(__pyx_t_4, __pyx_n_s_exit); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 299, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_5);
+      __pyx_t_6 = __Pyx_PyObject_LookupSpecial(__pyx_t_4, __pyx_n_s_enter); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 299, __pyx_L4_error)
+      __Pyx_GOTREF(__pyx_t_6);
+      __pyx_t_7 = NULL;
+      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_6))) {
+        __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_6);
+        if (likely(__pyx_t_7)) {
+          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
+          __Pyx_INCREF(__pyx_t_7);
+          __Pyx_INCREF(function);
+          __Pyx_DECREF_SET(__pyx_t_6, function);
+        }
+      }
+      __pyx_t_3 = (__pyx_t_7) ? __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_t_7) : __Pyx_PyObject_CallNoArg(__pyx_t_6);
+      __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
+      if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 299, __pyx_L4_error)
+      __Pyx_GOTREF(__pyx_t_3);
+      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
+      __pyx_t_6 = __pyx_t_3;
+      __pyx_t_3 = 0;
+      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+      /*try:*/ {
+        {
+          __Pyx_PyThreadState_declare
+          __Pyx_PyThreadState_assign
+          __Pyx_ExceptionSave(&__pyx_t_8, &__pyx_t_9, &__pyx_t_10);
+          __Pyx_XGOTREF(__pyx_t_8);
+          __Pyx_XGOTREF(__pyx_t_9);
+          __Pyx_XGOTREF(__pyx_t_10);
+          /*try:*/ {
+            __pyx_v_f1 = __pyx_t_6;
+            __pyx_t_6 = 0;
+
+            /* "soapcw/soapcw.pyx":300
+ *             # if it is a filename the load the file and create ranges from that
+ *             with open(lookup_table,'rb') as f1:
+ *                 likelihood, params = pickle.load(f1)             # <<<<<<<<<<<<<<
+ * 
+ *             ranges = np.linspace(params["power_ranges"][0],params["power_ranges"][1],int(params["power_ranges"][2]))
+ */
+            __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_pickle); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 300, __pyx_L8_error)
+            __Pyx_GOTREF(__pyx_t_4);
+            __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_load); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 300, __pyx_L8_error)
+            __Pyx_GOTREF(__pyx_t_3);
+            __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+            __pyx_t_4 = NULL;
+            if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
+              __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
+              if (likely(__pyx_t_4)) {
+                PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
+                __Pyx_INCREF(__pyx_t_4);
+                __Pyx_INCREF(function);
+                __Pyx_DECREF_SET(__pyx_t_3, function);
+              }
             }
-            #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-            if (likely(PyTuple_CheckExact(sequence))) {
-              __pyx_t_1 = PyTuple_GET_ITEM(sequence, 0); 
-              __pyx_t_2 = PyTuple_GET_ITEM(sequence, 1); 
+            __pyx_t_6 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_v_f1) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_f1);
+            __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
+            if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 300, __pyx_L8_error)
+            __Pyx_GOTREF(__pyx_t_6);
+            __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+            if ((likely(PyTuple_CheckExact(__pyx_t_6))) || (PyList_CheckExact(__pyx_t_6))) {
+              PyObject* sequence = __pyx_t_6;
+              Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
+              if (unlikely(size != 2)) {
+                if (size > 2) __Pyx_RaiseTooManyValuesError(2);
+                else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
+                __PYX_ERR(0, 300, __pyx_L8_error)
+              }
+              #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
+              if (likely(PyTuple_CheckExact(sequence))) {
+                __pyx_t_3 = PyTuple_GET_ITEM(sequence, 0); 
+                __pyx_t_4 = PyTuple_GET_ITEM(sequence, 1); 
+              } else {
+                __pyx_t_3 = PyList_GET_ITEM(sequence, 0); 
+                __pyx_t_4 = PyList_GET_ITEM(sequence, 1); 
+              }
+              __Pyx_INCREF(__pyx_t_3);
+              __Pyx_INCREF(__pyx_t_4);
+              #else
+              __pyx_t_3 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 300, __pyx_L8_error)
+              __Pyx_GOTREF(__pyx_t_3);
+              __pyx_t_4 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 300, __pyx_L8_error)
+              __Pyx_GOTREF(__pyx_t_4);
+              #endif
+              __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
             } else {
-              __pyx_t_1 = PyList_GET_ITEM(sequence, 0); 
-              __pyx_t_2 = PyList_GET_ITEM(sequence, 1); 
+              Py_ssize_t index = -1;
+              __pyx_t_7 = PyObject_GetIter(__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 300, __pyx_L8_error)
+              __Pyx_GOTREF(__pyx_t_7);
+              __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
+              __pyx_t_11 = Py_TYPE(__pyx_t_7)->tp_iternext;
+              index = 0; __pyx_t_3 = __pyx_t_11(__pyx_t_7); if (unlikely(!__pyx_t_3)) goto __pyx_L14_unpacking_failed;
+              __Pyx_GOTREF(__pyx_t_3);
+              index = 1; __pyx_t_4 = __pyx_t_11(__pyx_t_7); if (unlikely(!__pyx_t_4)) goto __pyx_L14_unpacking_failed;
+              __Pyx_GOTREF(__pyx_t_4);
+              if (__Pyx_IternextUnpackEndCheck(__pyx_t_11(__pyx_t_7), 2) < 0) __PYX_ERR(0, 300, __pyx_L8_error)
+              __pyx_t_11 = NULL;
+              __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
+              goto __pyx_L15_unpacking_done;
+              __pyx_L14_unpacking_failed:;
+              __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
+              __pyx_t_11 = NULL;
+              if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
+              __PYX_ERR(0, 300, __pyx_L8_error)
+              __pyx_L15_unpacking_done:;
             }
-            __Pyx_INCREF(__pyx_t_1);
-            __Pyx_INCREF(__pyx_t_2);
-            #else
-            __pyx_t_1 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 276, __pyx_L7_error)
-            __Pyx_GOTREF(__pyx_t_1);
-            __pyx_t_2 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 276, __pyx_L7_error)
-            __Pyx_GOTREF(__pyx_t_2);
-            #endif
-            __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-          } else {
-            Py_ssize_t index = -1;
-            __pyx_t_5 = PyObject_GetIter(__pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 276, __pyx_L7_error)
-            __Pyx_GOTREF(__pyx_t_5);
-            __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-            __pyx_t_9 = Py_TYPE(__pyx_t_5)->tp_iternext;
-            index = 0; __pyx_t_1 = __pyx_t_9(__pyx_t_5); if (unlikely(!__pyx_t_1)) goto __pyx_L13_unpacking_failed;
-            __Pyx_GOTREF(__pyx_t_1);
-            index = 1; __pyx_t_2 = __pyx_t_9(__pyx_t_5); if (unlikely(!__pyx_t_2)) goto __pyx_L13_unpacking_failed;
-            __Pyx_GOTREF(__pyx_t_2);
-            if (__Pyx_IternextUnpackEndCheck(__pyx_t_9(__pyx_t_5), 2) < 0) __PYX_ERR(0, 276, __pyx_L7_error)
-            __pyx_t_9 = NULL;
-            __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-            goto __pyx_L14_unpacking_done;
-            __pyx_L13_unpacking_failed:;
-            __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-            __pyx_t_9 = NULL;
-            if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
-            __PYX_ERR(0, 276, __pyx_L7_error)
-            __pyx_L14_unpacking_done:;
-          }
-          __pyx_v_likelihood = __pyx_t_1;
-          __pyx_t_1 = 0;
-          __pyx_v_params = __pyx_t_2;
-          __pyx_t_2 = 0;
+            __pyx_v_likelihood = __pyx_t_3;
+            __pyx_t_3 = 0;
+            __pyx_v_params = __pyx_t_4;
+            __pyx_t_4 = 0;
 
-          /* "soapcw/soapcw.pyx":275
- *     def read_lookup(self,filename):
- * 
- *         with open(filename,'rb') as f1:             # <<<<<<<<<<<<<<
- *             likelihood, params = pickle.load(f1)
+            /* "soapcw/soapcw.pyx":299
+ *         if isinstance(lookup_table, str):
+ *             # if it is a filename the load the file and create ranges from that
+ *             with open(lookup_table,'rb') as f1:             # <<<<<<<<<<<<<<
+ *                 likelihood, params = pickle.load(f1)
  * 
  */
-        }
-        __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
-        __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
-        __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
-        goto __pyx_L12_try_end;
-        __pyx_L7_error:;
-        __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
-        __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-        __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
-        /*except:*/ {
-          __Pyx_AddTraceback("soapcw.soapcw.two_detector.read_lookup", __pyx_clineno, __pyx_lineno, __pyx_filename);
-          if (__Pyx_GetException(&__pyx_t_4, &__pyx_t_2, &__pyx_t_1) < 0) __PYX_ERR(0, 275, __pyx_L9_except_error)
-          __Pyx_GOTREF(__pyx_t_4);
-          __Pyx_GOTREF(__pyx_t_2);
-          __Pyx_GOTREF(__pyx_t_1);
-          __pyx_t_5 = PyTuple_Pack(3, __pyx_t_4, __pyx_t_2, __pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 275, __pyx_L9_except_error)
-          __Pyx_GOTREF(__pyx_t_5);
-          __pyx_t_10 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_5, NULL);
-          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-          if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 275, __pyx_L9_except_error)
-          __Pyx_GOTREF(__pyx_t_10);
-          __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_t_10);
-          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-          if (__pyx_t_11 < 0) __PYX_ERR(0, 275, __pyx_L9_except_error)
-          __pyx_t_12 = ((!(__pyx_t_11 != 0)) != 0);
-          if (__pyx_t_12) {
-            __Pyx_GIVEREF(__pyx_t_4);
-            __Pyx_GIVEREF(__pyx_t_2);
-            __Pyx_XGIVEREF(__pyx_t_1);
-            __Pyx_ErrRestoreWithState(__pyx_t_4, __pyx_t_2, __pyx_t_1);
-            __pyx_t_4 = 0; __pyx_t_2 = 0; __pyx_t_1 = 0; 
-            __PYX_ERR(0, 275, __pyx_L9_except_error)
           }
+          __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
+          __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
+          __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
+          goto __pyx_L13_try_end;
+          __pyx_L8_error:;
+          __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
           __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-          __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-          __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
-          goto __pyx_L8_exception_handled;
+          __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
+          __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
+          /*except:*/ {
+            __Pyx_AddTraceback("soapcw.soapcw.two_detector.read_lookup", __pyx_clineno, __pyx_lineno, __pyx_filename);
+            if (__Pyx_GetException(&__pyx_t_6, &__pyx_t_4, &__pyx_t_3) < 0) __PYX_ERR(0, 299, __pyx_L10_except_error)
+            __Pyx_GOTREF(__pyx_t_6);
+            __Pyx_GOTREF(__pyx_t_4);
+            __Pyx_GOTREF(__pyx_t_3);
+            __pyx_t_7 = PyTuple_Pack(3, __pyx_t_6, __pyx_t_4, __pyx_t_3); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 299, __pyx_L10_except_error)
+            __Pyx_GOTREF(__pyx_t_7);
+            __pyx_t_12 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_7, NULL);
+            __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+            __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
+            if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 299, __pyx_L10_except_error)
+            __Pyx_GOTREF(__pyx_t_12);
+            __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_12);
+            __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
+            if (__pyx_t_2 < 0) __PYX_ERR(0, 299, __pyx_L10_except_error)
+            __pyx_t_1 = ((!(__pyx_t_2 != 0)) != 0);
+            if (__pyx_t_1) {
+              __Pyx_GIVEREF(__pyx_t_6);
+              __Pyx_GIVEREF(__pyx_t_4);
+              __Pyx_XGIVEREF(__pyx_t_3);
+              __Pyx_ErrRestoreWithState(__pyx_t_6, __pyx_t_4, __pyx_t_3);
+              __pyx_t_6 = 0; __pyx_t_4 = 0; __pyx_t_3 = 0; 
+              __PYX_ERR(0, 299, __pyx_L10_except_error)
+            }
+            __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
+            __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
+            __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
+            goto __pyx_L9_exception_handled;
+          }
+          __pyx_L10_except_error:;
+          __Pyx_XGIVEREF(__pyx_t_8);
+          __Pyx_XGIVEREF(__pyx_t_9);
+          __Pyx_XGIVEREF(__pyx_t_10);
+          __Pyx_ExceptionReset(__pyx_t_8, __pyx_t_9, __pyx_t_10);
+          goto __pyx_L1_error;
+          __pyx_L9_exception_handled:;
+          __Pyx_XGIVEREF(__pyx_t_8);
+          __Pyx_XGIVEREF(__pyx_t_9);
+          __Pyx_XGIVEREF(__pyx_t_10);
+          __Pyx_ExceptionReset(__pyx_t_8, __pyx_t_9, __pyx_t_10);
+          __pyx_L13_try_end:;
         }
-        __pyx_L9_except_error:;
-        __Pyx_XGIVEREF(__pyx_t_6);
-        __Pyx_XGIVEREF(__pyx_t_7);
-        __Pyx_XGIVEREF(__pyx_t_8);
-        __Pyx_ExceptionReset(__pyx_t_6, __pyx_t_7, __pyx_t_8);
-        goto __pyx_L1_error;
-        __pyx_L8_exception_handled:;
-        __Pyx_XGIVEREF(__pyx_t_6);
-        __Pyx_XGIVEREF(__pyx_t_7);
-        __Pyx_XGIVEREF(__pyx_t_8);
-        __Pyx_ExceptionReset(__pyx_t_6, __pyx_t_7, __pyx_t_8);
-        __pyx_L12_try_end:;
       }
-    }
-    /*finally:*/ {
-      /*normal exit:*/{
-        if (__pyx_t_3) {
-          __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_tuple__3, NULL);
-          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-          if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 275, __pyx_L1_error)
-          __Pyx_GOTREF(__pyx_t_8);
-          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
+      /*finally:*/ {
+        /*normal exit:*/{
+          if (__pyx_t_5) {
+            __pyx_t_10 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_tuple__3, NULL);
+            __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+            if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 299, __pyx_L1_error)
+            __Pyx_GOTREF(__pyx_t_10);
+            __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
+          }
+          goto __pyx_L7;
         }
-        goto __pyx_L6;
+        __pyx_L7:;
       }
-      __pyx_L6:;
+      goto __pyx_L19;
+      __pyx_L4_error:;
+      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+      goto __pyx_L1_error;
+      __pyx_L19:;
     }
-    goto __pyx_L18;
-    __pyx_L3_error:;
-    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    goto __pyx_L1_error;
-    __pyx_L18:;
-  }
 
-  /* "soapcw/soapcw.pyx":278
- *             likelihood, params = pickle.load(f1)
- * 
- *         ranges = np.linspace(params["power_ranges"][0],params["power_ranges"][1],int(params["power_ranges"][2]))             # <<<<<<<<<<<<<<
- *         fact = abs(1./(ranges[0] - ranges[1]))
+    /* "soapcw/soapcw.pyx":302
+ *                 likelihood, params = pickle.load(f1)
  * 
+ *             ranges = np.linspace(params["power_ranges"][0],params["power_ranges"][1],int(params["power_ranges"][2]))             # <<<<<<<<<<<<<<
+ *             fact = abs(1./(ranges[0] - ranges[1]))
+ *         else:
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 278, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_linspace); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 278, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_4);
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (unlikely(!__pyx_v_params)) { __Pyx_RaiseUnboundLocalError("params"); __PYX_ERR(0, 278, __pyx_L1_error) }
-  __pyx_t_2 = __Pyx_PyObject_Dict_GetItem(__pyx_v_params, __pyx_n_u_power_ranges); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 278, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_2, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 278, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (unlikely(!__pyx_v_params)) { __Pyx_RaiseUnboundLocalError("params"); __PYX_ERR(0, 278, __pyx_L1_error) }
-  __pyx_t_2 = __Pyx_PyObject_Dict_GetItem(__pyx_v_params, __pyx_n_u_power_ranges); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 278, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_13 = __Pyx_GetItemInt(__pyx_t_2, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 278, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_13);
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (unlikely(!__pyx_v_params)) { __Pyx_RaiseUnboundLocalError("params"); __PYX_ERR(0, 278, __pyx_L1_error) }
-  __pyx_t_2 = __Pyx_PyObject_Dict_GetItem(__pyx_v_params, __pyx_n_u_power_ranges); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 278, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_14 = __Pyx_GetItemInt(__pyx_t_2, 2, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 278, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_14);
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyNumber_Int(__pyx_t_14); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 278, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
-  __pyx_t_14 = NULL;
-  __pyx_t_15 = 0;
-  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
-    __pyx_t_14 = PyMethod_GET_SELF(__pyx_t_4);
-    if (likely(__pyx_t_14)) {
-      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
-      __Pyx_INCREF(__pyx_t_14);
-      __Pyx_INCREF(function);
-      __Pyx_DECREF_SET(__pyx_t_4, function);
-      __pyx_t_15 = 1;
+    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 302, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_linspace); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 302, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_6);
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    if (unlikely(!__pyx_v_params)) { __Pyx_RaiseUnboundLocalError("params"); __PYX_ERR(0, 302, __pyx_L1_error) }
+    __pyx_t_4 = __Pyx_PyObject_Dict_GetItem(__pyx_v_params, __pyx_n_u_power_ranges); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 302, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __pyx_t_7 = __Pyx_GetItemInt(__pyx_t_4, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 302, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_7);
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    if (unlikely(!__pyx_v_params)) { __Pyx_RaiseUnboundLocalError("params"); __PYX_ERR(0, 302, __pyx_L1_error) }
+    __pyx_t_4 = __Pyx_PyObject_Dict_GetItem(__pyx_v_params, __pyx_n_u_power_ranges); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 302, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __pyx_t_13 = __Pyx_GetItemInt(__pyx_t_4, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 302, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_13);
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    if (unlikely(!__pyx_v_params)) { __Pyx_RaiseUnboundLocalError("params"); __PYX_ERR(0, 302, __pyx_L1_error) }
+    __pyx_t_4 = __Pyx_PyObject_Dict_GetItem(__pyx_v_params, __pyx_n_u_power_ranges); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 302, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __pyx_t_14 = __Pyx_GetItemInt(__pyx_t_4, 2, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 302, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_14);
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    __pyx_t_4 = __Pyx_PyNumber_Int(__pyx_t_14); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 302, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
+    __pyx_t_14 = NULL;
+    __pyx_t_15 = 0;
+    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_6))) {
+      __pyx_t_14 = PyMethod_GET_SELF(__pyx_t_6);
+      if (likely(__pyx_t_14)) {
+        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
+        __Pyx_INCREF(__pyx_t_14);
+        __Pyx_INCREF(function);
+        __Pyx_DECREF_SET(__pyx_t_6, function);
+        __pyx_t_15 = 1;
+      }
     }
-  }
-  #if CYTHON_FAST_PYCALL
-  if (PyFunction_Check(__pyx_t_4)) {
-    PyObject *__pyx_temp[4] = {__pyx_t_14, __pyx_t_5, __pyx_t_13, __pyx_t_2};
-    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_15, 3+__pyx_t_15); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 278, __pyx_L1_error)
-    __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
-    __Pyx_GOTREF(__pyx_t_1);
-    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  } else
-  #endif
-  #if CYTHON_FAST_PYCCALL
-  if (__Pyx_PyFastCFunction_Check(__pyx_t_4)) {
-    PyObject *__pyx_temp[4] = {__pyx_t_14, __pyx_t_5, __pyx_t_13, __pyx_t_2};
-    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_15, 3+__pyx_t_15); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 278, __pyx_L1_error)
-    __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
-    __Pyx_GOTREF(__pyx_t_1);
-    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  } else
-  #endif
-  {
-    __pyx_t_16 = PyTuple_New(3+__pyx_t_15); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 278, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_16);
-    if (__pyx_t_14) {
-      __Pyx_GIVEREF(__pyx_t_14); PyTuple_SET_ITEM(__pyx_t_16, 0, __pyx_t_14); __pyx_t_14 = NULL;
+    #if CYTHON_FAST_PYCALL
+    if (PyFunction_Check(__pyx_t_6)) {
+      PyObject *__pyx_temp[4] = {__pyx_t_14, __pyx_t_7, __pyx_t_13, __pyx_t_4};
+      __pyx_t_3 = __Pyx_PyFunction_FastCall(__pyx_t_6, __pyx_temp+1-__pyx_t_15, 3+__pyx_t_15); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 302, __pyx_L1_error)
+      __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
+      __Pyx_GOTREF(__pyx_t_3);
+      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
+      __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
+      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    } else
+    #endif
+    #if CYTHON_FAST_PYCCALL
+    if (__Pyx_PyFastCFunction_Check(__pyx_t_6)) {
+      PyObject *__pyx_temp[4] = {__pyx_t_14, __pyx_t_7, __pyx_t_13, __pyx_t_4};
+      __pyx_t_3 = __Pyx_PyCFunction_FastCall(__pyx_t_6, __pyx_temp+1-__pyx_t_15, 3+__pyx_t_15); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 302, __pyx_L1_error)
+      __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
+      __Pyx_GOTREF(__pyx_t_3);
+      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
+      __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
+      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    } else
+    #endif
+    {
+      __pyx_t_16 = PyTuple_New(3+__pyx_t_15); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 302, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_16);
+      if (__pyx_t_14) {
+        __Pyx_GIVEREF(__pyx_t_14); PyTuple_SET_ITEM(__pyx_t_16, 0, __pyx_t_14); __pyx_t_14 = NULL;
+      }
+      __Pyx_GIVEREF(__pyx_t_7);
+      PyTuple_SET_ITEM(__pyx_t_16, 0+__pyx_t_15, __pyx_t_7);
+      __Pyx_GIVEREF(__pyx_t_13);
+      PyTuple_SET_ITEM(__pyx_t_16, 1+__pyx_t_15, __pyx_t_13);
+      __Pyx_GIVEREF(__pyx_t_4);
+      PyTuple_SET_ITEM(__pyx_t_16, 2+__pyx_t_15, __pyx_t_4);
+      __pyx_t_7 = 0;
+      __pyx_t_13 = 0;
+      __pyx_t_4 = 0;
+      __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_16, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 302, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_3);
+      __Pyx_DECREF(__pyx_t_16); __pyx_t_16 = 0;
     }
-    __Pyx_GIVEREF(__pyx_t_5);
-    PyTuple_SET_ITEM(__pyx_t_16, 0+__pyx_t_15, __pyx_t_5);
-    __Pyx_GIVEREF(__pyx_t_13);
-    PyTuple_SET_ITEM(__pyx_t_16, 1+__pyx_t_15, __pyx_t_13);
-    __Pyx_GIVEREF(__pyx_t_2);
-    PyTuple_SET_ITEM(__pyx_t_16, 2+__pyx_t_15, __pyx_t_2);
-    __pyx_t_5 = 0;
-    __pyx_t_13 = 0;
-    __pyx_t_2 = 0;
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_16, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 278, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_1);
+    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
+    __pyx_v_ranges = __pyx_t_3;
+    __pyx_t_3 = 0;
+
+    /* "soapcw/soapcw.pyx":303
+ * 
+ *             ranges = np.linspace(params["power_ranges"][0],params["power_ranges"][1],int(params["power_ranges"][2]))
+ *             fact = abs(1./(ranges[0] - ranges[1]))             # <<<<<<<<<<<<<<
+ *         else:
+ *             # if it is a line aware stat object then creat ranges from the object
+ */
+    __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_ranges, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 303, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_3);
+    __pyx_t_6 = __Pyx_GetItemInt(__pyx_v_ranges, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 303, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_6);
+    __pyx_t_16 = PyNumber_Subtract(__pyx_t_3, __pyx_t_6); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 303, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_16);
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
+    __pyx_t_6 = __Pyx_PyFloat_TrueDivideCObj(__pyx_float_1_, __pyx_t_16, 1., 0, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 303, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_16); __pyx_t_16 = 0;
+    __pyx_t_16 = __Pyx_PyNumber_Absolute(__pyx_t_6); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 303, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_16);
+    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
+    __pyx_v_fact = __pyx_t_16;
+    __pyx_t_16 = 0;
+
+    /* "soapcw/soapcw.pyx":297
+ *         """
+ * 
+ *         if isinstance(lookup_table, str):             # <<<<<<<<<<<<<<
+ *             # if it is a filename the load the file and create ranges from that
+ *             with open(lookup_table,'rb') as f1:
+ */
+    goto __pyx_L3;
   }
-  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_v_ranges = __pyx_t_1;
-  __pyx_t_1 = 0;
 
-  /* "soapcw/soapcw.pyx":279
+  /* "soapcw/soapcw.pyx":307
+ *             # if it is a line aware stat object then creat ranges from the object
+ *             # get the log odds ratio as the statitsic to use
+ *             likelihood = np.log(lookup_table.signoiseline)             # <<<<<<<<<<<<<<
+ *             ranges = lookup_table.powers
+ *             fact = abs(1./(ranges[0] - ranges[1]))
+ */
+  /*else*/ {
+    __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 307, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_6);
+    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_log); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 307, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_3);
+    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
+    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_lookup_table, __pyx_n_s_signoiseline); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 307, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_6);
+    __pyx_t_4 = NULL;
+    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
+      __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
+      if (likely(__pyx_t_4)) {
+        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
+        __Pyx_INCREF(__pyx_t_4);
+        __Pyx_INCREF(function);
+        __Pyx_DECREF_SET(__pyx_t_3, function);
+      }
+    }
+    __pyx_t_16 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_t_6) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_6);
+    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
+    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
+    if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 307, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_16);
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    __pyx_v_likelihood = __pyx_t_16;
+    __pyx_t_16 = 0;
+
+    /* "soapcw/soapcw.pyx":308
+ *             # get the log odds ratio as the statitsic to use
+ *             likelihood = np.log(lookup_table.signoiseline)
+ *             ranges = lookup_table.powers             # <<<<<<<<<<<<<<
+ *             fact = abs(1./(ranges[0] - ranges[1]))
  * 
- *         ranges = np.linspace(params["power_ranges"][0],params["power_ranges"][1],int(params["power_ranges"][2]))
- *         fact = abs(1./(ranges[0] - ranges[1]))             # <<<<<<<<<<<<<<
+ */
+    __pyx_t_16 = __Pyx_PyObject_GetAttrStr(__pyx_v_lookup_table, __pyx_n_s_powers); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 308, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_16);
+    __pyx_v_ranges = __pyx_t_16;
+    __pyx_t_16 = 0;
+
+    /* "soapcw/soapcw.pyx":309
+ *             likelihood = np.log(lookup_table.signoiseline)
+ *             ranges = lookup_table.powers
+ *             fact = abs(1./(ranges[0] - ranges[1]))             # <<<<<<<<<<<<<<
  * 
  *         return likelihood, ranges, fact
  */
-  __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_ranges, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 279, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = __Pyx_GetItemInt(__pyx_v_ranges, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 279, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_16 = PyNumber_Subtract(__pyx_t_1, __pyx_t_4); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 279, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_16);
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyFloat_TrueDivideCObj(__pyx_float_1_, __pyx_t_16, 1., 0, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 279, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_4);
-  __Pyx_DECREF(__pyx_t_16); __pyx_t_16 = 0;
-  __pyx_t_16 = __Pyx_PyNumber_Absolute(__pyx_t_4); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 279, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_16);
-  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_v_fact = __pyx_t_16;
-  __pyx_t_16 = 0;
+    __pyx_t_16 = __Pyx_GetItemInt(__pyx_v_ranges, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 309, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_16);
+    __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_ranges, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 309, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_3);
+    __pyx_t_6 = PyNumber_Subtract(__pyx_t_16, __pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 309, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_6);
+    __Pyx_DECREF(__pyx_t_16); __pyx_t_16 = 0;
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    __pyx_t_3 = __Pyx_PyFloat_TrueDivideCObj(__pyx_float_1_, __pyx_t_6, 1., 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 309, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_3);
+    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
+    __pyx_t_6 = __Pyx_PyNumber_Absolute(__pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 309, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_6);
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    __pyx_v_fact = __pyx_t_6;
+    __pyx_t_6 = 0;
+  }
+  __pyx_L3:;
 
-  /* "soapcw/soapcw.pyx":281
- *         fact = abs(1./(ranges[0] - ranges[1]))
+  /* "soapcw/soapcw.pyx":311
+ *             fact = abs(1./(ranges[0] - ranges[1]))
  * 
  *         return likelihood, ranges, fact             # <<<<<<<<<<<<<<
  * 
- *     def read_lookup_amp(self,filename):
+ *     def read_lookup_amp(self,lookup_table):
  */
   __Pyx_XDECREF(__pyx_r);
-  if (unlikely(!__pyx_v_likelihood)) { __Pyx_RaiseUnboundLocalError("likelihood"); __PYX_ERR(0, 281, __pyx_L1_error) }
-  __pyx_t_16 = PyTuple_New(3); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 281, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_16);
+  if (unlikely(!__pyx_v_likelihood)) { __Pyx_RaiseUnboundLocalError("likelihood"); __PYX_ERR(0, 311, __pyx_L1_error) }
+  __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 311, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_6);
   __Pyx_INCREF(__pyx_v_likelihood);
   __Pyx_GIVEREF(__pyx_v_likelihood);
-  PyTuple_SET_ITEM(__pyx_t_16, 0, __pyx_v_likelihood);
+  PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_v_likelihood);
   __Pyx_INCREF(__pyx_v_ranges);
   __Pyx_GIVEREF(__pyx_v_ranges);
-  PyTuple_SET_ITEM(__pyx_t_16, 1, __pyx_v_ranges);
+  PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_v_ranges);
   __Pyx_INCREF(__pyx_v_fact);
   __Pyx_GIVEREF(__pyx_v_fact);
-  PyTuple_SET_ITEM(__pyx_t_16, 2, __pyx_v_fact);
-  __pyx_r = __pyx_t_16;
-  __pyx_t_16 = 0;
+  PyTuple_SET_ITEM(__pyx_t_6, 2, __pyx_v_fact);
+  __pyx_r = __pyx_t_6;
+  __pyx_t_6 = 0;
   goto __pyx_L0;
 
-  /* "soapcw/soapcw.pyx":273
+  /* "soapcw/soapcw.pyx":280
  *     #--------------------------------------------------------
  * 
- *     def read_lookup(self,filename):             # <<<<<<<<<<<<<<
- * 
- *         with open(filename,'rb') as f1:
+ *     def read_lookup(self,lookup_table):             # <<<<<<<<<<<<<<
+ *         """
+ *         Read a lookup table from a file of a LineAwareStatistic object
  */
 
   /* function exit code */
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_XDECREF(__pyx_t_3);
   __Pyx_XDECREF(__pyx_t_4);
-  __Pyx_XDECREF(__pyx_t_5);
+  __Pyx_XDECREF(__pyx_t_6);
+  __Pyx_XDECREF(__pyx_t_7);
   __Pyx_XDECREF(__pyx_t_13);
   __Pyx_XDECREF(__pyx_t_14);
   __Pyx_XDECREF(__pyx_t_16);
   __Pyx_AddTraceback("soapcw.soapcw.two_detector.read_lookup", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XDECREF(__pyx_v_f1);
@@ -7805,36 +8013,37 @@
   __Pyx_XDECREF(__pyx_v_ranges);
   __Pyx_XDECREF(__pyx_v_fact);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "soapcw/soapcw.pyx":283
+/* "soapcw/soapcw.pyx":313
  *         return likelihood, ranges, fact
  * 
- *     def read_lookup_amp(self,filename):             # <<<<<<<<<<<<<<
- * 
- *         with open(filename,'rb') as f1:
+ *     def read_lookup_amp(self,lookup_table):             # <<<<<<<<<<<<<<
+ *         """
+ *         Read a lookup table from a file of a LineAwareStatisticAmplitude object
  */
 
 /* Python wrapper */
 static PyObject *__pyx_pw_6soapcw_6soapcw_12two_detector_7read_lookup_amp(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_mdef_6soapcw_6soapcw_12two_detector_7read_lookup_amp = {"read_lookup_amp", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6soapcw_6soapcw_12two_detector_7read_lookup_amp, METH_VARARGS|METH_KEYWORDS, 0};
+static char __pyx_doc_6soapcw_6soapcw_12two_detector_6read_lookup_amp[] = "\n        Read a lookup table from a file of a LineAwareStatisticAmplitude object\n        args \n        ------\n        lookup_table: string or LineAwareStatisticAmplitude\n            filename to saved lookupt table or lineaware statistic object\n        returns\n        ---------\n        likelihood: array\n            returns odds ratio from file to use as statistic\n        pow_ranges: array\n            ranges of the x,y axis of the odds ratio (spectrogram power)\n        frac_ranges: array\n            ranges of the x,y axis of the odds ratio ()\n        pow_fact: float\n            spacing of the ranges of power\n        frac_fact: float\n            spacing of the ranges of data fraction\n        ";
+static PyMethodDef __pyx_mdef_6soapcw_6soapcw_12two_detector_7read_lookup_amp = {"read_lookup_amp", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6soapcw_6soapcw_12two_detector_7read_lookup_amp, METH_VARARGS|METH_KEYWORDS, __pyx_doc_6soapcw_6soapcw_12two_detector_6read_lookup_amp};
 static PyObject *__pyx_pw_6soapcw_6soapcw_12two_detector_7read_lookup_amp(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   CYTHON_UNUSED PyObject *__pyx_v_self = 0;
-  PyObject *__pyx_v_filename = 0;
+  PyObject *__pyx_v_lookup_table = 0;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("read_lookup_amp (wrapper)", 0);
   {
-    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_self,&__pyx_n_s_filename,0};
+    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_self,&__pyx_n_s_lookup_table,0};
     PyObject* values[2] = {0,0};
     if (unlikely(__pyx_kwds)) {
       Py_ssize_t kw_args;
       const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
       switch (pos_args) {
         case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
         CYTHON_FALLTHROUGH;
@@ -7846,563 +8055,692 @@
       kw_args = PyDict_Size(__pyx_kwds);
       switch (pos_args) {
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
-        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_filename)) != 0)) kw_args--;
+        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_lookup_table)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("read_lookup_amp", 1, 2, 2, 1); __PYX_ERR(0, 283, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("read_lookup_amp", 1, 2, 2, 1); __PYX_ERR(0, 313, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "read_lookup_amp") < 0)) __PYX_ERR(0, 283, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "read_lookup_amp") < 0)) __PYX_ERR(0, 313, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
     }
     __pyx_v_self = values[0];
-    __pyx_v_filename = values[1];
+    __pyx_v_lookup_table = values[1];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("read_lookup_amp", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 283, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("read_lookup_amp", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 313, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("soapcw.soapcw.two_detector.read_lookup_amp", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_6soapcw_6soapcw_12two_detector_6read_lookup_amp(__pyx_self, __pyx_v_self, __pyx_v_filename);
+  __pyx_r = __pyx_pf_6soapcw_6soapcw_12two_detector_6read_lookup_amp(__pyx_self, __pyx_v_self, __pyx_v_lookup_table);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_6soapcw_6soapcw_12two_detector_6read_lookup_amp(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_self, PyObject *__pyx_v_filename) {
+static PyObject *__pyx_pf_6soapcw_6soapcw_12two_detector_6read_lookup_amp(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_self, PyObject *__pyx_v_lookup_table) {
   PyObject *__pyx_v_f1 = NULL;
   PyObject *__pyx_v_likelihood = NULL;
   PyObject *__pyx_v_params = NULL;
   PyObject *__pyx_v_pow_ranges = NULL;
   PyObject *__pyx_v_frac_ranges = NULL;
   PyObject *__pyx_v_pow_fact = NULL;
   PyObject *__pyx_v_frac_fact = NULL;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
-  PyObject *__pyx_t_1 = NULL;
-  PyObject *__pyx_t_2 = NULL;
+  int __pyx_t_1;
+  int __pyx_t_2;
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
   PyObject *__pyx_t_6 = NULL;
   PyObject *__pyx_t_7 = NULL;
   PyObject *__pyx_t_8 = NULL;
-  PyObject *(*__pyx_t_9)(PyObject *);
+  PyObject *__pyx_t_9 = NULL;
   PyObject *__pyx_t_10 = NULL;
-  int __pyx_t_11;
-  int __pyx_t_12;
+  PyObject *(*__pyx_t_11)(PyObject *);
+  PyObject *__pyx_t_12 = NULL;
   PyObject *__pyx_t_13 = NULL;
   PyObject *__pyx_t_14 = NULL;
   int __pyx_t_15;
   PyObject *__pyx_t_16 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("read_lookup_amp", 0);
 
-  /* "soapcw/soapcw.pyx":285
- *     def read_lookup_amp(self,filename):
- * 
- *         with open(filename,'rb') as f1:             # <<<<<<<<<<<<<<
- *             likelihood, params = pickle.load(f1)
- * 
+  /* "soapcw/soapcw.pyx":333
+ *             spacing of the ranges of data fraction
+ *         """
+ *         if isinstance(lookup_table, str):             # <<<<<<<<<<<<<<
+ *             with open(lookup_table,'rb') as f1:
+ *                 likelihood, params = pickle.load(f1)
  */
-  /*with:*/ {
-    __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 285, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_1);
-    __Pyx_INCREF(__pyx_v_filename);
-    __Pyx_GIVEREF(__pyx_v_filename);
-    PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_filename);
-    __Pyx_INCREF(__pyx_n_u_rb);
-    __Pyx_GIVEREF(__pyx_n_u_rb);
-    PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_n_u_rb);
-    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_open, __pyx_t_1, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 285, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_2);
-    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_3 = __Pyx_PyObject_LookupSpecial(__pyx_t_2, __pyx_n_s_exit); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 285, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_4 = __Pyx_PyObject_LookupSpecial(__pyx_t_2, __pyx_n_s_enter); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 285, __pyx_L3_error)
-    __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_5 = NULL;
-    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
-      __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
-      if (likely(__pyx_t_5)) {
-        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
-        __Pyx_INCREF(__pyx_t_5);
-        __Pyx_INCREF(function);
-        __Pyx_DECREF_SET(__pyx_t_4, function);
-      }
-    }
-    __pyx_t_1 = (__pyx_t_5) ? __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_5) : __Pyx_PyObject_CallNoArg(__pyx_t_4);
-    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
-    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 285, __pyx_L3_error)
-    __Pyx_GOTREF(__pyx_t_1);
-    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_t_4 = __pyx_t_1;
-    __pyx_t_1 = 0;
-    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    /*try:*/ {
-      {
-        __Pyx_PyThreadState_declare
-        __Pyx_PyThreadState_assign
-        __Pyx_ExceptionSave(&__pyx_t_6, &__pyx_t_7, &__pyx_t_8);
-        __Pyx_XGOTREF(__pyx_t_6);
-        __Pyx_XGOTREF(__pyx_t_7);
-        __Pyx_XGOTREF(__pyx_t_8);
-        /*try:*/ {
-          __pyx_v_f1 = __pyx_t_4;
-          __pyx_t_4 = 0;
+  __pyx_t_1 = PyUnicode_Check(__pyx_v_lookup_table); 
+  __pyx_t_2 = (__pyx_t_1 != 0);
+  if (__pyx_t_2) {
 
-          /* "soapcw/soapcw.pyx":286
- * 
- *         with open(filename,'rb') as f1:
- *             likelihood, params = pickle.load(f1)             # <<<<<<<<<<<<<<
+    /* "soapcw/soapcw.pyx":334
+ *         """
+ *         if isinstance(lookup_table, str):
+ *             with open(lookup_table,'rb') as f1:             # <<<<<<<<<<<<<<
+ *                 likelihood, params = pickle.load(f1)
  * 
- *         pow_ranges = np.linspace(params["power_ranges"][0],params["power_ranges"][1],int(params["power_ranges"][2]))
  */
-          __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_pickle); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 286, __pyx_L7_error)
-          __Pyx_GOTREF(__pyx_t_2);
-          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_load); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 286, __pyx_L7_error)
-          __Pyx_GOTREF(__pyx_t_1);
-          __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-          __pyx_t_2 = NULL;
-          if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_1))) {
-            __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_1);
-            if (likely(__pyx_t_2)) {
-              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
-              __Pyx_INCREF(__pyx_t_2);
-              __Pyx_INCREF(function);
-              __Pyx_DECREF_SET(__pyx_t_1, function);
-            }
-          }
-          __pyx_t_4 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_2, __pyx_v_f1) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_v_f1);
-          __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-          if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 286, __pyx_L7_error)
-          __Pyx_GOTREF(__pyx_t_4);
-          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-          if ((likely(PyTuple_CheckExact(__pyx_t_4))) || (PyList_CheckExact(__pyx_t_4))) {
-            PyObject* sequence = __pyx_t_4;
-            Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
-            if (unlikely(size != 2)) {
-              if (size > 2) __Pyx_RaiseTooManyValuesError(2);
-              else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
-              __PYX_ERR(0, 286, __pyx_L7_error)
+    /*with:*/ {
+      __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 334, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_3);
+      __Pyx_INCREF(__pyx_v_lookup_table);
+      __Pyx_GIVEREF(__pyx_v_lookup_table);
+      PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_lookup_table);
+      __Pyx_INCREF(__pyx_n_u_rb);
+      __Pyx_GIVEREF(__pyx_n_u_rb);
+      PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_n_u_rb);
+      __pyx_t_4 = __Pyx_PyObject_Call(__pyx_builtin_open, __pyx_t_3, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 334, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_4);
+      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+      __pyx_t_5 = __Pyx_PyObject_LookupSpecial(__pyx_t_4, __pyx_n_s_exit); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 334, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_5);
+      __pyx_t_6 = __Pyx_PyObject_LookupSpecial(__pyx_t_4, __pyx_n_s_enter); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 334, __pyx_L4_error)
+      __Pyx_GOTREF(__pyx_t_6);
+      __pyx_t_7 = NULL;
+      if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_6))) {
+        __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_6);
+        if (likely(__pyx_t_7)) {
+          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
+          __Pyx_INCREF(__pyx_t_7);
+          __Pyx_INCREF(function);
+          __Pyx_DECREF_SET(__pyx_t_6, function);
+        }
+      }
+      __pyx_t_3 = (__pyx_t_7) ? __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_t_7) : __Pyx_PyObject_CallNoArg(__pyx_t_6);
+      __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
+      if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 334, __pyx_L4_error)
+      __Pyx_GOTREF(__pyx_t_3);
+      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
+      __pyx_t_6 = __pyx_t_3;
+      __pyx_t_3 = 0;
+      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+      /*try:*/ {
+        {
+          __Pyx_PyThreadState_declare
+          __Pyx_PyThreadState_assign
+          __Pyx_ExceptionSave(&__pyx_t_8, &__pyx_t_9, &__pyx_t_10);
+          __Pyx_XGOTREF(__pyx_t_8);
+          __Pyx_XGOTREF(__pyx_t_9);
+          __Pyx_XGOTREF(__pyx_t_10);
+          /*try:*/ {
+            __pyx_v_f1 = __pyx_t_6;
+            __pyx_t_6 = 0;
+
+            /* "soapcw/soapcw.pyx":335
+ *         if isinstance(lookup_table, str):
+ *             with open(lookup_table,'rb') as f1:
+ *                 likelihood, params = pickle.load(f1)             # <<<<<<<<<<<<<<
+ * 
+ *             pow_ranges = np.linspace(params["power_ranges"][0],params["power_ranges"][1],int(params["power_ranges"][2]))
+ */
+            __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_pickle); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 335, __pyx_L8_error)
+            __Pyx_GOTREF(__pyx_t_4);
+            __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_load); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 335, __pyx_L8_error)
+            __Pyx_GOTREF(__pyx_t_3);
+            __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+            __pyx_t_4 = NULL;
+            if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
+              __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
+              if (likely(__pyx_t_4)) {
+                PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
+                __Pyx_INCREF(__pyx_t_4);
+                __Pyx_INCREF(function);
+                __Pyx_DECREF_SET(__pyx_t_3, function);
+              }
             }
-            #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-            if (likely(PyTuple_CheckExact(sequence))) {
-              __pyx_t_1 = PyTuple_GET_ITEM(sequence, 0); 
-              __pyx_t_2 = PyTuple_GET_ITEM(sequence, 1); 
+            __pyx_t_6 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_v_f1) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_f1);
+            __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
+            if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 335, __pyx_L8_error)
+            __Pyx_GOTREF(__pyx_t_6);
+            __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+            if ((likely(PyTuple_CheckExact(__pyx_t_6))) || (PyList_CheckExact(__pyx_t_6))) {
+              PyObject* sequence = __pyx_t_6;
+              Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
+              if (unlikely(size != 2)) {
+                if (size > 2) __Pyx_RaiseTooManyValuesError(2);
+                else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
+                __PYX_ERR(0, 335, __pyx_L8_error)
+              }
+              #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
+              if (likely(PyTuple_CheckExact(sequence))) {
+                __pyx_t_3 = PyTuple_GET_ITEM(sequence, 0); 
+                __pyx_t_4 = PyTuple_GET_ITEM(sequence, 1); 
+              } else {
+                __pyx_t_3 = PyList_GET_ITEM(sequence, 0); 
+                __pyx_t_4 = PyList_GET_ITEM(sequence, 1); 
+              }
+              __Pyx_INCREF(__pyx_t_3);
+              __Pyx_INCREF(__pyx_t_4);
+              #else
+              __pyx_t_3 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 335, __pyx_L8_error)
+              __Pyx_GOTREF(__pyx_t_3);
+              __pyx_t_4 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 335, __pyx_L8_error)
+              __Pyx_GOTREF(__pyx_t_4);
+              #endif
+              __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
             } else {
-              __pyx_t_1 = PyList_GET_ITEM(sequence, 0); 
-              __pyx_t_2 = PyList_GET_ITEM(sequence, 1); 
+              Py_ssize_t index = -1;
+              __pyx_t_7 = PyObject_GetIter(__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 335, __pyx_L8_error)
+              __Pyx_GOTREF(__pyx_t_7);
+              __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
+              __pyx_t_11 = Py_TYPE(__pyx_t_7)->tp_iternext;
+              index = 0; __pyx_t_3 = __pyx_t_11(__pyx_t_7); if (unlikely(!__pyx_t_3)) goto __pyx_L14_unpacking_failed;
+              __Pyx_GOTREF(__pyx_t_3);
+              index = 1; __pyx_t_4 = __pyx_t_11(__pyx_t_7); if (unlikely(!__pyx_t_4)) goto __pyx_L14_unpacking_failed;
+              __Pyx_GOTREF(__pyx_t_4);
+              if (__Pyx_IternextUnpackEndCheck(__pyx_t_11(__pyx_t_7), 2) < 0) __PYX_ERR(0, 335, __pyx_L8_error)
+              __pyx_t_11 = NULL;
+              __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
+              goto __pyx_L15_unpacking_done;
+              __pyx_L14_unpacking_failed:;
+              __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
+              __pyx_t_11 = NULL;
+              if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
+              __PYX_ERR(0, 335, __pyx_L8_error)
+              __pyx_L15_unpacking_done:;
             }
-            __Pyx_INCREF(__pyx_t_1);
-            __Pyx_INCREF(__pyx_t_2);
-            #else
-            __pyx_t_1 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 286, __pyx_L7_error)
-            __Pyx_GOTREF(__pyx_t_1);
-            __pyx_t_2 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 286, __pyx_L7_error)
-            __Pyx_GOTREF(__pyx_t_2);
-            #endif
-            __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-          } else {
-            Py_ssize_t index = -1;
-            __pyx_t_5 = PyObject_GetIter(__pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 286, __pyx_L7_error)
-            __Pyx_GOTREF(__pyx_t_5);
-            __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-            __pyx_t_9 = Py_TYPE(__pyx_t_5)->tp_iternext;
-            index = 0; __pyx_t_1 = __pyx_t_9(__pyx_t_5); if (unlikely(!__pyx_t_1)) goto __pyx_L13_unpacking_failed;
-            __Pyx_GOTREF(__pyx_t_1);
-            index = 1; __pyx_t_2 = __pyx_t_9(__pyx_t_5); if (unlikely(!__pyx_t_2)) goto __pyx_L13_unpacking_failed;
-            __Pyx_GOTREF(__pyx_t_2);
-            if (__Pyx_IternextUnpackEndCheck(__pyx_t_9(__pyx_t_5), 2) < 0) __PYX_ERR(0, 286, __pyx_L7_error)
-            __pyx_t_9 = NULL;
-            __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-            goto __pyx_L14_unpacking_done;
-            __pyx_L13_unpacking_failed:;
-            __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-            __pyx_t_9 = NULL;
-            if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
-            __PYX_ERR(0, 286, __pyx_L7_error)
-            __pyx_L14_unpacking_done:;
-          }
-          __pyx_v_likelihood = __pyx_t_1;
-          __pyx_t_1 = 0;
-          __pyx_v_params = __pyx_t_2;
-          __pyx_t_2 = 0;
+            __pyx_v_likelihood = __pyx_t_3;
+            __pyx_t_3 = 0;
+            __pyx_v_params = __pyx_t_4;
+            __pyx_t_4 = 0;
 
-          /* "soapcw/soapcw.pyx":285
- *     def read_lookup_amp(self,filename):
- * 
- *         with open(filename,'rb') as f1:             # <<<<<<<<<<<<<<
- *             likelihood, params = pickle.load(f1)
+            /* "soapcw/soapcw.pyx":334
+ *         """
+ *         if isinstance(lookup_table, str):
+ *             with open(lookup_table,'rb') as f1:             # <<<<<<<<<<<<<<
+ *                 likelihood, params = pickle.load(f1)
  * 
  */
-        }
-        __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
-        __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
-        __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
-        goto __pyx_L12_try_end;
-        __pyx_L7_error:;
-        __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
-        __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-        __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
-        /*except:*/ {
-          __Pyx_AddTraceback("soapcw.soapcw.two_detector.read_lookup_amp", __pyx_clineno, __pyx_lineno, __pyx_filename);
-          if (__Pyx_GetException(&__pyx_t_4, &__pyx_t_2, &__pyx_t_1) < 0) __PYX_ERR(0, 285, __pyx_L9_except_error)
-          __Pyx_GOTREF(__pyx_t_4);
-          __Pyx_GOTREF(__pyx_t_2);
-          __Pyx_GOTREF(__pyx_t_1);
-          __pyx_t_5 = PyTuple_Pack(3, __pyx_t_4, __pyx_t_2, __pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 285, __pyx_L9_except_error)
-          __Pyx_GOTREF(__pyx_t_5);
-          __pyx_t_10 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_5, NULL);
-          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-          if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 285, __pyx_L9_except_error)
-          __Pyx_GOTREF(__pyx_t_10);
-          __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_t_10);
-          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-          if (__pyx_t_11 < 0) __PYX_ERR(0, 285, __pyx_L9_except_error)
-          __pyx_t_12 = ((!(__pyx_t_11 != 0)) != 0);
-          if (__pyx_t_12) {
-            __Pyx_GIVEREF(__pyx_t_4);
-            __Pyx_GIVEREF(__pyx_t_2);
-            __Pyx_XGIVEREF(__pyx_t_1);
-            __Pyx_ErrRestoreWithState(__pyx_t_4, __pyx_t_2, __pyx_t_1);
-            __pyx_t_4 = 0; __pyx_t_2 = 0; __pyx_t_1 = 0; 
-            __PYX_ERR(0, 285, __pyx_L9_except_error)
           }
+          __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
+          __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
+          __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
+          goto __pyx_L13_try_end;
+          __pyx_L8_error:;
+          __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
           __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-          __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-          __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
-          goto __pyx_L8_exception_handled;
+          __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
+          __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
+          /*except:*/ {
+            __Pyx_AddTraceback("soapcw.soapcw.two_detector.read_lookup_amp", __pyx_clineno, __pyx_lineno, __pyx_filename);
+            if (__Pyx_GetException(&__pyx_t_6, &__pyx_t_4, &__pyx_t_3) < 0) __PYX_ERR(0, 334, __pyx_L10_except_error)
+            __Pyx_GOTREF(__pyx_t_6);
+            __Pyx_GOTREF(__pyx_t_4);
+            __Pyx_GOTREF(__pyx_t_3);
+            __pyx_t_7 = PyTuple_Pack(3, __pyx_t_6, __pyx_t_4, __pyx_t_3); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 334, __pyx_L10_except_error)
+            __Pyx_GOTREF(__pyx_t_7);
+            __pyx_t_12 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_7, NULL);
+            __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+            __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
+            if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 334, __pyx_L10_except_error)
+            __Pyx_GOTREF(__pyx_t_12);
+            __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_12);
+            __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
+            if (__pyx_t_2 < 0) __PYX_ERR(0, 334, __pyx_L10_except_error)
+            __pyx_t_1 = ((!(__pyx_t_2 != 0)) != 0);
+            if (__pyx_t_1) {
+              __Pyx_GIVEREF(__pyx_t_6);
+              __Pyx_GIVEREF(__pyx_t_4);
+              __Pyx_XGIVEREF(__pyx_t_3);
+              __Pyx_ErrRestoreWithState(__pyx_t_6, __pyx_t_4, __pyx_t_3);
+              __pyx_t_6 = 0; __pyx_t_4 = 0; __pyx_t_3 = 0; 
+              __PYX_ERR(0, 334, __pyx_L10_except_error)
+            }
+            __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
+            __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
+            __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
+            goto __pyx_L9_exception_handled;
+          }
+          __pyx_L10_except_error:;
+          __Pyx_XGIVEREF(__pyx_t_8);
+          __Pyx_XGIVEREF(__pyx_t_9);
+          __Pyx_XGIVEREF(__pyx_t_10);
+          __Pyx_ExceptionReset(__pyx_t_8, __pyx_t_9, __pyx_t_10);
+          goto __pyx_L1_error;
+          __pyx_L9_exception_handled:;
+          __Pyx_XGIVEREF(__pyx_t_8);
+          __Pyx_XGIVEREF(__pyx_t_9);
+          __Pyx_XGIVEREF(__pyx_t_10);
+          __Pyx_ExceptionReset(__pyx_t_8, __pyx_t_9, __pyx_t_10);
+          __pyx_L13_try_end:;
         }
-        __pyx_L9_except_error:;
-        __Pyx_XGIVEREF(__pyx_t_6);
-        __Pyx_XGIVEREF(__pyx_t_7);
-        __Pyx_XGIVEREF(__pyx_t_8);
-        __Pyx_ExceptionReset(__pyx_t_6, __pyx_t_7, __pyx_t_8);
-        goto __pyx_L1_error;
-        __pyx_L8_exception_handled:;
-        __Pyx_XGIVEREF(__pyx_t_6);
-        __Pyx_XGIVEREF(__pyx_t_7);
-        __Pyx_XGIVEREF(__pyx_t_8);
-        __Pyx_ExceptionReset(__pyx_t_6, __pyx_t_7, __pyx_t_8);
-        __pyx_L12_try_end:;
       }
-    }
-    /*finally:*/ {
-      /*normal exit:*/{
-        if (__pyx_t_3) {
-          __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_tuple__3, NULL);
-          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-          if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 285, __pyx_L1_error)
-          __Pyx_GOTREF(__pyx_t_8);
-          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
+      /*finally:*/ {
+        /*normal exit:*/{
+          if (__pyx_t_5) {
+            __pyx_t_10 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_tuple__3, NULL);
+            __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+            if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 334, __pyx_L1_error)
+            __Pyx_GOTREF(__pyx_t_10);
+            __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
+          }
+          goto __pyx_L7;
         }
-        goto __pyx_L6;
+        __pyx_L7:;
       }
-      __pyx_L6:;
+      goto __pyx_L19;
+      __pyx_L4_error:;
+      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+      goto __pyx_L1_error;
+      __pyx_L19:;
     }
-    goto __pyx_L18;
-    __pyx_L3_error:;
-    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    goto __pyx_L1_error;
-    __pyx_L18:;
-  }
 
-  /* "soapcw/soapcw.pyx":288
- *             likelihood, params = pickle.load(f1)
+    /* "soapcw/soapcw.pyx":337
+ *                 likelihood, params = pickle.load(f1)
  * 
- *         pow_ranges = np.linspace(params["power_ranges"][0],params["power_ranges"][1],int(params["power_ranges"][2]))             # <<<<<<<<<<<<<<
- *         frac_ranges = np.linspace(params["fraction_ranges"][0],params["fraction_ranges"][1],int(params["fraction_ranges"][2]))
- *         pow_fact = abs(1./(pow_ranges[0] - pow_ranges[1]))
+ *             pow_ranges = np.linspace(params["power_ranges"][0],params["power_ranges"][1],int(params["power_ranges"][2]))             # <<<<<<<<<<<<<<
+ *             frac_ranges = np.linspace(params["fraction_ranges"][0],params["fraction_ranges"][1],int(params["fraction_ranges"][2]))
+ *             pow_fact = abs(1./(pow_ranges[0] - pow_ranges[1]))
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 288, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_linspace); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 288, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_4);
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (unlikely(!__pyx_v_params)) { __Pyx_RaiseUnboundLocalError("params"); __PYX_ERR(0, 288, __pyx_L1_error) }
-  __pyx_t_2 = __Pyx_PyObject_Dict_GetItem(__pyx_v_params, __pyx_n_u_power_ranges); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 288, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_2, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 288, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (unlikely(!__pyx_v_params)) { __Pyx_RaiseUnboundLocalError("params"); __PYX_ERR(0, 288, __pyx_L1_error) }
-  __pyx_t_2 = __Pyx_PyObject_Dict_GetItem(__pyx_v_params, __pyx_n_u_power_ranges); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 288, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_13 = __Pyx_GetItemInt(__pyx_t_2, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 288, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_13);
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (unlikely(!__pyx_v_params)) { __Pyx_RaiseUnboundLocalError("params"); __PYX_ERR(0, 288, __pyx_L1_error) }
-  __pyx_t_2 = __Pyx_PyObject_Dict_GetItem(__pyx_v_params, __pyx_n_u_power_ranges); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 288, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_14 = __Pyx_GetItemInt(__pyx_t_2, 2, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 288, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_14);
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyNumber_Int(__pyx_t_14); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 288, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
-  __pyx_t_14 = NULL;
-  __pyx_t_15 = 0;
-  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
-    __pyx_t_14 = PyMethod_GET_SELF(__pyx_t_4);
-    if (likely(__pyx_t_14)) {
-      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
-      __Pyx_INCREF(__pyx_t_14);
-      __Pyx_INCREF(function);
-      __Pyx_DECREF_SET(__pyx_t_4, function);
-      __pyx_t_15 = 1;
+    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 337, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_linspace); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 337, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_6);
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    if (unlikely(!__pyx_v_params)) { __Pyx_RaiseUnboundLocalError("params"); __PYX_ERR(0, 337, __pyx_L1_error) }
+    __pyx_t_4 = __Pyx_PyObject_Dict_GetItem(__pyx_v_params, __pyx_n_u_power_ranges); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 337, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __pyx_t_7 = __Pyx_GetItemInt(__pyx_t_4, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 337, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_7);
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    if (unlikely(!__pyx_v_params)) { __Pyx_RaiseUnboundLocalError("params"); __PYX_ERR(0, 337, __pyx_L1_error) }
+    __pyx_t_4 = __Pyx_PyObject_Dict_GetItem(__pyx_v_params, __pyx_n_u_power_ranges); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 337, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __pyx_t_13 = __Pyx_GetItemInt(__pyx_t_4, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 337, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_13);
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    if (unlikely(!__pyx_v_params)) { __Pyx_RaiseUnboundLocalError("params"); __PYX_ERR(0, 337, __pyx_L1_error) }
+    __pyx_t_4 = __Pyx_PyObject_Dict_GetItem(__pyx_v_params, __pyx_n_u_power_ranges); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 337, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __pyx_t_14 = __Pyx_GetItemInt(__pyx_t_4, 2, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 337, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_14);
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    __pyx_t_4 = __Pyx_PyNumber_Int(__pyx_t_14); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 337, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
+    __pyx_t_14 = NULL;
+    __pyx_t_15 = 0;
+    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_6))) {
+      __pyx_t_14 = PyMethod_GET_SELF(__pyx_t_6);
+      if (likely(__pyx_t_14)) {
+        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
+        __Pyx_INCREF(__pyx_t_14);
+        __Pyx_INCREF(function);
+        __Pyx_DECREF_SET(__pyx_t_6, function);
+        __pyx_t_15 = 1;
+      }
     }
-  }
-  #if CYTHON_FAST_PYCALL
-  if (PyFunction_Check(__pyx_t_4)) {
-    PyObject *__pyx_temp[4] = {__pyx_t_14, __pyx_t_5, __pyx_t_13, __pyx_t_2};
-    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_15, 3+__pyx_t_15); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 288, __pyx_L1_error)
-    __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
-    __Pyx_GOTREF(__pyx_t_1);
-    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  } else
-  #endif
-  #if CYTHON_FAST_PYCCALL
-  if (__Pyx_PyFastCFunction_Check(__pyx_t_4)) {
-    PyObject *__pyx_temp[4] = {__pyx_t_14, __pyx_t_5, __pyx_t_13, __pyx_t_2};
-    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_15, 3+__pyx_t_15); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 288, __pyx_L1_error)
-    __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
-    __Pyx_GOTREF(__pyx_t_1);
-    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  } else
-  #endif
-  {
-    __pyx_t_16 = PyTuple_New(3+__pyx_t_15); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 288, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_16);
-    if (__pyx_t_14) {
-      __Pyx_GIVEREF(__pyx_t_14); PyTuple_SET_ITEM(__pyx_t_16, 0, __pyx_t_14); __pyx_t_14 = NULL;
+    #if CYTHON_FAST_PYCALL
+    if (PyFunction_Check(__pyx_t_6)) {
+      PyObject *__pyx_temp[4] = {__pyx_t_14, __pyx_t_7, __pyx_t_13, __pyx_t_4};
+      __pyx_t_3 = __Pyx_PyFunction_FastCall(__pyx_t_6, __pyx_temp+1-__pyx_t_15, 3+__pyx_t_15); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 337, __pyx_L1_error)
+      __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
+      __Pyx_GOTREF(__pyx_t_3);
+      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
+      __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
+      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    } else
+    #endif
+    #if CYTHON_FAST_PYCCALL
+    if (__Pyx_PyFastCFunction_Check(__pyx_t_6)) {
+      PyObject *__pyx_temp[4] = {__pyx_t_14, __pyx_t_7, __pyx_t_13, __pyx_t_4};
+      __pyx_t_3 = __Pyx_PyCFunction_FastCall(__pyx_t_6, __pyx_temp+1-__pyx_t_15, 3+__pyx_t_15); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 337, __pyx_L1_error)
+      __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
+      __Pyx_GOTREF(__pyx_t_3);
+      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
+      __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
+      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    } else
+    #endif
+    {
+      __pyx_t_16 = PyTuple_New(3+__pyx_t_15); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 337, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_16);
+      if (__pyx_t_14) {
+        __Pyx_GIVEREF(__pyx_t_14); PyTuple_SET_ITEM(__pyx_t_16, 0, __pyx_t_14); __pyx_t_14 = NULL;
+      }
+      __Pyx_GIVEREF(__pyx_t_7);
+      PyTuple_SET_ITEM(__pyx_t_16, 0+__pyx_t_15, __pyx_t_7);
+      __Pyx_GIVEREF(__pyx_t_13);
+      PyTuple_SET_ITEM(__pyx_t_16, 1+__pyx_t_15, __pyx_t_13);
+      __Pyx_GIVEREF(__pyx_t_4);
+      PyTuple_SET_ITEM(__pyx_t_16, 2+__pyx_t_15, __pyx_t_4);
+      __pyx_t_7 = 0;
+      __pyx_t_13 = 0;
+      __pyx_t_4 = 0;
+      __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_16, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 337, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_3);
+      __Pyx_DECREF(__pyx_t_16); __pyx_t_16 = 0;
     }
-    __Pyx_GIVEREF(__pyx_t_5);
-    PyTuple_SET_ITEM(__pyx_t_16, 0+__pyx_t_15, __pyx_t_5);
-    __Pyx_GIVEREF(__pyx_t_13);
-    PyTuple_SET_ITEM(__pyx_t_16, 1+__pyx_t_15, __pyx_t_13);
-    __Pyx_GIVEREF(__pyx_t_2);
-    PyTuple_SET_ITEM(__pyx_t_16, 2+__pyx_t_15, __pyx_t_2);
-    __pyx_t_5 = 0;
-    __pyx_t_13 = 0;
-    __pyx_t_2 = 0;
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_16, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 288, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_1);
-    __Pyx_DECREF(__pyx_t_16); __pyx_t_16 = 0;
-  }
-  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_v_pow_ranges = __pyx_t_1;
-  __pyx_t_1 = 0;
+    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
+    __pyx_v_pow_ranges = __pyx_t_3;
+    __pyx_t_3 = 0;
 
-  /* "soapcw/soapcw.pyx":289
+    /* "soapcw/soapcw.pyx":338
  * 
- *         pow_ranges = np.linspace(params["power_ranges"][0],params["power_ranges"][1],int(params["power_ranges"][2]))
- *         frac_ranges = np.linspace(params["fraction_ranges"][0],params["fraction_ranges"][1],int(params["fraction_ranges"][2]))             # <<<<<<<<<<<<<<
- *         pow_fact = abs(1./(pow_ranges[0] - pow_ranges[1]))
- *         frac_fact = abs(1./(frac_ranges[0] - frac_ranges[1]))
+ *             pow_ranges = np.linspace(params["power_ranges"][0],params["power_ranges"][1],int(params["power_ranges"][2]))
+ *             frac_ranges = np.linspace(params["fraction_ranges"][0],params["fraction_ranges"][1],int(params["fraction_ranges"][2]))             # <<<<<<<<<<<<<<
+ *             pow_fact = abs(1./(pow_ranges[0] - pow_ranges[1]))
+ *             frac_fact = abs(1./(frac_ranges[0] - frac_ranges[1]))
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 289, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_16 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_linspace); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 289, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_16);
-  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (unlikely(!__pyx_v_params)) { __Pyx_RaiseUnboundLocalError("params"); __PYX_ERR(0, 289, __pyx_L1_error) }
-  __pyx_t_4 = __Pyx_PyObject_Dict_GetItem(__pyx_v_params, __pyx_n_u_fraction_ranges); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 289, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_2 = __Pyx_GetItemInt(__pyx_t_4, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 289, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (unlikely(!__pyx_v_params)) { __Pyx_RaiseUnboundLocalError("params"); __PYX_ERR(0, 289, __pyx_L1_error) }
-  __pyx_t_4 = __Pyx_PyObject_Dict_GetItem(__pyx_v_params, __pyx_n_u_fraction_ranges); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 289, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_13 = __Pyx_GetItemInt(__pyx_t_4, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 289, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_13);
-  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (unlikely(!__pyx_v_params)) { __Pyx_RaiseUnboundLocalError("params"); __PYX_ERR(0, 289, __pyx_L1_error) }
-  __pyx_t_4 = __Pyx_PyObject_Dict_GetItem(__pyx_v_params, __pyx_n_u_fraction_ranges); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 289, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_4, 2, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 289, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyNumber_Int(__pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 289, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_4);
-  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = NULL;
-  __pyx_t_15 = 0;
-  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_16))) {
-    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_16);
-    if (likely(__pyx_t_5)) {
-      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_16);
-      __Pyx_INCREF(__pyx_t_5);
-      __Pyx_INCREF(function);
-      __Pyx_DECREF_SET(__pyx_t_16, function);
-      __pyx_t_15 = 1;
+    __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 338, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_6);
+    __pyx_t_16 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_linspace); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 338, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_16);
+    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
+    if (unlikely(!__pyx_v_params)) { __Pyx_RaiseUnboundLocalError("params"); __PYX_ERR(0, 338, __pyx_L1_error) }
+    __pyx_t_6 = __Pyx_PyObject_Dict_GetItem(__pyx_v_params, __pyx_n_u_fraction_ranges); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 338, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_6);
+    __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_6, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 338, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
+    if (unlikely(!__pyx_v_params)) { __Pyx_RaiseUnboundLocalError("params"); __PYX_ERR(0, 338, __pyx_L1_error) }
+    __pyx_t_6 = __Pyx_PyObject_Dict_GetItem(__pyx_v_params, __pyx_n_u_fraction_ranges); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 338, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_6);
+    __pyx_t_13 = __Pyx_GetItemInt(__pyx_t_6, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 338, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_13);
+    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
+    if (unlikely(!__pyx_v_params)) { __Pyx_RaiseUnboundLocalError("params"); __PYX_ERR(0, 338, __pyx_L1_error) }
+    __pyx_t_6 = __Pyx_PyObject_Dict_GetItem(__pyx_v_params, __pyx_n_u_fraction_ranges); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 338, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_6);
+    __pyx_t_7 = __Pyx_GetItemInt(__pyx_t_6, 2, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 338, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_7);
+    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
+    __pyx_t_6 = __Pyx_PyNumber_Int(__pyx_t_7); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 338, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_6);
+    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
+    __pyx_t_7 = NULL;
+    __pyx_t_15 = 0;
+    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_16))) {
+      __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_16);
+      if (likely(__pyx_t_7)) {
+        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_16);
+        __Pyx_INCREF(__pyx_t_7);
+        __Pyx_INCREF(function);
+        __Pyx_DECREF_SET(__pyx_t_16, function);
+        __pyx_t_15 = 1;
+      }
+    }
+    #if CYTHON_FAST_PYCALL
+    if (PyFunction_Check(__pyx_t_16)) {
+      PyObject *__pyx_temp[4] = {__pyx_t_7, __pyx_t_4, __pyx_t_13, __pyx_t_6};
+      __pyx_t_3 = __Pyx_PyFunction_FastCall(__pyx_t_16, __pyx_temp+1-__pyx_t_15, 3+__pyx_t_15); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 338, __pyx_L1_error)
+      __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
+      __Pyx_GOTREF(__pyx_t_3);
+      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+      __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
+      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
+    } else
+    #endif
+    #if CYTHON_FAST_PYCCALL
+    if (__Pyx_PyFastCFunction_Check(__pyx_t_16)) {
+      PyObject *__pyx_temp[4] = {__pyx_t_7, __pyx_t_4, __pyx_t_13, __pyx_t_6};
+      __pyx_t_3 = __Pyx_PyCFunction_FastCall(__pyx_t_16, __pyx_temp+1-__pyx_t_15, 3+__pyx_t_15); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 338, __pyx_L1_error)
+      __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
+      __Pyx_GOTREF(__pyx_t_3);
+      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+      __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
+      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
+    } else
+    #endif
+    {
+      __pyx_t_14 = PyTuple_New(3+__pyx_t_15); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 338, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_14);
+      if (__pyx_t_7) {
+        __Pyx_GIVEREF(__pyx_t_7); PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_t_7); __pyx_t_7 = NULL;
+      }
+      __Pyx_GIVEREF(__pyx_t_4);
+      PyTuple_SET_ITEM(__pyx_t_14, 0+__pyx_t_15, __pyx_t_4);
+      __Pyx_GIVEREF(__pyx_t_13);
+      PyTuple_SET_ITEM(__pyx_t_14, 1+__pyx_t_15, __pyx_t_13);
+      __Pyx_GIVEREF(__pyx_t_6);
+      PyTuple_SET_ITEM(__pyx_t_14, 2+__pyx_t_15, __pyx_t_6);
+      __pyx_t_4 = 0;
+      __pyx_t_13 = 0;
+      __pyx_t_6 = 0;
+      __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_16, __pyx_t_14, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 338, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_3);
+      __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
     }
+    __Pyx_DECREF(__pyx_t_16); __pyx_t_16 = 0;
+    __pyx_v_frac_ranges = __pyx_t_3;
+    __pyx_t_3 = 0;
+
+    /* "soapcw/soapcw.pyx":339
+ *             pow_ranges = np.linspace(params["power_ranges"][0],params["power_ranges"][1],int(params["power_ranges"][2]))
+ *             frac_ranges = np.linspace(params["fraction_ranges"][0],params["fraction_ranges"][1],int(params["fraction_ranges"][2]))
+ *             pow_fact = abs(1./(pow_ranges[0] - pow_ranges[1]))             # <<<<<<<<<<<<<<
+ *             frac_fact = abs(1./(frac_ranges[0] - frac_ranges[1]))
+ *         else:
+ */
+    __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_pow_ranges, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 339, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_3);
+    __pyx_t_16 = __Pyx_GetItemInt(__pyx_v_pow_ranges, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 339, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_16);
+    __pyx_t_14 = PyNumber_Subtract(__pyx_t_3, __pyx_t_16); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 339, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_14);
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    __Pyx_DECREF(__pyx_t_16); __pyx_t_16 = 0;
+    __pyx_t_16 = __Pyx_PyFloat_TrueDivideCObj(__pyx_float_1_, __pyx_t_14, 1., 0, 1); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 339, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_16);
+    __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
+    __pyx_t_14 = __Pyx_PyNumber_Absolute(__pyx_t_16); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 339, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_14);
+    __Pyx_DECREF(__pyx_t_16); __pyx_t_16 = 0;
+    __pyx_v_pow_fact = __pyx_t_14;
+    __pyx_t_14 = 0;
+
+    /* "soapcw/soapcw.pyx":340
+ *             frac_ranges = np.linspace(params["fraction_ranges"][0],params["fraction_ranges"][1],int(params["fraction_ranges"][2]))
+ *             pow_fact = abs(1./(pow_ranges[0] - pow_ranges[1]))
+ *             frac_fact = abs(1./(frac_ranges[0] - frac_ranges[1]))             # <<<<<<<<<<<<<<
+ *         else:
+ *             # if it is a line aware stat object then creat ranges from the object
+ */
+    __pyx_t_14 = __Pyx_GetItemInt(__pyx_v_frac_ranges, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 340, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_14);
+    __pyx_t_16 = __Pyx_GetItemInt(__pyx_v_frac_ranges, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 340, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_16);
+    __pyx_t_3 = PyNumber_Subtract(__pyx_t_14, __pyx_t_16); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 340, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_3);
+    __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
+    __Pyx_DECREF(__pyx_t_16); __pyx_t_16 = 0;
+    __pyx_t_16 = __Pyx_PyFloat_TrueDivideCObj(__pyx_float_1_, __pyx_t_3, 1., 0, 1); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 340, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_16);
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    __pyx_t_3 = __Pyx_PyNumber_Absolute(__pyx_t_16); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 340, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_3);
+    __Pyx_DECREF(__pyx_t_16); __pyx_t_16 = 0;
+    __pyx_v_frac_fact = __pyx_t_3;
+    __pyx_t_3 = 0;
+
+    /* "soapcw/soapcw.pyx":333
+ *             spacing of the ranges of data fraction
+ *         """
+ *         if isinstance(lookup_table, str):             # <<<<<<<<<<<<<<
+ *             with open(lookup_table,'rb') as f1:
+ *                 likelihood, params = pickle.load(f1)
+ */
+    goto __pyx_L3;
   }
-  #if CYTHON_FAST_PYCALL
-  if (PyFunction_Check(__pyx_t_16)) {
-    PyObject *__pyx_temp[4] = {__pyx_t_5, __pyx_t_2, __pyx_t_13, __pyx_t_4};
-    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_16, __pyx_temp+1-__pyx_t_15, 3+__pyx_t_15); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 289, __pyx_L1_error)
-    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __Pyx_GOTREF(__pyx_t_1);
-    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  } else
-  #endif
-  #if CYTHON_FAST_PYCCALL
-  if (__Pyx_PyFastCFunction_Check(__pyx_t_16)) {
-    PyObject *__pyx_temp[4] = {__pyx_t_5, __pyx_t_2, __pyx_t_13, __pyx_t_4};
-    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_16, __pyx_temp+1-__pyx_t_15, 3+__pyx_t_15); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 289, __pyx_L1_error)
-    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __Pyx_GOTREF(__pyx_t_1);
-    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  } else
-  #endif
-  {
-    __pyx_t_14 = PyTuple_New(3+__pyx_t_15); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 289, __pyx_L1_error)
+
+  /* "soapcw/soapcw.pyx":344
+ *             # if it is a line aware stat object then creat ranges from the object
+ *             # get the log odds ratio as the statitsic to use
+ *             likelihood = np.log(lookup_table.signoiseline)             # <<<<<<<<<<<<<<
+ *             pow_ranges = lookup_table.powers
+ *             frac_ranges = lookup_table.fractions
+ */
+  /*else*/ {
+    __Pyx_GetModuleGlobalName(__pyx_t_16, __pyx_n_s_np); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 344, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_16);
+    __pyx_t_14 = __Pyx_PyObject_GetAttrStr(__pyx_t_16, __pyx_n_s_log); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 344, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_14);
-    if (__pyx_t_5) {
-      __Pyx_GIVEREF(__pyx_t_5); PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_t_5); __pyx_t_5 = NULL;
+    __Pyx_DECREF(__pyx_t_16); __pyx_t_16 = 0;
+    __pyx_t_16 = __Pyx_PyObject_GetAttrStr(__pyx_v_lookup_table, __pyx_n_s_signoiseline); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 344, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_16);
+    __pyx_t_6 = NULL;
+    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_14))) {
+      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_14);
+      if (likely(__pyx_t_6)) {
+        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_14);
+        __Pyx_INCREF(__pyx_t_6);
+        __Pyx_INCREF(function);
+        __Pyx_DECREF_SET(__pyx_t_14, function);
+      }
     }
-    __Pyx_GIVEREF(__pyx_t_2);
-    PyTuple_SET_ITEM(__pyx_t_14, 0+__pyx_t_15, __pyx_t_2);
-    __Pyx_GIVEREF(__pyx_t_13);
-    PyTuple_SET_ITEM(__pyx_t_14, 1+__pyx_t_15, __pyx_t_13);
-    __Pyx_GIVEREF(__pyx_t_4);
-    PyTuple_SET_ITEM(__pyx_t_14, 2+__pyx_t_15, __pyx_t_4);
-    __pyx_t_2 = 0;
-    __pyx_t_13 = 0;
-    __pyx_t_4 = 0;
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_16, __pyx_t_14, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 289, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_1);
+    __pyx_t_3 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_14, __pyx_t_6, __pyx_t_16) : __Pyx_PyObject_CallOneArg(__pyx_t_14, __pyx_t_16);
+    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
+    __Pyx_DECREF(__pyx_t_16); __pyx_t_16 = 0;
+    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 344, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
-  }
-  __Pyx_DECREF(__pyx_t_16); __pyx_t_16 = 0;
-  __pyx_v_frac_ranges = __pyx_t_1;
-  __pyx_t_1 = 0;
+    __pyx_v_likelihood = __pyx_t_3;
+    __pyx_t_3 = 0;
 
-  /* "soapcw/soapcw.pyx":290
- *         pow_ranges = np.linspace(params["power_ranges"][0],params["power_ranges"][1],int(params["power_ranges"][2]))
- *         frac_ranges = np.linspace(params["fraction_ranges"][0],params["fraction_ranges"][1],int(params["fraction_ranges"][2]))
- *         pow_fact = abs(1./(pow_ranges[0] - pow_ranges[1]))             # <<<<<<<<<<<<<<
- *         frac_fact = abs(1./(frac_ranges[0] - frac_ranges[1]))
+    /* "soapcw/soapcw.pyx":345
+ *             # get the log odds ratio as the statitsic to use
+ *             likelihood = np.log(lookup_table.signoiseline)
+ *             pow_ranges = lookup_table.powers             # <<<<<<<<<<<<<<
+ *             frac_ranges = lookup_table.fractions
+ *             pow_fact = abs(1./(pow_ranges[0] - pow_ranges[1]))
+ */
+    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_lookup_table, __pyx_n_s_powers); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 345, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_3);
+    __pyx_v_pow_ranges = __pyx_t_3;
+    __pyx_t_3 = 0;
+
+    /* "soapcw/soapcw.pyx":346
+ *             likelihood = np.log(lookup_table.signoiseline)
+ *             pow_ranges = lookup_table.powers
+ *             frac_ranges = lookup_table.fractions             # <<<<<<<<<<<<<<
+ *             pow_fact = abs(1./(pow_ranges[0] - pow_ranges[1]))
+ *             frac_fact = abs(1./(frac_ranges[0] - frac_ranges[1]))
+ */
+    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_lookup_table, __pyx_n_s_fractions); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 346, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_3);
+    __pyx_v_frac_ranges = __pyx_t_3;
+    __pyx_t_3 = 0;
+
+    /* "soapcw/soapcw.pyx":347
+ *             pow_ranges = lookup_table.powers
+ *             frac_ranges = lookup_table.fractions
+ *             pow_fact = abs(1./(pow_ranges[0] - pow_ranges[1]))             # <<<<<<<<<<<<<<
+ *             frac_fact = abs(1./(frac_ranges[0] - frac_ranges[1]))
  * 
  */
-  __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_pow_ranges, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 290, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_16 = __Pyx_GetItemInt(__pyx_v_pow_ranges, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 290, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_16);
-  __pyx_t_14 = PyNumber_Subtract(__pyx_t_1, __pyx_t_16); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 290, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_14);
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __Pyx_DECREF(__pyx_t_16); __pyx_t_16 = 0;
-  __pyx_t_16 = __Pyx_PyFloat_TrueDivideCObj(__pyx_float_1_, __pyx_t_14, 1., 0, 1); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 290, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_16);
-  __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
-  __pyx_t_14 = __Pyx_PyNumber_Absolute(__pyx_t_16); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 290, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_14);
-  __Pyx_DECREF(__pyx_t_16); __pyx_t_16 = 0;
-  __pyx_v_pow_fact = __pyx_t_14;
-  __pyx_t_14 = 0;
+    __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_pow_ranges, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 347, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_3);
+    __pyx_t_14 = __Pyx_GetItemInt(__pyx_v_pow_ranges, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 347, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_14);
+    __pyx_t_16 = PyNumber_Subtract(__pyx_t_3, __pyx_t_14); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 347, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_16);
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
+    __pyx_t_14 = __Pyx_PyFloat_TrueDivideCObj(__pyx_float_1_, __pyx_t_16, 1., 0, 1); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 347, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_14);
+    __Pyx_DECREF(__pyx_t_16); __pyx_t_16 = 0;
+    __pyx_t_16 = __Pyx_PyNumber_Absolute(__pyx_t_14); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 347, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_16);
+    __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
+    __pyx_v_pow_fact = __pyx_t_16;
+    __pyx_t_16 = 0;
 
-  /* "soapcw/soapcw.pyx":291
- *         frac_ranges = np.linspace(params["fraction_ranges"][0],params["fraction_ranges"][1],int(params["fraction_ranges"][2]))
- *         pow_fact = abs(1./(pow_ranges[0] - pow_ranges[1]))
- *         frac_fact = abs(1./(frac_ranges[0] - frac_ranges[1]))             # <<<<<<<<<<<<<<
+    /* "soapcw/soapcw.pyx":348
+ *             frac_ranges = lookup_table.fractions
+ *             pow_fact = abs(1./(pow_ranges[0] - pow_ranges[1]))
+ *             frac_fact = abs(1./(frac_ranges[0] - frac_ranges[1]))             # <<<<<<<<<<<<<<
  * 
  *         return likelihood.T, pow_ranges, frac_ranges, pow_fact, frac_fact
  */
-  __pyx_t_14 = __Pyx_GetItemInt(__pyx_v_frac_ranges, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 291, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_14);
-  __pyx_t_16 = __Pyx_GetItemInt(__pyx_v_frac_ranges, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 291, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_16);
-  __pyx_t_1 = PyNumber_Subtract(__pyx_t_14, __pyx_t_16); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 291, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
-  __Pyx_DECREF(__pyx_t_16); __pyx_t_16 = 0;
-  __pyx_t_16 = __Pyx_PyFloat_TrueDivideCObj(__pyx_float_1_, __pyx_t_1, 1., 0, 1); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 291, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_16);
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyNumber_Absolute(__pyx_t_16); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 291, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  __Pyx_DECREF(__pyx_t_16); __pyx_t_16 = 0;
-  __pyx_v_frac_fact = __pyx_t_1;
-  __pyx_t_1 = 0;
+    __pyx_t_16 = __Pyx_GetItemInt(__pyx_v_frac_ranges, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 348, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_16);
+    __pyx_t_14 = __Pyx_GetItemInt(__pyx_v_frac_ranges, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 348, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_14);
+    __pyx_t_3 = PyNumber_Subtract(__pyx_t_16, __pyx_t_14); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 348, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_3);
+    __Pyx_DECREF(__pyx_t_16); __pyx_t_16 = 0;
+    __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
+    __pyx_t_14 = __Pyx_PyFloat_TrueDivideCObj(__pyx_float_1_, __pyx_t_3, 1., 0, 1); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 348, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_14);
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    __pyx_t_3 = __Pyx_PyNumber_Absolute(__pyx_t_14); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 348, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_3);
+    __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
+    __pyx_v_frac_fact = __pyx_t_3;
+    __pyx_t_3 = 0;
+  }
+  __pyx_L3:;
 
-  /* "soapcw/soapcw.pyx":293
- *         frac_fact = abs(1./(frac_ranges[0] - frac_ranges[1]))
+  /* "soapcw/soapcw.pyx":350
+ *             frac_fact = abs(1./(frac_ranges[0] - frac_ranges[1]))
  * 
  *         return likelihood.T, pow_ranges, frac_ranges, pow_fact, frac_fact             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(__pyx_r);
-  if (unlikely(!__pyx_v_likelihood)) { __Pyx_RaiseUnboundLocalError("likelihood"); __PYX_ERR(0, 293, __pyx_L1_error) }
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_likelihood, __pyx_n_s_T); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 293, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_16 = PyTuple_New(5); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 293, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_16);
-  __Pyx_GIVEREF(__pyx_t_1);
-  PyTuple_SET_ITEM(__pyx_t_16, 0, __pyx_t_1);
+  if (unlikely(!__pyx_v_likelihood)) { __Pyx_RaiseUnboundLocalError("likelihood"); __PYX_ERR(0, 350, __pyx_L1_error) }
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_likelihood, __pyx_n_s_T); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 350, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  __pyx_t_14 = PyTuple_New(5); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 350, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_14);
+  __Pyx_GIVEREF(__pyx_t_3);
+  PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_t_3);
   __Pyx_INCREF(__pyx_v_pow_ranges);
   __Pyx_GIVEREF(__pyx_v_pow_ranges);
-  PyTuple_SET_ITEM(__pyx_t_16, 1, __pyx_v_pow_ranges);
+  PyTuple_SET_ITEM(__pyx_t_14, 1, __pyx_v_pow_ranges);
   __Pyx_INCREF(__pyx_v_frac_ranges);
   __Pyx_GIVEREF(__pyx_v_frac_ranges);
-  PyTuple_SET_ITEM(__pyx_t_16, 2, __pyx_v_frac_ranges);
+  PyTuple_SET_ITEM(__pyx_t_14, 2, __pyx_v_frac_ranges);
   __Pyx_INCREF(__pyx_v_pow_fact);
   __Pyx_GIVEREF(__pyx_v_pow_fact);
-  PyTuple_SET_ITEM(__pyx_t_16, 3, __pyx_v_pow_fact);
+  PyTuple_SET_ITEM(__pyx_t_14, 3, __pyx_v_pow_fact);
   __Pyx_INCREF(__pyx_v_frac_fact);
   __Pyx_GIVEREF(__pyx_v_frac_fact);
-  PyTuple_SET_ITEM(__pyx_t_16, 4, __pyx_v_frac_fact);
-  __pyx_t_1 = 0;
-  __pyx_r = __pyx_t_16;
-  __pyx_t_16 = 0;
+  PyTuple_SET_ITEM(__pyx_t_14, 4, __pyx_v_frac_fact);
+  __pyx_t_3 = 0;
+  __pyx_r = __pyx_t_14;
+  __pyx_t_14 = 0;
   goto __pyx_L0;
 
-  /* "soapcw/soapcw.pyx":283
+  /* "soapcw/soapcw.pyx":313
  *         return likelihood, ranges, fact
  * 
- *     def read_lookup_amp(self,filename):             # <<<<<<<<<<<<<<
- * 
- *         with open(filename,'rb') as f1:
+ *     def read_lookup_amp(self,lookup_table):             # <<<<<<<<<<<<<<
+ *         """
+ *         Read a lookup table from a file of a LineAwareStatisticAmplitude object
  */
 
   /* function exit code */
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_XDECREF(__pyx_t_3);
   __Pyx_XDECREF(__pyx_t_4);
-  __Pyx_XDECREF(__pyx_t_5);
+  __Pyx_XDECREF(__pyx_t_6);
+  __Pyx_XDECREF(__pyx_t_7);
   __Pyx_XDECREF(__pyx_t_13);
   __Pyx_XDECREF(__pyx_t_14);
   __Pyx_XDECREF(__pyx_t_16);
   __Pyx_AddTraceback("soapcw.soapcw.two_detector.read_lookup_amp", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XDECREF(__pyx_v_f1);
@@ -8413,41 +8751,41 @@
   __Pyx_XDECREF(__pyx_v_pow_fact);
   __Pyx_XDECREF(__pyx_v_frac_fact);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "soapcw/soapcw.pyx":300
+/* "soapcw/soapcw.pyx":357
  *     #--------------------------------------------------------
  * 
- *     def run(self,transition, obs1, obs2, lookup_file_1det = None,lookup_file_2det = None):             # <<<<<<<<<<<<<<
+ *     def run(self,transition, obs1, obs2, lookup_table_1det = None,lookup_table_2det = None):             # <<<<<<<<<<<<<<
  *         """
  *         viterbi algorithm for two detectors with an lookup table for the line veto statistic
  */
 
 /* Python wrapper */
 static PyObject *__pyx_pw_6soapcw_6soapcw_12two_detector_9run(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static char __pyx_doc_6soapcw_6soapcw_12two_detector_8run[] = "\n        viterbi algorithm for two detectors with an lookup table for the line veto statistic\n\n        Where there is only one detectors data use the single detector search with the same statistic\n        Args\n        ---------\n        tr1: array\n            transition matrix\n        obs11: array\n            observation from detector 1\n        obs21: array\n            observation from detector 2 \n        lookup_file: float\n            links to a file which contains a 2d lookup table\n        returns\n        -----------\n        V: array\n            viterbi values in reference detector\n        prev: array\n            previous positions before jump\n        ";
+static char __pyx_doc_6soapcw_6soapcw_12two_detector_8run[] = "\n        viterbi algorithm for two detectors with an lookup table for the line veto statistic\n\n        Where there is only one detectors data use the single detector search with the same statistic\n        Args\n        ---------\n        tr1: array\n            transition matrix\n        obs11: array\n            observation from detector 1\n        obs21: array\n            observation from detector 2 \n        lookup_table: float\n            links to a file which contains a 2d lookup table\n        returns\n        -----------\n        V: array\n            viterbi values in reference detector\n        prev: array\n            previous positions before jump\n        ";
 static PyMethodDef __pyx_mdef_6soapcw_6soapcw_12two_detector_9run = {"run", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6soapcw_6soapcw_12two_detector_9run, METH_VARARGS|METH_KEYWORDS, __pyx_doc_6soapcw_6soapcw_12two_detector_8run};
 static PyObject *__pyx_pw_6soapcw_6soapcw_12two_detector_9run(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyObject *__pyx_v_self = 0;
   PyObject *__pyx_v_transition = 0;
   PyObject *__pyx_v_obs1 = 0;
   PyObject *__pyx_v_obs2 = 0;
-  PyObject *__pyx_v_lookup_file_1det = 0;
-  PyObject *__pyx_v_lookup_file_2det = 0;
+  PyObject *__pyx_v_lookup_table_1det = 0;
+  PyObject *__pyx_v_lookup_table_2det = 0;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("run (wrapper)", 0);
   {
-    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_self,&__pyx_n_s_transition,&__pyx_n_s_obs1,&__pyx_n_s_obs2,&__pyx_n_s_lookup_file_1det,&__pyx_n_s_lookup_file_2det,0};
+    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_self,&__pyx_n_s_transition,&__pyx_n_s_obs1,&__pyx_n_s_obs2,&__pyx_n_s_lookup_table_1det,&__pyx_n_s_lookup_table_2det,0};
     PyObject* values[6] = {0,0,0,0,0,0};
     values[4] = ((PyObject *)((PyObject *)Py_None));
     values[5] = ((PyObject *)((PyObject *)Py_None));
     if (unlikely(__pyx_kwds)) {
       Py_ssize_t kw_args;
       const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
       switch (pos_args) {
@@ -8471,43 +8809,43 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_transition)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("run", 0, 4, 6, 1); __PYX_ERR(0, 300, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("run", 0, 4, 6, 1); __PYX_ERR(0, 357, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_obs1)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("run", 0, 4, 6, 2); __PYX_ERR(0, 300, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("run", 0, 4, 6, 2); __PYX_ERR(0, 357, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_obs2)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("run", 0, 4, 6, 3); __PYX_ERR(0, 300, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("run", 0, 4, 6, 3); __PYX_ERR(0, 357, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (kw_args > 0) {
-          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_lookup_file_1det);
+          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_lookup_table_1det);
           if (value) { values[4] = value; kw_args--; }
         }
         CYTHON_FALLTHROUGH;
         case  5:
         if (kw_args > 0) {
-          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_lookup_file_2det);
+          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_lookup_table_2det);
           if (value) { values[5] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "run") < 0)) __PYX_ERR(0, 300, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "run") < 0)) __PYX_ERR(0, 357, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  6: values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
         CYTHON_FALLTHROUGH;
         case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
         CYTHON_FALLTHROUGH;
@@ -8519,33 +8857,33 @@
         default: goto __pyx_L5_argtuple_error;
       }
     }
     __pyx_v_self = values[0];
     __pyx_v_transition = values[1];
     __pyx_v_obs1 = values[2];
     __pyx_v_obs2 = values[3];
-    __pyx_v_lookup_file_1det = values[4];
-    __pyx_v_lookup_file_2det = values[5];
+    __pyx_v_lookup_table_1det = values[4];
+    __pyx_v_lookup_table_2det = values[5];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("run", 0, 4, 6, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 300, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("run", 0, 4, 6, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 357, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("soapcw.soapcw.two_detector.run", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_6soapcw_6soapcw_12two_detector_8run(__pyx_self, __pyx_v_self, __pyx_v_transition, __pyx_v_obs1, __pyx_v_obs2, __pyx_v_lookup_file_1det, __pyx_v_lookup_file_2det);
+  __pyx_r = __pyx_pf_6soapcw_6soapcw_12two_detector_8run(__pyx_self, __pyx_v_self, __pyx_v_transition, __pyx_v_obs1, __pyx_v_obs2, __pyx_v_lookup_table_1det, __pyx_v_lookup_table_2det);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_6soapcw_6soapcw_12two_detector_8run(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_transition, PyObject *__pyx_v_obs1, PyObject *__pyx_v_obs2, PyObject *__pyx_v_lookup_file_1det, PyObject *__pyx_v_lookup_file_2det) {
+static PyObject *__pyx_pf_6soapcw_6soapcw_12two_detector_8run(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_transition, PyObject *__pyx_v_obs1, PyObject *__pyx_v_obs2, PyObject *__pyx_v_lookup_table_1det, PyObject *__pyx_v_lookup_table_2det) {
   __Pyx_memviewslice __pyx_v_tr = { 0, 0, { 0 }, { 0 }, { 0 } };
   PyObject *__pyx_v_shape = NULL;
   int __pyx_v_length;
   int __pyx_v_width;
   __Pyx_memviewslice __pyx_v_val = { 0, 0, { 0 }, { 0 }, { 0 } };
   __Pyx_memviewslice __pyx_v_prev = { 0, 0, { 0 }, { 0 }, { 0 } };
   __Pyx_memviewslice __pyx_v_det1 = { 0, 0, { 0 }, { 0 }, { 0 } };
@@ -8634,243 +8972,243 @@
   Py_ssize_t __pyx_t_43;
   Py_ssize_t __pyx_t_44;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("run", 0);
 
-  /* "soapcw/soapcw.pyx":323
+  /* "soapcw/soapcw.pyx":380
  *         """
  * 
  *         cdef double[:, :, :] tr = transition             # <<<<<<<<<<<<<<
  *         #cdef double[:, :] obs1 = obs11
  *         #cdef double[:, :] obs2 = obs21
  */
-  __pyx_t_1 = __Pyx_PyObject_to_MemoryviewSlice_dsdsds_double(__pyx_v_transition, PyBUF_WRITABLE); if (unlikely(!__pyx_t_1.memview)) __PYX_ERR(0, 323, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_to_MemoryviewSlice_dsdsds_double(__pyx_v_transition, PyBUF_WRITABLE); if (unlikely(!__pyx_t_1.memview)) __PYX_ERR(0, 380, __pyx_L1_error)
   __pyx_v_tr = __pyx_t_1;
   __pyx_t_1.memview = NULL;
   __pyx_t_1.data = NULL;
 
-  /* "soapcw/soapcw.pyx":327
+  /* "soapcw/soapcw.pyx":384
  *         #cdef double[:, :] obs2 = obs21
  * 
  *         shape = np.shape(obs1)             # <<<<<<<<<<<<<<
  * 
  *         cdef int length = min(len(obs1),len(obs2))
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 327, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 384, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_shape); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 327, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_shape); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 384, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_t_3 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
     __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_4);
     if (likely(__pyx_t_3)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
       __Pyx_INCREF(__pyx_t_3);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_4, function);
     }
   }
   __pyx_t_2 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_3, __pyx_v_obs1) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_v_obs1);
   __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 327, __pyx_L1_error)
+  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 384, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_v_shape = __pyx_t_2;
   __pyx_t_2 = 0;
 
-  /* "soapcw/soapcw.pyx":329
+  /* "soapcw/soapcw.pyx":386
  *         shape = np.shape(obs1)
  * 
  *         cdef int length = min(len(obs1),len(obs2))             # <<<<<<<<<<<<<<
  *         cdef int width = len(obs1[0])
  * 
  */
-  __pyx_t_5 = PyObject_Length(__pyx_v_obs2); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 329, __pyx_L1_error)
-  __pyx_t_6 = PyObject_Length(__pyx_v_obs1); if (unlikely(__pyx_t_6 == ((Py_ssize_t)-1))) __PYX_ERR(0, 329, __pyx_L1_error)
+  __pyx_t_5 = PyObject_Length(__pyx_v_obs2); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 386, __pyx_L1_error)
+  __pyx_t_6 = PyObject_Length(__pyx_v_obs1); if (unlikely(__pyx_t_6 == ((Py_ssize_t)-1))) __PYX_ERR(0, 386, __pyx_L1_error)
   if (((__pyx_t_5 < __pyx_t_6) != 0)) {
     __pyx_t_7 = __pyx_t_5;
   } else {
     __pyx_t_7 = __pyx_t_6;
   }
   __pyx_v_length = __pyx_t_7;
 
-  /* "soapcw/soapcw.pyx":330
+  /* "soapcw/soapcw.pyx":387
  * 
  *         cdef int length = min(len(obs1),len(obs2))
  *         cdef int width = len(obs1[0])             # <<<<<<<<<<<<<<
  * 
  *         cdef double[:, :] val = np.ones(shape)*-1e6
  */
-  __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_obs1, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 330, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_obs1, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 387, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_7 = PyObject_Length(__pyx_t_2); if (unlikely(__pyx_t_7 == ((Py_ssize_t)-1))) __PYX_ERR(0, 330, __pyx_L1_error)
+  __pyx_t_7 = PyObject_Length(__pyx_t_2); if (unlikely(__pyx_t_7 == ((Py_ssize_t)-1))) __PYX_ERR(0, 387, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_v_width = __pyx_t_7;
 
-  /* "soapcw/soapcw.pyx":332
+  /* "soapcw/soapcw.pyx":389
  *         cdef int width = len(obs1[0])
  * 
  *         cdef double[:, :] val = np.ones(shape)*-1e6             # <<<<<<<<<<<<<<
  *         cdef int[:, :] prev = np.zeros(shape,dtype = np.int32)
  *         cdef int[:, :] det1 = np.zeros(shape,dtype = np.int32)
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 332, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 389, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_ones); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 332, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_ones); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 389, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_t_4 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
     __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
     if (likely(__pyx_t_4)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
       __Pyx_INCREF(__pyx_t_4);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_3, function);
     }
   }
   __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_v_shape) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_shape);
   __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 332, __pyx_L1_error)
+  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 389, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = PyNumber_Multiply(__pyx_t_2, __pyx_float_neg_1e6); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 332, __pyx_L1_error)
+  __pyx_t_3 = PyNumber_Multiply(__pyx_t_2, __pyx_float_neg_1e6); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 389, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_dsds_double(__pyx_t_3, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 332, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_dsds_double(__pyx_t_3, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 389, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_v_val = __pyx_t_8;
   __pyx_t_8.memview = NULL;
   __pyx_t_8.data = NULL;
 
-  /* "soapcw/soapcw.pyx":333
+  /* "soapcw/soapcw.pyx":390
  * 
  *         cdef double[:, :] val = np.ones(shape)*-1e6
  *         cdef int[:, :] prev = np.zeros(shape,dtype = np.int32)             # <<<<<<<<<<<<<<
  *         cdef int[:, :] det1 = np.zeros(shape,dtype = np.int32)
  *         cdef int[:, :] det2 = np.zeros(shape,dtype = np.int32)
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 333, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 390, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 333, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 390, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 333, __pyx_L1_error)
+  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 390, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_INCREF(__pyx_v_shape);
   __Pyx_GIVEREF(__pyx_v_shape);
   PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_shape);
-  __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 333, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 390, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_np); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 333, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_np); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 390, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_9);
-  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_int32); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 333, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_int32); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 390, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
   __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_dtype, __pyx_t_10) < 0) __PYX_ERR(0, 333, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_dtype, __pyx_t_10) < 0) __PYX_ERR(0, 390, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-  __pyx_t_10 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, __pyx_t_4); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 333, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, __pyx_t_4); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 390, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_11 = __Pyx_PyObject_to_MemoryviewSlice_dsds_int(__pyx_t_10, PyBUF_WRITABLE); if (unlikely(!__pyx_t_11.memview)) __PYX_ERR(0, 333, __pyx_L1_error)
+  __pyx_t_11 = __Pyx_PyObject_to_MemoryviewSlice_dsds_int(__pyx_t_10, PyBUF_WRITABLE); if (unlikely(!__pyx_t_11.memview)) __PYX_ERR(0, 390, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
   __pyx_v_prev = __pyx_t_11;
   __pyx_t_11.memview = NULL;
   __pyx_t_11.data = NULL;
 
-  /* "soapcw/soapcw.pyx":334
+  /* "soapcw/soapcw.pyx":391
  *         cdef double[:, :] val = np.ones(shape)*-1e6
  *         cdef int[:, :] prev = np.zeros(shape,dtype = np.int32)
  *         cdef int[:, :] det1 = np.zeros(shape,dtype = np.int32)             # <<<<<<<<<<<<<<
  *         cdef int[:, :] det2 = np.zeros(shape,dtype = np.int32)
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_10, __pyx_n_s_np); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 334, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_10, __pyx_n_s_np); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 391, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_10, __pyx_n_s_zeros); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 334, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_10, __pyx_n_s_zeros); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 391, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-  __pyx_t_10 = PyTuple_New(1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 334, __pyx_L1_error)
+  __pyx_t_10 = PyTuple_New(1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 391, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
   __Pyx_INCREF(__pyx_v_shape);
   __Pyx_GIVEREF(__pyx_v_shape);
   PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_v_shape);
-  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 334, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 391, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 334, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 391, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_int32); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 334, __pyx_L1_error)
+  __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_int32); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 391, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_9);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_dtype, __pyx_t_9) < 0) __PYX_ERR(0, 334, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_dtype, __pyx_t_9) < 0) __PYX_ERR(0, 391, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-  __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_10, __pyx_t_3); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 334, __pyx_L1_error)
+  __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_10, __pyx_t_3); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 391, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_9);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_11 = __Pyx_PyObject_to_MemoryviewSlice_dsds_int(__pyx_t_9, PyBUF_WRITABLE); if (unlikely(!__pyx_t_11.memview)) __PYX_ERR(0, 334, __pyx_L1_error)
+  __pyx_t_11 = __Pyx_PyObject_to_MemoryviewSlice_dsds_int(__pyx_t_9, PyBUF_WRITABLE); if (unlikely(!__pyx_t_11.memview)) __PYX_ERR(0, 391, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
   __pyx_v_det1 = __pyx_t_11;
   __pyx_t_11.memview = NULL;
   __pyx_t_11.data = NULL;
 
-  /* "soapcw/soapcw.pyx":335
+  /* "soapcw/soapcw.pyx":392
  *         cdef int[:, :] prev = np.zeros(shape,dtype = np.int32)
  *         cdef int[:, :] det1 = np.zeros(shape,dtype = np.int32)
  *         cdef int[:, :] det2 = np.zeros(shape,dtype = np.int32)             # <<<<<<<<<<<<<<
  * 
  *         cdef int tr_len = len(tr)
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_np); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 335, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_np); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 392, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_9);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_zeros); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 335, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_zeros); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 392, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-  __pyx_t_9 = PyTuple_New(1); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 335, __pyx_L1_error)
+  __pyx_t_9 = PyTuple_New(1); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 392, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_9);
   __Pyx_INCREF(__pyx_v_shape);
   __Pyx_GIVEREF(__pyx_v_shape);
   PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_v_shape);
-  __pyx_t_10 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 335, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 392, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 335, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 392, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_int32); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 335, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_int32); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 392, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (PyDict_SetItem(__pyx_t_10, __pyx_n_s_dtype, __pyx_t_2) < 0) __PYX_ERR(0, 335, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_10, __pyx_n_s_dtype, __pyx_t_2) < 0) __PYX_ERR(0, 392, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_9, __pyx_t_10); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 335, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_9, __pyx_t_10); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 392, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-  __pyx_t_11 = __Pyx_PyObject_to_MemoryviewSlice_dsds_int(__pyx_t_2, PyBUF_WRITABLE); if (unlikely(!__pyx_t_11.memview)) __PYX_ERR(0, 335, __pyx_L1_error)
+  __pyx_t_11 = __Pyx_PyObject_to_MemoryviewSlice_dsds_int(__pyx_t_2, PyBUF_WRITABLE); if (unlikely(!__pyx_t_11.memview)) __PYX_ERR(0, 392, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_v_det2 = __pyx_t_11;
   __pyx_t_11.memview = NULL;
   __pyx_t_11.data = NULL;
 
-  /* "soapcw/soapcw.pyx":337
+  /* "soapcw/soapcw.pyx":394
  *         cdef int[:, :] det2 = np.zeros(shape,dtype = np.int32)
  * 
  *         cdef int tr_len = len(tr)             # <<<<<<<<<<<<<<
  *         cdef int sep_len = len(tr[0])
  *         cdef int tr_dist = int(len(tr)/2. - 0.5)
  */
   __pyx_t_12 = __Pyx_MemoryView_Len(__pyx_v_tr); 
   __pyx_v_tr_len = __pyx_t_12;
 
-  /* "soapcw/soapcw.pyx":338
+  /* "soapcw/soapcw.pyx":395
  * 
  *         cdef int tr_len = len(tr)
  *         cdef int sep_len = len(tr[0])             # <<<<<<<<<<<<<<
  *         cdef int tr_dist = int(len(tr)/2. - 0.5)
  *         cdef int sep_dist = int(len(tr)/2. - 0.5)
  */
   __pyx_t_8.data = __pyx_v_tr.data;
@@ -8881,15 +9219,15 @@
         Py_ssize_t __pyx_tmp_shape = __pyx_v_tr.shape[0];
     Py_ssize_t __pyx_tmp_stride = __pyx_v_tr.strides[0];
         if (__pyx_tmp_idx < 0)
             __pyx_tmp_idx += __pyx_tmp_shape;
         if (unlikely(!__Pyx_is_valid_index(__pyx_tmp_idx, __pyx_tmp_shape))) {
             PyErr_SetString(PyExc_IndexError,
                             "Index out of bounds (axis 0)");
-            __PYX_ERR(0, 338, __pyx_L1_error)
+            __PYX_ERR(0, 395, __pyx_L1_error)
         }
         __pyx_t_8.data += __pyx_tmp_idx * __pyx_tmp_stride;
 }
 
 __pyx_t_8.shape[0] = __pyx_v_tr.shape[1];
 __pyx_t_8.strides[0] = __pyx_v_tr.strides[1];
     __pyx_t_8.suboffsets[0] = -1;
@@ -8900,124 +9238,124 @@
 
 __pyx_t_12 = __Pyx_MemoryView_Len(__pyx_t_8); 
   __PYX_XDEC_MEMVIEW(&__pyx_t_8, 1);
   __pyx_t_8.memview = NULL;
   __pyx_t_8.data = NULL;
   __pyx_v_sep_len = __pyx_t_12;
 
-  /* "soapcw/soapcw.pyx":339
+  /* "soapcw/soapcw.pyx":396
  *         cdef int tr_len = len(tr)
  *         cdef int sep_len = len(tr[0])
  *         cdef int tr_dist = int(len(tr)/2. - 0.5)             # <<<<<<<<<<<<<<
  *         cdef int sep_dist = int(len(tr)/2. - 0.5)
  * 
  */
   __pyx_t_12 = __Pyx_MemoryView_Len(__pyx_v_tr); 
   __pyx_v_tr_dist = ((int)((((double)__pyx_t_12) / 2.) - 0.5));
 
-  /* "soapcw/soapcw.pyx":340
+  /* "soapcw/soapcw.pyx":397
  *         cdef int sep_len = len(tr[0])
  *         cdef int tr_dist = int(len(tr)/2. - 0.5)
  *         cdef int sep_dist = int(len(tr)/2. - 0.5)             # <<<<<<<<<<<<<<
  * 
  *         cdef int i
  */
   __pyx_t_12 = __Pyx_MemoryView_Len(__pyx_v_tr); 
   __pyx_v_sep_dist = ((int)((((double)__pyx_t_12) / 2.) - 0.5));
 
-  /* "soapcw/soapcw.pyx":357
+  /* "soapcw/soapcw.pyx":414
  *         cdef double value
  *         cdef double temp
  *         cdef int edge_range = 0             # <<<<<<<<<<<<<<
  * 
  *         # initialise and load lookuptable files for both line aware statistics
  */
   __pyx_v_edge_range = 0;
 
-  /* "soapcw/soapcw.pyx":367
+  /* "soapcw/soapcw.pyx":424
  *         cdef int[:,:] obs1_ind_2d
  * 
  *         obs1data = np.array([len(np.unique(obs1seg)) for obs1seg in obs1]) != 1             # <<<<<<<<<<<<<<
  *         obs2data = np.array([len(np.unique(obs2seg)) for obs2seg in obs2]) != 1
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_10, __pyx_n_s_np); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 367, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_10, __pyx_n_s_np); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 424, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
-  __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_10, __pyx_n_s_array); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 367, __pyx_L1_error)
+  __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_10, __pyx_n_s_array); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 424, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_9);
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
   { /* enter inner scope */
-    __pyx_t_10 = PyList_New(0); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 367, __pyx_L5_error)
+    __pyx_t_10 = PyList_New(0); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 424, __pyx_L5_error)
     __Pyx_GOTREF(__pyx_t_10);
     if (likely(PyList_CheckExact(__pyx_v_obs1)) || PyTuple_CheckExact(__pyx_v_obs1)) {
       __pyx_t_3 = __pyx_v_obs1; __Pyx_INCREF(__pyx_t_3); __pyx_t_7 = 0;
       __pyx_t_13 = NULL;
     } else {
-      __pyx_t_7 = -1; __pyx_t_3 = PyObject_GetIter(__pyx_v_obs1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 367, __pyx_L5_error)
+      __pyx_t_7 = -1; __pyx_t_3 = PyObject_GetIter(__pyx_v_obs1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 424, __pyx_L5_error)
       __Pyx_GOTREF(__pyx_t_3);
-      __pyx_t_13 = Py_TYPE(__pyx_t_3)->tp_iternext; if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 367, __pyx_L5_error)
+      __pyx_t_13 = Py_TYPE(__pyx_t_3)->tp_iternext; if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 424, __pyx_L5_error)
     }
     for (;;) {
       if (likely(!__pyx_t_13)) {
         if (likely(PyList_CheckExact(__pyx_t_3))) {
           if (__pyx_t_7 >= PyList_GET_SIZE(__pyx_t_3)) break;
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-          __pyx_t_4 = PyList_GET_ITEM(__pyx_t_3, __pyx_t_7); __Pyx_INCREF(__pyx_t_4); __pyx_t_7++; if (unlikely(0 < 0)) __PYX_ERR(0, 367, __pyx_L5_error)
+          __pyx_t_4 = PyList_GET_ITEM(__pyx_t_3, __pyx_t_7); __Pyx_INCREF(__pyx_t_4); __pyx_t_7++; if (unlikely(0 < 0)) __PYX_ERR(0, 424, __pyx_L5_error)
           #else
-          __pyx_t_4 = PySequence_ITEM(__pyx_t_3, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 367, __pyx_L5_error)
+          __pyx_t_4 = PySequence_ITEM(__pyx_t_3, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 424, __pyx_L5_error)
           __Pyx_GOTREF(__pyx_t_4);
           #endif
         } else {
           if (__pyx_t_7 >= PyTuple_GET_SIZE(__pyx_t_3)) break;
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-          __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_3, __pyx_t_7); __Pyx_INCREF(__pyx_t_4); __pyx_t_7++; if (unlikely(0 < 0)) __PYX_ERR(0, 367, __pyx_L5_error)
+          __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_3, __pyx_t_7); __Pyx_INCREF(__pyx_t_4); __pyx_t_7++; if (unlikely(0 < 0)) __PYX_ERR(0, 424, __pyx_L5_error)
           #else
-          __pyx_t_4 = PySequence_ITEM(__pyx_t_3, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 367, __pyx_L5_error)
+          __pyx_t_4 = PySequence_ITEM(__pyx_t_3, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 424, __pyx_L5_error)
           __Pyx_GOTREF(__pyx_t_4);
           #endif
         }
       } else {
         __pyx_t_4 = __pyx_t_13(__pyx_t_3);
         if (unlikely(!__pyx_t_4)) {
           PyObject* exc_type = PyErr_Occurred();
           if (exc_type) {
             if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-            else __PYX_ERR(0, 367, __pyx_L5_error)
+            else __PYX_ERR(0, 424, __pyx_L5_error)
           }
           break;
         }
         __Pyx_GOTREF(__pyx_t_4);
       }
       __Pyx_XDECREF_SET(__pyx_8genexpr1__pyx_v_obs1seg, __pyx_t_4);
       __pyx_t_4 = 0;
-      __Pyx_GetModuleGlobalName(__pyx_t_14, __pyx_n_s_np); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 367, __pyx_L5_error)
+      __Pyx_GetModuleGlobalName(__pyx_t_14, __pyx_n_s_np); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 424, __pyx_L5_error)
       __Pyx_GOTREF(__pyx_t_14);
-      __pyx_t_15 = __Pyx_PyObject_GetAttrStr(__pyx_t_14, __pyx_n_s_unique); if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 367, __pyx_L5_error)
+      __pyx_t_15 = __Pyx_PyObject_GetAttrStr(__pyx_t_14, __pyx_n_s_unique); if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 424, __pyx_L5_error)
       __Pyx_GOTREF(__pyx_t_15);
       __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
       __pyx_t_14 = NULL;
       if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_15))) {
         __pyx_t_14 = PyMethod_GET_SELF(__pyx_t_15);
         if (likely(__pyx_t_14)) {
           PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_15);
           __Pyx_INCREF(__pyx_t_14);
           __Pyx_INCREF(function);
           __Pyx_DECREF_SET(__pyx_t_15, function);
         }
       }
       __pyx_t_4 = (__pyx_t_14) ? __Pyx_PyObject_Call2Args(__pyx_t_15, __pyx_t_14, __pyx_8genexpr1__pyx_v_obs1seg) : __Pyx_PyObject_CallOneArg(__pyx_t_15, __pyx_8genexpr1__pyx_v_obs1seg);
       __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
-      if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 367, __pyx_L5_error)
+      if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 424, __pyx_L5_error)
       __Pyx_GOTREF(__pyx_t_4);
       __Pyx_DECREF(__pyx_t_15); __pyx_t_15 = 0;
-      __pyx_t_5 = PyObject_Length(__pyx_t_4); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 367, __pyx_L5_error)
+      __pyx_t_5 = PyObject_Length(__pyx_t_4); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 424, __pyx_L5_error)
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-      __pyx_t_4 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 367, __pyx_L5_error)
+      __pyx_t_4 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 424, __pyx_L5_error)
       __Pyx_GOTREF(__pyx_t_4);
-      if (unlikely(__Pyx_ListComp_Append(__pyx_t_10, (PyObject*)__pyx_t_4))) __PYX_ERR(0, 367, __pyx_L5_error)
+      if (unlikely(__Pyx_ListComp_Append(__pyx_t_10, (PyObject*)__pyx_t_4))) __PYX_ERR(0, 424, __pyx_L5_error)
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     }
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_XDECREF(__pyx_8genexpr1__pyx_v_obs1seg); __pyx_8genexpr1__pyx_v_obs1seg = 0;
     goto __pyx_L8_exit_scope;
     __pyx_L5_error:;
     __Pyx_XDECREF(__pyx_8genexpr1__pyx_v_obs1seg); __pyx_8genexpr1__pyx_v_obs1seg = 0;
@@ -9033,104 +9371,104 @@
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_9, function);
     }
   }
   __pyx_t_2 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_9, __pyx_t_3, __pyx_t_10) : __Pyx_PyObject_CallOneArg(__pyx_t_9, __pyx_t_10);
   __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 367, __pyx_L1_error)
+  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 424, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-  __pyx_t_9 = __Pyx_PyInt_NeObjC(__pyx_t_2, __pyx_int_1, 1, 0); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 367, __pyx_L1_error)
+  __pyx_t_9 = __Pyx_PyInt_NeObjC(__pyx_t_2, __pyx_int_1, 1, 0); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 424, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_9);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_v_obs1data = __pyx_t_9;
   __pyx_t_9 = 0;
 
-  /* "soapcw/soapcw.pyx":368
+  /* "soapcw/soapcw.pyx":425
  * 
  *         obs1data = np.array([len(np.unique(obs1seg)) for obs1seg in obs1]) != 1
  *         obs2data = np.array([len(np.unique(obs2seg)) for obs2seg in obs2]) != 1             # <<<<<<<<<<<<<<
  * 
- *         if lookup_file_1det is not None:
+ *         if lookup_table_1det is not None:
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 368, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 425, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_array); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 368, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_array); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 425, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   { /* enter inner scope */
-    __pyx_t_2 = PyList_New(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 368, __pyx_L11_error)
+    __pyx_t_2 = PyList_New(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 425, __pyx_L11_error)
     __Pyx_GOTREF(__pyx_t_2);
     if (likely(PyList_CheckExact(__pyx_v_obs2)) || PyTuple_CheckExact(__pyx_v_obs2)) {
       __pyx_t_3 = __pyx_v_obs2; __Pyx_INCREF(__pyx_t_3); __pyx_t_7 = 0;
       __pyx_t_13 = NULL;
     } else {
-      __pyx_t_7 = -1; __pyx_t_3 = PyObject_GetIter(__pyx_v_obs2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 368, __pyx_L11_error)
+      __pyx_t_7 = -1; __pyx_t_3 = PyObject_GetIter(__pyx_v_obs2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 425, __pyx_L11_error)
       __Pyx_GOTREF(__pyx_t_3);
-      __pyx_t_13 = Py_TYPE(__pyx_t_3)->tp_iternext; if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 368, __pyx_L11_error)
+      __pyx_t_13 = Py_TYPE(__pyx_t_3)->tp_iternext; if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 425, __pyx_L11_error)
     }
     for (;;) {
       if (likely(!__pyx_t_13)) {
         if (likely(PyList_CheckExact(__pyx_t_3))) {
           if (__pyx_t_7 >= PyList_GET_SIZE(__pyx_t_3)) break;
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-          __pyx_t_4 = PyList_GET_ITEM(__pyx_t_3, __pyx_t_7); __Pyx_INCREF(__pyx_t_4); __pyx_t_7++; if (unlikely(0 < 0)) __PYX_ERR(0, 368, __pyx_L11_error)
+          __pyx_t_4 = PyList_GET_ITEM(__pyx_t_3, __pyx_t_7); __Pyx_INCREF(__pyx_t_4); __pyx_t_7++; if (unlikely(0 < 0)) __PYX_ERR(0, 425, __pyx_L11_error)
           #else
-          __pyx_t_4 = PySequence_ITEM(__pyx_t_3, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 368, __pyx_L11_error)
+          __pyx_t_4 = PySequence_ITEM(__pyx_t_3, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 425, __pyx_L11_error)
           __Pyx_GOTREF(__pyx_t_4);
           #endif
         } else {
           if (__pyx_t_7 >= PyTuple_GET_SIZE(__pyx_t_3)) break;
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-          __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_3, __pyx_t_7); __Pyx_INCREF(__pyx_t_4); __pyx_t_7++; if (unlikely(0 < 0)) __PYX_ERR(0, 368, __pyx_L11_error)
+          __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_3, __pyx_t_7); __Pyx_INCREF(__pyx_t_4); __pyx_t_7++; if (unlikely(0 < 0)) __PYX_ERR(0, 425, __pyx_L11_error)
           #else
-          __pyx_t_4 = PySequence_ITEM(__pyx_t_3, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 368, __pyx_L11_error)
+          __pyx_t_4 = PySequence_ITEM(__pyx_t_3, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 425, __pyx_L11_error)
           __Pyx_GOTREF(__pyx_t_4);
           #endif
         }
       } else {
         __pyx_t_4 = __pyx_t_13(__pyx_t_3);
         if (unlikely(!__pyx_t_4)) {
           PyObject* exc_type = PyErr_Occurred();
           if (exc_type) {
             if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-            else __PYX_ERR(0, 368, __pyx_L11_error)
+            else __PYX_ERR(0, 425, __pyx_L11_error)
           }
           break;
         }
         __Pyx_GOTREF(__pyx_t_4);
       }
       __Pyx_XDECREF_SET(__pyx_8genexpr2__pyx_v_obs2seg, __pyx_t_4);
       __pyx_t_4 = 0;
-      __Pyx_GetModuleGlobalName(__pyx_t_15, __pyx_n_s_np); if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 368, __pyx_L11_error)
+      __Pyx_GetModuleGlobalName(__pyx_t_15, __pyx_n_s_np); if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 425, __pyx_L11_error)
       __Pyx_GOTREF(__pyx_t_15);
-      __pyx_t_14 = __Pyx_PyObject_GetAttrStr(__pyx_t_15, __pyx_n_s_unique); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 368, __pyx_L11_error)
+      __pyx_t_14 = __Pyx_PyObject_GetAttrStr(__pyx_t_15, __pyx_n_s_unique); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 425, __pyx_L11_error)
       __Pyx_GOTREF(__pyx_t_14);
       __Pyx_DECREF(__pyx_t_15); __pyx_t_15 = 0;
       __pyx_t_15 = NULL;
       if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_14))) {
         __pyx_t_15 = PyMethod_GET_SELF(__pyx_t_14);
         if (likely(__pyx_t_15)) {
           PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_14);
           __Pyx_INCREF(__pyx_t_15);
           __Pyx_INCREF(function);
           __Pyx_DECREF_SET(__pyx_t_14, function);
         }
       }
       __pyx_t_4 = (__pyx_t_15) ? __Pyx_PyObject_Call2Args(__pyx_t_14, __pyx_t_15, __pyx_8genexpr2__pyx_v_obs2seg) : __Pyx_PyObject_CallOneArg(__pyx_t_14, __pyx_8genexpr2__pyx_v_obs2seg);
       __Pyx_XDECREF(__pyx_t_15); __pyx_t_15 = 0;
-      if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 368, __pyx_L11_error)
+      if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 425, __pyx_L11_error)
       __Pyx_GOTREF(__pyx_t_4);
       __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
-      __pyx_t_5 = PyObject_Length(__pyx_t_4); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 368, __pyx_L11_error)
+      __pyx_t_5 = PyObject_Length(__pyx_t_4); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 425, __pyx_L11_error)
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-      __pyx_t_4 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 368, __pyx_L11_error)
+      __pyx_t_4 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 425, __pyx_L11_error)
       __Pyx_GOTREF(__pyx_t_4);
-      if (unlikely(__Pyx_ListComp_Append(__pyx_t_2, (PyObject*)__pyx_t_4))) __PYX_ERR(0, 368, __pyx_L11_error)
+      if (unlikely(__Pyx_ListComp_Append(__pyx_t_2, (PyObject*)__pyx_t_4))) __PYX_ERR(0, 425, __pyx_L11_error)
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     }
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_XDECREF(__pyx_8genexpr2__pyx_v_obs2seg); __pyx_8genexpr2__pyx_v_obs2seg = 0;
     goto __pyx_L14_exit_scope;
     __pyx_L11_error:;
     __Pyx_XDECREF(__pyx_8genexpr2__pyx_v_obs2seg); __pyx_8genexpr2__pyx_v_obs2seg = 0;
@@ -9146,65 +9484,65 @@
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_10, function);
     }
   }
   __pyx_t_9 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_10, __pyx_t_3, __pyx_t_2) : __Pyx_PyObject_CallOneArg(__pyx_t_10, __pyx_t_2);
   __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 368, __pyx_L1_error)
+  if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 425, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_9);
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-  __pyx_t_10 = __Pyx_PyInt_NeObjC(__pyx_t_9, __pyx_int_1, 1, 0); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 368, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyInt_NeObjC(__pyx_t_9, __pyx_int_1, 1, 0); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 425, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
   __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
   __pyx_v_obs2data = __pyx_t_10;
   __pyx_t_10 = 0;
 
-  /* "soapcw/soapcw.pyx":370
+  /* "soapcw/soapcw.pyx":427
  *         obs2data = np.array([len(np.unique(obs2seg)) for obs2seg in obs2]) != 1
  * 
- *         if lookup_file_1det is not None:             # <<<<<<<<<<<<<<
- *             logarr_1d, ranges_1d, fact_1d = self.read_lookup(lookup_file_1det)
+ *         if lookup_table_1det is not None:             # <<<<<<<<<<<<<<
+ *             logarr_1d, ranges_1d, fact_1d = self.read_lookup(lookup_table_1det)
  * 
  */
-  __pyx_t_16 = (__pyx_v_lookup_file_1det != Py_None);
+  __pyx_t_16 = (__pyx_v_lookup_table_1det != Py_None);
   __pyx_t_17 = (__pyx_t_16 != 0);
   if (__pyx_t_17) {
 
-    /* "soapcw/soapcw.pyx":371
+    /* "soapcw/soapcw.pyx":428
  * 
- *         if lookup_file_1det is not None:
- *             logarr_1d, ranges_1d, fact_1d = self.read_lookup(lookup_file_1det)             # <<<<<<<<<<<<<<
+ *         if lookup_table_1det is not None:
+ *             logarr_1d, ranges_1d, fact_1d = self.read_lookup(lookup_table_1det)             # <<<<<<<<<<<<<<
  * 
  *             obs1_ind_arr_1d = (obs1 - ranges_1d[0])*fact_1d
  */
-    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_read_lookup); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 371, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_read_lookup); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 428, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
     __pyx_t_2 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_9))) {
       __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_9);
       if (likely(__pyx_t_2)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_9);
         __Pyx_INCREF(__pyx_t_2);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_9, function);
       }
     }
-    __pyx_t_10 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_9, __pyx_t_2, __pyx_v_lookup_file_1det) : __Pyx_PyObject_CallOneArg(__pyx_t_9, __pyx_v_lookup_file_1det);
+    __pyx_t_10 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_9, __pyx_t_2, __pyx_v_lookup_table_1det) : __Pyx_PyObject_CallOneArg(__pyx_t_9, __pyx_v_lookup_table_1det);
     __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-    if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 371, __pyx_L1_error)
+    if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 428, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_10);
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
     if ((likely(PyTuple_CheckExact(__pyx_t_10))) || (PyList_CheckExact(__pyx_t_10))) {
       PyObject* sequence = __pyx_t_10;
       Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
       if (unlikely(size != 3)) {
         if (size > 3) __Pyx_RaiseTooManyValuesError(3);
         else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
-        __PYX_ERR(0, 371, __pyx_L1_error)
+        __PYX_ERR(0, 428, __pyx_L1_error)
       }
       #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
       if (likely(PyTuple_CheckExact(sequence))) {
         __pyx_t_9 = PyTuple_GET_ITEM(sequence, 0); 
         __pyx_t_2 = PyTuple_GET_ITEM(sequence, 1); 
         __pyx_t_3 = PyTuple_GET_ITEM(sequence, 2); 
       } else {
@@ -9212,140 +9550,140 @@
         __pyx_t_2 = PyList_GET_ITEM(sequence, 1); 
         __pyx_t_3 = PyList_GET_ITEM(sequence, 2); 
       }
       __Pyx_INCREF(__pyx_t_9);
       __Pyx_INCREF(__pyx_t_2);
       __Pyx_INCREF(__pyx_t_3);
       #else
-      __pyx_t_9 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 371, __pyx_L1_error)
+      __pyx_t_9 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 428, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_9);
-      __pyx_t_2 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 371, __pyx_L1_error)
+      __pyx_t_2 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 428, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
-      __pyx_t_3 = PySequence_ITEM(sequence, 2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 371, __pyx_L1_error)
+      __pyx_t_3 = PySequence_ITEM(sequence, 2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 428, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
       #endif
       __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
     } else {
       Py_ssize_t index = -1;
-      __pyx_t_4 = PyObject_GetIter(__pyx_t_10); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 371, __pyx_L1_error)
+      __pyx_t_4 = PyObject_GetIter(__pyx_t_10); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 428, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
       __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
       __pyx_t_18 = Py_TYPE(__pyx_t_4)->tp_iternext;
       index = 0; __pyx_t_9 = __pyx_t_18(__pyx_t_4); if (unlikely(!__pyx_t_9)) goto __pyx_L16_unpacking_failed;
       __Pyx_GOTREF(__pyx_t_9);
       index = 1; __pyx_t_2 = __pyx_t_18(__pyx_t_4); if (unlikely(!__pyx_t_2)) goto __pyx_L16_unpacking_failed;
       __Pyx_GOTREF(__pyx_t_2);
       index = 2; __pyx_t_3 = __pyx_t_18(__pyx_t_4); if (unlikely(!__pyx_t_3)) goto __pyx_L16_unpacking_failed;
       __Pyx_GOTREF(__pyx_t_3);
-      if (__Pyx_IternextUnpackEndCheck(__pyx_t_18(__pyx_t_4), 3) < 0) __PYX_ERR(0, 371, __pyx_L1_error)
+      if (__Pyx_IternextUnpackEndCheck(__pyx_t_18(__pyx_t_4), 3) < 0) __PYX_ERR(0, 428, __pyx_L1_error)
       __pyx_t_18 = NULL;
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
       goto __pyx_L17_unpacking_done;
       __pyx_L16_unpacking_failed:;
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
       __pyx_t_18 = NULL;
       if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
-      __PYX_ERR(0, 371, __pyx_L1_error)
+      __PYX_ERR(0, 428, __pyx_L1_error)
       __pyx_L17_unpacking_done:;
     }
-    __pyx_t_19 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_9, PyBUF_WRITABLE); if (unlikely(!__pyx_t_19.memview)) __PYX_ERR(0, 371, __pyx_L1_error)
+    __pyx_t_19 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_9, PyBUF_WRITABLE); if (unlikely(!__pyx_t_19.memview)) __PYX_ERR(0, 428, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-    __pyx_t_20 = __pyx_PyFloat_AsDouble(__pyx_t_3); if (unlikely((__pyx_t_20 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 371, __pyx_L1_error)
+    __pyx_t_20 = __pyx_PyFloat_AsDouble(__pyx_t_3); if (unlikely((__pyx_t_20 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 428, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_v_logarr_1d = __pyx_t_19;
     __pyx_t_19.memview = NULL;
     __pyx_t_19.data = NULL;
     __pyx_v_ranges_1d = __pyx_t_2;
     __pyx_t_2 = 0;
     __pyx_v_fact_1d = __pyx_t_20;
 
-    /* "soapcw/soapcw.pyx":373
- *             logarr_1d, ranges_1d, fact_1d = self.read_lookup(lookup_file_1det)
+    /* "soapcw/soapcw.pyx":430
+ *             logarr_1d, ranges_1d, fact_1d = self.read_lookup(lookup_table_1det)
  * 
  *             obs1_ind_arr_1d = (obs1 - ranges_1d[0])*fact_1d             # <<<<<<<<<<<<<<
  *             obs1_ind_arr_1d[obs1_ind_arr_1d >= len(ranges_1d)] = len(ranges_1d)-1
  *             obs1_ind_arr_1d[obs1_ind_arr_1d < 0] = 0
  */
-    __pyx_t_10 = __Pyx_GetItemInt(__pyx_v_ranges_1d, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 373, __pyx_L1_error)
+    __pyx_t_10 = __Pyx_GetItemInt(__pyx_v_ranges_1d, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 430, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_10);
-    __pyx_t_3 = PyNumber_Subtract(__pyx_v_obs1, __pyx_t_10); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 373, __pyx_L1_error)
+    __pyx_t_3 = PyNumber_Subtract(__pyx_v_obs1, __pyx_t_10); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 430, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-    __pyx_t_10 = PyFloat_FromDouble(__pyx_v_fact_1d); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 373, __pyx_L1_error)
+    __pyx_t_10 = PyFloat_FromDouble(__pyx_v_fact_1d); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 430, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_10);
-    __pyx_t_2 = PyNumber_Multiply(__pyx_t_3, __pyx_t_10); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 373, __pyx_L1_error)
+    __pyx_t_2 = PyNumber_Multiply(__pyx_t_3, __pyx_t_10); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 430, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
     __pyx_v_obs1_ind_arr_1d = __pyx_t_2;
     __pyx_t_2 = 0;
 
-    /* "soapcw/soapcw.pyx":374
+    /* "soapcw/soapcw.pyx":431
  * 
  *             obs1_ind_arr_1d = (obs1 - ranges_1d[0])*fact_1d
  *             obs1_ind_arr_1d[obs1_ind_arr_1d >= len(ranges_1d)] = len(ranges_1d)-1             # <<<<<<<<<<<<<<
  *             obs1_ind_arr_1d[obs1_ind_arr_1d < 0] = 0
  *             obs1_ind_1d = np.array(obs1_ind_arr_1d).astype(np.int32)
  */
-    __pyx_t_7 = PyObject_Length(__pyx_v_ranges_1d); if (unlikely(__pyx_t_7 == ((Py_ssize_t)-1))) __PYX_ERR(0, 374, __pyx_L1_error)
-    __pyx_t_2 = PyInt_FromSsize_t((__pyx_t_7 - 1)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 374, __pyx_L1_error)
+    __pyx_t_7 = PyObject_Length(__pyx_v_ranges_1d); if (unlikely(__pyx_t_7 == ((Py_ssize_t)-1))) __PYX_ERR(0, 431, __pyx_L1_error)
+    __pyx_t_2 = PyInt_FromSsize_t((__pyx_t_7 - 1)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 431, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_7 = PyObject_Length(__pyx_v_ranges_1d); if (unlikely(__pyx_t_7 == ((Py_ssize_t)-1))) __PYX_ERR(0, 374, __pyx_L1_error)
-    __pyx_t_10 = PyInt_FromSsize_t(__pyx_t_7); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 374, __pyx_L1_error)
+    __pyx_t_7 = PyObject_Length(__pyx_v_ranges_1d); if (unlikely(__pyx_t_7 == ((Py_ssize_t)-1))) __PYX_ERR(0, 431, __pyx_L1_error)
+    __pyx_t_10 = PyInt_FromSsize_t(__pyx_t_7); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 431, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_10);
-    __pyx_t_3 = PyObject_RichCompare(__pyx_v_obs1_ind_arr_1d, __pyx_t_10, Py_GE); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 374, __pyx_L1_error)
+    __pyx_t_3 = PyObject_RichCompare(__pyx_v_obs1_ind_arr_1d, __pyx_t_10, Py_GE); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 431, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-    if (unlikely(PyObject_SetItem(__pyx_v_obs1_ind_arr_1d, __pyx_t_3, __pyx_t_2) < 0)) __PYX_ERR(0, 374, __pyx_L1_error)
+    if (unlikely(PyObject_SetItem(__pyx_v_obs1_ind_arr_1d, __pyx_t_3, __pyx_t_2) < 0)) __PYX_ERR(0, 431, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-    /* "soapcw/soapcw.pyx":375
+    /* "soapcw/soapcw.pyx":432
  *             obs1_ind_arr_1d = (obs1 - ranges_1d[0])*fact_1d
  *             obs1_ind_arr_1d[obs1_ind_arr_1d >= len(ranges_1d)] = len(ranges_1d)-1
  *             obs1_ind_arr_1d[obs1_ind_arr_1d < 0] = 0             # <<<<<<<<<<<<<<
  *             obs1_ind_1d = np.array(obs1_ind_arr_1d).astype(np.int32)
  *             del obs1_ind_arr_1d
  */
-    __pyx_t_2 = PyObject_RichCompare(__pyx_v_obs1_ind_arr_1d, __pyx_int_0, Py_LT); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 375, __pyx_L1_error)
-    if (unlikely(PyObject_SetItem(__pyx_v_obs1_ind_arr_1d, __pyx_t_2, __pyx_int_0) < 0)) __PYX_ERR(0, 375, __pyx_L1_error)
+    __pyx_t_2 = PyObject_RichCompare(__pyx_v_obs1_ind_arr_1d, __pyx_int_0, Py_LT); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 432, __pyx_L1_error)
+    if (unlikely(PyObject_SetItem(__pyx_v_obs1_ind_arr_1d, __pyx_t_2, __pyx_int_0) < 0)) __PYX_ERR(0, 432, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-    /* "soapcw/soapcw.pyx":376
+    /* "soapcw/soapcw.pyx":433
  *             obs1_ind_arr_1d[obs1_ind_arr_1d >= len(ranges_1d)] = len(ranges_1d)-1
  *             obs1_ind_arr_1d[obs1_ind_arr_1d < 0] = 0
  *             obs1_ind_1d = np.array(obs1_ind_arr_1d).astype(np.int32)             # <<<<<<<<<<<<<<
  *             del obs1_ind_arr_1d
  * 
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_10, __pyx_n_s_np); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 376, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_10, __pyx_n_s_np); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 433, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_10);
-    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_10, __pyx_n_s_array); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 376, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_10, __pyx_n_s_array); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 433, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
     __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
     __pyx_t_10 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_9))) {
       __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_9);
       if (likely(__pyx_t_10)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_9);
         __Pyx_INCREF(__pyx_t_10);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_9, function);
       }
     }
     __pyx_t_3 = (__pyx_t_10) ? __Pyx_PyObject_Call2Args(__pyx_t_9, __pyx_t_10, __pyx_v_obs1_ind_arr_1d) : __Pyx_PyObject_CallOneArg(__pyx_t_9, __pyx_v_obs1_ind_arr_1d);
     __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
-    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 376, __pyx_L1_error)
+    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 433, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_astype); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 376, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_astype); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 433, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 376, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 433, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_int32); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 376, __pyx_L1_error)
+    __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_int32); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 433, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_10);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_t_3 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_9))) {
       __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_9);
       if (likely(__pyx_t_3)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_9);
@@ -9353,117 +9691,117 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_9, function);
       }
     }
     __pyx_t_2 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_9, __pyx_t_3, __pyx_t_10) : __Pyx_PyObject_CallOneArg(__pyx_t_9, __pyx_t_10);
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 376, __pyx_L1_error)
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 433, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-    __pyx_t_11 = __Pyx_PyObject_to_MemoryviewSlice_dsds_int(__pyx_t_2, PyBUF_WRITABLE); if (unlikely(!__pyx_t_11.memview)) __PYX_ERR(0, 376, __pyx_L1_error)
+    __pyx_t_11 = __Pyx_PyObject_to_MemoryviewSlice_dsds_int(__pyx_t_2, PyBUF_WRITABLE); if (unlikely(!__pyx_t_11.memview)) __PYX_ERR(0, 433, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __pyx_v_obs1_ind_1d = __pyx_t_11;
     __pyx_t_11.memview = NULL;
     __pyx_t_11.data = NULL;
 
-    /* "soapcw/soapcw.pyx":377
+    /* "soapcw/soapcw.pyx":434
  *             obs1_ind_arr_1d[obs1_ind_arr_1d < 0] = 0
  *             obs1_ind_1d = np.array(obs1_ind_arr_1d).astype(np.int32)
  *             del obs1_ind_arr_1d             # <<<<<<<<<<<<<<
  * 
  *             obs2_ind_arr_1d = (obs2-ranges_1d[0])*fact_1d
  */
     __Pyx_DECREF(__pyx_v_obs1_ind_arr_1d);
     __pyx_v_obs1_ind_arr_1d = NULL;
 
-    /* "soapcw/soapcw.pyx":379
+    /* "soapcw/soapcw.pyx":436
  *             del obs1_ind_arr_1d
  * 
  *             obs2_ind_arr_1d = (obs2-ranges_1d[0])*fact_1d             # <<<<<<<<<<<<<<
  *             obs2_ind_arr_1d[obs2_ind_arr_1d >= len(ranges_1d)] = len(ranges_1d)-1
  *             obs2_ind_arr_1d[obs2_ind_arr_1d < 0] = 0
  */
-    __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_ranges_1d, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 379, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_ranges_1d, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 436, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_9 = PyNumber_Subtract(__pyx_v_obs2, __pyx_t_2); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 379, __pyx_L1_error)
+    __pyx_t_9 = PyNumber_Subtract(__pyx_v_obs2, __pyx_t_2); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 436, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __pyx_t_2 = PyFloat_FromDouble(__pyx_v_fact_1d); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 379, __pyx_L1_error)
+    __pyx_t_2 = PyFloat_FromDouble(__pyx_v_fact_1d); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 436, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_10 = PyNumber_Multiply(__pyx_t_9, __pyx_t_2); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 379, __pyx_L1_error)
+    __pyx_t_10 = PyNumber_Multiply(__pyx_t_9, __pyx_t_2); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 436, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_10);
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __pyx_v_obs2_ind_arr_1d = __pyx_t_10;
     __pyx_t_10 = 0;
 
-    /* "soapcw/soapcw.pyx":380
+    /* "soapcw/soapcw.pyx":437
  * 
  *             obs2_ind_arr_1d = (obs2-ranges_1d[0])*fact_1d
  *             obs2_ind_arr_1d[obs2_ind_arr_1d >= len(ranges_1d)] = len(ranges_1d)-1             # <<<<<<<<<<<<<<
  *             obs2_ind_arr_1d[obs2_ind_arr_1d < 0] = 0
  *             obs2_ind_1d = np.array(obs2_ind_arr_1d).astype(np.int32)
  */
-    __pyx_t_7 = PyObject_Length(__pyx_v_ranges_1d); if (unlikely(__pyx_t_7 == ((Py_ssize_t)-1))) __PYX_ERR(0, 380, __pyx_L1_error)
-    __pyx_t_10 = PyInt_FromSsize_t((__pyx_t_7 - 1)); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 380, __pyx_L1_error)
+    __pyx_t_7 = PyObject_Length(__pyx_v_ranges_1d); if (unlikely(__pyx_t_7 == ((Py_ssize_t)-1))) __PYX_ERR(0, 437, __pyx_L1_error)
+    __pyx_t_10 = PyInt_FromSsize_t((__pyx_t_7 - 1)); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 437, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_10);
-    __pyx_t_7 = PyObject_Length(__pyx_v_ranges_1d); if (unlikely(__pyx_t_7 == ((Py_ssize_t)-1))) __PYX_ERR(0, 380, __pyx_L1_error)
-    __pyx_t_2 = PyInt_FromSsize_t(__pyx_t_7); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 380, __pyx_L1_error)
+    __pyx_t_7 = PyObject_Length(__pyx_v_ranges_1d); if (unlikely(__pyx_t_7 == ((Py_ssize_t)-1))) __PYX_ERR(0, 437, __pyx_L1_error)
+    __pyx_t_2 = PyInt_FromSsize_t(__pyx_t_7); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 437, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_9 = PyObject_RichCompare(__pyx_v_obs2_ind_arr_1d, __pyx_t_2, Py_GE); __Pyx_XGOTREF(__pyx_t_9); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 380, __pyx_L1_error)
+    __pyx_t_9 = PyObject_RichCompare(__pyx_v_obs2_ind_arr_1d, __pyx_t_2, Py_GE); __Pyx_XGOTREF(__pyx_t_9); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 437, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    if (unlikely(PyObject_SetItem(__pyx_v_obs2_ind_arr_1d, __pyx_t_9, __pyx_t_10) < 0)) __PYX_ERR(0, 380, __pyx_L1_error)
+    if (unlikely(PyObject_SetItem(__pyx_v_obs2_ind_arr_1d, __pyx_t_9, __pyx_t_10) < 0)) __PYX_ERR(0, 437, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
     __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
 
-    /* "soapcw/soapcw.pyx":381
+    /* "soapcw/soapcw.pyx":438
  *             obs2_ind_arr_1d = (obs2-ranges_1d[0])*fact_1d
  *             obs2_ind_arr_1d[obs2_ind_arr_1d >= len(ranges_1d)] = len(ranges_1d)-1
  *             obs2_ind_arr_1d[obs2_ind_arr_1d < 0] = 0             # <<<<<<<<<<<<<<
  *             obs2_ind_1d = np.array(obs2_ind_arr_1d).astype(np.int32)
  *             del obs2_ind_arr_1d
  */
-    __pyx_t_10 = PyObject_RichCompare(__pyx_v_obs2_ind_arr_1d, __pyx_int_0, Py_LT); __Pyx_XGOTREF(__pyx_t_10); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 381, __pyx_L1_error)
-    if (unlikely(PyObject_SetItem(__pyx_v_obs2_ind_arr_1d, __pyx_t_10, __pyx_int_0) < 0)) __PYX_ERR(0, 381, __pyx_L1_error)
+    __pyx_t_10 = PyObject_RichCompare(__pyx_v_obs2_ind_arr_1d, __pyx_int_0, Py_LT); __Pyx_XGOTREF(__pyx_t_10); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 438, __pyx_L1_error)
+    if (unlikely(PyObject_SetItem(__pyx_v_obs2_ind_arr_1d, __pyx_t_10, __pyx_int_0) < 0)) __PYX_ERR(0, 438, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
 
-    /* "soapcw/soapcw.pyx":382
+    /* "soapcw/soapcw.pyx":439
  *             obs2_ind_arr_1d[obs2_ind_arr_1d >= len(ranges_1d)] = len(ranges_1d)-1
  *             obs2_ind_arr_1d[obs2_ind_arr_1d < 0] = 0
  *             obs2_ind_1d = np.array(obs2_ind_arr_1d).astype(np.int32)             # <<<<<<<<<<<<<<
  *             del obs2_ind_arr_1d
  * 
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 382, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 439, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_array); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 382, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_array); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 439, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __pyx_t_2 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
       __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
       if (likely(__pyx_t_2)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
         __Pyx_INCREF(__pyx_t_2);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_3, function);
       }
     }
     __pyx_t_9 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_2, __pyx_v_obs2_ind_arr_1d) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_obs2_ind_arr_1d);
     __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-    if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 382, __pyx_L1_error)
+    if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 439, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_astype); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 382, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_astype); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 439, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-    __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_np); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 382, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_np); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 439, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
-    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_int32); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 382, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_int32); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 439, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
     __pyx_t_9 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
       __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_3);
       if (likely(__pyx_t_9)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
@@ -9471,81 +9809,81 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_3, function);
       }
     }
     __pyx_t_10 = (__pyx_t_9) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_9, __pyx_t_2) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_2);
     __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 382, __pyx_L1_error)
+    if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 439, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_10);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_v_obs2_ind_1d = __pyx_t_10;
     __pyx_t_10 = 0;
 
-    /* "soapcw/soapcw.pyx":383
+    /* "soapcw/soapcw.pyx":440
  *             obs2_ind_arr_1d[obs2_ind_arr_1d < 0] = 0
  *             obs2_ind_1d = np.array(obs2_ind_arr_1d).astype(np.int32)
  *             del obs2_ind_arr_1d             # <<<<<<<<<<<<<<
  * 
- *         if lookup_file_2det is not None:
+ *         if lookup_table_2det is not None:
  */
     __Pyx_DECREF(__pyx_v_obs2_ind_arr_1d);
     __pyx_v_obs2_ind_arr_1d = NULL;
 
-    /* "soapcw/soapcw.pyx":370
+    /* "soapcw/soapcw.pyx":427
  *         obs2data = np.array([len(np.unique(obs2seg)) for obs2seg in obs2]) != 1
  * 
- *         if lookup_file_1det is not None:             # <<<<<<<<<<<<<<
- *             logarr_1d, ranges_1d, fact_1d = self.read_lookup(lookup_file_1det)
+ *         if lookup_table_1det is not None:             # <<<<<<<<<<<<<<
+ *             logarr_1d, ranges_1d, fact_1d = self.read_lookup(lookup_table_1det)
  * 
  */
   }
 
-  /* "soapcw/soapcw.pyx":385
+  /* "soapcw/soapcw.pyx":442
  *             del obs2_ind_arr_1d
  * 
- *         if lookup_file_2det is not None:             # <<<<<<<<<<<<<<
- *             logarr, ranges_2d, fact_2d = self.read_lookup(lookup_file_2det)
+ *         if lookup_table_2det is not None:             # <<<<<<<<<<<<<<
+ *             logarr, ranges_2d, fact_2d = self.read_lookup(lookup_table_2det)
  *             diag = copy.copy(np.diag(logarr))
  */
-  __pyx_t_17 = (__pyx_v_lookup_file_2det != Py_None);
+  __pyx_t_17 = (__pyx_v_lookup_table_2det != Py_None);
   __pyx_t_16 = (__pyx_t_17 != 0);
   if (__pyx_t_16) {
 
-    /* "soapcw/soapcw.pyx":386
+    /* "soapcw/soapcw.pyx":443
  * 
- *         if lookup_file_2det is not None:
- *             logarr, ranges_2d, fact_2d = self.read_lookup(lookup_file_2det)             # <<<<<<<<<<<<<<
+ *         if lookup_table_2det is not None:
+ *             logarr, ranges_2d, fact_2d = self.read_lookup(lookup_table_2det)             # <<<<<<<<<<<<<<
  *             diag = copy.copy(np.diag(logarr))
  *             logarr_2d = logarr
  */
-    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_read_lookup); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 386, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_read_lookup); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 443, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __pyx_t_2 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
       __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
       if (likely(__pyx_t_2)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
         __Pyx_INCREF(__pyx_t_2);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_3, function);
       }
     }
-    __pyx_t_10 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_2, __pyx_v_lookup_file_2det) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_lookup_file_2det);
+    __pyx_t_10 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_2, __pyx_v_lookup_table_2det) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_lookup_table_2det);
     __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-    if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 386, __pyx_L1_error)
+    if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 443, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_10);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     if ((likely(PyTuple_CheckExact(__pyx_t_10))) || (PyList_CheckExact(__pyx_t_10))) {
       PyObject* sequence = __pyx_t_10;
       Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
       if (unlikely(size != 3)) {
         if (size > 3) __Pyx_RaiseTooManyValuesError(3);
         else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
-        __PYX_ERR(0, 386, __pyx_L1_error)
+        __PYX_ERR(0, 443, __pyx_L1_error)
       }
       #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
       if (likely(PyTuple_CheckExact(sequence))) {
         __pyx_t_3 = PyTuple_GET_ITEM(sequence, 0); 
         __pyx_t_2 = PyTuple_GET_ITEM(sequence, 1); 
         __pyx_t_9 = PyTuple_GET_ITEM(sequence, 2); 
       } else {
@@ -9553,83 +9891,83 @@
         __pyx_t_2 = PyList_GET_ITEM(sequence, 1); 
         __pyx_t_9 = PyList_GET_ITEM(sequence, 2); 
       }
       __Pyx_INCREF(__pyx_t_3);
       __Pyx_INCREF(__pyx_t_2);
       __Pyx_INCREF(__pyx_t_9);
       #else
-      __pyx_t_3 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 386, __pyx_L1_error)
+      __pyx_t_3 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 443, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
-      __pyx_t_2 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 386, __pyx_L1_error)
+      __pyx_t_2 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 443, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
-      __pyx_t_9 = PySequence_ITEM(sequence, 2); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 386, __pyx_L1_error)
+      __pyx_t_9 = PySequence_ITEM(sequence, 2); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 443, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_9);
       #endif
       __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
     } else {
       Py_ssize_t index = -1;
-      __pyx_t_4 = PyObject_GetIter(__pyx_t_10); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 386, __pyx_L1_error)
+      __pyx_t_4 = PyObject_GetIter(__pyx_t_10); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 443, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
       __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
       __pyx_t_18 = Py_TYPE(__pyx_t_4)->tp_iternext;
       index = 0; __pyx_t_3 = __pyx_t_18(__pyx_t_4); if (unlikely(!__pyx_t_3)) goto __pyx_L19_unpacking_failed;
       __Pyx_GOTREF(__pyx_t_3);
       index = 1; __pyx_t_2 = __pyx_t_18(__pyx_t_4); if (unlikely(!__pyx_t_2)) goto __pyx_L19_unpacking_failed;
       __Pyx_GOTREF(__pyx_t_2);
       index = 2; __pyx_t_9 = __pyx_t_18(__pyx_t_4); if (unlikely(!__pyx_t_9)) goto __pyx_L19_unpacking_failed;
       __Pyx_GOTREF(__pyx_t_9);
-      if (__Pyx_IternextUnpackEndCheck(__pyx_t_18(__pyx_t_4), 3) < 0) __PYX_ERR(0, 386, __pyx_L1_error)
+      if (__Pyx_IternextUnpackEndCheck(__pyx_t_18(__pyx_t_4), 3) < 0) __PYX_ERR(0, 443, __pyx_L1_error)
       __pyx_t_18 = NULL;
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
       goto __pyx_L20_unpacking_done;
       __pyx_L19_unpacking_failed:;
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
       __pyx_t_18 = NULL;
       if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
-      __PYX_ERR(0, 386, __pyx_L1_error)
+      __PYX_ERR(0, 443, __pyx_L1_error)
       __pyx_L20_unpacking_done:;
     }
-    __pyx_t_20 = __pyx_PyFloat_AsDouble(__pyx_t_9); if (unlikely((__pyx_t_20 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 386, __pyx_L1_error)
+    __pyx_t_20 = __pyx_PyFloat_AsDouble(__pyx_t_9); if (unlikely((__pyx_t_20 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 443, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
     __pyx_v_logarr = __pyx_t_3;
     __pyx_t_3 = 0;
     __pyx_v_ranges_2d = __pyx_t_2;
     __pyx_t_2 = 0;
     __pyx_v_fact_2d = __pyx_t_20;
 
-    /* "soapcw/soapcw.pyx":387
- *         if lookup_file_2det is not None:
- *             logarr, ranges_2d, fact_2d = self.read_lookup(lookup_file_2det)
+    /* "soapcw/soapcw.pyx":444
+ *         if lookup_table_2det is not None:
+ *             logarr, ranges_2d, fact_2d = self.read_lookup(lookup_table_2det)
  *             diag = copy.copy(np.diag(logarr))             # <<<<<<<<<<<<<<
  *             logarr_2d = logarr
  * 
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_copy); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 387, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_copy); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 444, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
-    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_copy); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 387, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_copy); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 444, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 387, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 444, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_diag); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 387, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_diag); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 444, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_t_3 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
       __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_4);
       if (likely(__pyx_t_3)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
         __Pyx_INCREF(__pyx_t_3);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_4, function);
       }
     }
     __pyx_t_9 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_3, __pyx_v_logarr) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_v_logarr);
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-    if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 387, __pyx_L1_error)
+    if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 444, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __pyx_t_4 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
       __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
       if (likely(__pyx_t_4)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
@@ -9637,116 +9975,116 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_2, function);
       }
     }
     __pyx_t_10 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_4, __pyx_t_9) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_9);
     __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-    if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 387, __pyx_L1_error)
+    if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 444, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_10);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __pyx_v_diag = __pyx_t_10;
     __pyx_t_10 = 0;
 
-    /* "soapcw/soapcw.pyx":388
- *             logarr, ranges_2d, fact_2d = self.read_lookup(lookup_file_2det)
+    /* "soapcw/soapcw.pyx":445
+ *             logarr, ranges_2d, fact_2d = self.read_lookup(lookup_table_2det)
  *             diag = copy.copy(np.diag(logarr))
  *             logarr_2d = logarr             # <<<<<<<<<<<<<<
  * 
  *             # normalise the input powers to the ranges of lookup table so they are now indices
  */
-    __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_dsds_double(__pyx_v_logarr, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 388, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_dsds_double(__pyx_v_logarr, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 445, __pyx_L1_error)
     __pyx_v_logarr_2d = __pyx_t_8;
     __pyx_t_8.memview = NULL;
     __pyx_t_8.data = NULL;
 
-    /* "soapcw/soapcw.pyx":391
+    /* "soapcw/soapcw.pyx":448
  * 
  *             # normalise the input powers to the ranges of lookup table so they are now indices
  *             obs1_ind_arr_2d = (obs1 - ranges_2d[0])*fact_2d             # <<<<<<<<<<<<<<
  *             # set powers outside range to end index
  *             obs1_ind_arr_2d[obs1_ind_arr_2d >= len(ranges_2d)] = len(ranges_2d)-1
  */
-    __pyx_t_10 = __Pyx_GetItemInt(__pyx_v_ranges_2d, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 391, __pyx_L1_error)
+    __pyx_t_10 = __Pyx_GetItemInt(__pyx_v_ranges_2d, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 448, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_10);
-    __pyx_t_2 = PyNumber_Subtract(__pyx_v_obs1, __pyx_t_10); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 391, __pyx_L1_error)
+    __pyx_t_2 = PyNumber_Subtract(__pyx_v_obs1, __pyx_t_10); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 448, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-    __pyx_t_10 = PyFloat_FromDouble(__pyx_v_fact_2d); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 391, __pyx_L1_error)
+    __pyx_t_10 = PyFloat_FromDouble(__pyx_v_fact_2d); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 448, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_10);
-    __pyx_t_9 = PyNumber_Multiply(__pyx_t_2, __pyx_t_10); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 391, __pyx_L1_error)
+    __pyx_t_9 = PyNumber_Multiply(__pyx_t_2, __pyx_t_10); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 448, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
     __pyx_v_obs1_ind_arr_2d = __pyx_t_9;
     __pyx_t_9 = 0;
 
-    /* "soapcw/soapcw.pyx":393
+    /* "soapcw/soapcw.pyx":450
  *             obs1_ind_arr_2d = (obs1 - ranges_2d[0])*fact_2d
  *             # set powers outside range to end index
  *             obs1_ind_arr_2d[obs1_ind_arr_2d >= len(ranges_2d)] = len(ranges_2d)-1             # <<<<<<<<<<<<<<
  *             obs1_ind_arr_2d[obs1_ind_arr_2d < 0] = 0
  *             obs1_ind_2d = np.array(obs1_ind_arr_2d).astype(np.int32)
  */
-    __pyx_t_7 = PyObject_Length(__pyx_v_ranges_2d); if (unlikely(__pyx_t_7 == ((Py_ssize_t)-1))) __PYX_ERR(0, 393, __pyx_L1_error)
-    __pyx_t_9 = PyInt_FromSsize_t((__pyx_t_7 - 1)); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 393, __pyx_L1_error)
+    __pyx_t_7 = PyObject_Length(__pyx_v_ranges_2d); if (unlikely(__pyx_t_7 == ((Py_ssize_t)-1))) __PYX_ERR(0, 450, __pyx_L1_error)
+    __pyx_t_9 = PyInt_FromSsize_t((__pyx_t_7 - 1)); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 450, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
-    __pyx_t_7 = PyObject_Length(__pyx_v_ranges_2d); if (unlikely(__pyx_t_7 == ((Py_ssize_t)-1))) __PYX_ERR(0, 393, __pyx_L1_error)
-    __pyx_t_10 = PyInt_FromSsize_t(__pyx_t_7); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 393, __pyx_L1_error)
+    __pyx_t_7 = PyObject_Length(__pyx_v_ranges_2d); if (unlikely(__pyx_t_7 == ((Py_ssize_t)-1))) __PYX_ERR(0, 450, __pyx_L1_error)
+    __pyx_t_10 = PyInt_FromSsize_t(__pyx_t_7); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 450, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_10);
-    __pyx_t_2 = PyObject_RichCompare(__pyx_v_obs1_ind_arr_2d, __pyx_t_10, Py_GE); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 393, __pyx_L1_error)
+    __pyx_t_2 = PyObject_RichCompare(__pyx_v_obs1_ind_arr_2d, __pyx_t_10, Py_GE); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 450, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-    if (unlikely(PyObject_SetItem(__pyx_v_obs1_ind_arr_2d, __pyx_t_2, __pyx_t_9) < 0)) __PYX_ERR(0, 393, __pyx_L1_error)
+    if (unlikely(PyObject_SetItem(__pyx_v_obs1_ind_arr_2d, __pyx_t_2, __pyx_t_9) < 0)) __PYX_ERR(0, 450, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
 
-    /* "soapcw/soapcw.pyx":394
+    /* "soapcw/soapcw.pyx":451
  *             # set powers outside range to end index
  *             obs1_ind_arr_2d[obs1_ind_arr_2d >= len(ranges_2d)] = len(ranges_2d)-1
  *             obs1_ind_arr_2d[obs1_ind_arr_2d < 0] = 0             # <<<<<<<<<<<<<<
  *             obs1_ind_2d = np.array(obs1_ind_arr_2d).astype(np.int32)
  * 
  */
-    __pyx_t_9 = PyObject_RichCompare(__pyx_v_obs1_ind_arr_2d, __pyx_int_0, Py_LT); __Pyx_XGOTREF(__pyx_t_9); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 394, __pyx_L1_error)
-    if (unlikely(PyObject_SetItem(__pyx_v_obs1_ind_arr_2d, __pyx_t_9, __pyx_int_0) < 0)) __PYX_ERR(0, 394, __pyx_L1_error)
+    __pyx_t_9 = PyObject_RichCompare(__pyx_v_obs1_ind_arr_2d, __pyx_int_0, Py_LT); __Pyx_XGOTREF(__pyx_t_9); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 451, __pyx_L1_error)
+    if (unlikely(PyObject_SetItem(__pyx_v_obs1_ind_arr_2d, __pyx_t_9, __pyx_int_0) < 0)) __PYX_ERR(0, 451, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
 
-    /* "soapcw/soapcw.pyx":395
+    /* "soapcw/soapcw.pyx":452
  *             obs1_ind_arr_2d[obs1_ind_arr_2d >= len(ranges_2d)] = len(ranges_2d)-1
  *             obs1_ind_arr_2d[obs1_ind_arr_2d < 0] = 0
  *             obs1_ind_2d = np.array(obs1_ind_arr_2d).astype(np.int32)             # <<<<<<<<<<<<<<
  * 
  *             # same for second detector
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_10, __pyx_n_s_np); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 395, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_10, __pyx_n_s_np); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 452, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_10);
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_10, __pyx_n_s_array); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 395, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_10, __pyx_n_s_array); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 452, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
     __pyx_t_10 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
       __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_4);
       if (likely(__pyx_t_10)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
         __Pyx_INCREF(__pyx_t_10);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_4, function);
       }
     }
     __pyx_t_2 = (__pyx_t_10) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_10, __pyx_v_obs1_ind_arr_2d) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_v_obs1_ind_arr_2d);
     __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
-    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 395, __pyx_L1_error)
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 452, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_astype); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 395, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_astype); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 452, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 395, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 452, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_int32); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 395, __pyx_L1_error)
+    __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_int32); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 452, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_10);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __pyx_t_2 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
       __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_4);
       if (likely(__pyx_t_2)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
@@ -9754,107 +10092,107 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_4, function);
       }
     }
     __pyx_t_9 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_2, __pyx_t_10) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_10);
     __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-    if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 395, __pyx_L1_error)
+    if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 452, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_t_11 = __Pyx_PyObject_to_MemoryviewSlice_dsds_int(__pyx_t_9, PyBUF_WRITABLE); if (unlikely(!__pyx_t_11.memview)) __PYX_ERR(0, 395, __pyx_L1_error)
+    __pyx_t_11 = __Pyx_PyObject_to_MemoryviewSlice_dsds_int(__pyx_t_9, PyBUF_WRITABLE); if (unlikely(!__pyx_t_11.memview)) __PYX_ERR(0, 452, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
     __pyx_v_obs1_ind_2d = __pyx_t_11;
     __pyx_t_11.memview = NULL;
     __pyx_t_11.data = NULL;
 
-    /* "soapcw/soapcw.pyx":398
+    /* "soapcw/soapcw.pyx":455
  * 
  *             # same for second detector
  *             obs2_ind_arr_2d = (obs2-ranges_2d[0])*fact_2d             # <<<<<<<<<<<<<<
  *             obs2_ind_arr_2d[obs2_ind_arr_2d >= len(ranges_2d)] = len(ranges_2d)-1
  *             obs2_ind_arr_2d[obs2_ind_arr_2d < 0] = 0
  */
-    __pyx_t_9 = __Pyx_GetItemInt(__pyx_v_ranges_2d, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 398, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_GetItemInt(__pyx_v_ranges_2d, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 455, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
-    __pyx_t_4 = PyNumber_Subtract(__pyx_v_obs2, __pyx_t_9); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 398, __pyx_L1_error)
+    __pyx_t_4 = PyNumber_Subtract(__pyx_v_obs2, __pyx_t_9); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 455, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-    __pyx_t_9 = PyFloat_FromDouble(__pyx_v_fact_2d); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 398, __pyx_L1_error)
+    __pyx_t_9 = PyFloat_FromDouble(__pyx_v_fact_2d); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 455, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
-    __pyx_t_10 = PyNumber_Multiply(__pyx_t_4, __pyx_t_9); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 398, __pyx_L1_error)
+    __pyx_t_10 = PyNumber_Multiply(__pyx_t_4, __pyx_t_9); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 455, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_10);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
     __pyx_v_obs2_ind_arr_2d = __pyx_t_10;
     __pyx_t_10 = 0;
 
-    /* "soapcw/soapcw.pyx":399
+    /* "soapcw/soapcw.pyx":456
  *             # same for second detector
  *             obs2_ind_arr_2d = (obs2-ranges_2d[0])*fact_2d
  *             obs2_ind_arr_2d[obs2_ind_arr_2d >= len(ranges_2d)] = len(ranges_2d)-1             # <<<<<<<<<<<<<<
  *             obs2_ind_arr_2d[obs2_ind_arr_2d < 0] = 0
  *             obs2_ind_2d = np.array(obs2_ind_arr_2d).astype(np.int32)
  */
-    __pyx_t_7 = PyObject_Length(__pyx_v_ranges_2d); if (unlikely(__pyx_t_7 == ((Py_ssize_t)-1))) __PYX_ERR(0, 399, __pyx_L1_error)
-    __pyx_t_10 = PyInt_FromSsize_t((__pyx_t_7 - 1)); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 399, __pyx_L1_error)
+    __pyx_t_7 = PyObject_Length(__pyx_v_ranges_2d); if (unlikely(__pyx_t_7 == ((Py_ssize_t)-1))) __PYX_ERR(0, 456, __pyx_L1_error)
+    __pyx_t_10 = PyInt_FromSsize_t((__pyx_t_7 - 1)); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 456, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_10);
-    __pyx_t_7 = PyObject_Length(__pyx_v_ranges_2d); if (unlikely(__pyx_t_7 == ((Py_ssize_t)-1))) __PYX_ERR(0, 399, __pyx_L1_error)
-    __pyx_t_9 = PyInt_FromSsize_t(__pyx_t_7); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 399, __pyx_L1_error)
+    __pyx_t_7 = PyObject_Length(__pyx_v_ranges_2d); if (unlikely(__pyx_t_7 == ((Py_ssize_t)-1))) __PYX_ERR(0, 456, __pyx_L1_error)
+    __pyx_t_9 = PyInt_FromSsize_t(__pyx_t_7); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 456, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
-    __pyx_t_4 = PyObject_RichCompare(__pyx_v_obs2_ind_arr_2d, __pyx_t_9, Py_GE); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 399, __pyx_L1_error)
+    __pyx_t_4 = PyObject_RichCompare(__pyx_v_obs2_ind_arr_2d, __pyx_t_9, Py_GE); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 456, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-    if (unlikely(PyObject_SetItem(__pyx_v_obs2_ind_arr_2d, __pyx_t_4, __pyx_t_10) < 0)) __PYX_ERR(0, 399, __pyx_L1_error)
+    if (unlikely(PyObject_SetItem(__pyx_v_obs2_ind_arr_2d, __pyx_t_4, __pyx_t_10) < 0)) __PYX_ERR(0, 456, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
 
-    /* "soapcw/soapcw.pyx":400
+    /* "soapcw/soapcw.pyx":457
  *             obs2_ind_arr_2d = (obs2-ranges_2d[0])*fact_2d
  *             obs2_ind_arr_2d[obs2_ind_arr_2d >= len(ranges_2d)] = len(ranges_2d)-1
  *             obs2_ind_arr_2d[obs2_ind_arr_2d < 0] = 0             # <<<<<<<<<<<<<<
  *             obs2_ind_2d = np.array(obs2_ind_arr_2d).astype(np.int32)
  * 
  */
-    __pyx_t_10 = PyObject_RichCompare(__pyx_v_obs2_ind_arr_2d, __pyx_int_0, Py_LT); __Pyx_XGOTREF(__pyx_t_10); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 400, __pyx_L1_error)
-    if (unlikely(PyObject_SetItem(__pyx_v_obs2_ind_arr_2d, __pyx_t_10, __pyx_int_0) < 0)) __PYX_ERR(0, 400, __pyx_L1_error)
+    __pyx_t_10 = PyObject_RichCompare(__pyx_v_obs2_ind_arr_2d, __pyx_int_0, Py_LT); __Pyx_XGOTREF(__pyx_t_10); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 457, __pyx_L1_error)
+    if (unlikely(PyObject_SetItem(__pyx_v_obs2_ind_arr_2d, __pyx_t_10, __pyx_int_0) < 0)) __PYX_ERR(0, 457, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
 
-    /* "soapcw/soapcw.pyx":401
+    /* "soapcw/soapcw.pyx":458
  *             obs2_ind_arr_2d[obs2_ind_arr_2d >= len(ranges_2d)] = len(ranges_2d)-1
  *             obs2_ind_arr_2d[obs2_ind_arr_2d < 0] = 0
  *             obs2_ind_2d = np.array(obs2_ind_arr_2d).astype(np.int32)             # <<<<<<<<<<<<<<
  * 
- *             if lookup_file_1det is None:
+ *             if lookup_table_1det is None:
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_np); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 401, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_np); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 458, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
-    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_array); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 401, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_array); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 458, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
     __pyx_t_9 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
       __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_2);
       if (likely(__pyx_t_9)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
         __Pyx_INCREF(__pyx_t_9);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_2, function);
       }
     }
     __pyx_t_4 = (__pyx_t_9) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_9, __pyx_v_obs2_ind_arr_2d) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_obs2_ind_arr_2d);
     __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
-    if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 401, __pyx_L1_error)
+    if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 458, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_astype); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 401, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_astype); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 458, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 401, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 458, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_int32); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 401, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_int32); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 458, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __pyx_t_4 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
       __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
       if (likely(__pyx_t_4)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
@@ -9862,64 +10200,64 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_2, function);
       }
     }
     __pyx_t_10 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_4, __pyx_t_9) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_9);
     __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-    if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 401, __pyx_L1_error)
+    if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 458, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_10);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __pyx_v_obs2_ind_2d = __pyx_t_10;
     __pyx_t_10 = 0;
 
-    /* "soapcw/soapcw.pyx":403
+    /* "soapcw/soapcw.pyx":460
  *             obs2_ind_2d = np.array(obs2_ind_arr_2d).astype(np.int32)
  * 
- *             if lookup_file_1det is None:             # <<<<<<<<<<<<<<
+ *             if lookup_table_1det is None:             # <<<<<<<<<<<<<<
  *                 obs1_ind_1d = np.array(obs1_ind_arr_2d).astype(np.int32)
  *                 obs2_ind_1d = np.array(obs2_ind_arr_2d).astype(np.int32)
  */
-    __pyx_t_16 = (__pyx_v_lookup_file_1det == Py_None);
+    __pyx_t_16 = (__pyx_v_lookup_table_1det == Py_None);
     __pyx_t_17 = (__pyx_t_16 != 0);
     if (__pyx_t_17) {
 
-      /* "soapcw/soapcw.pyx":404
+      /* "soapcw/soapcw.pyx":461
  * 
- *             if lookup_file_1det is None:
+ *             if lookup_table_1det is None:
  *                 obs1_ind_1d = np.array(obs1_ind_arr_2d).astype(np.int32)             # <<<<<<<<<<<<<<
  *                 obs2_ind_1d = np.array(obs2_ind_arr_2d).astype(np.int32)
  *                 logarr_1d = diag
  */
-      __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_np); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 404, __pyx_L1_error)
+      __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_np); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 461, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_9);
-      __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_array); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 404, __pyx_L1_error)
+      __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_array); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 461, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
       __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
       __pyx_t_9 = NULL;
       if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
         __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_4);
         if (likely(__pyx_t_9)) {
           PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
           __Pyx_INCREF(__pyx_t_9);
           __Pyx_INCREF(function);
           __Pyx_DECREF_SET(__pyx_t_4, function);
         }
       }
       __pyx_t_2 = (__pyx_t_9) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_9, __pyx_v_obs1_ind_arr_2d) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_v_obs1_ind_arr_2d);
       __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
-      if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 404, __pyx_L1_error)
+      if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 461, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-      __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_astype); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 404, __pyx_L1_error)
+      __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_astype); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 461, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
       __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-      __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 404, __pyx_L1_error)
+      __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 461, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
-      __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_int32); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 404, __pyx_L1_error)
+      __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_int32); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 461, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_9);
       __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
       __pyx_t_2 = NULL;
       if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
         __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_4);
         if (likely(__pyx_t_2)) {
           PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
@@ -9927,57 +10265,57 @@
           __Pyx_INCREF(function);
           __Pyx_DECREF_SET(__pyx_t_4, function);
         }
       }
       __pyx_t_10 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_2, __pyx_t_9) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_9);
       __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
       __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-      if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 404, __pyx_L1_error)
+      if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 461, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_10);
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-      __pyx_t_11 = __Pyx_PyObject_to_MemoryviewSlice_dsds_int(__pyx_t_10, PyBUF_WRITABLE); if (unlikely(!__pyx_t_11.memview)) __PYX_ERR(0, 404, __pyx_L1_error)
+      __pyx_t_11 = __Pyx_PyObject_to_MemoryviewSlice_dsds_int(__pyx_t_10, PyBUF_WRITABLE); if (unlikely(!__pyx_t_11.memview)) __PYX_ERR(0, 461, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
       __PYX_XDEC_MEMVIEW(&__pyx_v_obs1_ind_1d, 1);
       __pyx_v_obs1_ind_1d = __pyx_t_11;
       __pyx_t_11.memview = NULL;
       __pyx_t_11.data = NULL;
 
-      /* "soapcw/soapcw.pyx":405
- *             if lookup_file_1det is None:
+      /* "soapcw/soapcw.pyx":462
+ *             if lookup_table_1det is None:
  *                 obs1_ind_1d = np.array(obs1_ind_arr_2d).astype(np.int32)
  *                 obs2_ind_1d = np.array(obs2_ind_arr_2d).astype(np.int32)             # <<<<<<<<<<<<<<
  *                 logarr_1d = diag
  * 
  */
-      __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_np); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 405, __pyx_L1_error)
+      __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_np); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 462, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_9);
-      __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_array); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 405, __pyx_L1_error)
+      __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_array); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 462, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
       __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
       __pyx_t_9 = NULL;
       if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
         __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_2);
         if (likely(__pyx_t_9)) {
           PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
           __Pyx_INCREF(__pyx_t_9);
           __Pyx_INCREF(function);
           __Pyx_DECREF_SET(__pyx_t_2, function);
         }
       }
       __pyx_t_4 = (__pyx_t_9) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_9, __pyx_v_obs2_ind_arr_2d) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_obs2_ind_arr_2d);
       __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
-      if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 405, __pyx_L1_error)
+      if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 462, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
       __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-      __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_astype); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 405, __pyx_L1_error)
+      __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_astype); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 462, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-      __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 405, __pyx_L1_error)
+      __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 462, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
-      __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_int32); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 405, __pyx_L1_error)
+      __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_int32); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 462, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_9);
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
       __pyx_t_4 = NULL;
       if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
         __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
         if (likely(__pyx_t_4)) {
           PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
@@ -9985,140 +10323,140 @@
           __Pyx_INCREF(function);
           __Pyx_DECREF_SET(__pyx_t_2, function);
         }
       }
       __pyx_t_10 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_4, __pyx_t_9) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_9);
       __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
       __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-      if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 405, __pyx_L1_error)
+      if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 462, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_10);
       __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
       __Pyx_XDECREF_SET(__pyx_v_obs2_ind_1d, __pyx_t_10);
       __pyx_t_10 = 0;
 
-      /* "soapcw/soapcw.pyx":406
+      /* "soapcw/soapcw.pyx":463
  *                 obs1_ind_1d = np.array(obs1_ind_arr_2d).astype(np.int32)
  *                 obs2_ind_1d = np.array(obs2_ind_arr_2d).astype(np.int32)
  *                 logarr_1d = diag             # <<<<<<<<<<<<<<
  * 
  *             del diag
  */
-      __pyx_t_19 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_v_diag, PyBUF_WRITABLE); if (unlikely(!__pyx_t_19.memview)) __PYX_ERR(0, 406, __pyx_L1_error)
+      __pyx_t_19 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_v_diag, PyBUF_WRITABLE); if (unlikely(!__pyx_t_19.memview)) __PYX_ERR(0, 463, __pyx_L1_error)
       __PYX_XDEC_MEMVIEW(&__pyx_v_logarr_1d, 1);
       __pyx_v_logarr_1d = __pyx_t_19;
       __pyx_t_19.memview = NULL;
       __pyx_t_19.data = NULL;
 
-      /* "soapcw/soapcw.pyx":403
+      /* "soapcw/soapcw.pyx":460
  *             obs2_ind_2d = np.array(obs2_ind_arr_2d).astype(np.int32)
  * 
- *             if lookup_file_1det is None:             # <<<<<<<<<<<<<<
+ *             if lookup_table_1det is None:             # <<<<<<<<<<<<<<
  *                 obs1_ind_1d = np.array(obs1_ind_arr_2d).astype(np.int32)
  *                 obs2_ind_1d = np.array(obs2_ind_arr_2d).astype(np.int32)
  */
     }
 
-    /* "soapcw/soapcw.pyx":408
+    /* "soapcw/soapcw.pyx":465
  *                 logarr_1d = diag
  * 
  *             del diag             # <<<<<<<<<<<<<<
  *             del obs2_ind_arr_2d
  *             del obs1_ind_arr_2d
  */
     __Pyx_DECREF(__pyx_v_diag);
     __pyx_v_diag = NULL;
 
-    /* "soapcw/soapcw.pyx":409
+    /* "soapcw/soapcw.pyx":466
  * 
  *             del diag
  *             del obs2_ind_arr_2d             # <<<<<<<<<<<<<<
  *             del obs1_ind_arr_2d
  * 
  */
     __Pyx_DECREF(__pyx_v_obs2_ind_arr_2d);
     __pyx_v_obs2_ind_arr_2d = NULL;
 
-    /* "soapcw/soapcw.pyx":410
+    /* "soapcw/soapcw.pyx":467
  *             del diag
  *             del obs2_ind_arr_2d
  *             del obs1_ind_arr_2d             # <<<<<<<<<<<<<<
  * 
  *         sumv = False
  */
     __Pyx_DECREF(__pyx_v_obs1_ind_arr_2d);
     __pyx_v_obs1_ind_arr_2d = NULL;
 
-    /* "soapcw/soapcw.pyx":385
+    /* "soapcw/soapcw.pyx":442
  *             del obs2_ind_arr_1d
  * 
- *         if lookup_file_2det is not None:             # <<<<<<<<<<<<<<
- *             logarr, ranges_2d, fact_2d = self.read_lookup(lookup_file_2det)
+ *         if lookup_table_2det is not None:             # <<<<<<<<<<<<<<
+ *             logarr, ranges_2d, fact_2d = self.read_lookup(lookup_table_2det)
  *             diag = copy.copy(np.diag(logarr))
  */
   }
 
-  /* "soapcw/soapcw.pyx":412
+  /* "soapcw/soapcw.pyx":469
  *             del obs1_ind_arr_2d
  * 
  *         sumv = False             # <<<<<<<<<<<<<<
  * 	# if no lookup tables provided then use the sum of the powers
- *         if lookup_file_1det is None and lookup_file_2det is None:
+ *         if lookup_table_1det is None and lookup_table_2det is None:
  */
   __pyx_v_sumv = 0;
 
-  /* "soapcw/soapcw.pyx":414
+  /* "soapcw/soapcw.pyx":471
  *         sumv = False
  * 	# if no lookup tables provided then use the sum of the powers
- *         if lookup_file_1det is None and lookup_file_2det is None:             # <<<<<<<<<<<<<<
+ *         if lookup_table_1det is None and lookup_table_2det is None:             # <<<<<<<<<<<<<<
  *             # if using the sum of power, set element of index to 2d array
  *             obs1_ind_1d = np.arange(np.prod(shape)).reshape(shape).astype(np.int32)
  */
-  __pyx_t_16 = (__pyx_v_lookup_file_1det == Py_None);
+  __pyx_t_16 = (__pyx_v_lookup_table_1det == Py_None);
   __pyx_t_21 = (__pyx_t_16 != 0);
   if (__pyx_t_21) {
   } else {
     __pyx_t_17 = __pyx_t_21;
     goto __pyx_L23_bool_binop_done;
   }
-  __pyx_t_21 = (__pyx_v_lookup_file_2det == Py_None);
+  __pyx_t_21 = (__pyx_v_lookup_table_2det == Py_None);
   __pyx_t_16 = (__pyx_t_21 != 0);
   __pyx_t_17 = __pyx_t_16;
   __pyx_L23_bool_binop_done:;
   if (__pyx_t_17) {
 
-    /* "soapcw/soapcw.pyx":416
- *         if lookup_file_1det is None and lookup_file_2det is None:
+    /* "soapcw/soapcw.pyx":473
+ *         if lookup_table_1det is None and lookup_table_2det is None:
  *             # if using the sum of power, set element of index to 2d array
  *             obs1_ind_1d = np.arange(np.prod(shape)).reshape(shape).astype(np.int32)             # <<<<<<<<<<<<<<
  *             obs1_ind_2d = np.arange(np.prod(shape)).reshape(shape).astype(np.int32)
  *             obs2_ind_1d = np.arange(np.prod(shape)).reshape(shape).astype(np.int32) + np.prod(shape)
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 416, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 473, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_arange); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 416, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_arange); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 473, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __Pyx_GetModuleGlobalName(__pyx_t_14, __pyx_n_s_np); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 416, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_14, __pyx_n_s_np); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 473, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_14);
-    __pyx_t_15 = __Pyx_PyObject_GetAttrStr(__pyx_t_14, __pyx_n_s_prod); if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 416, __pyx_L1_error)
+    __pyx_t_15 = __Pyx_PyObject_GetAttrStr(__pyx_t_14, __pyx_n_s_prod); if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 473, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_15);
     __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
     __pyx_t_14 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_15))) {
       __pyx_t_14 = PyMethod_GET_SELF(__pyx_t_15);
       if (likely(__pyx_t_14)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_15);
         __Pyx_INCREF(__pyx_t_14);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_15, function);
       }
     }
     __pyx_t_4 = (__pyx_t_14) ? __Pyx_PyObject_Call2Args(__pyx_t_15, __pyx_t_14, __pyx_v_shape) : __Pyx_PyObject_CallOneArg(__pyx_t_15, __pyx_v_shape);
     __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
-    if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 416, __pyx_L1_error)
+    if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 473, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_15); __pyx_t_15 = 0;
     __pyx_t_15 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
       __pyx_t_15 = PyMethod_GET_SELF(__pyx_t_3);
       if (likely(__pyx_t_15)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
@@ -10126,41 +10464,41 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_3, function);
       }
     }
     __pyx_t_9 = (__pyx_t_15) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_15, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4);
     __Pyx_XDECREF(__pyx_t_15); __pyx_t_15 = 0;
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 416, __pyx_L1_error)
+    if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 473, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_reshape); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 416, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_reshape); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 473, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
     __pyx_t_9 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
       __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_3);
       if (likely(__pyx_t_9)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
         __Pyx_INCREF(__pyx_t_9);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_3, function);
       }
     }
     __pyx_t_2 = (__pyx_t_9) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_9, __pyx_v_shape) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_shape);
     __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
-    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 416, __pyx_L1_error)
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 473, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_astype); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 416, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_astype); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 473, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 416, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 473, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_int32); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 416, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_int32); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 473, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __pyx_t_2 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
       __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
       if (likely(__pyx_t_2)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
@@ -10168,54 +10506,54 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_3, function);
       }
     }
     __pyx_t_10 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_2, __pyx_t_9) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_9);
     __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-    if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 416, __pyx_L1_error)
+    if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 473, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_10);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_t_11 = __Pyx_PyObject_to_MemoryviewSlice_dsds_int(__pyx_t_10, PyBUF_WRITABLE); if (unlikely(!__pyx_t_11.memview)) __PYX_ERR(0, 416, __pyx_L1_error)
+    __pyx_t_11 = __Pyx_PyObject_to_MemoryviewSlice_dsds_int(__pyx_t_10, PyBUF_WRITABLE); if (unlikely(!__pyx_t_11.memview)) __PYX_ERR(0, 473, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
     __PYX_XDEC_MEMVIEW(&__pyx_v_obs1_ind_1d, 1);
     __pyx_v_obs1_ind_1d = __pyx_t_11;
     __pyx_t_11.memview = NULL;
     __pyx_t_11.data = NULL;
 
-    /* "soapcw/soapcw.pyx":417
+    /* "soapcw/soapcw.pyx":474
  *             # if using the sum of power, set element of index to 2d array
  *             obs1_ind_1d = np.arange(np.prod(shape)).reshape(shape).astype(np.int32)
  *             obs1_ind_2d = np.arange(np.prod(shape)).reshape(shape).astype(np.int32)             # <<<<<<<<<<<<<<
  *             obs2_ind_1d = np.arange(np.prod(shape)).reshape(shape).astype(np.int32) + np.prod(shape)
  *             obs2_ind_2d = np.arange(np.prod(shape)).reshape(shape).astype(np.int32) + np.prod(shape)
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 417, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 474, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_arange); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 417, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_arange); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 474, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __Pyx_GetModuleGlobalName(__pyx_t_15, __pyx_n_s_np); if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 417, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_15, __pyx_n_s_np); if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 474, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_15);
-    __pyx_t_14 = __Pyx_PyObject_GetAttrStr(__pyx_t_15, __pyx_n_s_prod); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 417, __pyx_L1_error)
+    __pyx_t_14 = __Pyx_PyObject_GetAttrStr(__pyx_t_15, __pyx_n_s_prod); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 474, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_14);
     __Pyx_DECREF(__pyx_t_15); __pyx_t_15 = 0;
     __pyx_t_15 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_14))) {
       __pyx_t_15 = PyMethod_GET_SELF(__pyx_t_14);
       if (likely(__pyx_t_15)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_14);
         __Pyx_INCREF(__pyx_t_15);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_14, function);
       }
     }
     __pyx_t_2 = (__pyx_t_15) ? __Pyx_PyObject_Call2Args(__pyx_t_14, __pyx_t_15, __pyx_v_shape) : __Pyx_PyObject_CallOneArg(__pyx_t_14, __pyx_v_shape);
     __Pyx_XDECREF(__pyx_t_15); __pyx_t_15 = 0;
-    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 417, __pyx_L1_error)
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 474, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
     __pyx_t_14 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
       __pyx_t_14 = PyMethod_GET_SELF(__pyx_t_4);
       if (likely(__pyx_t_14)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
@@ -10223,41 +10561,41 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_4, function);
       }
     }
     __pyx_t_9 = (__pyx_t_14) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_14, __pyx_t_2) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_2);
     __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 417, __pyx_L1_error)
+    if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 474, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_reshape); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 417, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_reshape); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 474, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
     __pyx_t_9 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
       __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_4);
       if (likely(__pyx_t_9)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
         __Pyx_INCREF(__pyx_t_9);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_4, function);
       }
     }
     __pyx_t_3 = (__pyx_t_9) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_9, __pyx_v_shape) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_v_shape);
     __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
-    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 417, __pyx_L1_error)
+    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 474, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_astype); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 417, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_astype); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 474, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 417, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 474, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_int32); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 417, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_int32); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 474, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_t_3 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
       __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_4);
       if (likely(__pyx_t_3)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
@@ -10265,54 +10603,54 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_4, function);
       }
     }
     __pyx_t_10 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_3, __pyx_t_9) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_9);
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-    if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 417, __pyx_L1_error)
+    if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 474, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_10);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_t_11 = __Pyx_PyObject_to_MemoryviewSlice_dsds_int(__pyx_t_10, PyBUF_WRITABLE); if (unlikely(!__pyx_t_11.memview)) __PYX_ERR(0, 417, __pyx_L1_error)
+    __pyx_t_11 = __Pyx_PyObject_to_MemoryviewSlice_dsds_int(__pyx_t_10, PyBUF_WRITABLE); if (unlikely(!__pyx_t_11.memview)) __PYX_ERR(0, 474, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
     __PYX_XDEC_MEMVIEW(&__pyx_v_obs1_ind_2d, 1);
     __pyx_v_obs1_ind_2d = __pyx_t_11;
     __pyx_t_11.memview = NULL;
     __pyx_t_11.data = NULL;
 
-    /* "soapcw/soapcw.pyx":418
+    /* "soapcw/soapcw.pyx":475
  *             obs1_ind_1d = np.arange(np.prod(shape)).reshape(shape).astype(np.int32)
  *             obs1_ind_2d = np.arange(np.prod(shape)).reshape(shape).astype(np.int32)
  *             obs2_ind_1d = np.arange(np.prod(shape)).reshape(shape).astype(np.int32) + np.prod(shape)             # <<<<<<<<<<<<<<
  *             obs2_ind_2d = np.arange(np.prod(shape)).reshape(shape).astype(np.int32) + np.prod(shape)
  *             # flatten input spectrogram for access in 1d
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 418, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 475, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_arange); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 418, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_arange); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 475, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __Pyx_GetModuleGlobalName(__pyx_t_14, __pyx_n_s_np); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 418, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_14, __pyx_n_s_np); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 475, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_14);
-    __pyx_t_15 = __Pyx_PyObject_GetAttrStr(__pyx_t_14, __pyx_n_s_prod); if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 418, __pyx_L1_error)
+    __pyx_t_15 = __Pyx_PyObject_GetAttrStr(__pyx_t_14, __pyx_n_s_prod); if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 475, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_15);
     __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
     __pyx_t_14 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_15))) {
       __pyx_t_14 = PyMethod_GET_SELF(__pyx_t_15);
       if (likely(__pyx_t_14)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_15);
         __Pyx_INCREF(__pyx_t_14);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_15, function);
       }
     }
     __pyx_t_3 = (__pyx_t_14) ? __Pyx_PyObject_Call2Args(__pyx_t_15, __pyx_t_14, __pyx_v_shape) : __Pyx_PyObject_CallOneArg(__pyx_t_15, __pyx_v_shape);
     __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
-    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 418, __pyx_L1_error)
+    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 475, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_15); __pyx_t_15 = 0;
     __pyx_t_15 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
       __pyx_t_15 = PyMethod_GET_SELF(__pyx_t_2);
       if (likely(__pyx_t_15)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
@@ -10320,41 +10658,41 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_2, function);
       }
     }
     __pyx_t_9 = (__pyx_t_15) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_15, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3);
     __Pyx_XDECREF(__pyx_t_15); __pyx_t_15 = 0;
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 418, __pyx_L1_error)
+    if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 475, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_reshape); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 418, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_reshape); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 475, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
     __pyx_t_9 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
       __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_2);
       if (likely(__pyx_t_9)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
         __Pyx_INCREF(__pyx_t_9);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_2, function);
       }
     }
     __pyx_t_4 = (__pyx_t_9) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_9, __pyx_v_shape) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_shape);
     __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
-    if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 418, __pyx_L1_error)
+    if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 475, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_astype); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 418, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_astype); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 475, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 418, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 475, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_int32); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 418, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_int32); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 475, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __pyx_t_4 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
       __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
       if (likely(__pyx_t_4)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
@@ -10362,74 +10700,74 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_2, function);
       }
     }
     __pyx_t_10 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_4, __pyx_t_9) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_9);
     __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-    if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 418, __pyx_L1_error)
+    if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 475, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_10);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_np); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 418, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_np); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 475, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_prod); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 418, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_prod); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 475, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
     __pyx_t_9 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
       __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_4);
       if (likely(__pyx_t_9)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
         __Pyx_INCREF(__pyx_t_9);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_4, function);
       }
     }
     __pyx_t_2 = (__pyx_t_9) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_9, __pyx_v_shape) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_v_shape);
     __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
-    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 418, __pyx_L1_error)
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 475, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_t_4 = PyNumber_Add(__pyx_t_10, __pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 418, __pyx_L1_error)
+    __pyx_t_4 = PyNumber_Add(__pyx_t_10, __pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 475, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_XDECREF_SET(__pyx_v_obs2_ind_1d, __pyx_t_4);
     __pyx_t_4 = 0;
 
-    /* "soapcw/soapcw.pyx":419
+    /* "soapcw/soapcw.pyx":476
  *             obs1_ind_2d = np.arange(np.prod(shape)).reshape(shape).astype(np.int32)
  *             obs2_ind_1d = np.arange(np.prod(shape)).reshape(shape).astype(np.int32) + np.prod(shape)
  *             obs2_ind_2d = np.arange(np.prod(shape)).reshape(shape).astype(np.int32) + np.prod(shape)             # <<<<<<<<<<<<<<
  *             # flatten input spectrogram for access in 1d
  *             logarr_1d = np.ravel([obs1,obs2])
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_np); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 419, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_np); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 476, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
-    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_arange); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 419, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_arange); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 476, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-    __Pyx_GetModuleGlobalName(__pyx_t_15, __pyx_n_s_np); if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 419, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_15, __pyx_n_s_np); if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 476, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_15);
-    __pyx_t_14 = __Pyx_PyObject_GetAttrStr(__pyx_t_15, __pyx_n_s_prod); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 419, __pyx_L1_error)
+    __pyx_t_14 = __Pyx_PyObject_GetAttrStr(__pyx_t_15, __pyx_n_s_prod); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 476, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_14);
     __Pyx_DECREF(__pyx_t_15); __pyx_t_15 = 0;
     __pyx_t_15 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_14))) {
       __pyx_t_15 = PyMethod_GET_SELF(__pyx_t_14);
       if (likely(__pyx_t_15)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_14);
         __Pyx_INCREF(__pyx_t_15);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_14, function);
       }
     }
     __pyx_t_9 = (__pyx_t_15) ? __Pyx_PyObject_Call2Args(__pyx_t_14, __pyx_t_15, __pyx_v_shape) : __Pyx_PyObject_CallOneArg(__pyx_t_14, __pyx_v_shape);
     __Pyx_XDECREF(__pyx_t_15); __pyx_t_15 = 0;
-    if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 419, __pyx_L1_error)
+    if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 476, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
     __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
     __pyx_t_14 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
       __pyx_t_14 = PyMethod_GET_SELF(__pyx_t_3);
       if (likely(__pyx_t_14)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
@@ -10437,41 +10775,41 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_3, function);
       }
     }
     __pyx_t_10 = (__pyx_t_14) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_14, __pyx_t_9) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_9);
     __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-    if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 419, __pyx_L1_error)
+    if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 476, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_10);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_10, __pyx_n_s_reshape); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 419, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_10, __pyx_n_s_reshape); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 476, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
     __pyx_t_10 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
       __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_3);
       if (likely(__pyx_t_10)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
         __Pyx_INCREF(__pyx_t_10);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_3, function);
       }
     }
     __pyx_t_2 = (__pyx_t_10) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_10, __pyx_v_shape) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_shape);
     __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
-    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 419, __pyx_L1_error)
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 476, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_astype); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 419, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_astype); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 476, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 419, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 476, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_int32); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 419, __pyx_L1_error)
+    __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_int32); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 476, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_10);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __pyx_t_2 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
       __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
       if (likely(__pyx_t_2)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
@@ -10479,57 +10817,57 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_3, function);
       }
     }
     __pyx_t_4 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_2, __pyx_t_10) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_10);
     __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-    if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 419, __pyx_L1_error)
+    if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 476, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __Pyx_GetModuleGlobalName(__pyx_t_10, __pyx_n_s_np); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 419, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_10, __pyx_n_s_np); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 476, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_10);
-    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_10, __pyx_n_s_prod); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 419, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_10, __pyx_n_s_prod); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 476, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
     __pyx_t_10 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
       __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_2);
       if (likely(__pyx_t_10)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
         __Pyx_INCREF(__pyx_t_10);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_2, function);
       }
     }
     __pyx_t_3 = (__pyx_t_10) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_10, __pyx_v_shape) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_shape);
     __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
-    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 419, __pyx_L1_error)
+    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 476, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __pyx_t_2 = PyNumber_Add(__pyx_t_4, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 419, __pyx_L1_error)
+    __pyx_t_2 = PyNumber_Add(__pyx_t_4, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 476, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_XDECREF_SET(__pyx_v_obs2_ind_2d, __pyx_t_2);
     __pyx_t_2 = 0;
 
-    /* "soapcw/soapcw.pyx":421
+    /* "soapcw/soapcw.pyx":478
  *             obs2_ind_2d = np.arange(np.prod(shape)).reshape(shape).astype(np.int32) + np.prod(shape)
  *             # flatten input spectrogram for access in 1d
  *             logarr_1d = np.ravel([obs1,obs2])             # <<<<<<<<<<<<<<
  *             sumv = True
  *             #logarr_2d = np.ravel([obs1,obs2])
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 421, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 478, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_ravel); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 421, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_ravel); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 478, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_t_3 = PyList_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 421, __pyx_L1_error)
+    __pyx_t_3 = PyList_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 478, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_INCREF(__pyx_v_obs1);
     __Pyx_GIVEREF(__pyx_v_obs1);
     PyList_SET_ITEM(__pyx_t_3, 0, __pyx_v_obs1);
     __Pyx_INCREF(__pyx_v_obs2);
     __Pyx_GIVEREF(__pyx_v_obs2);
     PyList_SET_ITEM(__pyx_t_3, 1, __pyx_v_obs2);
@@ -10542,100 +10880,100 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_4, function);
       }
     }
     __pyx_t_2 = (__pyx_t_10) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_10, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_3);
     __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 421, __pyx_L1_error)
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 478, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_t_19 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_2, PyBUF_WRITABLE); if (unlikely(!__pyx_t_19.memview)) __PYX_ERR(0, 421, __pyx_L1_error)
+    __pyx_t_19 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_2, PyBUF_WRITABLE); if (unlikely(!__pyx_t_19.memview)) __PYX_ERR(0, 478, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __PYX_XDEC_MEMVIEW(&__pyx_v_logarr_1d, 1);
     __pyx_v_logarr_1d = __pyx_t_19;
     __pyx_t_19.memview = NULL;
     __pyx_t_19.data = NULL;
 
-    /* "soapcw/soapcw.pyx":422
+    /* "soapcw/soapcw.pyx":479
  *             # flatten input spectrogram for access in 1d
  *             logarr_1d = np.ravel([obs1,obs2])
  *             sumv = True             # <<<<<<<<<<<<<<
  *             #logarr_2d = np.ravel([obs1,obs2])
  * 
  */
     __pyx_v_sumv = 1;
 
-    /* "soapcw/soapcw.pyx":414
+    /* "soapcw/soapcw.pyx":471
  *         sumv = False
  * 	# if no lookup tables provided then use the sum of the powers
- *         if lookup_file_1det is None and lookup_file_2det is None:             # <<<<<<<<<<<<<<
+ *         if lookup_table_1det is None and lookup_table_2det is None:             # <<<<<<<<<<<<<<
  *             # if using the sum of power, set element of index to 2d array
  *             obs1_ind_1d = np.arange(np.prod(shape)).reshape(shape).astype(np.int32)
  */
   }
 
-  /* "soapcw/soapcw.pyx":426
+  /* "soapcw/soapcw.pyx":483
  * 
  *         # initial viterbi loop for first time segment
  *         for i in range(width):             # <<<<<<<<<<<<<<
  *             temp = -1e6
  *             if obs1data[0] and obs2data[0]:
  */
   __pyx_t_22 = __pyx_v_width;
   __pyx_t_23 = __pyx_t_22;
   for (__pyx_t_24 = 0; __pyx_t_24 < __pyx_t_23; __pyx_t_24+=1) {
     __pyx_v_i = __pyx_t_24;
 
-    /* "soapcw/soapcw.pyx":427
+    /* "soapcw/soapcw.pyx":484
  *         # initial viterbi loop for first time segment
  *         for i in range(width):
  *             temp = -1e6             # <<<<<<<<<<<<<<
  *             if obs1data[0] and obs2data[0]:
  *                 # if data in both detectors
  */
     __pyx_v_temp = -1e6;
 
-    /* "soapcw/soapcw.pyx":428
+    /* "soapcw/soapcw.pyx":485
  *         for i in range(width):
  *             temp = -1e6
  *             if obs1data[0] and obs2data[0]:             # <<<<<<<<<<<<<<
  *                 # if data in both detectors
  *                 for k in range(sep_len):
  */
-    __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_obs1data, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 428, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_obs1data, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 485, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_16 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_16 < 0)) __PYX_ERR(0, 428, __pyx_L1_error)
+    __pyx_t_16 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_16 < 0)) __PYX_ERR(0, 485, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     if (__pyx_t_16) {
     } else {
       __pyx_t_17 = __pyx_t_16;
       goto __pyx_L28_bool_binop_done;
     }
-    __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_obs2data, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 428, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_obs2data, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 485, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_16 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_16 < 0)) __PYX_ERR(0, 428, __pyx_L1_error)
+    __pyx_t_16 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_16 < 0)) __PYX_ERR(0, 485, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __pyx_t_17 = __pyx_t_16;
     __pyx_L28_bool_binop_done:;
     if (__pyx_t_17) {
 
-      /* "soapcw/soapcw.pyx":430
+      /* "soapcw/soapcw.pyx":487
  *             if obs1data[0] and obs2data[0]:
  *                 # if data in both detectors
  *                 for k in range(sep_len):             # <<<<<<<<<<<<<<
  *                     if i+k-sep_dist>=0+edge_range and i+k-sep_dist<width-edge_range:
  *                         for m in range(sep_len):
  */
       __pyx_t_25 = __pyx_v_sep_len;
       __pyx_t_26 = __pyx_t_25;
       for (__pyx_t_27 = 0; __pyx_t_27 < __pyx_t_26; __pyx_t_27+=1) {
         __pyx_v_k = __pyx_t_27;
 
-        /* "soapcw/soapcw.pyx":431
+        /* "soapcw/soapcw.pyx":488
  *                 # if data in both detectors
  *                 for k in range(sep_len):
  *                     if i+k-sep_dist>=0+edge_range and i+k-sep_dist<width-edge_range:             # <<<<<<<<<<<<<<
  *                         for m in range(sep_len):
  *                             if i+m-sep_dist>=0+edge_range and i+m-sep_dist<width-edge_range:
  */
         __pyx_t_16 = ((((__pyx_v_i + __pyx_v_k) - __pyx_v_sep_dist) >= (0 + __pyx_v_edge_range)) != 0);
@@ -10645,27 +10983,27 @@
           goto __pyx_L33_bool_binop_done;
         }
         __pyx_t_16 = ((((__pyx_v_i + __pyx_v_k) - __pyx_v_sep_dist) < (__pyx_v_width - __pyx_v_edge_range)) != 0);
         __pyx_t_17 = __pyx_t_16;
         __pyx_L33_bool_binop_done:;
         if (__pyx_t_17) {
 
-          /* "soapcw/soapcw.pyx":432
+          /* "soapcw/soapcw.pyx":489
  *                 for k in range(sep_len):
  *                     if i+k-sep_dist>=0+edge_range and i+k-sep_dist<width-edge_range:
  *                         for m in range(sep_len):             # <<<<<<<<<<<<<<
  *                             if i+m-sep_dist>=0+edge_range and i+m-sep_dist<width-edge_range:
  *                                 if sumv:
  */
           __pyx_t_28 = __pyx_v_sep_len;
           __pyx_t_29 = __pyx_t_28;
           for (__pyx_t_30 = 0; __pyx_t_30 < __pyx_t_29; __pyx_t_30+=1) {
             __pyx_v_m = __pyx_t_30;
 
-            /* "soapcw/soapcw.pyx":433
+            /* "soapcw/soapcw.pyx":490
  *                     if i+k-sep_dist>=0+edge_range and i+k-sep_dist<width-edge_range:
  *                         for m in range(sep_len):
  *                             if i+m-sep_dist>=0+edge_range and i+m-sep_dist<width-edge_range:             # <<<<<<<<<<<<<<
  *                                 if sumv:
  *                                     value = tr[1][k][m] + obs1[0][i+k-sep_dist] + obs2[0][i+k-sep_dist]
  */
             __pyx_t_16 = ((((__pyx_v_i + __pyx_v_m) - __pyx_v_sep_dist) >= (0 + __pyx_v_edge_range)) != 0);
@@ -10675,25 +11013,25 @@
               goto __pyx_L38_bool_binop_done;
             }
             __pyx_t_16 = ((((__pyx_v_i + __pyx_v_m) - __pyx_v_sep_dist) < (__pyx_v_width - __pyx_v_edge_range)) != 0);
             __pyx_t_17 = __pyx_t_16;
             __pyx_L38_bool_binop_done:;
             if (__pyx_t_17) {
 
-              /* "soapcw/soapcw.pyx":434
+              /* "soapcw/soapcw.pyx":491
  *                         for m in range(sep_len):
  *                             if i+m-sep_dist>=0+edge_range and i+m-sep_dist<width-edge_range:
  *                                 if sumv:             # <<<<<<<<<<<<<<
  *                                     value = tr[1][k][m] + obs1[0][i+k-sep_dist] + obs2[0][i+k-sep_dist]
  *                                 else:
  */
               __pyx_t_17 = (__pyx_v_sumv != 0);
               if (__pyx_t_17) {
 
-                /* "soapcw/soapcw.pyx":435
+                /* "soapcw/soapcw.pyx":492
  *                             if i+m-sep_dist>=0+edge_range and i+m-sep_dist<width-edge_range:
  *                                 if sumv:
  *                                     value = tr[1][k][m] + obs1[0][i+k-sep_dist] + obs2[0][i+k-sep_dist]             # <<<<<<<<<<<<<<
  *                                 else:
  *                                     o1 = obs1_ind_2d[0][i+k-sep_dist]
  */
                 __pyx_t_31 = 1;
@@ -10710,97 +11048,97 @@
                 } else if (unlikely(__pyx_t_32 >= __pyx_v_tr.shape[1])) __pyx_t_34 = 1;
                 if (__pyx_t_33 < 0) {
                   __pyx_t_33 += __pyx_v_tr.shape[2];
                   if (unlikely(__pyx_t_33 < 0)) __pyx_t_34 = 2;
                 } else if (unlikely(__pyx_t_33 >= __pyx_v_tr.shape[2])) __pyx_t_34 = 2;
                 if (unlikely(__pyx_t_34 != -1)) {
                   __Pyx_RaiseBufferIndexError(__pyx_t_34);
-                  __PYX_ERR(0, 435, __pyx_L1_error)
+                  __PYX_ERR(0, 492, __pyx_L1_error)
                 }
-                __pyx_t_2 = PyFloat_FromDouble((*((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_tr.data + __pyx_t_31 * __pyx_v_tr.strides[0]) ) + __pyx_t_32 * __pyx_v_tr.strides[1]) ) + __pyx_t_33 * __pyx_v_tr.strides[2]) )))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 435, __pyx_L1_error)
+                __pyx_t_2 = PyFloat_FromDouble((*((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_tr.data + __pyx_t_31 * __pyx_v_tr.strides[0]) ) + __pyx_t_32 * __pyx_v_tr.strides[1]) ) + __pyx_t_33 * __pyx_v_tr.strides[2]) )))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 492, __pyx_L1_error)
                 __Pyx_GOTREF(__pyx_t_2);
-                __pyx_t_4 = __Pyx_GetItemInt(__pyx_v_obs1, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 435, __pyx_L1_error)
+                __pyx_t_4 = __Pyx_GetItemInt(__pyx_v_obs1, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 492, __pyx_L1_error)
                 __Pyx_GOTREF(__pyx_t_4);
                 __pyx_t_34 = ((__pyx_v_i + __pyx_v_k) - __pyx_v_sep_dist);
-                __pyx_t_3 = __Pyx_GetItemInt(__pyx_t_4, __pyx_t_34, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 435, __pyx_L1_error)
+                __pyx_t_3 = __Pyx_GetItemInt(__pyx_t_4, __pyx_t_34, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 492, __pyx_L1_error)
                 __Pyx_GOTREF(__pyx_t_3);
                 __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-                __pyx_t_4 = PyNumber_Add(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 435, __pyx_L1_error)
+                __pyx_t_4 = PyNumber_Add(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 492, __pyx_L1_error)
                 __Pyx_GOTREF(__pyx_t_4);
                 __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
                 __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-                __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_obs2, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 435, __pyx_L1_error)
+                __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_obs2, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 492, __pyx_L1_error)
                 __Pyx_GOTREF(__pyx_t_3);
                 __pyx_t_34 = ((__pyx_v_i + __pyx_v_k) - __pyx_v_sep_dist);
-                __pyx_t_2 = __Pyx_GetItemInt(__pyx_t_3, __pyx_t_34, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 435, __pyx_L1_error)
+                __pyx_t_2 = __Pyx_GetItemInt(__pyx_t_3, __pyx_t_34, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 492, __pyx_L1_error)
                 __Pyx_GOTREF(__pyx_t_2);
                 __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-                __pyx_t_3 = PyNumber_Add(__pyx_t_4, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 435, __pyx_L1_error)
+                __pyx_t_3 = PyNumber_Add(__pyx_t_4, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 492, __pyx_L1_error)
                 __Pyx_GOTREF(__pyx_t_3);
                 __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
                 __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-                __pyx_t_20 = __pyx_PyFloat_AsDouble(__pyx_t_3); if (unlikely((__pyx_t_20 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 435, __pyx_L1_error)
+                __pyx_t_20 = __pyx_PyFloat_AsDouble(__pyx_t_3); if (unlikely((__pyx_t_20 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 492, __pyx_L1_error)
                 __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
                 __pyx_v_value = __pyx_t_20;
 
-                /* "soapcw/soapcw.pyx":434
+                /* "soapcw/soapcw.pyx":491
  *                         for m in range(sep_len):
  *                             if i+m-sep_dist>=0+edge_range and i+m-sep_dist<width-edge_range:
  *                                 if sumv:             # <<<<<<<<<<<<<<
  *                                     value = tr[1][k][m] + obs1[0][i+k-sep_dist] + obs2[0][i+k-sep_dist]
  *                                 else:
  */
                 goto __pyx_L40;
               }
 
-              /* "soapcw/soapcw.pyx":437
+              /* "soapcw/soapcw.pyx":494
  *                                     value = tr[1][k][m] + obs1[0][i+k-sep_dist] + obs2[0][i+k-sep_dist]
  *                                 else:
  *                                     o1 = obs1_ind_2d[0][i+k-sep_dist]             # <<<<<<<<<<<<<<
  *                                     o2 = obs2_ind_2d[0][i+m-sep_dist]
  *                                     value = tr[1][k][m] + logarr_2d[o1,o2]
  */
               /*else*/ {
-                if (unlikely(!__pyx_v_obs1_ind_2d.memview)) { __Pyx_RaiseUnboundLocalError("obs1_ind_2d"); __PYX_ERR(0, 437, __pyx_L1_error) }
+                if (unlikely(!__pyx_v_obs1_ind_2d.memview)) { __Pyx_RaiseUnboundLocalError("obs1_ind_2d"); __PYX_ERR(0, 494, __pyx_L1_error) }
                 __pyx_t_33 = 0;
                 __pyx_t_32 = ((__pyx_v_i + __pyx_v_k) - __pyx_v_sep_dist);
                 __pyx_t_34 = -1;
                 if (__pyx_t_33 < 0) {
                   __pyx_t_33 += __pyx_v_obs1_ind_2d.shape[0];
                   if (unlikely(__pyx_t_33 < 0)) __pyx_t_34 = 0;
                 } else if (unlikely(__pyx_t_33 >= __pyx_v_obs1_ind_2d.shape[0])) __pyx_t_34 = 0;
                 if (__pyx_t_32 < 0) {
                   __pyx_t_32 += __pyx_v_obs1_ind_2d.shape[1];
                   if (unlikely(__pyx_t_32 < 0)) __pyx_t_34 = 1;
                 } else if (unlikely(__pyx_t_32 >= __pyx_v_obs1_ind_2d.shape[1])) __pyx_t_34 = 1;
                 if (unlikely(__pyx_t_34 != -1)) {
                   __Pyx_RaiseBufferIndexError(__pyx_t_34);
-                  __PYX_ERR(0, 437, __pyx_L1_error)
+                  __PYX_ERR(0, 494, __pyx_L1_error)
                 }
                 __pyx_v_o1 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_obs1_ind_2d.data + __pyx_t_33 * __pyx_v_obs1_ind_2d.strides[0]) ) + __pyx_t_32 * __pyx_v_obs1_ind_2d.strides[1]) )));
 
-                /* "soapcw/soapcw.pyx":438
+                /* "soapcw/soapcw.pyx":495
  *                                 else:
  *                                     o1 = obs1_ind_2d[0][i+k-sep_dist]
  *                                     o2 = obs2_ind_2d[0][i+m-sep_dist]             # <<<<<<<<<<<<<<
  *                                     value = tr[1][k][m] + logarr_2d[o1,o2]
  *                                 if value > temp:
  */
-                if (unlikely(!__pyx_v_obs2_ind_2d)) { __Pyx_RaiseUnboundLocalError("obs2_ind_2d"); __PYX_ERR(0, 438, __pyx_L1_error) }
-                __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_obs2_ind_2d, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 438, __pyx_L1_error)
+                if (unlikely(!__pyx_v_obs2_ind_2d)) { __Pyx_RaiseUnboundLocalError("obs2_ind_2d"); __PYX_ERR(0, 495, __pyx_L1_error) }
+                __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_obs2_ind_2d, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 495, __pyx_L1_error)
                 __Pyx_GOTREF(__pyx_t_3);
                 __pyx_t_34 = ((__pyx_v_i + __pyx_v_m) - __pyx_v_sep_dist);
-                __pyx_t_2 = __Pyx_GetItemInt(__pyx_t_3, __pyx_t_34, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 438, __pyx_L1_error)
+                __pyx_t_2 = __Pyx_GetItemInt(__pyx_t_3, __pyx_t_34, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 495, __pyx_L1_error)
                 __Pyx_GOTREF(__pyx_t_2);
                 __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-                __pyx_t_34 = __Pyx_PyInt_As_int(__pyx_t_2); if (unlikely((__pyx_t_34 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 438, __pyx_L1_error)
+                __pyx_t_34 = __Pyx_PyInt_As_int(__pyx_t_2); if (unlikely((__pyx_t_34 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 495, __pyx_L1_error)
                 __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
                 __pyx_v_o2 = __pyx_t_34;
 
-                /* "soapcw/soapcw.pyx":439
+                /* "soapcw/soapcw.pyx":496
  *                                     o1 = obs1_ind_2d[0][i+k-sep_dist]
  *                                     o2 = obs2_ind_2d[0][i+m-sep_dist]
  *                                     value = tr[1][k][m] + logarr_2d[o1,o2]             # <<<<<<<<<<<<<<
  *                                 if value > temp:
  *                                     temp = value
  */
                 __pyx_t_32 = 1;
@@ -10817,56 +11155,56 @@
                 } else if (unlikely(__pyx_t_33 >= __pyx_v_tr.shape[1])) __pyx_t_34 = 1;
                 if (__pyx_t_31 < 0) {
                   __pyx_t_31 += __pyx_v_tr.shape[2];
                   if (unlikely(__pyx_t_31 < 0)) __pyx_t_34 = 2;
                 } else if (unlikely(__pyx_t_31 >= __pyx_v_tr.shape[2])) __pyx_t_34 = 2;
                 if (unlikely(__pyx_t_34 != -1)) {
                   __Pyx_RaiseBufferIndexError(__pyx_t_34);
-                  __PYX_ERR(0, 439, __pyx_L1_error)
+                  __PYX_ERR(0, 496, __pyx_L1_error)
                 }
-                if (unlikely(!__pyx_v_logarr_2d.memview)) { __Pyx_RaiseUnboundLocalError("logarr_2d"); __PYX_ERR(0, 439, __pyx_L1_error) }
+                if (unlikely(!__pyx_v_logarr_2d.memview)) { __Pyx_RaiseUnboundLocalError("logarr_2d"); __PYX_ERR(0, 496, __pyx_L1_error) }
                 __pyx_t_35 = __pyx_v_o1;
                 __pyx_t_36 = __pyx_v_o2;
                 __pyx_t_34 = -1;
                 if (__pyx_t_35 < 0) {
                   __pyx_t_35 += __pyx_v_logarr_2d.shape[0];
                   if (unlikely(__pyx_t_35 < 0)) __pyx_t_34 = 0;
                 } else if (unlikely(__pyx_t_35 >= __pyx_v_logarr_2d.shape[0])) __pyx_t_34 = 0;
                 if (__pyx_t_36 < 0) {
                   __pyx_t_36 += __pyx_v_logarr_2d.shape[1];
                   if (unlikely(__pyx_t_36 < 0)) __pyx_t_34 = 1;
                 } else if (unlikely(__pyx_t_36 >= __pyx_v_logarr_2d.shape[1])) __pyx_t_34 = 1;
                 if (unlikely(__pyx_t_34 != -1)) {
                   __Pyx_RaiseBufferIndexError(__pyx_t_34);
-                  __PYX_ERR(0, 439, __pyx_L1_error)
+                  __PYX_ERR(0, 496, __pyx_L1_error)
                 }
                 __pyx_v_value = ((*((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_tr.data + __pyx_t_32 * __pyx_v_tr.strides[0]) ) + __pyx_t_33 * __pyx_v_tr.strides[1]) ) + __pyx_t_31 * __pyx_v_tr.strides[2]) ))) + (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_logarr_2d.data + __pyx_t_35 * __pyx_v_logarr_2d.strides[0]) ) + __pyx_t_36 * __pyx_v_logarr_2d.strides[1]) ))));
               }
               __pyx_L40:;
 
-              /* "soapcw/soapcw.pyx":440
+              /* "soapcw/soapcw.pyx":497
  *                                     o2 = obs2_ind_2d[0][i+m-sep_dist]
  *                                     value = tr[1][k][m] + logarr_2d[o1,o2]
  *                                 if value > temp:             # <<<<<<<<<<<<<<
  *                                     temp = value
  *                                     val[0][i] = temp
  */
               __pyx_t_17 = ((__pyx_v_value > __pyx_v_temp) != 0);
               if (__pyx_t_17) {
 
-                /* "soapcw/soapcw.pyx":441
+                /* "soapcw/soapcw.pyx":498
  *                                     value = tr[1][k][m] + logarr_2d[o1,o2]
  *                                 if value > temp:
  *                                     temp = value             # <<<<<<<<<<<<<<
  *                                     val[0][i] = temp
  *                                     prev[0][i] =  i
  */
                 __pyx_v_temp = __pyx_v_value;
 
-                /* "soapcw/soapcw.pyx":442
+                /* "soapcw/soapcw.pyx":499
  *                                 if value > temp:
  *                                     temp = value
  *                                     val[0][i] = temp             # <<<<<<<<<<<<<<
  *                                     prev[0][i] =  i
  *                                     det1[0][i] =  i+k-1
  */
                 __pyx_t_36 = 0;
@@ -10878,19 +11216,19 @@
                 } else if (unlikely(__pyx_t_36 >= __pyx_v_val.shape[0])) __pyx_t_34 = 0;
                 if (__pyx_t_35 < 0) {
                   __pyx_t_35 += __pyx_v_val.shape[1];
                   if (unlikely(__pyx_t_35 < 0)) __pyx_t_34 = 1;
                 } else if (unlikely(__pyx_t_35 >= __pyx_v_val.shape[1])) __pyx_t_34 = 1;
                 if (unlikely(__pyx_t_34 != -1)) {
                   __Pyx_RaiseBufferIndexError(__pyx_t_34);
-                  __PYX_ERR(0, 442, __pyx_L1_error)
+                  __PYX_ERR(0, 499, __pyx_L1_error)
                 }
                 *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_val.data + __pyx_t_36 * __pyx_v_val.strides[0]) ) + __pyx_t_35 * __pyx_v_val.strides[1]) )) = __pyx_v_temp;
 
-                /* "soapcw/soapcw.pyx":443
+                /* "soapcw/soapcw.pyx":500
  *                                     temp = value
  *                                     val[0][i] = temp
  *                                     prev[0][i] =  i             # <<<<<<<<<<<<<<
  *                                     det1[0][i] =  i+k-1
  *                                     det2[0][i] =  i+m-1
  */
                 __pyx_t_35 = 0;
@@ -10902,19 +11240,19 @@
                 } else if (unlikely(__pyx_t_35 >= __pyx_v_prev.shape[0])) __pyx_t_34 = 0;
                 if (__pyx_t_36 < 0) {
                   __pyx_t_36 += __pyx_v_prev.shape[1];
                   if (unlikely(__pyx_t_36 < 0)) __pyx_t_34 = 1;
                 } else if (unlikely(__pyx_t_36 >= __pyx_v_prev.shape[1])) __pyx_t_34 = 1;
                 if (unlikely(__pyx_t_34 != -1)) {
                   __Pyx_RaiseBufferIndexError(__pyx_t_34);
-                  __PYX_ERR(0, 443, __pyx_L1_error)
+                  __PYX_ERR(0, 500, __pyx_L1_error)
                 }
                 *((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_prev.data + __pyx_t_35 * __pyx_v_prev.strides[0]) ) + __pyx_t_36 * __pyx_v_prev.strides[1]) )) = __pyx_v_i;
 
-                /* "soapcw/soapcw.pyx":444
+                /* "soapcw/soapcw.pyx":501
  *                                     val[0][i] = temp
  *                                     prev[0][i] =  i
  *                                     det1[0][i] =  i+k-1             # <<<<<<<<<<<<<<
  *                                     det2[0][i] =  i+m-1
  *                                 else:
  */
                 __pyx_t_36 = 0;
@@ -10926,19 +11264,19 @@
                 } else if (unlikely(__pyx_t_36 >= __pyx_v_det1.shape[0])) __pyx_t_34 = 0;
                 if (__pyx_t_35 < 0) {
                   __pyx_t_35 += __pyx_v_det1.shape[1];
                   if (unlikely(__pyx_t_35 < 0)) __pyx_t_34 = 1;
                 } else if (unlikely(__pyx_t_35 >= __pyx_v_det1.shape[1])) __pyx_t_34 = 1;
                 if (unlikely(__pyx_t_34 != -1)) {
                   __Pyx_RaiseBufferIndexError(__pyx_t_34);
-                  __PYX_ERR(0, 444, __pyx_L1_error)
+                  __PYX_ERR(0, 501, __pyx_L1_error)
                 }
                 *((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_det1.data + __pyx_t_36 * __pyx_v_det1.strides[0]) ) + __pyx_t_35 * __pyx_v_det1.strides[1]) )) = ((__pyx_v_i + __pyx_v_k) - 1);
 
-                /* "soapcw/soapcw.pyx":445
+                /* "soapcw/soapcw.pyx":502
  *                                     prev[0][i] =  i
  *                                     det1[0][i] =  i+k-1
  *                                     det2[0][i] =  i+m-1             # <<<<<<<<<<<<<<
  *                                 else:
  *                                     continue
  */
                 __pyx_t_35 = 0;
@@ -10950,134 +11288,134 @@
                 } else if (unlikely(__pyx_t_35 >= __pyx_v_det2.shape[0])) __pyx_t_34 = 0;
                 if (__pyx_t_36 < 0) {
                   __pyx_t_36 += __pyx_v_det2.shape[1];
                   if (unlikely(__pyx_t_36 < 0)) __pyx_t_34 = 1;
                 } else if (unlikely(__pyx_t_36 >= __pyx_v_det2.shape[1])) __pyx_t_34 = 1;
                 if (unlikely(__pyx_t_34 != -1)) {
                   __Pyx_RaiseBufferIndexError(__pyx_t_34);
-                  __PYX_ERR(0, 445, __pyx_L1_error)
+                  __PYX_ERR(0, 502, __pyx_L1_error)
                 }
                 *((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_det2.data + __pyx_t_35 * __pyx_v_det2.strides[0]) ) + __pyx_t_36 * __pyx_v_det2.strides[1]) )) = ((__pyx_v_i + __pyx_v_m) - 1);
 
-                /* "soapcw/soapcw.pyx":440
+                /* "soapcw/soapcw.pyx":497
  *                                     o2 = obs2_ind_2d[0][i+m-sep_dist]
  *                                     value = tr[1][k][m] + logarr_2d[o1,o2]
  *                                 if value > temp:             # <<<<<<<<<<<<<<
  *                                     temp = value
  *                                     val[0][i] = temp
  */
                 goto __pyx_L41;
               }
 
-              /* "soapcw/soapcw.pyx":447
+              /* "soapcw/soapcw.pyx":504
  *                                     det2[0][i] =  i+m-1
  *                                 else:
  *                                     continue             # <<<<<<<<<<<<<<
  * 
  *             elif obs1data[0] and not obs2data[0]:
  */
               /*else*/ {
                 goto __pyx_L35_continue;
               }
               __pyx_L41:;
 
-              /* "soapcw/soapcw.pyx":433
+              /* "soapcw/soapcw.pyx":490
  *                     if i+k-sep_dist>=0+edge_range and i+k-sep_dist<width-edge_range:
  *                         for m in range(sep_len):
  *                             if i+m-sep_dist>=0+edge_range and i+m-sep_dist<width-edge_range:             # <<<<<<<<<<<<<<
  *                                 if sumv:
  *                                     value = tr[1][k][m] + obs1[0][i+k-sep_dist] + obs2[0][i+k-sep_dist]
  */
             }
             __pyx_L35_continue:;
           }
 
-          /* "soapcw/soapcw.pyx":431
+          /* "soapcw/soapcw.pyx":488
  *                 # if data in both detectors
  *                 for k in range(sep_len):
  *                     if i+k-sep_dist>=0+edge_range and i+k-sep_dist<width-edge_range:             # <<<<<<<<<<<<<<
  *                         for m in range(sep_len):
  *                             if i+m-sep_dist>=0+edge_range and i+m-sep_dist<width-edge_range:
  */
         }
       }
 
-      /* "soapcw/soapcw.pyx":428
+      /* "soapcw/soapcw.pyx":485
  *         for i in range(width):
  *             temp = -1e6
  *             if obs1data[0] and obs2data[0]:             # <<<<<<<<<<<<<<
  *                 # if data in both detectors
  *                 for k in range(sep_len):
  */
       goto __pyx_L27;
     }
 
-    /* "soapcw/soapcw.pyx":449
+    /* "soapcw/soapcw.pyx":506
  *                                     continue
  * 
  *             elif obs1data[0] and not obs2data[0]:             # <<<<<<<<<<<<<<
  *                 o1 = obs1_ind_1d[0][i]
  *                 k,m = 1,1
  */
-    __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_obs1data, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 449, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_obs1data, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 506, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_16 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_16 < 0)) __PYX_ERR(0, 449, __pyx_L1_error)
+    __pyx_t_16 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_16 < 0)) __PYX_ERR(0, 506, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     if (__pyx_t_16) {
     } else {
       __pyx_t_17 = __pyx_t_16;
       goto __pyx_L42_bool_binop_done;
     }
-    __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_obs2data, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 449, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_obs2data, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 506, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_16 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_16 < 0)) __PYX_ERR(0, 449, __pyx_L1_error)
+    __pyx_t_16 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_16 < 0)) __PYX_ERR(0, 506, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __pyx_t_21 = ((!__pyx_t_16) != 0);
     __pyx_t_17 = __pyx_t_21;
     __pyx_L42_bool_binop_done:;
     if (__pyx_t_17) {
 
-      /* "soapcw/soapcw.pyx":450
+      /* "soapcw/soapcw.pyx":507
  * 
  *             elif obs1data[0] and not obs2data[0]:
  *                 o1 = obs1_ind_1d[0][i]             # <<<<<<<<<<<<<<
  *                 k,m = 1,1
  *                 value = tr[1][k][m] + logarr_1d[o1]
  */
-      if (unlikely(!__pyx_v_obs1_ind_1d.memview)) { __Pyx_RaiseUnboundLocalError("obs1_ind_1d"); __PYX_ERR(0, 450, __pyx_L1_error) }
+      if (unlikely(!__pyx_v_obs1_ind_1d.memview)) { __Pyx_RaiseUnboundLocalError("obs1_ind_1d"); __PYX_ERR(0, 507, __pyx_L1_error) }
       __pyx_t_36 = 0;
       __pyx_t_35 = __pyx_v_i;
       __pyx_t_25 = -1;
       if (__pyx_t_36 < 0) {
         __pyx_t_36 += __pyx_v_obs1_ind_1d.shape[0];
         if (unlikely(__pyx_t_36 < 0)) __pyx_t_25 = 0;
       } else if (unlikely(__pyx_t_36 >= __pyx_v_obs1_ind_1d.shape[0])) __pyx_t_25 = 0;
       if (__pyx_t_35 < 0) {
         __pyx_t_35 += __pyx_v_obs1_ind_1d.shape[1];
         if (unlikely(__pyx_t_35 < 0)) __pyx_t_25 = 1;
       } else if (unlikely(__pyx_t_35 >= __pyx_v_obs1_ind_1d.shape[1])) __pyx_t_25 = 1;
       if (unlikely(__pyx_t_25 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_25);
-        __PYX_ERR(0, 450, __pyx_L1_error)
+        __PYX_ERR(0, 507, __pyx_L1_error)
       }
       __pyx_v_o1 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_obs1_ind_1d.data + __pyx_t_36 * __pyx_v_obs1_ind_1d.strides[0]) ) + __pyx_t_35 * __pyx_v_obs1_ind_1d.strides[1]) )));
 
-      /* "soapcw/soapcw.pyx":451
+      /* "soapcw/soapcw.pyx":508
  *             elif obs1data[0] and not obs2data[0]:
  *                 o1 = obs1_ind_1d[0][i]
  *                 k,m = 1,1             # <<<<<<<<<<<<<<
  *                 value = tr[1][k][m] + logarr_1d[o1]
  *             elif obs2data[0] and not obs1data[0]:
  */
       __pyx_t_25 = 1;
       __pyx_t_26 = 1;
       __pyx_v_k = __pyx_t_25;
       __pyx_v_m = __pyx_t_26;
 
-      /* "soapcw/soapcw.pyx":452
+      /* "soapcw/soapcw.pyx":509
  *                 o1 = obs1_ind_1d[0][i]
  *                 k,m = 1,1
  *                 value = tr[1][k][m] + logarr_1d[o1]             # <<<<<<<<<<<<<<
  *             elif obs2data[0] and not obs1data[0]:
  *                 o2 = obs2_ind_1d[0][i]
  */
       __pyx_t_35 = 1;
@@ -11094,94 +11432,94 @@
       } else if (unlikely(__pyx_t_36 >= __pyx_v_tr.shape[1])) __pyx_t_26 = 1;
       if (__pyx_t_31 < 0) {
         __pyx_t_31 += __pyx_v_tr.shape[2];
         if (unlikely(__pyx_t_31 < 0)) __pyx_t_26 = 2;
       } else if (unlikely(__pyx_t_31 >= __pyx_v_tr.shape[2])) __pyx_t_26 = 2;
       if (unlikely(__pyx_t_26 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_26);
-        __PYX_ERR(0, 452, __pyx_L1_error)
+        __PYX_ERR(0, 509, __pyx_L1_error)
       }
-      if (unlikely(!__pyx_v_logarr_1d.memview)) { __Pyx_RaiseUnboundLocalError("logarr_1d"); __PYX_ERR(0, 452, __pyx_L1_error) }
+      if (unlikely(!__pyx_v_logarr_1d.memview)) { __Pyx_RaiseUnboundLocalError("logarr_1d"); __PYX_ERR(0, 509, __pyx_L1_error) }
       __pyx_t_33 = __pyx_v_o1;
       __pyx_t_26 = -1;
       if (__pyx_t_33 < 0) {
         __pyx_t_33 += __pyx_v_logarr_1d.shape[0];
         if (unlikely(__pyx_t_33 < 0)) __pyx_t_26 = 0;
       } else if (unlikely(__pyx_t_33 >= __pyx_v_logarr_1d.shape[0])) __pyx_t_26 = 0;
       if (unlikely(__pyx_t_26 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_26);
-        __PYX_ERR(0, 452, __pyx_L1_error)
+        __PYX_ERR(0, 509, __pyx_L1_error)
       }
       __pyx_v_value = ((*((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_tr.data + __pyx_t_35 * __pyx_v_tr.strides[0]) ) + __pyx_t_36 * __pyx_v_tr.strides[1]) ) + __pyx_t_31 * __pyx_v_tr.strides[2]) ))) + (*((double *) ( /* dim=0 */ (__pyx_v_logarr_1d.data + __pyx_t_33 * __pyx_v_logarr_1d.strides[0]) ))));
 
-      /* "soapcw/soapcw.pyx":449
+      /* "soapcw/soapcw.pyx":506
  *                                     continue
  * 
  *             elif obs1data[0] and not obs2data[0]:             # <<<<<<<<<<<<<<
  *                 o1 = obs1_ind_1d[0][i]
  *                 k,m = 1,1
  */
       goto __pyx_L27;
     }
 
-    /* "soapcw/soapcw.pyx":453
+    /* "soapcw/soapcw.pyx":510
  *                 k,m = 1,1
  *                 value = tr[1][k][m] + logarr_1d[o1]
  *             elif obs2data[0] and not obs1data[0]:             # <<<<<<<<<<<<<<
  *                 o2 = obs2_ind_1d[0][i]
  *                 k,m = 1,1
  */
-    __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_obs2data, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 453, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_obs2data, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 510, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_21 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_21 < 0)) __PYX_ERR(0, 453, __pyx_L1_error)
+    __pyx_t_21 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_21 < 0)) __PYX_ERR(0, 510, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     if (__pyx_t_21) {
     } else {
       __pyx_t_17 = __pyx_t_21;
       goto __pyx_L44_bool_binop_done;
     }
-    __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_obs1data, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 453, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_obs1data, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 510, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_21 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_21 < 0)) __PYX_ERR(0, 453, __pyx_L1_error)
+    __pyx_t_21 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_21 < 0)) __PYX_ERR(0, 510, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __pyx_t_16 = ((!__pyx_t_21) != 0);
     __pyx_t_17 = __pyx_t_16;
     __pyx_L44_bool_binop_done:;
     if (__pyx_t_17) {
 
-      /* "soapcw/soapcw.pyx":454
+      /* "soapcw/soapcw.pyx":511
  *                 value = tr[1][k][m] + logarr_1d[o1]
  *             elif obs2data[0] and not obs1data[0]:
  *                 o2 = obs2_ind_1d[0][i]             # <<<<<<<<<<<<<<
  *                 k,m = 1,1
  *                 value = tr[1][k][m] + logarr_1d[o2]
  */
-      if (unlikely(!__pyx_v_obs2_ind_1d)) { __Pyx_RaiseUnboundLocalError("obs2_ind_1d"); __PYX_ERR(0, 454, __pyx_L1_error) }
-      __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_obs2_ind_1d, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 454, __pyx_L1_error)
+      if (unlikely(!__pyx_v_obs2_ind_1d)) { __Pyx_RaiseUnboundLocalError("obs2_ind_1d"); __PYX_ERR(0, 511, __pyx_L1_error) }
+      __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_obs2_ind_1d, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 511, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
-      __pyx_t_3 = __Pyx_GetItemInt(__pyx_t_2, __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 454, __pyx_L1_error)
+      __pyx_t_3 = __Pyx_GetItemInt(__pyx_t_2, __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 511, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
       __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-      __pyx_t_26 = __Pyx_PyInt_As_int(__pyx_t_3); if (unlikely((__pyx_t_26 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 454, __pyx_L1_error)
+      __pyx_t_26 = __Pyx_PyInt_As_int(__pyx_t_3); if (unlikely((__pyx_t_26 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 511, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
       __pyx_v_o2 = __pyx_t_26;
 
-      /* "soapcw/soapcw.pyx":455
+      /* "soapcw/soapcw.pyx":512
  *             elif obs2data[0] and not obs1data[0]:
  *                 o2 = obs2_ind_1d[0][i]
  *                 k,m = 1,1             # <<<<<<<<<<<<<<
  *                 value = tr[1][k][m] + logarr_1d[o2]
  *             elif not obs2data[0] and not obs1data[0]:
  */
       __pyx_t_26 = 1;
       __pyx_t_25 = 1;
       __pyx_v_k = __pyx_t_26;
       __pyx_v_m = __pyx_t_25;
 
-      /* "soapcw/soapcw.pyx":456
+      /* "soapcw/soapcw.pyx":513
  *                 o2 = obs2_ind_1d[0][i]
  *                 k,m = 1,1
  *                 value = tr[1][k][m] + logarr_1d[o2]             # <<<<<<<<<<<<<<
  *             elif not obs2data[0] and not obs1data[0]:
  *                 o1 = obs1_ind_2d[0][i]
  */
       __pyx_t_33 = 1;
@@ -11198,103 +11536,103 @@
       } else if (unlikely(__pyx_t_31 >= __pyx_v_tr.shape[1])) __pyx_t_25 = 1;
       if (__pyx_t_36 < 0) {
         __pyx_t_36 += __pyx_v_tr.shape[2];
         if (unlikely(__pyx_t_36 < 0)) __pyx_t_25 = 2;
       } else if (unlikely(__pyx_t_36 >= __pyx_v_tr.shape[2])) __pyx_t_25 = 2;
       if (unlikely(__pyx_t_25 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_25);
-        __PYX_ERR(0, 456, __pyx_L1_error)
+        __PYX_ERR(0, 513, __pyx_L1_error)
       }
-      if (unlikely(!__pyx_v_logarr_1d.memview)) { __Pyx_RaiseUnboundLocalError("logarr_1d"); __PYX_ERR(0, 456, __pyx_L1_error) }
+      if (unlikely(!__pyx_v_logarr_1d.memview)) { __Pyx_RaiseUnboundLocalError("logarr_1d"); __PYX_ERR(0, 513, __pyx_L1_error) }
       __pyx_t_35 = __pyx_v_o2;
       __pyx_t_25 = -1;
       if (__pyx_t_35 < 0) {
         __pyx_t_35 += __pyx_v_logarr_1d.shape[0];
         if (unlikely(__pyx_t_35 < 0)) __pyx_t_25 = 0;
       } else if (unlikely(__pyx_t_35 >= __pyx_v_logarr_1d.shape[0])) __pyx_t_25 = 0;
       if (unlikely(__pyx_t_25 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_25);
-        __PYX_ERR(0, 456, __pyx_L1_error)
+        __PYX_ERR(0, 513, __pyx_L1_error)
       }
       __pyx_v_value = ((*((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_tr.data + __pyx_t_33 * __pyx_v_tr.strides[0]) ) + __pyx_t_31 * __pyx_v_tr.strides[1]) ) + __pyx_t_36 * __pyx_v_tr.strides[2]) ))) + (*((double *) ( /* dim=0 */ (__pyx_v_logarr_1d.data + __pyx_t_35 * __pyx_v_logarr_1d.strides[0]) ))));
 
-      /* "soapcw/soapcw.pyx":453
+      /* "soapcw/soapcw.pyx":510
  *                 k,m = 1,1
  *                 value = tr[1][k][m] + logarr_1d[o1]
  *             elif obs2data[0] and not obs1data[0]:             # <<<<<<<<<<<<<<
  *                 o2 = obs2_ind_1d[0][i]
  *                 k,m = 1,1
  */
       goto __pyx_L27;
     }
 
-    /* "soapcw/soapcw.pyx":457
+    /* "soapcw/soapcw.pyx":514
  *                 k,m = 1,1
  *                 value = tr[1][k][m] + logarr_1d[o2]
  *             elif not obs2data[0] and not obs1data[0]:             # <<<<<<<<<<<<<<
  *                 o1 = obs1_ind_2d[0][i]
  *                 k,m = 1,1
  */
-    __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_obs2data, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 457, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_obs2data, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 514, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_16 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_16 < 0)) __PYX_ERR(0, 457, __pyx_L1_error)
+    __pyx_t_16 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_16 < 0)) __PYX_ERR(0, 514, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_t_21 = ((!__pyx_t_16) != 0);
     if (__pyx_t_21) {
     } else {
       __pyx_t_17 = __pyx_t_21;
       goto __pyx_L46_bool_binop_done;
     }
-    __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_obs1data, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 457, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_obs1data, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 514, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_21 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_21 < 0)) __PYX_ERR(0, 457, __pyx_L1_error)
+    __pyx_t_21 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_21 < 0)) __PYX_ERR(0, 514, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_t_16 = ((!__pyx_t_21) != 0);
     __pyx_t_17 = __pyx_t_16;
     __pyx_L46_bool_binop_done:;
     if (__pyx_t_17) {
 
-      /* "soapcw/soapcw.pyx":458
+      /* "soapcw/soapcw.pyx":515
  *                 value = tr[1][k][m] + logarr_1d[o2]
  *             elif not obs2data[0] and not obs1data[0]:
  *                 o1 = obs1_ind_2d[0][i]             # <<<<<<<<<<<<<<
  *                 k,m = 1,1
  *                 value = tr[1][k][m] + logarr_1d[o1]
  */
-      if (unlikely(!__pyx_v_obs1_ind_2d.memview)) { __Pyx_RaiseUnboundLocalError("obs1_ind_2d"); __PYX_ERR(0, 458, __pyx_L1_error) }
+      if (unlikely(!__pyx_v_obs1_ind_2d.memview)) { __Pyx_RaiseUnboundLocalError("obs1_ind_2d"); __PYX_ERR(0, 515, __pyx_L1_error) }
       __pyx_t_35 = 0;
       __pyx_t_36 = __pyx_v_i;
       __pyx_t_25 = -1;
       if (__pyx_t_35 < 0) {
         __pyx_t_35 += __pyx_v_obs1_ind_2d.shape[0];
         if (unlikely(__pyx_t_35 < 0)) __pyx_t_25 = 0;
       } else if (unlikely(__pyx_t_35 >= __pyx_v_obs1_ind_2d.shape[0])) __pyx_t_25 = 0;
       if (__pyx_t_36 < 0) {
         __pyx_t_36 += __pyx_v_obs1_ind_2d.shape[1];
         if (unlikely(__pyx_t_36 < 0)) __pyx_t_25 = 1;
       } else if (unlikely(__pyx_t_36 >= __pyx_v_obs1_ind_2d.shape[1])) __pyx_t_25 = 1;
       if (unlikely(__pyx_t_25 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_25);
-        __PYX_ERR(0, 458, __pyx_L1_error)
+        __PYX_ERR(0, 515, __pyx_L1_error)
       }
       __pyx_v_o1 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_obs1_ind_2d.data + __pyx_t_35 * __pyx_v_obs1_ind_2d.strides[0]) ) + __pyx_t_36 * __pyx_v_obs1_ind_2d.strides[1]) )));
 
-      /* "soapcw/soapcw.pyx":459
+      /* "soapcw/soapcw.pyx":516
  *             elif not obs2data[0] and not obs1data[0]:
  *                 o1 = obs1_ind_2d[0][i]
  *                 k,m = 1,1             # <<<<<<<<<<<<<<
  *                 value = tr[1][k][m] + logarr_1d[o1]
  * 
  */
       __pyx_t_25 = 1;
       __pyx_t_26 = 1;
       __pyx_v_k = __pyx_t_25;
       __pyx_v_m = __pyx_t_26;
 
-      /* "soapcw/soapcw.pyx":460
+      /* "soapcw/soapcw.pyx":517
  *                 o1 = obs1_ind_2d[0][i]
  *                 k,m = 1,1
  *                 value = tr[1][k][m] + logarr_1d[o1]             # <<<<<<<<<<<<<<
  * 
  * 
  */
       __pyx_t_36 = 1;
@@ -11311,59 +11649,59 @@
       } else if (unlikely(__pyx_t_35 >= __pyx_v_tr.shape[1])) __pyx_t_26 = 1;
       if (__pyx_t_31 < 0) {
         __pyx_t_31 += __pyx_v_tr.shape[2];
         if (unlikely(__pyx_t_31 < 0)) __pyx_t_26 = 2;
       } else if (unlikely(__pyx_t_31 >= __pyx_v_tr.shape[2])) __pyx_t_26 = 2;
       if (unlikely(__pyx_t_26 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_26);
-        __PYX_ERR(0, 460, __pyx_L1_error)
+        __PYX_ERR(0, 517, __pyx_L1_error)
       }
-      if (unlikely(!__pyx_v_logarr_1d.memview)) { __Pyx_RaiseUnboundLocalError("logarr_1d"); __PYX_ERR(0, 460, __pyx_L1_error) }
+      if (unlikely(!__pyx_v_logarr_1d.memview)) { __Pyx_RaiseUnboundLocalError("logarr_1d"); __PYX_ERR(0, 517, __pyx_L1_error) }
       __pyx_t_33 = __pyx_v_o1;
       __pyx_t_26 = -1;
       if (__pyx_t_33 < 0) {
         __pyx_t_33 += __pyx_v_logarr_1d.shape[0];
         if (unlikely(__pyx_t_33 < 0)) __pyx_t_26 = 0;
       } else if (unlikely(__pyx_t_33 >= __pyx_v_logarr_1d.shape[0])) __pyx_t_26 = 0;
       if (unlikely(__pyx_t_26 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_26);
-        __PYX_ERR(0, 460, __pyx_L1_error)
+        __PYX_ERR(0, 517, __pyx_L1_error)
       }
       __pyx_v_value = ((*((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_tr.data + __pyx_t_36 * __pyx_v_tr.strides[0]) ) + __pyx_t_35 * __pyx_v_tr.strides[1]) ) + __pyx_t_31 * __pyx_v_tr.strides[2]) ))) + (*((double *) ( /* dim=0 */ (__pyx_v_logarr_1d.data + __pyx_t_33 * __pyx_v_logarr_1d.strides[0]) ))));
 
-      /* "soapcw/soapcw.pyx":457
+      /* "soapcw/soapcw.pyx":514
  *                 k,m = 1,1
  *                 value = tr[1][k][m] + logarr_1d[o2]
  *             elif not obs2data[0] and not obs1data[0]:             # <<<<<<<<<<<<<<
  *                 o1 = obs1_ind_2d[0][i]
  *                 k,m = 1,1
  */
     }
     __pyx_L27:;
 
-    /* "soapcw/soapcw.pyx":463
+    /* "soapcw/soapcw.pyx":520
  * 
  * 
  *             if value > temp:             # <<<<<<<<<<<<<<
  *                 temp = value
  *                 val[0][i] = temp
  */
     __pyx_t_17 = ((__pyx_v_value > __pyx_v_temp) != 0);
     if (__pyx_t_17) {
 
-      /* "soapcw/soapcw.pyx":464
+      /* "soapcw/soapcw.pyx":521
  * 
  *             if value > temp:
  *                 temp = value             # <<<<<<<<<<<<<<
  *                 val[0][i] = temp
  *                 prev[0][i] =  i
  */
       __pyx_v_temp = __pyx_v_value;
 
-      /* "soapcw/soapcw.pyx":465
+      /* "soapcw/soapcw.pyx":522
  *             if value > temp:
  *                 temp = value
  *                 val[0][i] = temp             # <<<<<<<<<<<<<<
  *                 prev[0][i] =  i
  *                 det1[0][i] =  i+k-1
  */
       __pyx_t_33 = 0;
@@ -11375,19 +11713,19 @@
       } else if (unlikely(__pyx_t_33 >= __pyx_v_val.shape[0])) __pyx_t_26 = 0;
       if (__pyx_t_31 < 0) {
         __pyx_t_31 += __pyx_v_val.shape[1];
         if (unlikely(__pyx_t_31 < 0)) __pyx_t_26 = 1;
       } else if (unlikely(__pyx_t_31 >= __pyx_v_val.shape[1])) __pyx_t_26 = 1;
       if (unlikely(__pyx_t_26 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_26);
-        __PYX_ERR(0, 465, __pyx_L1_error)
+        __PYX_ERR(0, 522, __pyx_L1_error)
       }
       *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_val.data + __pyx_t_33 * __pyx_v_val.strides[0]) ) + __pyx_t_31 * __pyx_v_val.strides[1]) )) = __pyx_v_temp;
 
-      /* "soapcw/soapcw.pyx":466
+      /* "soapcw/soapcw.pyx":523
  *                 temp = value
  *                 val[0][i] = temp
  *                 prev[0][i] =  i             # <<<<<<<<<<<<<<
  *                 det1[0][i] =  i+k-1
  *                 det2[0][i] =  i+m-1
  */
       __pyx_t_31 = 0;
@@ -11399,19 +11737,19 @@
       } else if (unlikely(__pyx_t_31 >= __pyx_v_prev.shape[0])) __pyx_t_26 = 0;
       if (__pyx_t_33 < 0) {
         __pyx_t_33 += __pyx_v_prev.shape[1];
         if (unlikely(__pyx_t_33 < 0)) __pyx_t_26 = 1;
       } else if (unlikely(__pyx_t_33 >= __pyx_v_prev.shape[1])) __pyx_t_26 = 1;
       if (unlikely(__pyx_t_26 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_26);
-        __PYX_ERR(0, 466, __pyx_L1_error)
+        __PYX_ERR(0, 523, __pyx_L1_error)
       }
       *((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_prev.data + __pyx_t_31 * __pyx_v_prev.strides[0]) ) + __pyx_t_33 * __pyx_v_prev.strides[1]) )) = __pyx_v_i;
 
-      /* "soapcw/soapcw.pyx":467
+      /* "soapcw/soapcw.pyx":524
  *                 val[0][i] = temp
  *                 prev[0][i] =  i
  *                 det1[0][i] =  i+k-1             # <<<<<<<<<<<<<<
  *                 det2[0][i] =  i+m-1
  *             else:
  */
       __pyx_t_33 = 0;
@@ -11423,19 +11761,19 @@
       } else if (unlikely(__pyx_t_33 >= __pyx_v_det1.shape[0])) __pyx_t_26 = 0;
       if (__pyx_t_31 < 0) {
         __pyx_t_31 += __pyx_v_det1.shape[1];
         if (unlikely(__pyx_t_31 < 0)) __pyx_t_26 = 1;
       } else if (unlikely(__pyx_t_31 >= __pyx_v_det1.shape[1])) __pyx_t_26 = 1;
       if (unlikely(__pyx_t_26 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_26);
-        __PYX_ERR(0, 467, __pyx_L1_error)
+        __PYX_ERR(0, 524, __pyx_L1_error)
       }
       *((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_det1.data + __pyx_t_33 * __pyx_v_det1.strides[0]) ) + __pyx_t_31 * __pyx_v_det1.strides[1]) )) = ((__pyx_v_i + __pyx_v_k) - 1);
 
-      /* "soapcw/soapcw.pyx":468
+      /* "soapcw/soapcw.pyx":525
  *                 prev[0][i] =  i
  *                 det1[0][i] =  i+k-1
  *                 det2[0][i] =  i+m-1             # <<<<<<<<<<<<<<
  *             else:
  *                 continue
  */
       __pyx_t_31 = 0;
@@ -11447,121 +11785,121 @@
       } else if (unlikely(__pyx_t_31 >= __pyx_v_det2.shape[0])) __pyx_t_26 = 0;
       if (__pyx_t_33 < 0) {
         __pyx_t_33 += __pyx_v_det2.shape[1];
         if (unlikely(__pyx_t_33 < 0)) __pyx_t_26 = 1;
       } else if (unlikely(__pyx_t_33 >= __pyx_v_det2.shape[1])) __pyx_t_26 = 1;
       if (unlikely(__pyx_t_26 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_26);
-        __PYX_ERR(0, 468, __pyx_L1_error)
+        __PYX_ERR(0, 525, __pyx_L1_error)
       }
       *((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_det2.data + __pyx_t_31 * __pyx_v_det2.strides[0]) ) + __pyx_t_33 * __pyx_v_det2.strides[1]) )) = ((__pyx_v_i + __pyx_v_m) - 1);
 
-      /* "soapcw/soapcw.pyx":463
+      /* "soapcw/soapcw.pyx":520
  * 
  * 
  *             if value > temp:             # <<<<<<<<<<<<<<
  *                 temp = value
  *                 val[0][i] = temp
  */
       goto __pyx_L48;
     }
 
-    /* "soapcw/soapcw.pyx":470
+    /* "soapcw/soapcw.pyx":527
  *                 det2[0][i] =  i+m-1
  *             else:
  *                 continue             # <<<<<<<<<<<<<<
  * 
  *         # i is current frequency position
  */
     /*else*/ {
       goto __pyx_L25_continue;
     }
     __pyx_L48:;
     __pyx_L25_continue:;
   }
 
-  /* "soapcw/soapcw.pyx":478
+  /* "soapcw/soapcw.pyx":535
  * 
  *         # run main loop
  *         pbar = 0 # progressbar             # <<<<<<<<<<<<<<
  *         for t in range(1,length):
  *             pt = t/(float(length))*100. # progress bar status
  */
   __Pyx_INCREF(__pyx_int_0);
   __pyx_v_pbar = __pyx_int_0;
 
-  /* "soapcw/soapcw.pyx":479
+  /* "soapcw/soapcw.pyx":536
  *         # run main loop
  *         pbar = 0 # progressbar
  *         for t in range(1,length):             # <<<<<<<<<<<<<<
  *             pt = t/(float(length))*100. # progress bar status
  *             for i in range(width):
  */
   __pyx_t_22 = __pyx_v_length;
   __pyx_t_23 = __pyx_t_22;
   for (__pyx_t_24 = 1; __pyx_t_24 < __pyx_t_23; __pyx_t_24+=1) {
     __pyx_v_t = __pyx_t_24;
 
-    /* "soapcw/soapcw.pyx":480
+    /* "soapcw/soapcw.pyx":537
  *         pbar = 0 # progressbar
  *         for t in range(1,length):
  *             pt = t/(float(length))*100. # progress bar status             # <<<<<<<<<<<<<<
  *             for i in range(width):
  *                 temp = -np.inf
  */
     if (unlikely(((double)__pyx_v_length) == 0)) {
       PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-      __PYX_ERR(0, 480, __pyx_L1_error)
+      __PYX_ERR(0, 537, __pyx_L1_error)
     }
     __pyx_v_pt = ((((double)__pyx_v_t) / ((double)__pyx_v_length)) * 100.);
 
-    /* "soapcw/soapcw.pyx":481
+    /* "soapcw/soapcw.pyx":538
  *         for t in range(1,length):
  *             pt = t/(float(length))*100. # progress bar status
  *             for i in range(width):             # <<<<<<<<<<<<<<
  *                 temp = -np.inf
  *                 for j in range(tr_len):
  */
     __pyx_t_26 = __pyx_v_width;
     __pyx_t_25 = __pyx_t_26;
     for (__pyx_t_27 = 0; __pyx_t_27 < __pyx_t_25; __pyx_t_27+=1) {
       __pyx_v_i = __pyx_t_27;
 
-      /* "soapcw/soapcw.pyx":482
+      /* "soapcw/soapcw.pyx":539
  *             pt = t/(float(length))*100. # progress bar status
  *             for i in range(width):
  *                 temp = -np.inf             # <<<<<<<<<<<<<<
  *                 for j in range(tr_len):
  *                     if i+j-tr_dist>=0 and i+j-tr_dist<width:
  */
-      __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 482, __pyx_L1_error)
+      __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 539, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
-      __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_inf); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 482, __pyx_L1_error)
+      __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_inf); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 539, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-      __pyx_t_3 = PyNumber_Negative(__pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 482, __pyx_L1_error)
+      __pyx_t_3 = PyNumber_Negative(__pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 539, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
       __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-      __pyx_t_20 = __pyx_PyFloat_AsDouble(__pyx_t_3); if (unlikely((__pyx_t_20 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 482, __pyx_L1_error)
+      __pyx_t_20 = __pyx_PyFloat_AsDouble(__pyx_t_3); if (unlikely((__pyx_t_20 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 539, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
       __pyx_v_temp = __pyx_t_20;
 
-      /* "soapcw/soapcw.pyx":483
+      /* "soapcw/soapcw.pyx":540
  *             for i in range(width):
  *                 temp = -np.inf
  *                 for j in range(tr_len):             # <<<<<<<<<<<<<<
  *                     if i+j-tr_dist>=0 and i+j-tr_dist<width:
  *                         if obs1data[t] and obs2data[t]:
  */
       __pyx_t_28 = __pyx_v_tr_len;
       __pyx_t_29 = __pyx_t_28;
       for (__pyx_t_30 = 0; __pyx_t_30 < __pyx_t_29; __pyx_t_30+=1) {
         __pyx_v_j = __pyx_t_30;
 
-        /* "soapcw/soapcw.pyx":484
+        /* "soapcw/soapcw.pyx":541
  *                 temp = -np.inf
  *                 for j in range(tr_len):
  *                     if i+j-tr_dist>=0 and i+j-tr_dist<width:             # <<<<<<<<<<<<<<
  *                         if obs1data[t] and obs2data[t]:
  *                             for k in range(sep_len):
  */
         __pyx_t_16 = ((((__pyx_v_i + __pyx_v_j) - __pyx_v_tr_dist) >= 0) != 0);
@@ -11571,51 +11909,51 @@
           goto __pyx_L56_bool_binop_done;
         }
         __pyx_t_16 = ((((__pyx_v_i + __pyx_v_j) - __pyx_v_tr_dist) < __pyx_v_width) != 0);
         __pyx_t_17 = __pyx_t_16;
         __pyx_L56_bool_binop_done:;
         if (__pyx_t_17) {
 
-          /* "soapcw/soapcw.pyx":485
+          /* "soapcw/soapcw.pyx":542
  *                 for j in range(tr_len):
  *                     if i+j-tr_dist>=0 and i+j-tr_dist<width:
  *                         if obs1data[t] and obs2data[t]:             # <<<<<<<<<<<<<<
  *                             for k in range(sep_len):
  *                                 if i+k-sep_dist>=0+edge_range and i+k-sep_dist<width-edge_range:
  */
-          __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_obs1data, __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 485, __pyx_L1_error)
+          __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_obs1data, __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 542, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_3);
-          __pyx_t_16 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_16 < 0)) __PYX_ERR(0, 485, __pyx_L1_error)
+          __pyx_t_16 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_16 < 0)) __PYX_ERR(0, 542, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
           if (__pyx_t_16) {
           } else {
             __pyx_t_17 = __pyx_t_16;
             goto __pyx_L59_bool_binop_done;
           }
-          __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_obs2data, __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 485, __pyx_L1_error)
+          __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_obs2data, __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 542, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_3);
-          __pyx_t_16 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_16 < 0)) __PYX_ERR(0, 485, __pyx_L1_error)
+          __pyx_t_16 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_16 < 0)) __PYX_ERR(0, 542, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
           __pyx_t_17 = __pyx_t_16;
           __pyx_L59_bool_binop_done:;
           if (__pyx_t_17) {
 
-            /* "soapcw/soapcw.pyx":486
+            /* "soapcw/soapcw.pyx":543
  *                     if i+j-tr_dist>=0 and i+j-tr_dist<width:
  *                         if obs1data[t] and obs2data[t]:
  *                             for k in range(sep_len):             # <<<<<<<<<<<<<<
  *                                 if i+k-sep_dist>=0+edge_range and i+k-sep_dist<width-edge_range:
  *                                     for m in range(sep_len):
  */
             __pyx_t_34 = __pyx_v_sep_len;
             __pyx_t_37 = __pyx_t_34;
             for (__pyx_t_38 = 0; __pyx_t_38 < __pyx_t_37; __pyx_t_38+=1) {
               __pyx_v_k = __pyx_t_38;
 
-              /* "soapcw/soapcw.pyx":487
+              /* "soapcw/soapcw.pyx":544
  *                         if obs1data[t] and obs2data[t]:
  *                             for k in range(sep_len):
  *                                 if i+k-sep_dist>=0+edge_range and i+k-sep_dist<width-edge_range:             # <<<<<<<<<<<<<<
  *                                     for m in range(sep_len):
  *                                         if i+m-sep_dist>=0+edge_range and i+m-sep_dist<width-edge_range:
  */
               __pyx_t_16 = ((((__pyx_v_i + __pyx_v_k) - __pyx_v_sep_dist) >= (0 + __pyx_v_edge_range)) != 0);
@@ -11625,27 +11963,27 @@
                 goto __pyx_L64_bool_binop_done;
               }
               __pyx_t_16 = ((((__pyx_v_i + __pyx_v_k) - __pyx_v_sep_dist) < (__pyx_v_width - __pyx_v_edge_range)) != 0);
               __pyx_t_17 = __pyx_t_16;
               __pyx_L64_bool_binop_done:;
               if (__pyx_t_17) {
 
-                /* "soapcw/soapcw.pyx":488
+                /* "soapcw/soapcw.pyx":545
  *                             for k in range(sep_len):
  *                                 if i+k-sep_dist>=0+edge_range and i+k-sep_dist<width-edge_range:
  *                                     for m in range(sep_len):             # <<<<<<<<<<<<<<
  *                                         if i+m-sep_dist>=0+edge_range and i+m-sep_dist<width-edge_range:
  *                                             if sumv:
  */
                 __pyx_t_39 = __pyx_v_sep_len;
                 __pyx_t_40 = __pyx_t_39;
                 for (__pyx_t_41 = 0; __pyx_t_41 < __pyx_t_40; __pyx_t_41+=1) {
                   __pyx_v_m = __pyx_t_41;
 
-                  /* "soapcw/soapcw.pyx":489
+                  /* "soapcw/soapcw.pyx":546
  *                                 if i+k-sep_dist>=0+edge_range and i+k-sep_dist<width-edge_range:
  *                                     for m in range(sep_len):
  *                                         if i+m-sep_dist>=0+edge_range and i+m-sep_dist<width-edge_range:             # <<<<<<<<<<<<<<
  *                                             if sumv:
  *                                                 value = tr[j][k][m] + obs1[t][i+k-sep_dist] + obs2[t][i+k-sep_dist] + val[t-1][i+j-tr_dist]
  */
                   __pyx_t_16 = ((((__pyx_v_i + __pyx_v_m) - __pyx_v_sep_dist) >= (0 + __pyx_v_edge_range)) != 0);
@@ -11655,25 +11993,25 @@
                     goto __pyx_L69_bool_binop_done;
                   }
                   __pyx_t_16 = ((((__pyx_v_i + __pyx_v_m) - __pyx_v_sep_dist) < (__pyx_v_width - __pyx_v_edge_range)) != 0);
                   __pyx_t_17 = __pyx_t_16;
                   __pyx_L69_bool_binop_done:;
                   if (__pyx_t_17) {
 
-                    /* "soapcw/soapcw.pyx":490
+                    /* "soapcw/soapcw.pyx":547
  *                                     for m in range(sep_len):
  *                                         if i+m-sep_dist>=0+edge_range and i+m-sep_dist<width-edge_range:
  *                                             if sumv:             # <<<<<<<<<<<<<<
  *                                                 value = tr[j][k][m] + obs1[t][i+k-sep_dist] + obs2[t][i+k-sep_dist] + val[t-1][i+j-tr_dist]
  *                                             else:
  */
                     __pyx_t_17 = (__pyx_v_sumv != 0);
                     if (__pyx_t_17) {
 
-                      /* "soapcw/soapcw.pyx":491
+                      /* "soapcw/soapcw.pyx":548
  *                                         if i+m-sep_dist>=0+edge_range and i+m-sep_dist<width-edge_range:
  *                                             if sumv:
  *                                                 value = tr[j][k][m] + obs1[t][i+k-sep_dist] + obs2[t][i+k-sep_dist] + val[t-1][i+j-tr_dist]             # <<<<<<<<<<<<<<
  *                                             else:
  *                                                 o1 = obs1_ind_2d[t][i+k-sep_dist]
  */
                       __pyx_t_33 = __pyx_v_j;
@@ -11690,35 +12028,35 @@
                       } else if (unlikely(__pyx_t_31 >= __pyx_v_tr.shape[1])) __pyx_t_42 = 1;
                       if (__pyx_t_35 < 0) {
                         __pyx_t_35 += __pyx_v_tr.shape[2];
                         if (unlikely(__pyx_t_35 < 0)) __pyx_t_42 = 2;
                       } else if (unlikely(__pyx_t_35 >= __pyx_v_tr.shape[2])) __pyx_t_42 = 2;
                       if (unlikely(__pyx_t_42 != -1)) {
                         __Pyx_RaiseBufferIndexError(__pyx_t_42);
-                        __PYX_ERR(0, 491, __pyx_L1_error)
+                        __PYX_ERR(0, 548, __pyx_L1_error)
                       }
-                      __pyx_t_3 = PyFloat_FromDouble((*((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_tr.data + __pyx_t_33 * __pyx_v_tr.strides[0]) ) + __pyx_t_31 * __pyx_v_tr.strides[1]) ) + __pyx_t_35 * __pyx_v_tr.strides[2]) )))); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 491, __pyx_L1_error)
+                      __pyx_t_3 = PyFloat_FromDouble((*((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_tr.data + __pyx_t_33 * __pyx_v_tr.strides[0]) ) + __pyx_t_31 * __pyx_v_tr.strides[1]) ) + __pyx_t_35 * __pyx_v_tr.strides[2]) )))); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 548, __pyx_L1_error)
                       __Pyx_GOTREF(__pyx_t_3);
-                      __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_obs1, __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 491, __pyx_L1_error)
+                      __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_obs1, __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 548, __pyx_L1_error)
                       __Pyx_GOTREF(__pyx_t_2);
                       __pyx_t_42 = ((__pyx_v_i + __pyx_v_k) - __pyx_v_sep_dist);
-                      __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_2, __pyx_t_42, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 491, __pyx_L1_error)
+                      __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_2, __pyx_t_42, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 548, __pyx_L1_error)
                       __Pyx_GOTREF(__pyx_t_4);
                       __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-                      __pyx_t_2 = PyNumber_Add(__pyx_t_3, __pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 491, __pyx_L1_error)
+                      __pyx_t_2 = PyNumber_Add(__pyx_t_3, __pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 548, __pyx_L1_error)
                       __Pyx_GOTREF(__pyx_t_2);
                       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
                       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-                      __pyx_t_4 = __Pyx_GetItemInt(__pyx_v_obs2, __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 491, __pyx_L1_error)
+                      __pyx_t_4 = __Pyx_GetItemInt(__pyx_v_obs2, __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 548, __pyx_L1_error)
                       __Pyx_GOTREF(__pyx_t_4);
                       __pyx_t_42 = ((__pyx_v_i + __pyx_v_k) - __pyx_v_sep_dist);
-                      __pyx_t_3 = __Pyx_GetItemInt(__pyx_t_4, __pyx_t_42, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 491, __pyx_L1_error)
+                      __pyx_t_3 = __Pyx_GetItemInt(__pyx_t_4, __pyx_t_42, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 548, __pyx_L1_error)
                       __Pyx_GOTREF(__pyx_t_3);
                       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-                      __pyx_t_4 = PyNumber_Add(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 491, __pyx_L1_error)
+                      __pyx_t_4 = PyNumber_Add(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 548, __pyx_L1_error)
                       __Pyx_GOTREF(__pyx_t_4);
                       __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
                       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
                       __pyx_t_35 = (__pyx_v_t - 1);
                       __pyx_t_31 = ((__pyx_v_i + __pyx_v_j) - __pyx_v_tr_dist);
                       __pyx_t_42 = -1;
                       if (__pyx_t_35 < 0) {
@@ -11727,81 +12065,81 @@
                       } else if (unlikely(__pyx_t_35 >= __pyx_v_val.shape[0])) __pyx_t_42 = 0;
                       if (__pyx_t_31 < 0) {
                         __pyx_t_31 += __pyx_v_val.shape[1];
                         if (unlikely(__pyx_t_31 < 0)) __pyx_t_42 = 1;
                       } else if (unlikely(__pyx_t_31 >= __pyx_v_val.shape[1])) __pyx_t_42 = 1;
                       if (unlikely(__pyx_t_42 != -1)) {
                         __Pyx_RaiseBufferIndexError(__pyx_t_42);
-                        __PYX_ERR(0, 491, __pyx_L1_error)
+                        __PYX_ERR(0, 548, __pyx_L1_error)
                       }
-                      __pyx_t_3 = PyFloat_FromDouble((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_val.data + __pyx_t_35 * __pyx_v_val.strides[0]) ) + __pyx_t_31 * __pyx_v_val.strides[1]) )))); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 491, __pyx_L1_error)
+                      __pyx_t_3 = PyFloat_FromDouble((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_val.data + __pyx_t_35 * __pyx_v_val.strides[0]) ) + __pyx_t_31 * __pyx_v_val.strides[1]) )))); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 548, __pyx_L1_error)
                       __Pyx_GOTREF(__pyx_t_3);
-                      __pyx_t_2 = PyNumber_Add(__pyx_t_4, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 491, __pyx_L1_error)
+                      __pyx_t_2 = PyNumber_Add(__pyx_t_4, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 548, __pyx_L1_error)
                       __Pyx_GOTREF(__pyx_t_2);
                       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
                       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-                      __pyx_t_20 = __pyx_PyFloat_AsDouble(__pyx_t_2); if (unlikely((__pyx_t_20 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 491, __pyx_L1_error)
+                      __pyx_t_20 = __pyx_PyFloat_AsDouble(__pyx_t_2); if (unlikely((__pyx_t_20 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 548, __pyx_L1_error)
                       __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
                       __pyx_v_value = __pyx_t_20;
 
-                      /* "soapcw/soapcw.pyx":490
+                      /* "soapcw/soapcw.pyx":547
  *                                     for m in range(sep_len):
  *                                         if i+m-sep_dist>=0+edge_range and i+m-sep_dist<width-edge_range:
  *                                             if sumv:             # <<<<<<<<<<<<<<
  *                                                 value = tr[j][k][m] + obs1[t][i+k-sep_dist] + obs2[t][i+k-sep_dist] + val[t-1][i+j-tr_dist]
  *                                             else:
  */
                       goto __pyx_L71;
                     }
 
-                    /* "soapcw/soapcw.pyx":493
+                    /* "soapcw/soapcw.pyx":550
  *                                                 value = tr[j][k][m] + obs1[t][i+k-sep_dist] + obs2[t][i+k-sep_dist] + val[t-1][i+j-tr_dist]
  *                                             else:
  *                                                 o1 = obs1_ind_2d[t][i+k-sep_dist]             # <<<<<<<<<<<<<<
  *                                                 o2 = obs2_ind_2d[t][i+m-sep_dist]
  *                                                 value = tr[j][k][m] + logarr_2d[o1,o2] + val[t-1][i+j-tr_dist]
  */
                     /*else*/ {
-                      if (unlikely(!__pyx_v_obs1_ind_2d.memview)) { __Pyx_RaiseUnboundLocalError("obs1_ind_2d"); __PYX_ERR(0, 493, __pyx_L1_error) }
+                      if (unlikely(!__pyx_v_obs1_ind_2d.memview)) { __Pyx_RaiseUnboundLocalError("obs1_ind_2d"); __PYX_ERR(0, 550, __pyx_L1_error) }
                       __pyx_t_31 = __pyx_v_t;
                       __pyx_t_35 = ((__pyx_v_i + __pyx_v_k) - __pyx_v_sep_dist);
                       __pyx_t_42 = -1;
                       if (__pyx_t_31 < 0) {
                         __pyx_t_31 += __pyx_v_obs1_ind_2d.shape[0];
                         if (unlikely(__pyx_t_31 < 0)) __pyx_t_42 = 0;
                       } else if (unlikely(__pyx_t_31 >= __pyx_v_obs1_ind_2d.shape[0])) __pyx_t_42 = 0;
                       if (__pyx_t_35 < 0) {
                         __pyx_t_35 += __pyx_v_obs1_ind_2d.shape[1];
                         if (unlikely(__pyx_t_35 < 0)) __pyx_t_42 = 1;
                       } else if (unlikely(__pyx_t_35 >= __pyx_v_obs1_ind_2d.shape[1])) __pyx_t_42 = 1;
                       if (unlikely(__pyx_t_42 != -1)) {
                         __Pyx_RaiseBufferIndexError(__pyx_t_42);
-                        __PYX_ERR(0, 493, __pyx_L1_error)
+                        __PYX_ERR(0, 550, __pyx_L1_error)
                       }
                       __pyx_v_o1 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_obs1_ind_2d.data + __pyx_t_31 * __pyx_v_obs1_ind_2d.strides[0]) ) + __pyx_t_35 * __pyx_v_obs1_ind_2d.strides[1]) )));
 
-                      /* "soapcw/soapcw.pyx":494
+                      /* "soapcw/soapcw.pyx":551
  *                                             else:
  *                                                 o1 = obs1_ind_2d[t][i+k-sep_dist]
  *                                                 o2 = obs2_ind_2d[t][i+m-sep_dist]             # <<<<<<<<<<<<<<
  *                                                 value = tr[j][k][m] + logarr_2d[o1,o2] + val[t-1][i+j-tr_dist]
  * 
  */
-                      if (unlikely(!__pyx_v_obs2_ind_2d)) { __Pyx_RaiseUnboundLocalError("obs2_ind_2d"); __PYX_ERR(0, 494, __pyx_L1_error) }
-                      __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_obs2_ind_2d, __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 494, __pyx_L1_error)
+                      if (unlikely(!__pyx_v_obs2_ind_2d)) { __Pyx_RaiseUnboundLocalError("obs2_ind_2d"); __PYX_ERR(0, 551, __pyx_L1_error) }
+                      __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_obs2_ind_2d, __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 551, __pyx_L1_error)
                       __Pyx_GOTREF(__pyx_t_2);
                       __pyx_t_42 = ((__pyx_v_i + __pyx_v_m) - __pyx_v_sep_dist);
-                      __pyx_t_3 = __Pyx_GetItemInt(__pyx_t_2, __pyx_t_42, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 494, __pyx_L1_error)
+                      __pyx_t_3 = __Pyx_GetItemInt(__pyx_t_2, __pyx_t_42, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 551, __pyx_L1_error)
                       __Pyx_GOTREF(__pyx_t_3);
                       __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-                      __pyx_t_42 = __Pyx_PyInt_As_int(__pyx_t_3); if (unlikely((__pyx_t_42 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 494, __pyx_L1_error)
+                      __pyx_t_42 = __Pyx_PyInt_As_int(__pyx_t_3); if (unlikely((__pyx_t_42 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 551, __pyx_L1_error)
                       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
                       __pyx_v_o2 = __pyx_t_42;
 
-                      /* "soapcw/soapcw.pyx":495
+                      /* "soapcw/soapcw.pyx":552
  *                                                 o1 = obs1_ind_2d[t][i+k-sep_dist]
  *                                                 o2 = obs2_ind_2d[t][i+m-sep_dist]
  *                                                 value = tr[j][k][m] + logarr_2d[o1,o2] + val[t-1][i+j-tr_dist]             # <<<<<<<<<<<<<<
  * 
  *                                             if value > temp:
  */
                       __pyx_t_35 = __pyx_v_j;
@@ -11818,71 +12156,71 @@
                       } else if (unlikely(__pyx_t_31 >= __pyx_v_tr.shape[1])) __pyx_t_42 = 1;
                       if (__pyx_t_33 < 0) {
                         __pyx_t_33 += __pyx_v_tr.shape[2];
                         if (unlikely(__pyx_t_33 < 0)) __pyx_t_42 = 2;
                       } else if (unlikely(__pyx_t_33 >= __pyx_v_tr.shape[2])) __pyx_t_42 = 2;
                       if (unlikely(__pyx_t_42 != -1)) {
                         __Pyx_RaiseBufferIndexError(__pyx_t_42);
-                        __PYX_ERR(0, 495, __pyx_L1_error)
+                        __PYX_ERR(0, 552, __pyx_L1_error)
                       }
-                      if (unlikely(!__pyx_v_logarr_2d.memview)) { __Pyx_RaiseUnboundLocalError("logarr_2d"); __PYX_ERR(0, 495, __pyx_L1_error) }
+                      if (unlikely(!__pyx_v_logarr_2d.memview)) { __Pyx_RaiseUnboundLocalError("logarr_2d"); __PYX_ERR(0, 552, __pyx_L1_error) }
                       __pyx_t_36 = __pyx_v_o1;
                       __pyx_t_32 = __pyx_v_o2;
                       __pyx_t_42 = -1;
                       if (__pyx_t_36 < 0) {
                         __pyx_t_36 += __pyx_v_logarr_2d.shape[0];
                         if (unlikely(__pyx_t_36 < 0)) __pyx_t_42 = 0;
                       } else if (unlikely(__pyx_t_36 >= __pyx_v_logarr_2d.shape[0])) __pyx_t_42 = 0;
                       if (__pyx_t_32 < 0) {
                         __pyx_t_32 += __pyx_v_logarr_2d.shape[1];
                         if (unlikely(__pyx_t_32 < 0)) __pyx_t_42 = 1;
                       } else if (unlikely(__pyx_t_32 >= __pyx_v_logarr_2d.shape[1])) __pyx_t_42 = 1;
                       if (unlikely(__pyx_t_42 != -1)) {
                         __Pyx_RaiseBufferIndexError(__pyx_t_42);
-                        __PYX_ERR(0, 495, __pyx_L1_error)
+                        __PYX_ERR(0, 552, __pyx_L1_error)
                       }
                       __pyx_t_43 = (__pyx_v_t - 1);
                       __pyx_t_44 = ((__pyx_v_i + __pyx_v_j) - __pyx_v_tr_dist);
                       __pyx_t_42 = -1;
                       if (__pyx_t_43 < 0) {
                         __pyx_t_43 += __pyx_v_val.shape[0];
                         if (unlikely(__pyx_t_43 < 0)) __pyx_t_42 = 0;
                       } else if (unlikely(__pyx_t_43 >= __pyx_v_val.shape[0])) __pyx_t_42 = 0;
                       if (__pyx_t_44 < 0) {
                         __pyx_t_44 += __pyx_v_val.shape[1];
                         if (unlikely(__pyx_t_44 < 0)) __pyx_t_42 = 1;
                       } else if (unlikely(__pyx_t_44 >= __pyx_v_val.shape[1])) __pyx_t_42 = 1;
                       if (unlikely(__pyx_t_42 != -1)) {
                         __Pyx_RaiseBufferIndexError(__pyx_t_42);
-                        __PYX_ERR(0, 495, __pyx_L1_error)
+                        __PYX_ERR(0, 552, __pyx_L1_error)
                       }
                       __pyx_v_value = (((*((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_tr.data + __pyx_t_35 * __pyx_v_tr.strides[0]) ) + __pyx_t_31 * __pyx_v_tr.strides[1]) ) + __pyx_t_33 * __pyx_v_tr.strides[2]) ))) + (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_logarr_2d.data + __pyx_t_36 * __pyx_v_logarr_2d.strides[0]) ) + __pyx_t_32 * __pyx_v_logarr_2d.strides[1]) )))) + (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_val.data + __pyx_t_43 * __pyx_v_val.strides[0]) ) + __pyx_t_44 * __pyx_v_val.strides[1]) ))));
                     }
                     __pyx_L71:;
 
-                    /* "soapcw/soapcw.pyx":497
+                    /* "soapcw/soapcw.pyx":554
  *                                                 value = tr[j][k][m] + logarr_2d[o1,o2] + val[t-1][i+j-tr_dist]
  * 
  *                                             if value > temp:             # <<<<<<<<<<<<<<
  *                                                 temp = value
  *                                                 val[t][i] = temp
  */
                     __pyx_t_17 = ((__pyx_v_value > __pyx_v_temp) != 0);
                     if (__pyx_t_17) {
 
-                      /* "soapcw/soapcw.pyx":498
+                      /* "soapcw/soapcw.pyx":555
  * 
  *                                             if value > temp:
  *                                                 temp = value             # <<<<<<<<<<<<<<
  *                                                 val[t][i] = temp
  *                                                 prev[t][i] =  i+j-tr_dist
  */
                       __pyx_v_temp = __pyx_v_value;
 
-                      /* "soapcw/soapcw.pyx":499
+                      /* "soapcw/soapcw.pyx":556
  *                                             if value > temp:
  *                                                 temp = value
  *                                                 val[t][i] = temp             # <<<<<<<<<<<<<<
  *                                                 prev[t][i] =  i+j-tr_dist
  *                                                 det1[t][i] =  i+k-sep_dist
  */
                       __pyx_t_44 = __pyx_v_t;
@@ -11894,19 +12232,19 @@
                       } else if (unlikely(__pyx_t_44 >= __pyx_v_val.shape[0])) __pyx_t_42 = 0;
                       if (__pyx_t_43 < 0) {
                         __pyx_t_43 += __pyx_v_val.shape[1];
                         if (unlikely(__pyx_t_43 < 0)) __pyx_t_42 = 1;
                       } else if (unlikely(__pyx_t_43 >= __pyx_v_val.shape[1])) __pyx_t_42 = 1;
                       if (unlikely(__pyx_t_42 != -1)) {
                         __Pyx_RaiseBufferIndexError(__pyx_t_42);
-                        __PYX_ERR(0, 499, __pyx_L1_error)
+                        __PYX_ERR(0, 556, __pyx_L1_error)
                       }
                       *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_val.data + __pyx_t_44 * __pyx_v_val.strides[0]) ) + __pyx_t_43 * __pyx_v_val.strides[1]) )) = __pyx_v_temp;
 
-                      /* "soapcw/soapcw.pyx":500
+                      /* "soapcw/soapcw.pyx":557
  *                                                 temp = value
  *                                                 val[t][i] = temp
  *                                                 prev[t][i] =  i+j-tr_dist             # <<<<<<<<<<<<<<
  *                                                 det1[t][i] =  i+k-sep_dist
  *                                                 det2[t][i] =  i+m-sep_dist
  */
                       __pyx_t_43 = __pyx_v_t;
@@ -11918,19 +12256,19 @@
                       } else if (unlikely(__pyx_t_43 >= __pyx_v_prev.shape[0])) __pyx_t_42 = 0;
                       if (__pyx_t_44 < 0) {
                         __pyx_t_44 += __pyx_v_prev.shape[1];
                         if (unlikely(__pyx_t_44 < 0)) __pyx_t_42 = 1;
                       } else if (unlikely(__pyx_t_44 >= __pyx_v_prev.shape[1])) __pyx_t_42 = 1;
                       if (unlikely(__pyx_t_42 != -1)) {
                         __Pyx_RaiseBufferIndexError(__pyx_t_42);
-                        __PYX_ERR(0, 500, __pyx_L1_error)
+                        __PYX_ERR(0, 557, __pyx_L1_error)
                       }
                       *((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_prev.data + __pyx_t_43 * __pyx_v_prev.strides[0]) ) + __pyx_t_44 * __pyx_v_prev.strides[1]) )) = ((__pyx_v_i + __pyx_v_j) - __pyx_v_tr_dist);
 
-                      /* "soapcw/soapcw.pyx":501
+                      /* "soapcw/soapcw.pyx":558
  *                                                 val[t][i] = temp
  *                                                 prev[t][i] =  i+j-tr_dist
  *                                                 det1[t][i] =  i+k-sep_dist             # <<<<<<<<<<<<<<
  *                                                 det2[t][i] =  i+m-sep_dist
  *                                             else:
  */
                       __pyx_t_44 = __pyx_v_t;
@@ -11942,19 +12280,19 @@
                       } else if (unlikely(__pyx_t_44 >= __pyx_v_det1.shape[0])) __pyx_t_42 = 0;
                       if (__pyx_t_43 < 0) {
                         __pyx_t_43 += __pyx_v_det1.shape[1];
                         if (unlikely(__pyx_t_43 < 0)) __pyx_t_42 = 1;
                       } else if (unlikely(__pyx_t_43 >= __pyx_v_det1.shape[1])) __pyx_t_42 = 1;
                       if (unlikely(__pyx_t_42 != -1)) {
                         __Pyx_RaiseBufferIndexError(__pyx_t_42);
-                        __PYX_ERR(0, 501, __pyx_L1_error)
+                        __PYX_ERR(0, 558, __pyx_L1_error)
                       }
                       *((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_det1.data + __pyx_t_44 * __pyx_v_det1.strides[0]) ) + __pyx_t_43 * __pyx_v_det1.strides[1]) )) = ((__pyx_v_i + __pyx_v_k) - __pyx_v_sep_dist);
 
-                      /* "soapcw/soapcw.pyx":502
+                      /* "soapcw/soapcw.pyx":559
  *                                                 prev[t][i] =  i+j-tr_dist
  *                                                 det1[t][i] =  i+k-sep_dist
  *                                                 det2[t][i] =  i+m-sep_dist             # <<<<<<<<<<<<<<
  *                                             else:
  *                                                 continue
  */
                       __pyx_t_43 = __pyx_v_t;
@@ -11966,135 +12304,135 @@
                       } else if (unlikely(__pyx_t_43 >= __pyx_v_det2.shape[0])) __pyx_t_42 = 0;
                       if (__pyx_t_44 < 0) {
                         __pyx_t_44 += __pyx_v_det2.shape[1];
                         if (unlikely(__pyx_t_44 < 0)) __pyx_t_42 = 1;
                       } else if (unlikely(__pyx_t_44 >= __pyx_v_det2.shape[1])) __pyx_t_42 = 1;
                       if (unlikely(__pyx_t_42 != -1)) {
                         __Pyx_RaiseBufferIndexError(__pyx_t_42);
-                        __PYX_ERR(0, 502, __pyx_L1_error)
+                        __PYX_ERR(0, 559, __pyx_L1_error)
                       }
                       *((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_det2.data + __pyx_t_43 * __pyx_v_det2.strides[0]) ) + __pyx_t_44 * __pyx_v_det2.strides[1]) )) = ((__pyx_v_i + __pyx_v_m) - __pyx_v_sep_dist);
 
-                      /* "soapcw/soapcw.pyx":497
+                      /* "soapcw/soapcw.pyx":554
  *                                                 value = tr[j][k][m] + logarr_2d[o1,o2] + val[t-1][i+j-tr_dist]
  * 
  *                                             if value > temp:             # <<<<<<<<<<<<<<
  *                                                 temp = value
  *                                                 val[t][i] = temp
  */
                       goto __pyx_L72;
                     }
 
-                    /* "soapcw/soapcw.pyx":504
+                    /* "soapcw/soapcw.pyx":561
  *                                                 det2[t][i] =  i+m-sep_dist
  *                                             else:
  *                                                 continue             # <<<<<<<<<<<<<<
  *                         else:
  *                             if obs1data[t] and not obs2data[t]:
  */
                     /*else*/ {
                       goto __pyx_L66_continue;
                     }
                     __pyx_L72:;
 
-                    /* "soapcw/soapcw.pyx":489
+                    /* "soapcw/soapcw.pyx":546
  *                                 if i+k-sep_dist>=0+edge_range and i+k-sep_dist<width-edge_range:
  *                                     for m in range(sep_len):
  *                                         if i+m-sep_dist>=0+edge_range and i+m-sep_dist<width-edge_range:             # <<<<<<<<<<<<<<
  *                                             if sumv:
  *                                                 value = tr[j][k][m] + obs1[t][i+k-sep_dist] + obs2[t][i+k-sep_dist] + val[t-1][i+j-tr_dist]
  */
                   }
                   __pyx_L66_continue:;
                 }
 
-                /* "soapcw/soapcw.pyx":487
+                /* "soapcw/soapcw.pyx":544
  *                         if obs1data[t] and obs2data[t]:
  *                             for k in range(sep_len):
  *                                 if i+k-sep_dist>=0+edge_range and i+k-sep_dist<width-edge_range:             # <<<<<<<<<<<<<<
  *                                     for m in range(sep_len):
  *                                         if i+m-sep_dist>=0+edge_range and i+m-sep_dist<width-edge_range:
  */
               }
             }
 
-            /* "soapcw/soapcw.pyx":485
+            /* "soapcw/soapcw.pyx":542
  *                 for j in range(tr_len):
  *                     if i+j-tr_dist>=0 and i+j-tr_dist<width:
  *                         if obs1data[t] and obs2data[t]:             # <<<<<<<<<<<<<<
  *                             for k in range(sep_len):
  *                                 if i+k-sep_dist>=0+edge_range and i+k-sep_dist<width-edge_range:
  */
             goto __pyx_L58;
           }
 
-          /* "soapcw/soapcw.pyx":506
+          /* "soapcw/soapcw.pyx":563
  *                                                 continue
  *                         else:
  *                             if obs1data[t] and not obs2data[t]:             # <<<<<<<<<<<<<<
  *                                 o1 = obs1_ind_1d[t][i]
  *                                 k,m = 1,1
  */
           /*else*/ {
-            __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_obs1data, __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 506, __pyx_L1_error)
+            __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_obs1data, __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 563, __pyx_L1_error)
             __Pyx_GOTREF(__pyx_t_3);
-            __pyx_t_16 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_16 < 0)) __PYX_ERR(0, 506, __pyx_L1_error)
+            __pyx_t_16 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_16 < 0)) __PYX_ERR(0, 563, __pyx_L1_error)
             __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
             if (__pyx_t_16) {
             } else {
               __pyx_t_17 = __pyx_t_16;
               goto __pyx_L74_bool_binop_done;
             }
-            __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_obs2data, __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 506, __pyx_L1_error)
+            __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_obs2data, __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 563, __pyx_L1_error)
             __Pyx_GOTREF(__pyx_t_3);
-            __pyx_t_16 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_16 < 0)) __PYX_ERR(0, 506, __pyx_L1_error)
+            __pyx_t_16 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_16 < 0)) __PYX_ERR(0, 563, __pyx_L1_error)
             __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
             __pyx_t_21 = ((!__pyx_t_16) != 0);
             __pyx_t_17 = __pyx_t_21;
             __pyx_L74_bool_binop_done:;
             if (__pyx_t_17) {
 
-              /* "soapcw/soapcw.pyx":507
+              /* "soapcw/soapcw.pyx":564
  *                         else:
  *                             if obs1data[t] and not obs2data[t]:
  *                                 o1 = obs1_ind_1d[t][i]             # <<<<<<<<<<<<<<
  *                                 k,m = 1,1
  *                                 value = tr[j][k][m] + logarr_1d[o1] + val[t-1][i+j-tr_dist]
  */
-              if (unlikely(!__pyx_v_obs1_ind_1d.memview)) { __Pyx_RaiseUnboundLocalError("obs1_ind_1d"); __PYX_ERR(0, 507, __pyx_L1_error) }
+              if (unlikely(!__pyx_v_obs1_ind_1d.memview)) { __Pyx_RaiseUnboundLocalError("obs1_ind_1d"); __PYX_ERR(0, 564, __pyx_L1_error) }
               __pyx_t_44 = __pyx_v_t;
               __pyx_t_43 = __pyx_v_i;
               __pyx_t_34 = -1;
               if (__pyx_t_44 < 0) {
                 __pyx_t_44 += __pyx_v_obs1_ind_1d.shape[0];
                 if (unlikely(__pyx_t_44 < 0)) __pyx_t_34 = 0;
               } else if (unlikely(__pyx_t_44 >= __pyx_v_obs1_ind_1d.shape[0])) __pyx_t_34 = 0;
               if (__pyx_t_43 < 0) {
                 __pyx_t_43 += __pyx_v_obs1_ind_1d.shape[1];
                 if (unlikely(__pyx_t_43 < 0)) __pyx_t_34 = 1;
               } else if (unlikely(__pyx_t_43 >= __pyx_v_obs1_ind_1d.shape[1])) __pyx_t_34 = 1;
               if (unlikely(__pyx_t_34 != -1)) {
                 __Pyx_RaiseBufferIndexError(__pyx_t_34);
-                __PYX_ERR(0, 507, __pyx_L1_error)
+                __PYX_ERR(0, 564, __pyx_L1_error)
               }
               __pyx_v_o1 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_obs1_ind_1d.data + __pyx_t_44 * __pyx_v_obs1_ind_1d.strides[0]) ) + __pyx_t_43 * __pyx_v_obs1_ind_1d.strides[1]) )));
 
-              /* "soapcw/soapcw.pyx":508
+              /* "soapcw/soapcw.pyx":565
  *                             if obs1data[t] and not obs2data[t]:
  *                                 o1 = obs1_ind_1d[t][i]
  *                                 k,m = 1,1             # <<<<<<<<<<<<<<
  *                                 value = tr[j][k][m] + logarr_1d[o1] + val[t-1][i+j-tr_dist]
  *                             elif obs2data[t] and not obs1data[t]:
  */
               __pyx_t_34 = 1;
               __pyx_t_37 = 1;
               __pyx_v_k = __pyx_t_34;
               __pyx_v_m = __pyx_t_37;
 
-              /* "soapcw/soapcw.pyx":509
+              /* "soapcw/soapcw.pyx":566
  *                                 o1 = obs1_ind_1d[t][i]
  *                                 k,m = 1,1
  *                                 value = tr[j][k][m] + logarr_1d[o1] + val[t-1][i+j-tr_dist]             # <<<<<<<<<<<<<<
  *                             elif obs2data[t] and not obs1data[t]:
  *                                 o2 = obs2_ind_1d[t][i]
  */
               __pyx_t_43 = __pyx_v_j;
@@ -12111,109 +12449,109 @@
               } else if (unlikely(__pyx_t_44 >= __pyx_v_tr.shape[1])) __pyx_t_37 = 1;
               if (__pyx_t_32 < 0) {
                 __pyx_t_32 += __pyx_v_tr.shape[2];
                 if (unlikely(__pyx_t_32 < 0)) __pyx_t_37 = 2;
               } else if (unlikely(__pyx_t_32 >= __pyx_v_tr.shape[2])) __pyx_t_37 = 2;
               if (unlikely(__pyx_t_37 != -1)) {
                 __Pyx_RaiseBufferIndexError(__pyx_t_37);
-                __PYX_ERR(0, 509, __pyx_L1_error)
+                __PYX_ERR(0, 566, __pyx_L1_error)
               }
-              if (unlikely(!__pyx_v_logarr_1d.memview)) { __Pyx_RaiseUnboundLocalError("logarr_1d"); __PYX_ERR(0, 509, __pyx_L1_error) }
+              if (unlikely(!__pyx_v_logarr_1d.memview)) { __Pyx_RaiseUnboundLocalError("logarr_1d"); __PYX_ERR(0, 566, __pyx_L1_error) }
               __pyx_t_36 = __pyx_v_o1;
               __pyx_t_37 = -1;
               if (__pyx_t_36 < 0) {
                 __pyx_t_36 += __pyx_v_logarr_1d.shape[0];
                 if (unlikely(__pyx_t_36 < 0)) __pyx_t_37 = 0;
               } else if (unlikely(__pyx_t_36 >= __pyx_v_logarr_1d.shape[0])) __pyx_t_37 = 0;
               if (unlikely(__pyx_t_37 != -1)) {
                 __Pyx_RaiseBufferIndexError(__pyx_t_37);
-                __PYX_ERR(0, 509, __pyx_L1_error)
+                __PYX_ERR(0, 566, __pyx_L1_error)
               }
               __pyx_t_33 = (__pyx_v_t - 1);
               __pyx_t_31 = ((__pyx_v_i + __pyx_v_j) - __pyx_v_tr_dist);
               __pyx_t_37 = -1;
               if (__pyx_t_33 < 0) {
                 __pyx_t_33 += __pyx_v_val.shape[0];
                 if (unlikely(__pyx_t_33 < 0)) __pyx_t_37 = 0;
               } else if (unlikely(__pyx_t_33 >= __pyx_v_val.shape[0])) __pyx_t_37 = 0;
               if (__pyx_t_31 < 0) {
                 __pyx_t_31 += __pyx_v_val.shape[1];
                 if (unlikely(__pyx_t_31 < 0)) __pyx_t_37 = 1;
               } else if (unlikely(__pyx_t_31 >= __pyx_v_val.shape[1])) __pyx_t_37 = 1;
               if (unlikely(__pyx_t_37 != -1)) {
                 __Pyx_RaiseBufferIndexError(__pyx_t_37);
-                __PYX_ERR(0, 509, __pyx_L1_error)
+                __PYX_ERR(0, 566, __pyx_L1_error)
               }
               __pyx_v_value = (((*((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_tr.data + __pyx_t_43 * __pyx_v_tr.strides[0]) ) + __pyx_t_44 * __pyx_v_tr.strides[1]) ) + __pyx_t_32 * __pyx_v_tr.strides[2]) ))) + (*((double *) ( /* dim=0 */ (__pyx_v_logarr_1d.data + __pyx_t_36 * __pyx_v_logarr_1d.strides[0]) )))) + (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_val.data + __pyx_t_33 * __pyx_v_val.strides[0]) ) + __pyx_t_31 * __pyx_v_val.strides[1]) ))));
 
-              /* "soapcw/soapcw.pyx":506
+              /* "soapcw/soapcw.pyx":563
  *                                                 continue
  *                         else:
  *                             if obs1data[t] and not obs2data[t]:             # <<<<<<<<<<<<<<
  *                                 o1 = obs1_ind_1d[t][i]
  *                                 k,m = 1,1
  */
               goto __pyx_L73;
             }
 
-            /* "soapcw/soapcw.pyx":510
+            /* "soapcw/soapcw.pyx":567
  *                                 k,m = 1,1
  *                                 value = tr[j][k][m] + logarr_1d[o1] + val[t-1][i+j-tr_dist]
  *                             elif obs2data[t] and not obs1data[t]:             # <<<<<<<<<<<<<<
  *                                 o2 = obs2_ind_1d[t][i]
  *                                 k,m = 1,1
  */
-            __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_obs2data, __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 510, __pyx_L1_error)
+            __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_obs2data, __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 567, __pyx_L1_error)
             __Pyx_GOTREF(__pyx_t_3);
-            __pyx_t_21 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_21 < 0)) __PYX_ERR(0, 510, __pyx_L1_error)
+            __pyx_t_21 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_21 < 0)) __PYX_ERR(0, 567, __pyx_L1_error)
             __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
             if (__pyx_t_21) {
             } else {
               __pyx_t_17 = __pyx_t_21;
               goto __pyx_L76_bool_binop_done;
             }
-            __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_obs1data, __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 510, __pyx_L1_error)
+            __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_obs1data, __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 567, __pyx_L1_error)
             __Pyx_GOTREF(__pyx_t_3);
-            __pyx_t_21 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_21 < 0)) __PYX_ERR(0, 510, __pyx_L1_error)
+            __pyx_t_21 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_21 < 0)) __PYX_ERR(0, 567, __pyx_L1_error)
             __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
             __pyx_t_16 = ((!__pyx_t_21) != 0);
             __pyx_t_17 = __pyx_t_16;
             __pyx_L76_bool_binop_done:;
             if (__pyx_t_17) {
 
-              /* "soapcw/soapcw.pyx":511
+              /* "soapcw/soapcw.pyx":568
  *                                 value = tr[j][k][m] + logarr_1d[o1] + val[t-1][i+j-tr_dist]
  *                             elif obs2data[t] and not obs1data[t]:
  *                                 o2 = obs2_ind_1d[t][i]             # <<<<<<<<<<<<<<
  *                                 k,m = 1,1
  *                                 value = tr[j][k][m] + logarr_1d[o2] + val[t-1][i+j-tr_dist]
  */
-              if (unlikely(!__pyx_v_obs2_ind_1d)) { __Pyx_RaiseUnboundLocalError("obs2_ind_1d"); __PYX_ERR(0, 511, __pyx_L1_error) }
-              __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_obs2_ind_1d, __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 511, __pyx_L1_error)
+              if (unlikely(!__pyx_v_obs2_ind_1d)) { __Pyx_RaiseUnboundLocalError("obs2_ind_1d"); __PYX_ERR(0, 568, __pyx_L1_error) }
+              __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_obs2_ind_1d, __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 568, __pyx_L1_error)
               __Pyx_GOTREF(__pyx_t_3);
-              __pyx_t_2 = __Pyx_GetItemInt(__pyx_t_3, __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 511, __pyx_L1_error)
+              __pyx_t_2 = __Pyx_GetItemInt(__pyx_t_3, __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 568, __pyx_L1_error)
               __Pyx_GOTREF(__pyx_t_2);
               __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-              __pyx_t_37 = __Pyx_PyInt_As_int(__pyx_t_2); if (unlikely((__pyx_t_37 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 511, __pyx_L1_error)
+              __pyx_t_37 = __Pyx_PyInt_As_int(__pyx_t_2); if (unlikely((__pyx_t_37 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 568, __pyx_L1_error)
               __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
               __pyx_v_o2 = __pyx_t_37;
 
-              /* "soapcw/soapcw.pyx":512
+              /* "soapcw/soapcw.pyx":569
  *                             elif obs2data[t] and not obs1data[t]:
  *                                 o2 = obs2_ind_1d[t][i]
  *                                 k,m = 1,1             # <<<<<<<<<<<<<<
  *                                 value = tr[j][k][m] + logarr_1d[o2] + val[t-1][i+j-tr_dist]
  *                             elif not obs2data[t] and not obs1data[t]:
  */
               __pyx_t_37 = 1;
               __pyx_t_34 = 1;
               __pyx_v_k = __pyx_t_37;
               __pyx_v_m = __pyx_t_34;
 
-              /* "soapcw/soapcw.pyx":513
+              /* "soapcw/soapcw.pyx":570
  *                                 o2 = obs2_ind_1d[t][i]
  *                                 k,m = 1,1
  *                                 value = tr[j][k][m] + logarr_1d[o2] + val[t-1][i+j-tr_dist]             # <<<<<<<<<<<<<<
  *                             elif not obs2data[t] and not obs1data[t]:
  *                                 o1 = obs1_ind_2d[t][i]
  */
               __pyx_t_31 = __pyx_v_j;
@@ -12230,118 +12568,118 @@
               } else if (unlikely(__pyx_t_33 >= __pyx_v_tr.shape[1])) __pyx_t_34 = 1;
               if (__pyx_t_36 < 0) {
                 __pyx_t_36 += __pyx_v_tr.shape[2];
                 if (unlikely(__pyx_t_36 < 0)) __pyx_t_34 = 2;
               } else if (unlikely(__pyx_t_36 >= __pyx_v_tr.shape[2])) __pyx_t_34 = 2;
               if (unlikely(__pyx_t_34 != -1)) {
                 __Pyx_RaiseBufferIndexError(__pyx_t_34);
-                __PYX_ERR(0, 513, __pyx_L1_error)
+                __PYX_ERR(0, 570, __pyx_L1_error)
               }
-              if (unlikely(!__pyx_v_logarr_1d.memview)) { __Pyx_RaiseUnboundLocalError("logarr_1d"); __PYX_ERR(0, 513, __pyx_L1_error) }
+              if (unlikely(!__pyx_v_logarr_1d.memview)) { __Pyx_RaiseUnboundLocalError("logarr_1d"); __PYX_ERR(0, 570, __pyx_L1_error) }
               __pyx_t_32 = __pyx_v_o2;
               __pyx_t_34 = -1;
               if (__pyx_t_32 < 0) {
                 __pyx_t_32 += __pyx_v_logarr_1d.shape[0];
                 if (unlikely(__pyx_t_32 < 0)) __pyx_t_34 = 0;
               } else if (unlikely(__pyx_t_32 >= __pyx_v_logarr_1d.shape[0])) __pyx_t_34 = 0;
               if (unlikely(__pyx_t_34 != -1)) {
                 __Pyx_RaiseBufferIndexError(__pyx_t_34);
-                __PYX_ERR(0, 513, __pyx_L1_error)
+                __PYX_ERR(0, 570, __pyx_L1_error)
               }
               __pyx_t_44 = (__pyx_v_t - 1);
               __pyx_t_43 = ((__pyx_v_i + __pyx_v_j) - __pyx_v_tr_dist);
               __pyx_t_34 = -1;
               if (__pyx_t_44 < 0) {
                 __pyx_t_44 += __pyx_v_val.shape[0];
                 if (unlikely(__pyx_t_44 < 0)) __pyx_t_34 = 0;
               } else if (unlikely(__pyx_t_44 >= __pyx_v_val.shape[0])) __pyx_t_34 = 0;
               if (__pyx_t_43 < 0) {
                 __pyx_t_43 += __pyx_v_val.shape[1];
                 if (unlikely(__pyx_t_43 < 0)) __pyx_t_34 = 1;
               } else if (unlikely(__pyx_t_43 >= __pyx_v_val.shape[1])) __pyx_t_34 = 1;
               if (unlikely(__pyx_t_34 != -1)) {
                 __Pyx_RaiseBufferIndexError(__pyx_t_34);
-                __PYX_ERR(0, 513, __pyx_L1_error)
+                __PYX_ERR(0, 570, __pyx_L1_error)
               }
               __pyx_v_value = (((*((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_tr.data + __pyx_t_31 * __pyx_v_tr.strides[0]) ) + __pyx_t_33 * __pyx_v_tr.strides[1]) ) + __pyx_t_36 * __pyx_v_tr.strides[2]) ))) + (*((double *) ( /* dim=0 */ (__pyx_v_logarr_1d.data + __pyx_t_32 * __pyx_v_logarr_1d.strides[0]) )))) + (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_val.data + __pyx_t_44 * __pyx_v_val.strides[0]) ) + __pyx_t_43 * __pyx_v_val.strides[1]) ))));
 
-              /* "soapcw/soapcw.pyx":510
+              /* "soapcw/soapcw.pyx":567
  *                                 k,m = 1,1
  *                                 value = tr[j][k][m] + logarr_1d[o1] + val[t-1][i+j-tr_dist]
  *                             elif obs2data[t] and not obs1data[t]:             # <<<<<<<<<<<<<<
  *                                 o2 = obs2_ind_1d[t][i]
  *                                 k,m = 1,1
  */
               goto __pyx_L73;
             }
 
-            /* "soapcw/soapcw.pyx":514
+            /* "soapcw/soapcw.pyx":571
  *                                 k,m = 1,1
  *                                 value = tr[j][k][m] + logarr_1d[o2] + val[t-1][i+j-tr_dist]
  *                             elif not obs2data[t] and not obs1data[t]:             # <<<<<<<<<<<<<<
  *                                 o1 = obs1_ind_2d[t][i]
  *                                 k,m = 1,1
  */
-            __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_obs2data, __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 514, __pyx_L1_error)
+            __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_obs2data, __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 571, __pyx_L1_error)
             __Pyx_GOTREF(__pyx_t_2);
-            __pyx_t_16 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_16 < 0)) __PYX_ERR(0, 514, __pyx_L1_error)
+            __pyx_t_16 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_16 < 0)) __PYX_ERR(0, 571, __pyx_L1_error)
             __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
             __pyx_t_21 = ((!__pyx_t_16) != 0);
             if (__pyx_t_21) {
             } else {
               __pyx_t_17 = __pyx_t_21;
               goto __pyx_L78_bool_binop_done;
             }
-            __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_obs1data, __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 514, __pyx_L1_error)
+            __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_obs1data, __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 571, __pyx_L1_error)
             __Pyx_GOTREF(__pyx_t_2);
-            __pyx_t_21 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_21 < 0)) __PYX_ERR(0, 514, __pyx_L1_error)
+            __pyx_t_21 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_21 < 0)) __PYX_ERR(0, 571, __pyx_L1_error)
             __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
             __pyx_t_16 = ((!__pyx_t_21) != 0);
             __pyx_t_17 = __pyx_t_16;
             __pyx_L78_bool_binop_done:;
             if (__pyx_t_17) {
 
-              /* "soapcw/soapcw.pyx":515
+              /* "soapcw/soapcw.pyx":572
  *                                 value = tr[j][k][m] + logarr_1d[o2] + val[t-1][i+j-tr_dist]
  *                             elif not obs2data[t] and not obs1data[t]:
  *                                 o1 = obs1_ind_2d[t][i]             # <<<<<<<<<<<<<<
  *                                 k,m = 1,1
  *                                 value = tr[j][k][m] + logarr_1d[o1] + val[t-1][i+j-tr_dist]
  */
-              if (unlikely(!__pyx_v_obs1_ind_2d.memview)) { __Pyx_RaiseUnboundLocalError("obs1_ind_2d"); __PYX_ERR(0, 515, __pyx_L1_error) }
+              if (unlikely(!__pyx_v_obs1_ind_2d.memview)) { __Pyx_RaiseUnboundLocalError("obs1_ind_2d"); __PYX_ERR(0, 572, __pyx_L1_error) }
               __pyx_t_43 = __pyx_v_t;
               __pyx_t_44 = __pyx_v_i;
               __pyx_t_34 = -1;
               if (__pyx_t_43 < 0) {
                 __pyx_t_43 += __pyx_v_obs1_ind_2d.shape[0];
                 if (unlikely(__pyx_t_43 < 0)) __pyx_t_34 = 0;
               } else if (unlikely(__pyx_t_43 >= __pyx_v_obs1_ind_2d.shape[0])) __pyx_t_34 = 0;
               if (__pyx_t_44 < 0) {
                 __pyx_t_44 += __pyx_v_obs1_ind_2d.shape[1];
                 if (unlikely(__pyx_t_44 < 0)) __pyx_t_34 = 1;
               } else if (unlikely(__pyx_t_44 >= __pyx_v_obs1_ind_2d.shape[1])) __pyx_t_34 = 1;
               if (unlikely(__pyx_t_34 != -1)) {
                 __Pyx_RaiseBufferIndexError(__pyx_t_34);
-                __PYX_ERR(0, 515, __pyx_L1_error)
+                __PYX_ERR(0, 572, __pyx_L1_error)
               }
               __pyx_v_o1 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_obs1_ind_2d.data + __pyx_t_43 * __pyx_v_obs1_ind_2d.strides[0]) ) + __pyx_t_44 * __pyx_v_obs1_ind_2d.strides[1]) )));
 
-              /* "soapcw/soapcw.pyx":516
+              /* "soapcw/soapcw.pyx":573
  *                             elif not obs2data[t] and not obs1data[t]:
  *                                 o1 = obs1_ind_2d[t][i]
  *                                 k,m = 1,1             # <<<<<<<<<<<<<<
  *                                 value = tr[j][k][m] + logarr_1d[o1] + val[t-1][i+j-tr_dist]
  * 
  */
               __pyx_t_34 = 1;
               __pyx_t_37 = 1;
               __pyx_v_k = __pyx_t_34;
               __pyx_v_m = __pyx_t_37;
 
-              /* "soapcw/soapcw.pyx":517
+              /* "soapcw/soapcw.pyx":574
  *                                 o1 = obs1_ind_2d[t][i]
  *                                 k,m = 1,1
  *                                 value = tr[j][k][m] + logarr_1d[o1] + val[t-1][i+j-tr_dist]             # <<<<<<<<<<<<<<
  * 
  * 
  */
               __pyx_t_44 = __pyx_v_j;
@@ -12358,74 +12696,74 @@
               } else if (unlikely(__pyx_t_43 >= __pyx_v_tr.shape[1])) __pyx_t_37 = 1;
               if (__pyx_t_32 < 0) {
                 __pyx_t_32 += __pyx_v_tr.shape[2];
                 if (unlikely(__pyx_t_32 < 0)) __pyx_t_37 = 2;
               } else if (unlikely(__pyx_t_32 >= __pyx_v_tr.shape[2])) __pyx_t_37 = 2;
               if (unlikely(__pyx_t_37 != -1)) {
                 __Pyx_RaiseBufferIndexError(__pyx_t_37);
-                __PYX_ERR(0, 517, __pyx_L1_error)
+                __PYX_ERR(0, 574, __pyx_L1_error)
               }
-              if (unlikely(!__pyx_v_logarr_1d.memview)) { __Pyx_RaiseUnboundLocalError("logarr_1d"); __PYX_ERR(0, 517, __pyx_L1_error) }
+              if (unlikely(!__pyx_v_logarr_1d.memview)) { __Pyx_RaiseUnboundLocalError("logarr_1d"); __PYX_ERR(0, 574, __pyx_L1_error) }
               __pyx_t_36 = __pyx_v_o1;
               __pyx_t_37 = -1;
               if (__pyx_t_36 < 0) {
                 __pyx_t_36 += __pyx_v_logarr_1d.shape[0];
                 if (unlikely(__pyx_t_36 < 0)) __pyx_t_37 = 0;
               } else if (unlikely(__pyx_t_36 >= __pyx_v_logarr_1d.shape[0])) __pyx_t_37 = 0;
               if (unlikely(__pyx_t_37 != -1)) {
                 __Pyx_RaiseBufferIndexError(__pyx_t_37);
-                __PYX_ERR(0, 517, __pyx_L1_error)
+                __PYX_ERR(0, 574, __pyx_L1_error)
               }
               __pyx_t_33 = (__pyx_v_t - 1);
               __pyx_t_31 = ((__pyx_v_i + __pyx_v_j) - __pyx_v_tr_dist);
               __pyx_t_37 = -1;
               if (__pyx_t_33 < 0) {
                 __pyx_t_33 += __pyx_v_val.shape[0];
                 if (unlikely(__pyx_t_33 < 0)) __pyx_t_37 = 0;
               } else if (unlikely(__pyx_t_33 >= __pyx_v_val.shape[0])) __pyx_t_37 = 0;
               if (__pyx_t_31 < 0) {
                 __pyx_t_31 += __pyx_v_val.shape[1];
                 if (unlikely(__pyx_t_31 < 0)) __pyx_t_37 = 1;
               } else if (unlikely(__pyx_t_31 >= __pyx_v_val.shape[1])) __pyx_t_37 = 1;
               if (unlikely(__pyx_t_37 != -1)) {
                 __Pyx_RaiseBufferIndexError(__pyx_t_37);
-                __PYX_ERR(0, 517, __pyx_L1_error)
+                __PYX_ERR(0, 574, __pyx_L1_error)
               }
               __pyx_v_value = (((*((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_tr.data + __pyx_t_44 * __pyx_v_tr.strides[0]) ) + __pyx_t_43 * __pyx_v_tr.strides[1]) ) + __pyx_t_32 * __pyx_v_tr.strides[2]) ))) + (*((double *) ( /* dim=0 */ (__pyx_v_logarr_1d.data + __pyx_t_36 * __pyx_v_logarr_1d.strides[0]) )))) + (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_val.data + __pyx_t_33 * __pyx_v_val.strides[0]) ) + __pyx_t_31 * __pyx_v_val.strides[1]) ))));
 
-              /* "soapcw/soapcw.pyx":514
+              /* "soapcw/soapcw.pyx":571
  *                                 k,m = 1,1
  *                                 value = tr[j][k][m] + logarr_1d[o2] + val[t-1][i+j-tr_dist]
  *                             elif not obs2data[t] and not obs1data[t]:             # <<<<<<<<<<<<<<
  *                                 o1 = obs1_ind_2d[t][i]
  *                                 k,m = 1,1
  */
             }
             __pyx_L73:;
 
-            /* "soapcw/soapcw.pyx":520
+            /* "soapcw/soapcw.pyx":577
  * 
  * 
  *                             if value > temp:             # <<<<<<<<<<<<<<
  *                                 temp = value
  *                                 val[t][i] = temp
  */
             __pyx_t_17 = ((__pyx_v_value > __pyx_v_temp) != 0);
             if (__pyx_t_17) {
 
-              /* "soapcw/soapcw.pyx":521
+              /* "soapcw/soapcw.pyx":578
  * 
  *                             if value > temp:
  *                                 temp = value             # <<<<<<<<<<<<<<
  *                                 val[t][i] = temp
  *                                 prev[t][i] =  i+j-tr_dist
  */
               __pyx_v_temp = __pyx_v_value;
 
-              /* "soapcw/soapcw.pyx":522
+              /* "soapcw/soapcw.pyx":579
  *                             if value > temp:
  *                                 temp = value
  *                                 val[t][i] = temp             # <<<<<<<<<<<<<<
  *                                 prev[t][i] =  i+j-tr_dist
  *                                 det1[t][i] =  i+k-sep_dist
  */
               __pyx_t_31 = __pyx_v_t;
@@ -12437,19 +12775,19 @@
               } else if (unlikely(__pyx_t_31 >= __pyx_v_val.shape[0])) __pyx_t_37 = 0;
               if (__pyx_t_33 < 0) {
                 __pyx_t_33 += __pyx_v_val.shape[1];
                 if (unlikely(__pyx_t_33 < 0)) __pyx_t_37 = 1;
               } else if (unlikely(__pyx_t_33 >= __pyx_v_val.shape[1])) __pyx_t_37 = 1;
               if (unlikely(__pyx_t_37 != -1)) {
                 __Pyx_RaiseBufferIndexError(__pyx_t_37);
-                __PYX_ERR(0, 522, __pyx_L1_error)
+                __PYX_ERR(0, 579, __pyx_L1_error)
               }
               *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_val.data + __pyx_t_31 * __pyx_v_val.strides[0]) ) + __pyx_t_33 * __pyx_v_val.strides[1]) )) = __pyx_v_temp;
 
-              /* "soapcw/soapcw.pyx":523
+              /* "soapcw/soapcw.pyx":580
  *                                 temp = value
  *                                 val[t][i] = temp
  *                                 prev[t][i] =  i+j-tr_dist             # <<<<<<<<<<<<<<
  *                                 det1[t][i] =  i+k-sep_dist
  *                                 det2[t][i] =  i+m-sep_dist
  */
               __pyx_t_33 = __pyx_v_t;
@@ -12461,19 +12799,19 @@
               } else if (unlikely(__pyx_t_33 >= __pyx_v_prev.shape[0])) __pyx_t_37 = 0;
               if (__pyx_t_31 < 0) {
                 __pyx_t_31 += __pyx_v_prev.shape[1];
                 if (unlikely(__pyx_t_31 < 0)) __pyx_t_37 = 1;
               } else if (unlikely(__pyx_t_31 >= __pyx_v_prev.shape[1])) __pyx_t_37 = 1;
               if (unlikely(__pyx_t_37 != -1)) {
                 __Pyx_RaiseBufferIndexError(__pyx_t_37);
-                __PYX_ERR(0, 523, __pyx_L1_error)
+                __PYX_ERR(0, 580, __pyx_L1_error)
               }
               *((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_prev.data + __pyx_t_33 * __pyx_v_prev.strides[0]) ) + __pyx_t_31 * __pyx_v_prev.strides[1]) )) = ((__pyx_v_i + __pyx_v_j) - __pyx_v_tr_dist);
 
-              /* "soapcw/soapcw.pyx":524
+              /* "soapcw/soapcw.pyx":581
  *                                 val[t][i] = temp
  *                                 prev[t][i] =  i+j-tr_dist
  *                                 det1[t][i] =  i+k-sep_dist             # <<<<<<<<<<<<<<
  *                                 det2[t][i] =  i+m-sep_dist
  *                             else:
  */
               __pyx_t_31 = __pyx_v_t;
@@ -12485,19 +12823,19 @@
               } else if (unlikely(__pyx_t_31 >= __pyx_v_det1.shape[0])) __pyx_t_37 = 0;
               if (__pyx_t_33 < 0) {
                 __pyx_t_33 += __pyx_v_det1.shape[1];
                 if (unlikely(__pyx_t_33 < 0)) __pyx_t_37 = 1;
               } else if (unlikely(__pyx_t_33 >= __pyx_v_det1.shape[1])) __pyx_t_37 = 1;
               if (unlikely(__pyx_t_37 != -1)) {
                 __Pyx_RaiseBufferIndexError(__pyx_t_37);
-                __PYX_ERR(0, 524, __pyx_L1_error)
+                __PYX_ERR(0, 581, __pyx_L1_error)
               }
               *((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_det1.data + __pyx_t_31 * __pyx_v_det1.strides[0]) ) + __pyx_t_33 * __pyx_v_det1.strides[1]) )) = ((__pyx_v_i + __pyx_v_k) - __pyx_v_sep_dist);
 
-              /* "soapcw/soapcw.pyx":525
+              /* "soapcw/soapcw.pyx":582
  *                                 prev[t][i] =  i+j-tr_dist
  *                                 det1[t][i] =  i+k-sep_dist
  *                                 det2[t][i] =  i+m-sep_dist             # <<<<<<<<<<<<<<
  *                             else:
  *                                 continue
  */
               __pyx_t_33 = __pyx_v_t;
@@ -12509,101 +12847,101 @@
               } else if (unlikely(__pyx_t_33 >= __pyx_v_det2.shape[0])) __pyx_t_37 = 0;
               if (__pyx_t_31 < 0) {
                 __pyx_t_31 += __pyx_v_det2.shape[1];
                 if (unlikely(__pyx_t_31 < 0)) __pyx_t_37 = 1;
               } else if (unlikely(__pyx_t_31 >= __pyx_v_det2.shape[1])) __pyx_t_37 = 1;
               if (unlikely(__pyx_t_37 != -1)) {
                 __Pyx_RaiseBufferIndexError(__pyx_t_37);
-                __PYX_ERR(0, 525, __pyx_L1_error)
+                __PYX_ERR(0, 582, __pyx_L1_error)
               }
               *((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_det2.data + __pyx_t_33 * __pyx_v_det2.strides[0]) ) + __pyx_t_31 * __pyx_v_det2.strides[1]) )) = ((__pyx_v_i + __pyx_v_m) - __pyx_v_sep_dist);
 
-              /* "soapcw/soapcw.pyx":520
+              /* "soapcw/soapcw.pyx":577
  * 
  * 
  *                             if value > temp:             # <<<<<<<<<<<<<<
  *                                 temp = value
  *                                 val[t][i] = temp
  */
               goto __pyx_L80;
             }
 
-            /* "soapcw/soapcw.pyx":527
+            /* "soapcw/soapcw.pyx":584
  *                                 det2[t][i] =  i+m-sep_dist
  *                             else:
  *                                 continue             # <<<<<<<<<<<<<<
  * 
  *             if self.prog == True:
  */
             /*else*/ {
               goto __pyx_L53_continue;
             }
             __pyx_L80:;
           }
           __pyx_L58:;
 
-          /* "soapcw/soapcw.pyx":484
+          /* "soapcw/soapcw.pyx":541
  *                 temp = -np.inf
  *                 for j in range(tr_len):
  *                     if i+j-tr_dist>=0 and i+j-tr_dist<width:             # <<<<<<<<<<<<<<
  *                         if obs1data[t] and obs2data[t]:
  *                             for k in range(sep_len):
  */
         }
         __pyx_L53_continue:;
       }
     }
 
-    /* "soapcw/soapcw.pyx":529
+    /* "soapcw/soapcw.pyx":586
  *                                 continue
  * 
  *             if self.prog == True:             # <<<<<<<<<<<<<<
  *                 if pt>pbar:
  *                     stdout.write('\r{} %'.format(round(pt)))
  */
-    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_prog); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 529, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_prog); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 586, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_3 = PyObject_RichCompare(__pyx_t_2, Py_True, Py_EQ); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 529, __pyx_L1_error)
+    __pyx_t_3 = PyObject_RichCompare(__pyx_t_2, Py_True, Py_EQ); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 586, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __pyx_t_17 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_17 < 0)) __PYX_ERR(0, 529, __pyx_L1_error)
+    __pyx_t_17 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_17 < 0)) __PYX_ERR(0, 586, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     if (__pyx_t_17) {
 
-      /* "soapcw/soapcw.pyx":530
+      /* "soapcw/soapcw.pyx":587
  * 
  *             if self.prog == True:
  *                 if pt>pbar:             # <<<<<<<<<<<<<<
  *                     stdout.write('\r{} %'.format(round(pt)))
  *                     stdout.flush()
  */
-      __pyx_t_3 = PyFloat_FromDouble(__pyx_v_pt); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 530, __pyx_L1_error)
+      __pyx_t_3 = PyFloat_FromDouble(__pyx_v_pt); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 587, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
-      __pyx_t_2 = PyObject_RichCompare(__pyx_t_3, __pyx_v_pbar, Py_GT); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 530, __pyx_L1_error)
+      __pyx_t_2 = PyObject_RichCompare(__pyx_t_3, __pyx_v_pbar, Py_GT); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 587, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-      __pyx_t_17 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_17 < 0)) __PYX_ERR(0, 530, __pyx_L1_error)
+      __pyx_t_17 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_17 < 0)) __PYX_ERR(0, 587, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
       if (__pyx_t_17) {
 
-        /* "soapcw/soapcw.pyx":531
+        /* "soapcw/soapcw.pyx":588
  *             if self.prog == True:
  *                 if pt>pbar:
  *                     stdout.write('\r{} %'.format(round(pt)))             # <<<<<<<<<<<<<<
  *                     stdout.flush()
  *                     pbar+=100./length
  */
-        __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_stdout); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 531, __pyx_L1_error)
+        __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_stdout); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 588, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
-        __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_write); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 531, __pyx_L1_error)
+        __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_write); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 588, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u__4, __pyx_n_s_format); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 531, __pyx_L1_error)
+        __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u__4, __pyx_n_s_format); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 588, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_10);
-        __pyx_t_9 = PyFloat_FromDouble(__pyx_v_pt); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 531, __pyx_L1_error)
+        __pyx_t_9 = PyFloat_FromDouble(__pyx_v_pt); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 588, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_9);
-        __pyx_t_14 = __Pyx_PyObject_CallOneArg(__pyx_builtin_round, __pyx_t_9); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 531, __pyx_L1_error)
+        __pyx_t_14 = __Pyx_PyObject_CallOneArg(__pyx_builtin_round, __pyx_t_9); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 588, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_14);
         __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
         __pyx_t_9 = NULL;
         if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_10))) {
           __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_10);
           if (likely(__pyx_t_9)) {
             PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_10);
@@ -12611,15 +12949,15 @@
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_10, function);
           }
         }
         __pyx_t_3 = (__pyx_t_9) ? __Pyx_PyObject_Call2Args(__pyx_t_10, __pyx_t_9, __pyx_t_14) : __Pyx_PyObject_CallOneArg(__pyx_t_10, __pyx_t_14);
         __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
         __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
-        if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 531, __pyx_L1_error)
+        if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 588, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
         __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
         __pyx_t_10 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
           __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_4);
           if (likely(__pyx_t_10)) {
             PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
@@ -12627,246 +12965,246 @@
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_4, function);
           }
         }
         __pyx_t_2 = (__pyx_t_10) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_10, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_3);
         __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 531, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 588, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-        /* "soapcw/soapcw.pyx":532
+        /* "soapcw/soapcw.pyx":589
  *                 if pt>pbar:
  *                     stdout.write('\r{} %'.format(round(pt)))
  *                     stdout.flush()             # <<<<<<<<<<<<<<
  *                     pbar+=100./length
  * 
  */
-        __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_stdout); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 532, __pyx_L1_error)
+        __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_stdout); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 589, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
-        __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_flush); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 532, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_flush); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 589, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
         __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
         __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
           if (likely(__pyx_t_4)) {
             PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 532, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 589, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-        /* "soapcw/soapcw.pyx":533
+        /* "soapcw/soapcw.pyx":590
  *                     stdout.write('\r{} %'.format(round(pt)))
  *                     stdout.flush()
  *                     pbar+=100./length             # <<<<<<<<<<<<<<
  * 
  *         self.V = np.array(val)
  */
         if (unlikely(__pyx_v_length == 0)) {
           PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-          __PYX_ERR(0, 533, __pyx_L1_error)
+          __PYX_ERR(0, 590, __pyx_L1_error)
         }
-        __pyx_t_2 = PyFloat_FromDouble((100. / ((double)__pyx_v_length))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 533, __pyx_L1_error)
+        __pyx_t_2 = PyFloat_FromDouble((100. / ((double)__pyx_v_length))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 590, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
-        __pyx_t_3 = PyNumber_InPlaceAdd(__pyx_v_pbar, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 533, __pyx_L1_error)
+        __pyx_t_3 = PyNumber_InPlaceAdd(__pyx_v_pbar, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 590, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __Pyx_DECREF_SET(__pyx_v_pbar, __pyx_t_3);
         __pyx_t_3 = 0;
 
-        /* "soapcw/soapcw.pyx":530
+        /* "soapcw/soapcw.pyx":587
  * 
  *             if self.prog == True:
  *                 if pt>pbar:             # <<<<<<<<<<<<<<
  *                     stdout.write('\r{} %'.format(round(pt)))
  *                     stdout.flush()
  */
       }
 
-      /* "soapcw/soapcw.pyx":529
+      /* "soapcw/soapcw.pyx":586
  *                                 continue
  * 
  *             if self.prog == True:             # <<<<<<<<<<<<<<
  *                 if pt>pbar:
  *                     stdout.write('\r{} %'.format(round(pt)))
  */
     }
   }
 
-  /* "soapcw/soapcw.pyx":535
+  /* "soapcw/soapcw.pyx":592
  *                     pbar+=100./length
  * 
  *         self.V = np.array(val)             # <<<<<<<<<<<<<<
  *         self.prev = np.array(prev)
  *         self.det1 = np.array(det1)
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 535, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 592, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_array); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 535, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_array); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 592, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __pyx_memoryview_fromslice(__pyx_v_val, 2, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 535, __pyx_L1_error)
+  __pyx_t_2 = __pyx_memoryview_fromslice(__pyx_v_val, 2, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 592, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_10 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
     __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_4);
     if (likely(__pyx_t_10)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
       __Pyx_INCREF(__pyx_t_10);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_4, function);
     }
   }
   __pyx_t_3 = (__pyx_t_10) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_10, __pyx_t_2) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_2);
   __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 535, __pyx_L1_error)
+  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 592, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_V, __pyx_t_3) < 0) __PYX_ERR(0, 535, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_V, __pyx_t_3) < 0) __PYX_ERR(0, 592, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "soapcw/soapcw.pyx":536
+  /* "soapcw/soapcw.pyx":593
  * 
  *         self.V = np.array(val)
  *         self.prev = np.array(prev)             # <<<<<<<<<<<<<<
  *         self.det1 = np.array(det1)
  *         self.det2 = np.array(det2)
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 536, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 593, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_array); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 536, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_array); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 593, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_memoryview_fromslice(__pyx_v_prev, 2, (PyObject *(*)(char *)) __pyx_memview_get_int, (int (*)(char *, PyObject *)) __pyx_memview_set_int, 0);; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 536, __pyx_L1_error)
+  __pyx_t_4 = __pyx_memoryview_fromslice(__pyx_v_prev, 2, (PyObject *(*)(char *)) __pyx_memview_get_int, (int (*)(char *, PyObject *)) __pyx_memview_set_int, 0);; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 593, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __pyx_t_10 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
     __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_2);
     if (likely(__pyx_t_10)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
       __Pyx_INCREF(__pyx_t_10);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_2, function);
     }
   }
   __pyx_t_3 = (__pyx_t_10) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_10, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_4);
   __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 536, __pyx_L1_error)
+  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 593, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_prev, __pyx_t_3) < 0) __PYX_ERR(0, 536, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_prev, __pyx_t_3) < 0) __PYX_ERR(0, 593, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "soapcw/soapcw.pyx":537
+  /* "soapcw/soapcw.pyx":594
  *         self.V = np.array(val)
  *         self.prev = np.array(prev)
  *         self.det1 = np.array(det1)             # <<<<<<<<<<<<<<
  *         self.det2 = np.array(det2)
  *         self.width = width
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 537, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 594, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_array); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 537, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_array); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 594, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __pyx_memoryview_fromslice(__pyx_v_det1, 2, (PyObject *(*)(char *)) __pyx_memview_get_int, (int (*)(char *, PyObject *)) __pyx_memview_set_int, 0);; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 537, __pyx_L1_error)
+  __pyx_t_2 = __pyx_memoryview_fromslice(__pyx_v_det1, 2, (PyObject *(*)(char *)) __pyx_memview_get_int, (int (*)(char *, PyObject *)) __pyx_memview_set_int, 0);; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 594, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_10 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
     __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_4);
     if (likely(__pyx_t_10)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
       __Pyx_INCREF(__pyx_t_10);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_4, function);
     }
   }
   __pyx_t_3 = (__pyx_t_10) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_10, __pyx_t_2) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_2);
   __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 537, __pyx_L1_error)
+  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 594, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_det1, __pyx_t_3) < 0) __PYX_ERR(0, 537, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_det1, __pyx_t_3) < 0) __PYX_ERR(0, 594, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "soapcw/soapcw.pyx":538
+  /* "soapcw/soapcw.pyx":595
  *         self.prev = np.array(prev)
  *         self.det1 = np.array(det1)
  *         self.det2 = np.array(det2)             # <<<<<<<<<<<<<<
  *         self.width = width
  *         self.length = length
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 538, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 595, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_array); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 538, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_array); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 595, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_memoryview_fromslice(__pyx_v_det2, 2, (PyObject *(*)(char *)) __pyx_memview_get_int, (int (*)(char *, PyObject *)) __pyx_memview_set_int, 0);; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 538, __pyx_L1_error)
+  __pyx_t_4 = __pyx_memoryview_fromslice(__pyx_v_det2, 2, (PyObject *(*)(char *)) __pyx_memview_get_int, (int (*)(char *, PyObject *)) __pyx_memview_set_int, 0);; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 595, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __pyx_t_10 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
     __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_2);
     if (likely(__pyx_t_10)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
       __Pyx_INCREF(__pyx_t_10);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_2, function);
     }
   }
   __pyx_t_3 = (__pyx_t_10) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_10, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_4);
   __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 538, __pyx_L1_error)
+  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 595, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_det2, __pyx_t_3) < 0) __PYX_ERR(0, 538, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_det2, __pyx_t_3) < 0) __PYX_ERR(0, 595, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "soapcw/soapcw.pyx":539
+  /* "soapcw/soapcw.pyx":596
  *         self.det1 = np.array(det1)
  *         self.det2 = np.array(det2)
  *         self.width = width             # <<<<<<<<<<<<<<
  *         self.length = length
  * 
  */
-  __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_width); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 539, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_width); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 596, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_width, __pyx_t_3) < 0) __PYX_ERR(0, 539, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_width, __pyx_t_3) < 0) __PYX_ERR(0, 596, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "soapcw/soapcw.pyx":540
+  /* "soapcw/soapcw.pyx":597
  *         self.det2 = np.array(det2)
  *         self.width = width
  *         self.length = length             # <<<<<<<<<<<<<<
  * 
- *     def run_lookup_amp(self,tr1, obs11, obs21,lookup_file = None, fractions = None):
+ *     def run_lookup_amp(self,tr1, obs11, obs21,lookup_table = None, fractions = None):
  */
-  __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_length); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 540, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_length); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 597, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_length, __pyx_t_3) < 0) __PYX_ERR(0, 540, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_length, __pyx_t_3) < 0) __PYX_ERR(0, 597, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "soapcw/soapcw.pyx":300
+  /* "soapcw/soapcw.pyx":357
  *     #--------------------------------------------------------
  * 
- *     def run(self,transition, obs1, obs2, lookup_file_1det = None,lookup_file_2det = None):             # <<<<<<<<<<<<<<
+ *     def run(self,transition, obs1, obs2, lookup_table_1det = None,lookup_table_2det = None):             # <<<<<<<<<<<<<<
  *         """
  *         viterbi algorithm for two detectors with an lookup table for the line veto statistic
  */
 
   /* function exit code */
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
@@ -12911,41 +13249,41 @@
   __Pyx_XDECREF(__pyx_8genexpr1__pyx_v_obs1seg);
   __Pyx_XDECREF(__pyx_8genexpr2__pyx_v_obs2seg);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "soapcw/soapcw.pyx":542
+/* "soapcw/soapcw.pyx":599
  *         self.length = length
  * 
- *     def run_lookup_amp(self,tr1, obs11, obs21,lookup_file = None, fractions = None):             # <<<<<<<<<<<<<<
+ *     def run_lookup_amp(self,tr1, obs11, obs21,lookup_table = None, fractions = None):             # <<<<<<<<<<<<<<
  *         """
  *         viterbi algorithm for two detectors with an lookup table for the line veto statistic
  */
 
 /* Python wrapper */
 static PyObject *__pyx_pw_6soapcw_6soapcw_12two_detector_11run_lookup_amp(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static char __pyx_doc_6soapcw_6soapcw_12two_detector_10run_lookup_amp[] = "\n        viterbi algorithm for two detectors with an lookup table for the line veto statistic\n        Args\n        ---------\n        tr1: array\n            transition matrix\n        obs11: array\n            observation from detector 1\n        obs21: array\n            observation from detector 2 \n        lookup_file: float\n            links to a file which contains a 2d lookup table\n        returns\n        -----------\n        V: array\n            viterbi values in reference detector\n        prev: array\n            previous positions before jump\n        ";
+static char __pyx_doc_6soapcw_6soapcw_12two_detector_10run_lookup_amp[] = "\n        viterbi algorithm for two detectors with an lookup table for the line veto statistic\n        Args\n        ---------\n        tr1: array\n            transition matrix\n        obs11: array\n            observation from detector 1\n        obs21: array\n            observation from detector 2 \n        lookup_table: float\n            links to a file which contains a 2d lookup table or LineAwareStatistic class\n        returns\n        -----------\n        V: array\n            viterbi values in reference detector\n        prev: array\n            previous positions before jump\n        ";
 static PyMethodDef __pyx_mdef_6soapcw_6soapcw_12two_detector_11run_lookup_amp = {"run_lookup_amp", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6soapcw_6soapcw_12two_detector_11run_lookup_amp, METH_VARARGS|METH_KEYWORDS, __pyx_doc_6soapcw_6soapcw_12two_detector_10run_lookup_amp};
 static PyObject *__pyx_pw_6soapcw_6soapcw_12two_detector_11run_lookup_amp(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyObject *__pyx_v_self = 0;
   PyObject *__pyx_v_tr1 = 0;
   PyObject *__pyx_v_obs11 = 0;
   PyObject *__pyx_v_obs21 = 0;
-  PyObject *__pyx_v_lookup_file = 0;
+  PyObject *__pyx_v_lookup_table = 0;
   PyObject *__pyx_v_fractions = 0;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("run_lookup_amp (wrapper)", 0);
   {
-    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_self,&__pyx_n_s_tr1,&__pyx_n_s_obs11,&__pyx_n_s_obs21,&__pyx_n_s_lookup_file,&__pyx_n_s_fractions,0};
+    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_self,&__pyx_n_s_tr1,&__pyx_n_s_obs11,&__pyx_n_s_obs21,&__pyx_n_s_lookup_table,&__pyx_n_s_fractions,0};
     PyObject* values[6] = {0,0,0,0,0,0};
     values[4] = ((PyObject *)((PyObject *)Py_None));
     values[5] = ((PyObject *)((PyObject *)Py_None));
     if (unlikely(__pyx_kwds)) {
       Py_ssize_t kw_args;
       const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
       switch (pos_args) {
@@ -12969,43 +13307,43 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_tr1)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("run_lookup_amp", 0, 4, 6, 1); __PYX_ERR(0, 542, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("run_lookup_amp", 0, 4, 6, 1); __PYX_ERR(0, 599, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_obs11)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("run_lookup_amp", 0, 4, 6, 2); __PYX_ERR(0, 542, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("run_lookup_amp", 0, 4, 6, 2); __PYX_ERR(0, 599, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_obs21)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("run_lookup_amp", 0, 4, 6, 3); __PYX_ERR(0, 542, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("run_lookup_amp", 0, 4, 6, 3); __PYX_ERR(0, 599, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (kw_args > 0) {
-          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_lookup_file);
+          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_lookup_table);
           if (value) { values[4] = value; kw_args--; }
         }
         CYTHON_FALLTHROUGH;
         case  5:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_fractions);
           if (value) { values[5] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "run_lookup_amp") < 0)) __PYX_ERR(0, 542, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "run_lookup_amp") < 0)) __PYX_ERR(0, 599, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  6: values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
         CYTHON_FALLTHROUGH;
         case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
         CYTHON_FALLTHROUGH;
@@ -13017,33 +13355,33 @@
         default: goto __pyx_L5_argtuple_error;
       }
     }
     __pyx_v_self = values[0];
     __pyx_v_tr1 = values[1];
     __pyx_v_obs11 = values[2];
     __pyx_v_obs21 = values[3];
-    __pyx_v_lookup_file = values[4];
+    __pyx_v_lookup_table = values[4];
     __pyx_v_fractions = values[5];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("run_lookup_amp", 0, 4, 6, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 542, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("run_lookup_amp", 0, 4, 6, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 599, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("soapcw.soapcw.two_detector.run_lookup_amp", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_6soapcw_6soapcw_12two_detector_10run_lookup_amp(__pyx_self, __pyx_v_self, __pyx_v_tr1, __pyx_v_obs11, __pyx_v_obs21, __pyx_v_lookup_file, __pyx_v_fractions);
+  __pyx_r = __pyx_pf_6soapcw_6soapcw_12two_detector_10run_lookup_amp(__pyx_self, __pyx_v_self, __pyx_v_tr1, __pyx_v_obs11, __pyx_v_obs21, __pyx_v_lookup_table, __pyx_v_fractions);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_6soapcw_6soapcw_12two_detector_10run_lookup_amp(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_tr1, PyObject *__pyx_v_obs11, PyObject *__pyx_v_obs21, PyObject *__pyx_v_lookup_file, PyObject *__pyx_v_fractions) {
+static PyObject *__pyx_pf_6soapcw_6soapcw_12two_detector_10run_lookup_amp(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self, PyObject *__pyx_v_tr1, PyObject *__pyx_v_obs11, PyObject *__pyx_v_obs21, PyObject *__pyx_v_lookup_table, PyObject *__pyx_v_fractions) {
   __Pyx_memviewslice __pyx_v_tr = { 0, 0, { 0 }, { 0 }, { 0 } };
   __Pyx_memviewslice __pyx_v_obs1 = { 0, 0, { 0 }, { 0 }, { 0 } };
   __Pyx_memviewslice __pyx_v_obs2 = { 0, 0, { 0 }, { 0 }, { 0 } };
   PyObject *__pyx_v_shape = NULL;
   int __pyx_v_length;
   int __pyx_v_width;
   __Pyx_memviewslice __pyx_v_val = { 0, 0, { 0 }, { 0 }, { 0 } };
@@ -13138,84 +13476,84 @@
   Py_ssize_t __pyx_t_50;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("run_lookup_amp", 0);
   __Pyx_INCREF(__pyx_v_fractions);
 
-  /* "soapcw/soapcw.pyx":562
+  /* "soapcw/soapcw.pyx":619
  *             previous positions before jump
  *         """
  *         cdef double[:, :, :] tr = tr1             # <<<<<<<<<<<<<<
  *         cdef double[:, :] obs1 = obs11
  *         cdef double[:, :] obs2 = obs21
  */
-  __pyx_t_1 = __Pyx_PyObject_to_MemoryviewSlice_dsdsds_double(__pyx_v_tr1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_1.memview)) __PYX_ERR(0, 562, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_to_MemoryviewSlice_dsdsds_double(__pyx_v_tr1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_1.memview)) __PYX_ERR(0, 619, __pyx_L1_error)
   __pyx_v_tr = __pyx_t_1;
   __pyx_t_1.memview = NULL;
   __pyx_t_1.data = NULL;
 
-  /* "soapcw/soapcw.pyx":563
+  /* "soapcw/soapcw.pyx":620
  *         """
  *         cdef double[:, :, :] tr = tr1
  *         cdef double[:, :] obs1 = obs11             # <<<<<<<<<<<<<<
  *         cdef double[:, :] obs2 = obs21
  * 
  */
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_dsds_double(__pyx_v_obs11, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 563, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_dsds_double(__pyx_v_obs11, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 620, __pyx_L1_error)
   __pyx_v_obs1 = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "soapcw/soapcw.pyx":564
+  /* "soapcw/soapcw.pyx":621
  *         cdef double[:, :, :] tr = tr1
  *         cdef double[:, :] obs1 = obs11
  *         cdef double[:, :] obs2 = obs21             # <<<<<<<<<<<<<<
  * 
  *         shape = np.shape(obs1)
  */
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_dsds_double(__pyx_v_obs21, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 564, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_dsds_double(__pyx_v_obs21, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 621, __pyx_L1_error)
   __pyx_v_obs2 = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "soapcw/soapcw.pyx":566
+  /* "soapcw/soapcw.pyx":623
  *         cdef double[:, :] obs2 = obs21
  * 
  *         shape = np.shape(obs1)             # <<<<<<<<<<<<<<
  * 
  *         cdef int length = min(len(obs1),len(obs2))
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 566, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 623, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_shape); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 566, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_shape); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 623, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_memoryview_fromslice(__pyx_v_obs1, 2, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 566, __pyx_L1_error)
+  __pyx_t_4 = __pyx_memoryview_fromslice(__pyx_v_obs1, 2, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 623, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __pyx_t_6 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
     __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_5);
     if (likely(__pyx_t_6)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
       __Pyx_INCREF(__pyx_t_6);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_5, function);
     }
   }
   __pyx_t_3 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_6, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_4);
   __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 566, __pyx_L1_error)
+  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 623, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __pyx_v_shape = __pyx_t_3;
   __pyx_t_3 = 0;
 
-  /* "soapcw/soapcw.pyx":568
+  /* "soapcw/soapcw.pyx":625
  *         shape = np.shape(obs1)
  * 
  *         cdef int length = min(len(obs1),len(obs2))             # <<<<<<<<<<<<<<
  *         cdef int width = len(obs1[0])
  * 
  */
   __pyx_t_7 = __Pyx_MemoryView_Len(__pyx_v_obs2); 
@@ -13223,15 +13561,15 @@
   if (((__pyx_t_7 < __pyx_t_8) != 0)) {
     __pyx_t_9 = __pyx_t_7;
   } else {
     __pyx_t_9 = __pyx_t_8;
   }
   __pyx_v_length = __pyx_t_9;
 
-  /* "soapcw/soapcw.pyx":569
+  /* "soapcw/soapcw.pyx":626
  * 
  *         cdef int length = min(len(obs1),len(obs2))
  *         cdef int width = len(obs1[0])             # <<<<<<<<<<<<<<
  * 
  *         cdef double[:, :] val = np.ones(shape)*-1e6
  */
   __pyx_t_10.data = __pyx_v_obs1.data;
@@ -13242,187 +13580,187 @@
         Py_ssize_t __pyx_tmp_shape = __pyx_v_obs1.shape[0];
     Py_ssize_t __pyx_tmp_stride = __pyx_v_obs1.strides[0];
         if (__pyx_tmp_idx < 0)
             __pyx_tmp_idx += __pyx_tmp_shape;
         if (unlikely(!__Pyx_is_valid_index(__pyx_tmp_idx, __pyx_tmp_shape))) {
             PyErr_SetString(PyExc_IndexError,
                             "Index out of bounds (axis 0)");
-            __PYX_ERR(0, 569, __pyx_L1_error)
+            __PYX_ERR(0, 626, __pyx_L1_error)
         }
         __pyx_t_10.data += __pyx_tmp_idx * __pyx_tmp_stride;
 }
 
 __pyx_t_10.shape[0] = __pyx_v_obs1.shape[1];
 __pyx_t_10.strides[0] = __pyx_v_obs1.strides[1];
     __pyx_t_10.suboffsets[0] = -1;
 
 __pyx_t_7 = __Pyx_MemoryView_Len(__pyx_t_10); 
   __PYX_XDEC_MEMVIEW(&__pyx_t_10, 1);
   __pyx_t_10.memview = NULL;
   __pyx_t_10.data = NULL;
   __pyx_v_width = __pyx_t_7;
 
-  /* "soapcw/soapcw.pyx":571
+  /* "soapcw/soapcw.pyx":628
  *         cdef int width = len(obs1[0])
  * 
  *         cdef double[:, :] val = np.ones(shape)*-1e6             # <<<<<<<<<<<<<<
  *         cdef int[:, :] prev = np.zeros(shape,dtype = np.int32)
  *         cdef int[:, :] det1 = np.zeros(shape,dtype = np.int32)
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 571, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 628, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_ones); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 571, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_ones); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 628, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __pyx_t_5 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
     __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
     if (likely(__pyx_t_5)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
       __Pyx_INCREF(__pyx_t_5);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_4, function);
     }
   }
   __pyx_t_3 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_5, __pyx_v_shape) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_v_shape);
   __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 571, __pyx_L1_error)
+  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 628, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = PyNumber_Multiply(__pyx_t_3, __pyx_float_neg_1e6); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 571, __pyx_L1_error)
+  __pyx_t_4 = PyNumber_Multiply(__pyx_t_3, __pyx_float_neg_1e6); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 628, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_dsds_double(__pyx_t_4, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 571, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_dsds_double(__pyx_t_4, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 628, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_v_val = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "soapcw/soapcw.pyx":572
+  /* "soapcw/soapcw.pyx":629
  * 
  *         cdef double[:, :] val = np.ones(shape)*-1e6
  *         cdef int[:, :] prev = np.zeros(shape,dtype = np.int32)             # <<<<<<<<<<<<<<
  *         cdef int[:, :] det1 = np.zeros(shape,dtype = np.int32)
  *         cdef int[:, :] det2 = np.zeros(shape,dtype = np.int32)
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 572, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 629, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_zeros); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 572, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_zeros); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 629, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 572, __pyx_L1_error)
+  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 629, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_INCREF(__pyx_v_shape);
   __Pyx_GIVEREF(__pyx_v_shape);
   PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_v_shape);
-  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 572, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 629, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 572, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 629, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_int32); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 572, __pyx_L1_error)
+  __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_int32); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 629, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_11);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_11) < 0) __PYX_ERR(0, 572, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_11) < 0) __PYX_ERR(0, 629, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
-  __pyx_t_11 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_4, __pyx_t_5); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 572, __pyx_L1_error)
+  __pyx_t_11 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_4, __pyx_t_5); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 629, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_11);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_dsds_int(__pyx_t_11, PyBUF_WRITABLE); if (unlikely(!__pyx_t_12.memview)) __PYX_ERR(0, 572, __pyx_L1_error)
+  __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_dsds_int(__pyx_t_11, PyBUF_WRITABLE); if (unlikely(!__pyx_t_12.memview)) __PYX_ERR(0, 629, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
   __pyx_v_prev = __pyx_t_12;
   __pyx_t_12.memview = NULL;
   __pyx_t_12.data = NULL;
 
-  /* "soapcw/soapcw.pyx":573
+  /* "soapcw/soapcw.pyx":630
  *         cdef double[:, :] val = np.ones(shape)*-1e6
  *         cdef int[:, :] prev = np.zeros(shape,dtype = np.int32)
  *         cdef int[:, :] det1 = np.zeros(shape,dtype = np.int32)             # <<<<<<<<<<<<<<
  *         cdef int[:, :] det2 = np.zeros(shape,dtype = np.int32)
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_11, __pyx_n_s_np); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 573, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_11, __pyx_n_s_np); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 630, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_11);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_11, __pyx_n_s_zeros); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 573, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_11, __pyx_n_s_zeros); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 630, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
-  __pyx_t_11 = PyTuple_New(1); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 573, __pyx_L1_error)
+  __pyx_t_11 = PyTuple_New(1); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 630, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_11);
   __Pyx_INCREF(__pyx_v_shape);
   __Pyx_GIVEREF(__pyx_v_shape);
   PyTuple_SET_ITEM(__pyx_t_11, 0, __pyx_v_shape);
-  __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 573, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 630, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 573, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 630, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_int32); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 573, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_int32); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 630, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 573, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 630, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_11, __pyx_t_4); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 573, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_11, __pyx_t_4); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 630, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_dsds_int(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_12.memview)) __PYX_ERR(0, 573, __pyx_L1_error)
+  __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_dsds_int(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_12.memview)) __PYX_ERR(0, 630, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_v_det1 = __pyx_t_12;
   __pyx_t_12.memview = NULL;
   __pyx_t_12.data = NULL;
 
-  /* "soapcw/soapcw.pyx":574
+  /* "soapcw/soapcw.pyx":631
  *         cdef int[:, :] prev = np.zeros(shape,dtype = np.int32)
  *         cdef int[:, :] det1 = np.zeros(shape,dtype = np.int32)
  *         cdef int[:, :] det2 = np.zeros(shape,dtype = np.int32)             # <<<<<<<<<<<<<<
  * 
  *         cdef int tr_len = len(tr)
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 574, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 631, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_zeros); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 574, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_zeros); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 631, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 574, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 631, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_INCREF(__pyx_v_shape);
   __Pyx_GIVEREF(__pyx_v_shape);
   PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_v_shape);
-  __pyx_t_11 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 574, __pyx_L1_error)
+  __pyx_t_11 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 631, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_11);
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 574, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 631, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_int32); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 574, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_int32); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 631, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (PyDict_SetItem(__pyx_t_11, __pyx_n_s_dtype, __pyx_t_3) < 0) __PYX_ERR(0, 574, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_11, __pyx_n_s_dtype, __pyx_t_3) < 0) __PYX_ERR(0, 631, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_6, __pyx_t_11); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 574, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_6, __pyx_t_11); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 631, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
-  __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_dsds_int(__pyx_t_3, PyBUF_WRITABLE); if (unlikely(!__pyx_t_12.memview)) __PYX_ERR(0, 574, __pyx_L1_error)
+  __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_dsds_int(__pyx_t_3, PyBUF_WRITABLE); if (unlikely(!__pyx_t_12.memview)) __PYX_ERR(0, 631, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_v_det2 = __pyx_t_12;
   __pyx_t_12.memview = NULL;
   __pyx_t_12.data = NULL;
 
-  /* "soapcw/soapcw.pyx":576
+  /* "soapcw/soapcw.pyx":633
  *         cdef int[:, :] det2 = np.zeros(shape,dtype = np.int32)
  * 
  *         cdef int tr_len = len(tr)             # <<<<<<<<<<<<<<
  *         cdef int sep_len = len(tr[0])
  *         cdef int tr_dist = int(len(tr)/2. - 0.5)
  */
   __pyx_t_7 = __Pyx_MemoryView_Len(__pyx_v_tr); 
   __pyx_v_tr_len = __pyx_t_7;
 
-  /* "soapcw/soapcw.pyx":577
+  /* "soapcw/soapcw.pyx":634
  * 
  *         cdef int tr_len = len(tr)
  *         cdef int sep_len = len(tr[0])             # <<<<<<<<<<<<<<
  *         cdef int tr_dist = int(len(tr)/2. - 0.5)
  *         cdef int sep_dist = int(len(tr)/2. - 0.5)
  */
   __pyx_t_2.data = __pyx_v_tr.data;
@@ -13433,15 +13771,15 @@
         Py_ssize_t __pyx_tmp_shape = __pyx_v_tr.shape[0];
     Py_ssize_t __pyx_tmp_stride = __pyx_v_tr.strides[0];
         if (__pyx_tmp_idx < 0)
             __pyx_tmp_idx += __pyx_tmp_shape;
         if (unlikely(!__Pyx_is_valid_index(__pyx_tmp_idx, __pyx_tmp_shape))) {
             PyErr_SetString(PyExc_IndexError,
                             "Index out of bounds (axis 0)");
-            __PYX_ERR(0, 577, __pyx_L1_error)
+            __PYX_ERR(0, 634, __pyx_L1_error)
         }
         __pyx_t_2.data += __pyx_tmp_idx * __pyx_tmp_stride;
 }
 
 __pyx_t_2.shape[0] = __pyx_v_tr.shape[1];
 __pyx_t_2.strides[0] = __pyx_v_tr.strides[1];
     __pyx_t_2.suboffsets[0] = -1;
@@ -13452,74 +13790,74 @@
 
 __pyx_t_7 = __Pyx_MemoryView_Len(__pyx_t_2); 
   __PYX_XDEC_MEMVIEW(&__pyx_t_2, 1);
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
   __pyx_v_sep_len = __pyx_t_7;
 
-  /* "soapcw/soapcw.pyx":578
+  /* "soapcw/soapcw.pyx":635
  *         cdef int tr_len = len(tr)
  *         cdef int sep_len = len(tr[0])
  *         cdef int tr_dist = int(len(tr)/2. - 0.5)             # <<<<<<<<<<<<<<
  *         cdef int sep_dist = int(len(tr)/2. - 0.5)
  * 
  */
   __pyx_t_7 = __Pyx_MemoryView_Len(__pyx_v_tr); 
   __pyx_v_tr_dist = ((int)((((double)__pyx_t_7) / 2.) - 0.5));
 
-  /* "soapcw/soapcw.pyx":579
+  /* "soapcw/soapcw.pyx":636
  *         cdef int sep_len = len(tr[0])
  *         cdef int tr_dist = int(len(tr)/2. - 0.5)
  *         cdef int sep_dist = int(len(tr)/2. - 0.5)             # <<<<<<<<<<<<<<
  * 
  *         cdef int i
  */
   __pyx_t_7 = __Pyx_MemoryView_Len(__pyx_v_tr); 
   __pyx_v_sep_dist = ((int)((((double)__pyx_t_7) / 2.) - 0.5));
 
-  /* "soapcw/soapcw.pyx":596
+  /* "soapcw/soapcw.pyx":653
  *         cdef double value
  *         cdef double temp
  *         cdef int edge_range = 0             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __pyx_v_edge_range = 0;
 
-  /* "soapcw/soapcw.pyx":602
+  /* "soapcw/soapcw.pyx":659
  *         cdef double fact_frac
  * 
- *         likelihood, pow_ranges, frac_ranges, pow_fact, frac_fact = self.read_lookup_amp(lookup_file)             # <<<<<<<<<<<<<<
+ *         likelihood, pow_ranges, frac_ranges, pow_fact, frac_fact = self.read_lookup_amp(lookup_table)             # <<<<<<<<<<<<<<
  * 
  *         # define the likelihood as two array one which is the transpose of the other, such that the fractions of time one detector can always be compared with a value less than 1
  */
-  __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_read_lookup_amp); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 602, __pyx_L1_error)
+  __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_read_lookup_amp); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 659, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_11);
   __pyx_t_6 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_11))) {
     __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_11);
     if (likely(__pyx_t_6)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_11);
       __Pyx_INCREF(__pyx_t_6);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_11, function);
     }
   }
-  __pyx_t_3 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_11, __pyx_t_6, __pyx_v_lookup_file) : __Pyx_PyObject_CallOneArg(__pyx_t_11, __pyx_v_lookup_file);
+  __pyx_t_3 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_11, __pyx_t_6, __pyx_v_lookup_table) : __Pyx_PyObject_CallOneArg(__pyx_t_11, __pyx_v_lookup_table);
   __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
-  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 602, __pyx_L1_error)
+  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 659, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
   if ((likely(PyTuple_CheckExact(__pyx_t_3))) || (PyList_CheckExact(__pyx_t_3))) {
     PyObject* sequence = __pyx_t_3;
     Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
     if (unlikely(size != 5)) {
       if (size > 5) __Pyx_RaiseTooManyValuesError(5);
       else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
-      __PYX_ERR(0, 602, __pyx_L1_error)
+      __PYX_ERR(0, 659, __pyx_L1_error)
     }
     #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
     if (likely(PyTuple_CheckExact(sequence))) {
       __pyx_t_11 = PyTuple_GET_ITEM(sequence, 0); 
       __pyx_t_6 = PyTuple_GET_ITEM(sequence, 1); 
       __pyx_t_4 = PyTuple_GET_ITEM(sequence, 2); 
       __pyx_t_5 = PyTuple_GET_ITEM(sequence, 3); 
@@ -13537,104 +13875,104 @@
     __Pyx_INCREF(__pyx_t_5);
     __Pyx_INCREF(__pyx_t_13);
     #else
     {
       Py_ssize_t i;
       PyObject** temps[5] = {&__pyx_t_11,&__pyx_t_6,&__pyx_t_4,&__pyx_t_5,&__pyx_t_13};
       for (i=0; i < 5; i++) {
-        PyObject* item = PySequence_ITEM(sequence, i); if (unlikely(!item)) __PYX_ERR(0, 602, __pyx_L1_error)
+        PyObject* item = PySequence_ITEM(sequence, i); if (unlikely(!item)) __PYX_ERR(0, 659, __pyx_L1_error)
         __Pyx_GOTREF(item);
         *(temps[i]) = item;
       }
     }
     #endif
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   } else {
     Py_ssize_t index = -1;
     PyObject** temps[5] = {&__pyx_t_11,&__pyx_t_6,&__pyx_t_4,&__pyx_t_5,&__pyx_t_13};
-    __pyx_t_14 = PyObject_GetIter(__pyx_t_3); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 602, __pyx_L1_error)
+    __pyx_t_14 = PyObject_GetIter(__pyx_t_3); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 659, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_14);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_t_15 = Py_TYPE(__pyx_t_14)->tp_iternext;
     for (index=0; index < 5; index++) {
       PyObject* item = __pyx_t_15(__pyx_t_14); if (unlikely(!item)) goto __pyx_L3_unpacking_failed;
       __Pyx_GOTREF(item);
       *(temps[index]) = item;
     }
-    if (__Pyx_IternextUnpackEndCheck(__pyx_t_15(__pyx_t_14), 5) < 0) __PYX_ERR(0, 602, __pyx_L1_error)
+    if (__Pyx_IternextUnpackEndCheck(__pyx_t_15(__pyx_t_14), 5) < 0) __PYX_ERR(0, 659, __pyx_L1_error)
     __pyx_t_15 = NULL;
     __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
     goto __pyx_L4_unpacking_done;
     __pyx_L3_unpacking_failed:;
     __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
     __pyx_t_15 = NULL;
     if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
-    __PYX_ERR(0, 602, __pyx_L1_error)
+    __PYX_ERR(0, 659, __pyx_L1_error)
     __pyx_L4_unpacking_done:;
   }
   __pyx_v_likelihood = __pyx_t_11;
   __pyx_t_11 = 0;
   __pyx_v_pow_ranges = __pyx_t_6;
   __pyx_t_6 = 0;
   __pyx_v_frac_ranges = __pyx_t_4;
   __pyx_t_4 = 0;
   __pyx_v_pow_fact = __pyx_t_5;
   __pyx_t_5 = 0;
   __pyx_v_frac_fact = __pyx_t_13;
   __pyx_t_13 = 0;
 
-  /* "soapcw/soapcw.pyx":605
+  /* "soapcw/soapcw.pyx":662
  * 
  *         # define the likelihood as two array one which is the transpose of the other, such that the fractions of time one detector can always be compared with a value less than 1
  *         shp = np.shape(likelihood)             # <<<<<<<<<<<<<<
  *         logarr1 = np.zeros((2,shp[0],shp[1],shp[2]))
  *         logarr1[0] = likelihood
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_13, __pyx_n_s_np); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 605, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_13, __pyx_n_s_np); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 662, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_13, __pyx_n_s_shape); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 605, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_13, __pyx_n_s_shape); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 662, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
   __pyx_t_13 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
     __pyx_t_13 = PyMethod_GET_SELF(__pyx_t_5);
     if (likely(__pyx_t_13)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
       __Pyx_INCREF(__pyx_t_13);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_5, function);
     }
   }
   __pyx_t_3 = (__pyx_t_13) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_13, __pyx_v_likelihood) : __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_v_likelihood);
   __Pyx_XDECREF(__pyx_t_13); __pyx_t_13 = 0;
-  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 605, __pyx_L1_error)
+  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 662, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __pyx_v_shp = __pyx_t_3;
   __pyx_t_3 = 0;
 
-  /* "soapcw/soapcw.pyx":606
+  /* "soapcw/soapcw.pyx":663
  *         # define the likelihood as two array one which is the transpose of the other, such that the fractions of time one detector can always be compared with a value less than 1
  *         shp = np.shape(likelihood)
  *         logarr1 = np.zeros((2,shp[0],shp[1],shp[2]))             # <<<<<<<<<<<<<<
  *         logarr1[0] = likelihood
  *         logarr1[1] = ([np.array(lkl).T for lkl in likelihood])
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 606, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 663, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_zeros); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 606, __pyx_L1_error)
+  __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_zeros); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 663, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_GetItemInt(__pyx_v_shp, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 606, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_GetItemInt(__pyx_v_shp, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 663, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_4 = __Pyx_GetItemInt(__pyx_v_shp, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 606, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_GetItemInt(__pyx_v_shp, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 663, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_6 = __Pyx_GetItemInt(__pyx_v_shp, 2, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 606, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_GetItemInt(__pyx_v_shp, 2, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 663, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_11 = PyTuple_New(4); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 606, __pyx_L1_error)
+  __pyx_t_11 = PyTuple_New(4); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 663, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_11);
   __Pyx_INCREF(__pyx_int_2);
   __Pyx_GIVEREF(__pyx_int_2);
   PyTuple_SET_ITEM(__pyx_t_11, 0, __pyx_int_2);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_11, 1, __pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_4);
@@ -13653,248 +13991,248 @@
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_13, function);
     }
   }
   __pyx_t_3 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_13, __pyx_t_6, __pyx_t_11) : __Pyx_PyObject_CallOneArg(__pyx_t_13, __pyx_t_11);
   __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
-  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 606, __pyx_L1_error)
+  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 663, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
   __pyx_v_logarr1 = __pyx_t_3;
   __pyx_t_3 = 0;
 
-  /* "soapcw/soapcw.pyx":607
+  /* "soapcw/soapcw.pyx":664
  *         shp = np.shape(likelihood)
  *         logarr1 = np.zeros((2,shp[0],shp[1],shp[2]))
  *         logarr1[0] = likelihood             # <<<<<<<<<<<<<<
  *         logarr1[1] = ([np.array(lkl).T for lkl in likelihood])
  *         cdef double[:,:,:,:] logarr = logarr1
  */
-  if (unlikely(__Pyx_SetItemInt(__pyx_v_logarr1, 0, __pyx_v_likelihood, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 607, __pyx_L1_error)
+  if (unlikely(__Pyx_SetItemInt(__pyx_v_logarr1, 0, __pyx_v_likelihood, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 664, __pyx_L1_error)
 
-  /* "soapcw/soapcw.pyx":608
+  /* "soapcw/soapcw.pyx":665
  *         logarr1 = np.zeros((2,shp[0],shp[1],shp[2]))
  *         logarr1[0] = likelihood
  *         logarr1[1] = ([np.array(lkl).T for lkl in likelihood])             # <<<<<<<<<<<<<<
  *         cdef double[:,:,:,:] logarr = logarr1
  * 
  */
   { /* enter inner scope */
-    __pyx_t_3 = PyList_New(0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 608, __pyx_L7_error)
+    __pyx_t_3 = PyList_New(0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 665, __pyx_L7_error)
     __Pyx_GOTREF(__pyx_t_3);
     if (likely(PyList_CheckExact(__pyx_v_likelihood)) || PyTuple_CheckExact(__pyx_v_likelihood)) {
       __pyx_t_13 = __pyx_v_likelihood; __Pyx_INCREF(__pyx_t_13); __pyx_t_9 = 0;
       __pyx_t_16 = NULL;
     } else {
-      __pyx_t_9 = -1; __pyx_t_13 = PyObject_GetIter(__pyx_v_likelihood); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 608, __pyx_L7_error)
+      __pyx_t_9 = -1; __pyx_t_13 = PyObject_GetIter(__pyx_v_likelihood); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 665, __pyx_L7_error)
       __Pyx_GOTREF(__pyx_t_13);
-      __pyx_t_16 = Py_TYPE(__pyx_t_13)->tp_iternext; if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 608, __pyx_L7_error)
+      __pyx_t_16 = Py_TYPE(__pyx_t_13)->tp_iternext; if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 665, __pyx_L7_error)
     }
     for (;;) {
       if (likely(!__pyx_t_16)) {
         if (likely(PyList_CheckExact(__pyx_t_13))) {
           if (__pyx_t_9 >= PyList_GET_SIZE(__pyx_t_13)) break;
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-          __pyx_t_11 = PyList_GET_ITEM(__pyx_t_13, __pyx_t_9); __Pyx_INCREF(__pyx_t_11); __pyx_t_9++; if (unlikely(0 < 0)) __PYX_ERR(0, 608, __pyx_L7_error)
+          __pyx_t_11 = PyList_GET_ITEM(__pyx_t_13, __pyx_t_9); __Pyx_INCREF(__pyx_t_11); __pyx_t_9++; if (unlikely(0 < 0)) __PYX_ERR(0, 665, __pyx_L7_error)
           #else
-          __pyx_t_11 = PySequence_ITEM(__pyx_t_13, __pyx_t_9); __pyx_t_9++; if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 608, __pyx_L7_error)
+          __pyx_t_11 = PySequence_ITEM(__pyx_t_13, __pyx_t_9); __pyx_t_9++; if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 665, __pyx_L7_error)
           __Pyx_GOTREF(__pyx_t_11);
           #endif
         } else {
           if (__pyx_t_9 >= PyTuple_GET_SIZE(__pyx_t_13)) break;
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-          __pyx_t_11 = PyTuple_GET_ITEM(__pyx_t_13, __pyx_t_9); __Pyx_INCREF(__pyx_t_11); __pyx_t_9++; if (unlikely(0 < 0)) __PYX_ERR(0, 608, __pyx_L7_error)
+          __pyx_t_11 = PyTuple_GET_ITEM(__pyx_t_13, __pyx_t_9); __Pyx_INCREF(__pyx_t_11); __pyx_t_9++; if (unlikely(0 < 0)) __PYX_ERR(0, 665, __pyx_L7_error)
           #else
-          __pyx_t_11 = PySequence_ITEM(__pyx_t_13, __pyx_t_9); __pyx_t_9++; if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 608, __pyx_L7_error)
+          __pyx_t_11 = PySequence_ITEM(__pyx_t_13, __pyx_t_9); __pyx_t_9++; if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 665, __pyx_L7_error)
           __Pyx_GOTREF(__pyx_t_11);
           #endif
         }
       } else {
         __pyx_t_11 = __pyx_t_16(__pyx_t_13);
         if (unlikely(!__pyx_t_11)) {
           PyObject* exc_type = PyErr_Occurred();
           if (exc_type) {
             if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-            else __PYX_ERR(0, 608, __pyx_L7_error)
+            else __PYX_ERR(0, 665, __pyx_L7_error)
           }
           break;
         }
         __Pyx_GOTREF(__pyx_t_11);
       }
       __Pyx_XDECREF_SET(__pyx_8genexpr3__pyx_v_lkl, __pyx_t_11);
       __pyx_t_11 = 0;
-      __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 608, __pyx_L7_error)
+      __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 665, __pyx_L7_error)
       __Pyx_GOTREF(__pyx_t_6);
-      __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_array); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 608, __pyx_L7_error)
+      __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_array); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 665, __pyx_L7_error)
       __Pyx_GOTREF(__pyx_t_4);
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
       __pyx_t_6 = NULL;
       if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
         __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_4);
         if (likely(__pyx_t_6)) {
           PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
           __Pyx_INCREF(__pyx_t_6);
           __Pyx_INCREF(function);
           __Pyx_DECREF_SET(__pyx_t_4, function);
         }
       }
       __pyx_t_11 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_6, __pyx_8genexpr3__pyx_v_lkl) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_8genexpr3__pyx_v_lkl);
       __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
-      if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 608, __pyx_L7_error)
+      if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 665, __pyx_L7_error)
       __Pyx_GOTREF(__pyx_t_11);
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-      __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_11, __pyx_n_s_T); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 608, __pyx_L7_error)
+      __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_11, __pyx_n_s_T); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 665, __pyx_L7_error)
       __Pyx_GOTREF(__pyx_t_4);
       __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
-      if (unlikely(__Pyx_ListComp_Append(__pyx_t_3, (PyObject*)__pyx_t_4))) __PYX_ERR(0, 608, __pyx_L7_error)
+      if (unlikely(__Pyx_ListComp_Append(__pyx_t_3, (PyObject*)__pyx_t_4))) __PYX_ERR(0, 665, __pyx_L7_error)
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     }
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
     __Pyx_XDECREF(__pyx_8genexpr3__pyx_v_lkl); __pyx_8genexpr3__pyx_v_lkl = 0;
     goto __pyx_L10_exit_scope;
     __pyx_L7_error:;
     __Pyx_XDECREF(__pyx_8genexpr3__pyx_v_lkl); __pyx_8genexpr3__pyx_v_lkl = 0;
     goto __pyx_L1_error;
     __pyx_L10_exit_scope:;
   } /* exit inner scope */
-  if (unlikely(__Pyx_SetItemInt(__pyx_v_logarr1, 1, __pyx_t_3, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 608, __pyx_L1_error)
+  if (unlikely(__Pyx_SetItemInt(__pyx_v_logarr1, 1, __pyx_t_3, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 665, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "soapcw/soapcw.pyx":609
+  /* "soapcw/soapcw.pyx":666
  *         logarr1[0] = likelihood
  *         logarr1[1] = ([np.array(lkl).T for lkl in likelihood])
  *         cdef double[:,:,:,:] logarr = logarr1             # <<<<<<<<<<<<<<
  * 
  *         # if the fractions are above a value of 1, inverse the lookup table so that only values between 0 and 1 have to be generated.
  */
-  __pyx_t_17 = __Pyx_PyObject_to_MemoryviewSlice_dsdsdsds_double(__pyx_v_logarr1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_17.memview)) __PYX_ERR(0, 609, __pyx_L1_error)
+  __pyx_t_17 = __Pyx_PyObject_to_MemoryviewSlice_dsdsdsds_double(__pyx_v_logarr1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_17.memview)) __PYX_ERR(0, 666, __pyx_L1_error)
   __pyx_v_logarr = __pyx_t_17;
   __pyx_t_17.memview = NULL;
   __pyx_t_17.data = NULL;
 
-  /* "soapcw/soapcw.pyx":612
+  /* "soapcw/soapcw.pyx":669
  * 
  *         # if the fractions are above a value of 1, inverse the lookup table so that only values between 0 and 1 have to be generated.
  *         if len(np.shape(fractions)) == 1:             # <<<<<<<<<<<<<<
  *             fractions = np.array([np.ones(width)*i for i in fractions])
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_13, __pyx_n_s_np); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 612, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_13, __pyx_n_s_np); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 669, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_13, __pyx_n_s_shape); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 612, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_13, __pyx_n_s_shape); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 669, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
   __pyx_t_13 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
     __pyx_t_13 = PyMethod_GET_SELF(__pyx_t_4);
     if (likely(__pyx_t_13)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
       __Pyx_INCREF(__pyx_t_13);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_4, function);
     }
   }
   __pyx_t_3 = (__pyx_t_13) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_13, __pyx_v_fractions) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_v_fractions);
   __Pyx_XDECREF(__pyx_t_13); __pyx_t_13 = 0;
-  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 612, __pyx_L1_error)
+  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 669, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_9 = PyObject_Length(__pyx_t_3); if (unlikely(__pyx_t_9 == ((Py_ssize_t)-1))) __PYX_ERR(0, 612, __pyx_L1_error)
+  __pyx_t_9 = PyObject_Length(__pyx_t_3); if (unlikely(__pyx_t_9 == ((Py_ssize_t)-1))) __PYX_ERR(0, 669, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_t_18 = ((__pyx_t_9 == 1) != 0);
   if (__pyx_t_18) {
 
-    /* "soapcw/soapcw.pyx":613
+    /* "soapcw/soapcw.pyx":670
  *         # if the fractions are above a value of 1, inverse the lookup table so that only values between 0 and 1 have to be generated.
  *         if len(np.shape(fractions)) == 1:
  *             fractions = np.array([np.ones(width)*i for i in fractions])             # <<<<<<<<<<<<<<
  * 
  *         det_order1 = np.ones(np.shape(fractions)).astype(np.int32)
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 613, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 670, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_array); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 613, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_array); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 670, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     { /* enter inner scope */
-      __pyx_t_4 = PyList_New(0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 613, __pyx_L1_error)
+      __pyx_t_4 = PyList_New(0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 670, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
       if (likely(PyList_CheckExact(__pyx_v_fractions)) || PyTuple_CheckExact(__pyx_v_fractions)) {
         __pyx_t_11 = __pyx_v_fractions; __Pyx_INCREF(__pyx_t_11); __pyx_t_9 = 0;
         __pyx_t_16 = NULL;
       } else {
-        __pyx_t_9 = -1; __pyx_t_11 = PyObject_GetIter(__pyx_v_fractions); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 613, __pyx_L1_error)
+        __pyx_t_9 = -1; __pyx_t_11 = PyObject_GetIter(__pyx_v_fractions); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 670, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_11);
-        __pyx_t_16 = Py_TYPE(__pyx_t_11)->tp_iternext; if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 613, __pyx_L1_error)
+        __pyx_t_16 = Py_TYPE(__pyx_t_11)->tp_iternext; if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 670, __pyx_L1_error)
       }
       for (;;) {
         if (likely(!__pyx_t_16)) {
           if (likely(PyList_CheckExact(__pyx_t_11))) {
             if (__pyx_t_9 >= PyList_GET_SIZE(__pyx_t_11)) break;
             #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-            __pyx_t_6 = PyList_GET_ITEM(__pyx_t_11, __pyx_t_9); __Pyx_INCREF(__pyx_t_6); __pyx_t_9++; if (unlikely(0 < 0)) __PYX_ERR(0, 613, __pyx_L1_error)
+            __pyx_t_6 = PyList_GET_ITEM(__pyx_t_11, __pyx_t_9); __Pyx_INCREF(__pyx_t_6); __pyx_t_9++; if (unlikely(0 < 0)) __PYX_ERR(0, 670, __pyx_L1_error)
             #else
-            __pyx_t_6 = PySequence_ITEM(__pyx_t_11, __pyx_t_9); __pyx_t_9++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 613, __pyx_L1_error)
+            __pyx_t_6 = PySequence_ITEM(__pyx_t_11, __pyx_t_9); __pyx_t_9++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 670, __pyx_L1_error)
             __Pyx_GOTREF(__pyx_t_6);
             #endif
           } else {
             if (__pyx_t_9 >= PyTuple_GET_SIZE(__pyx_t_11)) break;
             #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-            __pyx_t_6 = PyTuple_GET_ITEM(__pyx_t_11, __pyx_t_9); __Pyx_INCREF(__pyx_t_6); __pyx_t_9++; if (unlikely(0 < 0)) __PYX_ERR(0, 613, __pyx_L1_error)
+            __pyx_t_6 = PyTuple_GET_ITEM(__pyx_t_11, __pyx_t_9); __Pyx_INCREF(__pyx_t_6); __pyx_t_9++; if (unlikely(0 < 0)) __PYX_ERR(0, 670, __pyx_L1_error)
             #else
-            __pyx_t_6 = PySequence_ITEM(__pyx_t_11, __pyx_t_9); __pyx_t_9++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 613, __pyx_L1_error)
+            __pyx_t_6 = PySequence_ITEM(__pyx_t_11, __pyx_t_9); __pyx_t_9++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 670, __pyx_L1_error)
             __Pyx_GOTREF(__pyx_t_6);
             #endif
           }
         } else {
           __pyx_t_6 = __pyx_t_16(__pyx_t_11);
           if (unlikely(!__pyx_t_6)) {
             PyObject* exc_type = PyErr_Occurred();
             if (exc_type) {
               if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-              else __PYX_ERR(0, 613, __pyx_L1_error)
+              else __PYX_ERR(0, 670, __pyx_L1_error)
             }
             break;
           }
           __Pyx_GOTREF(__pyx_t_6);
         }
-        __pyx_t_19 = __Pyx_PyInt_As_int(__pyx_t_6); if (unlikely((__pyx_t_19 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 613, __pyx_L1_error)
+        __pyx_t_19 = __Pyx_PyInt_As_int(__pyx_t_6); if (unlikely((__pyx_t_19 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 670, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __pyx_8genexpr4__pyx_v_i = __pyx_t_19;
-        __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 613, __pyx_L1_error)
+        __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 670, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_5);
-        __pyx_t_14 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_ones); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 613, __pyx_L1_error)
+        __pyx_t_14 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_ones); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 670, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_14);
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-        __pyx_t_5 = __Pyx_PyInt_From_int(__pyx_v_width); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 613, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyInt_From_int(__pyx_v_width); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 670, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_5);
         __pyx_t_20 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_14))) {
           __pyx_t_20 = PyMethod_GET_SELF(__pyx_t_14);
           if (likely(__pyx_t_20)) {
             PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_14);
             __Pyx_INCREF(__pyx_t_20);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_14, function);
           }
         }
         __pyx_t_6 = (__pyx_t_20) ? __Pyx_PyObject_Call2Args(__pyx_t_14, __pyx_t_20, __pyx_t_5) : __Pyx_PyObject_CallOneArg(__pyx_t_14, __pyx_t_5);
         __Pyx_XDECREF(__pyx_t_20); __pyx_t_20 = 0;
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-        if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 613, __pyx_L1_error)
+        if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 670, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
-        __pyx_t_14 = __Pyx_PyInt_From_int(__pyx_8genexpr4__pyx_v_i); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 613, __pyx_L1_error)
+        __pyx_t_14 = __Pyx_PyInt_From_int(__pyx_8genexpr4__pyx_v_i); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 670, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_14);
-        __pyx_t_5 = PyNumber_Multiply(__pyx_t_6, __pyx_t_14); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 613, __pyx_L1_error)
+        __pyx_t_5 = PyNumber_Multiply(__pyx_t_6, __pyx_t_14); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 670, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_5);
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
-        if (unlikely(__Pyx_ListComp_Append(__pyx_t_4, (PyObject*)__pyx_t_5))) __PYX_ERR(0, 613, __pyx_L1_error)
+        if (unlikely(__Pyx_ListComp_Append(__pyx_t_4, (PyObject*)__pyx_t_5))) __PYX_ERR(0, 670, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
       }
       __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
     } /* exit inner scope */
     __pyx_t_11 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_13))) {
       __pyx_t_11 = PyMethod_GET_SELF(__pyx_t_13);
@@ -13904,59 +14242,59 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_13, function);
       }
     }
     __pyx_t_3 = (__pyx_t_11) ? __Pyx_PyObject_Call2Args(__pyx_t_13, __pyx_t_11, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_13, __pyx_t_4);
     __Pyx_XDECREF(__pyx_t_11); __pyx_t_11 = 0;
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 613, __pyx_L1_error)
+    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 670, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
     __Pyx_DECREF_SET(__pyx_v_fractions, __pyx_t_3);
     __pyx_t_3 = 0;
 
-    /* "soapcw/soapcw.pyx":612
+    /* "soapcw/soapcw.pyx":669
  * 
  *         # if the fractions are above a value of 1, inverse the lookup table so that only values between 0 and 1 have to be generated.
  *         if len(np.shape(fractions)) == 1:             # <<<<<<<<<<<<<<
  *             fractions = np.array([np.ones(width)*i for i in fractions])
  * 
  */
   }
 
-  /* "soapcw/soapcw.pyx":615
+  /* "soapcw/soapcw.pyx":672
  *             fractions = np.array([np.ones(width)*i for i in fractions])
  * 
  *         det_order1 = np.ones(np.shape(fractions)).astype(np.int32)             # <<<<<<<<<<<<<<
  *         det_order1[fractions > 1] = int(1)
  *         det_order1[fractions <= 1] = int(0)
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 615, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 672, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_ones); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 615, __pyx_L1_error)
+  __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_ones); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 672, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_11);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 615, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 672, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_14 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_shape); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 615, __pyx_L1_error)
+  __pyx_t_14 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_shape); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 672, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_14);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __pyx_t_5 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_14))) {
     __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_14);
     if (likely(__pyx_t_5)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_14);
       __Pyx_INCREF(__pyx_t_5);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_14, function);
     }
   }
   __pyx_t_4 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_14, __pyx_t_5, __pyx_v_fractions) : __Pyx_PyObject_CallOneArg(__pyx_t_14, __pyx_v_fractions);
   __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 615, __pyx_L1_error)
+  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 672, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
   __pyx_t_14 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_11))) {
     __pyx_t_14 = PyMethod_GET_SELF(__pyx_t_11);
     if (likely(__pyx_t_14)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_11);
@@ -13964,23 +14302,23 @@
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_11, function);
     }
   }
   __pyx_t_13 = (__pyx_t_14) ? __Pyx_PyObject_Call2Args(__pyx_t_11, __pyx_t_14, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_11, __pyx_t_4);
   __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 615, __pyx_L1_error)
+  if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 672, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
   __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
-  __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_t_13, __pyx_n_s_astype); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 615, __pyx_L1_error)
+  __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_t_13, __pyx_n_s_astype); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 672, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_11);
   __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-  __Pyx_GetModuleGlobalName(__pyx_t_13, __pyx_n_s_np); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 615, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_13, __pyx_n_s_np); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 672, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_13, __pyx_n_s_int32); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 615, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_13, __pyx_n_s_int32); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 672, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
   __pyx_t_13 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_11))) {
     __pyx_t_13 = PyMethod_GET_SELF(__pyx_t_11);
     if (likely(__pyx_t_13)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_11);
@@ -13988,107 +14326,107 @@
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_11, function);
     }
   }
   __pyx_t_3 = (__pyx_t_13) ? __Pyx_PyObject_Call2Args(__pyx_t_11, __pyx_t_13, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_11, __pyx_t_4);
   __Pyx_XDECREF(__pyx_t_13); __pyx_t_13 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 615, __pyx_L1_error)
+  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 672, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
   __pyx_v_det_order1 = __pyx_t_3;
   __pyx_t_3 = 0;
 
-  /* "soapcw/soapcw.pyx":616
+  /* "soapcw/soapcw.pyx":673
  * 
  *         det_order1 = np.ones(np.shape(fractions)).astype(np.int32)
  *         det_order1[fractions > 1] = int(1)             # <<<<<<<<<<<<<<
  *         det_order1[fractions <= 1] = int(0)
  *         cdef int[:,:] det_order = det_order1
  */
-  __pyx_t_3 = __Pyx_PyNumber_Int(__pyx_int_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 616, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyNumber_Int(__pyx_int_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 673, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_11 = PyObject_RichCompare(__pyx_v_fractions, __pyx_int_1, Py_GT); __Pyx_XGOTREF(__pyx_t_11); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 616, __pyx_L1_error)
-  if (unlikely(PyObject_SetItem(__pyx_v_det_order1, __pyx_t_11, __pyx_t_3) < 0)) __PYX_ERR(0, 616, __pyx_L1_error)
+  __pyx_t_11 = PyObject_RichCompare(__pyx_v_fractions, __pyx_int_1, Py_GT); __Pyx_XGOTREF(__pyx_t_11); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 673, __pyx_L1_error)
+  if (unlikely(PyObject_SetItem(__pyx_v_det_order1, __pyx_t_11, __pyx_t_3) < 0)) __PYX_ERR(0, 673, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "soapcw/soapcw.pyx":617
+  /* "soapcw/soapcw.pyx":674
  *         det_order1 = np.ones(np.shape(fractions)).astype(np.int32)
  *         det_order1[fractions > 1] = int(1)
  *         det_order1[fractions <= 1] = int(0)             # <<<<<<<<<<<<<<
  *         cdef int[:,:] det_order = det_order1
  *         del det_order1
  */
-  __pyx_t_3 = __Pyx_PyNumber_Int(__pyx_int_0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 617, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyNumber_Int(__pyx_int_0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 674, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_11 = PyObject_RichCompare(__pyx_v_fractions, __pyx_int_1, Py_LE); __Pyx_XGOTREF(__pyx_t_11); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 617, __pyx_L1_error)
-  if (unlikely(PyObject_SetItem(__pyx_v_det_order1, __pyx_t_11, __pyx_t_3) < 0)) __PYX_ERR(0, 617, __pyx_L1_error)
+  __pyx_t_11 = PyObject_RichCompare(__pyx_v_fractions, __pyx_int_1, Py_LE); __Pyx_XGOTREF(__pyx_t_11); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 674, __pyx_L1_error)
+  if (unlikely(PyObject_SetItem(__pyx_v_det_order1, __pyx_t_11, __pyx_t_3) < 0)) __PYX_ERR(0, 674, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "soapcw/soapcw.pyx":618
+  /* "soapcw/soapcw.pyx":675
  *         det_order1[fractions > 1] = int(1)
  *         det_order1[fractions <= 1] = int(0)
  *         cdef int[:,:] det_order = det_order1             # <<<<<<<<<<<<<<
  *         del det_order1
  * 
  */
-  __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_dsds_int(__pyx_v_det_order1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_12.memview)) __PYX_ERR(0, 618, __pyx_L1_error)
+  __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_dsds_int(__pyx_v_det_order1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_12.memview)) __PYX_ERR(0, 675, __pyx_L1_error)
   __pyx_v_det_order = __pyx_t_12;
   __pyx_t_12.memview = NULL;
   __pyx_t_12.data = NULL;
 
-  /* "soapcw/soapcw.pyx":619
+  /* "soapcw/soapcw.pyx":676
  *         det_order1[fractions <= 1] = int(0)
  *         cdef int[:,:] det_order = det_order1
  *         del det_order1             # <<<<<<<<<<<<<<
  * 
  *         fractions[fractions > 1] = 1./fractions[fractions > 1]
  */
   __Pyx_DECREF(__pyx_v_det_order1);
   __pyx_v_det_order1 = NULL;
 
-  /* "soapcw/soapcw.pyx":621
+  /* "soapcw/soapcw.pyx":678
  *         del det_order1
  * 
  *         fractions[fractions > 1] = 1./fractions[fractions > 1]             # <<<<<<<<<<<<<<
  * 
  *         # make sure the fractions are the same dimensions as the input data and convert into an index
  */
-  __pyx_t_3 = PyObject_RichCompare(__pyx_v_fractions, __pyx_int_1, Py_GT); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 621, __pyx_L1_error)
-  __pyx_t_11 = __Pyx_PyObject_GetItem(__pyx_v_fractions, __pyx_t_3); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 621, __pyx_L1_error)
+  __pyx_t_3 = PyObject_RichCompare(__pyx_v_fractions, __pyx_int_1, Py_GT); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 678, __pyx_L1_error)
+  __pyx_t_11 = __Pyx_PyObject_GetItem(__pyx_v_fractions, __pyx_t_3); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 678, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_11);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = __Pyx_PyFloat_TrueDivideCObj(__pyx_float_1_, __pyx_t_11, 1., 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 621, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyFloat_TrueDivideCObj(__pyx_float_1_, __pyx_t_11, 1., 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 678, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
-  __pyx_t_11 = PyObject_RichCompare(__pyx_v_fractions, __pyx_int_1, Py_GT); __Pyx_XGOTREF(__pyx_t_11); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 621, __pyx_L1_error)
-  if (unlikely(PyObject_SetItem(__pyx_v_fractions, __pyx_t_11, __pyx_t_3) < 0)) __PYX_ERR(0, 621, __pyx_L1_error)
+  __pyx_t_11 = PyObject_RichCompare(__pyx_v_fractions, __pyx_int_1, Py_GT); __Pyx_XGOTREF(__pyx_t_11); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 678, __pyx_L1_error)
+  if (unlikely(PyObject_SetItem(__pyx_v_fractions, __pyx_t_11, __pyx_t_3) < 0)) __PYX_ERR(0, 678, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "soapcw/soapcw.pyx":624
+  /* "soapcw/soapcw.pyx":681
  * 
  *         # make sure the fractions are the same dimensions as the input data and convert into an index
  *         frac_ind1 = np.array((fractions-frac_ranges[0])*frac_fact).astype(np.int32)             # <<<<<<<<<<<<<<
  *         frac_ind1[frac_ind1 < 0] = 0
  *         frac_ind1[frac_ind1 >= len(frac_ranges)] = -1
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 624, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 681, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_array); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 624, __pyx_L1_error)
+  __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_array); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 681, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_GetItemInt(__pyx_v_frac_ranges, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 624, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_GetItemInt(__pyx_v_frac_ranges, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 681, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_14 = PyNumber_Subtract(__pyx_v_fractions, __pyx_t_4); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 624, __pyx_L1_error)
+  __pyx_t_14 = PyNumber_Subtract(__pyx_v_fractions, __pyx_t_4); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 681, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_14);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = PyNumber_Multiply(__pyx_t_14, __pyx_v_frac_fact); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 624, __pyx_L1_error)
+  __pyx_t_4 = PyNumber_Multiply(__pyx_t_14, __pyx_v_frac_fact); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 681, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
   __pyx_t_14 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_13))) {
     __pyx_t_14 = PyMethod_GET_SELF(__pyx_t_13);
     if (likely(__pyx_t_14)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_13);
@@ -14096,23 +14434,23 @@
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_13, function);
     }
   }
   __pyx_t_11 = (__pyx_t_14) ? __Pyx_PyObject_Call2Args(__pyx_t_13, __pyx_t_14, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_13, __pyx_t_4);
   __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 624, __pyx_L1_error)
+  if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 681, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_11);
   __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-  __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_11, __pyx_n_s_astype); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 624, __pyx_L1_error)
+  __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_11, __pyx_n_s_astype); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 681, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
   __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
-  __Pyx_GetModuleGlobalName(__pyx_t_11, __pyx_n_s_np); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 624, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_11, __pyx_n_s_np); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 681, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_11);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_11, __pyx_n_s_int32); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 624, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_11, __pyx_n_s_int32); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 681, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
   __pyx_t_11 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_13))) {
     __pyx_t_11 = PyMethod_GET_SELF(__pyx_t_13);
     if (likely(__pyx_t_11)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_13);
@@ -14120,145 +14458,145 @@
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_13, function);
     }
   }
   __pyx_t_3 = (__pyx_t_11) ? __Pyx_PyObject_Call2Args(__pyx_t_13, __pyx_t_11, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_13, __pyx_t_4);
   __Pyx_XDECREF(__pyx_t_11); __pyx_t_11 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 624, __pyx_L1_error)
+  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 681, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
   __pyx_v_frac_ind1 = __pyx_t_3;
   __pyx_t_3 = 0;
 
-  /* "soapcw/soapcw.pyx":625
+  /* "soapcw/soapcw.pyx":682
  *         # make sure the fractions are the same dimensions as the input data and convert into an index
  *         frac_ind1 = np.array((fractions-frac_ranges[0])*frac_fact).astype(np.int32)
  *         frac_ind1[frac_ind1 < 0] = 0             # <<<<<<<<<<<<<<
  *         frac_ind1[frac_ind1 >= len(frac_ranges)] = -1
  *         cdef int[:,:] frac_ind = frac_ind1
  */
-  __pyx_t_3 = PyObject_RichCompare(__pyx_v_frac_ind1, __pyx_int_0, Py_LT); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 625, __pyx_L1_error)
-  if (unlikely(PyObject_SetItem(__pyx_v_frac_ind1, __pyx_t_3, __pyx_int_0) < 0)) __PYX_ERR(0, 625, __pyx_L1_error)
+  __pyx_t_3 = PyObject_RichCompare(__pyx_v_frac_ind1, __pyx_int_0, Py_LT); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 682, __pyx_L1_error)
+  if (unlikely(PyObject_SetItem(__pyx_v_frac_ind1, __pyx_t_3, __pyx_int_0) < 0)) __PYX_ERR(0, 682, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "soapcw/soapcw.pyx":626
+  /* "soapcw/soapcw.pyx":683
  *         frac_ind1 = np.array((fractions-frac_ranges[0])*frac_fact).astype(np.int32)
  *         frac_ind1[frac_ind1 < 0] = 0
  *         frac_ind1[frac_ind1 >= len(frac_ranges)] = -1             # <<<<<<<<<<<<<<
  *         cdef int[:,:] frac_ind = frac_ind1
  *         del frac_ind1
  */
-  __pyx_t_9 = PyObject_Length(__pyx_v_frac_ranges); if (unlikely(__pyx_t_9 == ((Py_ssize_t)-1))) __PYX_ERR(0, 626, __pyx_L1_error)
-  __pyx_t_3 = PyInt_FromSsize_t(__pyx_t_9); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 626, __pyx_L1_error)
+  __pyx_t_9 = PyObject_Length(__pyx_v_frac_ranges); if (unlikely(__pyx_t_9 == ((Py_ssize_t)-1))) __PYX_ERR(0, 683, __pyx_L1_error)
+  __pyx_t_3 = PyInt_FromSsize_t(__pyx_t_9); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 683, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_13 = PyObject_RichCompare(__pyx_v_frac_ind1, __pyx_t_3, Py_GE); __Pyx_XGOTREF(__pyx_t_13); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 626, __pyx_L1_error)
+  __pyx_t_13 = PyObject_RichCompare(__pyx_v_frac_ind1, __pyx_t_3, Py_GE); __Pyx_XGOTREF(__pyx_t_13); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 683, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (unlikely(PyObject_SetItem(__pyx_v_frac_ind1, __pyx_t_13, __pyx_int_neg_1) < 0)) __PYX_ERR(0, 626, __pyx_L1_error)
+  if (unlikely(PyObject_SetItem(__pyx_v_frac_ind1, __pyx_t_13, __pyx_int_neg_1) < 0)) __PYX_ERR(0, 683, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
 
-  /* "soapcw/soapcw.pyx":627
+  /* "soapcw/soapcw.pyx":684
  *         frac_ind1[frac_ind1 < 0] = 0
  *         frac_ind1[frac_ind1 >= len(frac_ranges)] = -1
  *         cdef int[:,:] frac_ind = frac_ind1             # <<<<<<<<<<<<<<
  *         del frac_ind1
  * 
  */
-  __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_dsds_int(__pyx_v_frac_ind1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_12.memview)) __PYX_ERR(0, 627, __pyx_L1_error)
+  __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_dsds_int(__pyx_v_frac_ind1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_12.memview)) __PYX_ERR(0, 684, __pyx_L1_error)
   __pyx_v_frac_ind = __pyx_t_12;
   __pyx_t_12.memview = NULL;
   __pyx_t_12.data = NULL;
 
-  /* "soapcw/soapcw.pyx":628
+  /* "soapcw/soapcw.pyx":685
  *         frac_ind1[frac_ind1 >= len(frac_ranges)] = -1
  *         cdef int[:,:] frac_ind = frac_ind1
  *         del frac_ind1             # <<<<<<<<<<<<<<
  * 
  *         obs1_ind_arr = (obs11 - pow_ranges[0])*pow_fact
  */
   __Pyx_DECREF(__pyx_v_frac_ind1);
   __pyx_v_frac_ind1 = NULL;
 
-  /* "soapcw/soapcw.pyx":630
+  /* "soapcw/soapcw.pyx":687
  *         del frac_ind1
  * 
  *         obs1_ind_arr = (obs11 - pow_ranges[0])*pow_fact             # <<<<<<<<<<<<<<
  *         obs1_ind_arr[obs1_ind_arr >= len(pow_ranges)] = -1
  *         obs1_ind_arr[obs1_ind_arr < 0] = 0
  */
-  __pyx_t_13 = __Pyx_GetItemInt(__pyx_v_pow_ranges, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 630, __pyx_L1_error)
+  __pyx_t_13 = __Pyx_GetItemInt(__pyx_v_pow_ranges, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 687, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
-  __pyx_t_3 = PyNumber_Subtract(__pyx_v_obs11, __pyx_t_13); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 630, __pyx_L1_error)
+  __pyx_t_3 = PyNumber_Subtract(__pyx_v_obs11, __pyx_t_13); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 687, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-  __pyx_t_13 = PyNumber_Multiply(__pyx_t_3, __pyx_v_pow_fact); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 630, __pyx_L1_error)
+  __pyx_t_13 = PyNumber_Multiply(__pyx_t_3, __pyx_v_pow_fact); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 687, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_v_obs1_ind_arr = __pyx_t_13;
   __pyx_t_13 = 0;
 
-  /* "soapcw/soapcw.pyx":631
+  /* "soapcw/soapcw.pyx":688
  * 
  *         obs1_ind_arr = (obs11 - pow_ranges[0])*pow_fact
  *         obs1_ind_arr[obs1_ind_arr >= len(pow_ranges)] = -1             # <<<<<<<<<<<<<<
  *         obs1_ind_arr[obs1_ind_arr < 0] = 0
  *         cdef int[:,:] obs1_ind = np.array(obs1_ind_arr).astype(np.int32)
  */
-  __pyx_t_9 = PyObject_Length(__pyx_v_pow_ranges); if (unlikely(__pyx_t_9 == ((Py_ssize_t)-1))) __PYX_ERR(0, 631, __pyx_L1_error)
-  __pyx_t_13 = PyInt_FromSsize_t(__pyx_t_9); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 631, __pyx_L1_error)
+  __pyx_t_9 = PyObject_Length(__pyx_v_pow_ranges); if (unlikely(__pyx_t_9 == ((Py_ssize_t)-1))) __PYX_ERR(0, 688, __pyx_L1_error)
+  __pyx_t_13 = PyInt_FromSsize_t(__pyx_t_9); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 688, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
-  __pyx_t_3 = PyObject_RichCompare(__pyx_v_obs1_ind_arr, __pyx_t_13, Py_GE); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 631, __pyx_L1_error)
+  __pyx_t_3 = PyObject_RichCompare(__pyx_v_obs1_ind_arr, __pyx_t_13, Py_GE); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 688, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-  if (unlikely(PyObject_SetItem(__pyx_v_obs1_ind_arr, __pyx_t_3, __pyx_int_neg_1) < 0)) __PYX_ERR(0, 631, __pyx_L1_error)
+  if (unlikely(PyObject_SetItem(__pyx_v_obs1_ind_arr, __pyx_t_3, __pyx_int_neg_1) < 0)) __PYX_ERR(0, 688, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "soapcw/soapcw.pyx":632
+  /* "soapcw/soapcw.pyx":689
  *         obs1_ind_arr = (obs11 - pow_ranges[0])*pow_fact
  *         obs1_ind_arr[obs1_ind_arr >= len(pow_ranges)] = -1
  *         obs1_ind_arr[obs1_ind_arr < 0] = 0             # <<<<<<<<<<<<<<
  *         cdef int[:,:] obs1_ind = np.array(obs1_ind_arr).astype(np.int32)
  *         del obs1_ind_arr
  */
-  __pyx_t_3 = PyObject_RichCompare(__pyx_v_obs1_ind_arr, __pyx_int_0, Py_LT); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 632, __pyx_L1_error)
-  if (unlikely(PyObject_SetItem(__pyx_v_obs1_ind_arr, __pyx_t_3, __pyx_int_0) < 0)) __PYX_ERR(0, 632, __pyx_L1_error)
+  __pyx_t_3 = PyObject_RichCompare(__pyx_v_obs1_ind_arr, __pyx_int_0, Py_LT); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 689, __pyx_L1_error)
+  if (unlikely(PyObject_SetItem(__pyx_v_obs1_ind_arr, __pyx_t_3, __pyx_int_0) < 0)) __PYX_ERR(0, 689, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "soapcw/soapcw.pyx":633
+  /* "soapcw/soapcw.pyx":690
  *         obs1_ind_arr[obs1_ind_arr >= len(pow_ranges)] = -1
  *         obs1_ind_arr[obs1_ind_arr < 0] = 0
  *         cdef int[:,:] obs1_ind = np.array(obs1_ind_arr).astype(np.int32)             # <<<<<<<<<<<<<<
  *         del obs1_ind_arr
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 633, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 690, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_array); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 633, __pyx_L1_error)
+  __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_array); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 690, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_11);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_t_4 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_11))) {
     __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_11);
     if (likely(__pyx_t_4)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_11);
       __Pyx_INCREF(__pyx_t_4);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_11, function);
     }
   }
   __pyx_t_13 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_11, __pyx_t_4, __pyx_v_obs1_ind_arr) : __Pyx_PyObject_CallOneArg(__pyx_t_11, __pyx_v_obs1_ind_arr);
   __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 633, __pyx_L1_error)
+  if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 690, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
   __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
-  __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_t_13, __pyx_n_s_astype); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 633, __pyx_L1_error)
+  __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_t_13, __pyx_n_s_astype); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 690, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_11);
   __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-  __Pyx_GetModuleGlobalName(__pyx_t_13, __pyx_n_s_np); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 633, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_13, __pyx_n_s_np); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 690, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_13, __pyx_n_s_int32); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 633, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_13, __pyx_n_s_int32); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 690, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
   __pyx_t_13 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_11))) {
     __pyx_t_13 = PyMethod_GET_SELF(__pyx_t_11);
     if (likely(__pyx_t_13)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_11);
@@ -14266,110 +14604,110 @@
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_11, function);
     }
   }
   __pyx_t_3 = (__pyx_t_13) ? __Pyx_PyObject_Call2Args(__pyx_t_11, __pyx_t_13, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_11, __pyx_t_4);
   __Pyx_XDECREF(__pyx_t_13); __pyx_t_13 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 633, __pyx_L1_error)
+  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 690, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
-  __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_dsds_int(__pyx_t_3, PyBUF_WRITABLE); if (unlikely(!__pyx_t_12.memview)) __PYX_ERR(0, 633, __pyx_L1_error)
+  __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_dsds_int(__pyx_t_3, PyBUF_WRITABLE); if (unlikely(!__pyx_t_12.memview)) __PYX_ERR(0, 690, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_v_obs1_ind = __pyx_t_12;
   __pyx_t_12.memview = NULL;
   __pyx_t_12.data = NULL;
 
-  /* "soapcw/soapcw.pyx":634
+  /* "soapcw/soapcw.pyx":691
  *         obs1_ind_arr[obs1_ind_arr < 0] = 0
  *         cdef int[:,:] obs1_ind = np.array(obs1_ind_arr).astype(np.int32)
  *         del obs1_ind_arr             # <<<<<<<<<<<<<<
  * 
  *         obs2_ind_arr = (obs21-pow_ranges[0])*pow_fact
  */
   __Pyx_DECREF(__pyx_v_obs1_ind_arr);
   __pyx_v_obs1_ind_arr = NULL;
 
-  /* "soapcw/soapcw.pyx":636
+  /* "soapcw/soapcw.pyx":693
  *         del obs1_ind_arr
  * 
  *         obs2_ind_arr = (obs21-pow_ranges[0])*pow_fact             # <<<<<<<<<<<<<<
  *         obs2_ind_arr[obs2_ind_arr >= len(pow_ranges)] = -1
  *         obs2_ind_arr[obs2_ind_arr < 0] = 0
  */
-  __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_pow_ranges, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 636, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_pow_ranges, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 693, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_11 = PyNumber_Subtract(__pyx_v_obs21, __pyx_t_3); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 636, __pyx_L1_error)
+  __pyx_t_11 = PyNumber_Subtract(__pyx_v_obs21, __pyx_t_3); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 693, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_11);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = PyNumber_Multiply(__pyx_t_11, __pyx_v_pow_fact); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 636, __pyx_L1_error)
+  __pyx_t_3 = PyNumber_Multiply(__pyx_t_11, __pyx_v_pow_fact); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 693, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
   __pyx_v_obs2_ind_arr = __pyx_t_3;
   __pyx_t_3 = 0;
 
-  /* "soapcw/soapcw.pyx":637
+  /* "soapcw/soapcw.pyx":694
  * 
  *         obs2_ind_arr = (obs21-pow_ranges[0])*pow_fact
  *         obs2_ind_arr[obs2_ind_arr >= len(pow_ranges)] = -1             # <<<<<<<<<<<<<<
  *         obs2_ind_arr[obs2_ind_arr < 0] = 0
  *         cdef int[:,:] obs2_ind = np.array(obs2_ind_arr).astype(np.int32)
  */
-  __pyx_t_9 = PyObject_Length(__pyx_v_pow_ranges); if (unlikely(__pyx_t_9 == ((Py_ssize_t)-1))) __PYX_ERR(0, 637, __pyx_L1_error)
-  __pyx_t_3 = PyInt_FromSsize_t(__pyx_t_9); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 637, __pyx_L1_error)
+  __pyx_t_9 = PyObject_Length(__pyx_v_pow_ranges); if (unlikely(__pyx_t_9 == ((Py_ssize_t)-1))) __PYX_ERR(0, 694, __pyx_L1_error)
+  __pyx_t_3 = PyInt_FromSsize_t(__pyx_t_9); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 694, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_11 = PyObject_RichCompare(__pyx_v_obs2_ind_arr, __pyx_t_3, Py_GE); __Pyx_XGOTREF(__pyx_t_11); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 637, __pyx_L1_error)
+  __pyx_t_11 = PyObject_RichCompare(__pyx_v_obs2_ind_arr, __pyx_t_3, Py_GE); __Pyx_XGOTREF(__pyx_t_11); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 694, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (unlikely(PyObject_SetItem(__pyx_v_obs2_ind_arr, __pyx_t_11, __pyx_int_neg_1) < 0)) __PYX_ERR(0, 637, __pyx_L1_error)
+  if (unlikely(PyObject_SetItem(__pyx_v_obs2_ind_arr, __pyx_t_11, __pyx_int_neg_1) < 0)) __PYX_ERR(0, 694, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
 
-  /* "soapcw/soapcw.pyx":638
+  /* "soapcw/soapcw.pyx":695
  *         obs2_ind_arr = (obs21-pow_ranges[0])*pow_fact
  *         obs2_ind_arr[obs2_ind_arr >= len(pow_ranges)] = -1
  *         obs2_ind_arr[obs2_ind_arr < 0] = 0             # <<<<<<<<<<<<<<
  *         cdef int[:,:] obs2_ind = np.array(obs2_ind_arr).astype(np.int32)
  *         del obs2_ind_arr
  */
-  __pyx_t_11 = PyObject_RichCompare(__pyx_v_obs2_ind_arr, __pyx_int_0, Py_LT); __Pyx_XGOTREF(__pyx_t_11); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 638, __pyx_L1_error)
-  if (unlikely(PyObject_SetItem(__pyx_v_obs2_ind_arr, __pyx_t_11, __pyx_int_0) < 0)) __PYX_ERR(0, 638, __pyx_L1_error)
+  __pyx_t_11 = PyObject_RichCompare(__pyx_v_obs2_ind_arr, __pyx_int_0, Py_LT); __Pyx_XGOTREF(__pyx_t_11); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 695, __pyx_L1_error)
+  if (unlikely(PyObject_SetItem(__pyx_v_obs2_ind_arr, __pyx_t_11, __pyx_int_0) < 0)) __PYX_ERR(0, 695, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
 
-  /* "soapcw/soapcw.pyx":639
+  /* "soapcw/soapcw.pyx":696
  *         obs2_ind_arr[obs2_ind_arr >= len(pow_ranges)] = -1
  *         obs2_ind_arr[obs2_ind_arr < 0] = 0
  *         cdef int[:,:] obs2_ind = np.array(obs2_ind_arr).astype(np.int32)             # <<<<<<<<<<<<<<
  *         del obs2_ind_arr
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 639, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 696, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_array); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 639, __pyx_L1_error)
+  __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_array); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 696, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_t_4 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_13))) {
     __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_13);
     if (likely(__pyx_t_4)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_13);
       __Pyx_INCREF(__pyx_t_4);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_13, function);
     }
   }
   __pyx_t_3 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_13, __pyx_t_4, __pyx_v_obs2_ind_arr) : __Pyx_PyObject_CallOneArg(__pyx_t_13, __pyx_v_obs2_ind_arr);
   __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 639, __pyx_L1_error)
+  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 696, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-  __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_astype); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 639, __pyx_L1_error)
+  __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_astype); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 696, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 639, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 696, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_int32); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 639, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_int32); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 696, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_t_3 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_13))) {
     __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_13);
     if (likely(__pyx_t_3)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_13);
@@ -14377,67 +14715,67 @@
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_13, function);
     }
   }
   __pyx_t_11 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_13, __pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_13, __pyx_t_4);
   __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 639, __pyx_L1_error)
+  if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 696, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_11);
   __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-  __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_dsds_int(__pyx_t_11, PyBUF_WRITABLE); if (unlikely(!__pyx_t_12.memview)) __PYX_ERR(0, 639, __pyx_L1_error)
+  __pyx_t_12 = __Pyx_PyObject_to_MemoryviewSlice_dsds_int(__pyx_t_11, PyBUF_WRITABLE); if (unlikely(!__pyx_t_12.memview)) __PYX_ERR(0, 696, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
   __pyx_v_obs2_ind = __pyx_t_12;
   __pyx_t_12.memview = NULL;
   __pyx_t_12.data = NULL;
 
-  /* "soapcw/soapcw.pyx":640
+  /* "soapcw/soapcw.pyx":697
  *         obs2_ind_arr[obs2_ind_arr < 0] = 0
  *         cdef int[:,:] obs2_ind = np.array(obs2_ind_arr).astype(np.int32)
  *         del obs2_ind_arr             # <<<<<<<<<<<<<<
  * 
  *         for i in range(width):
  */
   __Pyx_DECREF(__pyx_v_obs2_ind_arr);
   __pyx_v_obs2_ind_arr = NULL;
 
-  /* "soapcw/soapcw.pyx":642
+  /* "soapcw/soapcw.pyx":699
  *         del obs2_ind_arr
  * 
  *         for i in range(width):             # <<<<<<<<<<<<<<
  *             temp = -1e6
  *             for k in range(sep_len):
  */
   __pyx_t_19 = __pyx_v_width;
   __pyx_t_21 = __pyx_t_19;
   for (__pyx_t_22 = 0; __pyx_t_22 < __pyx_t_21; __pyx_t_22+=1) {
     __pyx_v_i = __pyx_t_22;
 
-    /* "soapcw/soapcw.pyx":643
+    /* "soapcw/soapcw.pyx":700
  * 
  *         for i in range(width):
  *             temp = -1e6             # <<<<<<<<<<<<<<
  *             for k in range(sep_len):
  *                 if i+k-sep_dist>=0+edge_range and i+k-sep_dist<width-edge_range:
  */
     __pyx_v_temp = -1e6;
 
-    /* "soapcw/soapcw.pyx":644
+    /* "soapcw/soapcw.pyx":701
  *         for i in range(width):
  *             temp = -1e6
  *             for k in range(sep_len):             # <<<<<<<<<<<<<<
  *                 if i+k-sep_dist>=0+edge_range and i+k-sep_dist<width-edge_range:
  *                     for m in range(sep_len):
  */
     __pyx_t_23 = __pyx_v_sep_len;
     __pyx_t_24 = __pyx_t_23;
     for (__pyx_t_25 = 0; __pyx_t_25 < __pyx_t_24; __pyx_t_25+=1) {
       __pyx_v_k = __pyx_t_25;
 
-      /* "soapcw/soapcw.pyx":645
+      /* "soapcw/soapcw.pyx":702
  *             temp = -1e6
  *             for k in range(sep_len):
  *                 if i+k-sep_dist>=0+edge_range and i+k-sep_dist<width-edge_range:             # <<<<<<<<<<<<<<
  *                     for m in range(sep_len):
  *                         if i+m-sep_dist>=0+edge_range and i+m-sep_dist<width-edge_range:
  */
       __pyx_t_26 = ((((__pyx_v_i + __pyx_v_k) - __pyx_v_sep_dist) >= (0 + __pyx_v_edge_range)) != 0);
@@ -14447,27 +14785,27 @@
         goto __pyx_L19_bool_binop_done;
       }
       __pyx_t_26 = ((((__pyx_v_i + __pyx_v_k) - __pyx_v_sep_dist) < (__pyx_v_width - __pyx_v_edge_range)) != 0);
       __pyx_t_18 = __pyx_t_26;
       __pyx_L19_bool_binop_done:;
       if (__pyx_t_18) {
 
-        /* "soapcw/soapcw.pyx":646
+        /* "soapcw/soapcw.pyx":703
  *             for k in range(sep_len):
  *                 if i+k-sep_dist>=0+edge_range and i+k-sep_dist<width-edge_range:
  *                     for m in range(sep_len):             # <<<<<<<<<<<<<<
  *                         if i+m-sep_dist>=0+edge_range and i+m-sep_dist<width-edge_range:
  *                             o1 = int(obs1_ind[0][i+k-sep_dist])
  */
         __pyx_t_27 = __pyx_v_sep_len;
         __pyx_t_28 = __pyx_t_27;
         for (__pyx_t_29 = 0; __pyx_t_29 < __pyx_t_28; __pyx_t_29+=1) {
           __pyx_v_m = __pyx_t_29;
 
-          /* "soapcw/soapcw.pyx":647
+          /* "soapcw/soapcw.pyx":704
  *                 if i+k-sep_dist>=0+edge_range and i+k-sep_dist<width-edge_range:
  *                     for m in range(sep_len):
  *                         if i+m-sep_dist>=0+edge_range and i+m-sep_dist<width-edge_range:             # <<<<<<<<<<<<<<
  *                             o1 = int(obs1_ind[0][i+k-sep_dist])
  *                             o2 = int(obs2_ind[0][i+m-sep_dist])
  */
           __pyx_t_26 = ((((__pyx_v_i + __pyx_v_m) - __pyx_v_sep_dist) >= (0 + __pyx_v_edge_range)) != 0);
@@ -14477,15 +14815,15 @@
             goto __pyx_L24_bool_binop_done;
           }
           __pyx_t_26 = ((((__pyx_v_i + __pyx_v_m) - __pyx_v_sep_dist) < (__pyx_v_width - __pyx_v_edge_range)) != 0);
           __pyx_t_18 = __pyx_t_26;
           __pyx_L24_bool_binop_done:;
           if (__pyx_t_18) {
 
-            /* "soapcw/soapcw.pyx":648
+            /* "soapcw/soapcw.pyx":705
  *                     for m in range(sep_len):
  *                         if i+m-sep_dist>=0+edge_range and i+m-sep_dist<width-edge_range:
  *                             o1 = int(obs1_ind[0][i+k-sep_dist])             # <<<<<<<<<<<<<<
  *                             o2 = int(obs2_ind[0][i+m-sep_dist])
  *                             value = tr[1][k][m] + logarr[det_order[0,i],frac_ind[0,i],o1,o2]
  */
             __pyx_t_30 = 0;
@@ -14497,19 +14835,19 @@
             } else if (unlikely(__pyx_t_30 >= __pyx_v_obs1_ind.shape[0])) __pyx_t_32 = 0;
             if (__pyx_t_31 < 0) {
               __pyx_t_31 += __pyx_v_obs1_ind.shape[1];
               if (unlikely(__pyx_t_31 < 0)) __pyx_t_32 = 1;
             } else if (unlikely(__pyx_t_31 >= __pyx_v_obs1_ind.shape[1])) __pyx_t_32 = 1;
             if (unlikely(__pyx_t_32 != -1)) {
               __Pyx_RaiseBufferIndexError(__pyx_t_32);
-              __PYX_ERR(0, 648, __pyx_L1_error)
+              __PYX_ERR(0, 705, __pyx_L1_error)
             }
             __pyx_v_o1 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_obs1_ind.data + __pyx_t_30 * __pyx_v_obs1_ind.strides[0]) ) + __pyx_t_31 * __pyx_v_obs1_ind.strides[1]) )));
 
-            /* "soapcw/soapcw.pyx":649
+            /* "soapcw/soapcw.pyx":706
  *                         if i+m-sep_dist>=0+edge_range and i+m-sep_dist<width-edge_range:
  *                             o1 = int(obs1_ind[0][i+k-sep_dist])
  *                             o2 = int(obs2_ind[0][i+m-sep_dist])             # <<<<<<<<<<<<<<
  *                             value = tr[1][k][m] + logarr[det_order[0,i],frac_ind[0,i],o1,o2]
  *                             if value > temp:
  */
             __pyx_t_31 = 0;
@@ -14521,19 +14859,19 @@
             } else if (unlikely(__pyx_t_31 >= __pyx_v_obs2_ind.shape[0])) __pyx_t_32 = 0;
             if (__pyx_t_30 < 0) {
               __pyx_t_30 += __pyx_v_obs2_ind.shape[1];
               if (unlikely(__pyx_t_30 < 0)) __pyx_t_32 = 1;
             } else if (unlikely(__pyx_t_30 >= __pyx_v_obs2_ind.shape[1])) __pyx_t_32 = 1;
             if (unlikely(__pyx_t_32 != -1)) {
               __Pyx_RaiseBufferIndexError(__pyx_t_32);
-              __PYX_ERR(0, 649, __pyx_L1_error)
+              __PYX_ERR(0, 706, __pyx_L1_error)
             }
             __pyx_v_o2 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_obs2_ind.data + __pyx_t_31 * __pyx_v_obs2_ind.strides[0]) ) + __pyx_t_30 * __pyx_v_obs2_ind.strides[1]) )));
 
-            /* "soapcw/soapcw.pyx":650
+            /* "soapcw/soapcw.pyx":707
  *                             o1 = int(obs1_ind[0][i+k-sep_dist])
  *                             o2 = int(obs2_ind[0][i+m-sep_dist])
  *                             value = tr[1][k][m] + logarr[det_order[0,i],frac_ind[0,i],o1,o2]             # <<<<<<<<<<<<<<
  *                             if value > temp:
  *                                 temp = value
  */
             __pyx_t_30 = 1;
@@ -14550,45 +14888,45 @@
             } else if (unlikely(__pyx_t_31 >= __pyx_v_tr.shape[1])) __pyx_t_32 = 1;
             if (__pyx_t_33 < 0) {
               __pyx_t_33 += __pyx_v_tr.shape[2];
               if (unlikely(__pyx_t_33 < 0)) __pyx_t_32 = 2;
             } else if (unlikely(__pyx_t_33 >= __pyx_v_tr.shape[2])) __pyx_t_32 = 2;
             if (unlikely(__pyx_t_32 != -1)) {
               __Pyx_RaiseBufferIndexError(__pyx_t_32);
-              __PYX_ERR(0, 650, __pyx_L1_error)
+              __PYX_ERR(0, 707, __pyx_L1_error)
             }
             __pyx_t_34 = 0;
             __pyx_t_35 = __pyx_v_i;
             __pyx_t_32 = -1;
             if (__pyx_t_34 < 0) {
               __pyx_t_34 += __pyx_v_det_order.shape[0];
               if (unlikely(__pyx_t_34 < 0)) __pyx_t_32 = 0;
             } else if (unlikely(__pyx_t_34 >= __pyx_v_det_order.shape[0])) __pyx_t_32 = 0;
             if (__pyx_t_35 < 0) {
               __pyx_t_35 += __pyx_v_det_order.shape[1];
               if (unlikely(__pyx_t_35 < 0)) __pyx_t_32 = 1;
             } else if (unlikely(__pyx_t_35 >= __pyx_v_det_order.shape[1])) __pyx_t_32 = 1;
             if (unlikely(__pyx_t_32 != -1)) {
               __Pyx_RaiseBufferIndexError(__pyx_t_32);
-              __PYX_ERR(0, 650, __pyx_L1_error)
+              __PYX_ERR(0, 707, __pyx_L1_error)
             }
             __pyx_t_36 = 0;
             __pyx_t_37 = __pyx_v_i;
             __pyx_t_32 = -1;
             if (__pyx_t_36 < 0) {
               __pyx_t_36 += __pyx_v_frac_ind.shape[0];
               if (unlikely(__pyx_t_36 < 0)) __pyx_t_32 = 0;
             } else if (unlikely(__pyx_t_36 >= __pyx_v_frac_ind.shape[0])) __pyx_t_32 = 0;
             if (__pyx_t_37 < 0) {
               __pyx_t_37 += __pyx_v_frac_ind.shape[1];
               if (unlikely(__pyx_t_37 < 0)) __pyx_t_32 = 1;
             } else if (unlikely(__pyx_t_37 >= __pyx_v_frac_ind.shape[1])) __pyx_t_32 = 1;
             if (unlikely(__pyx_t_32 != -1)) {
               __Pyx_RaiseBufferIndexError(__pyx_t_32);
-              __PYX_ERR(0, 650, __pyx_L1_error)
+              __PYX_ERR(0, 707, __pyx_L1_error)
             }
             __pyx_t_38 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_det_order.data + __pyx_t_34 * __pyx_v_det_order.strides[0]) ) + __pyx_t_35 * __pyx_v_det_order.strides[1]) )));
             __pyx_t_39 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_frac_ind.data + __pyx_t_36 * __pyx_v_frac_ind.strides[0]) ) + __pyx_t_37 * __pyx_v_frac_ind.strides[1]) )));
             __pyx_t_40 = __pyx_v_o1;
             __pyx_t_41 = __pyx_v_o2;
             __pyx_t_32 = -1;
             if (__pyx_t_38 < 0) {
@@ -14605,38 +14943,38 @@
             } else if (unlikely(__pyx_t_40 >= __pyx_v_logarr.shape[2])) __pyx_t_32 = 2;
             if (__pyx_t_41 < 0) {
               __pyx_t_41 += __pyx_v_logarr.shape[3];
               if (unlikely(__pyx_t_41 < 0)) __pyx_t_32 = 3;
             } else if (unlikely(__pyx_t_41 >= __pyx_v_logarr.shape[3])) __pyx_t_32 = 3;
             if (unlikely(__pyx_t_32 != -1)) {
               __Pyx_RaiseBufferIndexError(__pyx_t_32);
-              __PYX_ERR(0, 650, __pyx_L1_error)
+              __PYX_ERR(0, 707, __pyx_L1_error)
             }
             __pyx_v_value = ((*((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_tr.data + __pyx_t_30 * __pyx_v_tr.strides[0]) ) + __pyx_t_31 * __pyx_v_tr.strides[1]) ) + __pyx_t_33 * __pyx_v_tr.strides[2]) ))) + (*((double *) ( /* dim=3 */ (( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_logarr.data + __pyx_t_38 * __pyx_v_logarr.strides[0]) ) + __pyx_t_39 * __pyx_v_logarr.strides[1]) ) + __pyx_t_40 * __pyx_v_logarr.strides[2]) ) + __pyx_t_41 * __pyx_v_logarr.strides[3]) ))));
 
-            /* "soapcw/soapcw.pyx":651
+            /* "soapcw/soapcw.pyx":708
  *                             o2 = int(obs2_ind[0][i+m-sep_dist])
  *                             value = tr[1][k][m] + logarr[det_order[0,i],frac_ind[0,i],o1,o2]
  *                             if value > temp:             # <<<<<<<<<<<<<<
  *                                 temp = value
  *                                 val[0][i] = temp
  */
             __pyx_t_18 = ((__pyx_v_value > __pyx_v_temp) != 0);
             if (__pyx_t_18) {
 
-              /* "soapcw/soapcw.pyx":652
+              /* "soapcw/soapcw.pyx":709
  *                             value = tr[1][k][m] + logarr[det_order[0,i],frac_ind[0,i],o1,o2]
  *                             if value > temp:
  *                                 temp = value             # <<<<<<<<<<<<<<
  *                                 val[0][i] = temp
  *                                 prev[0][i] =  i
  */
               __pyx_v_temp = __pyx_v_value;
 
-              /* "soapcw/soapcw.pyx":653
+              /* "soapcw/soapcw.pyx":710
  *                             if value > temp:
  *                                 temp = value
  *                                 val[0][i] = temp             # <<<<<<<<<<<<<<
  *                                 prev[0][i] =  i
  *                                 det1[0][i] =  i+k-1
  */
               __pyx_t_37 = 0;
@@ -14648,19 +14986,19 @@
               } else if (unlikely(__pyx_t_37 >= __pyx_v_val.shape[0])) __pyx_t_32 = 0;
               if (__pyx_t_36 < 0) {
                 __pyx_t_36 += __pyx_v_val.shape[1];
                 if (unlikely(__pyx_t_36 < 0)) __pyx_t_32 = 1;
               } else if (unlikely(__pyx_t_36 >= __pyx_v_val.shape[1])) __pyx_t_32 = 1;
               if (unlikely(__pyx_t_32 != -1)) {
                 __Pyx_RaiseBufferIndexError(__pyx_t_32);
-                __PYX_ERR(0, 653, __pyx_L1_error)
+                __PYX_ERR(0, 710, __pyx_L1_error)
               }
               *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_val.data + __pyx_t_37 * __pyx_v_val.strides[0]) ) + __pyx_t_36 * __pyx_v_val.strides[1]) )) = __pyx_v_temp;
 
-              /* "soapcw/soapcw.pyx":654
+              /* "soapcw/soapcw.pyx":711
  *                                 temp = value
  *                                 val[0][i] = temp
  *                                 prev[0][i] =  i             # <<<<<<<<<<<<<<
  *                                 det1[0][i] =  i+k-1
  *                                 det2[0][i] =  i+m-1
  */
               __pyx_t_36 = 0;
@@ -14672,19 +15010,19 @@
               } else if (unlikely(__pyx_t_36 >= __pyx_v_prev.shape[0])) __pyx_t_32 = 0;
               if (__pyx_t_37 < 0) {
                 __pyx_t_37 += __pyx_v_prev.shape[1];
                 if (unlikely(__pyx_t_37 < 0)) __pyx_t_32 = 1;
               } else if (unlikely(__pyx_t_37 >= __pyx_v_prev.shape[1])) __pyx_t_32 = 1;
               if (unlikely(__pyx_t_32 != -1)) {
                 __Pyx_RaiseBufferIndexError(__pyx_t_32);
-                __PYX_ERR(0, 654, __pyx_L1_error)
+                __PYX_ERR(0, 711, __pyx_L1_error)
               }
               *((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_prev.data + __pyx_t_36 * __pyx_v_prev.strides[0]) ) + __pyx_t_37 * __pyx_v_prev.strides[1]) )) = __pyx_v_i;
 
-              /* "soapcw/soapcw.pyx":655
+              /* "soapcw/soapcw.pyx":712
  *                                 val[0][i] = temp
  *                                 prev[0][i] =  i
  *                                 det1[0][i] =  i+k-1             # <<<<<<<<<<<<<<
  *                                 det2[0][i] =  i+m-1
  *                             else:
  */
               __pyx_t_37 = 0;
@@ -14696,19 +15034,19 @@
               } else if (unlikely(__pyx_t_37 >= __pyx_v_det1.shape[0])) __pyx_t_32 = 0;
               if (__pyx_t_36 < 0) {
                 __pyx_t_36 += __pyx_v_det1.shape[1];
                 if (unlikely(__pyx_t_36 < 0)) __pyx_t_32 = 1;
               } else if (unlikely(__pyx_t_36 >= __pyx_v_det1.shape[1])) __pyx_t_32 = 1;
               if (unlikely(__pyx_t_32 != -1)) {
                 __Pyx_RaiseBufferIndexError(__pyx_t_32);
-                __PYX_ERR(0, 655, __pyx_L1_error)
+                __PYX_ERR(0, 712, __pyx_L1_error)
               }
               *((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_det1.data + __pyx_t_37 * __pyx_v_det1.strides[0]) ) + __pyx_t_36 * __pyx_v_det1.strides[1]) )) = ((__pyx_v_i + __pyx_v_k) - 1);
 
-              /* "soapcw/soapcw.pyx":656
+              /* "soapcw/soapcw.pyx":713
  *                                 prev[0][i] =  i
  *                                 det1[0][i] =  i+k-1
  *                                 det2[0][i] =  i+m-1             # <<<<<<<<<<<<<<
  *                             else:
  *                                 continue
  */
               __pyx_t_36 = 0;
@@ -14720,141 +15058,141 @@
               } else if (unlikely(__pyx_t_36 >= __pyx_v_det2.shape[0])) __pyx_t_32 = 0;
               if (__pyx_t_37 < 0) {
                 __pyx_t_37 += __pyx_v_det2.shape[1];
                 if (unlikely(__pyx_t_37 < 0)) __pyx_t_32 = 1;
               } else if (unlikely(__pyx_t_37 >= __pyx_v_det2.shape[1])) __pyx_t_32 = 1;
               if (unlikely(__pyx_t_32 != -1)) {
                 __Pyx_RaiseBufferIndexError(__pyx_t_32);
-                __PYX_ERR(0, 656, __pyx_L1_error)
+                __PYX_ERR(0, 713, __pyx_L1_error)
               }
               *((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_det2.data + __pyx_t_36 * __pyx_v_det2.strides[0]) ) + __pyx_t_37 * __pyx_v_det2.strides[1]) )) = ((__pyx_v_i + __pyx_v_m) - 1);
 
-              /* "soapcw/soapcw.pyx":651
+              /* "soapcw/soapcw.pyx":708
  *                             o2 = int(obs2_ind[0][i+m-sep_dist])
  *                             value = tr[1][k][m] + logarr[det_order[0,i],frac_ind[0,i],o1,o2]
  *                             if value > temp:             # <<<<<<<<<<<<<<
  *                                 temp = value
  *                                 val[0][i] = temp
  */
               goto __pyx_L26;
             }
 
-            /* "soapcw/soapcw.pyx":658
+            /* "soapcw/soapcw.pyx":715
  *                                 det2[0][i] =  i+m-1
  *                             else:
  *                                 continue             # <<<<<<<<<<<<<<
  * 
  *         # i is current frequency position
  */
             /*else*/ {
               goto __pyx_L21_continue;
             }
             __pyx_L26:;
 
-            /* "soapcw/soapcw.pyx":647
+            /* "soapcw/soapcw.pyx":704
  *                 if i+k-sep_dist>=0+edge_range and i+k-sep_dist<width-edge_range:
  *                     for m in range(sep_len):
  *                         if i+m-sep_dist>=0+edge_range and i+m-sep_dist<width-edge_range:             # <<<<<<<<<<<<<<
  *                             o1 = int(obs1_ind[0][i+k-sep_dist])
  *                             o2 = int(obs2_ind[0][i+m-sep_dist])
  */
           }
           __pyx_L21_continue:;
         }
 
-        /* "soapcw/soapcw.pyx":645
+        /* "soapcw/soapcw.pyx":702
  *             temp = -1e6
  *             for k in range(sep_len):
  *                 if i+k-sep_dist>=0+edge_range and i+k-sep_dist<width-edge_range:             # <<<<<<<<<<<<<<
  *                     for m in range(sep_len):
  *                         if i+m-sep_dist>=0+edge_range and i+m-sep_dist<width-edge_range:
  */
       }
     }
   }
 
-  /* "soapcw/soapcw.pyx":667
+  /* "soapcw/soapcw.pyx":724
  * 
  * 
  *         pbar = 0             # <<<<<<<<<<<<<<
  *         for t in range(1,length):
  *             pt = t/(float(length))*100.
  */
   __Pyx_INCREF(__pyx_int_0);
   __pyx_v_pbar = __pyx_int_0;
 
-  /* "soapcw/soapcw.pyx":668
+  /* "soapcw/soapcw.pyx":725
  * 
  *         pbar = 0
  *         for t in range(1,length):             # <<<<<<<<<<<<<<
  *             pt = t/(float(length))*100.
  *             for i in range(width):
  */
   __pyx_t_19 = __pyx_v_length;
   __pyx_t_21 = __pyx_t_19;
   for (__pyx_t_22 = 1; __pyx_t_22 < __pyx_t_21; __pyx_t_22+=1) {
     __pyx_v_t = __pyx_t_22;
 
-    /* "soapcw/soapcw.pyx":669
+    /* "soapcw/soapcw.pyx":726
  *         pbar = 0
  *         for t in range(1,length):
  *             pt = t/(float(length))*100.             # <<<<<<<<<<<<<<
  *             for i in range(width):
  *                 temp = -np.inf
  */
     if (unlikely(((double)__pyx_v_length) == 0)) {
       PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-      __PYX_ERR(0, 669, __pyx_L1_error)
+      __PYX_ERR(0, 726, __pyx_L1_error)
     }
     __pyx_v_pt = ((((double)__pyx_v_t) / ((double)__pyx_v_length)) * 100.);
 
-    /* "soapcw/soapcw.pyx":670
+    /* "soapcw/soapcw.pyx":727
  *         for t in range(1,length):
  *             pt = t/(float(length))*100.
  *             for i in range(width):             # <<<<<<<<<<<<<<
  *                 temp = -np.inf
  *                 for j in range(tr_len):
  */
     __pyx_t_23 = __pyx_v_width;
     __pyx_t_24 = __pyx_t_23;
     for (__pyx_t_25 = 0; __pyx_t_25 < __pyx_t_24; __pyx_t_25+=1) {
       __pyx_v_i = __pyx_t_25;
 
-      /* "soapcw/soapcw.pyx":671
+      /* "soapcw/soapcw.pyx":728
  *             pt = t/(float(length))*100.
  *             for i in range(width):
  *                 temp = -np.inf             # <<<<<<<<<<<<<<
  *                 for j in range(tr_len):
  *                     if i+j-tr_dist>=0 and i+j-tr_dist<width:
  */
-      __Pyx_GetModuleGlobalName(__pyx_t_11, __pyx_n_s_np); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 671, __pyx_L1_error)
+      __Pyx_GetModuleGlobalName(__pyx_t_11, __pyx_n_s_np); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 728, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_11);
-      __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_11, __pyx_n_s_inf); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 671, __pyx_L1_error)
+      __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_11, __pyx_n_s_inf); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 728, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_13);
       __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
-      __pyx_t_11 = PyNumber_Negative(__pyx_t_13); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 671, __pyx_L1_error)
+      __pyx_t_11 = PyNumber_Negative(__pyx_t_13); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 728, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_11);
       __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-      __pyx_t_42 = __pyx_PyFloat_AsDouble(__pyx_t_11); if (unlikely((__pyx_t_42 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 671, __pyx_L1_error)
+      __pyx_t_42 = __pyx_PyFloat_AsDouble(__pyx_t_11); if (unlikely((__pyx_t_42 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 728, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
       __pyx_v_temp = __pyx_t_42;
 
-      /* "soapcw/soapcw.pyx":672
+      /* "soapcw/soapcw.pyx":729
  *             for i in range(width):
  *                 temp = -np.inf
  *                 for j in range(tr_len):             # <<<<<<<<<<<<<<
  *                     if i+j-tr_dist>=0 and i+j-tr_dist<width:
  *                        for k in range(sep_len):
  */
       __pyx_t_27 = __pyx_v_tr_len;
       __pyx_t_28 = __pyx_t_27;
       for (__pyx_t_29 = 0; __pyx_t_29 < __pyx_t_28; __pyx_t_29+=1) {
         __pyx_v_j = __pyx_t_29;
 
-        /* "soapcw/soapcw.pyx":673
+        /* "soapcw/soapcw.pyx":730
  *                 temp = -np.inf
  *                 for j in range(tr_len):
  *                     if i+j-tr_dist>=0 and i+j-tr_dist<width:             # <<<<<<<<<<<<<<
  *                        for k in range(sep_len):
  *                             if i+k-sep_dist>=0+edge_range and i+k-sep_dist<width-edge_range:
  */
         __pyx_t_26 = ((((__pyx_v_i + __pyx_v_j) - __pyx_v_tr_dist) >= 0) != 0);
@@ -14864,27 +15202,27 @@
           goto __pyx_L34_bool_binop_done;
         }
         __pyx_t_26 = ((((__pyx_v_i + __pyx_v_j) - __pyx_v_tr_dist) < __pyx_v_width) != 0);
         __pyx_t_18 = __pyx_t_26;
         __pyx_L34_bool_binop_done:;
         if (__pyx_t_18) {
 
-          /* "soapcw/soapcw.pyx":674
+          /* "soapcw/soapcw.pyx":731
  *                 for j in range(tr_len):
  *                     if i+j-tr_dist>=0 and i+j-tr_dist<width:
  *                        for k in range(sep_len):             # <<<<<<<<<<<<<<
  *                             if i+k-sep_dist>=0+edge_range and i+k-sep_dist<width-edge_range:
  *                                 for m in range(sep_len):
  */
           __pyx_t_32 = __pyx_v_sep_len;
           __pyx_t_43 = __pyx_t_32;
           for (__pyx_t_44 = 0; __pyx_t_44 < __pyx_t_43; __pyx_t_44+=1) {
             __pyx_v_k = __pyx_t_44;
 
-            /* "soapcw/soapcw.pyx":675
+            /* "soapcw/soapcw.pyx":732
  *                     if i+j-tr_dist>=0 and i+j-tr_dist<width:
  *                        for k in range(sep_len):
  *                             if i+k-sep_dist>=0+edge_range and i+k-sep_dist<width-edge_range:             # <<<<<<<<<<<<<<
  *                                 for m in range(sep_len):
  *                                     if i+m-sep_dist>=0+edge_range and i+m-sep_dist<width-edge_range:
  */
             __pyx_t_26 = ((((__pyx_v_i + __pyx_v_k) - __pyx_v_sep_dist) >= (0 + __pyx_v_edge_range)) != 0);
@@ -14894,27 +15232,27 @@
               goto __pyx_L39_bool_binop_done;
             }
             __pyx_t_26 = ((((__pyx_v_i + __pyx_v_k) - __pyx_v_sep_dist) < (__pyx_v_width - __pyx_v_edge_range)) != 0);
             __pyx_t_18 = __pyx_t_26;
             __pyx_L39_bool_binop_done:;
             if (__pyx_t_18) {
 
-              /* "soapcw/soapcw.pyx":676
+              /* "soapcw/soapcw.pyx":733
  *                        for k in range(sep_len):
  *                             if i+k-sep_dist>=0+edge_range and i+k-sep_dist<width-edge_range:
  *                                 for m in range(sep_len):             # <<<<<<<<<<<<<<
  *                                     if i+m-sep_dist>=0+edge_range and i+m-sep_dist<width-edge_range:
  *                                         o1 = int(obs1_ind[t][i+k-sep_dist])
  */
               __pyx_t_45 = __pyx_v_sep_len;
               __pyx_t_46 = __pyx_t_45;
               for (__pyx_t_47 = 0; __pyx_t_47 < __pyx_t_46; __pyx_t_47+=1) {
                 __pyx_v_m = __pyx_t_47;
 
-                /* "soapcw/soapcw.pyx":677
+                /* "soapcw/soapcw.pyx":734
  *                             if i+k-sep_dist>=0+edge_range and i+k-sep_dist<width-edge_range:
  *                                 for m in range(sep_len):
  *                                     if i+m-sep_dist>=0+edge_range and i+m-sep_dist<width-edge_range:             # <<<<<<<<<<<<<<
  *                                         o1 = int(obs1_ind[t][i+k-sep_dist])
  *                                         o2 = int(obs2_ind[t][i+m-sep_dist])
  */
                 __pyx_t_26 = ((((__pyx_v_i + __pyx_v_m) - __pyx_v_sep_dist) >= (0 + __pyx_v_edge_range)) != 0);
@@ -14924,15 +15262,15 @@
                   goto __pyx_L44_bool_binop_done;
                 }
                 __pyx_t_26 = ((((__pyx_v_i + __pyx_v_m) - __pyx_v_sep_dist) < (__pyx_v_width - __pyx_v_edge_range)) != 0);
                 __pyx_t_18 = __pyx_t_26;
                 __pyx_L44_bool_binop_done:;
                 if (__pyx_t_18) {
 
-                  /* "soapcw/soapcw.pyx":678
+                  /* "soapcw/soapcw.pyx":735
  *                                 for m in range(sep_len):
  *                                     if i+m-sep_dist>=0+edge_range and i+m-sep_dist<width-edge_range:
  *                                         o1 = int(obs1_ind[t][i+k-sep_dist])             # <<<<<<<<<<<<<<
  *                                         o2 = int(obs2_ind[t][i+m-sep_dist])
  *                                         value = tr[j][k][m] + val[t-1][i+j-tr_dist] + logarr[det_order[t,i],frac_ind[t,i],o1,o2]
  */
                   __pyx_t_37 = __pyx_v_t;
@@ -14944,19 +15282,19 @@
                   } else if (unlikely(__pyx_t_37 >= __pyx_v_obs1_ind.shape[0])) __pyx_t_48 = 0;
                   if (__pyx_t_36 < 0) {
                     __pyx_t_36 += __pyx_v_obs1_ind.shape[1];
                     if (unlikely(__pyx_t_36 < 0)) __pyx_t_48 = 1;
                   } else if (unlikely(__pyx_t_36 >= __pyx_v_obs1_ind.shape[1])) __pyx_t_48 = 1;
                   if (unlikely(__pyx_t_48 != -1)) {
                     __Pyx_RaiseBufferIndexError(__pyx_t_48);
-                    __PYX_ERR(0, 678, __pyx_L1_error)
+                    __PYX_ERR(0, 735, __pyx_L1_error)
                   }
                   __pyx_v_o1 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_obs1_ind.data + __pyx_t_37 * __pyx_v_obs1_ind.strides[0]) ) + __pyx_t_36 * __pyx_v_obs1_ind.strides[1]) )));
 
-                  /* "soapcw/soapcw.pyx":679
+                  /* "soapcw/soapcw.pyx":736
  *                                     if i+m-sep_dist>=0+edge_range and i+m-sep_dist<width-edge_range:
  *                                         o1 = int(obs1_ind[t][i+k-sep_dist])
  *                                         o2 = int(obs2_ind[t][i+m-sep_dist])             # <<<<<<<<<<<<<<
  *                                         value = tr[j][k][m] + val[t-1][i+j-tr_dist] + logarr[det_order[t,i],frac_ind[t,i],o1,o2]
  * 
  */
                   __pyx_t_36 = __pyx_v_t;
@@ -14968,19 +15306,19 @@
                   } else if (unlikely(__pyx_t_36 >= __pyx_v_obs2_ind.shape[0])) __pyx_t_48 = 0;
                   if (__pyx_t_37 < 0) {
                     __pyx_t_37 += __pyx_v_obs2_ind.shape[1];
                     if (unlikely(__pyx_t_37 < 0)) __pyx_t_48 = 1;
                   } else if (unlikely(__pyx_t_37 >= __pyx_v_obs2_ind.shape[1])) __pyx_t_48 = 1;
                   if (unlikely(__pyx_t_48 != -1)) {
                     __Pyx_RaiseBufferIndexError(__pyx_t_48);
-                    __PYX_ERR(0, 679, __pyx_L1_error)
+                    __PYX_ERR(0, 736, __pyx_L1_error)
                   }
                   __pyx_v_o2 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_obs2_ind.data + __pyx_t_36 * __pyx_v_obs2_ind.strides[0]) ) + __pyx_t_37 * __pyx_v_obs2_ind.strides[1]) )));
 
-                  /* "soapcw/soapcw.pyx":680
+                  /* "soapcw/soapcw.pyx":737
  *                                         o1 = int(obs1_ind[t][i+k-sep_dist])
  *                                         o2 = int(obs2_ind[t][i+m-sep_dist])
  *                                         value = tr[j][k][m] + val[t-1][i+j-tr_dist] + logarr[det_order[t,i],frac_ind[t,i],o1,o2]             # <<<<<<<<<<<<<<
  * 
  *                                         if value > temp:
  */
                   __pyx_t_37 = __pyx_v_j;
@@ -14997,60 +15335,60 @@
                   } else if (unlikely(__pyx_t_36 >= __pyx_v_tr.shape[1])) __pyx_t_48 = 1;
                   if (__pyx_t_35 < 0) {
                     __pyx_t_35 += __pyx_v_tr.shape[2];
                     if (unlikely(__pyx_t_35 < 0)) __pyx_t_48 = 2;
                   } else if (unlikely(__pyx_t_35 >= __pyx_v_tr.shape[2])) __pyx_t_48 = 2;
                   if (unlikely(__pyx_t_48 != -1)) {
                     __Pyx_RaiseBufferIndexError(__pyx_t_48);
-                    __PYX_ERR(0, 680, __pyx_L1_error)
+                    __PYX_ERR(0, 737, __pyx_L1_error)
                   }
                   __pyx_t_34 = (__pyx_v_t - 1);
                   __pyx_t_41 = ((__pyx_v_i + __pyx_v_j) - __pyx_v_tr_dist);
                   __pyx_t_48 = -1;
                   if (__pyx_t_34 < 0) {
                     __pyx_t_34 += __pyx_v_val.shape[0];
                     if (unlikely(__pyx_t_34 < 0)) __pyx_t_48 = 0;
                   } else if (unlikely(__pyx_t_34 >= __pyx_v_val.shape[0])) __pyx_t_48 = 0;
                   if (__pyx_t_41 < 0) {
                     __pyx_t_41 += __pyx_v_val.shape[1];
                     if (unlikely(__pyx_t_41 < 0)) __pyx_t_48 = 1;
                   } else if (unlikely(__pyx_t_41 >= __pyx_v_val.shape[1])) __pyx_t_48 = 1;
                   if (unlikely(__pyx_t_48 != -1)) {
                     __Pyx_RaiseBufferIndexError(__pyx_t_48);
-                    __PYX_ERR(0, 680, __pyx_L1_error)
+                    __PYX_ERR(0, 737, __pyx_L1_error)
                   }
                   __pyx_t_40 = __pyx_v_t;
                   __pyx_t_39 = __pyx_v_i;
                   __pyx_t_48 = -1;
                   if (__pyx_t_40 < 0) {
                     __pyx_t_40 += __pyx_v_det_order.shape[0];
                     if (unlikely(__pyx_t_40 < 0)) __pyx_t_48 = 0;
                   } else if (unlikely(__pyx_t_40 >= __pyx_v_det_order.shape[0])) __pyx_t_48 = 0;
                   if (__pyx_t_39 < 0) {
                     __pyx_t_39 += __pyx_v_det_order.shape[1];
                     if (unlikely(__pyx_t_39 < 0)) __pyx_t_48 = 1;
                   } else if (unlikely(__pyx_t_39 >= __pyx_v_det_order.shape[1])) __pyx_t_48 = 1;
                   if (unlikely(__pyx_t_48 != -1)) {
                     __Pyx_RaiseBufferIndexError(__pyx_t_48);
-                    __PYX_ERR(0, 680, __pyx_L1_error)
+                    __PYX_ERR(0, 737, __pyx_L1_error)
                   }
                   __pyx_t_38 = __pyx_v_t;
                   __pyx_t_33 = __pyx_v_i;
                   __pyx_t_48 = -1;
                   if (__pyx_t_38 < 0) {
                     __pyx_t_38 += __pyx_v_frac_ind.shape[0];
                     if (unlikely(__pyx_t_38 < 0)) __pyx_t_48 = 0;
                   } else if (unlikely(__pyx_t_38 >= __pyx_v_frac_ind.shape[0])) __pyx_t_48 = 0;
                   if (__pyx_t_33 < 0) {
                     __pyx_t_33 += __pyx_v_frac_ind.shape[1];
                     if (unlikely(__pyx_t_33 < 0)) __pyx_t_48 = 1;
                   } else if (unlikely(__pyx_t_33 >= __pyx_v_frac_ind.shape[1])) __pyx_t_48 = 1;
                   if (unlikely(__pyx_t_48 != -1)) {
                     __Pyx_RaiseBufferIndexError(__pyx_t_48);
-                    __PYX_ERR(0, 680, __pyx_L1_error)
+                    __PYX_ERR(0, 737, __pyx_L1_error)
                   }
                   __pyx_t_31 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_det_order.data + __pyx_t_40 * __pyx_v_det_order.strides[0]) ) + __pyx_t_39 * __pyx_v_det_order.strides[1]) )));
                   __pyx_t_30 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_frac_ind.data + __pyx_t_38 * __pyx_v_frac_ind.strides[0]) ) + __pyx_t_33 * __pyx_v_frac_ind.strides[1]) )));
                   __pyx_t_49 = __pyx_v_o1;
                   __pyx_t_50 = __pyx_v_o2;
                   __pyx_t_48 = -1;
                   if (__pyx_t_31 < 0) {
@@ -15067,38 +15405,38 @@
                   } else if (unlikely(__pyx_t_49 >= __pyx_v_logarr.shape[2])) __pyx_t_48 = 2;
                   if (__pyx_t_50 < 0) {
                     __pyx_t_50 += __pyx_v_logarr.shape[3];
                     if (unlikely(__pyx_t_50 < 0)) __pyx_t_48 = 3;
                   } else if (unlikely(__pyx_t_50 >= __pyx_v_logarr.shape[3])) __pyx_t_48 = 3;
                   if (unlikely(__pyx_t_48 != -1)) {
                     __Pyx_RaiseBufferIndexError(__pyx_t_48);
-                    __PYX_ERR(0, 680, __pyx_L1_error)
+                    __PYX_ERR(0, 737, __pyx_L1_error)
                   }
                   __pyx_v_value = (((*((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_tr.data + __pyx_t_37 * __pyx_v_tr.strides[0]) ) + __pyx_t_36 * __pyx_v_tr.strides[1]) ) + __pyx_t_35 * __pyx_v_tr.strides[2]) ))) + (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_val.data + __pyx_t_34 * __pyx_v_val.strides[0]) ) + __pyx_t_41 * __pyx_v_val.strides[1]) )))) + (*((double *) ( /* dim=3 */ (( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_logarr.data + __pyx_t_31 * __pyx_v_logarr.strides[0]) ) + __pyx_t_30 * __pyx_v_logarr.strides[1]) ) + __pyx_t_49 * __pyx_v_logarr.strides[2]) ) + __pyx_t_50 * __pyx_v_logarr.strides[3]) ))));
 
-                  /* "soapcw/soapcw.pyx":682
+                  /* "soapcw/soapcw.pyx":739
  *                                         value = tr[j][k][m] + val[t-1][i+j-tr_dist] + logarr[det_order[t,i],frac_ind[t,i],o1,o2]
  * 
  *                                         if value > temp:             # <<<<<<<<<<<<<<
  *                                             temp = value
  *                                             val[t][i] = temp
  */
                   __pyx_t_18 = ((__pyx_v_value > __pyx_v_temp) != 0);
                   if (__pyx_t_18) {
 
-                    /* "soapcw/soapcw.pyx":683
+                    /* "soapcw/soapcw.pyx":740
  * 
  *                                         if value > temp:
  *                                             temp = value             # <<<<<<<<<<<<<<
  *                                             val[t][i] = temp
  *                                             prev[t][i] =  i+j-tr_dist
  */
                     __pyx_v_temp = __pyx_v_value;
 
-                    /* "soapcw/soapcw.pyx":684
+                    /* "soapcw/soapcw.pyx":741
  *                                         if value > temp:
  *                                             temp = value
  *                                             val[t][i] = temp             # <<<<<<<<<<<<<<
  *                                             prev[t][i] =  i+j-tr_dist
  *                                             det1[t][i] =  i+k-sep_dist
  */
                     __pyx_t_33 = __pyx_v_t;
@@ -15110,19 +15448,19 @@
                     } else if (unlikely(__pyx_t_33 >= __pyx_v_val.shape[0])) __pyx_t_48 = 0;
                     if (__pyx_t_38 < 0) {
                       __pyx_t_38 += __pyx_v_val.shape[1];
                       if (unlikely(__pyx_t_38 < 0)) __pyx_t_48 = 1;
                     } else if (unlikely(__pyx_t_38 >= __pyx_v_val.shape[1])) __pyx_t_48 = 1;
                     if (unlikely(__pyx_t_48 != -1)) {
                       __Pyx_RaiseBufferIndexError(__pyx_t_48);
-                      __PYX_ERR(0, 684, __pyx_L1_error)
+                      __PYX_ERR(0, 741, __pyx_L1_error)
                     }
                     *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_val.data + __pyx_t_33 * __pyx_v_val.strides[0]) ) + __pyx_t_38 * __pyx_v_val.strides[1]) )) = __pyx_v_temp;
 
-                    /* "soapcw/soapcw.pyx":685
+                    /* "soapcw/soapcw.pyx":742
  *                                             temp = value
  *                                             val[t][i] = temp
  *                                             prev[t][i] =  i+j-tr_dist             # <<<<<<<<<<<<<<
  *                                             det1[t][i] =  i+k-sep_dist
  *                                             det2[t][i] =  i+m-sep_dist
  */
                     __pyx_t_38 = __pyx_v_t;
@@ -15134,19 +15472,19 @@
                     } else if (unlikely(__pyx_t_38 >= __pyx_v_prev.shape[0])) __pyx_t_48 = 0;
                     if (__pyx_t_33 < 0) {
                       __pyx_t_33 += __pyx_v_prev.shape[1];
                       if (unlikely(__pyx_t_33 < 0)) __pyx_t_48 = 1;
                     } else if (unlikely(__pyx_t_33 >= __pyx_v_prev.shape[1])) __pyx_t_48 = 1;
                     if (unlikely(__pyx_t_48 != -1)) {
                       __Pyx_RaiseBufferIndexError(__pyx_t_48);
-                      __PYX_ERR(0, 685, __pyx_L1_error)
+                      __PYX_ERR(0, 742, __pyx_L1_error)
                     }
                     *((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_prev.data + __pyx_t_38 * __pyx_v_prev.strides[0]) ) + __pyx_t_33 * __pyx_v_prev.strides[1]) )) = ((__pyx_v_i + __pyx_v_j) - __pyx_v_tr_dist);
 
-                    /* "soapcw/soapcw.pyx":686
+                    /* "soapcw/soapcw.pyx":743
  *                                             val[t][i] = temp
  *                                             prev[t][i] =  i+j-tr_dist
  *                                             det1[t][i] =  i+k-sep_dist             # <<<<<<<<<<<<<<
  *                                             det2[t][i] =  i+m-sep_dist
  *                                         else:
  */
                     __pyx_t_33 = __pyx_v_t;
@@ -15158,19 +15496,19 @@
                     } else if (unlikely(__pyx_t_33 >= __pyx_v_det1.shape[0])) __pyx_t_48 = 0;
                     if (__pyx_t_38 < 0) {
                       __pyx_t_38 += __pyx_v_det1.shape[1];
                       if (unlikely(__pyx_t_38 < 0)) __pyx_t_48 = 1;
                     } else if (unlikely(__pyx_t_38 >= __pyx_v_det1.shape[1])) __pyx_t_48 = 1;
                     if (unlikely(__pyx_t_48 != -1)) {
                       __Pyx_RaiseBufferIndexError(__pyx_t_48);
-                      __PYX_ERR(0, 686, __pyx_L1_error)
+                      __PYX_ERR(0, 743, __pyx_L1_error)
                     }
                     *((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_det1.data + __pyx_t_33 * __pyx_v_det1.strides[0]) ) + __pyx_t_38 * __pyx_v_det1.strides[1]) )) = ((__pyx_v_i + __pyx_v_k) - __pyx_v_sep_dist);
 
-                    /* "soapcw/soapcw.pyx":687
+                    /* "soapcw/soapcw.pyx":744
  *                                             prev[t][i] =  i+j-tr_dist
  *                                             det1[t][i] =  i+k-sep_dist
  *                                             det2[t][i] =  i+m-sep_dist             # <<<<<<<<<<<<<<
  *                                         else:
  *                                             continue
  */
                     __pyx_t_38 = __pyx_v_t;
@@ -15182,119 +15520,119 @@
                     } else if (unlikely(__pyx_t_38 >= __pyx_v_det2.shape[0])) __pyx_t_48 = 0;
                     if (__pyx_t_33 < 0) {
                       __pyx_t_33 += __pyx_v_det2.shape[1];
                       if (unlikely(__pyx_t_33 < 0)) __pyx_t_48 = 1;
                     } else if (unlikely(__pyx_t_33 >= __pyx_v_det2.shape[1])) __pyx_t_48 = 1;
                     if (unlikely(__pyx_t_48 != -1)) {
                       __Pyx_RaiseBufferIndexError(__pyx_t_48);
-                      __PYX_ERR(0, 687, __pyx_L1_error)
+                      __PYX_ERR(0, 744, __pyx_L1_error)
                     }
                     *((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_det2.data + __pyx_t_38 * __pyx_v_det2.strides[0]) ) + __pyx_t_33 * __pyx_v_det2.strides[1]) )) = ((__pyx_v_i + __pyx_v_m) - __pyx_v_sep_dist);
 
-                    /* "soapcw/soapcw.pyx":682
+                    /* "soapcw/soapcw.pyx":739
  *                                         value = tr[j][k][m] + val[t-1][i+j-tr_dist] + logarr[det_order[t,i],frac_ind[t,i],o1,o2]
  * 
  *                                         if value > temp:             # <<<<<<<<<<<<<<
  *                                             temp = value
  *                                             val[t][i] = temp
  */
                     goto __pyx_L46;
                   }
 
-                  /* "soapcw/soapcw.pyx":689
+                  /* "soapcw/soapcw.pyx":746
  *                                             det2[t][i] =  i+m-sep_dist
  *                                         else:
  *                                             continue             # <<<<<<<<<<<<<<
  *             if self.prog == True:
  *                 if pt>pbar:
  */
                   /*else*/ {
                     goto __pyx_L41_continue;
                   }
                   __pyx_L46:;
 
-                  /* "soapcw/soapcw.pyx":677
+                  /* "soapcw/soapcw.pyx":734
  *                             if i+k-sep_dist>=0+edge_range and i+k-sep_dist<width-edge_range:
  *                                 for m in range(sep_len):
  *                                     if i+m-sep_dist>=0+edge_range and i+m-sep_dist<width-edge_range:             # <<<<<<<<<<<<<<
  *                                         o1 = int(obs1_ind[t][i+k-sep_dist])
  *                                         o2 = int(obs2_ind[t][i+m-sep_dist])
  */
                 }
                 __pyx_L41_continue:;
               }
 
-              /* "soapcw/soapcw.pyx":675
+              /* "soapcw/soapcw.pyx":732
  *                     if i+j-tr_dist>=0 and i+j-tr_dist<width:
  *                        for k in range(sep_len):
  *                             if i+k-sep_dist>=0+edge_range and i+k-sep_dist<width-edge_range:             # <<<<<<<<<<<<<<
  *                                 for m in range(sep_len):
  *                                     if i+m-sep_dist>=0+edge_range and i+m-sep_dist<width-edge_range:
  */
             }
           }
 
-          /* "soapcw/soapcw.pyx":673
+          /* "soapcw/soapcw.pyx":730
  *                 temp = -np.inf
  *                 for j in range(tr_len):
  *                     if i+j-tr_dist>=0 and i+j-tr_dist<width:             # <<<<<<<<<<<<<<
  *                        for k in range(sep_len):
  *                             if i+k-sep_dist>=0+edge_range and i+k-sep_dist<width-edge_range:
  */
         }
       }
     }
 
-    /* "soapcw/soapcw.pyx":690
+    /* "soapcw/soapcw.pyx":747
  *                                         else:
  *                                             continue
  *             if self.prog == True:             # <<<<<<<<<<<<<<
  *                 if pt>pbar:
  *                     stdout.write('\r{} %'.format(round(pt)))
  */
-    __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_prog); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 690, __pyx_L1_error)
+    __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_prog); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 747, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_11);
-    __pyx_t_13 = PyObject_RichCompare(__pyx_t_11, Py_True, Py_EQ); __Pyx_XGOTREF(__pyx_t_13); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 690, __pyx_L1_error)
+    __pyx_t_13 = PyObject_RichCompare(__pyx_t_11, Py_True, Py_EQ); __Pyx_XGOTREF(__pyx_t_13); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 747, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
-    __pyx_t_18 = __Pyx_PyObject_IsTrue(__pyx_t_13); if (unlikely(__pyx_t_18 < 0)) __PYX_ERR(0, 690, __pyx_L1_error)
+    __pyx_t_18 = __Pyx_PyObject_IsTrue(__pyx_t_13); if (unlikely(__pyx_t_18 < 0)) __PYX_ERR(0, 747, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
     if (__pyx_t_18) {
 
-      /* "soapcw/soapcw.pyx":691
+      /* "soapcw/soapcw.pyx":748
  *                                             continue
  *             if self.prog == True:
  *                 if pt>pbar:             # <<<<<<<<<<<<<<
  *                     stdout.write('\r{} %'.format(round(pt)))
  *                     stdout.flush()
  */
-      __pyx_t_13 = PyFloat_FromDouble(__pyx_v_pt); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 691, __pyx_L1_error)
+      __pyx_t_13 = PyFloat_FromDouble(__pyx_v_pt); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 748, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_13);
-      __pyx_t_11 = PyObject_RichCompare(__pyx_t_13, __pyx_v_pbar, Py_GT); __Pyx_XGOTREF(__pyx_t_11); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 691, __pyx_L1_error)
+      __pyx_t_11 = PyObject_RichCompare(__pyx_t_13, __pyx_v_pbar, Py_GT); __Pyx_XGOTREF(__pyx_t_11); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 748, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-      __pyx_t_18 = __Pyx_PyObject_IsTrue(__pyx_t_11); if (unlikely(__pyx_t_18 < 0)) __PYX_ERR(0, 691, __pyx_L1_error)
+      __pyx_t_18 = __Pyx_PyObject_IsTrue(__pyx_t_11); if (unlikely(__pyx_t_18 < 0)) __PYX_ERR(0, 748, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
       if (__pyx_t_18) {
 
-        /* "soapcw/soapcw.pyx":692
+        /* "soapcw/soapcw.pyx":749
  *             if self.prog == True:
  *                 if pt>pbar:
  *                     stdout.write('\r{} %'.format(round(pt)))             # <<<<<<<<<<<<<<
  *                     stdout.flush()
  *                     pbar+=100./length
  */
-        __Pyx_GetModuleGlobalName(__pyx_t_13, __pyx_n_s_stdout); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 692, __pyx_L1_error)
+        __Pyx_GetModuleGlobalName(__pyx_t_13, __pyx_n_s_stdout); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 749, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_13);
-        __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_13, __pyx_n_s_write); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 692, __pyx_L1_error)
+        __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_13, __pyx_n_s_write); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 749, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
         __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-        __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u__4, __pyx_n_s_format); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 692, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u__4, __pyx_n_s_format); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 749, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
-        __pyx_t_14 = PyFloat_FromDouble(__pyx_v_pt); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 692, __pyx_L1_error)
+        __pyx_t_14 = PyFloat_FromDouble(__pyx_v_pt); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 749, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_14);
-        __pyx_t_5 = __Pyx_PyObject_CallOneArg(__pyx_builtin_round, __pyx_t_14); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 692, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyObject_CallOneArg(__pyx_builtin_round, __pyx_t_14); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 749, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_5);
         __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
         __pyx_t_14 = NULL;
         if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_14 = PyMethod_GET_SELF(__pyx_t_3);
           if (likely(__pyx_t_14)) {
             PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
@@ -15302,15 +15640,15 @@
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_13 = (__pyx_t_14) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_14, __pyx_t_5) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_5);
         __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-        if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 692, __pyx_L1_error)
+        if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 749, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_13);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         __pyx_t_3 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
           __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_4);
           if (likely(__pyx_t_3)) {
             PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
@@ -15318,246 +15656,246 @@
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_4, function);
           }
         }
         __pyx_t_11 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_3, __pyx_t_13) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_13);
         __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
         __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-        if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 692, __pyx_L1_error)
+        if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 749, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_11);
         __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
         __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
 
-        /* "soapcw/soapcw.pyx":693
+        /* "soapcw/soapcw.pyx":750
  *                 if pt>pbar:
  *                     stdout.write('\r{} %'.format(round(pt)))
  *                     stdout.flush()             # <<<<<<<<<<<<<<
  *                     pbar+=100./length
  * 
  */
-        __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_stdout); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 693, __pyx_L1_error)
+        __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_stdout); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 750, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
-        __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_flush); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 693, __pyx_L1_error)
+        __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_flush); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 750, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_13);
         __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
         __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_13))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_13);
           if (likely(__pyx_t_4)) {
             PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_13);
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_13, function);
           }
         }
         __pyx_t_11 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_13, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_13);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 693, __pyx_L1_error)
+        if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 750, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_11);
         __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
         __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
 
-        /* "soapcw/soapcw.pyx":694
+        /* "soapcw/soapcw.pyx":751
  *                     stdout.write('\r{} %'.format(round(pt)))
  *                     stdout.flush()
  *                     pbar+=100./length             # <<<<<<<<<<<<<<
  * 
  *         self.V = np.array(val)
  */
         if (unlikely(__pyx_v_length == 0)) {
           PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-          __PYX_ERR(0, 694, __pyx_L1_error)
+          __PYX_ERR(0, 751, __pyx_L1_error)
         }
-        __pyx_t_11 = PyFloat_FromDouble((100. / ((double)__pyx_v_length))); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 694, __pyx_L1_error)
+        __pyx_t_11 = PyFloat_FromDouble((100. / ((double)__pyx_v_length))); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 751, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_11);
-        __pyx_t_13 = PyNumber_InPlaceAdd(__pyx_v_pbar, __pyx_t_11); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 694, __pyx_L1_error)
+        __pyx_t_13 = PyNumber_InPlaceAdd(__pyx_v_pbar, __pyx_t_11); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 751, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_13);
         __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
         __Pyx_DECREF_SET(__pyx_v_pbar, __pyx_t_13);
         __pyx_t_13 = 0;
 
-        /* "soapcw/soapcw.pyx":691
+        /* "soapcw/soapcw.pyx":748
  *                                             continue
  *             if self.prog == True:
  *                 if pt>pbar:             # <<<<<<<<<<<<<<
  *                     stdout.write('\r{} %'.format(round(pt)))
  *                     stdout.flush()
  */
       }
 
-      /* "soapcw/soapcw.pyx":690
+      /* "soapcw/soapcw.pyx":747
  *                                         else:
  *                                             continue
  *             if self.prog == True:             # <<<<<<<<<<<<<<
  *                 if pt>pbar:
  *                     stdout.write('\r{} %'.format(round(pt)))
  */
     }
   }
 
-  /* "soapcw/soapcw.pyx":696
+  /* "soapcw/soapcw.pyx":753
  *                     pbar+=100./length
  * 
  *         self.V = np.array(val)             # <<<<<<<<<<<<<<
  *         self.prev = np.array(prev)
  *         self.det1 = np.array(det1)
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_11, __pyx_n_s_np); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 696, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_11, __pyx_n_s_np); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 753, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_11);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_11, __pyx_n_s_array); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 696, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_11, __pyx_n_s_array); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 753, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
-  __pyx_t_11 = __pyx_memoryview_fromslice(__pyx_v_val, 2, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);; if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 696, __pyx_L1_error)
+  __pyx_t_11 = __pyx_memoryview_fromslice(__pyx_v_val, 2, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);; if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 753, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_11);
   __pyx_t_3 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
     __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_4);
     if (likely(__pyx_t_3)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
       __Pyx_INCREF(__pyx_t_3);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_4, function);
     }
   }
   __pyx_t_13 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_3, __pyx_t_11) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_11);
   __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
-  if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 696, __pyx_L1_error)
+  if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 753, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_V, __pyx_t_13) < 0) __PYX_ERR(0, 696, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_V, __pyx_t_13) < 0) __PYX_ERR(0, 753, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
 
-  /* "soapcw/soapcw.pyx":697
+  /* "soapcw/soapcw.pyx":754
  * 
  *         self.V = np.array(val)
  *         self.prev = np.array(prev)             # <<<<<<<<<<<<<<
  *         self.det1 = np.array(det1)
  *         self.det2 = np.array(det2)
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 697, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 754, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_array); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 697, __pyx_L1_error)
+  __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_array); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 754, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_11);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_memoryview_fromslice(__pyx_v_prev, 2, (PyObject *(*)(char *)) __pyx_memview_get_int, (int (*)(char *, PyObject *)) __pyx_memview_set_int, 0);; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 697, __pyx_L1_error)
+  __pyx_t_4 = __pyx_memoryview_fromslice(__pyx_v_prev, 2, (PyObject *(*)(char *)) __pyx_memview_get_int, (int (*)(char *, PyObject *)) __pyx_memview_set_int, 0);; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 754, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __pyx_t_3 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_11))) {
     __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_11);
     if (likely(__pyx_t_3)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_11);
       __Pyx_INCREF(__pyx_t_3);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_11, function);
     }
   }
   __pyx_t_13 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_11, __pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_11, __pyx_t_4);
   __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 697, __pyx_L1_error)
+  if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 754, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
   __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_prev, __pyx_t_13) < 0) __PYX_ERR(0, 697, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_prev, __pyx_t_13) < 0) __PYX_ERR(0, 754, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
 
-  /* "soapcw/soapcw.pyx":698
+  /* "soapcw/soapcw.pyx":755
  *         self.V = np.array(val)
  *         self.prev = np.array(prev)
  *         self.det1 = np.array(det1)             # <<<<<<<<<<<<<<
  *         self.det2 = np.array(det2)
  *         self.width = width
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_11, __pyx_n_s_np); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 698, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_11, __pyx_n_s_np); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 755, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_11);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_11, __pyx_n_s_array); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 698, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_11, __pyx_n_s_array); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 755, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
-  __pyx_t_11 = __pyx_memoryview_fromslice(__pyx_v_det1, 2, (PyObject *(*)(char *)) __pyx_memview_get_int, (int (*)(char *, PyObject *)) __pyx_memview_set_int, 0);; if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 698, __pyx_L1_error)
+  __pyx_t_11 = __pyx_memoryview_fromslice(__pyx_v_det1, 2, (PyObject *(*)(char *)) __pyx_memview_get_int, (int (*)(char *, PyObject *)) __pyx_memview_set_int, 0);; if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 755, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_11);
   __pyx_t_3 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
     __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_4);
     if (likely(__pyx_t_3)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
       __Pyx_INCREF(__pyx_t_3);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_4, function);
     }
   }
   __pyx_t_13 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_3, __pyx_t_11) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_11);
   __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
-  if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 698, __pyx_L1_error)
+  if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 755, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_det1, __pyx_t_13) < 0) __PYX_ERR(0, 698, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_det1, __pyx_t_13) < 0) __PYX_ERR(0, 755, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
 
-  /* "soapcw/soapcw.pyx":699
+  /* "soapcw/soapcw.pyx":756
  *         self.prev = np.array(prev)
  *         self.det1 = np.array(det1)
  *         self.det2 = np.array(det2)             # <<<<<<<<<<<<<<
  *         self.width = width
  *         self.length = length
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 699, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 756, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_array); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 699, __pyx_L1_error)
+  __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_array); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 756, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_11);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_memoryview_fromslice(__pyx_v_det2, 2, (PyObject *(*)(char *)) __pyx_memview_get_int, (int (*)(char *, PyObject *)) __pyx_memview_set_int, 0);; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 699, __pyx_L1_error)
+  __pyx_t_4 = __pyx_memoryview_fromslice(__pyx_v_det2, 2, (PyObject *(*)(char *)) __pyx_memview_get_int, (int (*)(char *, PyObject *)) __pyx_memview_set_int, 0);; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 756, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __pyx_t_3 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_11))) {
     __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_11);
     if (likely(__pyx_t_3)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_11);
       __Pyx_INCREF(__pyx_t_3);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_11, function);
     }
   }
   __pyx_t_13 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_11, __pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_11, __pyx_t_4);
   __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 699, __pyx_L1_error)
+  if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 756, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
   __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_det2, __pyx_t_13) < 0) __PYX_ERR(0, 699, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_det2, __pyx_t_13) < 0) __PYX_ERR(0, 756, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
 
-  /* "soapcw/soapcw.pyx":700
+  /* "soapcw/soapcw.pyx":757
  *         self.det1 = np.array(det1)
  *         self.det2 = np.array(det2)
  *         self.width = width             # <<<<<<<<<<<<<<
  *         self.length = length
  * 
  */
-  __pyx_t_13 = __Pyx_PyInt_From_int(__pyx_v_width); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 700, __pyx_L1_error)
+  __pyx_t_13 = __Pyx_PyInt_From_int(__pyx_v_width); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 757, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_width, __pyx_t_13) < 0) __PYX_ERR(0, 700, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_width, __pyx_t_13) < 0) __PYX_ERR(0, 757, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
 
-  /* "soapcw/soapcw.pyx":701
+  /* "soapcw/soapcw.pyx":758
  *         self.det2 = np.array(det2)
  *         self.width = width
  *         self.length = length             # <<<<<<<<<<<<<<
  * 
  *     def get_track(self):
  */
-  __pyx_t_13 = __Pyx_PyInt_From_int(__pyx_v_length); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 701, __pyx_L1_error)
+  __pyx_t_13 = __Pyx_PyInt_From_int(__pyx_v_length); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 758, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_length, __pyx_t_13) < 0) __PYX_ERR(0, 701, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_length, __pyx_t_13) < 0) __PYX_ERR(0, 758, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
 
-  /* "soapcw/soapcw.pyx":542
+  /* "soapcw/soapcw.pyx":599
  *         self.length = length
  * 
- *     def run_lookup_amp(self,tr1, obs11, obs21,lookup_file = None, fractions = None):             # <<<<<<<<<<<<<<
+ *     def run_lookup_amp(self,tr1, obs11, obs21,lookup_table = None, fractions = None):             # <<<<<<<<<<<<<<
  *         """
  *         viterbi algorithm for two detectors with an lookup table for the line veto statistic
  */
 
   /* function exit code */
   __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
@@ -15606,15 +15944,15 @@
   __Pyx_XDECREF(__pyx_8genexpr3__pyx_v_lkl);
   __Pyx_XDECREF(__pyx_v_fractions);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "soapcw/soapcw.pyx":703
+/* "soapcw/soapcw.pyx":760
  *         self.length = length
  * 
  *     def get_track(self):             # <<<<<<<<<<<<<<
  *         """
  *         Takes in the viterbi data from a run and identifies the track thorugh whcih gives the maximum probability
  */
 
@@ -15662,262 +16000,262 @@
   int __pyx_t_15;
   Py_ssize_t __pyx_t_16;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("get_track", 0);
 
-  /* "soapcw/soapcw.pyx":717
+  /* "soapcw/soapcw.pyx":774
  *            value of maxmimum end statistic
  *         """
  *         cdef long previous = 1             # <<<<<<<<<<<<<<
  *         cdef long[:] vit_trackr = np.zeros(self.length).astype(int)
  *         cdef long[:] vit_track2 = np.zeros(self.length).astype(int)
  */
   __pyx_v_previous = 1;
 
-  /* "soapcw/soapcw.pyx":718
+  /* "soapcw/soapcw.pyx":775
  *         """
  *         cdef long previous = 1
  *         cdef long[:] vit_trackr = np.zeros(self.length).astype(int)             # <<<<<<<<<<<<<<
  *         cdef long[:] vit_track2 = np.zeros(self.length).astype(int)
  *         cdef long[:] vit_track1 = np.zeros(self.length).astype(int)
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 718, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 775, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_zeros); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 718, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_zeros); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 775, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_length); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 718, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_length); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 775, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __pyx_t_5 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
     __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
     if (likely(__pyx_t_5)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
       __Pyx_INCREF(__pyx_t_5);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_4, function);
     }
   }
   __pyx_t_2 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_5, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_3);
   __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 718, __pyx_L1_error)
+  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 775, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_astype); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 718, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_astype); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 775, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_t_2 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
     __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_4);
     if (likely(__pyx_t_2)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
       __Pyx_INCREF(__pyx_t_2);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_4, function);
     }
   }
   __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_2, ((PyObject *)(&PyInt_Type))) : __Pyx_PyObject_CallOneArg(__pyx_t_4, ((PyObject *)(&PyInt_Type)));
   __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 718, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 775, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_6 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_6.memview)) __PYX_ERR(0, 718, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_6.memview)) __PYX_ERR(0, 775, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_vit_trackr = __pyx_t_6;
   __pyx_t_6.memview = NULL;
   __pyx_t_6.data = NULL;
 
-  /* "soapcw/soapcw.pyx":719
+  /* "soapcw/soapcw.pyx":776
  *         cdef long previous = 1
  *         cdef long[:] vit_trackr = np.zeros(self.length).astype(int)
  *         cdef long[:] vit_track2 = np.zeros(self.length).astype(int)             # <<<<<<<<<<<<<<
  *         cdef long[:] vit_track1 = np.zeros(self.length).astype(int)
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 719, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 776, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_zeros); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 719, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_zeros); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 776, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_length); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 719, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_length); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 776, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_5 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
     __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_3);
     if (likely(__pyx_t_5)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
       __Pyx_INCREF(__pyx_t_5);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_3, function);
     }
   }
   __pyx_t_4 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_5, __pyx_t_2) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_2);
   __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 719, __pyx_L1_error)
+  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 776, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_astype); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 719, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_astype); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 776, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_t_4 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
     __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
     if (likely(__pyx_t_4)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
       __Pyx_INCREF(__pyx_t_4);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_3, function);
     }
   }
   __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, ((PyObject *)(&PyInt_Type))) : __Pyx_PyObject_CallOneArg(__pyx_t_3, ((PyObject *)(&PyInt_Type)));
   __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 719, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 776, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_6 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_6.memview)) __PYX_ERR(0, 719, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_6.memview)) __PYX_ERR(0, 776, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_vit_track2 = __pyx_t_6;
   __pyx_t_6.memview = NULL;
   __pyx_t_6.data = NULL;
 
-  /* "soapcw/soapcw.pyx":720
+  /* "soapcw/soapcw.pyx":777
  *         cdef long[:] vit_trackr = np.zeros(self.length).astype(int)
  *         cdef long[:] vit_track2 = np.zeros(self.length).astype(int)
  *         cdef long[:] vit_track1 = np.zeros(self.length).astype(int)             # <<<<<<<<<<<<<<
  * 
  *         cdef float max_prob = np.array([self.V[self.length-1][i] for i in range(self.width)]).max()
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 720, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 777, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 720, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 777, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_length); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 720, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_length); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 777, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __pyx_t_5 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
     __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_2);
     if (likely(__pyx_t_5)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
       __Pyx_INCREF(__pyx_t_5);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_2, function);
     }
   }
   __pyx_t_3 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_5, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_4);
   __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 720, __pyx_L1_error)
+  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 777, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_astype); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 720, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_astype); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 777, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_t_3 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
     __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
     if (likely(__pyx_t_3)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
       __Pyx_INCREF(__pyx_t_3);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_2, function);
     }
   }
   __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, ((PyObject *)(&PyInt_Type))) : __Pyx_PyObject_CallOneArg(__pyx_t_2, ((PyObject *)(&PyInt_Type)));
   __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 720, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 777, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_6 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_6.memview)) __PYX_ERR(0, 720, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_6.memview)) __PYX_ERR(0, 777, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_vit_track1 = __pyx_t_6;
   __pyx_t_6.memview = NULL;
   __pyx_t_6.data = NULL;
 
-  /* "soapcw/soapcw.pyx":722
+  /* "soapcw/soapcw.pyx":779
  *         cdef long[:] vit_track1 = np.zeros(self.length).astype(int)
  * 
  *         cdef float max_prob = np.array([self.V[self.length-1][i] for i in range(self.width)]).max()             # <<<<<<<<<<<<<<
  *         cdef long max_prob_index = np.array([self.V[self.length-1][i] for i in range(self.width)]).argmax()
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 722, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 779, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_array); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 722, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_array); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 779, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   { /* enter inner scope */
-    __pyx_t_3 = PyList_New(0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 722, __pyx_L5_error)
+    __pyx_t_3 = PyList_New(0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 779, __pyx_L5_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_width); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 722, __pyx_L5_error)
+    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_width); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 779, __pyx_L5_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_7 = __Pyx_PyObject_CallOneArg(__pyx_builtin_range, __pyx_t_5); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 722, __pyx_L5_error)
+    __pyx_t_7 = __Pyx_PyObject_CallOneArg(__pyx_builtin_range, __pyx_t_5); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 779, __pyx_L5_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     if (likely(PyList_CheckExact(__pyx_t_7)) || PyTuple_CheckExact(__pyx_t_7)) {
       __pyx_t_5 = __pyx_t_7; __Pyx_INCREF(__pyx_t_5); __pyx_t_8 = 0;
       __pyx_t_9 = NULL;
     } else {
-      __pyx_t_8 = -1; __pyx_t_5 = PyObject_GetIter(__pyx_t_7); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 722, __pyx_L5_error)
+      __pyx_t_8 = -1; __pyx_t_5 = PyObject_GetIter(__pyx_t_7); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 779, __pyx_L5_error)
       __Pyx_GOTREF(__pyx_t_5);
-      __pyx_t_9 = Py_TYPE(__pyx_t_5)->tp_iternext; if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 722, __pyx_L5_error)
+      __pyx_t_9 = Py_TYPE(__pyx_t_5)->tp_iternext; if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 779, __pyx_L5_error)
     }
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     for (;;) {
       if (likely(!__pyx_t_9)) {
         if (likely(PyList_CheckExact(__pyx_t_5))) {
           if (__pyx_t_8 >= PyList_GET_SIZE(__pyx_t_5)) break;
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-          __pyx_t_7 = PyList_GET_ITEM(__pyx_t_5, __pyx_t_8); __Pyx_INCREF(__pyx_t_7); __pyx_t_8++; if (unlikely(0 < 0)) __PYX_ERR(0, 722, __pyx_L5_error)
+          __pyx_t_7 = PyList_GET_ITEM(__pyx_t_5, __pyx_t_8); __Pyx_INCREF(__pyx_t_7); __pyx_t_8++; if (unlikely(0 < 0)) __PYX_ERR(0, 779, __pyx_L5_error)
           #else
-          __pyx_t_7 = PySequence_ITEM(__pyx_t_5, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 722, __pyx_L5_error)
+          __pyx_t_7 = PySequence_ITEM(__pyx_t_5, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 779, __pyx_L5_error)
           __Pyx_GOTREF(__pyx_t_7);
           #endif
         } else {
           if (__pyx_t_8 >= PyTuple_GET_SIZE(__pyx_t_5)) break;
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-          __pyx_t_7 = PyTuple_GET_ITEM(__pyx_t_5, __pyx_t_8); __Pyx_INCREF(__pyx_t_7); __pyx_t_8++; if (unlikely(0 < 0)) __PYX_ERR(0, 722, __pyx_L5_error)
+          __pyx_t_7 = PyTuple_GET_ITEM(__pyx_t_5, __pyx_t_8); __Pyx_INCREF(__pyx_t_7); __pyx_t_8++; if (unlikely(0 < 0)) __PYX_ERR(0, 779, __pyx_L5_error)
           #else
-          __pyx_t_7 = PySequence_ITEM(__pyx_t_5, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 722, __pyx_L5_error)
+          __pyx_t_7 = PySequence_ITEM(__pyx_t_5, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 779, __pyx_L5_error)
           __Pyx_GOTREF(__pyx_t_7);
           #endif
         }
       } else {
         __pyx_t_7 = __pyx_t_9(__pyx_t_5);
         if (unlikely(!__pyx_t_7)) {
           PyObject* exc_type = PyErr_Occurred();
           if (exc_type) {
             if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-            else __PYX_ERR(0, 722, __pyx_L5_error)
+            else __PYX_ERR(0, 779, __pyx_L5_error)
           }
           break;
         }
         __Pyx_GOTREF(__pyx_t_7);
       }
       __Pyx_XDECREF_SET(__pyx_8genexpr5__pyx_v_i, __pyx_t_7);
       __pyx_t_7 = 0;
-      __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_V); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 722, __pyx_L5_error)
+      __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_V); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 779, __pyx_L5_error)
       __Pyx_GOTREF(__pyx_t_7);
-      __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_length); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 722, __pyx_L5_error)
+      __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_length); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 779, __pyx_L5_error)
       __Pyx_GOTREF(__pyx_t_10);
-      __pyx_t_11 = __Pyx_PyInt_SubtractObjC(__pyx_t_10, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 722, __pyx_L5_error)
+      __pyx_t_11 = __Pyx_PyInt_SubtractObjC(__pyx_t_10, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 779, __pyx_L5_error)
       __Pyx_GOTREF(__pyx_t_11);
       __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-      __pyx_t_10 = __Pyx_PyObject_GetItem(__pyx_t_7, __pyx_t_11); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 722, __pyx_L5_error)
+      __pyx_t_10 = __Pyx_PyObject_GetItem(__pyx_t_7, __pyx_t_11); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 779, __pyx_L5_error)
       __Pyx_GOTREF(__pyx_t_10);
       __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
       __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
-      __pyx_t_11 = __Pyx_PyObject_GetItem(__pyx_t_10, __pyx_8genexpr5__pyx_v_i); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 722, __pyx_L5_error)
+      __pyx_t_11 = __Pyx_PyObject_GetItem(__pyx_t_10, __pyx_8genexpr5__pyx_v_i); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 779, __pyx_L5_error)
       __Pyx_GOTREF(__pyx_t_11);
       __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-      if (unlikely(__Pyx_ListComp_Append(__pyx_t_3, (PyObject*)__pyx_t_11))) __PYX_ERR(0, 722, __pyx_L5_error)
+      if (unlikely(__Pyx_ListComp_Append(__pyx_t_3, (PyObject*)__pyx_t_11))) __PYX_ERR(0, 779, __pyx_L5_error)
       __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
     }
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     __Pyx_XDECREF(__pyx_8genexpr5__pyx_v_i); __pyx_8genexpr5__pyx_v_i = 0;
     goto __pyx_L8_exit_scope;
     __pyx_L5_error:;
     __Pyx_XDECREF(__pyx_8genexpr5__pyx_v_i); __pyx_8genexpr5__pyx_v_i = 0;
@@ -15933,116 +16271,116 @@
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_4, function);
     }
   }
   __pyx_t_2 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_5, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_3);
   __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 722, __pyx_L1_error)
+  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 779, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_max); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 722, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_max); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 779, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_t_2 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
     __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_4);
     if (likely(__pyx_t_2)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
       __Pyx_INCREF(__pyx_t_2);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_4, function);
     }
   }
   __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_2) : __Pyx_PyObject_CallNoArg(__pyx_t_4);
   __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 722, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 779, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_12 = __pyx_PyFloat_AsFloat(__pyx_t_1); if (unlikely((__pyx_t_12 == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 722, __pyx_L1_error)
+  __pyx_t_12 = __pyx_PyFloat_AsFloat(__pyx_t_1); if (unlikely((__pyx_t_12 == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 779, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_max_prob = __pyx_t_12;
 
-  /* "soapcw/soapcw.pyx":723
+  /* "soapcw/soapcw.pyx":780
  * 
  *         cdef float max_prob = np.array([self.V[self.length-1][i] for i in range(self.width)]).max()
  *         cdef long max_prob_index = np.array([self.V[self.length-1][i] for i in range(self.width)]).argmax()             # <<<<<<<<<<<<<<
  * 
  *         vit_trackr[self.length-1] = max_prob_index
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 723, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 780, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_array); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 723, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_array); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 780, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   { /* enter inner scope */
-    __pyx_t_2 = PyList_New(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 723, __pyx_L11_error)
+    __pyx_t_2 = PyList_New(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 780, __pyx_L11_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_width); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 723, __pyx_L11_error)
+    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_width); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 780, __pyx_L11_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_11 = __Pyx_PyObject_CallOneArg(__pyx_builtin_range, __pyx_t_5); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 723, __pyx_L11_error)
+    __pyx_t_11 = __Pyx_PyObject_CallOneArg(__pyx_builtin_range, __pyx_t_5); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 780, __pyx_L11_error)
     __Pyx_GOTREF(__pyx_t_11);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     if (likely(PyList_CheckExact(__pyx_t_11)) || PyTuple_CheckExact(__pyx_t_11)) {
       __pyx_t_5 = __pyx_t_11; __Pyx_INCREF(__pyx_t_5); __pyx_t_8 = 0;
       __pyx_t_9 = NULL;
     } else {
-      __pyx_t_8 = -1; __pyx_t_5 = PyObject_GetIter(__pyx_t_11); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 723, __pyx_L11_error)
+      __pyx_t_8 = -1; __pyx_t_5 = PyObject_GetIter(__pyx_t_11); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 780, __pyx_L11_error)
       __Pyx_GOTREF(__pyx_t_5);
-      __pyx_t_9 = Py_TYPE(__pyx_t_5)->tp_iternext; if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 723, __pyx_L11_error)
+      __pyx_t_9 = Py_TYPE(__pyx_t_5)->tp_iternext; if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 780, __pyx_L11_error)
     }
     __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
     for (;;) {
       if (likely(!__pyx_t_9)) {
         if (likely(PyList_CheckExact(__pyx_t_5))) {
           if (__pyx_t_8 >= PyList_GET_SIZE(__pyx_t_5)) break;
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-          __pyx_t_11 = PyList_GET_ITEM(__pyx_t_5, __pyx_t_8); __Pyx_INCREF(__pyx_t_11); __pyx_t_8++; if (unlikely(0 < 0)) __PYX_ERR(0, 723, __pyx_L11_error)
+          __pyx_t_11 = PyList_GET_ITEM(__pyx_t_5, __pyx_t_8); __Pyx_INCREF(__pyx_t_11); __pyx_t_8++; if (unlikely(0 < 0)) __PYX_ERR(0, 780, __pyx_L11_error)
           #else
-          __pyx_t_11 = PySequence_ITEM(__pyx_t_5, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 723, __pyx_L11_error)
+          __pyx_t_11 = PySequence_ITEM(__pyx_t_5, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 780, __pyx_L11_error)
           __Pyx_GOTREF(__pyx_t_11);
           #endif
         } else {
           if (__pyx_t_8 >= PyTuple_GET_SIZE(__pyx_t_5)) break;
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-          __pyx_t_11 = PyTuple_GET_ITEM(__pyx_t_5, __pyx_t_8); __Pyx_INCREF(__pyx_t_11); __pyx_t_8++; if (unlikely(0 < 0)) __PYX_ERR(0, 723, __pyx_L11_error)
+          __pyx_t_11 = PyTuple_GET_ITEM(__pyx_t_5, __pyx_t_8); __Pyx_INCREF(__pyx_t_11); __pyx_t_8++; if (unlikely(0 < 0)) __PYX_ERR(0, 780, __pyx_L11_error)
           #else
-          __pyx_t_11 = PySequence_ITEM(__pyx_t_5, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 723, __pyx_L11_error)
+          __pyx_t_11 = PySequence_ITEM(__pyx_t_5, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 780, __pyx_L11_error)
           __Pyx_GOTREF(__pyx_t_11);
           #endif
         }
       } else {
         __pyx_t_11 = __pyx_t_9(__pyx_t_5);
         if (unlikely(!__pyx_t_11)) {
           PyObject* exc_type = PyErr_Occurred();
           if (exc_type) {
             if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-            else __PYX_ERR(0, 723, __pyx_L11_error)
+            else __PYX_ERR(0, 780, __pyx_L11_error)
           }
           break;
         }
         __Pyx_GOTREF(__pyx_t_11);
       }
       __Pyx_XDECREF_SET(__pyx_8genexpr6__pyx_v_i, __pyx_t_11);
       __pyx_t_11 = 0;
-      __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_V); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 723, __pyx_L11_error)
+      __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_V); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 780, __pyx_L11_error)
       __Pyx_GOTREF(__pyx_t_11);
-      __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_length); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 723, __pyx_L11_error)
+      __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_length); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 780, __pyx_L11_error)
       __Pyx_GOTREF(__pyx_t_10);
-      __pyx_t_7 = __Pyx_PyInt_SubtractObjC(__pyx_t_10, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 723, __pyx_L11_error)
+      __pyx_t_7 = __Pyx_PyInt_SubtractObjC(__pyx_t_10, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 780, __pyx_L11_error)
       __Pyx_GOTREF(__pyx_t_7);
       __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-      __pyx_t_10 = __Pyx_PyObject_GetItem(__pyx_t_11, __pyx_t_7); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 723, __pyx_L11_error)
+      __pyx_t_10 = __Pyx_PyObject_GetItem(__pyx_t_11, __pyx_t_7); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 780, __pyx_L11_error)
       __Pyx_GOTREF(__pyx_t_10);
       __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
       __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-      __pyx_t_7 = __Pyx_PyObject_GetItem(__pyx_t_10, __pyx_8genexpr6__pyx_v_i); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 723, __pyx_L11_error)
+      __pyx_t_7 = __Pyx_PyObject_GetItem(__pyx_t_10, __pyx_8genexpr6__pyx_v_i); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 780, __pyx_L11_error)
       __Pyx_GOTREF(__pyx_t_7);
       __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-      if (unlikely(__Pyx_ListComp_Append(__pyx_t_2, (PyObject*)__pyx_t_7))) __PYX_ERR(0, 723, __pyx_L11_error)
+      if (unlikely(__Pyx_ListComp_Append(__pyx_t_2, (PyObject*)__pyx_t_7))) __PYX_ERR(0, 780, __pyx_L11_error)
       __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     }
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     __Pyx_XDECREF(__pyx_8genexpr6__pyx_v_i); __pyx_8genexpr6__pyx_v_i = 0;
     goto __pyx_L14_exit_scope;
     __pyx_L11_error:;
     __Pyx_XDECREF(__pyx_8genexpr6__pyx_v_i); __pyx_8genexpr6__pyx_v_i = 0;
@@ -16058,464 +16396,464 @@
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_3, function);
     }
   }
   __pyx_t_4 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_5, __pyx_t_2) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_2);
   __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 723, __pyx_L1_error)
+  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 780, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_argmax); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 723, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_argmax); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 780, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_t_4 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
     __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
     if (likely(__pyx_t_4)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
       __Pyx_INCREF(__pyx_t_4);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_3, function);
     }
   }
   __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
   __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 723, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 780, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_13 = __Pyx_PyInt_As_long(__pyx_t_1); if (unlikely((__pyx_t_13 == (long)-1) && PyErr_Occurred())) __PYX_ERR(0, 723, __pyx_L1_error)
+  __pyx_t_13 = __Pyx_PyInt_As_long(__pyx_t_1); if (unlikely((__pyx_t_13 == (long)-1) && PyErr_Occurred())) __PYX_ERR(0, 780, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_max_prob_index = __pyx_t_13;
 
-  /* "soapcw/soapcw.pyx":725
+  /* "soapcw/soapcw.pyx":782
  *         cdef long max_prob_index = np.array([self.V[self.length-1][i] for i in range(self.width)]).argmax()
  * 
  *         vit_trackr[self.length-1] = max_prob_index             # <<<<<<<<<<<<<<
  *         vit_track1[self.length-1] = self.det1[self.length-1][max_prob_index]
  *         vit_track2[self.length-1] = self.det2[self.length-1][max_prob_index]
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_length); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 725, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_length); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 782, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyInt_SubtractObjC(__pyx_t_1, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 725, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyInt_SubtractObjC(__pyx_t_1, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 782, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_8 = __Pyx_PyIndex_AsSsize_t(__pyx_t_3); if (unlikely((__pyx_t_8 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 725, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyIndex_AsSsize_t(__pyx_t_3); if (unlikely((__pyx_t_8 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 782, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_t_14 = __pyx_t_8;
   __pyx_t_15 = -1;
   if (__pyx_t_14 < 0) {
     __pyx_t_14 += __pyx_v_vit_trackr.shape[0];
     if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
   } else if (unlikely(__pyx_t_14 >= __pyx_v_vit_trackr.shape[0])) __pyx_t_15 = 0;
   if (unlikely(__pyx_t_15 != -1)) {
     __Pyx_RaiseBufferIndexError(__pyx_t_15);
-    __PYX_ERR(0, 725, __pyx_L1_error)
+    __PYX_ERR(0, 782, __pyx_L1_error)
   }
   *((long *) ( /* dim=0 */ (__pyx_v_vit_trackr.data + __pyx_t_14 * __pyx_v_vit_trackr.strides[0]) )) = __pyx_v_max_prob_index;
 
-  /* "soapcw/soapcw.pyx":726
+  /* "soapcw/soapcw.pyx":783
  * 
  *         vit_trackr[self.length-1] = max_prob_index
  *         vit_track1[self.length-1] = self.det1[self.length-1][max_prob_index]             # <<<<<<<<<<<<<<
  *         vit_track2[self.length-1] = self.det2[self.length-1][max_prob_index]
  *         previous = self.prev[self.length-1][max_prob_index]
  */
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_det1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 726, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_det1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 783, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_length); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 726, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_length); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 783, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = __Pyx_PyInt_SubtractObjC(__pyx_t_1, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 726, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_SubtractObjC(__pyx_t_1, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 783, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_t_3, __pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 726, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_t_3, __pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 783, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_1, __pyx_v_max_prob_index, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 726, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_1, __pyx_v_max_prob_index, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 783, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_13 = __Pyx_PyInt_As_long(__pyx_t_4); if (unlikely((__pyx_t_13 == (long)-1) && PyErr_Occurred())) __PYX_ERR(0, 726, __pyx_L1_error)
+  __pyx_t_13 = __Pyx_PyInt_As_long(__pyx_t_4); if (unlikely((__pyx_t_13 == (long)-1) && PyErr_Occurred())) __PYX_ERR(0, 783, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_length); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 726, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_length); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 783, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_1 = __Pyx_PyInt_SubtractObjC(__pyx_t_4, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 726, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_SubtractObjC(__pyx_t_4, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 783, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_8 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_8 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 726, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyIndex_AsSsize_t(__pyx_t_1); if (unlikely((__pyx_t_8 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 783, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_t_14 = __pyx_t_8;
   __pyx_t_15 = -1;
   if (__pyx_t_14 < 0) {
     __pyx_t_14 += __pyx_v_vit_track1.shape[0];
     if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
   } else if (unlikely(__pyx_t_14 >= __pyx_v_vit_track1.shape[0])) __pyx_t_15 = 0;
   if (unlikely(__pyx_t_15 != -1)) {
     __Pyx_RaiseBufferIndexError(__pyx_t_15);
-    __PYX_ERR(0, 726, __pyx_L1_error)
+    __PYX_ERR(0, 783, __pyx_L1_error)
   }
   *((long *) ( /* dim=0 */ (__pyx_v_vit_track1.data + __pyx_t_14 * __pyx_v_vit_track1.strides[0]) )) = __pyx_t_13;
 
-  /* "soapcw/soapcw.pyx":727
+  /* "soapcw/soapcw.pyx":784
  *         vit_trackr[self.length-1] = max_prob_index
  *         vit_track1[self.length-1] = self.det1[self.length-1][max_prob_index]
  *         vit_track2[self.length-1] = self.det2[self.length-1][max_prob_index]             # <<<<<<<<<<<<<<
  *         previous = self.prev[self.length-1][max_prob_index]
  * 
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_det2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 727, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_det2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 784, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_length); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 727, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_length); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 784, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_3 = __Pyx_PyInt_SubtractObjC(__pyx_t_4, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 727, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyInt_SubtractObjC(__pyx_t_4, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 784, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 727, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 784, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = __Pyx_GetItemInt(__pyx_t_4, __pyx_v_max_prob_index, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 727, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_GetItemInt(__pyx_t_4, __pyx_v_max_prob_index, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 784, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_13 = __Pyx_PyInt_As_long(__pyx_t_3); if (unlikely((__pyx_t_13 == (long)-1) && PyErr_Occurred())) __PYX_ERR(0, 727, __pyx_L1_error)
+  __pyx_t_13 = __Pyx_PyInt_As_long(__pyx_t_3); if (unlikely((__pyx_t_13 == (long)-1) && PyErr_Occurred())) __PYX_ERR(0, 784, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_length); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 727, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_length); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 784, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = __Pyx_PyInt_SubtractObjC(__pyx_t_3, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 727, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_SubtractObjC(__pyx_t_3, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 784, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_8 = __Pyx_PyIndex_AsSsize_t(__pyx_t_4); if (unlikely((__pyx_t_8 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 727, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyIndex_AsSsize_t(__pyx_t_4); if (unlikely((__pyx_t_8 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 784, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_t_14 = __pyx_t_8;
   __pyx_t_15 = -1;
   if (__pyx_t_14 < 0) {
     __pyx_t_14 += __pyx_v_vit_track2.shape[0];
     if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
   } else if (unlikely(__pyx_t_14 >= __pyx_v_vit_track2.shape[0])) __pyx_t_15 = 0;
   if (unlikely(__pyx_t_15 != -1)) {
     __Pyx_RaiseBufferIndexError(__pyx_t_15);
-    __PYX_ERR(0, 727, __pyx_L1_error)
+    __PYX_ERR(0, 784, __pyx_L1_error)
   }
   *((long *) ( /* dim=0 */ (__pyx_v_vit_track2.data + __pyx_t_14 * __pyx_v_vit_track2.strides[0]) )) = __pyx_t_13;
 
-  /* "soapcw/soapcw.pyx":728
+  /* "soapcw/soapcw.pyx":785
  *         vit_track1[self.length-1] = self.det1[self.length-1][max_prob_index]
  *         vit_track2[self.length-1] = self.det2[self.length-1][max_prob_index]
  *         previous = self.prev[self.length-1][max_prob_index]             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_prev); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 728, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_prev); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 785, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_length); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 728, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_length); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 785, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_1 = __Pyx_PyInt_SubtractObjC(__pyx_t_3, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 728, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_SubtractObjC(__pyx_t_3, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 785, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_t_4, __pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 728, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_t_4, __pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 785, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_3, __pyx_v_max_prob_index, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 728, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_3, __pyx_v_max_prob_index, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 785, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_13 = __Pyx_PyInt_As_long(__pyx_t_1); if (unlikely((__pyx_t_13 == (long)-1) && PyErr_Occurred())) __PYX_ERR(0, 728, __pyx_L1_error)
+  __pyx_t_13 = __Pyx_PyInt_As_long(__pyx_t_1); if (unlikely((__pyx_t_13 == (long)-1) && PyErr_Occurred())) __PYX_ERR(0, 785, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_previous = __pyx_t_13;
 
-  /* "soapcw/soapcw.pyx":731
+  /* "soapcw/soapcw.pyx":788
  * 
  * 
  *         for t in range(self.length-2,-1,-1):             # <<<<<<<<<<<<<<
  *             vit_trackr[t] = previous # insert previous step
  *             vit_track1[t] = self.det1[t][previous]
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_length); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 731, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_length); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 788, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyInt_SubtractObjC(__pyx_t_1, __pyx_int_2, 2, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 731, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyInt_SubtractObjC(__pyx_t_1, __pyx_int_2, 2, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 788, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 731, __pyx_L1_error)
+  __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 788, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_3);
   PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_3);
   __Pyx_INCREF(__pyx_int_neg_1);
   __Pyx_GIVEREF(__pyx_int_neg_1);
   PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_int_neg_1);
   __Pyx_INCREF(__pyx_int_neg_1);
   __Pyx_GIVEREF(__pyx_int_neg_1);
   PyTuple_SET_ITEM(__pyx_t_1, 2, __pyx_int_neg_1);
   __pyx_t_3 = 0;
-  __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_range, __pyx_t_1, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 731, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_range, __pyx_t_1, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 788, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   if (likely(PyList_CheckExact(__pyx_t_3)) || PyTuple_CheckExact(__pyx_t_3)) {
     __pyx_t_1 = __pyx_t_3; __Pyx_INCREF(__pyx_t_1); __pyx_t_8 = 0;
     __pyx_t_9 = NULL;
   } else {
-    __pyx_t_8 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 731, __pyx_L1_error)
+    __pyx_t_8 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 788, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_9 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 731, __pyx_L1_error)
+    __pyx_t_9 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 788, __pyx_L1_error)
   }
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   for (;;) {
     if (likely(!__pyx_t_9)) {
       if (likely(PyList_CheckExact(__pyx_t_1))) {
         if (__pyx_t_8 >= PyList_GET_SIZE(__pyx_t_1)) break;
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_3 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_8); __Pyx_INCREF(__pyx_t_3); __pyx_t_8++; if (unlikely(0 < 0)) __PYX_ERR(0, 731, __pyx_L1_error)
+        __pyx_t_3 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_8); __Pyx_INCREF(__pyx_t_3); __pyx_t_8++; if (unlikely(0 < 0)) __PYX_ERR(0, 788, __pyx_L1_error)
         #else
-        __pyx_t_3 = PySequence_ITEM(__pyx_t_1, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 731, __pyx_L1_error)
+        __pyx_t_3 = PySequence_ITEM(__pyx_t_1, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 788, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
         #endif
       } else {
         if (__pyx_t_8 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_3 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_8); __Pyx_INCREF(__pyx_t_3); __pyx_t_8++; if (unlikely(0 < 0)) __PYX_ERR(0, 731, __pyx_L1_error)
+        __pyx_t_3 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_8); __Pyx_INCREF(__pyx_t_3); __pyx_t_8++; if (unlikely(0 < 0)) __PYX_ERR(0, 788, __pyx_L1_error)
         #else
-        __pyx_t_3 = PySequence_ITEM(__pyx_t_1, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 731, __pyx_L1_error)
+        __pyx_t_3 = PySequence_ITEM(__pyx_t_1, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 788, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
         #endif
       }
     } else {
       __pyx_t_3 = __pyx_t_9(__pyx_t_1);
       if (unlikely(!__pyx_t_3)) {
         PyObject* exc_type = PyErr_Occurred();
         if (exc_type) {
           if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-          else __PYX_ERR(0, 731, __pyx_L1_error)
+          else __PYX_ERR(0, 788, __pyx_L1_error)
         }
         break;
       }
       __Pyx_GOTREF(__pyx_t_3);
     }
     __Pyx_XDECREF_SET(__pyx_v_t, __pyx_t_3);
     __pyx_t_3 = 0;
 
-    /* "soapcw/soapcw.pyx":732
+    /* "soapcw/soapcw.pyx":789
  * 
  *         for t in range(self.length-2,-1,-1):
  *             vit_trackr[t] = previous # insert previous step             # <<<<<<<<<<<<<<
  *             vit_track1[t] = self.det1[t][previous]
  *             vit_track2[t] = self.det2[t][previous]
  */
-    __pyx_t_16 = __Pyx_PyIndex_AsSsize_t(__pyx_v_t); if (unlikely((__pyx_t_16 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 732, __pyx_L1_error)
+    __pyx_t_16 = __Pyx_PyIndex_AsSsize_t(__pyx_v_t); if (unlikely((__pyx_t_16 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 789, __pyx_L1_error)
     __pyx_t_14 = __pyx_t_16;
     __pyx_t_15 = -1;
     if (__pyx_t_14 < 0) {
       __pyx_t_14 += __pyx_v_vit_trackr.shape[0];
       if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
     } else if (unlikely(__pyx_t_14 >= __pyx_v_vit_trackr.shape[0])) __pyx_t_15 = 0;
     if (unlikely(__pyx_t_15 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_15);
-      __PYX_ERR(0, 732, __pyx_L1_error)
+      __PYX_ERR(0, 789, __pyx_L1_error)
     }
     *((long *) ( /* dim=0 */ (__pyx_v_vit_trackr.data + __pyx_t_14 * __pyx_v_vit_trackr.strides[0]) )) = __pyx_v_previous;
 
-    /* "soapcw/soapcw.pyx":733
+    /* "soapcw/soapcw.pyx":790
  *         for t in range(self.length-2,-1,-1):
  *             vit_trackr[t] = previous # insert previous step
  *             vit_track1[t] = self.det1[t][previous]             # <<<<<<<<<<<<<<
  *             vit_track2[t] = self.det2[t][previous]
  *             previous = self.prev[t][previous]
  */
-    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_det1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 733, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_det1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 790, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_t_3, __pyx_v_t); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 733, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_t_3, __pyx_v_t); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 790, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_t_3 = __Pyx_GetItemInt(__pyx_t_4, __pyx_v_previous, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 733, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_GetItemInt(__pyx_t_4, __pyx_v_previous, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 790, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_t_13 = __Pyx_PyInt_As_long(__pyx_t_3); if (unlikely((__pyx_t_13 == (long)-1) && PyErr_Occurred())) __PYX_ERR(0, 733, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyInt_As_long(__pyx_t_3); if (unlikely((__pyx_t_13 == (long)-1) && PyErr_Occurred())) __PYX_ERR(0, 790, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_t_16 = __Pyx_PyIndex_AsSsize_t(__pyx_v_t); if (unlikely((__pyx_t_16 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 733, __pyx_L1_error)
+    __pyx_t_16 = __Pyx_PyIndex_AsSsize_t(__pyx_v_t); if (unlikely((__pyx_t_16 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 790, __pyx_L1_error)
     __pyx_t_14 = __pyx_t_16;
     __pyx_t_15 = -1;
     if (__pyx_t_14 < 0) {
       __pyx_t_14 += __pyx_v_vit_track1.shape[0];
       if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
     } else if (unlikely(__pyx_t_14 >= __pyx_v_vit_track1.shape[0])) __pyx_t_15 = 0;
     if (unlikely(__pyx_t_15 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_15);
-      __PYX_ERR(0, 733, __pyx_L1_error)
+      __PYX_ERR(0, 790, __pyx_L1_error)
     }
     *((long *) ( /* dim=0 */ (__pyx_v_vit_track1.data + __pyx_t_14 * __pyx_v_vit_track1.strides[0]) )) = __pyx_t_13;
 
-    /* "soapcw/soapcw.pyx":734
+    /* "soapcw/soapcw.pyx":791
  *             vit_trackr[t] = previous # insert previous step
  *             vit_track1[t] = self.det1[t][previous]
  *             vit_track2[t] = self.det2[t][previous]             # <<<<<<<<<<<<<<
  *             previous = self.prev[t][previous]
  * 
  */
-    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_det2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 734, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_det2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 791, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_t_3, __pyx_v_t); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 734, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_t_3, __pyx_v_t); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 791, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_t_3 = __Pyx_GetItemInt(__pyx_t_4, __pyx_v_previous, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 734, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_GetItemInt(__pyx_t_4, __pyx_v_previous, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 791, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_t_13 = __Pyx_PyInt_As_long(__pyx_t_3); if (unlikely((__pyx_t_13 == (long)-1) && PyErr_Occurred())) __PYX_ERR(0, 734, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyInt_As_long(__pyx_t_3); if (unlikely((__pyx_t_13 == (long)-1) && PyErr_Occurred())) __PYX_ERR(0, 791, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_t_16 = __Pyx_PyIndex_AsSsize_t(__pyx_v_t); if (unlikely((__pyx_t_16 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 734, __pyx_L1_error)
+    __pyx_t_16 = __Pyx_PyIndex_AsSsize_t(__pyx_v_t); if (unlikely((__pyx_t_16 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 791, __pyx_L1_error)
     __pyx_t_14 = __pyx_t_16;
     __pyx_t_15 = -1;
     if (__pyx_t_14 < 0) {
       __pyx_t_14 += __pyx_v_vit_track2.shape[0];
       if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
     } else if (unlikely(__pyx_t_14 >= __pyx_v_vit_track2.shape[0])) __pyx_t_15 = 0;
     if (unlikely(__pyx_t_15 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_15);
-      __PYX_ERR(0, 734, __pyx_L1_error)
+      __PYX_ERR(0, 791, __pyx_L1_error)
     }
     *((long *) ( /* dim=0 */ (__pyx_v_vit_track2.data + __pyx_t_14 * __pyx_v_vit_track2.strides[0]) )) = __pyx_t_13;
 
-    /* "soapcw/soapcw.pyx":735
+    /* "soapcw/soapcw.pyx":792
  *             vit_track1[t] = self.det1[t][previous]
  *             vit_track2[t] = self.det2[t][previous]
  *             previous = self.prev[t][previous]             # <<<<<<<<<<<<<<
  * 
  *         self.vit_track1 = np.array(vit_track1)
  */
-    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_prev); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 735, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_prev); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 792, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_t_3, __pyx_v_t); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 735, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_t_3, __pyx_v_t); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 792, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_t_3 = __Pyx_GetItemInt(__pyx_t_4, __pyx_v_previous, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 735, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_GetItemInt(__pyx_t_4, __pyx_v_previous, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 792, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_t_13 = __Pyx_PyInt_As_long(__pyx_t_3); if (unlikely((__pyx_t_13 == (long)-1) && PyErr_Occurred())) __PYX_ERR(0, 735, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyInt_As_long(__pyx_t_3); if (unlikely((__pyx_t_13 == (long)-1) && PyErr_Occurred())) __PYX_ERR(0, 792, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_v_previous = __pyx_t_13;
 
-    /* "soapcw/soapcw.pyx":731
+    /* "soapcw/soapcw.pyx":788
  * 
  * 
  *         for t in range(self.length-2,-1,-1):             # <<<<<<<<<<<<<<
  *             vit_trackr[t] = previous # insert previous step
  *             vit_track1[t] = self.det1[t][previous]
  */
   }
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "soapcw/soapcw.pyx":737
+  /* "soapcw/soapcw.pyx":794
  *             previous = self.prev[t][previous]
  * 
  *         self.vit_track1 = np.array(vit_track1)             # <<<<<<<<<<<<<<
  *         self.vit_track2 = np.array(vit_track2)
  *         self.vit_track = np.array(vit_trackr)
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 737, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 794, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_array); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 737, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_array); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 794, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = __pyx_memoryview_fromslice(__pyx_v_vit_track1, 1, (PyObject *(*)(char *)) __pyx_memview_get_long, (int (*)(char *, PyObject *)) __pyx_memview_set_long, 0);; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 737, __pyx_L1_error)
+  __pyx_t_3 = __pyx_memoryview_fromslice(__pyx_v_vit_track1, 1, (PyObject *(*)(char *)) __pyx_memview_get_long, (int (*)(char *, PyObject *)) __pyx_memview_set_long, 0);; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 794, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __pyx_t_2 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
     __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_4);
     if (likely(__pyx_t_2)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
       __Pyx_INCREF(__pyx_t_2);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_4, function);
     }
   }
   __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_3);
   __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 737, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 794, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_vit_track1, __pyx_t_1) < 0) __PYX_ERR(0, 737, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_vit_track1, __pyx_t_1) < 0) __PYX_ERR(0, 794, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "soapcw/soapcw.pyx":738
+  /* "soapcw/soapcw.pyx":795
  * 
  *         self.vit_track1 = np.array(vit_track1)
  *         self.vit_track2 = np.array(vit_track2)             # <<<<<<<<<<<<<<
  *         self.vit_track = np.array(vit_trackr)
  *         self.max_end_prob = max_prob
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 738, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 795, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_array); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 738, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_array); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 795, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_memoryview_fromslice(__pyx_v_vit_track2, 1, (PyObject *(*)(char *)) __pyx_memview_get_long, (int (*)(char *, PyObject *)) __pyx_memview_set_long, 0);; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 738, __pyx_L1_error)
+  __pyx_t_4 = __pyx_memoryview_fromslice(__pyx_v_vit_track2, 1, (PyObject *(*)(char *)) __pyx_memview_get_long, (int (*)(char *, PyObject *)) __pyx_memview_set_long, 0);; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 795, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __pyx_t_2 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
     __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
     if (likely(__pyx_t_2)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
       __Pyx_INCREF(__pyx_t_2);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_3, function);
     }
   }
   __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_2, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4);
   __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 738, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 795, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_vit_track2, __pyx_t_1) < 0) __PYX_ERR(0, 738, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_vit_track2, __pyx_t_1) < 0) __PYX_ERR(0, 795, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "soapcw/soapcw.pyx":739
+  /* "soapcw/soapcw.pyx":796
  *         self.vit_track1 = np.array(vit_track1)
  *         self.vit_track2 = np.array(vit_track2)
  *         self.vit_track = np.array(vit_trackr)             # <<<<<<<<<<<<<<
  *         self.max_end_prob = max_prob
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 739, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 796, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_array); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 739, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_array); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 796, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = __pyx_memoryview_fromslice(__pyx_v_vit_trackr, 1, (PyObject *(*)(char *)) __pyx_memview_get_long, (int (*)(char *, PyObject *)) __pyx_memview_set_long, 0);; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 739, __pyx_L1_error)
+  __pyx_t_3 = __pyx_memoryview_fromslice(__pyx_v_vit_trackr, 1, (PyObject *(*)(char *)) __pyx_memview_get_long, (int (*)(char *, PyObject *)) __pyx_memview_set_long, 0);; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 796, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __pyx_t_2 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
     __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_4);
     if (likely(__pyx_t_2)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
       __Pyx_INCREF(__pyx_t_2);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_4, function);
     }
   }
   __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_3);
   __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 739, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 796, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_vit_track, __pyx_t_1) < 0) __PYX_ERR(0, 739, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_vit_track, __pyx_t_1) < 0) __PYX_ERR(0, 796, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "soapcw/soapcw.pyx":740
+  /* "soapcw/soapcw.pyx":797
  *         self.vit_track2 = np.array(vit_track2)
  *         self.vit_track = np.array(vit_trackr)
  *         self.max_end_prob = max_prob             # <<<<<<<<<<<<<<
  * 
  *         #return np.array(vit_track1), np.array(vit_track2), np.array(vit_trackr), np.array(val),np.array(prev),max_prob
  */
-  __pyx_t_1 = PyFloat_FromDouble(__pyx_v_max_prob); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 740, __pyx_L1_error)
+  __pyx_t_1 = PyFloat_FromDouble(__pyx_v_max_prob); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 797, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_max_end_prob, __pyx_t_1) < 0) __PYX_ERR(0, 740, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_max_end_prob, __pyx_t_1) < 0) __PYX_ERR(0, 797, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "soapcw/soapcw.pyx":703
+  /* "soapcw/soapcw.pyx":760
  *         self.length = length
  * 
  *     def get_track(self):             # <<<<<<<<<<<<<<
  *         """
  *         Takes in the viterbi data from a run and identifies the track thorugh whcih gives the maximum probability
  */
 
@@ -16542,15 +16880,15 @@
   __Pyx_XDECREF(__pyx_8genexpr5__pyx_v_i);
   __Pyx_XDECREF(__pyx_8genexpr6__pyx_v_i);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "soapcw/soapcw.pyx":747
+/* "soapcw/soapcw.pyx":804
  * class three_detector(object):
  * 
  *     def __init__(self, tr, obs1, obs2, obs3, prog = False):             # <<<<<<<<<<<<<<
  *         '''
  *         initialising viterbi class
  */
 
@@ -16599,43 +16937,43 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_tr)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__init__", 0, 5, 6, 1); __PYX_ERR(0, 747, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__init__", 0, 5, 6, 1); __PYX_ERR(0, 804, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_obs1)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__init__", 0, 5, 6, 2); __PYX_ERR(0, 747, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__init__", 0, 5, 6, 2); __PYX_ERR(0, 804, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_obs2)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__init__", 0, 5, 6, 3); __PYX_ERR(0, 747, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__init__", 0, 5, 6, 3); __PYX_ERR(0, 804, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (likely((values[4] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_obs3)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__init__", 0, 5, 6, 4); __PYX_ERR(0, 747, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__init__", 0, 5, 6, 4); __PYX_ERR(0, 804, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  5:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_prog);
           if (value) { values[5] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) __PYX_ERR(0, 747, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) __PYX_ERR(0, 804, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  6: values[5] = PyTuple_GET_ITEM(__pyx_args, 5);
         CYTHON_FALLTHROUGH;
         case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
         values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
@@ -16651,15 +16989,15 @@
     __pyx_v_obs1 = values[2];
     __pyx_v_obs2 = values[3];
     __pyx_v_obs3 = values[4];
     __pyx_v_prog = values[5];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__init__", 0, 5, 6, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 747, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("__init__", 0, 5, 6, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 804, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("soapcw.soapcw.three_detector.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6soapcw_6soapcw_14three_detector___init__(__pyx_self, __pyx_v_self, __pyx_v_tr, __pyx_v_obs1, __pyx_v_obs2, __pyx_v_obs3, __pyx_v_prog);
 
@@ -16677,31 +17015,31 @@
   int __pyx_t_4;
   PyObject *__pyx_t_5 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__init__", 0);
 
-  /* "soapcw/soapcw.pyx":751
+  /* "soapcw/soapcw.pyx":808
  *         initialising viterbi class
  *         '''
  *         self.prog = prog             # <<<<<<<<<<<<<<
  *         self.tracks = self.run(tr, obs1, obs2, obs3)
  * 
  */
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_prog, __pyx_v_prog) < 0) __PYX_ERR(0, 751, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_prog, __pyx_v_prog) < 0) __PYX_ERR(0, 808, __pyx_L1_error)
 
-  /* "soapcw/soapcw.pyx":752
+  /* "soapcw/soapcw.pyx":809
  *         '''
  *         self.prog = prog
  *         self.tracks = self.run(tr, obs1, obs2, obs3)             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_run); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 752, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_run); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 809, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_3 = NULL;
   __pyx_t_4 = 0;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
     __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
     if (likely(__pyx_t_3)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
@@ -16710,29 +17048,29 @@
       __Pyx_DECREF_SET(__pyx_t_2, function);
       __pyx_t_4 = 1;
     }
   }
   #if CYTHON_FAST_PYCALL
   if (PyFunction_Check(__pyx_t_2)) {
     PyObject *__pyx_temp[5] = {__pyx_t_3, __pyx_v_tr, __pyx_v_obs1, __pyx_v_obs2, __pyx_v_obs3};
-    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_4, 4+__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 752, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_4, 4+__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 809, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_GOTREF(__pyx_t_1);
   } else
   #endif
   #if CYTHON_FAST_PYCCALL
   if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
     PyObject *__pyx_temp[5] = {__pyx_t_3, __pyx_v_tr, __pyx_v_obs1, __pyx_v_obs2, __pyx_v_obs3};
-    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_4, 4+__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 752, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_4, 4+__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 809, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_GOTREF(__pyx_t_1);
   } else
   #endif
   {
-    __pyx_t_5 = PyTuple_New(4+__pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 752, __pyx_L1_error)
+    __pyx_t_5 = PyTuple_New(4+__pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 809, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     if (__pyx_t_3) {
       __Pyx_GIVEREF(__pyx_t_3); PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_3); __pyx_t_3 = NULL;
     }
     __Pyx_INCREF(__pyx_v_tr);
     __Pyx_GIVEREF(__pyx_v_tr);
     PyTuple_SET_ITEM(__pyx_t_5, 0+__pyx_t_4, __pyx_v_tr);
@@ -16741,23 +17079,23 @@
     PyTuple_SET_ITEM(__pyx_t_5, 1+__pyx_t_4, __pyx_v_obs1);
     __Pyx_INCREF(__pyx_v_obs2);
     __Pyx_GIVEREF(__pyx_v_obs2);
     PyTuple_SET_ITEM(__pyx_t_5, 2+__pyx_t_4, __pyx_v_obs2);
     __Pyx_INCREF(__pyx_v_obs3);
     __Pyx_GIVEREF(__pyx_v_obs3);
     PyTuple_SET_ITEM(__pyx_t_5, 3+__pyx_t_4, __pyx_v_obs3);
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_5, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 752, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_5, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 809, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   }
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_tracks, __pyx_t_1) < 0) __PYX_ERR(0, 752, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_tracks, __pyx_t_1) < 0) __PYX_ERR(0, 809, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "soapcw/soapcw.pyx":747
+  /* "soapcw/soapcw.pyx":804
  * class three_detector(object):
  * 
  *     def __init__(self, tr, obs1, obs2, obs3, prog = False):             # <<<<<<<<<<<<<<
  *         '''
  *         initialising viterbi class
  */
 
@@ -16773,15 +17111,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "soapcw/soapcw.pyx":760
+/* "soapcw/soapcw.pyx":817
  *     #--------------------------------------------------------
  * 
  *     def run(self,tr1, obs11, obs21, obs31):             # <<<<<<<<<<<<<<
  *         """
  *         viterbi algorithm for multiple detectors 2 at the moment
  */
 
@@ -16826,37 +17164,37 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_tr1)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("run", 1, 5, 5, 1); __PYX_ERR(0, 760, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("run", 1, 5, 5, 1); __PYX_ERR(0, 817, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_obs11)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("run", 1, 5, 5, 2); __PYX_ERR(0, 760, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("run", 1, 5, 5, 2); __PYX_ERR(0, 817, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_obs21)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("run", 1, 5, 5, 3); __PYX_ERR(0, 760, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("run", 1, 5, 5, 3); __PYX_ERR(0, 817, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (likely((values[4] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_obs31)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("run", 1, 5, 5, 4); __PYX_ERR(0, 760, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("run", 1, 5, 5, 4); __PYX_ERR(0, 817, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "run") < 0)) __PYX_ERR(0, 760, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "run") < 0)) __PYX_ERR(0, 817, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 5) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
@@ -16867,15 +17205,15 @@
     __pyx_v_tr1 = values[1];
     __pyx_v_obs11 = values[2];
     __pyx_v_obs21 = values[3];
     __pyx_v_obs31 = values[4];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("run", 1, 5, 5, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 760, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("run", 1, 5, 5, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 817, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("soapcw.soapcw.three_detector.run", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6soapcw_6soapcw_14three_detector_2run(__pyx_self, __pyx_v_self, __pyx_v_tr1, __pyx_v_obs11, __pyx_v_obs21, __pyx_v_obs31);
 
@@ -16971,96 +17309,96 @@
   float __pyx_t_50;
   long __pyx_t_51;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("run", 0);
 
-  /* "soapcw/soapcw.pyx":792
+  /* "soapcw/soapcw.pyx":849
  * 
  * 
  *         cdef double[:, :, :, :] tr = tr1             # <<<<<<<<<<<<<<
  *         cdef double[:, :] obs1 = obs11
  *         cdef double[:, :] obs2 = obs21
  */
-  __pyx_t_1 = __Pyx_PyObject_to_MemoryviewSlice_dsdsdsds_double(__pyx_v_tr1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_1.memview)) __PYX_ERR(0, 792, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_to_MemoryviewSlice_dsdsdsds_double(__pyx_v_tr1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_1.memview)) __PYX_ERR(0, 849, __pyx_L1_error)
   __pyx_v_tr = __pyx_t_1;
   __pyx_t_1.memview = NULL;
   __pyx_t_1.data = NULL;
 
-  /* "soapcw/soapcw.pyx":793
+  /* "soapcw/soapcw.pyx":850
  * 
  *         cdef double[:, :, :, :] tr = tr1
  *         cdef double[:, :] obs1 = obs11             # <<<<<<<<<<<<<<
  *         cdef double[:, :] obs2 = obs21
  *         cdef double[:, :] obs3 = obs31
  */
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_dsds_double(__pyx_v_obs11, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 793, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_dsds_double(__pyx_v_obs11, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 850, __pyx_L1_error)
   __pyx_v_obs1 = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "soapcw/soapcw.pyx":794
+  /* "soapcw/soapcw.pyx":851
  *         cdef double[:, :, :, :] tr = tr1
  *         cdef double[:, :] obs1 = obs11
  *         cdef double[:, :] obs2 = obs21             # <<<<<<<<<<<<<<
  *         cdef double[:, :] obs3 = obs31
  * 
  */
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_dsds_double(__pyx_v_obs21, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 794, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_dsds_double(__pyx_v_obs21, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 851, __pyx_L1_error)
   __pyx_v_obs2 = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "soapcw/soapcw.pyx":795
+  /* "soapcw/soapcw.pyx":852
  *         cdef double[:, :] obs1 = obs11
  *         cdef double[:, :] obs2 = obs21
  *         cdef double[:, :] obs3 = obs31             # <<<<<<<<<<<<<<
  * 
  *         shape = np.shape(obs1)
  */
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_dsds_double(__pyx_v_obs31, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 795, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_dsds_double(__pyx_v_obs31, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 852, __pyx_L1_error)
   __pyx_v_obs3 = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "soapcw/soapcw.pyx":797
+  /* "soapcw/soapcw.pyx":854
  *         cdef double[:, :] obs3 = obs31
  * 
  *         shape = np.shape(obs1)             # <<<<<<<<<<<<<<
  * 
  *         cdef int length = min(len(obs1),len(obs2),len(obs3))
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 797, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 854, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_shape); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 797, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_shape); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 854, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_memoryview_fromslice(__pyx_v_obs1, 2, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 797, __pyx_L1_error)
+  __pyx_t_4 = __pyx_memoryview_fromslice(__pyx_v_obs1, 2, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 854, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __pyx_t_6 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
     __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_5);
     if (likely(__pyx_t_6)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
       __Pyx_INCREF(__pyx_t_6);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_5, function);
     }
   }
   __pyx_t_3 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_6, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_4);
   __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 797, __pyx_L1_error)
+  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 854, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __pyx_v_shape = __pyx_t_3;
   __pyx_t_3 = 0;
 
-  /* "soapcw/soapcw.pyx":799
+  /* "soapcw/soapcw.pyx":856
  *         shape = np.shape(obs1)
  * 
  *         cdef int length = min(len(obs1),len(obs2),len(obs3))             # <<<<<<<<<<<<<<
  *         cdef int width = len(obs1[0])
  * 
  */
   __pyx_t_7 = __Pyx_MemoryView_Len(__pyx_v_obs2); 
@@ -17075,15 +17413,15 @@
   if (((__pyx_t_8 < __pyx_t_11) != 0)) {
     __pyx_t_10 = __pyx_t_8;
   } else {
     __pyx_t_10 = __pyx_t_11;
   }
   __pyx_v_length = __pyx_t_10;
 
-  /* "soapcw/soapcw.pyx":800
+  /* "soapcw/soapcw.pyx":857
  * 
  *         cdef int length = min(len(obs1),len(obs2),len(obs3))
  *         cdef int width = len(obs1[0])             # <<<<<<<<<<<<<<
  * 
  *         cdef double[:, :] val = np.ones(shape)*-1e6
  */
   __pyx_t_12.data = __pyx_v_obs1.data;
@@ -17094,257 +17432,257 @@
         Py_ssize_t __pyx_tmp_shape = __pyx_v_obs1.shape[0];
     Py_ssize_t __pyx_tmp_stride = __pyx_v_obs1.strides[0];
         if (__pyx_tmp_idx < 0)
             __pyx_tmp_idx += __pyx_tmp_shape;
         if (unlikely(!__Pyx_is_valid_index(__pyx_tmp_idx, __pyx_tmp_shape))) {
             PyErr_SetString(PyExc_IndexError,
                             "Index out of bounds (axis 0)");
-            __PYX_ERR(0, 800, __pyx_L1_error)
+            __PYX_ERR(0, 857, __pyx_L1_error)
         }
         __pyx_t_12.data += __pyx_tmp_idx * __pyx_tmp_stride;
 }
 
 __pyx_t_12.shape[0] = __pyx_v_obs1.shape[1];
 __pyx_t_12.strides[0] = __pyx_v_obs1.strides[1];
     __pyx_t_12.suboffsets[0] = -1;
 
 __pyx_t_7 = __Pyx_MemoryView_Len(__pyx_t_12); 
   __PYX_XDEC_MEMVIEW(&__pyx_t_12, 1);
   __pyx_t_12.memview = NULL;
   __pyx_t_12.data = NULL;
   __pyx_v_width = __pyx_t_7;
 
-  /* "soapcw/soapcw.pyx":802
+  /* "soapcw/soapcw.pyx":859
  *         cdef int width = len(obs1[0])
  * 
  *         cdef double[:, :] val = np.ones(shape)*-1e6             # <<<<<<<<<<<<<<
  *         cdef int[:, :] prev = np.zeros(shape,dtype = np.int32)
  *         cdef int[:, :] det1 = np.zeros(shape,dtype = np.int32)
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 802, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 859, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_ones); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 802, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_ones); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 859, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __pyx_t_5 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
     __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
     if (likely(__pyx_t_5)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
       __Pyx_INCREF(__pyx_t_5);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_4, function);
     }
   }
   __pyx_t_3 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_5, __pyx_v_shape) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_v_shape);
   __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 802, __pyx_L1_error)
+  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 859, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = PyNumber_Multiply(__pyx_t_3, __pyx_float_neg_1e6); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 802, __pyx_L1_error)
+  __pyx_t_4 = PyNumber_Multiply(__pyx_t_3, __pyx_float_neg_1e6); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 859, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_dsds_double(__pyx_t_4, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 802, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_dsds_double(__pyx_t_4, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 859, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_v_val = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "soapcw/soapcw.pyx":803
+  /* "soapcw/soapcw.pyx":860
  * 
  *         cdef double[:, :] val = np.ones(shape)*-1e6
  *         cdef int[:, :] prev = np.zeros(shape,dtype = np.int32)             # <<<<<<<<<<<<<<
  *         cdef int[:, :] det1 = np.zeros(shape,dtype = np.int32)
  *         cdef int[:, :] det2 = np.zeros(shape,dtype = np.int32)
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 803, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 860, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_zeros); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 803, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_zeros); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 860, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 803, __pyx_L1_error)
+  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 860, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_INCREF(__pyx_v_shape);
   __Pyx_GIVEREF(__pyx_v_shape);
   PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_v_shape);
-  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 803, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 860, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 803, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 860, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_int32); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 803, __pyx_L1_error)
+  __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_int32); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 860, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_13) < 0) __PYX_ERR(0, 803, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_13) < 0) __PYX_ERR(0, 860, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-  __pyx_t_13 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_4, __pyx_t_5); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 803, __pyx_L1_error)
+  __pyx_t_13 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_4, __pyx_t_5); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 860, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_14 = __Pyx_PyObject_to_MemoryviewSlice_dsds_int(__pyx_t_13, PyBUF_WRITABLE); if (unlikely(!__pyx_t_14.memview)) __PYX_ERR(0, 803, __pyx_L1_error)
+  __pyx_t_14 = __Pyx_PyObject_to_MemoryviewSlice_dsds_int(__pyx_t_13, PyBUF_WRITABLE); if (unlikely(!__pyx_t_14.memview)) __PYX_ERR(0, 860, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
   __pyx_v_prev = __pyx_t_14;
   __pyx_t_14.memview = NULL;
   __pyx_t_14.data = NULL;
 
-  /* "soapcw/soapcw.pyx":804
+  /* "soapcw/soapcw.pyx":861
  *         cdef double[:, :] val = np.ones(shape)*-1e6
  *         cdef int[:, :] prev = np.zeros(shape,dtype = np.int32)
  *         cdef int[:, :] det1 = np.zeros(shape,dtype = np.int32)             # <<<<<<<<<<<<<<
  *         cdef int[:, :] det2 = np.zeros(shape,dtype = np.int32)
  *         cdef int[:, :] det3 = np.zeros(shape,dtype = np.int32)
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_13, __pyx_n_s_np); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 804, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_13, __pyx_n_s_np); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 861, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_13, __pyx_n_s_zeros); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 804, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_13, __pyx_n_s_zeros); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 861, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-  __pyx_t_13 = PyTuple_New(1); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 804, __pyx_L1_error)
+  __pyx_t_13 = PyTuple_New(1); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 861, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
   __Pyx_INCREF(__pyx_v_shape);
   __Pyx_GIVEREF(__pyx_v_shape);
   PyTuple_SET_ITEM(__pyx_t_13, 0, __pyx_v_shape);
-  __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 804, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 861, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 804, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 861, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_int32); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 804, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_int32); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 861, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 804, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 861, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_13, __pyx_t_4); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 804, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_13, __pyx_t_4); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 861, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_14 = __Pyx_PyObject_to_MemoryviewSlice_dsds_int(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_14.memview)) __PYX_ERR(0, 804, __pyx_L1_error)
+  __pyx_t_14 = __Pyx_PyObject_to_MemoryviewSlice_dsds_int(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_14.memview)) __PYX_ERR(0, 861, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_v_det1 = __pyx_t_14;
   __pyx_t_14.memview = NULL;
   __pyx_t_14.data = NULL;
 
-  /* "soapcw/soapcw.pyx":805
+  /* "soapcw/soapcw.pyx":862
  *         cdef int[:, :] prev = np.zeros(shape,dtype = np.int32)
  *         cdef int[:, :] det1 = np.zeros(shape,dtype = np.int32)
  *         cdef int[:, :] det2 = np.zeros(shape,dtype = np.int32)             # <<<<<<<<<<<<<<
  *         cdef int[:, :] det3 = np.zeros(shape,dtype = np.int32)
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 805, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 862, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_zeros); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 805, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_zeros); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 862, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 805, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 862, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_INCREF(__pyx_v_shape);
   __Pyx_GIVEREF(__pyx_v_shape);
   PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_v_shape);
-  __pyx_t_13 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 805, __pyx_L1_error)
+  __pyx_t_13 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 862, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 805, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 862, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_int32); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 805, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_int32); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 862, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (PyDict_SetItem(__pyx_t_13, __pyx_n_s_dtype, __pyx_t_3) < 0) __PYX_ERR(0, 805, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_13, __pyx_n_s_dtype, __pyx_t_3) < 0) __PYX_ERR(0, 862, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_6, __pyx_t_13); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 805, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_6, __pyx_t_13); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 862, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-  __pyx_t_14 = __Pyx_PyObject_to_MemoryviewSlice_dsds_int(__pyx_t_3, PyBUF_WRITABLE); if (unlikely(!__pyx_t_14.memview)) __PYX_ERR(0, 805, __pyx_L1_error)
+  __pyx_t_14 = __Pyx_PyObject_to_MemoryviewSlice_dsds_int(__pyx_t_3, PyBUF_WRITABLE); if (unlikely(!__pyx_t_14.memview)) __PYX_ERR(0, 862, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_v_det2 = __pyx_t_14;
   __pyx_t_14.memview = NULL;
   __pyx_t_14.data = NULL;
 
-  /* "soapcw/soapcw.pyx":806
+  /* "soapcw/soapcw.pyx":863
  *         cdef int[:, :] det1 = np.zeros(shape,dtype = np.int32)
  *         cdef int[:, :] det2 = np.zeros(shape,dtype = np.int32)
  *         cdef int[:, :] det3 = np.zeros(shape,dtype = np.int32)             # <<<<<<<<<<<<<<
  * 
  *         cdef int tr_len = len(tr)
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 806, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 863, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_zeros); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 806, __pyx_L1_error)
+  __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_zeros); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 863, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 806, __pyx_L1_error)
+  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 863, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_INCREF(__pyx_v_shape);
   __Pyx_GIVEREF(__pyx_v_shape);
   PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_shape);
-  __pyx_t_6 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 806, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 863, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 806, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 863, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_int32); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 806, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_int32); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 863, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (PyDict_SetItem(__pyx_t_6, __pyx_n_s_dtype, __pyx_t_5) < 0) __PYX_ERR(0, 806, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_6, __pyx_n_s_dtype, __pyx_t_5) < 0) __PYX_ERR(0, 863, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_13, __pyx_t_3, __pyx_t_6); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 806, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_13, __pyx_t_3, __pyx_t_6); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 863, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_14 = __Pyx_PyObject_to_MemoryviewSlice_dsds_int(__pyx_t_5, PyBUF_WRITABLE); if (unlikely(!__pyx_t_14.memview)) __PYX_ERR(0, 806, __pyx_L1_error)
+  __pyx_t_14 = __Pyx_PyObject_to_MemoryviewSlice_dsds_int(__pyx_t_5, PyBUF_WRITABLE); if (unlikely(!__pyx_t_14.memview)) __PYX_ERR(0, 863, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __pyx_v_det3 = __pyx_t_14;
   __pyx_t_14.memview = NULL;
   __pyx_t_14.data = NULL;
 
-  /* "soapcw/soapcw.pyx":808
+  /* "soapcw/soapcw.pyx":865
  *         cdef int[:, :] det3 = np.zeros(shape,dtype = np.int32)
  * 
  *         cdef int tr_len = len(tr)             # <<<<<<<<<<<<<<
  * 
  *         cdef int i
  */
   __pyx_t_7 = __Pyx_MemoryView_Len(__pyx_v_tr); 
   __pyx_v_tr_len = __pyx_t_7;
 
-  /* "soapcw/soapcw.pyx":824
+  /* "soapcw/soapcw.pyx":881
  *         #cdef double[:] max_vals
  * 
  *         for i in range(width):             # <<<<<<<<<<<<<<
  * 
  *             temp = -1e6
  */
   __pyx_t_15 = __pyx_v_width;
   __pyx_t_16 = __pyx_t_15;
   for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
     __pyx_v_i = __pyx_t_17;
 
-    /* "soapcw/soapcw.pyx":826
+    /* "soapcw/soapcw.pyx":883
  *         for i in range(width):
  * 
  *             temp = -1e6             # <<<<<<<<<<<<<<
  *             for k in range(tr_len):
  *                 if i+k-1>=0 and i+k-1<width:
  */
     __pyx_v_temp = -1e6;
 
-    /* "soapcw/soapcw.pyx":827
+    /* "soapcw/soapcw.pyx":884
  * 
  *             temp = -1e6
  *             for k in range(tr_len):             # <<<<<<<<<<<<<<
  *                 if i+k-1>=0 and i+k-1<width:
  *                     for m in range(tr_len):
  */
     __pyx_t_18 = __pyx_v_tr_len;
     __pyx_t_19 = __pyx_t_18;
     for (__pyx_t_20 = 0; __pyx_t_20 < __pyx_t_19; __pyx_t_20+=1) {
       __pyx_v_k = __pyx_t_20;
 
-      /* "soapcw/soapcw.pyx":828
+      /* "soapcw/soapcw.pyx":885
  *             temp = -1e6
  *             for k in range(tr_len):
  *                 if i+k-1>=0 and i+k-1<width:             # <<<<<<<<<<<<<<
  *                     for m in range(tr_len):
  *                         if i+m-1>=0 and i+m-1<width:
  */
       __pyx_t_22 = ((((__pyx_v_i + __pyx_v_k) - 1) >= 0) != 0);
@@ -17354,27 +17692,27 @@
         goto __pyx_L8_bool_binop_done;
       }
       __pyx_t_22 = ((((__pyx_v_i + __pyx_v_k) - 1) < __pyx_v_width) != 0);
       __pyx_t_21 = __pyx_t_22;
       __pyx_L8_bool_binop_done:;
       if (__pyx_t_21) {
 
-        /* "soapcw/soapcw.pyx":829
+        /* "soapcw/soapcw.pyx":886
  *             for k in range(tr_len):
  *                 if i+k-1>=0 and i+k-1<width:
  *                     for m in range(tr_len):             # <<<<<<<<<<<<<<
  *                         if i+m-1>=0 and i+m-1<width:
  *                             for l in range(tr_len):
  */
         __pyx_t_23 = __pyx_v_tr_len;
         __pyx_t_24 = __pyx_t_23;
         for (__pyx_t_25 = 0; __pyx_t_25 < __pyx_t_24; __pyx_t_25+=1) {
           __pyx_v_m = __pyx_t_25;
 
-          /* "soapcw/soapcw.pyx":830
+          /* "soapcw/soapcw.pyx":887
  *                 if i+k-1>=0 and i+k-1<width:
  *                     for m in range(tr_len):
  *                         if i+m-1>=0 and i+m-1<width:             # <<<<<<<<<<<<<<
  *                             for l in range(tr_len):
  *                                 if i+l-1>=0 and i+l-1<width:
  */
           __pyx_t_22 = ((((__pyx_v_i + __pyx_v_m) - 1) >= 0) != 0);
@@ -17384,113 +17722,113 @@
             goto __pyx_L13_bool_binop_done;
           }
           __pyx_t_22 = ((((__pyx_v_i + __pyx_v_m) - 1) < __pyx_v_width) != 0);
           __pyx_t_21 = __pyx_t_22;
           __pyx_L13_bool_binop_done:;
           if (__pyx_t_21) {
 
-            /* "soapcw/soapcw.pyx":831
+            /* "soapcw/soapcw.pyx":888
  *                     for m in range(tr_len):
  *                         if i+m-1>=0 and i+m-1<width:
  *                             for l in range(tr_len):             # <<<<<<<<<<<<<<
  *                                 if i+l-1>=0 and i+l-1<width:
  *                                     value = obs1[0][i+k-1] + obs2[0][i+m-1] + obs3[0][i+l-1] + tr[1][k][m][l]
  */
-            __pyx_t_5 = __Pyx_PyInt_From_int(__pyx_v_tr_len); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 831, __pyx_L1_error)
+            __pyx_t_5 = __Pyx_PyInt_From_int(__pyx_v_tr_len); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 888, __pyx_L1_error)
             __Pyx_GOTREF(__pyx_t_5);
-            __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_builtin_range, __pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 831, __pyx_L1_error)
+            __pyx_t_6 = __Pyx_PyObject_CallOneArg(__pyx_builtin_range, __pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 888, __pyx_L1_error)
             __Pyx_GOTREF(__pyx_t_6);
             __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
             if (likely(PyList_CheckExact(__pyx_t_6)) || PyTuple_CheckExact(__pyx_t_6)) {
               __pyx_t_5 = __pyx_t_6; __Pyx_INCREF(__pyx_t_5); __pyx_t_10 = 0;
               __pyx_t_26 = NULL;
             } else {
-              __pyx_t_10 = -1; __pyx_t_5 = PyObject_GetIter(__pyx_t_6); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 831, __pyx_L1_error)
+              __pyx_t_10 = -1; __pyx_t_5 = PyObject_GetIter(__pyx_t_6); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 888, __pyx_L1_error)
               __Pyx_GOTREF(__pyx_t_5);
-              __pyx_t_26 = Py_TYPE(__pyx_t_5)->tp_iternext; if (unlikely(!__pyx_t_26)) __PYX_ERR(0, 831, __pyx_L1_error)
+              __pyx_t_26 = Py_TYPE(__pyx_t_5)->tp_iternext; if (unlikely(!__pyx_t_26)) __PYX_ERR(0, 888, __pyx_L1_error)
             }
             __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
             for (;;) {
               if (likely(!__pyx_t_26)) {
                 if (likely(PyList_CheckExact(__pyx_t_5))) {
                   if (__pyx_t_10 >= PyList_GET_SIZE(__pyx_t_5)) break;
                   #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-                  __pyx_t_6 = PyList_GET_ITEM(__pyx_t_5, __pyx_t_10); __Pyx_INCREF(__pyx_t_6); __pyx_t_10++; if (unlikely(0 < 0)) __PYX_ERR(0, 831, __pyx_L1_error)
+                  __pyx_t_6 = PyList_GET_ITEM(__pyx_t_5, __pyx_t_10); __Pyx_INCREF(__pyx_t_6); __pyx_t_10++; if (unlikely(0 < 0)) __PYX_ERR(0, 888, __pyx_L1_error)
                   #else
-                  __pyx_t_6 = PySequence_ITEM(__pyx_t_5, __pyx_t_10); __pyx_t_10++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 831, __pyx_L1_error)
+                  __pyx_t_6 = PySequence_ITEM(__pyx_t_5, __pyx_t_10); __pyx_t_10++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 888, __pyx_L1_error)
                   __Pyx_GOTREF(__pyx_t_6);
                   #endif
                 } else {
                   if (__pyx_t_10 >= PyTuple_GET_SIZE(__pyx_t_5)) break;
                   #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-                  __pyx_t_6 = PyTuple_GET_ITEM(__pyx_t_5, __pyx_t_10); __Pyx_INCREF(__pyx_t_6); __pyx_t_10++; if (unlikely(0 < 0)) __PYX_ERR(0, 831, __pyx_L1_error)
+                  __pyx_t_6 = PyTuple_GET_ITEM(__pyx_t_5, __pyx_t_10); __Pyx_INCREF(__pyx_t_6); __pyx_t_10++; if (unlikely(0 < 0)) __PYX_ERR(0, 888, __pyx_L1_error)
                   #else
-                  __pyx_t_6 = PySequence_ITEM(__pyx_t_5, __pyx_t_10); __pyx_t_10++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 831, __pyx_L1_error)
+                  __pyx_t_6 = PySequence_ITEM(__pyx_t_5, __pyx_t_10); __pyx_t_10++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 888, __pyx_L1_error)
                   __Pyx_GOTREF(__pyx_t_6);
                   #endif
                 }
               } else {
                 __pyx_t_6 = __pyx_t_26(__pyx_t_5);
                 if (unlikely(!__pyx_t_6)) {
                   PyObject* exc_type = PyErr_Occurred();
                   if (exc_type) {
                     if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-                    else __PYX_ERR(0, 831, __pyx_L1_error)
+                    else __PYX_ERR(0, 888, __pyx_L1_error)
                   }
                   break;
                 }
                 __Pyx_GOTREF(__pyx_t_6);
               }
               __Pyx_XDECREF_SET(__pyx_v_l, __pyx_t_6);
               __pyx_t_6 = 0;
 
-              /* "soapcw/soapcw.pyx":832
+              /* "soapcw/soapcw.pyx":889
  *                         if i+m-1>=0 and i+m-1<width:
  *                             for l in range(tr_len):
  *                                 if i+l-1>=0 and i+l-1<width:             # <<<<<<<<<<<<<<
  *                                     value = obs1[0][i+k-1] + obs2[0][i+m-1] + obs3[0][i+l-1] + tr[1][k][m][l]
  *                                 if value > temp:
  */
-              __pyx_t_6 = __Pyx_PyInt_From_int(__pyx_v_i); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 832, __pyx_L1_error)
+              __pyx_t_6 = __Pyx_PyInt_From_int(__pyx_v_i); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 889, __pyx_L1_error)
               __Pyx_GOTREF(__pyx_t_6);
-              __pyx_t_3 = PyNumber_Add(__pyx_t_6, __pyx_v_l); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 832, __pyx_L1_error)
+              __pyx_t_3 = PyNumber_Add(__pyx_t_6, __pyx_v_l); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 889, __pyx_L1_error)
               __Pyx_GOTREF(__pyx_t_3);
               __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-              __pyx_t_6 = __Pyx_PyInt_SubtractObjC(__pyx_t_3, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 832, __pyx_L1_error)
+              __pyx_t_6 = __Pyx_PyInt_SubtractObjC(__pyx_t_3, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 889, __pyx_L1_error)
               __Pyx_GOTREF(__pyx_t_6);
               __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-              __pyx_t_3 = PyObject_RichCompare(__pyx_t_6, __pyx_int_0, Py_GE); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 832, __pyx_L1_error)
+              __pyx_t_3 = PyObject_RichCompare(__pyx_t_6, __pyx_int_0, Py_GE); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 889, __pyx_L1_error)
               __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-              __pyx_t_22 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_22 < 0)) __PYX_ERR(0, 832, __pyx_L1_error)
+              __pyx_t_22 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_22 < 0)) __PYX_ERR(0, 889, __pyx_L1_error)
               __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
               if (__pyx_t_22) {
               } else {
                 __pyx_t_21 = __pyx_t_22;
                 goto __pyx_L18_bool_binop_done;
               }
-              __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_i); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 832, __pyx_L1_error)
+              __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_i); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 889, __pyx_L1_error)
               __Pyx_GOTREF(__pyx_t_3);
-              __pyx_t_6 = PyNumber_Add(__pyx_t_3, __pyx_v_l); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 832, __pyx_L1_error)
+              __pyx_t_6 = PyNumber_Add(__pyx_t_3, __pyx_v_l); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 889, __pyx_L1_error)
               __Pyx_GOTREF(__pyx_t_6);
               __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-              __pyx_t_3 = __Pyx_PyInt_SubtractObjC(__pyx_t_6, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 832, __pyx_L1_error)
+              __pyx_t_3 = __Pyx_PyInt_SubtractObjC(__pyx_t_6, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 889, __pyx_L1_error)
               __Pyx_GOTREF(__pyx_t_3);
               __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-              __pyx_t_6 = __Pyx_PyInt_From_int(__pyx_v_width); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 832, __pyx_L1_error)
+              __pyx_t_6 = __Pyx_PyInt_From_int(__pyx_v_width); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 889, __pyx_L1_error)
               __Pyx_GOTREF(__pyx_t_6);
-              __pyx_t_13 = PyObject_RichCompare(__pyx_t_3, __pyx_t_6, Py_LT); __Pyx_XGOTREF(__pyx_t_13); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 832, __pyx_L1_error)
+              __pyx_t_13 = PyObject_RichCompare(__pyx_t_3, __pyx_t_6, Py_LT); __Pyx_XGOTREF(__pyx_t_13); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 889, __pyx_L1_error)
               __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
               __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-              __pyx_t_22 = __Pyx_PyObject_IsTrue(__pyx_t_13); if (unlikely(__pyx_t_22 < 0)) __PYX_ERR(0, 832, __pyx_L1_error)
+              __pyx_t_22 = __Pyx_PyObject_IsTrue(__pyx_t_13); if (unlikely(__pyx_t_22 < 0)) __PYX_ERR(0, 889, __pyx_L1_error)
               __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
               __pyx_t_21 = __pyx_t_22;
               __pyx_L18_bool_binop_done:;
               if (__pyx_t_21) {
 
-                /* "soapcw/soapcw.pyx":833
+                /* "soapcw/soapcw.pyx":890
  *                             for l in range(tr_len):
  *                                 if i+l-1>=0 and i+l-1<width:
  *                                     value = obs1[0][i+k-1] + obs2[0][i+m-1] + obs3[0][i+l-1] + tr[1][k][m][l]             # <<<<<<<<<<<<<<
  *                                 if value > temp:
  *                                     temp = value
  */
                 __pyx_t_27 = 0;
@@ -17502,57 +17840,57 @@
                 } else if (unlikely(__pyx_t_27 >= __pyx_v_obs1.shape[0])) __pyx_t_29 = 0;
                 if (__pyx_t_28 < 0) {
                   __pyx_t_28 += __pyx_v_obs1.shape[1];
                   if (unlikely(__pyx_t_28 < 0)) __pyx_t_29 = 1;
                 } else if (unlikely(__pyx_t_28 >= __pyx_v_obs1.shape[1])) __pyx_t_29 = 1;
                 if (unlikely(__pyx_t_29 != -1)) {
                   __Pyx_RaiseBufferIndexError(__pyx_t_29);
-                  __PYX_ERR(0, 833, __pyx_L1_error)
+                  __PYX_ERR(0, 890, __pyx_L1_error)
                 }
                 __pyx_t_30 = 0;
                 __pyx_t_31 = ((__pyx_v_i + __pyx_v_m) - 1);
                 __pyx_t_29 = -1;
                 if (__pyx_t_30 < 0) {
                   __pyx_t_30 += __pyx_v_obs2.shape[0];
                   if (unlikely(__pyx_t_30 < 0)) __pyx_t_29 = 0;
                 } else if (unlikely(__pyx_t_30 >= __pyx_v_obs2.shape[0])) __pyx_t_29 = 0;
                 if (__pyx_t_31 < 0) {
                   __pyx_t_31 += __pyx_v_obs2.shape[1];
                   if (unlikely(__pyx_t_31 < 0)) __pyx_t_29 = 1;
                 } else if (unlikely(__pyx_t_31 >= __pyx_v_obs2.shape[1])) __pyx_t_29 = 1;
                 if (unlikely(__pyx_t_29 != -1)) {
                   __Pyx_RaiseBufferIndexError(__pyx_t_29);
-                  __PYX_ERR(0, 833, __pyx_L1_error)
+                  __PYX_ERR(0, 890, __pyx_L1_error)
                 }
-                __pyx_t_13 = __Pyx_PyInt_From_int(__pyx_v_i); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 833, __pyx_L1_error)
+                __pyx_t_13 = __Pyx_PyInt_From_int(__pyx_v_i); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 890, __pyx_L1_error)
                 __Pyx_GOTREF(__pyx_t_13);
-                __pyx_t_6 = PyNumber_Add(__pyx_t_13, __pyx_v_l); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 833, __pyx_L1_error)
+                __pyx_t_6 = PyNumber_Add(__pyx_t_13, __pyx_v_l); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 890, __pyx_L1_error)
                 __Pyx_GOTREF(__pyx_t_6);
                 __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-                __pyx_t_13 = __Pyx_PyInt_SubtractObjC(__pyx_t_6, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 833, __pyx_L1_error)
+                __pyx_t_13 = __Pyx_PyInt_SubtractObjC(__pyx_t_6, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 890, __pyx_L1_error)
                 __Pyx_GOTREF(__pyx_t_13);
                 __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-                __pyx_t_11 = __Pyx_PyIndex_AsSsize_t(__pyx_t_13); if (unlikely((__pyx_t_11 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 833, __pyx_L1_error)
+                __pyx_t_11 = __Pyx_PyIndex_AsSsize_t(__pyx_t_13); if (unlikely((__pyx_t_11 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 890, __pyx_L1_error)
                 __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
                 __pyx_t_32 = 0;
                 __pyx_t_33 = __pyx_t_11;
                 __pyx_t_29 = -1;
                 if (__pyx_t_32 < 0) {
                   __pyx_t_32 += __pyx_v_obs3.shape[0];
                   if (unlikely(__pyx_t_32 < 0)) __pyx_t_29 = 0;
                 } else if (unlikely(__pyx_t_32 >= __pyx_v_obs3.shape[0])) __pyx_t_29 = 0;
                 if (__pyx_t_33 < 0) {
                   __pyx_t_33 += __pyx_v_obs3.shape[1];
                   if (unlikely(__pyx_t_33 < 0)) __pyx_t_29 = 1;
                 } else if (unlikely(__pyx_t_33 >= __pyx_v_obs3.shape[1])) __pyx_t_29 = 1;
                 if (unlikely(__pyx_t_29 != -1)) {
                   __Pyx_RaiseBufferIndexError(__pyx_t_29);
-                  __PYX_ERR(0, 833, __pyx_L1_error)
+                  __PYX_ERR(0, 890, __pyx_L1_error)
                 }
-                __pyx_t_34 = __Pyx_PyIndex_AsSsize_t(__pyx_v_l); if (unlikely((__pyx_t_34 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 833, __pyx_L1_error)
+                __pyx_t_34 = __Pyx_PyIndex_AsSsize_t(__pyx_v_l); if (unlikely((__pyx_t_34 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 890, __pyx_L1_error)
                 __pyx_t_35 = 1;
                 __pyx_t_36 = __pyx_v_k;
                 __pyx_t_37 = __pyx_v_m;
                 __pyx_t_38 = __pyx_t_34;
                 __pyx_t_29 = -1;
                 if (__pyx_t_35 < 0) {
                   __pyx_t_35 += __pyx_v_tr.shape[0];
@@ -17568,47 +17906,47 @@
                 } else if (unlikely(__pyx_t_37 >= __pyx_v_tr.shape[2])) __pyx_t_29 = 2;
                 if (__pyx_t_38 < 0) {
                   __pyx_t_38 += __pyx_v_tr.shape[3];
                   if (unlikely(__pyx_t_38 < 0)) __pyx_t_29 = 3;
                 } else if (unlikely(__pyx_t_38 >= __pyx_v_tr.shape[3])) __pyx_t_29 = 3;
                 if (unlikely(__pyx_t_29 != -1)) {
                   __Pyx_RaiseBufferIndexError(__pyx_t_29);
-                  __PYX_ERR(0, 833, __pyx_L1_error)
+                  __PYX_ERR(0, 890, __pyx_L1_error)
                 }
                 __pyx_v_value = ((((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_obs1.data + __pyx_t_27 * __pyx_v_obs1.strides[0]) ) + __pyx_t_28 * __pyx_v_obs1.strides[1]) ))) + (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_obs2.data + __pyx_t_30 * __pyx_v_obs2.strides[0]) ) + __pyx_t_31 * __pyx_v_obs2.strides[1]) )))) + (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_obs3.data + __pyx_t_32 * __pyx_v_obs3.strides[0]) ) + __pyx_t_33 * __pyx_v_obs3.strides[1]) )))) + (*((double *) ( /* dim=3 */ (( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_tr.data + __pyx_t_35 * __pyx_v_tr.strides[0]) ) + __pyx_t_36 * __pyx_v_tr.strides[1]) ) + __pyx_t_37 * __pyx_v_tr.strides[2]) ) + __pyx_t_38 * __pyx_v_tr.strides[3]) ))));
 
-                /* "soapcw/soapcw.pyx":832
+                /* "soapcw/soapcw.pyx":889
  *                         if i+m-1>=0 and i+m-1<width:
  *                             for l in range(tr_len):
  *                                 if i+l-1>=0 and i+l-1<width:             # <<<<<<<<<<<<<<
  *                                     value = obs1[0][i+k-1] + obs2[0][i+m-1] + obs3[0][i+l-1] + tr[1][k][m][l]
  *                                 if value > temp:
  */
               }
 
-              /* "soapcw/soapcw.pyx":834
+              /* "soapcw/soapcw.pyx":891
  *                                 if i+l-1>=0 and i+l-1<width:
  *                                     value = obs1[0][i+k-1] + obs2[0][i+m-1] + obs3[0][i+l-1] + tr[1][k][m][l]
  *                                 if value > temp:             # <<<<<<<<<<<<<<
  *                                     temp = value
  *                                     val[0][i] = temp
  */
               __pyx_t_21 = ((__pyx_v_value > __pyx_v_temp) != 0);
               if (__pyx_t_21) {
 
-                /* "soapcw/soapcw.pyx":835
+                /* "soapcw/soapcw.pyx":892
  *                                     value = obs1[0][i+k-1] + obs2[0][i+m-1] + obs3[0][i+l-1] + tr[1][k][m][l]
  *                                 if value > temp:
  *                                     temp = value             # <<<<<<<<<<<<<<
  *                                     val[0][i] = temp
  *                                     prev[0][i] =  i
  */
                 __pyx_v_temp = __pyx_v_value;
 
-                /* "soapcw/soapcw.pyx":836
+                /* "soapcw/soapcw.pyx":893
  *                                 if value > temp:
  *                                     temp = value
  *                                     val[0][i] = temp             # <<<<<<<<<<<<<<
  *                                     prev[0][i] =  i
  *                                     det1[0][i] =  i+k-1
  */
                 __pyx_t_38 = 0;
@@ -17620,19 +17958,19 @@
                 } else if (unlikely(__pyx_t_38 >= __pyx_v_val.shape[0])) __pyx_t_29 = 0;
                 if (__pyx_t_37 < 0) {
                   __pyx_t_37 += __pyx_v_val.shape[1];
                   if (unlikely(__pyx_t_37 < 0)) __pyx_t_29 = 1;
                 } else if (unlikely(__pyx_t_37 >= __pyx_v_val.shape[1])) __pyx_t_29 = 1;
                 if (unlikely(__pyx_t_29 != -1)) {
                   __Pyx_RaiseBufferIndexError(__pyx_t_29);
-                  __PYX_ERR(0, 836, __pyx_L1_error)
+                  __PYX_ERR(0, 893, __pyx_L1_error)
                 }
                 *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_val.data + __pyx_t_38 * __pyx_v_val.strides[0]) ) + __pyx_t_37 * __pyx_v_val.strides[1]) )) = __pyx_v_temp;
 
-                /* "soapcw/soapcw.pyx":837
+                /* "soapcw/soapcw.pyx":894
  *                                     temp = value
  *                                     val[0][i] = temp
  *                                     prev[0][i] =  i             # <<<<<<<<<<<<<<
  *                                     det1[0][i] =  i+k-1
  *                                     det2[0][i] =  i+m-1
  */
                 __pyx_t_37 = 0;
@@ -17644,19 +17982,19 @@
                 } else if (unlikely(__pyx_t_37 >= __pyx_v_prev.shape[0])) __pyx_t_29 = 0;
                 if (__pyx_t_38 < 0) {
                   __pyx_t_38 += __pyx_v_prev.shape[1];
                   if (unlikely(__pyx_t_38 < 0)) __pyx_t_29 = 1;
                 } else if (unlikely(__pyx_t_38 >= __pyx_v_prev.shape[1])) __pyx_t_29 = 1;
                 if (unlikely(__pyx_t_29 != -1)) {
                   __Pyx_RaiseBufferIndexError(__pyx_t_29);
-                  __PYX_ERR(0, 837, __pyx_L1_error)
+                  __PYX_ERR(0, 894, __pyx_L1_error)
                 }
                 *((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_prev.data + __pyx_t_37 * __pyx_v_prev.strides[0]) ) + __pyx_t_38 * __pyx_v_prev.strides[1]) )) = __pyx_v_i;
 
-                /* "soapcw/soapcw.pyx":838
+                /* "soapcw/soapcw.pyx":895
  *                                     val[0][i] = temp
  *                                     prev[0][i] =  i
  *                                     det1[0][i] =  i+k-1             # <<<<<<<<<<<<<<
  *                                     det2[0][i] =  i+m-1
  *                                     det3[0][i] =  i+l-1
  */
                 __pyx_t_38 = 0;
@@ -17668,19 +18006,19 @@
                 } else if (unlikely(__pyx_t_38 >= __pyx_v_det1.shape[0])) __pyx_t_29 = 0;
                 if (__pyx_t_37 < 0) {
                   __pyx_t_37 += __pyx_v_det1.shape[1];
                   if (unlikely(__pyx_t_37 < 0)) __pyx_t_29 = 1;
                 } else if (unlikely(__pyx_t_37 >= __pyx_v_det1.shape[1])) __pyx_t_29 = 1;
                 if (unlikely(__pyx_t_29 != -1)) {
                   __Pyx_RaiseBufferIndexError(__pyx_t_29);
-                  __PYX_ERR(0, 838, __pyx_L1_error)
+                  __PYX_ERR(0, 895, __pyx_L1_error)
                 }
                 *((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_det1.data + __pyx_t_38 * __pyx_v_det1.strides[0]) ) + __pyx_t_37 * __pyx_v_det1.strides[1]) )) = ((__pyx_v_i + __pyx_v_k) - 1);
 
-                /* "soapcw/soapcw.pyx":839
+                /* "soapcw/soapcw.pyx":896
  *                                     prev[0][i] =  i
  *                                     det1[0][i] =  i+k-1
  *                                     det2[0][i] =  i+m-1             # <<<<<<<<<<<<<<
  *                                     det3[0][i] =  i+l-1
  *                                 else:
  */
                 __pyx_t_37 = 0;
@@ -17692,175 +18030,175 @@
                 } else if (unlikely(__pyx_t_37 >= __pyx_v_det2.shape[0])) __pyx_t_29 = 0;
                 if (__pyx_t_38 < 0) {
                   __pyx_t_38 += __pyx_v_det2.shape[1];
                   if (unlikely(__pyx_t_38 < 0)) __pyx_t_29 = 1;
                 } else if (unlikely(__pyx_t_38 >= __pyx_v_det2.shape[1])) __pyx_t_29 = 1;
                 if (unlikely(__pyx_t_29 != -1)) {
                   __Pyx_RaiseBufferIndexError(__pyx_t_29);
-                  __PYX_ERR(0, 839, __pyx_L1_error)
+                  __PYX_ERR(0, 896, __pyx_L1_error)
                 }
                 *((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_det2.data + __pyx_t_37 * __pyx_v_det2.strides[0]) ) + __pyx_t_38 * __pyx_v_det2.strides[1]) )) = ((__pyx_v_i + __pyx_v_m) - 1);
 
-                /* "soapcw/soapcw.pyx":840
+                /* "soapcw/soapcw.pyx":897
  *                                     det1[0][i] =  i+k-1
  *                                     det2[0][i] =  i+m-1
  *                                     det3[0][i] =  i+l-1             # <<<<<<<<<<<<<<
  *                                 else:
  *                                     continue
  */
-                __pyx_t_13 = __Pyx_PyInt_From_int(__pyx_v_i); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 840, __pyx_L1_error)
+                __pyx_t_13 = __Pyx_PyInt_From_int(__pyx_v_i); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 897, __pyx_L1_error)
                 __Pyx_GOTREF(__pyx_t_13);
-                __pyx_t_6 = PyNumber_Add(__pyx_t_13, __pyx_v_l); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 840, __pyx_L1_error)
+                __pyx_t_6 = PyNumber_Add(__pyx_t_13, __pyx_v_l); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 897, __pyx_L1_error)
                 __Pyx_GOTREF(__pyx_t_6);
                 __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-                __pyx_t_13 = __Pyx_PyInt_SubtractObjC(__pyx_t_6, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 840, __pyx_L1_error)
+                __pyx_t_13 = __Pyx_PyInt_SubtractObjC(__pyx_t_6, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 897, __pyx_L1_error)
                 __Pyx_GOTREF(__pyx_t_13);
                 __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-                __pyx_t_29 = __Pyx_PyInt_As_int(__pyx_t_13); if (unlikely((__pyx_t_29 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 840, __pyx_L1_error)
+                __pyx_t_29 = __Pyx_PyInt_As_int(__pyx_t_13); if (unlikely((__pyx_t_29 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 897, __pyx_L1_error)
                 __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
                 __pyx_t_38 = 0;
                 __pyx_t_37 = __pyx_v_i;
                 __pyx_t_39 = -1;
                 if (__pyx_t_38 < 0) {
                   __pyx_t_38 += __pyx_v_det3.shape[0];
                   if (unlikely(__pyx_t_38 < 0)) __pyx_t_39 = 0;
                 } else if (unlikely(__pyx_t_38 >= __pyx_v_det3.shape[0])) __pyx_t_39 = 0;
                 if (__pyx_t_37 < 0) {
                   __pyx_t_37 += __pyx_v_det3.shape[1];
                   if (unlikely(__pyx_t_37 < 0)) __pyx_t_39 = 1;
                 } else if (unlikely(__pyx_t_37 >= __pyx_v_det3.shape[1])) __pyx_t_39 = 1;
                 if (unlikely(__pyx_t_39 != -1)) {
                   __Pyx_RaiseBufferIndexError(__pyx_t_39);
-                  __PYX_ERR(0, 840, __pyx_L1_error)
+                  __PYX_ERR(0, 897, __pyx_L1_error)
                 }
                 *((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_det3.data + __pyx_t_38 * __pyx_v_det3.strides[0]) ) + __pyx_t_37 * __pyx_v_det3.strides[1]) )) = __pyx_t_29;
 
-                /* "soapcw/soapcw.pyx":834
+                /* "soapcw/soapcw.pyx":891
  *                                 if i+l-1>=0 and i+l-1<width:
  *                                     value = obs1[0][i+k-1] + obs2[0][i+m-1] + obs3[0][i+l-1] + tr[1][k][m][l]
  *                                 if value > temp:             # <<<<<<<<<<<<<<
  *                                     temp = value
  *                                     val[0][i] = temp
  */
                 goto __pyx_L20;
               }
 
-              /* "soapcw/soapcw.pyx":842
+              /* "soapcw/soapcw.pyx":899
  *                                     det3[0][i] =  i+l-1
  *                                 else:
  *                                     continue             # <<<<<<<<<<<<<<
  * 
  * 
  */
               /*else*/ {
                 goto __pyx_L15_continue;
               }
               __pyx_L20:;
 
-              /* "soapcw/soapcw.pyx":831
+              /* "soapcw/soapcw.pyx":888
  *                     for m in range(tr_len):
  *                         if i+m-1>=0 and i+m-1<width:
  *                             for l in range(tr_len):             # <<<<<<<<<<<<<<
  *                                 if i+l-1>=0 and i+l-1<width:
  *                                     value = obs1[0][i+k-1] + obs2[0][i+m-1] + obs3[0][i+l-1] + tr[1][k][m][l]
  */
               __pyx_L15_continue:;
             }
             __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-            /* "soapcw/soapcw.pyx":830
+            /* "soapcw/soapcw.pyx":887
  *                 if i+k-1>=0 and i+k-1<width:
  *                     for m in range(tr_len):
  *                         if i+m-1>=0 and i+m-1<width:             # <<<<<<<<<<<<<<
  *                             for l in range(tr_len):
  *                                 if i+l-1>=0 and i+l-1<width:
  */
           }
         }
 
-        /* "soapcw/soapcw.pyx":828
+        /* "soapcw/soapcw.pyx":885
  *             temp = -1e6
  *             for k in range(tr_len):
  *                 if i+k-1>=0 and i+k-1<width:             # <<<<<<<<<<<<<<
  *                     for m in range(tr_len):
  *                         if i+m-1>=0 and i+m-1<width:
  */
       }
     }
   }
 
-  /* "soapcw/soapcw.pyx":849
+  /* "soapcw/soapcw.pyx":906
  *         # k is separation from other detector
  * 
  *         pbar = 0             # <<<<<<<<<<<<<<
  *         for t in range(1,length):
  *             pt = t/(float(length))*100.
  */
   __Pyx_INCREF(__pyx_int_0);
   __pyx_v_pbar = __pyx_int_0;
 
-  /* "soapcw/soapcw.pyx":850
+  /* "soapcw/soapcw.pyx":907
  * 
  *         pbar = 0
  *         for t in range(1,length):             # <<<<<<<<<<<<<<
  *             pt = t/(float(length))*100.
  *             for i in range(width):
  */
   __pyx_t_15 = __pyx_v_length;
   __pyx_t_16 = __pyx_t_15;
   for (__pyx_t_17 = 1; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
     __pyx_v_t = __pyx_t_17;
 
-    /* "soapcw/soapcw.pyx":851
+    /* "soapcw/soapcw.pyx":908
  *         pbar = 0
  *         for t in range(1,length):
  *             pt = t/(float(length))*100.             # <<<<<<<<<<<<<<
  *             for i in range(width):
  * 
  */
     if (unlikely(((double)__pyx_v_length) == 0)) {
       PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-      __PYX_ERR(0, 851, __pyx_L1_error)
+      __PYX_ERR(0, 908, __pyx_L1_error)
     }
     __pyx_v_pt = ((((double)__pyx_v_t) / ((double)__pyx_v_length)) * 100.);
 
-    /* "soapcw/soapcw.pyx":852
+    /* "soapcw/soapcw.pyx":909
  *         for t in range(1,length):
  *             pt = t/(float(length))*100.
  *             for i in range(width):             # <<<<<<<<<<<<<<
  * 
  *                 temp = -1e6
  */
     __pyx_t_18 = __pyx_v_width;
     __pyx_t_19 = __pyx_t_18;
     for (__pyx_t_20 = 0; __pyx_t_20 < __pyx_t_19; __pyx_t_20+=1) {
       __pyx_v_i = __pyx_t_20;
 
-      /* "soapcw/soapcw.pyx":854
+      /* "soapcw/soapcw.pyx":911
  *             for i in range(width):
  * 
  *                 temp = -1e6             # <<<<<<<<<<<<<<
  *                 for j in range(tr_len):
  *                     if i+j-1>=0 and i+j-1<width:
  */
       __pyx_v_temp = -1e6;
 
-      /* "soapcw/soapcw.pyx":855
+      /* "soapcw/soapcw.pyx":912
  * 
  *                 temp = -1e6
  *                 for j in range(tr_len):             # <<<<<<<<<<<<<<
  *                     if i+j-1>=0 and i+j-1<width:
  *                        for k in range(tr_len):
  */
       __pyx_t_23 = __pyx_v_tr_len;
       __pyx_t_24 = __pyx_t_23;
       for (__pyx_t_25 = 0; __pyx_t_25 < __pyx_t_24; __pyx_t_25+=1) {
         __pyx_v_j = __pyx_t_25;
 
-        /* "soapcw/soapcw.pyx":856
+        /* "soapcw/soapcw.pyx":913
  *                 temp = -1e6
  *                 for j in range(tr_len):
  *                     if i+j-1>=0 and i+j-1<width:             # <<<<<<<<<<<<<<
  *                        for k in range(tr_len):
  *                             if i+k-1>=0 and i+k-1<width:
  */
         __pyx_t_22 = ((((__pyx_v_i + __pyx_v_j) - 1) >= 0) != 0);
@@ -17870,27 +18208,27 @@
           goto __pyx_L28_bool_binop_done;
         }
         __pyx_t_22 = ((((__pyx_v_i + __pyx_v_j) - 1) < __pyx_v_width) != 0);
         __pyx_t_21 = __pyx_t_22;
         __pyx_L28_bool_binop_done:;
         if (__pyx_t_21) {
 
-          /* "soapcw/soapcw.pyx":857
+          /* "soapcw/soapcw.pyx":914
  *                 for j in range(tr_len):
  *                     if i+j-1>=0 and i+j-1<width:
  *                        for k in range(tr_len):             # <<<<<<<<<<<<<<
  *                             if i+k-1>=0 and i+k-1<width:
  *                                 for m in range(tr_len):
  */
           __pyx_t_29 = __pyx_v_tr_len;
           __pyx_t_39 = __pyx_t_29;
           for (__pyx_t_40 = 0; __pyx_t_40 < __pyx_t_39; __pyx_t_40+=1) {
             __pyx_v_k = __pyx_t_40;
 
-            /* "soapcw/soapcw.pyx":858
+            /* "soapcw/soapcw.pyx":915
  *                     if i+j-1>=0 and i+j-1<width:
  *                        for k in range(tr_len):
  *                             if i+k-1>=0 and i+k-1<width:             # <<<<<<<<<<<<<<
  *                                 for m in range(tr_len):
  *                                      if i+m-1>=0 and i+m-1<width:
  */
             __pyx_t_22 = ((((__pyx_v_i + __pyx_v_k) - 1) >= 0) != 0);
@@ -17900,27 +18238,27 @@
               goto __pyx_L33_bool_binop_done;
             }
             __pyx_t_22 = ((((__pyx_v_i + __pyx_v_k) - 1) < __pyx_v_width) != 0);
             __pyx_t_21 = __pyx_t_22;
             __pyx_L33_bool_binop_done:;
             if (__pyx_t_21) {
 
-              /* "soapcw/soapcw.pyx":859
+              /* "soapcw/soapcw.pyx":916
  *                        for k in range(tr_len):
  *                             if i+k-1>=0 and i+k-1<width:
  *                                 for m in range(tr_len):             # <<<<<<<<<<<<<<
  *                                      if i+m-1>=0 and i+m-1<width:
  *                                          for l in range(tr_len):
  */
               __pyx_t_41 = __pyx_v_tr_len;
               __pyx_t_42 = __pyx_t_41;
               for (__pyx_t_43 = 0; __pyx_t_43 < __pyx_t_42; __pyx_t_43+=1) {
                 __pyx_v_m = __pyx_t_43;
 
-                /* "soapcw/soapcw.pyx":860
+                /* "soapcw/soapcw.pyx":917
  *                             if i+k-1>=0 and i+k-1<width:
  *                                 for m in range(tr_len):
  *                                      if i+m-1>=0 and i+m-1<width:             # <<<<<<<<<<<<<<
  *                                          for l in range(tr_len):
  *                                              if i+l-1>=0 and i+l-1<width:
  */
                 __pyx_t_22 = ((((__pyx_v_i + __pyx_v_m) - 1) >= 0) != 0);
@@ -17930,113 +18268,113 @@
                   goto __pyx_L38_bool_binop_done;
                 }
                 __pyx_t_22 = ((((__pyx_v_i + __pyx_v_m) - 1) < __pyx_v_width) != 0);
                 __pyx_t_21 = __pyx_t_22;
                 __pyx_L38_bool_binop_done:;
                 if (__pyx_t_21) {
 
-                  /* "soapcw/soapcw.pyx":861
+                  /* "soapcw/soapcw.pyx":918
  *                                 for m in range(tr_len):
  *                                      if i+m-1>=0 and i+m-1<width:
  *                                          for l in range(tr_len):             # <<<<<<<<<<<<<<
  *                                              if i+l-1>=0 and i+l-1<width:
  *                                                  value = obs1[t][i+k-1] + obs2[t][i+m-1] + obs3[t][i+l-1] + tr[j][k][m][l] + val[t-1][i+j-1]
  */
-                  __pyx_t_5 = __Pyx_PyInt_From_int(__pyx_v_tr_len); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 861, __pyx_L1_error)
+                  __pyx_t_5 = __Pyx_PyInt_From_int(__pyx_v_tr_len); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 918, __pyx_L1_error)
                   __Pyx_GOTREF(__pyx_t_5);
-                  __pyx_t_13 = __Pyx_PyObject_CallOneArg(__pyx_builtin_range, __pyx_t_5); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 861, __pyx_L1_error)
+                  __pyx_t_13 = __Pyx_PyObject_CallOneArg(__pyx_builtin_range, __pyx_t_5); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 918, __pyx_L1_error)
                   __Pyx_GOTREF(__pyx_t_13);
                   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
                   if (likely(PyList_CheckExact(__pyx_t_13)) || PyTuple_CheckExact(__pyx_t_13)) {
                     __pyx_t_5 = __pyx_t_13; __Pyx_INCREF(__pyx_t_5); __pyx_t_10 = 0;
                     __pyx_t_26 = NULL;
                   } else {
-                    __pyx_t_10 = -1; __pyx_t_5 = PyObject_GetIter(__pyx_t_13); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 861, __pyx_L1_error)
+                    __pyx_t_10 = -1; __pyx_t_5 = PyObject_GetIter(__pyx_t_13); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 918, __pyx_L1_error)
                     __Pyx_GOTREF(__pyx_t_5);
-                    __pyx_t_26 = Py_TYPE(__pyx_t_5)->tp_iternext; if (unlikely(!__pyx_t_26)) __PYX_ERR(0, 861, __pyx_L1_error)
+                    __pyx_t_26 = Py_TYPE(__pyx_t_5)->tp_iternext; if (unlikely(!__pyx_t_26)) __PYX_ERR(0, 918, __pyx_L1_error)
                   }
                   __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
                   for (;;) {
                     if (likely(!__pyx_t_26)) {
                       if (likely(PyList_CheckExact(__pyx_t_5))) {
                         if (__pyx_t_10 >= PyList_GET_SIZE(__pyx_t_5)) break;
                         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-                        __pyx_t_13 = PyList_GET_ITEM(__pyx_t_5, __pyx_t_10); __Pyx_INCREF(__pyx_t_13); __pyx_t_10++; if (unlikely(0 < 0)) __PYX_ERR(0, 861, __pyx_L1_error)
+                        __pyx_t_13 = PyList_GET_ITEM(__pyx_t_5, __pyx_t_10); __Pyx_INCREF(__pyx_t_13); __pyx_t_10++; if (unlikely(0 < 0)) __PYX_ERR(0, 918, __pyx_L1_error)
                         #else
-                        __pyx_t_13 = PySequence_ITEM(__pyx_t_5, __pyx_t_10); __pyx_t_10++; if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 861, __pyx_L1_error)
+                        __pyx_t_13 = PySequence_ITEM(__pyx_t_5, __pyx_t_10); __pyx_t_10++; if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 918, __pyx_L1_error)
                         __Pyx_GOTREF(__pyx_t_13);
                         #endif
                       } else {
                         if (__pyx_t_10 >= PyTuple_GET_SIZE(__pyx_t_5)) break;
                         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-                        __pyx_t_13 = PyTuple_GET_ITEM(__pyx_t_5, __pyx_t_10); __Pyx_INCREF(__pyx_t_13); __pyx_t_10++; if (unlikely(0 < 0)) __PYX_ERR(0, 861, __pyx_L1_error)
+                        __pyx_t_13 = PyTuple_GET_ITEM(__pyx_t_5, __pyx_t_10); __Pyx_INCREF(__pyx_t_13); __pyx_t_10++; if (unlikely(0 < 0)) __PYX_ERR(0, 918, __pyx_L1_error)
                         #else
-                        __pyx_t_13 = PySequence_ITEM(__pyx_t_5, __pyx_t_10); __pyx_t_10++; if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 861, __pyx_L1_error)
+                        __pyx_t_13 = PySequence_ITEM(__pyx_t_5, __pyx_t_10); __pyx_t_10++; if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 918, __pyx_L1_error)
                         __Pyx_GOTREF(__pyx_t_13);
                         #endif
                       }
                     } else {
                       __pyx_t_13 = __pyx_t_26(__pyx_t_5);
                       if (unlikely(!__pyx_t_13)) {
                         PyObject* exc_type = PyErr_Occurred();
                         if (exc_type) {
                           if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-                          else __PYX_ERR(0, 861, __pyx_L1_error)
+                          else __PYX_ERR(0, 918, __pyx_L1_error)
                         }
                         break;
                       }
                       __Pyx_GOTREF(__pyx_t_13);
                     }
                     __Pyx_XDECREF_SET(__pyx_v_l, __pyx_t_13);
                     __pyx_t_13 = 0;
 
-                    /* "soapcw/soapcw.pyx":862
+                    /* "soapcw/soapcw.pyx":919
  *                                      if i+m-1>=0 and i+m-1<width:
  *                                          for l in range(tr_len):
  *                                              if i+l-1>=0 and i+l-1<width:             # <<<<<<<<<<<<<<
  *                                                  value = obs1[t][i+k-1] + obs2[t][i+m-1] + obs3[t][i+l-1] + tr[j][k][m][l] + val[t-1][i+j-1]
  *                                                  if value > temp:
  */
-                    __pyx_t_13 = __Pyx_PyInt_From_int(__pyx_v_i); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 862, __pyx_L1_error)
+                    __pyx_t_13 = __Pyx_PyInt_From_int(__pyx_v_i); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 919, __pyx_L1_error)
                     __Pyx_GOTREF(__pyx_t_13);
-                    __pyx_t_6 = PyNumber_Add(__pyx_t_13, __pyx_v_l); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 862, __pyx_L1_error)
+                    __pyx_t_6 = PyNumber_Add(__pyx_t_13, __pyx_v_l); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 919, __pyx_L1_error)
                     __Pyx_GOTREF(__pyx_t_6);
                     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-                    __pyx_t_13 = __Pyx_PyInt_SubtractObjC(__pyx_t_6, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 862, __pyx_L1_error)
+                    __pyx_t_13 = __Pyx_PyInt_SubtractObjC(__pyx_t_6, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 919, __pyx_L1_error)
                     __Pyx_GOTREF(__pyx_t_13);
                     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-                    __pyx_t_6 = PyObject_RichCompare(__pyx_t_13, __pyx_int_0, Py_GE); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 862, __pyx_L1_error)
+                    __pyx_t_6 = PyObject_RichCompare(__pyx_t_13, __pyx_int_0, Py_GE); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 919, __pyx_L1_error)
                     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-                    __pyx_t_22 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_22 < 0)) __PYX_ERR(0, 862, __pyx_L1_error)
+                    __pyx_t_22 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_22 < 0)) __PYX_ERR(0, 919, __pyx_L1_error)
                     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
                     if (__pyx_t_22) {
                     } else {
                       __pyx_t_21 = __pyx_t_22;
                       goto __pyx_L43_bool_binop_done;
                     }
-                    __pyx_t_6 = __Pyx_PyInt_From_int(__pyx_v_i); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 862, __pyx_L1_error)
+                    __pyx_t_6 = __Pyx_PyInt_From_int(__pyx_v_i); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 919, __pyx_L1_error)
                     __Pyx_GOTREF(__pyx_t_6);
-                    __pyx_t_13 = PyNumber_Add(__pyx_t_6, __pyx_v_l); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 862, __pyx_L1_error)
+                    __pyx_t_13 = PyNumber_Add(__pyx_t_6, __pyx_v_l); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 919, __pyx_L1_error)
                     __Pyx_GOTREF(__pyx_t_13);
                     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-                    __pyx_t_6 = __Pyx_PyInt_SubtractObjC(__pyx_t_13, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 862, __pyx_L1_error)
+                    __pyx_t_6 = __Pyx_PyInt_SubtractObjC(__pyx_t_13, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 919, __pyx_L1_error)
                     __Pyx_GOTREF(__pyx_t_6);
                     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-                    __pyx_t_13 = __Pyx_PyInt_From_int(__pyx_v_width); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 862, __pyx_L1_error)
+                    __pyx_t_13 = __Pyx_PyInt_From_int(__pyx_v_width); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 919, __pyx_L1_error)
                     __Pyx_GOTREF(__pyx_t_13);
-                    __pyx_t_3 = PyObject_RichCompare(__pyx_t_6, __pyx_t_13, Py_LT); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 862, __pyx_L1_error)
+                    __pyx_t_3 = PyObject_RichCompare(__pyx_t_6, __pyx_t_13, Py_LT); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 919, __pyx_L1_error)
                     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
                     __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-                    __pyx_t_22 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_22 < 0)) __PYX_ERR(0, 862, __pyx_L1_error)
+                    __pyx_t_22 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_22 < 0)) __PYX_ERR(0, 919, __pyx_L1_error)
                     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
                     __pyx_t_21 = __pyx_t_22;
                     __pyx_L43_bool_binop_done:;
                     if (__pyx_t_21) {
 
-                      /* "soapcw/soapcw.pyx":863
+                      /* "soapcw/soapcw.pyx":920
  *                                          for l in range(tr_len):
  *                                              if i+l-1>=0 and i+l-1<width:
  *                                                  value = obs1[t][i+k-1] + obs2[t][i+m-1] + obs3[t][i+l-1] + tr[j][k][m][l] + val[t-1][i+j-1]             # <<<<<<<<<<<<<<
  *                                                  if value > temp:
  *                                                      temp = value
  */
                       __pyx_t_37 = __pyx_v_t;
@@ -18048,57 +18386,57 @@
                       } else if (unlikely(__pyx_t_37 >= __pyx_v_obs1.shape[0])) __pyx_t_44 = 0;
                       if (__pyx_t_38 < 0) {
                         __pyx_t_38 += __pyx_v_obs1.shape[1];
                         if (unlikely(__pyx_t_38 < 0)) __pyx_t_44 = 1;
                       } else if (unlikely(__pyx_t_38 >= __pyx_v_obs1.shape[1])) __pyx_t_44 = 1;
                       if (unlikely(__pyx_t_44 != -1)) {
                         __Pyx_RaiseBufferIndexError(__pyx_t_44);
-                        __PYX_ERR(0, 863, __pyx_L1_error)
+                        __PYX_ERR(0, 920, __pyx_L1_error)
                       }
                       __pyx_t_36 = __pyx_v_t;
                       __pyx_t_35 = ((__pyx_v_i + __pyx_v_m) - 1);
                       __pyx_t_44 = -1;
                       if (__pyx_t_36 < 0) {
                         __pyx_t_36 += __pyx_v_obs2.shape[0];
                         if (unlikely(__pyx_t_36 < 0)) __pyx_t_44 = 0;
                       } else if (unlikely(__pyx_t_36 >= __pyx_v_obs2.shape[0])) __pyx_t_44 = 0;
                       if (__pyx_t_35 < 0) {
                         __pyx_t_35 += __pyx_v_obs2.shape[1];
                         if (unlikely(__pyx_t_35 < 0)) __pyx_t_44 = 1;
                       } else if (unlikely(__pyx_t_35 >= __pyx_v_obs2.shape[1])) __pyx_t_44 = 1;
                       if (unlikely(__pyx_t_44 != -1)) {
                         __Pyx_RaiseBufferIndexError(__pyx_t_44);
-                        __PYX_ERR(0, 863, __pyx_L1_error)
+                        __PYX_ERR(0, 920, __pyx_L1_error)
                       }
-                      __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_i); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 863, __pyx_L1_error)
+                      __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_i); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 920, __pyx_L1_error)
                       __Pyx_GOTREF(__pyx_t_3);
-                      __pyx_t_13 = PyNumber_Add(__pyx_t_3, __pyx_v_l); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 863, __pyx_L1_error)
+                      __pyx_t_13 = PyNumber_Add(__pyx_t_3, __pyx_v_l); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 920, __pyx_L1_error)
                       __Pyx_GOTREF(__pyx_t_13);
                       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-                      __pyx_t_3 = __Pyx_PyInt_SubtractObjC(__pyx_t_13, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 863, __pyx_L1_error)
+                      __pyx_t_3 = __Pyx_PyInt_SubtractObjC(__pyx_t_13, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 920, __pyx_L1_error)
                       __Pyx_GOTREF(__pyx_t_3);
                       __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-                      __pyx_t_34 = __Pyx_PyIndex_AsSsize_t(__pyx_t_3); if (unlikely((__pyx_t_34 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 863, __pyx_L1_error)
+                      __pyx_t_34 = __Pyx_PyIndex_AsSsize_t(__pyx_t_3); if (unlikely((__pyx_t_34 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 920, __pyx_L1_error)
                       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
                       __pyx_t_33 = __pyx_v_t;
                       __pyx_t_32 = __pyx_t_34;
                       __pyx_t_44 = -1;
                       if (__pyx_t_33 < 0) {
                         __pyx_t_33 += __pyx_v_obs3.shape[0];
                         if (unlikely(__pyx_t_33 < 0)) __pyx_t_44 = 0;
                       } else if (unlikely(__pyx_t_33 >= __pyx_v_obs3.shape[0])) __pyx_t_44 = 0;
                       if (__pyx_t_32 < 0) {
                         __pyx_t_32 += __pyx_v_obs3.shape[1];
                         if (unlikely(__pyx_t_32 < 0)) __pyx_t_44 = 1;
                       } else if (unlikely(__pyx_t_32 >= __pyx_v_obs3.shape[1])) __pyx_t_44 = 1;
                       if (unlikely(__pyx_t_44 != -1)) {
                         __Pyx_RaiseBufferIndexError(__pyx_t_44);
-                        __PYX_ERR(0, 863, __pyx_L1_error)
+                        __PYX_ERR(0, 920, __pyx_L1_error)
                       }
-                      __pyx_t_11 = __Pyx_PyIndex_AsSsize_t(__pyx_v_l); if (unlikely((__pyx_t_11 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 863, __pyx_L1_error)
+                      __pyx_t_11 = __Pyx_PyIndex_AsSsize_t(__pyx_v_l); if (unlikely((__pyx_t_11 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 920, __pyx_L1_error)
                       __pyx_t_31 = __pyx_v_j;
                       __pyx_t_30 = __pyx_v_k;
                       __pyx_t_28 = __pyx_v_m;
                       __pyx_t_27 = __pyx_t_11;
                       __pyx_t_44 = -1;
                       if (__pyx_t_31 < 0) {
                         __pyx_t_31 += __pyx_v_tr.shape[0];
@@ -18114,53 +18452,53 @@
                       } else if (unlikely(__pyx_t_28 >= __pyx_v_tr.shape[2])) __pyx_t_44 = 2;
                       if (__pyx_t_27 < 0) {
                         __pyx_t_27 += __pyx_v_tr.shape[3];
                         if (unlikely(__pyx_t_27 < 0)) __pyx_t_44 = 3;
                       } else if (unlikely(__pyx_t_27 >= __pyx_v_tr.shape[3])) __pyx_t_44 = 3;
                       if (unlikely(__pyx_t_44 != -1)) {
                         __Pyx_RaiseBufferIndexError(__pyx_t_44);
-                        __PYX_ERR(0, 863, __pyx_L1_error)
+                        __PYX_ERR(0, 920, __pyx_L1_error)
                       }
                       __pyx_t_45 = (__pyx_v_t - 1);
                       __pyx_t_46 = ((__pyx_v_i + __pyx_v_j) - 1);
                       __pyx_t_44 = -1;
                       if (__pyx_t_45 < 0) {
                         __pyx_t_45 += __pyx_v_val.shape[0];
                         if (unlikely(__pyx_t_45 < 0)) __pyx_t_44 = 0;
                       } else if (unlikely(__pyx_t_45 >= __pyx_v_val.shape[0])) __pyx_t_44 = 0;
                       if (__pyx_t_46 < 0) {
                         __pyx_t_46 += __pyx_v_val.shape[1];
                         if (unlikely(__pyx_t_46 < 0)) __pyx_t_44 = 1;
                       } else if (unlikely(__pyx_t_46 >= __pyx_v_val.shape[1])) __pyx_t_44 = 1;
                       if (unlikely(__pyx_t_44 != -1)) {
                         __Pyx_RaiseBufferIndexError(__pyx_t_44);
-                        __PYX_ERR(0, 863, __pyx_L1_error)
+                        __PYX_ERR(0, 920, __pyx_L1_error)
                       }
                       __pyx_v_value = (((((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_obs1.data + __pyx_t_37 * __pyx_v_obs1.strides[0]) ) + __pyx_t_38 * __pyx_v_obs1.strides[1]) ))) + (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_obs2.data + __pyx_t_36 * __pyx_v_obs2.strides[0]) ) + __pyx_t_35 * __pyx_v_obs2.strides[1]) )))) + (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_obs3.data + __pyx_t_33 * __pyx_v_obs3.strides[0]) ) + __pyx_t_32 * __pyx_v_obs3.strides[1]) )))) + (*((double *) ( /* dim=3 */ (( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_tr.data + __pyx_t_31 * __pyx_v_tr.strides[0]) ) + __pyx_t_30 * __pyx_v_tr.strides[1]) ) + __pyx_t_28 * __pyx_v_tr.strides[2]) ) + __pyx_t_27 * __pyx_v_tr.strides[3]) )))) + (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_val.data + __pyx_t_45 * __pyx_v_val.strides[0]) ) + __pyx_t_46 * __pyx_v_val.strides[1]) ))));
 
-                      /* "soapcw/soapcw.pyx":864
+                      /* "soapcw/soapcw.pyx":921
  *                                              if i+l-1>=0 and i+l-1<width:
  *                                                  value = obs1[t][i+k-1] + obs2[t][i+m-1] + obs3[t][i+l-1] + tr[j][k][m][l] + val[t-1][i+j-1]
  *                                                  if value > temp:             # <<<<<<<<<<<<<<
  *                                                      temp = value
  *                                                      val[t][i] = temp
  */
                       __pyx_t_21 = ((__pyx_v_value > __pyx_v_temp) != 0);
                       if (__pyx_t_21) {
 
-                        /* "soapcw/soapcw.pyx":865
+                        /* "soapcw/soapcw.pyx":922
  *                                                  value = obs1[t][i+k-1] + obs2[t][i+m-1] + obs3[t][i+l-1] + tr[j][k][m][l] + val[t-1][i+j-1]
  *                                                  if value > temp:
  *                                                      temp = value             # <<<<<<<<<<<<<<
  *                                                      val[t][i] = temp
  *                                                      prev[t][i] =  i+j-1
  */
                         __pyx_v_temp = __pyx_v_value;
 
-                        /* "soapcw/soapcw.pyx":866
+                        /* "soapcw/soapcw.pyx":923
  *                                                  if value > temp:
  *                                                      temp = value
  *                                                      val[t][i] = temp             # <<<<<<<<<<<<<<
  *                                                      prev[t][i] =  i+j-1
  *                                                      det1[t][i] =  i+k-1
  */
                         __pyx_t_46 = __pyx_v_t;
@@ -18172,19 +18510,19 @@
                         } else if (unlikely(__pyx_t_46 >= __pyx_v_val.shape[0])) __pyx_t_44 = 0;
                         if (__pyx_t_45 < 0) {
                           __pyx_t_45 += __pyx_v_val.shape[1];
                           if (unlikely(__pyx_t_45 < 0)) __pyx_t_44 = 1;
                         } else if (unlikely(__pyx_t_45 >= __pyx_v_val.shape[1])) __pyx_t_44 = 1;
                         if (unlikely(__pyx_t_44 != -1)) {
                           __Pyx_RaiseBufferIndexError(__pyx_t_44);
-                          __PYX_ERR(0, 866, __pyx_L1_error)
+                          __PYX_ERR(0, 923, __pyx_L1_error)
                         }
                         *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_val.data + __pyx_t_46 * __pyx_v_val.strides[0]) ) + __pyx_t_45 * __pyx_v_val.strides[1]) )) = __pyx_v_temp;
 
-                        /* "soapcw/soapcw.pyx":867
+                        /* "soapcw/soapcw.pyx":924
  *                                                      temp = value
  *                                                      val[t][i] = temp
  *                                                      prev[t][i] =  i+j-1             # <<<<<<<<<<<<<<
  *                                                      det1[t][i] =  i+k-1
  *                                                      det2[t][i] =  i+m-1
  */
                         __pyx_t_45 = __pyx_v_t;
@@ -18196,19 +18534,19 @@
                         } else if (unlikely(__pyx_t_45 >= __pyx_v_prev.shape[0])) __pyx_t_44 = 0;
                         if (__pyx_t_46 < 0) {
                           __pyx_t_46 += __pyx_v_prev.shape[1];
                           if (unlikely(__pyx_t_46 < 0)) __pyx_t_44 = 1;
                         } else if (unlikely(__pyx_t_46 >= __pyx_v_prev.shape[1])) __pyx_t_44 = 1;
                         if (unlikely(__pyx_t_44 != -1)) {
                           __Pyx_RaiseBufferIndexError(__pyx_t_44);
-                          __PYX_ERR(0, 867, __pyx_L1_error)
+                          __PYX_ERR(0, 924, __pyx_L1_error)
                         }
                         *((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_prev.data + __pyx_t_45 * __pyx_v_prev.strides[0]) ) + __pyx_t_46 * __pyx_v_prev.strides[1]) )) = ((__pyx_v_i + __pyx_v_j) - 1);
 
-                        /* "soapcw/soapcw.pyx":868
+                        /* "soapcw/soapcw.pyx":925
  *                                                      val[t][i] = temp
  *                                                      prev[t][i] =  i+j-1
  *                                                      det1[t][i] =  i+k-1             # <<<<<<<<<<<<<<
  *                                                      det2[t][i] =  i+m-1
  *                                                      det3[0][i] =  i+l-1
  */
                         __pyx_t_46 = __pyx_v_t;
@@ -18220,19 +18558,19 @@
                         } else if (unlikely(__pyx_t_46 >= __pyx_v_det1.shape[0])) __pyx_t_44 = 0;
                         if (__pyx_t_45 < 0) {
                           __pyx_t_45 += __pyx_v_det1.shape[1];
                           if (unlikely(__pyx_t_45 < 0)) __pyx_t_44 = 1;
                         } else if (unlikely(__pyx_t_45 >= __pyx_v_det1.shape[1])) __pyx_t_44 = 1;
                         if (unlikely(__pyx_t_44 != -1)) {
                           __Pyx_RaiseBufferIndexError(__pyx_t_44);
-                          __PYX_ERR(0, 868, __pyx_L1_error)
+                          __PYX_ERR(0, 925, __pyx_L1_error)
                         }
                         *((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_det1.data + __pyx_t_46 * __pyx_v_det1.strides[0]) ) + __pyx_t_45 * __pyx_v_det1.strides[1]) )) = ((__pyx_v_i + __pyx_v_k) - 1);
 
-                        /* "soapcw/soapcw.pyx":869
+                        /* "soapcw/soapcw.pyx":926
  *                                                      prev[t][i] =  i+j-1
  *                                                      det1[t][i] =  i+k-1
  *                                                      det2[t][i] =  i+m-1             # <<<<<<<<<<<<<<
  *                                                      det3[0][i] =  i+l-1
  *                                                  else:
  */
                         __pyx_t_45 = __pyx_v_t;
@@ -18244,172 +18582,172 @@
                         } else if (unlikely(__pyx_t_45 >= __pyx_v_det2.shape[0])) __pyx_t_44 = 0;
                         if (__pyx_t_46 < 0) {
                           __pyx_t_46 += __pyx_v_det2.shape[1];
                           if (unlikely(__pyx_t_46 < 0)) __pyx_t_44 = 1;
                         } else if (unlikely(__pyx_t_46 >= __pyx_v_det2.shape[1])) __pyx_t_44 = 1;
                         if (unlikely(__pyx_t_44 != -1)) {
                           __Pyx_RaiseBufferIndexError(__pyx_t_44);
-                          __PYX_ERR(0, 869, __pyx_L1_error)
+                          __PYX_ERR(0, 926, __pyx_L1_error)
                         }
                         *((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_det2.data + __pyx_t_45 * __pyx_v_det2.strides[0]) ) + __pyx_t_46 * __pyx_v_det2.strides[1]) )) = ((__pyx_v_i + __pyx_v_m) - 1);
 
-                        /* "soapcw/soapcw.pyx":870
+                        /* "soapcw/soapcw.pyx":927
  *                                                      det1[t][i] =  i+k-1
  *                                                      det2[t][i] =  i+m-1
  *                                                      det3[0][i] =  i+l-1             # <<<<<<<<<<<<<<
  *                                                  else:
  *                                                      continue
  */
-                        __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_i); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 870, __pyx_L1_error)
+                        __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_i); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 927, __pyx_L1_error)
                         __Pyx_GOTREF(__pyx_t_3);
-                        __pyx_t_13 = PyNumber_Add(__pyx_t_3, __pyx_v_l); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 870, __pyx_L1_error)
+                        __pyx_t_13 = PyNumber_Add(__pyx_t_3, __pyx_v_l); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 927, __pyx_L1_error)
                         __Pyx_GOTREF(__pyx_t_13);
                         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-                        __pyx_t_3 = __Pyx_PyInt_SubtractObjC(__pyx_t_13, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 870, __pyx_L1_error)
+                        __pyx_t_3 = __Pyx_PyInt_SubtractObjC(__pyx_t_13, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 927, __pyx_L1_error)
                         __Pyx_GOTREF(__pyx_t_3);
                         __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-                        __pyx_t_44 = __Pyx_PyInt_As_int(__pyx_t_3); if (unlikely((__pyx_t_44 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 870, __pyx_L1_error)
+                        __pyx_t_44 = __Pyx_PyInt_As_int(__pyx_t_3); if (unlikely((__pyx_t_44 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 927, __pyx_L1_error)
                         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
                         __pyx_t_46 = 0;
                         __pyx_t_45 = __pyx_v_i;
                         __pyx_t_47 = -1;
                         if (__pyx_t_46 < 0) {
                           __pyx_t_46 += __pyx_v_det3.shape[0];
                           if (unlikely(__pyx_t_46 < 0)) __pyx_t_47 = 0;
                         } else if (unlikely(__pyx_t_46 >= __pyx_v_det3.shape[0])) __pyx_t_47 = 0;
                         if (__pyx_t_45 < 0) {
                           __pyx_t_45 += __pyx_v_det3.shape[1];
                           if (unlikely(__pyx_t_45 < 0)) __pyx_t_47 = 1;
                         } else if (unlikely(__pyx_t_45 >= __pyx_v_det3.shape[1])) __pyx_t_47 = 1;
                         if (unlikely(__pyx_t_47 != -1)) {
                           __Pyx_RaiseBufferIndexError(__pyx_t_47);
-                          __PYX_ERR(0, 870, __pyx_L1_error)
+                          __PYX_ERR(0, 927, __pyx_L1_error)
                         }
                         *((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_det3.data + __pyx_t_46 * __pyx_v_det3.strides[0]) ) + __pyx_t_45 * __pyx_v_det3.strides[1]) )) = __pyx_t_44;
 
-                        /* "soapcw/soapcw.pyx":864
+                        /* "soapcw/soapcw.pyx":921
  *                                              if i+l-1>=0 and i+l-1<width:
  *                                                  value = obs1[t][i+k-1] + obs2[t][i+m-1] + obs3[t][i+l-1] + tr[j][k][m][l] + val[t-1][i+j-1]
  *                                                  if value > temp:             # <<<<<<<<<<<<<<
  *                                                      temp = value
  *                                                      val[t][i] = temp
  */
                         goto __pyx_L45;
                       }
 
-                      /* "soapcw/soapcw.pyx":872
+                      /* "soapcw/soapcw.pyx":929
  *                                                      det3[0][i] =  i+l-1
  *                                                  else:
  *                                                      continue             # <<<<<<<<<<<<<<
  * 
  *             if self.prog == True:
  */
                       /*else*/ {
                         goto __pyx_L40_continue;
                       }
                       __pyx_L45:;
 
-                      /* "soapcw/soapcw.pyx":862
+                      /* "soapcw/soapcw.pyx":919
  *                                      if i+m-1>=0 and i+m-1<width:
  *                                          for l in range(tr_len):
  *                                              if i+l-1>=0 and i+l-1<width:             # <<<<<<<<<<<<<<
  *                                                  value = obs1[t][i+k-1] + obs2[t][i+m-1] + obs3[t][i+l-1] + tr[j][k][m][l] + val[t-1][i+j-1]
  *                                                  if value > temp:
  */
                     }
 
-                    /* "soapcw/soapcw.pyx":861
+                    /* "soapcw/soapcw.pyx":918
  *                                 for m in range(tr_len):
  *                                      if i+m-1>=0 and i+m-1<width:
  *                                          for l in range(tr_len):             # <<<<<<<<<<<<<<
  *                                              if i+l-1>=0 and i+l-1<width:
  *                                                  value = obs1[t][i+k-1] + obs2[t][i+m-1] + obs3[t][i+l-1] + tr[j][k][m][l] + val[t-1][i+j-1]
  */
                     __pyx_L40_continue:;
                   }
                   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-                  /* "soapcw/soapcw.pyx":860
+                  /* "soapcw/soapcw.pyx":917
  *                             if i+k-1>=0 and i+k-1<width:
  *                                 for m in range(tr_len):
  *                                      if i+m-1>=0 and i+m-1<width:             # <<<<<<<<<<<<<<
  *                                          for l in range(tr_len):
  *                                              if i+l-1>=0 and i+l-1<width:
  */
                 }
               }
 
-              /* "soapcw/soapcw.pyx":858
+              /* "soapcw/soapcw.pyx":915
  *                     if i+j-1>=0 and i+j-1<width:
  *                        for k in range(tr_len):
  *                             if i+k-1>=0 and i+k-1<width:             # <<<<<<<<<<<<<<
  *                                 for m in range(tr_len):
  *                                      if i+m-1>=0 and i+m-1<width:
  */
             }
           }
 
-          /* "soapcw/soapcw.pyx":856
+          /* "soapcw/soapcw.pyx":913
  *                 temp = -1e6
  *                 for j in range(tr_len):
  *                     if i+j-1>=0 and i+j-1<width:             # <<<<<<<<<<<<<<
  *                        for k in range(tr_len):
  *                             if i+k-1>=0 and i+k-1<width:
  */
         }
       }
     }
 
-    /* "soapcw/soapcw.pyx":874
+    /* "soapcw/soapcw.pyx":931
  *                                                      continue
  * 
  *             if self.prog == True:             # <<<<<<<<<<<<<<
  *                 if pt>pbar:
  *                     stdout.write('\r{} %'.format(round(pt)))
  */
-    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_prog); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 874, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_prog); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 931, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_3 = PyObject_RichCompare(__pyx_t_5, Py_True, Py_EQ); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 874, __pyx_L1_error)
+    __pyx_t_3 = PyObject_RichCompare(__pyx_t_5, Py_True, Py_EQ); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 931, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __pyx_t_21 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_21 < 0)) __PYX_ERR(0, 874, __pyx_L1_error)
+    __pyx_t_21 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_21 < 0)) __PYX_ERR(0, 931, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     if (__pyx_t_21) {
 
-      /* "soapcw/soapcw.pyx":875
+      /* "soapcw/soapcw.pyx":932
  * 
  *             if self.prog == True:
  *                 if pt>pbar:             # <<<<<<<<<<<<<<
  *                     stdout.write('\r{} %'.format(round(pt)))
  *                     stdout.flush()
  */
-      __pyx_t_3 = PyFloat_FromDouble(__pyx_v_pt); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 875, __pyx_L1_error)
+      __pyx_t_3 = PyFloat_FromDouble(__pyx_v_pt); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 932, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
-      __pyx_t_5 = PyObject_RichCompare(__pyx_t_3, __pyx_v_pbar, Py_GT); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 875, __pyx_L1_error)
+      __pyx_t_5 = PyObject_RichCompare(__pyx_t_3, __pyx_v_pbar, Py_GT); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 932, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-      __pyx_t_21 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_21 < 0)) __PYX_ERR(0, 875, __pyx_L1_error)
+      __pyx_t_21 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_21 < 0)) __PYX_ERR(0, 932, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
       if (__pyx_t_21) {
 
-        /* "soapcw/soapcw.pyx":876
+        /* "soapcw/soapcw.pyx":933
  *             if self.prog == True:
  *                 if pt>pbar:
  *                     stdout.write('\r{} %'.format(round(pt)))             # <<<<<<<<<<<<<<
  *                     stdout.flush()
  *                     pbar+=100./length
  */
-        __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_stdout); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 876, __pyx_L1_error)
+        __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_stdout); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 933, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
-        __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_write); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 876, __pyx_L1_error)
+        __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_write); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 933, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_13);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u__4, __pyx_n_s_format); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 876, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u__4, __pyx_n_s_format); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 933, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_4 = PyFloat_FromDouble(__pyx_v_pt); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 876, __pyx_L1_error)
+        __pyx_t_4 = PyFloat_FromDouble(__pyx_v_pt); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 933, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
-        __pyx_t_48 = __Pyx_PyObject_CallOneArg(__pyx_builtin_round, __pyx_t_4); if (unlikely(!__pyx_t_48)) __PYX_ERR(0, 876, __pyx_L1_error)
+        __pyx_t_48 = __Pyx_PyObject_CallOneArg(__pyx_builtin_round, __pyx_t_4); if (unlikely(!__pyx_t_48)) __PYX_ERR(0, 933, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_48);
         __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
         __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_6))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_6);
           if (likely(__pyx_t_4)) {
             PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
@@ -18417,15 +18755,15 @@
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_6, function);
           }
         }
         __pyx_t_3 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_6, __pyx_t_4, __pyx_t_48) : __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_t_48);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
         __Pyx_DECREF(__pyx_t_48); __pyx_t_48 = 0;
-        if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 876, __pyx_L1_error)
+        if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 933, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __pyx_t_6 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_13))) {
           __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_13);
           if (likely(__pyx_t_6)) {
             PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_13);
@@ -18433,325 +18771,325 @@
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_13, function);
           }
         }
         __pyx_t_5 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_13, __pyx_t_6, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_13, __pyx_t_3);
         __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 876, __pyx_L1_error)
+        if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 933, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_5);
         __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-        /* "soapcw/soapcw.pyx":877
+        /* "soapcw/soapcw.pyx":934
  *                 if pt>pbar:
  *                     stdout.write('\r{} %'.format(round(pt)))
  *                     stdout.flush()             # <<<<<<<<<<<<<<
  *                     pbar+=100./length
  * 
  */
-        __Pyx_GetModuleGlobalName(__pyx_t_13, __pyx_n_s_stdout); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 877, __pyx_L1_error)
+        __Pyx_GetModuleGlobalName(__pyx_t_13, __pyx_n_s_stdout); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 934, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_13);
-        __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_13, __pyx_n_s_flush); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 877, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_13, __pyx_n_s_flush); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 934, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
         __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
         __pyx_t_13 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_13 = PyMethod_GET_SELF(__pyx_t_3);
           if (likely(__pyx_t_13)) {
             PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
             __Pyx_INCREF(__pyx_t_13);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_5 = (__pyx_t_13) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_13) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
         __Pyx_XDECREF(__pyx_t_13); __pyx_t_13 = 0;
-        if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 877, __pyx_L1_error)
+        if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 934, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_5);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-        /* "soapcw/soapcw.pyx":878
+        /* "soapcw/soapcw.pyx":935
  *                     stdout.write('\r{} %'.format(round(pt)))
  *                     stdout.flush()
  *                     pbar+=100./length             # <<<<<<<<<<<<<<
  * 
  * 
  */
         if (unlikely(__pyx_v_length == 0)) {
           PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-          __PYX_ERR(0, 878, __pyx_L1_error)
+          __PYX_ERR(0, 935, __pyx_L1_error)
         }
-        __pyx_t_5 = PyFloat_FromDouble((100. / ((double)__pyx_v_length))); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 878, __pyx_L1_error)
+        __pyx_t_5 = PyFloat_FromDouble((100. / ((double)__pyx_v_length))); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 935, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_5);
-        __pyx_t_3 = PyNumber_InPlaceAdd(__pyx_v_pbar, __pyx_t_5); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 878, __pyx_L1_error)
+        __pyx_t_3 = PyNumber_InPlaceAdd(__pyx_v_pbar, __pyx_t_5); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 935, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
         __Pyx_DECREF_SET(__pyx_v_pbar, __pyx_t_3);
         __pyx_t_3 = 0;
 
-        /* "soapcw/soapcw.pyx":875
+        /* "soapcw/soapcw.pyx":932
  * 
  *             if self.prog == True:
  *                 if pt>pbar:             # <<<<<<<<<<<<<<
  *                     stdout.write('\r{} %'.format(round(pt)))
  *                     stdout.flush()
  */
       }
 
-      /* "soapcw/soapcw.pyx":874
+      /* "soapcw/soapcw.pyx":931
  *                                                      continue
  * 
  *             if self.prog == True:             # <<<<<<<<<<<<<<
  *                 if pt>pbar:
  *                     stdout.write('\r{} %'.format(round(pt)))
  */
     }
   }
 
-  /* "soapcw/soapcw.pyx":882
+  /* "soapcw/soapcw.pyx":939
  * 
  * 
  *         cdef long previous = 1             # <<<<<<<<<<<<<<
  *         cdef long[:] vit_trackr = np.zeros(length).astype(int)
  *         cdef long[:] vit_track1 = np.zeros(length).astype(int)
  */
   __pyx_v_previous = 1;
 
-  /* "soapcw/soapcw.pyx":883
+  /* "soapcw/soapcw.pyx":940
  * 
  *         cdef long previous = 1
  *         cdef long[:] vit_trackr = np.zeros(length).astype(int)             # <<<<<<<<<<<<<<
  *         cdef long[:] vit_track1 = np.zeros(length).astype(int)
  *         cdef long[:] vit_track2 = np.zeros(length).astype(int)
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_13, __pyx_n_s_np); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 883, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_13, __pyx_n_s_np); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 940, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_13, __pyx_n_s_zeros); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 883, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_13, __pyx_n_s_zeros); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 940, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-  __pyx_t_13 = __Pyx_PyInt_From_int(__pyx_v_length); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 883, __pyx_L1_error)
+  __pyx_t_13 = __Pyx_PyInt_From_int(__pyx_v_length); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 940, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
   __pyx_t_48 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_6))) {
     __pyx_t_48 = PyMethod_GET_SELF(__pyx_t_6);
     if (likely(__pyx_t_48)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
       __Pyx_INCREF(__pyx_t_48);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_6, function);
     }
   }
   __pyx_t_5 = (__pyx_t_48) ? __Pyx_PyObject_Call2Args(__pyx_t_6, __pyx_t_48, __pyx_t_13) : __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_t_13);
   __Pyx_XDECREF(__pyx_t_48); __pyx_t_48 = 0;
   __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-  if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 883, __pyx_L1_error)
+  if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 940, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_astype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 883, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_astype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 940, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __pyx_t_5 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_6))) {
     __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_6);
     if (likely(__pyx_t_5)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
       __Pyx_INCREF(__pyx_t_5);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_6, function);
     }
   }
   __pyx_t_3 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_6, __pyx_t_5, ((PyObject *)(&PyInt_Type))) : __Pyx_PyObject_CallOneArg(__pyx_t_6, ((PyObject *)(&PyInt_Type)));
   __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 883, __pyx_L1_error)
+  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 940, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_49 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_3, PyBUF_WRITABLE); if (unlikely(!__pyx_t_49.memview)) __PYX_ERR(0, 883, __pyx_L1_error)
+  __pyx_t_49 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_3, PyBUF_WRITABLE); if (unlikely(!__pyx_t_49.memview)) __PYX_ERR(0, 940, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_v_vit_trackr = __pyx_t_49;
   __pyx_t_49.memview = NULL;
   __pyx_t_49.data = NULL;
 
-  /* "soapcw/soapcw.pyx":884
+  /* "soapcw/soapcw.pyx":941
  *         cdef long previous = 1
  *         cdef long[:] vit_trackr = np.zeros(length).astype(int)
  *         cdef long[:] vit_track1 = np.zeros(length).astype(int)             # <<<<<<<<<<<<<<
  *         cdef long[:] vit_track2 = np.zeros(length).astype(int)
  *         cdef long[:] vit_track3 = np.zeros(length).astype(int)
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 884, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 941, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_zeros); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 884, __pyx_L1_error)
+  __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_zeros); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 941, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyInt_From_int(__pyx_v_length); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 884, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyInt_From_int(__pyx_v_length); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 941, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __pyx_t_48 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_13))) {
     __pyx_t_48 = PyMethod_GET_SELF(__pyx_t_13);
     if (likely(__pyx_t_48)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_13);
       __Pyx_INCREF(__pyx_t_48);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_13, function);
     }
   }
   __pyx_t_6 = (__pyx_t_48) ? __Pyx_PyObject_Call2Args(__pyx_t_13, __pyx_t_48, __pyx_t_5) : __Pyx_PyObject_CallOneArg(__pyx_t_13, __pyx_t_5);
   __Pyx_XDECREF(__pyx_t_48); __pyx_t_48 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 884, __pyx_L1_error)
+  if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 941, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-  __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_astype); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 884, __pyx_L1_error)
+  __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_astype); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 941, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_t_6 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_13))) {
     __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_13);
     if (likely(__pyx_t_6)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_13);
       __Pyx_INCREF(__pyx_t_6);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_13, function);
     }
   }
   __pyx_t_3 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_13, __pyx_t_6, ((PyObject *)(&PyInt_Type))) : __Pyx_PyObject_CallOneArg(__pyx_t_13, ((PyObject *)(&PyInt_Type)));
   __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
-  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 884, __pyx_L1_error)
+  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 941, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-  __pyx_t_49 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_3, PyBUF_WRITABLE); if (unlikely(!__pyx_t_49.memview)) __PYX_ERR(0, 884, __pyx_L1_error)
+  __pyx_t_49 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_3, PyBUF_WRITABLE); if (unlikely(!__pyx_t_49.memview)) __PYX_ERR(0, 941, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_v_vit_track1 = __pyx_t_49;
   __pyx_t_49.memview = NULL;
   __pyx_t_49.data = NULL;
 
-  /* "soapcw/soapcw.pyx":885
+  /* "soapcw/soapcw.pyx":942
  *         cdef long[:] vit_trackr = np.zeros(length).astype(int)
  *         cdef long[:] vit_track1 = np.zeros(length).astype(int)
  *         cdef long[:] vit_track2 = np.zeros(length).astype(int)             # <<<<<<<<<<<<<<
  *         cdef long[:] vit_track3 = np.zeros(length).astype(int)
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 885, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 942, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_zeros); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 885, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_zeros); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 942, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyInt_From_int(__pyx_v_length); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 885, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyInt_From_int(__pyx_v_length); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 942, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __pyx_t_48 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
     __pyx_t_48 = PyMethod_GET_SELF(__pyx_t_5);
     if (likely(__pyx_t_48)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
       __Pyx_INCREF(__pyx_t_48);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_5, function);
     }
   }
   __pyx_t_13 = (__pyx_t_48) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_48, __pyx_t_6) : __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_6);
   __Pyx_XDECREF(__pyx_t_48); __pyx_t_48 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 885, __pyx_L1_error)
+  if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 942, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_13, __pyx_n_s_astype); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 885, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_13, __pyx_n_s_astype); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 942, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
   __pyx_t_13 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
     __pyx_t_13 = PyMethod_GET_SELF(__pyx_t_5);
     if (likely(__pyx_t_13)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
       __Pyx_INCREF(__pyx_t_13);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_5, function);
     }
   }
   __pyx_t_3 = (__pyx_t_13) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_13, ((PyObject *)(&PyInt_Type))) : __Pyx_PyObject_CallOneArg(__pyx_t_5, ((PyObject *)(&PyInt_Type)));
   __Pyx_XDECREF(__pyx_t_13); __pyx_t_13 = 0;
-  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 885, __pyx_L1_error)
+  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 942, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_49 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_3, PyBUF_WRITABLE); if (unlikely(!__pyx_t_49.memview)) __PYX_ERR(0, 885, __pyx_L1_error)
+  __pyx_t_49 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_3, PyBUF_WRITABLE); if (unlikely(!__pyx_t_49.memview)) __PYX_ERR(0, 942, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_v_vit_track2 = __pyx_t_49;
   __pyx_t_49.memview = NULL;
   __pyx_t_49.data = NULL;
 
-  /* "soapcw/soapcw.pyx":886
+  /* "soapcw/soapcw.pyx":943
  *         cdef long[:] vit_track1 = np.zeros(length).astype(int)
  *         cdef long[:] vit_track2 = np.zeros(length).astype(int)
  *         cdef long[:] vit_track3 = np.zeros(length).astype(int)             # <<<<<<<<<<<<<<
  * 
  *         cdef float max_prob = np.array([val[length-1][i] for i in range(width)]).max()
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_13, __pyx_n_s_np); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 886, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_13, __pyx_n_s_np); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 943, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_13, __pyx_n_s_zeros); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 886, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_13, __pyx_n_s_zeros); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 943, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-  __pyx_t_13 = __Pyx_PyInt_From_int(__pyx_v_length); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 886, __pyx_L1_error)
+  __pyx_t_13 = __Pyx_PyInt_From_int(__pyx_v_length); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 943, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
   __pyx_t_48 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_6))) {
     __pyx_t_48 = PyMethod_GET_SELF(__pyx_t_6);
     if (likely(__pyx_t_48)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
       __Pyx_INCREF(__pyx_t_48);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_6, function);
     }
   }
   __pyx_t_5 = (__pyx_t_48) ? __Pyx_PyObject_Call2Args(__pyx_t_6, __pyx_t_48, __pyx_t_13) : __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_t_13);
   __Pyx_XDECREF(__pyx_t_48); __pyx_t_48 = 0;
   __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-  if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 886, __pyx_L1_error)
+  if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 943, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_astype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 886, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_astype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 943, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __pyx_t_5 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_6))) {
     __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_6);
     if (likely(__pyx_t_5)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
       __Pyx_INCREF(__pyx_t_5);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_6, function);
     }
   }
   __pyx_t_3 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_6, __pyx_t_5, ((PyObject *)(&PyInt_Type))) : __Pyx_PyObject_CallOneArg(__pyx_t_6, ((PyObject *)(&PyInt_Type)));
   __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 886, __pyx_L1_error)
+  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 943, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_49 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_3, PyBUF_WRITABLE); if (unlikely(!__pyx_t_49.memview)) __PYX_ERR(0, 886, __pyx_L1_error)
+  __pyx_t_49 = __Pyx_PyObject_to_MemoryviewSlice_ds_long(__pyx_t_3, PyBUF_WRITABLE); if (unlikely(!__pyx_t_49.memview)) __PYX_ERR(0, 943, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_v_vit_track3 = __pyx_t_49;
   __pyx_t_49.memview = NULL;
   __pyx_t_49.data = NULL;
 
-  /* "soapcw/soapcw.pyx":888
+  /* "soapcw/soapcw.pyx":945
  *         cdef long[:] vit_track3 = np.zeros(length).astype(int)
  * 
  *         cdef float max_prob = np.array([val[length-1][i] for i in range(width)]).max()             # <<<<<<<<<<<<<<
  *         cdef long max_prob_index = np.array([val[length-1][i] for i in range(width)]).argmax()
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 888, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 945, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_array); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 888, __pyx_L1_error)
+  __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_array); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 945, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   { /* enter inner scope */
-    __pyx_t_5 = PyList_New(0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 888, __pyx_L1_error)
+    __pyx_t_5 = PyList_New(0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 945, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __pyx_t_15 = __pyx_v_width;
     __pyx_t_16 = __pyx_t_15;
     for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
       __pyx_8genexpr7__pyx_v_i = __pyx_t_17;
       __pyx_t_45 = (__pyx_v_length - 1);
       __pyx_t_46 = __pyx_8genexpr7__pyx_v_i;
@@ -18762,19 +19100,19 @@
       } else if (unlikely(__pyx_t_45 >= __pyx_v_val.shape[0])) __pyx_t_18 = 0;
       if (__pyx_t_46 < 0) {
         __pyx_t_46 += __pyx_v_val.shape[1];
         if (unlikely(__pyx_t_46 < 0)) __pyx_t_18 = 1;
       } else if (unlikely(__pyx_t_46 >= __pyx_v_val.shape[1])) __pyx_t_18 = 1;
       if (unlikely(__pyx_t_18 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_18);
-        __PYX_ERR(0, 888, __pyx_L1_error)
+        __PYX_ERR(0, 945, __pyx_L1_error)
       }
-      __pyx_t_48 = PyFloat_FromDouble((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_val.data + __pyx_t_45 * __pyx_v_val.strides[0]) ) + __pyx_t_46 * __pyx_v_val.strides[1]) )))); if (unlikely(!__pyx_t_48)) __PYX_ERR(0, 888, __pyx_L1_error)
+      __pyx_t_48 = PyFloat_FromDouble((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_val.data + __pyx_t_45 * __pyx_v_val.strides[0]) ) + __pyx_t_46 * __pyx_v_val.strides[1]) )))); if (unlikely(!__pyx_t_48)) __PYX_ERR(0, 945, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_48);
-      if (unlikely(__Pyx_ListComp_Append(__pyx_t_5, (PyObject*)__pyx_t_48))) __PYX_ERR(0, 888, __pyx_L1_error)
+      if (unlikely(__Pyx_ListComp_Append(__pyx_t_5, (PyObject*)__pyx_t_48))) __PYX_ERR(0, 945, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_48); __pyx_t_48 = 0;
     }
   } /* exit inner scope */
   __pyx_t_48 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_13))) {
     __pyx_t_48 = PyMethod_GET_SELF(__pyx_t_13);
     if (likely(__pyx_t_48)) {
@@ -18783,53 +19121,53 @@
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_13, function);
     }
   }
   __pyx_t_6 = (__pyx_t_48) ? __Pyx_PyObject_Call2Args(__pyx_t_13, __pyx_t_48, __pyx_t_5) : __Pyx_PyObject_CallOneArg(__pyx_t_13, __pyx_t_5);
   __Pyx_XDECREF(__pyx_t_48); __pyx_t_48 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 888, __pyx_L1_error)
+  if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 945, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-  __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_max); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 888, __pyx_L1_error)
+  __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_max); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 945, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_t_6 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_13))) {
     __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_13);
     if (likely(__pyx_t_6)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_13);
       __Pyx_INCREF(__pyx_t_6);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_13, function);
     }
   }
   __pyx_t_3 = (__pyx_t_6) ? __Pyx_PyObject_CallOneArg(__pyx_t_13, __pyx_t_6) : __Pyx_PyObject_CallNoArg(__pyx_t_13);
   __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
-  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 888, __pyx_L1_error)
+  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 945, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-  __pyx_t_50 = __pyx_PyFloat_AsFloat(__pyx_t_3); if (unlikely((__pyx_t_50 == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 888, __pyx_L1_error)
+  __pyx_t_50 = __pyx_PyFloat_AsFloat(__pyx_t_3); if (unlikely((__pyx_t_50 == (float)-1) && PyErr_Occurred())) __PYX_ERR(0, 945, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_v_max_prob = __pyx_t_50;
 
-  /* "soapcw/soapcw.pyx":889
+  /* "soapcw/soapcw.pyx":946
  * 
  *         cdef float max_prob = np.array([val[length-1][i] for i in range(width)]).max()
  *         cdef long max_prob_index = np.array([val[length-1][i] for i in range(width)]).argmax()             # <<<<<<<<<<<<<<
  * 
  *         vit_trackr[length-1] = max_prob_index
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 889, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 946, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_array); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 889, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_array); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 946, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   { /* enter inner scope */
-    __pyx_t_6 = PyList_New(0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 889, __pyx_L1_error)
+    __pyx_t_6 = PyList_New(0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 946, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __pyx_t_15 = __pyx_v_width;
     __pyx_t_16 = __pyx_t_15;
     for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
       __pyx_8genexpr8__pyx_v_i = __pyx_t_17;
       __pyx_t_46 = (__pyx_v_length - 1);
       __pyx_t_45 = __pyx_8genexpr8__pyx_v_i;
@@ -18840,19 +19178,19 @@
       } else if (unlikely(__pyx_t_46 >= __pyx_v_val.shape[0])) __pyx_t_18 = 0;
       if (__pyx_t_45 < 0) {
         __pyx_t_45 += __pyx_v_val.shape[1];
         if (unlikely(__pyx_t_45 < 0)) __pyx_t_18 = 1;
       } else if (unlikely(__pyx_t_45 >= __pyx_v_val.shape[1])) __pyx_t_18 = 1;
       if (unlikely(__pyx_t_18 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_18);
-        __PYX_ERR(0, 889, __pyx_L1_error)
+        __PYX_ERR(0, 946, __pyx_L1_error)
       }
-      __pyx_t_48 = PyFloat_FromDouble((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_val.data + __pyx_t_46 * __pyx_v_val.strides[0]) ) + __pyx_t_45 * __pyx_v_val.strides[1]) )))); if (unlikely(!__pyx_t_48)) __PYX_ERR(0, 889, __pyx_L1_error)
+      __pyx_t_48 = PyFloat_FromDouble((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_val.data + __pyx_t_46 * __pyx_v_val.strides[0]) ) + __pyx_t_45 * __pyx_v_val.strides[1]) )))); if (unlikely(!__pyx_t_48)) __PYX_ERR(0, 946, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_48);
-      if (unlikely(__Pyx_ListComp_Append(__pyx_t_6, (PyObject*)__pyx_t_48))) __PYX_ERR(0, 889, __pyx_L1_error)
+      if (unlikely(__Pyx_ListComp_Append(__pyx_t_6, (PyObject*)__pyx_t_48))) __PYX_ERR(0, 946, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_48); __pyx_t_48 = 0;
     }
   } /* exit inner scope */
   __pyx_t_48 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
     __pyx_t_48 = PyMethod_GET_SELF(__pyx_t_5);
     if (likely(__pyx_t_48)) {
@@ -18861,59 +19199,59 @@
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_5, function);
     }
   }
   __pyx_t_13 = (__pyx_t_48) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_48, __pyx_t_6) : __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_6);
   __Pyx_XDECREF(__pyx_t_48); __pyx_t_48 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 889, __pyx_L1_error)
+  if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 946, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_13, __pyx_n_s_argmax); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 889, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_13, __pyx_n_s_argmax); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 946, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
   __pyx_t_13 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
     __pyx_t_13 = PyMethod_GET_SELF(__pyx_t_5);
     if (likely(__pyx_t_13)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
       __Pyx_INCREF(__pyx_t_13);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_5, function);
     }
   }
   __pyx_t_3 = (__pyx_t_13) ? __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_13) : __Pyx_PyObject_CallNoArg(__pyx_t_5);
   __Pyx_XDECREF(__pyx_t_13); __pyx_t_13 = 0;
-  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 889, __pyx_L1_error)
+  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 946, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_51 = __Pyx_PyInt_As_long(__pyx_t_3); if (unlikely((__pyx_t_51 == (long)-1) && PyErr_Occurred())) __PYX_ERR(0, 889, __pyx_L1_error)
+  __pyx_t_51 = __Pyx_PyInt_As_long(__pyx_t_3); if (unlikely((__pyx_t_51 == (long)-1) && PyErr_Occurred())) __PYX_ERR(0, 946, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_v_max_prob_index = __pyx_t_51;
 
-  /* "soapcw/soapcw.pyx":891
+  /* "soapcw/soapcw.pyx":948
  *         cdef long max_prob_index = np.array([val[length-1][i] for i in range(width)]).argmax()
  * 
  *         vit_trackr[length-1] = max_prob_index             # <<<<<<<<<<<<<<
  *         vit_track1[length-1] = det1[length-1][max_prob_index]
  *         vit_track2[length-1] = det2[length-1][max_prob_index]
  */
   __pyx_t_45 = (__pyx_v_length - 1);
   __pyx_t_15 = -1;
   if (__pyx_t_45 < 0) {
     __pyx_t_45 += __pyx_v_vit_trackr.shape[0];
     if (unlikely(__pyx_t_45 < 0)) __pyx_t_15 = 0;
   } else if (unlikely(__pyx_t_45 >= __pyx_v_vit_trackr.shape[0])) __pyx_t_15 = 0;
   if (unlikely(__pyx_t_15 != -1)) {
     __Pyx_RaiseBufferIndexError(__pyx_t_15);
-    __PYX_ERR(0, 891, __pyx_L1_error)
+    __PYX_ERR(0, 948, __pyx_L1_error)
   }
   *((long *) ( /* dim=0 */ (__pyx_v_vit_trackr.data + __pyx_t_45 * __pyx_v_vit_trackr.strides[0]) )) = __pyx_v_max_prob_index;
 
-  /* "soapcw/soapcw.pyx":892
+  /* "soapcw/soapcw.pyx":949
  * 
  *         vit_trackr[length-1] = max_prob_index
  *         vit_track1[length-1] = det1[length-1][max_prob_index]             # <<<<<<<<<<<<<<
  *         vit_track2[length-1] = det2[length-1][max_prob_index]
  *         vit_track3[length-1] = det3[length-1][max_prob_index]
  */
   __pyx_t_45 = (__pyx_v_length - 1);
@@ -18925,29 +19263,29 @@
   } else if (unlikely(__pyx_t_45 >= __pyx_v_det1.shape[0])) __pyx_t_15 = 0;
   if (__pyx_t_46 < 0) {
     __pyx_t_46 += __pyx_v_det1.shape[1];
     if (unlikely(__pyx_t_46 < 0)) __pyx_t_15 = 1;
   } else if (unlikely(__pyx_t_46 >= __pyx_v_det1.shape[1])) __pyx_t_15 = 1;
   if (unlikely(__pyx_t_15 != -1)) {
     __Pyx_RaiseBufferIndexError(__pyx_t_15);
-    __PYX_ERR(0, 892, __pyx_L1_error)
+    __PYX_ERR(0, 949, __pyx_L1_error)
   }
   __pyx_t_27 = (__pyx_v_length - 1);
   __pyx_t_15 = -1;
   if (__pyx_t_27 < 0) {
     __pyx_t_27 += __pyx_v_vit_track1.shape[0];
     if (unlikely(__pyx_t_27 < 0)) __pyx_t_15 = 0;
   } else if (unlikely(__pyx_t_27 >= __pyx_v_vit_track1.shape[0])) __pyx_t_15 = 0;
   if (unlikely(__pyx_t_15 != -1)) {
     __Pyx_RaiseBufferIndexError(__pyx_t_15);
-    __PYX_ERR(0, 892, __pyx_L1_error)
+    __PYX_ERR(0, 949, __pyx_L1_error)
   }
   *((long *) ( /* dim=0 */ (__pyx_v_vit_track1.data + __pyx_t_27 * __pyx_v_vit_track1.strides[0]) )) = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_det1.data + __pyx_t_45 * __pyx_v_det1.strides[0]) ) + __pyx_t_46 * __pyx_v_det1.strides[1]) )));
 
-  /* "soapcw/soapcw.pyx":893
+  /* "soapcw/soapcw.pyx":950
  *         vit_trackr[length-1] = max_prob_index
  *         vit_track1[length-1] = det1[length-1][max_prob_index]
  *         vit_track2[length-1] = det2[length-1][max_prob_index]             # <<<<<<<<<<<<<<
  *         vit_track3[length-1] = det3[length-1][max_prob_index]
  *         previous = prev[length-1][max_prob_index]
  */
   __pyx_t_46 = (__pyx_v_length - 1);
@@ -18959,29 +19297,29 @@
   } else if (unlikely(__pyx_t_46 >= __pyx_v_det2.shape[0])) __pyx_t_15 = 0;
   if (__pyx_t_45 < 0) {
     __pyx_t_45 += __pyx_v_det2.shape[1];
     if (unlikely(__pyx_t_45 < 0)) __pyx_t_15 = 1;
   } else if (unlikely(__pyx_t_45 >= __pyx_v_det2.shape[1])) __pyx_t_15 = 1;
   if (unlikely(__pyx_t_15 != -1)) {
     __Pyx_RaiseBufferIndexError(__pyx_t_15);
-    __PYX_ERR(0, 893, __pyx_L1_error)
+    __PYX_ERR(0, 950, __pyx_L1_error)
   }
   __pyx_t_27 = (__pyx_v_length - 1);
   __pyx_t_15 = -1;
   if (__pyx_t_27 < 0) {
     __pyx_t_27 += __pyx_v_vit_track2.shape[0];
     if (unlikely(__pyx_t_27 < 0)) __pyx_t_15 = 0;
   } else if (unlikely(__pyx_t_27 >= __pyx_v_vit_track2.shape[0])) __pyx_t_15 = 0;
   if (unlikely(__pyx_t_15 != -1)) {
     __Pyx_RaiseBufferIndexError(__pyx_t_15);
-    __PYX_ERR(0, 893, __pyx_L1_error)
+    __PYX_ERR(0, 950, __pyx_L1_error)
   }
   *((long *) ( /* dim=0 */ (__pyx_v_vit_track2.data + __pyx_t_27 * __pyx_v_vit_track2.strides[0]) )) = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_det2.data + __pyx_t_46 * __pyx_v_det2.strides[0]) ) + __pyx_t_45 * __pyx_v_det2.strides[1]) )));
 
-  /* "soapcw/soapcw.pyx":894
+  /* "soapcw/soapcw.pyx":951
  *         vit_track1[length-1] = det1[length-1][max_prob_index]
  *         vit_track2[length-1] = det2[length-1][max_prob_index]
  *         vit_track3[length-1] = det3[length-1][max_prob_index]             # <<<<<<<<<<<<<<
  *         previous = prev[length-1][max_prob_index]
  * 
  */
   __pyx_t_45 = (__pyx_v_length - 1);
@@ -18993,29 +19331,29 @@
   } else if (unlikely(__pyx_t_45 >= __pyx_v_det3.shape[0])) __pyx_t_15 = 0;
   if (__pyx_t_46 < 0) {
     __pyx_t_46 += __pyx_v_det3.shape[1];
     if (unlikely(__pyx_t_46 < 0)) __pyx_t_15 = 1;
   } else if (unlikely(__pyx_t_46 >= __pyx_v_det3.shape[1])) __pyx_t_15 = 1;
   if (unlikely(__pyx_t_15 != -1)) {
     __Pyx_RaiseBufferIndexError(__pyx_t_15);
-    __PYX_ERR(0, 894, __pyx_L1_error)
+    __PYX_ERR(0, 951, __pyx_L1_error)
   }
   __pyx_t_27 = (__pyx_v_length - 1);
   __pyx_t_15 = -1;
   if (__pyx_t_27 < 0) {
     __pyx_t_27 += __pyx_v_vit_track3.shape[0];
     if (unlikely(__pyx_t_27 < 0)) __pyx_t_15 = 0;
   } else if (unlikely(__pyx_t_27 >= __pyx_v_vit_track3.shape[0])) __pyx_t_15 = 0;
   if (unlikely(__pyx_t_15 != -1)) {
     __Pyx_RaiseBufferIndexError(__pyx_t_15);
-    __PYX_ERR(0, 894, __pyx_L1_error)
+    __PYX_ERR(0, 951, __pyx_L1_error)
   }
   *((long *) ( /* dim=0 */ (__pyx_v_vit_track3.data + __pyx_t_27 * __pyx_v_vit_track3.strides[0]) )) = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_det3.data + __pyx_t_45 * __pyx_v_det3.strides[0]) ) + __pyx_t_46 * __pyx_v_det3.strides[1]) )));
 
-  /* "soapcw/soapcw.pyx":895
+  /* "soapcw/soapcw.pyx":952
  *         vit_track2[length-1] = det2[length-1][max_prob_index]
  *         vit_track3[length-1] = det3[length-1][max_prob_index]
  *         previous = prev[length-1][max_prob_index]             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __pyx_t_46 = (__pyx_v_length - 1);
@@ -19027,48 +19365,48 @@
   } else if (unlikely(__pyx_t_46 >= __pyx_v_prev.shape[0])) __pyx_t_15 = 0;
   if (__pyx_t_45 < 0) {
     __pyx_t_45 += __pyx_v_prev.shape[1];
     if (unlikely(__pyx_t_45 < 0)) __pyx_t_15 = 1;
   } else if (unlikely(__pyx_t_45 >= __pyx_v_prev.shape[1])) __pyx_t_15 = 1;
   if (unlikely(__pyx_t_15 != -1)) {
     __Pyx_RaiseBufferIndexError(__pyx_t_15);
-    __PYX_ERR(0, 895, __pyx_L1_error)
+    __PYX_ERR(0, 952, __pyx_L1_error)
   }
   __pyx_v_previous = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_prev.data + __pyx_t_46 * __pyx_v_prev.strides[0]) ) + __pyx_t_45 * __pyx_v_prev.strides[1]) )));
 
-  /* "soapcw/soapcw.pyx":898
+  /* "soapcw/soapcw.pyx":955
  * 
  * 
  *         for t in range(length-2,-1,-1):             # <<<<<<<<<<<<<<
  *             vit_trackr[t] = previous # insert previous step
  *             vit_track1[t] = det1[t][previous]
  */
   for (__pyx_t_15 = (__pyx_v_length - 2); __pyx_t_15 > -1; __pyx_t_15-=1) {
     __pyx_v_t = __pyx_t_15;
 
-    /* "soapcw/soapcw.pyx":899
+    /* "soapcw/soapcw.pyx":956
  * 
  *         for t in range(length-2,-1,-1):
  *             vit_trackr[t] = previous # insert previous step             # <<<<<<<<<<<<<<
  *             vit_track1[t] = det1[t][previous]
  *             vit_track2[t] = det2[t][previous]
  */
     __pyx_t_45 = __pyx_v_t;
     __pyx_t_16 = -1;
     if (__pyx_t_45 < 0) {
       __pyx_t_45 += __pyx_v_vit_trackr.shape[0];
       if (unlikely(__pyx_t_45 < 0)) __pyx_t_16 = 0;
     } else if (unlikely(__pyx_t_45 >= __pyx_v_vit_trackr.shape[0])) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 899, __pyx_L1_error)
+      __PYX_ERR(0, 956, __pyx_L1_error)
     }
     *((long *) ( /* dim=0 */ (__pyx_v_vit_trackr.data + __pyx_t_45 * __pyx_v_vit_trackr.strides[0]) )) = __pyx_v_previous;
 
-    /* "soapcw/soapcw.pyx":900
+    /* "soapcw/soapcw.pyx":957
  *         for t in range(length-2,-1,-1):
  *             vit_trackr[t] = previous # insert previous step
  *             vit_track1[t] = det1[t][previous]             # <<<<<<<<<<<<<<
  *             vit_track2[t] = det2[t][previous]
  *             vit_track3[t] = det3[t][previous]
  */
     __pyx_t_45 = __pyx_v_t;
@@ -19080,29 +19418,29 @@
     } else if (unlikely(__pyx_t_45 >= __pyx_v_det1.shape[0])) __pyx_t_16 = 0;
     if (__pyx_t_46 < 0) {
       __pyx_t_46 += __pyx_v_det1.shape[1];
       if (unlikely(__pyx_t_46 < 0)) __pyx_t_16 = 1;
     } else if (unlikely(__pyx_t_46 >= __pyx_v_det1.shape[1])) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 900, __pyx_L1_error)
+      __PYX_ERR(0, 957, __pyx_L1_error)
     }
     __pyx_t_27 = __pyx_v_t;
     __pyx_t_16 = -1;
     if (__pyx_t_27 < 0) {
       __pyx_t_27 += __pyx_v_vit_track1.shape[0];
       if (unlikely(__pyx_t_27 < 0)) __pyx_t_16 = 0;
     } else if (unlikely(__pyx_t_27 >= __pyx_v_vit_track1.shape[0])) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 900, __pyx_L1_error)
+      __PYX_ERR(0, 957, __pyx_L1_error)
     }
     *((long *) ( /* dim=0 */ (__pyx_v_vit_track1.data + __pyx_t_27 * __pyx_v_vit_track1.strides[0]) )) = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_det1.data + __pyx_t_45 * __pyx_v_det1.strides[0]) ) + __pyx_t_46 * __pyx_v_det1.strides[1]) )));
 
-    /* "soapcw/soapcw.pyx":901
+    /* "soapcw/soapcw.pyx":958
  *             vit_trackr[t] = previous # insert previous step
  *             vit_track1[t] = det1[t][previous]
  *             vit_track2[t] = det2[t][previous]             # <<<<<<<<<<<<<<
  *             vit_track3[t] = det3[t][previous]
  *             previous = prev[t][previous]
  */
     __pyx_t_46 = __pyx_v_t;
@@ -19114,29 +19452,29 @@
     } else if (unlikely(__pyx_t_46 >= __pyx_v_det2.shape[0])) __pyx_t_16 = 0;
     if (__pyx_t_45 < 0) {
       __pyx_t_45 += __pyx_v_det2.shape[1];
       if (unlikely(__pyx_t_45 < 0)) __pyx_t_16 = 1;
     } else if (unlikely(__pyx_t_45 >= __pyx_v_det2.shape[1])) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 901, __pyx_L1_error)
+      __PYX_ERR(0, 958, __pyx_L1_error)
     }
     __pyx_t_27 = __pyx_v_t;
     __pyx_t_16 = -1;
     if (__pyx_t_27 < 0) {
       __pyx_t_27 += __pyx_v_vit_track2.shape[0];
       if (unlikely(__pyx_t_27 < 0)) __pyx_t_16 = 0;
     } else if (unlikely(__pyx_t_27 >= __pyx_v_vit_track2.shape[0])) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 901, __pyx_L1_error)
+      __PYX_ERR(0, 958, __pyx_L1_error)
     }
     *((long *) ( /* dim=0 */ (__pyx_v_vit_track2.data + __pyx_t_27 * __pyx_v_vit_track2.strides[0]) )) = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_det2.data + __pyx_t_46 * __pyx_v_det2.strides[0]) ) + __pyx_t_45 * __pyx_v_det2.strides[1]) )));
 
-    /* "soapcw/soapcw.pyx":902
+    /* "soapcw/soapcw.pyx":959
  *             vit_track1[t] = det1[t][previous]
  *             vit_track2[t] = det2[t][previous]
  *             vit_track3[t] = det3[t][previous]             # <<<<<<<<<<<<<<
  *             previous = prev[t][previous]
  * 
  */
     __pyx_t_45 = __pyx_v_t;
@@ -19148,29 +19486,29 @@
     } else if (unlikely(__pyx_t_45 >= __pyx_v_det3.shape[0])) __pyx_t_16 = 0;
     if (__pyx_t_46 < 0) {
       __pyx_t_46 += __pyx_v_det3.shape[1];
       if (unlikely(__pyx_t_46 < 0)) __pyx_t_16 = 1;
     } else if (unlikely(__pyx_t_46 >= __pyx_v_det3.shape[1])) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 902, __pyx_L1_error)
+      __PYX_ERR(0, 959, __pyx_L1_error)
     }
     __pyx_t_27 = __pyx_v_t;
     __pyx_t_16 = -1;
     if (__pyx_t_27 < 0) {
       __pyx_t_27 += __pyx_v_vit_track3.shape[0];
       if (unlikely(__pyx_t_27 < 0)) __pyx_t_16 = 0;
     } else if (unlikely(__pyx_t_27 >= __pyx_v_vit_track3.shape[0])) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 902, __pyx_L1_error)
+      __PYX_ERR(0, 959, __pyx_L1_error)
     }
     *((long *) ( /* dim=0 */ (__pyx_v_vit_track3.data + __pyx_t_27 * __pyx_v_vit_track3.strides[0]) )) = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_det3.data + __pyx_t_45 * __pyx_v_det3.strides[0]) ) + __pyx_t_46 * __pyx_v_det3.strides[1]) )));
 
-    /* "soapcw/soapcw.pyx":903
+    /* "soapcw/soapcw.pyx":960
  *             vit_track2[t] = det2[t][previous]
  *             vit_track3[t] = det3[t][previous]
  *             previous = prev[t][previous]             # <<<<<<<<<<<<<<
  * 
  *         self.vit_track1    = np.array(vit_track1)
  */
     __pyx_t_46 = __pyx_v_t;
@@ -19182,230 +19520,230 @@
     } else if (unlikely(__pyx_t_46 >= __pyx_v_prev.shape[0])) __pyx_t_16 = 0;
     if (__pyx_t_45 < 0) {
       __pyx_t_45 += __pyx_v_prev.shape[1];
       if (unlikely(__pyx_t_45 < 0)) __pyx_t_16 = 1;
     } else if (unlikely(__pyx_t_45 >= __pyx_v_prev.shape[1])) __pyx_t_16 = 1;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 903, __pyx_L1_error)
+      __PYX_ERR(0, 960, __pyx_L1_error)
     }
     __pyx_v_previous = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_prev.data + __pyx_t_46 * __pyx_v_prev.strides[0]) ) + __pyx_t_45 * __pyx_v_prev.strides[1]) )));
   }
 
-  /* "soapcw/soapcw.pyx":905
+  /* "soapcw/soapcw.pyx":962
  *             previous = prev[t][previous]
  * 
  *         self.vit_track1    = np.array(vit_track1)             # <<<<<<<<<<<<<<
  *         self.vit_track2    = np.array(vit_track2)
  *         self.vit_track3    = np.array(vit_track3)
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 905, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 962, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_array); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 905, __pyx_L1_error)
+  __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_array); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 962, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = __pyx_memoryview_fromslice(__pyx_v_vit_track1, 1, (PyObject *(*)(char *)) __pyx_memview_get_long, (int (*)(char *, PyObject *)) __pyx_memview_set_long, 0);; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 905, __pyx_L1_error)
+  __pyx_t_5 = __pyx_memoryview_fromslice(__pyx_v_vit_track1, 1, (PyObject *(*)(char *)) __pyx_memview_get_long, (int (*)(char *, PyObject *)) __pyx_memview_set_long, 0);; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 962, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __pyx_t_6 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_13))) {
     __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_13);
     if (likely(__pyx_t_6)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_13);
       __Pyx_INCREF(__pyx_t_6);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_13, function);
     }
   }
   __pyx_t_3 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_13, __pyx_t_6, __pyx_t_5) : __Pyx_PyObject_CallOneArg(__pyx_t_13, __pyx_t_5);
   __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 905, __pyx_L1_error)
+  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 962, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_vit_track1, __pyx_t_3) < 0) __PYX_ERR(0, 905, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_vit_track1, __pyx_t_3) < 0) __PYX_ERR(0, 962, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "soapcw/soapcw.pyx":906
+  /* "soapcw/soapcw.pyx":963
  * 
  *         self.vit_track1    = np.array(vit_track1)
  *         self.vit_track2    = np.array(vit_track2)             # <<<<<<<<<<<<<<
  *         self.vit_track3    = np.array(vit_track3)
  *         self.vit_track = np.array(vit_trackr)
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_13, __pyx_n_s_np); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 906, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_13, __pyx_n_s_np); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 963, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_13, __pyx_n_s_array); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 906, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_13, __pyx_n_s_array); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 963, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-  __pyx_t_13 = __pyx_memoryview_fromslice(__pyx_v_vit_track2, 1, (PyObject *(*)(char *)) __pyx_memview_get_long, (int (*)(char *, PyObject *)) __pyx_memview_set_long, 0);; if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 906, __pyx_L1_error)
+  __pyx_t_13 = __pyx_memoryview_fromslice(__pyx_v_vit_track2, 1, (PyObject *(*)(char *)) __pyx_memview_get_long, (int (*)(char *, PyObject *)) __pyx_memview_set_long, 0);; if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 963, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
   __pyx_t_6 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
     __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_5);
     if (likely(__pyx_t_6)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
       __Pyx_INCREF(__pyx_t_6);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_5, function);
     }
   }
   __pyx_t_3 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_6, __pyx_t_13) : __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_13);
   __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 906, __pyx_L1_error)
+  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 963, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_vit_track2, __pyx_t_3) < 0) __PYX_ERR(0, 906, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_vit_track2, __pyx_t_3) < 0) __PYX_ERR(0, 963, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "soapcw/soapcw.pyx":907
+  /* "soapcw/soapcw.pyx":964
  *         self.vit_track1    = np.array(vit_track1)
  *         self.vit_track2    = np.array(vit_track2)
  *         self.vit_track3    = np.array(vit_track3)             # <<<<<<<<<<<<<<
  *         self.vit_track = np.array(vit_trackr)
  *         self.V            = np.array(val)
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 907, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 964, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_array); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 907, __pyx_L1_error)
+  __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_array); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 964, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = __pyx_memoryview_fromslice(__pyx_v_vit_track3, 1, (PyObject *(*)(char *)) __pyx_memview_get_long, (int (*)(char *, PyObject *)) __pyx_memview_set_long, 0);; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 907, __pyx_L1_error)
+  __pyx_t_5 = __pyx_memoryview_fromslice(__pyx_v_vit_track3, 1, (PyObject *(*)(char *)) __pyx_memview_get_long, (int (*)(char *, PyObject *)) __pyx_memview_set_long, 0);; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 964, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __pyx_t_6 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_13))) {
     __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_13);
     if (likely(__pyx_t_6)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_13);
       __Pyx_INCREF(__pyx_t_6);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_13, function);
     }
   }
   __pyx_t_3 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_13, __pyx_t_6, __pyx_t_5) : __Pyx_PyObject_CallOneArg(__pyx_t_13, __pyx_t_5);
   __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 907, __pyx_L1_error)
+  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 964, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_vit_track3, __pyx_t_3) < 0) __PYX_ERR(0, 907, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_vit_track3, __pyx_t_3) < 0) __PYX_ERR(0, 964, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "soapcw/soapcw.pyx":908
+  /* "soapcw/soapcw.pyx":965
  *         self.vit_track2    = np.array(vit_track2)
  *         self.vit_track3    = np.array(vit_track3)
  *         self.vit_track = np.array(vit_trackr)             # <<<<<<<<<<<<<<
  *         self.V            = np.array(val)
  *         self.prev         = np.array(prev)
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_13, __pyx_n_s_np); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 908, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_13, __pyx_n_s_np); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 965, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_13, __pyx_n_s_array); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 908, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_13, __pyx_n_s_array); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 965, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-  __pyx_t_13 = __pyx_memoryview_fromslice(__pyx_v_vit_trackr, 1, (PyObject *(*)(char *)) __pyx_memview_get_long, (int (*)(char *, PyObject *)) __pyx_memview_set_long, 0);; if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 908, __pyx_L1_error)
+  __pyx_t_13 = __pyx_memoryview_fromslice(__pyx_v_vit_trackr, 1, (PyObject *(*)(char *)) __pyx_memview_get_long, (int (*)(char *, PyObject *)) __pyx_memview_set_long, 0);; if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 965, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
   __pyx_t_6 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
     __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_5);
     if (likely(__pyx_t_6)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
       __Pyx_INCREF(__pyx_t_6);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_5, function);
     }
   }
   __pyx_t_3 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_6, __pyx_t_13) : __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_13);
   __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 908, __pyx_L1_error)
+  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 965, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_vit_track, __pyx_t_3) < 0) __PYX_ERR(0, 908, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_vit_track, __pyx_t_3) < 0) __PYX_ERR(0, 965, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "soapcw/soapcw.pyx":909
+  /* "soapcw/soapcw.pyx":966
  *         self.vit_track3    = np.array(vit_track3)
  *         self.vit_track = np.array(vit_trackr)
  *         self.V            = np.array(val)             # <<<<<<<<<<<<<<
  *         self.prev         = np.array(prev)
  *         self.max_end_prob = max_prob
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 909, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 966, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_array); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 909, __pyx_L1_error)
+  __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_array); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 966, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = __pyx_memoryview_fromslice(__pyx_v_val, 2, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 909, __pyx_L1_error)
+  __pyx_t_5 = __pyx_memoryview_fromslice(__pyx_v_val, 2, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 966, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __pyx_t_6 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_13))) {
     __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_13);
     if (likely(__pyx_t_6)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_13);
       __Pyx_INCREF(__pyx_t_6);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_13, function);
     }
   }
   __pyx_t_3 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_13, __pyx_t_6, __pyx_t_5) : __Pyx_PyObject_CallOneArg(__pyx_t_13, __pyx_t_5);
   __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 909, __pyx_L1_error)
+  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 966, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_V, __pyx_t_3) < 0) __PYX_ERR(0, 909, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_V, __pyx_t_3) < 0) __PYX_ERR(0, 966, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "soapcw/soapcw.pyx":910
+  /* "soapcw/soapcw.pyx":967
  *         self.vit_track = np.array(vit_trackr)
  *         self.V            = np.array(val)
  *         self.prev         = np.array(prev)             # <<<<<<<<<<<<<<
  *         self.max_end_prob = max_prob
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_13, __pyx_n_s_np); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 910, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_13, __pyx_n_s_np); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 967, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_13, __pyx_n_s_array); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 910, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_13, __pyx_n_s_array); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 967, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-  __pyx_t_13 = __pyx_memoryview_fromslice(__pyx_v_prev, 2, (PyObject *(*)(char *)) __pyx_memview_get_int, (int (*)(char *, PyObject *)) __pyx_memview_set_int, 0);; if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 910, __pyx_L1_error)
+  __pyx_t_13 = __pyx_memoryview_fromslice(__pyx_v_prev, 2, (PyObject *(*)(char *)) __pyx_memview_get_int, (int (*)(char *, PyObject *)) __pyx_memview_set_int, 0);; if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 967, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_13);
   __pyx_t_6 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
     __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_5);
     if (likely(__pyx_t_6)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
       __Pyx_INCREF(__pyx_t_6);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_5, function);
     }
   }
   __pyx_t_3 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_6, __pyx_t_13) : __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_13);
   __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 910, __pyx_L1_error)
+  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 967, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_prev, __pyx_t_3) < 0) __PYX_ERR(0, 910, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_prev, __pyx_t_3) < 0) __PYX_ERR(0, 967, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "soapcw/soapcw.pyx":911
+  /* "soapcw/soapcw.pyx":968
  *         self.V            = np.array(val)
  *         self.prev         = np.array(prev)
  *         self.max_end_prob = max_prob             # <<<<<<<<<<<<<<
  * 
  *         #return np.array(vit_track1), np.array(vit_track2), np.array(vit_track3), np.array(vit_trackr), np.array(val),np.array(prev), max_prob
  */
-  __pyx_t_3 = PyFloat_FromDouble(__pyx_v_max_prob); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 911, __pyx_L1_error)
+  __pyx_t_3 = PyFloat_FromDouble(__pyx_v_max_prob); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 968, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_max_end_prob, __pyx_t_3) < 0) __PYX_ERR(0, 911, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_max_end_prob, __pyx_t_3) < 0) __PYX_ERR(0, 968, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "soapcw/soapcw.pyx":760
+  /* "soapcw/soapcw.pyx":817
  *     #--------------------------------------------------------
  * 
  *     def run(self,tr1, obs11, obs21, obs31):             # <<<<<<<<<<<<<<
  *         """
  *         viterbi algorithm for multiple detectors 2 at the moment
  */
 
@@ -19444,15 +19782,15 @@
   __PYX_XDEC_MEMVIEW(&__pyx_v_vit_track2, 1);
   __PYX_XDEC_MEMVIEW(&__pyx_v_vit_track3, 1);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "soapcw/soapcw.pyx":917
+/* "soapcw/soapcw.pyx":974
  * class single_detector_mem_n(object):
  * 
  *     def __init__(self, tr, obs, prog = False):             # <<<<<<<<<<<<<<
  *         '''
  * 
  */
 
@@ -19495,31 +19833,31 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_tr)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__init__", 0, 3, 4, 1); __PYX_ERR(0, 917, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__init__", 0, 3, 4, 1); __PYX_ERR(0, 974, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_obs)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__init__", 0, 3, 4, 2); __PYX_ERR(0, 917, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__init__", 0, 3, 4, 2); __PYX_ERR(0, 974, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_prog);
           if (value) { values[3] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) __PYX_ERR(0, 917, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) __PYX_ERR(0, 974, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
         CYTHON_FALLTHROUGH;
         case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
         values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
@@ -19531,15 +19869,15 @@
     __pyx_v_self = values[0];
     __pyx_v_tr = values[1];
     __pyx_v_obs = values[2];
     __pyx_v_prog = values[3];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__init__", 0, 3, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 917, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("__init__", 0, 3, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 974, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("soapcw.soapcw.single_detector_mem_n.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6soapcw_6soapcw_21single_detector_mem_n___init__(__pyx_self, __pyx_v_self, __pyx_v_tr, __pyx_v_obs, __pyx_v_prog);
 
@@ -19557,31 +19895,31 @@
   int __pyx_t_4;
   PyObject *__pyx_t_5 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__init__", 0);
 
-  /* "soapcw/soapcw.pyx":924
+  /* "soapcw/soapcw.pyx":981
  *         initialising viterbi class
  *         '''
  *         self.prog = prog             # <<<<<<<<<<<<<<
  *         self.tracks = self.run(tr, obs)
  * 
  */
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_prog, __pyx_v_prog) < 0) __PYX_ERR(0, 924, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_prog, __pyx_v_prog) < 0) __PYX_ERR(0, 981, __pyx_L1_error)
 
-  /* "soapcw/soapcw.pyx":925
+  /* "soapcw/soapcw.pyx":982
  *         '''
  *         self.prog = prog
  *         self.tracks = self.run(tr, obs)             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_run); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 925, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_run); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 982, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_3 = NULL;
   __pyx_t_4 = 0;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
     __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
     if (likely(__pyx_t_3)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
@@ -19590,48 +19928,48 @@
       __Pyx_DECREF_SET(__pyx_t_2, function);
       __pyx_t_4 = 1;
     }
   }
   #if CYTHON_FAST_PYCALL
   if (PyFunction_Check(__pyx_t_2)) {
     PyObject *__pyx_temp[3] = {__pyx_t_3, __pyx_v_tr, __pyx_v_obs};
-    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 925, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 982, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_GOTREF(__pyx_t_1);
   } else
   #endif
   #if CYTHON_FAST_PYCCALL
   if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
     PyObject *__pyx_temp[3] = {__pyx_t_3, __pyx_v_tr, __pyx_v_obs};
-    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 925, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 982, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_GOTREF(__pyx_t_1);
   } else
   #endif
   {
-    __pyx_t_5 = PyTuple_New(2+__pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 925, __pyx_L1_error)
+    __pyx_t_5 = PyTuple_New(2+__pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 982, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     if (__pyx_t_3) {
       __Pyx_GIVEREF(__pyx_t_3); PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_3); __pyx_t_3 = NULL;
     }
     __Pyx_INCREF(__pyx_v_tr);
     __Pyx_GIVEREF(__pyx_v_tr);
     PyTuple_SET_ITEM(__pyx_t_5, 0+__pyx_t_4, __pyx_v_tr);
     __Pyx_INCREF(__pyx_v_obs);
     __Pyx_GIVEREF(__pyx_v_obs);
     PyTuple_SET_ITEM(__pyx_t_5, 1+__pyx_t_4, __pyx_v_obs);
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_5, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 925, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_5, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 982, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   }
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_tracks, __pyx_t_1) < 0) __PYX_ERR(0, 925, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_tracks, __pyx_t_1) < 0) __PYX_ERR(0, 982, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "soapcw/soapcw.pyx":917
+  /* "soapcw/soapcw.pyx":974
  * class single_detector_mem_n(object):
  * 
  *     def __init__(self, tr, obs, prog = False):             # <<<<<<<<<<<<<<
  *         '''
  * 
  */
 
@@ -19647,15 +19985,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "soapcw/soapcw.pyx":932
+/* "soapcw/soapcw.pyx":989
  *     #------------------------------------------------------------------------
  * 
  *     def run(self, tr, obs):             # <<<<<<<<<<<<<<
  *         ''' Run viterbi algroithm with memory of n
  *         the amount of memory is determined by the transition matrix
  */
 
@@ -19694,40 +20032,40 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_tr)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("run", 1, 3, 3, 1); __PYX_ERR(0, 932, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("run", 1, 3, 3, 1); __PYX_ERR(0, 989, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_obs)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("run", 1, 3, 3, 2); __PYX_ERR(0, 932, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("run", 1, 3, 3, 2); __PYX_ERR(0, 989, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "run") < 0)) __PYX_ERR(0, 932, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "run") < 0)) __PYX_ERR(0, 989, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
     }
     __pyx_v_self = values[0];
     __pyx_v_tr = values[1];
     __pyx_v_obs = values[2];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("run", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 932, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("run", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 989, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("soapcw.soapcw.single_detector_mem_n.run", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6soapcw_6soapcw_21single_detector_mem_n_2run(__pyx_self, __pyx_v_self, __pyx_v_tr, __pyx_v_obs);
 
@@ -19793,971 +20131,971 @@
   int __pyx_t_23;
   double __pyx_t_24;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("run", 0);
 
-  /* "soapcw/soapcw.pyx":952
+  /* "soapcw/soapcw.pyx":1009
  *         '''
  * 
  *         if len(np.shape(tr))<=1:             # <<<<<<<<<<<<<<
  *             raise Exception("ERROR: Please use a transition matrix with dimensions larger than one")
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 952, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1009, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_shape); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 952, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_shape); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1009, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_t_2 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
     __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
     if (likely(__pyx_t_2)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
       __Pyx_INCREF(__pyx_t_2);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_3, function);
     }
   }
   __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_2, __pyx_v_tr) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_tr);
   __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 952, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1009, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_4 = PyObject_Length(__pyx_t_1); if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 952, __pyx_L1_error)
+  __pyx_t_4 = PyObject_Length(__pyx_t_1); if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1009, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_t_5 = ((__pyx_t_4 <= 1) != 0);
   if (unlikely(__pyx_t_5)) {
 
-    /* "soapcw/soapcw.pyx":953
+    /* "soapcw/soapcw.pyx":1010
  * 
  *         if len(np.shape(tr))<=1:
  *             raise Exception("ERROR: Please use a transition matrix with dimensions larger than one")             # <<<<<<<<<<<<<<
  * 
  *         #np.insert(obs,0,-1e6,axis=1)
  */
-    __pyx_t_1 = __Pyx_PyObject_Call(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])), __pyx_tuple__7, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 953, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Call(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])), __pyx_tuple__7, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1010, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 953, __pyx_L1_error)
+    __PYX_ERR(0, 1010, __pyx_L1_error)
 
-    /* "soapcw/soapcw.pyx":952
+    /* "soapcw/soapcw.pyx":1009
  *         '''
  * 
  *         if len(np.shape(tr))<=1:             # <<<<<<<<<<<<<<
  *             raise Exception("ERROR: Please use a transition matrix with dimensions larger than one")
  * 
  */
   }
 
-  /* "soapcw/soapcw.pyx":961
+  /* "soapcw/soapcw.pyx":1018
  *         #cdef double[:, :] obs = obs1
  * 
  *         range_tr = np.arange(len(tr))             # <<<<<<<<<<<<<<
  *         cdef int n = len(tr)
  *         shape = np.shape(tr)
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 961, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1018, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_arange); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 961, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_arange); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1018, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_4 = PyObject_Length(__pyx_v_tr); if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 961, __pyx_L1_error)
-  __pyx_t_3 = PyInt_FromSsize_t(__pyx_t_4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 961, __pyx_L1_error)
+  __pyx_t_4 = PyObject_Length(__pyx_v_tr); if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1018, __pyx_L1_error)
+  __pyx_t_3 = PyInt_FromSsize_t(__pyx_t_4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1018, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __pyx_t_6 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
     __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_2);
     if (likely(__pyx_t_6)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
       __Pyx_INCREF(__pyx_t_6);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_2, function);
     }
   }
   __pyx_t_1 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_6, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3);
   __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 961, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1018, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_v_range_tr = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "soapcw/soapcw.pyx":962
+  /* "soapcw/soapcw.pyx":1019
  * 
  *         range_tr = np.arange(len(tr))
  *         cdef int n = len(tr)             # <<<<<<<<<<<<<<
  *         shape = np.shape(tr)
  *         cdef int length = len(shape)
  */
-  __pyx_t_4 = PyObject_Length(__pyx_v_tr); if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 962, __pyx_L1_error)
+  __pyx_t_4 = PyObject_Length(__pyx_v_tr); if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1019, __pyx_L1_error)
   __pyx_v_n = __pyx_t_4;
 
-  /* "soapcw/soapcw.pyx":963
+  /* "soapcw/soapcw.pyx":1020
  *         range_tr = np.arange(len(tr))
  *         cdef int n = len(tr)
  *         shape = np.shape(tr)             # <<<<<<<<<<<<<<
  *         cdef int length = len(shape)
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 963, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1020, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_shape); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 963, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_shape); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1020, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_t_2 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
     __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
     if (likely(__pyx_t_2)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
       __Pyx_INCREF(__pyx_t_2);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_3, function);
     }
   }
   __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_2, __pyx_v_tr) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_tr);
   __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 963, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1020, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_v_shape = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "soapcw/soapcw.pyx":964
+  /* "soapcw/soapcw.pyx":1021
  *         cdef int n = len(tr)
  *         shape = np.shape(tr)
  *         cdef int length = len(shape)             # <<<<<<<<<<<<<<
  * 
  *         dimensions = (len(obs),len(obs[0]))
  */
-  __pyx_t_4 = PyObject_Length(__pyx_v_shape); if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 964, __pyx_L1_error)
+  __pyx_t_4 = PyObject_Length(__pyx_v_shape); if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1021, __pyx_L1_error)
   __pyx_v_length = __pyx_t_4;
 
-  /* "soapcw/soapcw.pyx":966
+  /* "soapcw/soapcw.pyx":1023
  *         cdef int length = len(shape)
  * 
  *         dimensions = (len(obs),len(obs[0]))             # <<<<<<<<<<<<<<
  *         dimensions = list(dimensions)
  * 
  */
-  __pyx_t_4 = PyObject_Length(__pyx_v_obs); if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 966, __pyx_L1_error)
-  __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 966, __pyx_L1_error)
+  __pyx_t_4 = PyObject_Length(__pyx_v_obs); if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1023, __pyx_L1_error)
+  __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1023, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_obs, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 966, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_obs, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1023, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = PyObject_Length(__pyx_t_3); if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 966, __pyx_L1_error)
+  __pyx_t_4 = PyObject_Length(__pyx_t_3); if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1023, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = PyInt_FromSsize_t(__pyx_t_4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 966, __pyx_L1_error)
+  __pyx_t_3 = PyInt_FromSsize_t(__pyx_t_4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1023, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 966, __pyx_L1_error)
+  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1023, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_3);
   PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_3);
   __pyx_t_1 = 0;
   __pyx_t_3 = 0;
   __pyx_v_dimensions = __pyx_t_2;
   __pyx_t_2 = 0;
 
-  /* "soapcw/soapcw.pyx":967
+  /* "soapcw/soapcw.pyx":1024
  * 
  *         dimensions = (len(obs),len(obs[0]))
  *         dimensions = list(dimensions)             # <<<<<<<<<<<<<<
  * 
  *         cdef int length_t = dimensions[0]
  */
-  __pyx_t_2 = PySequence_List(__pyx_v_dimensions); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 967, __pyx_L1_error)
+  __pyx_t_2 = PySequence_List(__pyx_v_dimensions); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1024, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF_SET(__pyx_v_dimensions, __pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "soapcw/soapcw.pyx":969
+  /* "soapcw/soapcw.pyx":1026
  *         dimensions = list(dimensions)
  * 
  *         cdef int length_t = dimensions[0]             # <<<<<<<<<<<<<<
  *         cdef int width = dimensions[1]
  * 
  */
-  __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_dimensions, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 969, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_dimensions, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1026, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_7 = __Pyx_PyInt_As_int(__pyx_t_2); if (unlikely((__pyx_t_7 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 969, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyInt_As_int(__pyx_t_2); if (unlikely((__pyx_t_7 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 1026, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_v_length_t = __pyx_t_7;
 
-  /* "soapcw/soapcw.pyx":970
+  /* "soapcw/soapcw.pyx":1027
  * 
  *         cdef int length_t = dimensions[0]
  *         cdef int width = dimensions[1]             # <<<<<<<<<<<<<<
  * 
  *         cdef int i
  */
-  __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_dimensions, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 970, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_dimensions, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1027, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_7 = __Pyx_PyInt_As_int(__pyx_t_2); if (unlikely((__pyx_t_7 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 970, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyInt_As_int(__pyx_t_2); if (unlikely((__pyx_t_7 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 1027, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_v_width = __pyx_t_7;
 
-  /* "soapcw/soapcw.pyx":980
+  /* "soapcw/soapcw.pyx":1037
  *         cdef double temp
  * 
  *         for i in range(len(shape)-1):             # <<<<<<<<<<<<<<
  *             dimensions.append(n)
  * 
  */
-  __pyx_t_4 = PyObject_Length(__pyx_v_shape); if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 980, __pyx_L1_error)
+  __pyx_t_4 = PyObject_Length(__pyx_v_shape); if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1037, __pyx_L1_error)
   __pyx_t_8 = (__pyx_t_4 - 1);
   __pyx_t_4 = __pyx_t_8;
   for (__pyx_t_7 = 0; __pyx_t_7 < __pyx_t_4; __pyx_t_7+=1) {
     __pyx_v_i = __pyx_t_7;
 
-    /* "soapcw/soapcw.pyx":981
+    /* "soapcw/soapcw.pyx":1038
  * 
  *         for i in range(len(shape)-1):
  *             dimensions.append(n)             # <<<<<<<<<<<<<<
  * 
  *         dimensions = tuple(dimensions)
  */
-    __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_n); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 981, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_n); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1038, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_9 = __Pyx_PyObject_Append(__pyx_v_dimensions, __pyx_t_2); if (unlikely(__pyx_t_9 == ((int)-1))) __PYX_ERR(0, 981, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_PyObject_Append(__pyx_v_dimensions, __pyx_t_2); if (unlikely(__pyx_t_9 == ((int)-1))) __PYX_ERR(0, 1038, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   }
 
-  /* "soapcw/soapcw.pyx":983
+  /* "soapcw/soapcw.pyx":1040
  *             dimensions.append(n)
  * 
  *         dimensions = tuple(dimensions)             # <<<<<<<<<<<<<<
  * 
  *         val    = np.ones(dimensions)*-1e6
  */
-  __pyx_t_2 = __Pyx_PySequence_Tuple(__pyx_v_dimensions); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 983, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PySequence_Tuple(__pyx_v_dimensions); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1040, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF_SET(__pyx_v_dimensions, __pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "soapcw/soapcw.pyx":985
+  /* "soapcw/soapcw.pyx":1042
  *         dimensions = tuple(dimensions)
  * 
  *         val    = np.ones(dimensions)*-1e6             # <<<<<<<<<<<<<<
  *         prev   = np.ones(dimensions)
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 985, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1042, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_ones); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 985, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_ones); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1042, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_t_3 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_1))) {
     __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_1);
     if (likely(__pyx_t_3)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
       __Pyx_INCREF(__pyx_t_3);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_1, function);
     }
   }
   __pyx_t_2 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_3, __pyx_v_dimensions) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_v_dimensions);
   __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 985, __pyx_L1_error)
+  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1042, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = PyNumber_Multiply(__pyx_t_2, __pyx_float_neg_1e6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 985, __pyx_L1_error)
+  __pyx_t_1 = PyNumber_Multiply(__pyx_t_2, __pyx_float_neg_1e6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1042, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_v_val = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "soapcw/soapcw.pyx":986
+  /* "soapcw/soapcw.pyx":1043
  * 
  *         val    = np.ones(dimensions)*-1e6
  *         prev   = np.ones(dimensions)             # <<<<<<<<<<<<<<
  * 
  *         range_j = list(itertools.product(range(n),repeat=length-1))
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 986, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1043, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_ones); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 986, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_ones); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1043, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_t_2 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
     __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
     if (likely(__pyx_t_2)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
       __Pyx_INCREF(__pyx_t_2);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_3, function);
     }
   }
   __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_2, __pyx_v_dimensions) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_dimensions);
   __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 986, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1043, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_v_prev = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "soapcw/soapcw.pyx":988
+  /* "soapcw/soapcw.pyx":1045
  *         prev   = np.ones(dimensions)
  * 
  *         range_j = list(itertools.product(range(n),repeat=length-1))             # <<<<<<<<<<<<<<
  * 
  *         for i in range(width):
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_itertools); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 988, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_itertools); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1045, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_product); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 988, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_product); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1045, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_n); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 988, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_n); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1045, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_builtin_range, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 988, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_builtin_range, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1045, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 988, __pyx_L1_error)
+  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1045, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_2);
   PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_2);
   __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 988, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1045, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_6 = __Pyx_PyInt_From_long((__pyx_v_length - 1)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 988, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyInt_From_long((__pyx_v_length - 1)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1045, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_repeat, __pyx_t_6) < 0) __PYX_ERR(0, 988, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_repeat, __pyx_t_6) < 0) __PYX_ERR(0, 1045, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_1, __pyx_t_2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 988, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_1, __pyx_t_2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1045, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = PySequence_List(__pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 988, __pyx_L1_error)
+  __pyx_t_2 = PySequence_List(__pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1045, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_v_range_j = ((PyObject*)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "soapcw/soapcw.pyx":990
+  /* "soapcw/soapcw.pyx":1047
  *         range_j = list(itertools.product(range(n),repeat=length-1))
  * 
  *         for i in range(width):             # <<<<<<<<<<<<<<
  *             for j in range_j:
  *                 val[0][i][j]    = obs[0][i]
  */
   __pyx_t_7 = __pyx_v_width;
   __pyx_t_10 = __pyx_t_7;
   for (__pyx_t_11 = 0; __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
     __pyx_v_i = __pyx_t_11;
 
-    /* "soapcw/soapcw.pyx":991
+    /* "soapcw/soapcw.pyx":1048
  * 
  *         for i in range(width):
  *             for j in range_j:             # <<<<<<<<<<<<<<
  *                 val[0][i][j]    = obs[0][i]
  *                 prev[0][i][j]   = np.nan
  */
     __pyx_t_2 = __pyx_v_range_j; __Pyx_INCREF(__pyx_t_2); __pyx_t_8 = 0;
     for (;;) {
       if (__pyx_t_8 >= PyList_GET_SIZE(__pyx_t_2)) break;
       #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-      __pyx_t_6 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_8); __Pyx_INCREF(__pyx_t_6); __pyx_t_8++; if (unlikely(0 < 0)) __PYX_ERR(0, 991, __pyx_L1_error)
+      __pyx_t_6 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_8); __Pyx_INCREF(__pyx_t_6); __pyx_t_8++; if (unlikely(0 < 0)) __PYX_ERR(0, 1048, __pyx_L1_error)
       #else
-      __pyx_t_6 = PySequence_ITEM(__pyx_t_2, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 991, __pyx_L1_error)
+      __pyx_t_6 = PySequence_ITEM(__pyx_t_2, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1048, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_6);
       #endif
       __Pyx_XDECREF_SET(__pyx_v_j, __pyx_t_6);
       __pyx_t_6 = 0;
 
-      /* "soapcw/soapcw.pyx":992
+      /* "soapcw/soapcw.pyx":1049
  *         for i in range(width):
  *             for j in range_j:
  *                 val[0][i][j]    = obs[0][i]             # <<<<<<<<<<<<<<
  *                 prev[0][i][j]   = np.nan
  * 
  */
-      __pyx_t_6 = __Pyx_GetItemInt(__pyx_v_obs, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 992, __pyx_L1_error)
+      __pyx_t_6 = __Pyx_GetItemInt(__pyx_v_obs, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1049, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_6);
-      __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_6, __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 992, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_6, __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1049, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-      __pyx_t_6 = __Pyx_GetItemInt(__pyx_v_val, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 992, __pyx_L1_error)
+      __pyx_t_6 = __Pyx_GetItemInt(__pyx_v_val, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1049, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_6);
-      __pyx_t_3 = __Pyx_GetItemInt(__pyx_t_6, __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 992, __pyx_L1_error)
+      __pyx_t_3 = __Pyx_GetItemInt(__pyx_t_6, __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1049, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-      if (unlikely(PyObject_SetItem(__pyx_t_3, __pyx_v_j, __pyx_t_1) < 0)) __PYX_ERR(0, 992, __pyx_L1_error)
+      if (unlikely(PyObject_SetItem(__pyx_t_3, __pyx_v_j, __pyx_t_1) < 0)) __PYX_ERR(0, 1049, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-      /* "soapcw/soapcw.pyx":993
+      /* "soapcw/soapcw.pyx":1050
  *             for j in range_j:
  *                 val[0][i][j]    = obs[0][i]
  *                 prev[0][i][j]   = np.nan             # <<<<<<<<<<<<<<
  * 
  *         cdef float pbar = 0
  */
-      __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 993, __pyx_L1_error)
+      __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1050, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
-      __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_nan); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 993, __pyx_L1_error)
+      __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_nan); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1050, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-      __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_prev, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 993, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_prev, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1050, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
-      __pyx_t_6 = __Pyx_GetItemInt(__pyx_t_1, __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 993, __pyx_L1_error)
+      __pyx_t_6 = __Pyx_GetItemInt(__pyx_t_1, __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1050, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_6);
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-      if (unlikely(PyObject_SetItem(__pyx_t_6, __pyx_v_j, __pyx_t_3) < 0)) __PYX_ERR(0, 993, __pyx_L1_error)
+      if (unlikely(PyObject_SetItem(__pyx_t_6, __pyx_v_j, __pyx_t_3) < 0)) __PYX_ERR(0, 1050, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-      /* "soapcw/soapcw.pyx":991
+      /* "soapcw/soapcw.pyx":1048
  * 
  *         for i in range(width):
  *             for j in range_j:             # <<<<<<<<<<<<<<
  *                 val[0][i][j]    = obs[0][i]
  *                 prev[0][i][j]   = np.nan
  */
     }
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   }
 
-  /* "soapcw/soapcw.pyx":995
+  /* "soapcw/soapcw.pyx":1052
  *                 prev[0][i][j]   = np.nan
  * 
  *         cdef float pbar = 0             # <<<<<<<<<<<<<<
  *         for t in range(1,length_t):
  *             obst = obs[t]
  */
   __pyx_v_pbar = 0.0;
 
-  /* "soapcw/soapcw.pyx":996
+  /* "soapcw/soapcw.pyx":1053
  * 
  *         cdef float pbar = 0
  *         for t in range(1,length_t):             # <<<<<<<<<<<<<<
  *             obst = obs[t]
  *             valt = val[t-1]
  */
   __pyx_t_7 = __pyx_v_length_t;
   __pyx_t_10 = __pyx_t_7;
   for (__pyx_t_11 = 1; __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
     __pyx_v_t = __pyx_t_11;
 
-    /* "soapcw/soapcw.pyx":997
+    /* "soapcw/soapcw.pyx":1054
  *         cdef float pbar = 0
  *         for t in range(1,length_t):
  *             obst = obs[t]             # <<<<<<<<<<<<<<
  *             valt = val[t-1]
  *             pt = t/float(length_t)*100.
  */
-    __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_obs, __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 997, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_obs, __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1054, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_XDECREF_SET(__pyx_v_obst, __pyx_t_2);
     __pyx_t_2 = 0;
 
-    /* "soapcw/soapcw.pyx":998
+    /* "soapcw/soapcw.pyx":1055
  *         for t in range(1,length_t):
  *             obst = obs[t]
  *             valt = val[t-1]             # <<<<<<<<<<<<<<
  *             pt = t/float(length_t)*100.
  *             for i in range(width):
  */
     __pyx_t_12 = (__pyx_v_t - 1);
-    __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_val, __pyx_t_12, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 998, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_val, __pyx_t_12, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1055, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_XDECREF_SET(__pyx_v_valt, __pyx_t_2);
     __pyx_t_2 = 0;
 
-    /* "soapcw/soapcw.pyx":999
+    /* "soapcw/soapcw.pyx":1056
  *             obst = obs[t]
  *             valt = val[t-1]
  *             pt = t/float(length_t)*100.             # <<<<<<<<<<<<<<
  *             for i in range(width):
  *                 for j in range_j:
  */
     if (unlikely(((double)__pyx_v_length_t) == 0)) {
       PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-      __PYX_ERR(0, 999, __pyx_L1_error)
+      __PYX_ERR(0, 1056, __pyx_L1_error)
     }
     __pyx_v_pt = ((((double)__pyx_v_t) / ((double)__pyx_v_length_t)) * 100.);
 
-    /* "soapcw/soapcw.pyx":1000
+    /* "soapcw/soapcw.pyx":1057
  *             valt = val[t-1]
  *             pt = t/float(length_t)*100.
  *             for i in range(width):             # <<<<<<<<<<<<<<
  *                 for j in range_j:
  *                     cond = True
  */
     __pyx_t_13 = __pyx_v_width;
     __pyx_t_14 = __pyx_t_13;
     for (__pyx_t_15 = 0; __pyx_t_15 < __pyx_t_14; __pyx_t_15+=1) {
       __pyx_v_i = __pyx_t_15;
 
-      /* "soapcw/soapcw.pyx":1001
+      /* "soapcw/soapcw.pyx":1058
  *             pt = t/float(length_t)*100.
  *             for i in range(width):
  *                 for j in range_j:             # <<<<<<<<<<<<<<
  *                     cond = True
  *                     for c in range(1,len(j)+1):
  */
       __pyx_t_2 = __pyx_v_range_j; __Pyx_INCREF(__pyx_t_2); __pyx_t_8 = 0;
       for (;;) {
         if (__pyx_t_8 >= PyList_GET_SIZE(__pyx_t_2)) break;
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_3 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_8); __Pyx_INCREF(__pyx_t_3); __pyx_t_8++; if (unlikely(0 < 0)) __PYX_ERR(0, 1001, __pyx_L1_error)
+        __pyx_t_3 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_8); __Pyx_INCREF(__pyx_t_3); __pyx_t_8++; if (unlikely(0 < 0)) __PYX_ERR(0, 1058, __pyx_L1_error)
         #else
-        __pyx_t_3 = PySequence_ITEM(__pyx_t_2, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1001, __pyx_L1_error)
+        __pyx_t_3 = PySequence_ITEM(__pyx_t_2, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1058, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
         #endif
         __Pyx_XDECREF_SET(__pyx_v_j, __pyx_t_3);
         __pyx_t_3 = 0;
 
-        /* "soapcw/soapcw.pyx":1002
+        /* "soapcw/soapcw.pyx":1059
  *             for i in range(width):
  *                 for j in range_j:
  *                     cond = True             # <<<<<<<<<<<<<<
  *                     for c in range(1,len(j)+1):
  *                         b = i+np.sum(j[:c])-len(j[:c])
  */
         __pyx_v_cond = 1;
 
-        /* "soapcw/soapcw.pyx":1003
+        /* "soapcw/soapcw.pyx":1060
  *                 for j in range_j:
  *                     cond = True
  *                     for c in range(1,len(j)+1):             # <<<<<<<<<<<<<<
  *                         b = i+np.sum(j[:c])-len(j[:c])
  *                         if b >= 0 and b<width:
  */
-        __pyx_t_4 = PyObject_Length(__pyx_v_j); if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1003, __pyx_L1_error)
+        __pyx_t_4 = PyObject_Length(__pyx_v_j); if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1060, __pyx_L1_error)
         __pyx_t_16 = (__pyx_t_4 + 1);
         __pyx_t_4 = __pyx_t_16;
         for (__pyx_t_17 = 1; __pyx_t_17 < __pyx_t_4; __pyx_t_17+=1) {
           __pyx_v_c = __pyx_t_17;
 
-          /* "soapcw/soapcw.pyx":1004
+          /* "soapcw/soapcw.pyx":1061
  *                     cond = True
  *                     for c in range(1,len(j)+1):
  *                         b = i+np.sum(j[:c])-len(j[:c])             # <<<<<<<<<<<<<<
  *                         if b >= 0 and b<width:
  *                             continue
  */
-          __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_i); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1004, __pyx_L1_error)
+          __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_i); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1061, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_3);
-          __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1004, __pyx_L1_error)
+          __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1061, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_1);
-          __pyx_t_18 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_sum); if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 1004, __pyx_L1_error)
+          __pyx_t_18 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_sum); if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 1061, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_18);
           __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-          __pyx_t_1 = __Pyx_PyObject_GetSlice(__pyx_v_j, 0, __pyx_v_c, NULL, NULL, NULL, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1004, __pyx_L1_error)
+          __pyx_t_1 = __Pyx_PyObject_GetSlice(__pyx_v_j, 0, __pyx_v_c, NULL, NULL, NULL, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1061, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_1);
           __pyx_t_19 = NULL;
           if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_18))) {
             __pyx_t_19 = PyMethod_GET_SELF(__pyx_t_18);
             if (likely(__pyx_t_19)) {
               PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_18);
               __Pyx_INCREF(__pyx_t_19);
               __Pyx_INCREF(function);
               __Pyx_DECREF_SET(__pyx_t_18, function);
             }
           }
           __pyx_t_6 = (__pyx_t_19) ? __Pyx_PyObject_Call2Args(__pyx_t_18, __pyx_t_19, __pyx_t_1) : __Pyx_PyObject_CallOneArg(__pyx_t_18, __pyx_t_1);
           __Pyx_XDECREF(__pyx_t_19); __pyx_t_19 = 0;
           __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-          if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1004, __pyx_L1_error)
+          if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1061, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
           __Pyx_DECREF(__pyx_t_18); __pyx_t_18 = 0;
-          __pyx_t_18 = PyNumber_Add(__pyx_t_3, __pyx_t_6); if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 1004, __pyx_L1_error)
+          __pyx_t_18 = PyNumber_Add(__pyx_t_3, __pyx_t_6); if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 1061, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_18);
           __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-          __pyx_t_6 = __Pyx_PyObject_GetSlice(__pyx_v_j, 0, __pyx_v_c, NULL, NULL, NULL, 0, 1, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1004, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyObject_GetSlice(__pyx_v_j, 0, __pyx_v_c, NULL, NULL, NULL, 0, 1, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1061, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_20 = PyObject_Length(__pyx_t_6); if (unlikely(__pyx_t_20 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1004, __pyx_L1_error)
+          __pyx_t_20 = PyObject_Length(__pyx_t_6); if (unlikely(__pyx_t_20 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1061, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-          __pyx_t_6 = PyInt_FromSsize_t(__pyx_t_20); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1004, __pyx_L1_error)
+          __pyx_t_6 = PyInt_FromSsize_t(__pyx_t_20); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1061, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __pyx_t_3 = PyNumber_Subtract(__pyx_t_18, __pyx_t_6); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1004, __pyx_L1_error)
+          __pyx_t_3 = PyNumber_Subtract(__pyx_t_18, __pyx_t_6); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1061, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_3);
           __Pyx_DECREF(__pyx_t_18); __pyx_t_18 = 0;
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __Pyx_XDECREF_SET(__pyx_v_b, __pyx_t_3);
           __pyx_t_3 = 0;
 
-          /* "soapcw/soapcw.pyx":1005
+          /* "soapcw/soapcw.pyx":1062
  *                     for c in range(1,len(j)+1):
  *                         b = i+np.sum(j[:c])-len(j[:c])
  *                         if b >= 0 and b<width:             # <<<<<<<<<<<<<<
  *                             continue
  *                         else:
  */
-          __pyx_t_3 = PyObject_RichCompare(__pyx_v_b, __pyx_int_0, Py_GE); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1005, __pyx_L1_error)
-          __pyx_t_21 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_21 < 0)) __PYX_ERR(0, 1005, __pyx_L1_error)
+          __pyx_t_3 = PyObject_RichCompare(__pyx_v_b, __pyx_int_0, Py_GE); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1062, __pyx_L1_error)
+          __pyx_t_21 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_21 < 0)) __PYX_ERR(0, 1062, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
           if (__pyx_t_21) {
           } else {
             __pyx_t_5 = __pyx_t_21;
             goto __pyx_L19_bool_binop_done;
           }
-          __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_width); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1005, __pyx_L1_error)
+          __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_width); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1062, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_3);
-          __pyx_t_6 = PyObject_RichCompare(__pyx_v_b, __pyx_t_3, Py_LT); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1005, __pyx_L1_error)
+          __pyx_t_6 = PyObject_RichCompare(__pyx_v_b, __pyx_t_3, Py_LT); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1062, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-          __pyx_t_21 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_21 < 0)) __PYX_ERR(0, 1005, __pyx_L1_error)
+          __pyx_t_21 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_21 < 0)) __PYX_ERR(0, 1062, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_t_5 = __pyx_t_21;
           __pyx_L19_bool_binop_done:;
           if (__pyx_t_5) {
 
-            /* "soapcw/soapcw.pyx":1006
+            /* "soapcw/soapcw.pyx":1063
  *                         b = i+np.sum(j[:c])-len(j[:c])
  *                         if b >= 0 and b<width:
  *                             continue             # <<<<<<<<<<<<<<
  *                         else:
  *                             cond = False
  */
             goto __pyx_L16_continue;
 
-            /* "soapcw/soapcw.pyx":1005
+            /* "soapcw/soapcw.pyx":1062
  *                     for c in range(1,len(j)+1):
  *                         b = i+np.sum(j[:c])-len(j[:c])
  *                         if b >= 0 and b<width:             # <<<<<<<<<<<<<<
  *                             continue
  *                         else:
  */
           }
 
-          /* "soapcw/soapcw.pyx":1008
+          /* "soapcw/soapcw.pyx":1065
  *                             continue
  *                         else:
  *                             cond = False             # <<<<<<<<<<<<<<
  *                             break
  *                     if cond:
  */
           /*else*/ {
             __pyx_v_cond = 0;
 
-            /* "soapcw/soapcw.pyx":1009
+            /* "soapcw/soapcw.pyx":1066
  *                         else:
  *                             cond = False
  *                             break             # <<<<<<<<<<<<<<
  *                     if cond:
  *                         temp = -1e6
  */
             goto __pyx_L17_break;
           }
           __pyx_L16_continue:;
         }
         __pyx_L17_break:;
 
-        /* "soapcw/soapcw.pyx":1010
+        /* "soapcw/soapcw.pyx":1067
  *                             cond = False
  *                             break
  *                     if cond:             # <<<<<<<<<<<<<<
  *                         temp = -1e6
  *                         for k in range(n):
  */
         __pyx_t_5 = (__pyx_v_cond != 0);
         if (__pyx_t_5) {
 
-          /* "soapcw/soapcw.pyx":1011
+          /* "soapcw/soapcw.pyx":1068
  *                             break
  *                     if cond:
  *                         temp = -1e6             # <<<<<<<<<<<<<<
  *                         for k in range(n):
  *                             m = list(j[1:])
  */
           __pyx_v_temp = -1e6;
 
-          /* "soapcw/soapcw.pyx":1012
+          /* "soapcw/soapcw.pyx":1069
  *                     if cond:
  *                         temp = -1e6
  *                         for k in range(n):             # <<<<<<<<<<<<<<
  *                             m = list(j[1:])
  *                             m.append(k)
  */
           __pyx_t_17 = __pyx_v_n;
           __pyx_t_22 = __pyx_t_17;
           for (__pyx_t_23 = 0; __pyx_t_23 < __pyx_t_22; __pyx_t_23+=1) {
             __pyx_v_k = __pyx_t_23;
 
-            /* "soapcw/soapcw.pyx":1013
+            /* "soapcw/soapcw.pyx":1070
  *                         temp = -1e6
  *                         for k in range(n):
  *                             m = list(j[1:])             # <<<<<<<<<<<<<<
  *                             m.append(k)
  *                             if t<length:
  */
-            __pyx_t_6 = __Pyx_PyObject_GetSlice(__pyx_v_j, 1, 0, NULL, NULL, &__pyx_slice__8, 1, 0, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1013, __pyx_L1_error)
+            __pyx_t_6 = __Pyx_PyObject_GetSlice(__pyx_v_j, 1, 0, NULL, NULL, &__pyx_slice__8, 1, 0, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1070, __pyx_L1_error)
             __Pyx_GOTREF(__pyx_t_6);
-            __pyx_t_3 = PySequence_List(__pyx_t_6); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1013, __pyx_L1_error)
+            __pyx_t_3 = PySequence_List(__pyx_t_6); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1070, __pyx_L1_error)
             __Pyx_GOTREF(__pyx_t_3);
             __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
             __Pyx_XDECREF_SET(__pyx_v_m, __pyx_t_3);
             __pyx_t_3 = 0;
 
-            /* "soapcw/soapcw.pyx":1014
+            /* "soapcw/soapcw.pyx":1071
  *                         for k in range(n):
  *                             m = list(j[1:])
  *                             m.append(k)             # <<<<<<<<<<<<<<
  *                             if t<length:
  *                                 for n1 in range(len(m)):
  */
-            __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_k); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1014, __pyx_L1_error)
+            __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_k); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1071, __pyx_L1_error)
             __Pyx_GOTREF(__pyx_t_3);
-            __pyx_t_9 = __Pyx_PyObject_Append(__pyx_v_m, __pyx_t_3); if (unlikely(__pyx_t_9 == ((int)-1))) __PYX_ERR(0, 1014, __pyx_L1_error)
+            __pyx_t_9 = __Pyx_PyObject_Append(__pyx_v_m, __pyx_t_3); if (unlikely(__pyx_t_9 == ((int)-1))) __PYX_ERR(0, 1071, __pyx_L1_error)
             __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-            /* "soapcw/soapcw.pyx":1015
+            /* "soapcw/soapcw.pyx":1072
  *                             m = list(j[1:])
  *                             m.append(k)
  *                             if t<length:             # <<<<<<<<<<<<<<
  *                                 for n1 in range(len(m)):
  *                                     if n1>=t-1:
  */
             __pyx_t_5 = ((__pyx_v_t < __pyx_v_length) != 0);
             if (__pyx_t_5) {
 
-              /* "soapcw/soapcw.pyx":1016
+              /* "soapcw/soapcw.pyx":1073
  *                             m.append(k)
  *                             if t<length:
  *                                 for n1 in range(len(m)):             # <<<<<<<<<<<<<<
  *                                     if n1>=t-1:
  *                                         m[n1] = 1
  */
-              __pyx_t_16 = PyObject_Length(__pyx_v_m); if (unlikely(__pyx_t_16 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1016, __pyx_L1_error)
+              __pyx_t_16 = PyObject_Length(__pyx_v_m); if (unlikely(__pyx_t_16 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1073, __pyx_L1_error)
               __pyx_t_4 = __pyx_t_16;
               for (__pyx_t_20 = 0; __pyx_t_20 < __pyx_t_4; __pyx_t_20+=1) {
                 __pyx_v_n1 = __pyx_t_20;
 
-                /* "soapcw/soapcw.pyx":1017
+                /* "soapcw/soapcw.pyx":1074
  *                             if t<length:
  *                                 for n1 in range(len(m)):
  *                                     if n1>=t-1:             # <<<<<<<<<<<<<<
  *                                         m[n1] = 1
  *                             m = tuple(m)
  */
                 __pyx_t_5 = ((__pyx_v_n1 >= (__pyx_v_t - 1)) != 0);
                 if (__pyx_t_5) {
 
-                  /* "soapcw/soapcw.pyx":1018
+                  /* "soapcw/soapcw.pyx":1075
  *                                 for n1 in range(len(m)):
  *                                     if n1>=t-1:
  *                                         m[n1] = 1             # <<<<<<<<<<<<<<
  *                             m = tuple(m)
  *                             value = obst[i] + tr[j[0]][m] + valt[i+j[0]-1][m]
  */
-                  if (unlikely(__Pyx_SetItemInt(__pyx_v_m, __pyx_v_n1, __pyx_int_1, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 1, 1) < 0)) __PYX_ERR(0, 1018, __pyx_L1_error)
+                  if (unlikely(__Pyx_SetItemInt(__pyx_v_m, __pyx_v_n1, __pyx_int_1, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 1, 1) < 0)) __PYX_ERR(0, 1075, __pyx_L1_error)
 
-                  /* "soapcw/soapcw.pyx":1017
+                  /* "soapcw/soapcw.pyx":1074
  *                             if t<length:
  *                                 for n1 in range(len(m)):
  *                                     if n1>=t-1:             # <<<<<<<<<<<<<<
  *                                         m[n1] = 1
  *                             m = tuple(m)
  */
                 }
               }
 
-              /* "soapcw/soapcw.pyx":1015
+              /* "soapcw/soapcw.pyx":1072
  *                             m = list(j[1:])
  *                             m.append(k)
  *                             if t<length:             # <<<<<<<<<<<<<<
  *                                 for n1 in range(len(m)):
  *                                     if n1>=t-1:
  */
             }
 
-            /* "soapcw/soapcw.pyx":1019
+            /* "soapcw/soapcw.pyx":1076
  *                                     if n1>=t-1:
  *                                         m[n1] = 1
  *                             m = tuple(m)             # <<<<<<<<<<<<<<
  *                             value = obst[i] + tr[j[0]][m] + valt[i+j[0]-1][m]
  * 
  */
-            __pyx_t_3 = __Pyx_PySequence_Tuple(__pyx_v_m); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1019, __pyx_L1_error)
+            __pyx_t_3 = __Pyx_PySequence_Tuple(__pyx_v_m); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1076, __pyx_L1_error)
             __Pyx_GOTREF(__pyx_t_3);
             __Pyx_DECREF_SET(__pyx_v_m, __pyx_t_3);
             __pyx_t_3 = 0;
 
-            /* "soapcw/soapcw.pyx":1020
+            /* "soapcw/soapcw.pyx":1077
  *                                         m[n1] = 1
  *                             m = tuple(m)
  *                             value = obst[i] + tr[j[0]][m] + valt[i+j[0]-1][m]             # <<<<<<<<<<<<<<
  * 
  * 
  */
-            __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_obst, __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1020, __pyx_L1_error)
+            __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_obst, __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1077, __pyx_L1_error)
             __Pyx_GOTREF(__pyx_t_3);
-            __pyx_t_6 = __Pyx_GetItemInt(__pyx_v_j, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1020, __pyx_L1_error)
+            __pyx_t_6 = __Pyx_GetItemInt(__pyx_v_j, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1077, __pyx_L1_error)
             __Pyx_GOTREF(__pyx_t_6);
-            __pyx_t_18 = __Pyx_PyObject_GetItem(__pyx_v_tr, __pyx_t_6); if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 1020, __pyx_L1_error)
+            __pyx_t_18 = __Pyx_PyObject_GetItem(__pyx_v_tr, __pyx_t_6); if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 1077, __pyx_L1_error)
             __Pyx_GOTREF(__pyx_t_18);
             __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-            __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_t_18, __pyx_v_m); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1020, __pyx_L1_error)
+            __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_t_18, __pyx_v_m); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1077, __pyx_L1_error)
             __Pyx_GOTREF(__pyx_t_6);
             __Pyx_DECREF(__pyx_t_18); __pyx_t_18 = 0;
-            __pyx_t_18 = PyNumber_Add(__pyx_t_3, __pyx_t_6); if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 1020, __pyx_L1_error)
+            __pyx_t_18 = PyNumber_Add(__pyx_t_3, __pyx_t_6); if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 1077, __pyx_L1_error)
             __Pyx_GOTREF(__pyx_t_18);
             __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
             __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-            __pyx_t_6 = __Pyx_PyInt_From_int(__pyx_v_i); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1020, __pyx_L1_error)
+            __pyx_t_6 = __Pyx_PyInt_From_int(__pyx_v_i); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1077, __pyx_L1_error)
             __Pyx_GOTREF(__pyx_t_6);
-            __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_j, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1020, __pyx_L1_error)
+            __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_j, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1077, __pyx_L1_error)
             __Pyx_GOTREF(__pyx_t_3);
-            __pyx_t_1 = PyNumber_Add(__pyx_t_6, __pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1020, __pyx_L1_error)
+            __pyx_t_1 = PyNumber_Add(__pyx_t_6, __pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1077, __pyx_L1_error)
             __Pyx_GOTREF(__pyx_t_1);
             __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
             __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-            __pyx_t_3 = __Pyx_PyInt_SubtractObjC(__pyx_t_1, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1020, __pyx_L1_error)
+            __pyx_t_3 = __Pyx_PyInt_SubtractObjC(__pyx_t_1, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1077, __pyx_L1_error)
             __Pyx_GOTREF(__pyx_t_3);
             __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-            __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_v_valt, __pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1020, __pyx_L1_error)
+            __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_v_valt, __pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1077, __pyx_L1_error)
             __Pyx_GOTREF(__pyx_t_1);
             __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-            __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_t_1, __pyx_v_m); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1020, __pyx_L1_error)
+            __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_t_1, __pyx_v_m); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1077, __pyx_L1_error)
             __Pyx_GOTREF(__pyx_t_3);
             __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-            __pyx_t_1 = PyNumber_Add(__pyx_t_18, __pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1020, __pyx_L1_error)
+            __pyx_t_1 = PyNumber_Add(__pyx_t_18, __pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1077, __pyx_L1_error)
             __Pyx_GOTREF(__pyx_t_1);
             __Pyx_DECREF(__pyx_t_18); __pyx_t_18 = 0;
             __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-            __pyx_t_24 = __pyx_PyFloat_AsDouble(__pyx_t_1); if (unlikely((__pyx_t_24 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1020, __pyx_L1_error)
+            __pyx_t_24 = __pyx_PyFloat_AsDouble(__pyx_t_1); if (unlikely((__pyx_t_24 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1077, __pyx_L1_error)
             __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
             __pyx_v_value = __pyx_t_24;
 
-            /* "soapcw/soapcw.pyx":1023
+            /* "soapcw/soapcw.pyx":1080
  * 
  * 
  *                             if value>temp:             # <<<<<<<<<<<<<<
  *                                 temp = value
  *                                 val[t][i][j] = temp
  */
             __pyx_t_5 = ((__pyx_v_value > __pyx_v_temp) != 0);
             if (__pyx_t_5) {
 
-              /* "soapcw/soapcw.pyx":1024
+              /* "soapcw/soapcw.pyx":1081
  * 
  *                             if value>temp:
  *                                 temp = value             # <<<<<<<<<<<<<<
  *                                 val[t][i][j] = temp
  *                                 prev[t][i][j] = k
  */
               __pyx_v_temp = __pyx_v_value;
 
-              /* "soapcw/soapcw.pyx":1025
+              /* "soapcw/soapcw.pyx":1082
  *                             if value>temp:
  *                                 temp = value
  *                                 val[t][i][j] = temp             # <<<<<<<<<<<<<<
  *                                 prev[t][i][j] = k
  * 
  */
-              __pyx_t_1 = PyFloat_FromDouble(__pyx_v_temp); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1025, __pyx_L1_error)
+              __pyx_t_1 = PyFloat_FromDouble(__pyx_v_temp); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1082, __pyx_L1_error)
               __Pyx_GOTREF(__pyx_t_1);
-              __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_val, __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1025, __pyx_L1_error)
+              __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_val, __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1082, __pyx_L1_error)
               __Pyx_GOTREF(__pyx_t_3);
-              __pyx_t_18 = __Pyx_GetItemInt(__pyx_t_3, __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 1025, __pyx_L1_error)
+              __pyx_t_18 = __Pyx_GetItemInt(__pyx_t_3, __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 1082, __pyx_L1_error)
               __Pyx_GOTREF(__pyx_t_18);
               __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-              if (unlikely(PyObject_SetItem(__pyx_t_18, __pyx_v_j, __pyx_t_1) < 0)) __PYX_ERR(0, 1025, __pyx_L1_error)
+              if (unlikely(PyObject_SetItem(__pyx_t_18, __pyx_v_j, __pyx_t_1) < 0)) __PYX_ERR(0, 1082, __pyx_L1_error)
               __Pyx_DECREF(__pyx_t_18); __pyx_t_18 = 0;
               __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-              /* "soapcw/soapcw.pyx":1026
+              /* "soapcw/soapcw.pyx":1083
  *                                 temp = value
  *                                 val[t][i][j] = temp
  *                                 prev[t][i][j] = k             # <<<<<<<<<<<<<<
  * 
  *             if self.prog == True:
  */
-              __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_k); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1026, __pyx_L1_error)
+              __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_k); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1083, __pyx_L1_error)
               __Pyx_GOTREF(__pyx_t_1);
-              __pyx_t_18 = __Pyx_GetItemInt(__pyx_v_prev, __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 1026, __pyx_L1_error)
+              __pyx_t_18 = __Pyx_GetItemInt(__pyx_v_prev, __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 1083, __pyx_L1_error)
               __Pyx_GOTREF(__pyx_t_18);
-              __pyx_t_3 = __Pyx_GetItemInt(__pyx_t_18, __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1026, __pyx_L1_error)
+              __pyx_t_3 = __Pyx_GetItemInt(__pyx_t_18, __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1083, __pyx_L1_error)
               __Pyx_GOTREF(__pyx_t_3);
               __Pyx_DECREF(__pyx_t_18); __pyx_t_18 = 0;
-              if (unlikely(PyObject_SetItem(__pyx_t_3, __pyx_v_j, __pyx_t_1) < 0)) __PYX_ERR(0, 1026, __pyx_L1_error)
+              if (unlikely(PyObject_SetItem(__pyx_t_3, __pyx_v_j, __pyx_t_1) < 0)) __PYX_ERR(0, 1083, __pyx_L1_error)
               __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
               __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-              /* "soapcw/soapcw.pyx":1023
+              /* "soapcw/soapcw.pyx":1080
  * 
  * 
  *                             if value>temp:             # <<<<<<<<<<<<<<
  *                                 temp = value
  *                                 val[t][i][j] = temp
  */
             }
           }
 
-          /* "soapcw/soapcw.pyx":1010
+          /* "soapcw/soapcw.pyx":1067
  *                             cond = False
  *                             break
  *                     if cond:             # <<<<<<<<<<<<<<
  *                         temp = -1e6
  *                         for k in range(n):
  */
         }
 
-        /* "soapcw/soapcw.pyx":1001
+        /* "soapcw/soapcw.pyx":1058
  *             pt = t/float(length_t)*100.
  *             for i in range(width):
  *                 for j in range_j:             # <<<<<<<<<<<<<<
  *                     cond = True
  *                     for c in range(1,len(j)+1):
  */
       }
       __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     }
 
-    /* "soapcw/soapcw.pyx":1028
+    /* "soapcw/soapcw.pyx":1085
  *                                 prev[t][i][j] = k
  * 
  *             if self.prog == True:             # <<<<<<<<<<<<<<
  *                 if pt>pbar:
  *                     stdout.write('\r{} %'.format(round(pt)))
  */
-    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_prog); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1028, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_prog); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1085, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_1 = PyObject_RichCompare(__pyx_t_2, Py_True, Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1028, __pyx_L1_error)
+    __pyx_t_1 = PyObject_RichCompare(__pyx_t_2, Py_True, Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1085, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 1028, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 1085, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     if (__pyx_t_5) {
 
-      /* "soapcw/soapcw.pyx":1029
+      /* "soapcw/soapcw.pyx":1086
  * 
  *             if self.prog == True:
  *                 if pt>pbar:             # <<<<<<<<<<<<<<
  *                     stdout.write('\r{} %'.format(round(pt)))
  *                     stdout.flush()
  */
       __pyx_t_5 = ((__pyx_v_pt > __pyx_v_pbar) != 0);
       if (__pyx_t_5) {
 
-        /* "soapcw/soapcw.pyx":1030
+        /* "soapcw/soapcw.pyx":1087
  *             if self.prog == True:
  *                 if pt>pbar:
  *                     stdout.write('\r{} %'.format(round(pt)))             # <<<<<<<<<<<<<<
  *                     stdout.flush()
  *                     pbar+=100./length_t
  */
-        __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_stdout); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1030, __pyx_L1_error)
+        __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_stdout); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1087, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
-        __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_write); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1030, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_write); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1087, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-        __pyx_t_18 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u__4, __pyx_n_s_format); if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 1030, __pyx_L1_error)
+        __pyx_t_18 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u__4, __pyx_n_s_format); if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 1087, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_18);
-        __pyx_t_6 = PyFloat_FromDouble(__pyx_v_pt); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1030, __pyx_L1_error)
+        __pyx_t_6 = PyFloat_FromDouble(__pyx_v_pt); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1087, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_19 = __Pyx_PyObject_CallOneArg(__pyx_builtin_round, __pyx_t_6); if (unlikely(!__pyx_t_19)) __PYX_ERR(0, 1030, __pyx_L1_error)
+        __pyx_t_19 = __Pyx_PyObject_CallOneArg(__pyx_builtin_round, __pyx_t_6); if (unlikely(!__pyx_t_19)) __PYX_ERR(0, 1087, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_19);
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __pyx_t_6 = NULL;
         if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_18))) {
           __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_18);
           if (likely(__pyx_t_6)) {
             PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_18);
@@ -20765,15 +21103,15 @@
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_18, function);
           }
         }
         __pyx_t_2 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_18, __pyx_t_6, __pyx_t_19) : __Pyx_PyObject_CallOneArg(__pyx_t_18, __pyx_t_19);
         __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
         __Pyx_DECREF(__pyx_t_19); __pyx_t_19 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1030, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1087, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_18); __pyx_t_18 = 0;
         __pyx_t_18 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_18 = PyMethod_GET_SELF(__pyx_t_3);
           if (likely(__pyx_t_18)) {
             PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
@@ -20781,488 +21119,488 @@
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_1 = (__pyx_t_18) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_18, __pyx_t_2) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_2);
         __Pyx_XDECREF(__pyx_t_18); __pyx_t_18 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-        if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1030, __pyx_L1_error)
+        if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1087, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-        /* "soapcw/soapcw.pyx":1031
+        /* "soapcw/soapcw.pyx":1088
  *                 if pt>pbar:
  *                     stdout.write('\r{} %'.format(round(pt)))
  *                     stdout.flush()             # <<<<<<<<<<<<<<
  *                     pbar+=100./length_t
  * 
  */
-        __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_stdout); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1031, __pyx_L1_error)
+        __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_stdout); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1088, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
-        __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_flush); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1031, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_flush); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1088, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         __pyx_t_3 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
           __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
           if (likely(__pyx_t_3)) {
             PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
             __Pyx_INCREF(__pyx_t_3);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_2, function);
           }
         }
         __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
         __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-        if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1031, __pyx_L1_error)
+        if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1088, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-        /* "soapcw/soapcw.pyx":1032
+        /* "soapcw/soapcw.pyx":1089
  *                     stdout.write('\r{} %'.format(round(pt)))
  *                     stdout.flush()
  *                     pbar+=100./length_t             # <<<<<<<<<<<<<<
  * 
  *         cdef int previous   = 1
  */
         if (unlikely(__pyx_v_length_t == 0)) {
           PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-          __PYX_ERR(0, 1032, __pyx_L1_error)
+          __PYX_ERR(0, 1089, __pyx_L1_error)
         }
         __pyx_v_pbar = (__pyx_v_pbar + (100. / ((double)__pyx_v_length_t)));
 
-        /* "soapcw/soapcw.pyx":1029
+        /* "soapcw/soapcw.pyx":1086
  * 
  *             if self.prog == True:
  *                 if pt>pbar:             # <<<<<<<<<<<<<<
  *                     stdout.write('\r{} %'.format(round(pt)))
  *                     stdout.flush()
  */
       }
 
-      /* "soapcw/soapcw.pyx":1028
+      /* "soapcw/soapcw.pyx":1085
  *                                 prev[t][i][j] = k
  * 
  *             if self.prog == True:             # <<<<<<<<<<<<<<
  *                 if pt>pbar:
  *                     stdout.write('\r{} %'.format(round(pt)))
  */
     }
   }
 
-  /* "soapcw/soapcw.pyx":1034
+  /* "soapcw/soapcw.pyx":1091
  *                     pbar+=100./length_t
  * 
  *         cdef int previous   = 1             # <<<<<<<<<<<<<<
  *         previous_1 = None
  *         vit_track   = [0]
  */
   __pyx_v_previous = 1;
 
-  /* "soapcw/soapcw.pyx":1035
+  /* "soapcw/soapcw.pyx":1092
  * 
  *         cdef int previous   = 1
  *         previous_1 = None             # <<<<<<<<<<<<<<
  *         vit_track   = [0]
  * 
  */
   __Pyx_INCREF(Py_None);
   __pyx_v_previous_1 = Py_None;
 
-  /* "soapcw/soapcw.pyx":1036
+  /* "soapcw/soapcw.pyx":1093
  *         cdef int previous   = 1
  *         previous_1 = None
  *         vit_track   = [0]             # <<<<<<<<<<<<<<
  * 
  *         #cdef double max_end_prob = max(val[length-1][i] for i in range(width))
  */
-  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1036, __pyx_L1_error)
+  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1093, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_INCREF(__pyx_int_0);
   __Pyx_GIVEREF(__pyx_int_0);
   PyList_SET_ITEM(__pyx_t_1, 0, __pyx_int_0);
   __pyx_v_vit_track = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "soapcw/soapcw.pyx":1040
+  /* "soapcw/soapcw.pyx":1097
  *         #cdef double max_end_prob = max(val[length-1][i] for i in range(width))
  * 
  *         temp = -1e6             # <<<<<<<<<<<<<<
  *         for i in range(width):
  *             for j in range_j:
  */
   __pyx_v_temp = -1e6;
 
-  /* "soapcw/soapcw.pyx":1041
+  /* "soapcw/soapcw.pyx":1098
  * 
  *         temp = -1e6
  *         for i in range(width):             # <<<<<<<<<<<<<<
  *             for j in range_j:
  *                 value = val[-1][i][j]
  */
   __pyx_t_7 = __pyx_v_width;
   __pyx_t_10 = __pyx_t_7;
   for (__pyx_t_11 = 0; __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
     __pyx_v_i = __pyx_t_11;
 
-    /* "soapcw/soapcw.pyx":1042
+    /* "soapcw/soapcw.pyx":1099
  *         temp = -1e6
  *         for i in range(width):
  *             for j in range_j:             # <<<<<<<<<<<<<<
  *                 value = val[-1][i][j]
  *                 if value>temp:
  */
     __pyx_t_1 = __pyx_v_range_j; __Pyx_INCREF(__pyx_t_1); __pyx_t_8 = 0;
     for (;;) {
       if (__pyx_t_8 >= PyList_GET_SIZE(__pyx_t_1)) break;
       #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-      __pyx_t_2 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_8); __Pyx_INCREF(__pyx_t_2); __pyx_t_8++; if (unlikely(0 < 0)) __PYX_ERR(0, 1042, __pyx_L1_error)
+      __pyx_t_2 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_8); __Pyx_INCREF(__pyx_t_2); __pyx_t_8++; if (unlikely(0 < 0)) __PYX_ERR(0, 1099, __pyx_L1_error)
       #else
-      __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1042, __pyx_L1_error)
+      __pyx_t_2 = PySequence_ITEM(__pyx_t_1, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1099, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
       #endif
       __Pyx_XDECREF_SET(__pyx_v_j, __pyx_t_2);
       __pyx_t_2 = 0;
 
-      /* "soapcw/soapcw.pyx":1043
+      /* "soapcw/soapcw.pyx":1100
  *         for i in range(width):
  *             for j in range_j:
  *                 value = val[-1][i][j]             # <<<<<<<<<<<<<<
  *                 if value>temp:
  *                     temp = value
  */
-      __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_val, -1L, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1043, __pyx_L1_error)
+      __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_val, -1L, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1100, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
-      __pyx_t_3 = __Pyx_GetItemInt(__pyx_t_2, __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1043, __pyx_L1_error)
+      __pyx_t_3 = __Pyx_GetItemInt(__pyx_t_2, __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1100, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
       __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-      __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_t_3, __pyx_v_j); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1043, __pyx_L1_error)
+      __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_t_3, __pyx_v_j); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1100, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-      __pyx_t_24 = __pyx_PyFloat_AsDouble(__pyx_t_2); if (unlikely((__pyx_t_24 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1043, __pyx_L1_error)
+      __pyx_t_24 = __pyx_PyFloat_AsDouble(__pyx_t_2); if (unlikely((__pyx_t_24 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1100, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
       __pyx_v_value = __pyx_t_24;
 
-      /* "soapcw/soapcw.pyx":1044
+      /* "soapcw/soapcw.pyx":1101
  *             for j in range_j:
  *                 value = val[-1][i][j]
  *                 if value>temp:             # <<<<<<<<<<<<<<
  *                     temp = value
  *                     vit_track[0] = i
  */
       __pyx_t_5 = ((__pyx_v_value > __pyx_v_temp) != 0);
       if (__pyx_t_5) {
 
-        /* "soapcw/soapcw.pyx":1045
+        /* "soapcw/soapcw.pyx":1102
  *                 value = val[-1][i][j]
  *                 if value>temp:
  *                     temp = value             # <<<<<<<<<<<<<<
  *                     vit_track[0] = i
  *                     previous = i
  */
         __pyx_v_temp = __pyx_v_value;
 
-        /* "soapcw/soapcw.pyx":1046
+        /* "soapcw/soapcw.pyx":1103
  *                 if value>temp:
  *                     temp = value
  *                     vit_track[0] = i             # <<<<<<<<<<<<<<
  *                     previous = i
  *                     previous_1 = j
  */
-        __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_i); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1046, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_i); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1103, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_vit_track, 0, __pyx_t_2, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0)) __PYX_ERR(0, 1046, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_vit_track, 0, __pyx_t_2, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0)) __PYX_ERR(0, 1103, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-        /* "soapcw/soapcw.pyx":1047
+        /* "soapcw/soapcw.pyx":1104
  *                     temp = value
  *                     vit_track[0] = i
  *                     previous = i             # <<<<<<<<<<<<<<
  *                     previous_1 = j
  *                     previous_2 = int(prev[-1][i][j])
  */
         __pyx_v_previous = __pyx_v_i;
 
-        /* "soapcw/soapcw.pyx":1048
+        /* "soapcw/soapcw.pyx":1105
  *                     vit_track[0] = i
  *                     previous = i
  *                     previous_1 = j             # <<<<<<<<<<<<<<
  *                     previous_2 = int(prev[-1][i][j])
  * 
  */
         __Pyx_INCREF(__pyx_v_j);
         __Pyx_DECREF_SET(__pyx_v_previous_1, __pyx_v_j);
 
-        /* "soapcw/soapcw.pyx":1049
+        /* "soapcw/soapcw.pyx":1106
  *                     previous = i
  *                     previous_1 = j
  *                     previous_2 = int(prev[-1][i][j])             # <<<<<<<<<<<<<<
  * 
  * 
  */
-        __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_prev, -1L, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1049, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_prev, -1L, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1106, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
-        __pyx_t_3 = __Pyx_GetItemInt(__pyx_t_2, __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1049, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_GetItemInt(__pyx_t_2, __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1106, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-        __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_t_3, __pyx_v_j); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1049, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_t_3, __pyx_v_j); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1106, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        __pyx_t_3 = __Pyx_PyNumber_Int(__pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1049, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_PyNumber_Int(__pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1106, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __Pyx_XDECREF_SET(__pyx_v_previous_2, __pyx_t_3);
         __pyx_t_3 = 0;
 
-        /* "soapcw/soapcw.pyx":1044
+        /* "soapcw/soapcw.pyx":1101
  *             for j in range_j:
  *                 value = val[-1][i][j]
  *                 if value>temp:             # <<<<<<<<<<<<<<
  *                     temp = value
  *                     vit_track[0] = i
  */
       }
 
-      /* "soapcw/soapcw.pyx":1042
+      /* "soapcw/soapcw.pyx":1099
  *         temp = -1e6
  *         for i in range(width):
  *             for j in range_j:             # <<<<<<<<<<<<<<
  *                 value = val[-1][i][j]
  *                 if value>temp:
  */
     }
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   }
 
-  /* "soapcw/soapcw.pyx":1052
+  /* "soapcw/soapcw.pyx":1109
  * 
  * 
  *         for t in range(length_t-2,-1,-1):             # <<<<<<<<<<<<<<
  *             vit_track.append(previous+previous_1[0]-1)
  *             previous += previous_1[0]-1
  */
   for (__pyx_t_7 = (__pyx_v_length_t - 2); __pyx_t_7 > -1; __pyx_t_7-=1) {
     __pyx_v_t = __pyx_t_7;
 
-    /* "soapcw/soapcw.pyx":1053
+    /* "soapcw/soapcw.pyx":1110
  * 
  *         for t in range(length_t-2,-1,-1):
  *             vit_track.append(previous+previous_1[0]-1)             # <<<<<<<<<<<<<<
  *             previous += previous_1[0]-1
  *             previous_1 = list(previous_1[1:])
  */
-    __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_previous); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1053, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_previous); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1110, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_previous_1, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1053, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_previous_1, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1110, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_2 = PyNumber_Add(__pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1053, __pyx_L1_error)
+    __pyx_t_2 = PyNumber_Add(__pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1110, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_t_3 = __Pyx_PyInt_SubtractObjC(__pyx_t_2, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1053, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyInt_SubtractObjC(__pyx_t_2, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1110, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __pyx_t_9 = __Pyx_PyList_Append(__pyx_v_vit_track, __pyx_t_3); if (unlikely(__pyx_t_9 == ((int)-1))) __PYX_ERR(0, 1053, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_PyList_Append(__pyx_v_vit_track, __pyx_t_3); if (unlikely(__pyx_t_9 == ((int)-1))) __PYX_ERR(0, 1110, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-    /* "soapcw/soapcw.pyx":1054
+    /* "soapcw/soapcw.pyx":1111
  *         for t in range(length_t-2,-1,-1):
  *             vit_track.append(previous+previous_1[0]-1)
  *             previous += previous_1[0]-1             # <<<<<<<<<<<<<<
  *             previous_1 = list(previous_1[1:])
  *             previous_1.append(int(previous_2))
  */
-    __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_previous); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1054, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_previous); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1111, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_previous_1, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1054, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_previous_1, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1111, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_1 = __Pyx_PyInt_SubtractObjC(__pyx_t_2, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1054, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyInt_SubtractObjC(__pyx_t_2, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1111, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __pyx_t_2 = PyNumber_InPlaceAdd(__pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1054, __pyx_L1_error)
+    __pyx_t_2 = PyNumber_InPlaceAdd(__pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1111, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_10 = __Pyx_PyInt_As_int(__pyx_t_2); if (unlikely((__pyx_t_10 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 1054, __pyx_L1_error)
+    __pyx_t_10 = __Pyx_PyInt_As_int(__pyx_t_2); if (unlikely((__pyx_t_10 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 1111, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __pyx_v_previous = __pyx_t_10;
 
-    /* "soapcw/soapcw.pyx":1055
+    /* "soapcw/soapcw.pyx":1112
  *             vit_track.append(previous+previous_1[0]-1)
  *             previous += previous_1[0]-1
  *             previous_1 = list(previous_1[1:])             # <<<<<<<<<<<<<<
  *             previous_1.append(int(previous_2))
  *             previous_1 = tuple(previous_1)
  */
-    __pyx_t_2 = __Pyx_PyObject_GetSlice(__pyx_v_previous_1, 1, 0, NULL, NULL, &__pyx_slice__8, 1, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1055, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_GetSlice(__pyx_v_previous_1, 1, 0, NULL, NULL, &__pyx_slice__8, 1, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1112, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_1 = PySequence_List(__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1055, __pyx_L1_error)
+    __pyx_t_1 = PySequence_List(__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1112, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_DECREF_SET(__pyx_v_previous_1, __pyx_t_1);
     __pyx_t_1 = 0;
 
-    /* "soapcw/soapcw.pyx":1056
+    /* "soapcw/soapcw.pyx":1113
  *             previous += previous_1[0]-1
  *             previous_1 = list(previous_1[1:])
  *             previous_1.append(int(previous_2))             # <<<<<<<<<<<<<<
  *             previous_1 = tuple(previous_1)
  *             previous_2 = prev[t][previous][previous_1]
  */
-    if (unlikely(!__pyx_v_previous_2)) { __Pyx_RaiseUnboundLocalError("previous_2"); __PYX_ERR(0, 1056, __pyx_L1_error) }
-    __pyx_t_1 = __Pyx_PyNumber_Int(__pyx_v_previous_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1056, __pyx_L1_error)
+    if (unlikely(!__pyx_v_previous_2)) { __Pyx_RaiseUnboundLocalError("previous_2"); __PYX_ERR(0, 1113, __pyx_L1_error) }
+    __pyx_t_1 = __Pyx_PyNumber_Int(__pyx_v_previous_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1113, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_9 = __Pyx_PyObject_Append(__pyx_v_previous_1, __pyx_t_1); if (unlikely(__pyx_t_9 == ((int)-1))) __PYX_ERR(0, 1056, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_PyObject_Append(__pyx_v_previous_1, __pyx_t_1); if (unlikely(__pyx_t_9 == ((int)-1))) __PYX_ERR(0, 1113, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-    /* "soapcw/soapcw.pyx":1057
+    /* "soapcw/soapcw.pyx":1114
  *             previous_1 = list(previous_1[1:])
  *             previous_1.append(int(previous_2))
  *             previous_1 = tuple(previous_1)             # <<<<<<<<<<<<<<
  *             previous_2 = prev[t][previous][previous_1]
  * 
  */
-    __pyx_t_1 = __Pyx_PySequence_Tuple(__pyx_v_previous_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1057, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PySequence_Tuple(__pyx_v_previous_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1114, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF_SET(__pyx_v_previous_1, __pyx_t_1);
     __pyx_t_1 = 0;
 
-    /* "soapcw/soapcw.pyx":1058
+    /* "soapcw/soapcw.pyx":1115
  *             previous_1.append(int(previous_2))
  *             previous_1 = tuple(previous_1)
  *             previous_2 = prev[t][previous][previous_1]             # <<<<<<<<<<<<<<
  * 
  *         vit_track = vit_track[::-1]
  */
-    __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_prev, __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1058, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_prev, __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1115, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_2 = __Pyx_GetItemInt(__pyx_t_1, __pyx_v_previous, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1058, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_GetItemInt(__pyx_t_1, __pyx_v_previous, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1115, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_t_2, __pyx_v_previous_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1058, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_t_2, __pyx_v_previous_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1115, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_XDECREF_SET(__pyx_v_previous_2, __pyx_t_1);
     __pyx_t_1 = 0;
   }
 
-  /* "soapcw/soapcw.pyx":1060
+  /* "soapcw/soapcw.pyx":1117
  *             previous_2 = prev[t][previous][previous_1]
  * 
  *         vit_track = vit_track[::-1]             # <<<<<<<<<<<<<<
  * 
  *         self.vit_track = np.array(vit_track)
  */
-  __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_v_vit_track, __pyx_slice__9); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1060, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_v_vit_track, __pyx_slice__9); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1117, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF_SET(__pyx_v_vit_track, ((PyObject*)__pyx_t_1));
   __pyx_t_1 = 0;
 
-  /* "soapcw/soapcw.pyx":1062
+  /* "soapcw/soapcw.pyx":1119
  *         vit_track = vit_track[::-1]
  * 
  *         self.vit_track = np.array(vit_track)             # <<<<<<<<<<<<<<
  *         self.V = np.array(val)
  *         self.prev = np.array(prev)
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1062, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1119, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_array); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1062, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_array); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1119, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_t_2 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
     __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
     if (likely(__pyx_t_2)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
       __Pyx_INCREF(__pyx_t_2);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_3, function);
     }
   }
   __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_2, __pyx_v_vit_track) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_vit_track);
   __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1062, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1119, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_vit_track, __pyx_t_1) < 0) __PYX_ERR(0, 1062, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_vit_track, __pyx_t_1) < 0) __PYX_ERR(0, 1119, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "soapcw/soapcw.pyx":1063
+  /* "soapcw/soapcw.pyx":1120
  * 
  *         self.vit_track = np.array(vit_track)
  *         self.V = np.array(val)             # <<<<<<<<<<<<<<
  *         self.prev = np.array(prev)
  *         self.max_end_prob = None # needs to be fixed
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1063, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1120, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_array); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1063, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_array); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1120, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_t_3 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
     __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
     if (likely(__pyx_t_3)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
       __Pyx_INCREF(__pyx_t_3);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_2, function);
     }
   }
   __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_v_val) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_val);
   __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1063, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1120, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_V, __pyx_t_1) < 0) __PYX_ERR(0, 1063, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_V, __pyx_t_1) < 0) __PYX_ERR(0, 1120, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "soapcw/soapcw.pyx":1064
+  /* "soapcw/soapcw.pyx":1121
  *         self.vit_track = np.array(vit_track)
  *         self.V = np.array(val)
  *         self.prev = np.array(prev)             # <<<<<<<<<<<<<<
  *         self.max_end_prob = None # needs to be fixed
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1064, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1121, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_array); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1064, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_array); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1121, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_t_2 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
     __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
     if (likely(__pyx_t_2)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
       __Pyx_INCREF(__pyx_t_2);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_3, function);
     }
   }
   __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_2, __pyx_v_prev) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_prev);
   __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1064, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1121, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_prev, __pyx_t_1) < 0) __PYX_ERR(0, 1064, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_prev, __pyx_t_1) < 0) __PYX_ERR(0, 1121, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "soapcw/soapcw.pyx":1065
+  /* "soapcw/soapcw.pyx":1122
  *         self.V = np.array(val)
  *         self.prev = np.array(prev)
  *         self.max_end_prob = None # needs to be fixed             # <<<<<<<<<<<<<<
  * 
  *         #return (vit_track,val,prev)
  */
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_max_end_prob, Py_None) < 0) __PYX_ERR(0, 1065, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_max_end_prob, Py_None) < 0) __PYX_ERR(0, 1122, __pyx_L1_error)
 
-  /* "soapcw/soapcw.pyx":932
+  /* "soapcw/soapcw.pyx":989
  *     #------------------------------------------------------------------------
  * 
  *     def run(self, tr, obs):             # <<<<<<<<<<<<<<
  *         ''' Run viterbi algroithm with memory of n
  *         the amount of memory is determined by the transition matrix
  */
 
@@ -21294,15 +21632,15 @@
   __Pyx_XDECREF(__pyx_v_vit_track);
   __Pyx_XDECREF(__pyx_v_previous_2);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "soapcw/soapcw.pyx":1071
+/* "soapcw/soapcw.pyx":1128
  * class two_detector_mem_n(object):
  * 
  *     def __init__(self, tr, obs1, obs2, prog = False):             # <<<<<<<<<<<<<<
  *         '''
  *         initialising viterbi class
  */
 
@@ -21348,37 +21686,37 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_tr)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__init__", 0, 4, 5, 1); __PYX_ERR(0, 1071, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__init__", 0, 4, 5, 1); __PYX_ERR(0, 1128, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_obs1)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__init__", 0, 4, 5, 2); __PYX_ERR(0, 1071, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__init__", 0, 4, 5, 2); __PYX_ERR(0, 1128, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_obs2)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__init__", 0, 4, 5, 3); __PYX_ERR(0, 1071, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__init__", 0, 4, 5, 3); __PYX_ERR(0, 1128, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_prog);
           if (value) { values[4] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) __PYX_ERR(0, 1071, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) __PYX_ERR(0, 1128, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
         CYTHON_FALLTHROUGH;
         case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
         values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
@@ -21392,15 +21730,15 @@
     __pyx_v_tr = values[1];
     __pyx_v_obs1 = values[2];
     __pyx_v_obs2 = values[3];
     __pyx_v_prog = values[4];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__init__", 0, 4, 5, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1071, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("__init__", 0, 4, 5, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1128, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("soapcw.soapcw.two_detector_mem_n.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6soapcw_6soapcw_18two_detector_mem_n___init__(__pyx_self, __pyx_v_self, __pyx_v_tr, __pyx_v_obs1, __pyx_v_obs2, __pyx_v_prog);
 
@@ -21418,31 +21756,31 @@
   int __pyx_t_4;
   PyObject *__pyx_t_5 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__init__", 0);
 
-  /* "soapcw/soapcw.pyx":1075
+  /* "soapcw/soapcw.pyx":1132
  *         initialising viterbi class
  *         '''
  *         self.prog = prog             # <<<<<<<<<<<<<<
  *         self.tracks = self.run(tr, obs1, obs2)
  * 
  */
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_prog, __pyx_v_prog) < 0) __PYX_ERR(0, 1075, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_prog, __pyx_v_prog) < 0) __PYX_ERR(0, 1132, __pyx_L1_error)
 
-  /* "soapcw/soapcw.pyx":1076
+  /* "soapcw/soapcw.pyx":1133
  *         '''
  *         self.prog = prog
  *         self.tracks = self.run(tr, obs1, obs2)             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_run); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1076, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_run); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1133, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_3 = NULL;
   __pyx_t_4 = 0;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
     __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
     if (likely(__pyx_t_3)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
@@ -21451,51 +21789,51 @@
       __Pyx_DECREF_SET(__pyx_t_2, function);
       __pyx_t_4 = 1;
     }
   }
   #if CYTHON_FAST_PYCALL
   if (PyFunction_Check(__pyx_t_2)) {
     PyObject *__pyx_temp[4] = {__pyx_t_3, __pyx_v_tr, __pyx_v_obs1, __pyx_v_obs2};
-    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_4, 3+__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1076, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_4, 3+__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1133, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_GOTREF(__pyx_t_1);
   } else
   #endif
   #if CYTHON_FAST_PYCCALL
   if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
     PyObject *__pyx_temp[4] = {__pyx_t_3, __pyx_v_tr, __pyx_v_obs1, __pyx_v_obs2};
-    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_4, 3+__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1076, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_4, 3+__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1133, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_GOTREF(__pyx_t_1);
   } else
   #endif
   {
-    __pyx_t_5 = PyTuple_New(3+__pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1076, __pyx_L1_error)
+    __pyx_t_5 = PyTuple_New(3+__pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1133, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     if (__pyx_t_3) {
       __Pyx_GIVEREF(__pyx_t_3); PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_3); __pyx_t_3 = NULL;
     }
     __Pyx_INCREF(__pyx_v_tr);
     __Pyx_GIVEREF(__pyx_v_tr);
     PyTuple_SET_ITEM(__pyx_t_5, 0+__pyx_t_4, __pyx_v_tr);
     __Pyx_INCREF(__pyx_v_obs1);
     __Pyx_GIVEREF(__pyx_v_obs1);
     PyTuple_SET_ITEM(__pyx_t_5, 1+__pyx_t_4, __pyx_v_obs1);
     __Pyx_INCREF(__pyx_v_obs2);
     __Pyx_GIVEREF(__pyx_v_obs2);
     PyTuple_SET_ITEM(__pyx_t_5, 2+__pyx_t_4, __pyx_v_obs2);
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_5, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1076, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_5, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1133, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   }
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_tracks, __pyx_t_1) < 0) __PYX_ERR(0, 1076, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_tracks, __pyx_t_1) < 0) __PYX_ERR(0, 1133, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "soapcw/soapcw.pyx":1071
+  /* "soapcw/soapcw.pyx":1128
  * class two_detector_mem_n(object):
  * 
  *     def __init__(self, tr, obs1, obs2, prog = False):             # <<<<<<<<<<<<<<
  *         '''
  *         initialising viterbi class
  */
 
@@ -21511,15 +21849,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "soapcw/soapcw.pyx":1084
+/* "soapcw/soapcw.pyx":1141
  * 
  * 
  *     def run(self, tr, obs11, obs22):             # <<<<<<<<<<<<<<
  *         ''' Run viterbi algroithm with memory of n
  *         the amount of memory is determined by the transition matrix
  */
 
@@ -21561,31 +21899,31 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_tr)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("run", 1, 4, 4, 1); __PYX_ERR(0, 1084, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("run", 1, 4, 4, 1); __PYX_ERR(0, 1141, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_obs11)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("run", 1, 4, 4, 2); __PYX_ERR(0, 1084, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("run", 1, 4, 4, 2); __PYX_ERR(0, 1141, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_obs22)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("run", 1, 4, 4, 3); __PYX_ERR(0, 1084, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("run", 1, 4, 4, 3); __PYX_ERR(0, 1141, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "run") < 0)) __PYX_ERR(0, 1084, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "run") < 0)) __PYX_ERR(0, 1141, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 4) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
@@ -21594,15 +21932,15 @@
     __pyx_v_self = values[0];
     __pyx_v_tr = values[1];
     __pyx_v_obs11 = values[2];
     __pyx_v_obs22 = values[3];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("run", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1084, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("run", 1, 4, 4, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1141, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("soapcw.soapcw.two_detector_mem_n.run", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6soapcw_6soapcw_18two_detector_mem_n_2run(__pyx_self, __pyx_v_self, __pyx_v_tr, __pyx_v_obs11, __pyx_v_obs22);
 
@@ -21693,205 +22031,205 @@
   int __pyx_t_39;
   int __pyx_t_40;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("run", 0);
 
-  /* "soapcw/soapcw.pyx":1097
+  /* "soapcw/soapcw.pyx":1154
  *         '''
  * 
  *         if len(np.shape(tr))<=1:             # <<<<<<<<<<<<<<
  *             raise Exception("ERROR: Please use a transition matrix with dimensions larger than one")
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1097, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1154, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_shape); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1097, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_shape); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1154, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_t_2 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
     __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
     if (likely(__pyx_t_2)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
       __Pyx_INCREF(__pyx_t_2);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_3, function);
     }
   }
   __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_2, __pyx_v_tr) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_tr);
   __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1097, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1154, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_4 = PyObject_Length(__pyx_t_1); if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1097, __pyx_L1_error)
+  __pyx_t_4 = PyObject_Length(__pyx_t_1); if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1154, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_t_5 = ((__pyx_t_4 <= 1) != 0);
   if (unlikely(__pyx_t_5)) {
 
-    /* "soapcw/soapcw.pyx":1098
+    /* "soapcw/soapcw.pyx":1155
  * 
  *         if len(np.shape(tr))<=1:
  *             raise Exception("ERROR: Please use a transition matrix with dimensions larger than one")             # <<<<<<<<<<<<<<
  * 
  *         range_tr = np.arange(len(tr))
  */
-    __pyx_t_1 = __Pyx_PyObject_Call(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])), __pyx_tuple__7, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1098, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Call(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])), __pyx_tuple__7, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1155, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 1098, __pyx_L1_error)
+    __PYX_ERR(0, 1155, __pyx_L1_error)
 
-    /* "soapcw/soapcw.pyx":1097
+    /* "soapcw/soapcw.pyx":1154
  *         '''
  * 
  *         if len(np.shape(tr))<=1:             # <<<<<<<<<<<<<<
  *             raise Exception("ERROR: Please use a transition matrix with dimensions larger than one")
  * 
  */
   }
 
-  /* "soapcw/soapcw.pyx":1100
+  /* "soapcw/soapcw.pyx":1157
  *             raise Exception("ERROR: Please use a transition matrix with dimensions larger than one")
  * 
  *         range_tr = np.arange(len(tr))             # <<<<<<<<<<<<<<
  * 
  *         cdef double[:, :] obs1 = obs11
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1100, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1157, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_arange); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1100, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_arange); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1157, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_4 = PyObject_Length(__pyx_v_tr); if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1100, __pyx_L1_error)
-  __pyx_t_3 = PyInt_FromSsize_t(__pyx_t_4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1100, __pyx_L1_error)
+  __pyx_t_4 = PyObject_Length(__pyx_v_tr); if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1157, __pyx_L1_error)
+  __pyx_t_3 = PyInt_FromSsize_t(__pyx_t_4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1157, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __pyx_t_6 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
     __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_2);
     if (likely(__pyx_t_6)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
       __Pyx_INCREF(__pyx_t_6);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_2, function);
     }
   }
   __pyx_t_1 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_6, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3);
   __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1100, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1157, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_v_range_tr = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "soapcw/soapcw.pyx":1102
+  /* "soapcw/soapcw.pyx":1159
  *         range_tr = np.arange(len(tr))
  * 
  *         cdef double[:, :] obs1 = obs11             # <<<<<<<<<<<<<<
  *         cdef double[:, :] obs2 = obs22
  * 
  */
-  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_dsds_double(__pyx_v_obs11, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 1102, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_dsds_double(__pyx_v_obs11, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 1159, __pyx_L1_error)
   __pyx_v_obs1 = __pyx_t_7;
   __pyx_t_7.memview = NULL;
   __pyx_t_7.data = NULL;
 
-  /* "soapcw/soapcw.pyx":1103
+  /* "soapcw/soapcw.pyx":1160
  * 
  *         cdef double[:, :] obs1 = obs11
  *         cdef double[:, :] obs2 = obs22             # <<<<<<<<<<<<<<
  * 
  *         cdef int n      = len(tr)
  */
-  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_dsds_double(__pyx_v_obs22, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 1103, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_dsds_double(__pyx_v_obs22, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 1160, __pyx_L1_error)
   __pyx_v_obs2 = __pyx_t_7;
   __pyx_t_7.memview = NULL;
   __pyx_t_7.data = NULL;
 
-  /* "soapcw/soapcw.pyx":1105
+  /* "soapcw/soapcw.pyx":1162
  *         cdef double[:, :] obs2 = obs22
  * 
  *         cdef int n      = len(tr)             # <<<<<<<<<<<<<<
  *         shape           = np.shape(tr)
  *         cdef int length = len(shape)
  */
-  __pyx_t_4 = PyObject_Length(__pyx_v_tr); if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1105, __pyx_L1_error)
+  __pyx_t_4 = PyObject_Length(__pyx_v_tr); if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1162, __pyx_L1_error)
   __pyx_v_n = __pyx_t_4;
 
-  /* "soapcw/soapcw.pyx":1106
+  /* "soapcw/soapcw.pyx":1163
  * 
  *         cdef int n      = len(tr)
  *         shape           = np.shape(tr)             # <<<<<<<<<<<<<<
  *         cdef int length = len(shape)
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1106, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1163, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_shape); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1106, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_shape); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1163, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_t_2 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
     __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
     if (likely(__pyx_t_2)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
       __Pyx_INCREF(__pyx_t_2);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_3, function);
     }
   }
   __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_2, __pyx_v_tr) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_tr);
   __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1106, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1163, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_v_shape = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "soapcw/soapcw.pyx":1107
+  /* "soapcw/soapcw.pyx":1164
  *         cdef int n      = len(tr)
  *         shape           = np.shape(tr)
  *         cdef int length = len(shape)             # <<<<<<<<<<<<<<
  * 
  *         dimensions = (min(len(obs1),len(obs2)),min(len(obs1[0]),len(obs2[0])))
  */
-  __pyx_t_4 = PyObject_Length(__pyx_v_shape); if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1107, __pyx_L1_error)
+  __pyx_t_4 = PyObject_Length(__pyx_v_shape); if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1164, __pyx_L1_error)
   __pyx_v_length = __pyx_t_4;
 
-  /* "soapcw/soapcw.pyx":1109
+  /* "soapcw/soapcw.pyx":1166
  *         cdef int length = len(shape)
  * 
  *         dimensions = (min(len(obs1),len(obs2)),min(len(obs1[0]),len(obs2[0])))             # <<<<<<<<<<<<<<
  *         dimensions = list(dimensions)
  * 
  */
   __pyx_t_8 = __Pyx_MemoryView_Len(__pyx_v_obs2); 
   __pyx_t_9 = __Pyx_MemoryView_Len(__pyx_v_obs1); 
   if (((__pyx_t_8 < __pyx_t_9) != 0)) {
     __pyx_t_4 = __pyx_t_8;
   } else {
     __pyx_t_4 = __pyx_t_9;
   }
-  __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1109, __pyx_L1_error)
+  __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1166, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_t_10.data = __pyx_v_obs2.data;
   __pyx_t_10.memview = __pyx_v_obs2.memview;
   __PYX_INC_MEMVIEW(&__pyx_t_10, 0);
   {
     Py_ssize_t __pyx_tmp_idx = 0;
         Py_ssize_t __pyx_tmp_shape = __pyx_v_obs2.shape[0];
     Py_ssize_t __pyx_tmp_stride = __pyx_v_obs2.strides[0];
         if (__pyx_tmp_idx < 0)
             __pyx_tmp_idx += __pyx_tmp_shape;
         if (unlikely(!__Pyx_is_valid_index(__pyx_tmp_idx, __pyx_tmp_shape))) {
             PyErr_SetString(PyExc_IndexError,
                             "Index out of bounds (axis 0)");
-            __PYX_ERR(0, 1109, __pyx_L1_error)
+            __PYX_ERR(0, 1166, __pyx_L1_error)
         }
         __pyx_t_10.data += __pyx_tmp_idx * __pyx_tmp_stride;
 }
 
 __pyx_t_10.shape[0] = __pyx_v_obs2.shape[1];
 __pyx_t_10.strides[0] = __pyx_v_obs2.strides[1];
     __pyx_t_10.suboffsets[0] = -1;
@@ -21908,15 +22246,15 @@
         Py_ssize_t __pyx_tmp_shape = __pyx_v_obs1.shape[0];
     Py_ssize_t __pyx_tmp_stride = __pyx_v_obs1.strides[0];
         if (__pyx_tmp_idx < 0)
             __pyx_tmp_idx += __pyx_tmp_shape;
         if (unlikely(!__Pyx_is_valid_index(__pyx_tmp_idx, __pyx_tmp_shape))) {
             PyErr_SetString(PyExc_IndexError,
                             "Index out of bounds (axis 0)");
-            __PYX_ERR(0, 1109, __pyx_L1_error)
+            __PYX_ERR(0, 1166, __pyx_L1_error)
         }
         __pyx_t_10.data += __pyx_tmp_idx * __pyx_tmp_stride;
 }
 
 __pyx_t_10.shape[0] = __pyx_v_obs1.shape[1];
 __pyx_t_10.strides[0] = __pyx_v_obs1.strides[1];
     __pyx_t_10.suboffsets[0] = -1;
@@ -21926,318 +22264,318 @@
   __pyx_t_10.memview = NULL;
   __pyx_t_10.data = NULL;
   if (((__pyx_t_8 < __pyx_t_9) != 0)) {
     __pyx_t_4 = __pyx_t_8;
   } else {
     __pyx_t_4 = __pyx_t_9;
   }
-  __pyx_t_3 = PyInt_FromSsize_t(__pyx_t_4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1109, __pyx_L1_error)
+  __pyx_t_3 = PyInt_FromSsize_t(__pyx_t_4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1166, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1109, __pyx_L1_error)
+  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1166, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_3);
   PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_3);
   __pyx_t_1 = 0;
   __pyx_t_3 = 0;
   __pyx_v_dimensions = __pyx_t_2;
   __pyx_t_2 = 0;
 
-  /* "soapcw/soapcw.pyx":1110
+  /* "soapcw/soapcw.pyx":1167
  * 
  *         dimensions = (min(len(obs1),len(obs2)),min(len(obs1[0]),len(obs2[0])))
  *         dimensions = list(dimensions)             # <<<<<<<<<<<<<<
  * 
  *         cdef int length_t = dimensions[0]
  */
-  __pyx_t_2 = PySequence_List(__pyx_v_dimensions); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1110, __pyx_L1_error)
+  __pyx_t_2 = PySequence_List(__pyx_v_dimensions); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1167, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF_SET(__pyx_v_dimensions, __pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "soapcw/soapcw.pyx":1112
+  /* "soapcw/soapcw.pyx":1169
  *         dimensions = list(dimensions)
  * 
  *         cdef int length_t = dimensions[0]             # <<<<<<<<<<<<<<
  *         cdef int width = dimensions[1]
  * 
  */
-  __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_dimensions, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1112, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_dimensions, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1169, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_11 = __Pyx_PyInt_As_int(__pyx_t_2); if (unlikely((__pyx_t_11 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 1112, __pyx_L1_error)
+  __pyx_t_11 = __Pyx_PyInt_As_int(__pyx_t_2); if (unlikely((__pyx_t_11 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 1169, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_v_length_t = __pyx_t_11;
 
-  /* "soapcw/soapcw.pyx":1113
+  /* "soapcw/soapcw.pyx":1170
  * 
  *         cdef int length_t = dimensions[0]
  *         cdef int width = dimensions[1]             # <<<<<<<<<<<<<<
  * 
  *         cdef int i
  */
-  __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_dimensions, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1113, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_dimensions, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1170, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_11 = __Pyx_PyInt_As_int(__pyx_t_2); if (unlikely((__pyx_t_11 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 1113, __pyx_L1_error)
+  __pyx_t_11 = __Pyx_PyInt_As_int(__pyx_t_2); if (unlikely((__pyx_t_11 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 1170, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_v_width = __pyx_t_11;
 
-  /* "soapcw/soapcw.pyx":1126
+  /* "soapcw/soapcw.pyx":1183
  * 
  * 
  *         for i in range(len(shape)-3):             # <<<<<<<<<<<<<<
  *             dimensions.append(n)
  * 
  */
-  __pyx_t_4 = PyObject_Length(__pyx_v_shape); if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1126, __pyx_L1_error)
+  __pyx_t_4 = PyObject_Length(__pyx_v_shape); if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1183, __pyx_L1_error)
   __pyx_t_12 = (__pyx_t_4 - 3);
   __pyx_t_4 = __pyx_t_12;
   for (__pyx_t_11 = 0; __pyx_t_11 < __pyx_t_4; __pyx_t_11+=1) {
     __pyx_v_i = __pyx_t_11;
 
-    /* "soapcw/soapcw.pyx":1127
+    /* "soapcw/soapcw.pyx":1184
  * 
  *         for i in range(len(shape)-3):
  *             dimensions.append(n)             # <<<<<<<<<<<<<<
  * 
  *         dimensions = tuple(dimensions)
  */
-    __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_n); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1127, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_n); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1184, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_13 = __Pyx_PyObject_Append(__pyx_v_dimensions, __pyx_t_2); if (unlikely(__pyx_t_13 == ((int)-1))) __PYX_ERR(0, 1127, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyObject_Append(__pyx_v_dimensions, __pyx_t_2); if (unlikely(__pyx_t_13 == ((int)-1))) __PYX_ERR(0, 1184, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   }
 
-  /* "soapcw/soapcw.pyx":1129
+  /* "soapcw/soapcw.pyx":1186
  *             dimensions.append(n)
  * 
  *         dimensions = tuple(dimensions)             # <<<<<<<<<<<<<<
  * 
  *         val    = np.ones(dimensions)*-1e6
  */
-  __pyx_t_2 = __Pyx_PySequence_Tuple(__pyx_v_dimensions); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1129, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PySequence_Tuple(__pyx_v_dimensions); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1186, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF_SET(__pyx_v_dimensions, __pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "soapcw/soapcw.pyx":1131
+  /* "soapcw/soapcw.pyx":1188
  *         dimensions = tuple(dimensions)
  * 
  *         val    = np.ones(dimensions)*-1e6             # <<<<<<<<<<<<<<
  *         prev   = np.ones(dimensions)
  *         pos1   = np.ones(dimensions)
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1131, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1188, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_ones); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1131, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_ones); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1188, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_t_3 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_1))) {
     __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_1);
     if (likely(__pyx_t_3)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
       __Pyx_INCREF(__pyx_t_3);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_1, function);
     }
   }
   __pyx_t_2 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_3, __pyx_v_dimensions) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_v_dimensions);
   __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1131, __pyx_L1_error)
+  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1188, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = PyNumber_Multiply(__pyx_t_2, __pyx_float_neg_1e6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1131, __pyx_L1_error)
+  __pyx_t_1 = PyNumber_Multiply(__pyx_t_2, __pyx_float_neg_1e6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1188, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_v_val = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "soapcw/soapcw.pyx":1132
+  /* "soapcw/soapcw.pyx":1189
  * 
  *         val    = np.ones(dimensions)*-1e6
  *         prev   = np.ones(dimensions)             # <<<<<<<<<<<<<<
  *         pos1   = np.ones(dimensions)
  *         pos2   = np.ones(dimensions)
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1132, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1189, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_ones); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1132, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_ones); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1189, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_t_2 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
     __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
     if (likely(__pyx_t_2)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
       __Pyx_INCREF(__pyx_t_2);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_3, function);
     }
   }
   __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_2, __pyx_v_dimensions) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_dimensions);
   __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1132, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1189, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_v_prev = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "soapcw/soapcw.pyx":1133
+  /* "soapcw/soapcw.pyx":1190
  *         val    = np.ones(dimensions)*-1e6
  *         prev   = np.ones(dimensions)
  *         pos1   = np.ones(dimensions)             # <<<<<<<<<<<<<<
  *         pos2   = np.ones(dimensions)
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1133, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1190, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_ones); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1133, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_ones); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1190, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_t_3 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
     __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
     if (likely(__pyx_t_3)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
       __Pyx_INCREF(__pyx_t_3);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_2, function);
     }
   }
   __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_v_dimensions) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_v_dimensions);
   __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1133, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1190, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_v_pos1 = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "soapcw/soapcw.pyx":1134
+  /* "soapcw/soapcw.pyx":1191
  *         prev   = np.ones(dimensions)
  *         pos1   = np.ones(dimensions)
  *         pos2   = np.ones(dimensions)             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1134, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1191, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_ones); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1134, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_ones); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1191, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_t_2 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
     __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
     if (likely(__pyx_t_2)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
       __Pyx_INCREF(__pyx_t_2);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_3, function);
     }
   }
   __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_2, __pyx_v_dimensions) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_dimensions);
   __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1134, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1191, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_v_pos2 = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "soapcw/soapcw.pyx":1137
+  /* "soapcw/soapcw.pyx":1194
  * 
  * 
  *         range_j = list(itertools.product(range(n),repeat=length-3))             # <<<<<<<<<<<<<<
  * 
  *         for i in range(width):
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_itertools); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1137, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_itertools); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1194, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_product); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1137, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_product); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1194, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_n); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1137, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_n); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1194, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_builtin_range, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1137, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_builtin_range, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1194, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1137, __pyx_L1_error)
+  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1194, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_2);
   PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_2);
   __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1137, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1194, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_6 = __Pyx_PyInt_From_long((__pyx_v_length - 3)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1137, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyInt_From_long((__pyx_v_length - 3)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1194, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_repeat, __pyx_t_6) < 0) __PYX_ERR(0, 1137, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_repeat, __pyx_t_6) < 0) __PYX_ERR(0, 1194, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_1, __pyx_t_2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1137, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_1, __pyx_t_2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1194, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = PySequence_List(__pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1137, __pyx_L1_error)
+  __pyx_t_2 = PySequence_List(__pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1194, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_v_range_j = ((PyObject*)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "soapcw/soapcw.pyx":1139
+  /* "soapcw/soapcw.pyx":1196
  *         range_j = list(itertools.product(range(n),repeat=length-3))
  * 
  *         for i in range(width):             # <<<<<<<<<<<<<<
  *             for j in range_j:
  *                 temp = -1e6
  */
   __pyx_t_11 = __pyx_v_width;
   __pyx_t_14 = __pyx_t_11;
   for (__pyx_t_15 = 0; __pyx_t_15 < __pyx_t_14; __pyx_t_15+=1) {
     __pyx_v_i = __pyx_t_15;
 
-    /* "soapcw/soapcw.pyx":1140
+    /* "soapcw/soapcw.pyx":1197
  * 
  *         for i in range(width):
  *             for j in range_j:             # <<<<<<<<<<<<<<
  *                 temp = -1e6
  *                 for k in range(n):
  */
     __pyx_t_2 = __pyx_v_range_j; __Pyx_INCREF(__pyx_t_2); __pyx_t_12 = 0;
     for (;;) {
       if (__pyx_t_12 >= PyList_GET_SIZE(__pyx_t_2)) break;
       #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-      __pyx_t_6 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_12); __Pyx_INCREF(__pyx_t_6); __pyx_t_12++; if (unlikely(0 < 0)) __PYX_ERR(0, 1140, __pyx_L1_error)
+      __pyx_t_6 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_12); __Pyx_INCREF(__pyx_t_6); __pyx_t_12++; if (unlikely(0 < 0)) __PYX_ERR(0, 1197, __pyx_L1_error)
       #else
-      __pyx_t_6 = PySequence_ITEM(__pyx_t_2, __pyx_t_12); __pyx_t_12++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1140, __pyx_L1_error)
+      __pyx_t_6 = PySequence_ITEM(__pyx_t_2, __pyx_t_12); __pyx_t_12++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1197, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_6);
       #endif
       __Pyx_XDECREF_SET(__pyx_v_j, __pyx_t_6);
       __pyx_t_6 = 0;
 
-      /* "soapcw/soapcw.pyx":1141
+      /* "soapcw/soapcw.pyx":1198
  *         for i in range(width):
  *             for j in range_j:
  *                 temp = -1e6             # <<<<<<<<<<<<<<
  *                 for k in range(n):
  *                     if i+k-1>=0 and i+k-1<width:
  */
       __pyx_v_temp = -1e6;
 
-      /* "soapcw/soapcw.pyx":1142
+      /* "soapcw/soapcw.pyx":1199
  *             for j in range_j:
  *                 temp = -1e6
  *                 for k in range(n):             # <<<<<<<<<<<<<<
  *                     if i+k-1>=0 and i+k-1<width:
  *                         for m in range(n):
  */
       __pyx_t_16 = __pyx_v_n;
       __pyx_t_17 = __pyx_t_16;
       for (__pyx_t_18 = 0; __pyx_t_18 < __pyx_t_17; __pyx_t_18+=1) {
         __pyx_v_k = __pyx_t_18;
 
-        /* "soapcw/soapcw.pyx":1143
+        /* "soapcw/soapcw.pyx":1200
  *                 temp = -1e6
  *                 for k in range(n):
  *                     if i+k-1>=0 and i+k-1<width:             # <<<<<<<<<<<<<<
  *                         for m in range(n):
  *                             if i+m-1>=0 and i+m-1<width:
  */
         __pyx_t_19 = ((((__pyx_v_i + __pyx_v_k) - 1) >= 0) != 0);
@@ -22247,27 +22585,27 @@
           goto __pyx_L13_bool_binop_done;
         }
         __pyx_t_19 = ((((__pyx_v_i + __pyx_v_k) - 1) < __pyx_v_width) != 0);
         __pyx_t_5 = __pyx_t_19;
         __pyx_L13_bool_binop_done:;
         if (__pyx_t_5) {
 
-          /* "soapcw/soapcw.pyx":1144
+          /* "soapcw/soapcw.pyx":1201
  *                 for k in range(n):
  *                     if i+k-1>=0 and i+k-1<width:
  *                         for m in range(n):             # <<<<<<<<<<<<<<
  *                             if i+m-1>=0 and i+m-1<width:
  *                                 value = obs1[0][i+k-1] + obs2[0][i+m-1] + tr[tuple(np.ones(len(shape)-2).astype('int'))][k][m]
  */
           __pyx_t_20 = __pyx_v_n;
           __pyx_t_21 = __pyx_t_20;
           for (__pyx_t_22 = 0; __pyx_t_22 < __pyx_t_21; __pyx_t_22+=1) {
             __pyx_v_m = __pyx_t_22;
 
-            /* "soapcw/soapcw.pyx":1145
+            /* "soapcw/soapcw.pyx":1202
  *                     if i+k-1>=0 and i+k-1<width:
  *                         for m in range(n):
  *                             if i+m-1>=0 and i+m-1<width:             # <<<<<<<<<<<<<<
  *                                 value = obs1[0][i+k-1] + obs2[0][i+m-1] + tr[tuple(np.ones(len(shape)-2).astype('int'))][k][m]
  *                                 if value>temp:
  */
             __pyx_t_19 = ((((__pyx_v_i + __pyx_v_m) - 1) >= 0) != 0);
@@ -22277,15 +22615,15 @@
               goto __pyx_L18_bool_binop_done;
             }
             __pyx_t_19 = ((((__pyx_v_i + __pyx_v_m) - 1) < __pyx_v_width) != 0);
             __pyx_t_5 = __pyx_t_19;
             __pyx_L18_bool_binop_done:;
             if (__pyx_t_5) {
 
-              /* "soapcw/soapcw.pyx":1146
+              /* "soapcw/soapcw.pyx":1203
  *                         for m in range(n):
  *                             if i+m-1>=0 and i+m-1<width:
  *                                 value = obs1[0][i+k-1] + obs2[0][i+m-1] + tr[tuple(np.ones(len(shape)-2).astype('int'))][k][m]             # <<<<<<<<<<<<<<
  *                                 if value>temp:
  *                                     temp = value
  */
               __pyx_t_23 = 0;
@@ -22297,252 +22635,252 @@
               } else if (unlikely(__pyx_t_23 >= __pyx_v_obs1.shape[0])) __pyx_t_25 = 0;
               if (__pyx_t_24 < 0) {
                 __pyx_t_24 += __pyx_v_obs1.shape[1];
                 if (unlikely(__pyx_t_24 < 0)) __pyx_t_25 = 1;
               } else if (unlikely(__pyx_t_24 >= __pyx_v_obs1.shape[1])) __pyx_t_25 = 1;
               if (unlikely(__pyx_t_25 != -1)) {
                 __Pyx_RaiseBufferIndexError(__pyx_t_25);
-                __PYX_ERR(0, 1146, __pyx_L1_error)
+                __PYX_ERR(0, 1203, __pyx_L1_error)
               }
               __pyx_t_26 = 0;
               __pyx_t_27 = ((__pyx_v_i + __pyx_v_m) - 1);
               __pyx_t_25 = -1;
               if (__pyx_t_26 < 0) {
                 __pyx_t_26 += __pyx_v_obs2.shape[0];
                 if (unlikely(__pyx_t_26 < 0)) __pyx_t_25 = 0;
               } else if (unlikely(__pyx_t_26 >= __pyx_v_obs2.shape[0])) __pyx_t_25 = 0;
               if (__pyx_t_27 < 0) {
                 __pyx_t_27 += __pyx_v_obs2.shape[1];
                 if (unlikely(__pyx_t_27 < 0)) __pyx_t_25 = 1;
               } else if (unlikely(__pyx_t_27 >= __pyx_v_obs2.shape[1])) __pyx_t_25 = 1;
               if (unlikely(__pyx_t_25 != -1)) {
                 __Pyx_RaiseBufferIndexError(__pyx_t_25);
-                __PYX_ERR(0, 1146, __pyx_L1_error)
+                __PYX_ERR(0, 1203, __pyx_L1_error)
               }
-              __pyx_t_6 = PyFloat_FromDouble(((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_obs1.data + __pyx_t_23 * __pyx_v_obs1.strides[0]) ) + __pyx_t_24 * __pyx_v_obs1.strides[1]) ))) + (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_obs2.data + __pyx_t_26 * __pyx_v_obs2.strides[0]) ) + __pyx_t_27 * __pyx_v_obs2.strides[1]) ))))); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1146, __pyx_L1_error)
+              __pyx_t_6 = PyFloat_FromDouble(((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_obs1.data + __pyx_t_23 * __pyx_v_obs1.strides[0]) ) + __pyx_t_24 * __pyx_v_obs1.strides[1]) ))) + (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_obs2.data + __pyx_t_26 * __pyx_v_obs2.strides[0]) ) + __pyx_t_27 * __pyx_v_obs2.strides[1]) ))))); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1203, __pyx_L1_error)
               __Pyx_GOTREF(__pyx_t_6);
-              __Pyx_GetModuleGlobalName(__pyx_t_28, __pyx_n_s_np); if (unlikely(!__pyx_t_28)) __PYX_ERR(0, 1146, __pyx_L1_error)
+              __Pyx_GetModuleGlobalName(__pyx_t_28, __pyx_n_s_np); if (unlikely(!__pyx_t_28)) __PYX_ERR(0, 1203, __pyx_L1_error)
               __Pyx_GOTREF(__pyx_t_28);
-              __pyx_t_29 = __Pyx_PyObject_GetAttrStr(__pyx_t_28, __pyx_n_s_ones); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1146, __pyx_L1_error)
+              __pyx_t_29 = __Pyx_PyObject_GetAttrStr(__pyx_t_28, __pyx_n_s_ones); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1203, __pyx_L1_error)
               __Pyx_GOTREF(__pyx_t_29);
               __Pyx_DECREF(__pyx_t_28); __pyx_t_28 = 0;
-              __pyx_t_4 = PyObject_Length(__pyx_v_shape); if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1146, __pyx_L1_error)
-              __pyx_t_28 = PyInt_FromSsize_t((__pyx_t_4 - 2)); if (unlikely(!__pyx_t_28)) __PYX_ERR(0, 1146, __pyx_L1_error)
+              __pyx_t_4 = PyObject_Length(__pyx_v_shape); if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1203, __pyx_L1_error)
+              __pyx_t_28 = PyInt_FromSsize_t((__pyx_t_4 - 2)); if (unlikely(!__pyx_t_28)) __PYX_ERR(0, 1203, __pyx_L1_error)
               __Pyx_GOTREF(__pyx_t_28);
               __pyx_t_30 = NULL;
               if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_29))) {
                 __pyx_t_30 = PyMethod_GET_SELF(__pyx_t_29);
                 if (likely(__pyx_t_30)) {
                   PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_29);
                   __Pyx_INCREF(__pyx_t_30);
                   __Pyx_INCREF(function);
                   __Pyx_DECREF_SET(__pyx_t_29, function);
                 }
               }
               __pyx_t_3 = (__pyx_t_30) ? __Pyx_PyObject_Call2Args(__pyx_t_29, __pyx_t_30, __pyx_t_28) : __Pyx_PyObject_CallOneArg(__pyx_t_29, __pyx_t_28);
               __Pyx_XDECREF(__pyx_t_30); __pyx_t_30 = 0;
               __Pyx_DECREF(__pyx_t_28); __pyx_t_28 = 0;
-              if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1146, __pyx_L1_error)
+              if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1203, __pyx_L1_error)
               __Pyx_GOTREF(__pyx_t_3);
               __Pyx_DECREF(__pyx_t_29); __pyx_t_29 = 0;
-              __pyx_t_29 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_astype); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1146, __pyx_L1_error)
+              __pyx_t_29 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_astype); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1203, __pyx_L1_error)
               __Pyx_GOTREF(__pyx_t_29);
               __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
               __pyx_t_3 = NULL;
               if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_29))) {
                 __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_29);
                 if (likely(__pyx_t_3)) {
                   PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_29);
                   __Pyx_INCREF(__pyx_t_3);
                   __Pyx_INCREF(function);
                   __Pyx_DECREF_SET(__pyx_t_29, function);
                 }
               }
               __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_29, __pyx_t_3, __pyx_n_u_int) : __Pyx_PyObject_CallOneArg(__pyx_t_29, __pyx_n_u_int);
               __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-              if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1146, __pyx_L1_error)
+              if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1203, __pyx_L1_error)
               __Pyx_GOTREF(__pyx_t_1);
               __Pyx_DECREF(__pyx_t_29); __pyx_t_29 = 0;
-              __pyx_t_29 = __Pyx_PySequence_Tuple(__pyx_t_1); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1146, __pyx_L1_error)
+              __pyx_t_29 = __Pyx_PySequence_Tuple(__pyx_t_1); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1203, __pyx_L1_error)
               __Pyx_GOTREF(__pyx_t_29);
               __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-              __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_v_tr, __pyx_t_29); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1146, __pyx_L1_error)
+              __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_v_tr, __pyx_t_29); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1203, __pyx_L1_error)
               __Pyx_GOTREF(__pyx_t_1);
               __Pyx_DECREF(__pyx_t_29); __pyx_t_29 = 0;
-              __pyx_t_29 = __Pyx_GetItemInt(__pyx_t_1, __pyx_v_k, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1146, __pyx_L1_error)
+              __pyx_t_29 = __Pyx_GetItemInt(__pyx_t_1, __pyx_v_k, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1203, __pyx_L1_error)
               __Pyx_GOTREF(__pyx_t_29);
               __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-              __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_29, __pyx_v_m, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1146, __pyx_L1_error)
+              __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_29, __pyx_v_m, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1203, __pyx_L1_error)
               __Pyx_GOTREF(__pyx_t_1);
               __Pyx_DECREF(__pyx_t_29); __pyx_t_29 = 0;
-              __pyx_t_29 = PyNumber_Add(__pyx_t_6, __pyx_t_1); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1146, __pyx_L1_error)
+              __pyx_t_29 = PyNumber_Add(__pyx_t_6, __pyx_t_1); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1203, __pyx_L1_error)
               __Pyx_GOTREF(__pyx_t_29);
               __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
               __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-              __pyx_t_31 = __pyx_PyFloat_AsDouble(__pyx_t_29); if (unlikely((__pyx_t_31 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1146, __pyx_L1_error)
+              __pyx_t_31 = __pyx_PyFloat_AsDouble(__pyx_t_29); if (unlikely((__pyx_t_31 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1203, __pyx_L1_error)
               __Pyx_DECREF(__pyx_t_29); __pyx_t_29 = 0;
               __pyx_v_value = __pyx_t_31;
 
-              /* "soapcw/soapcw.pyx":1147
+              /* "soapcw/soapcw.pyx":1204
  *                             if i+m-1>=0 and i+m-1<width:
  *                                 value = obs1[0][i+k-1] + obs2[0][i+m-1] + tr[tuple(np.ones(len(shape)-2).astype('int'))][k][m]
  *                                 if value>temp:             # <<<<<<<<<<<<<<
  *                                     temp = value
  *                                     val[0][i][j]    = value
  */
               __pyx_t_5 = ((__pyx_v_value > __pyx_v_temp) != 0);
               if (__pyx_t_5) {
 
-                /* "soapcw/soapcw.pyx":1148
+                /* "soapcw/soapcw.pyx":1205
  *                                 value = obs1[0][i+k-1] + obs2[0][i+m-1] + tr[tuple(np.ones(len(shape)-2).astype('int'))][k][m]
  *                                 if value>temp:
  *                                     temp = value             # <<<<<<<<<<<<<<
  *                                     val[0][i][j]    = value
  *                                     prev[0][i][j]   = np.nan
  */
                 __pyx_v_temp = __pyx_v_value;
 
-                /* "soapcw/soapcw.pyx":1149
+                /* "soapcw/soapcw.pyx":1206
  *                                 if value>temp:
  *                                     temp = value
  *                                     val[0][i][j]    = value             # <<<<<<<<<<<<<<
  *                                     prev[0][i][j]   = np.nan
  *                                     pos1[0][i][j]   = k
  */
-                __pyx_t_29 = PyFloat_FromDouble(__pyx_v_value); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1149, __pyx_L1_error)
+                __pyx_t_29 = PyFloat_FromDouble(__pyx_v_value); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1206, __pyx_L1_error)
                 __Pyx_GOTREF(__pyx_t_29);
-                __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_val, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1149, __pyx_L1_error)
+                __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_val, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1206, __pyx_L1_error)
                 __Pyx_GOTREF(__pyx_t_1);
-                __pyx_t_6 = __Pyx_GetItemInt(__pyx_t_1, __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1149, __pyx_L1_error)
+                __pyx_t_6 = __Pyx_GetItemInt(__pyx_t_1, __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1206, __pyx_L1_error)
                 __Pyx_GOTREF(__pyx_t_6);
                 __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-                if (unlikely(PyObject_SetItem(__pyx_t_6, __pyx_v_j, __pyx_t_29) < 0)) __PYX_ERR(0, 1149, __pyx_L1_error)
+                if (unlikely(PyObject_SetItem(__pyx_t_6, __pyx_v_j, __pyx_t_29) < 0)) __PYX_ERR(0, 1206, __pyx_L1_error)
                 __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
                 __Pyx_DECREF(__pyx_t_29); __pyx_t_29 = 0;
 
-                /* "soapcw/soapcw.pyx":1150
+                /* "soapcw/soapcw.pyx":1207
  *                                     temp = value
  *                                     val[0][i][j]    = value
  *                                     prev[0][i][j]   = np.nan             # <<<<<<<<<<<<<<
  *                                     pos1[0][i][j]   = k
  *                                     pos2[0][i][j]   = m
  */
-                __Pyx_GetModuleGlobalName(__pyx_t_29, __pyx_n_s_np); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1150, __pyx_L1_error)
+                __Pyx_GetModuleGlobalName(__pyx_t_29, __pyx_n_s_np); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1207, __pyx_L1_error)
                 __Pyx_GOTREF(__pyx_t_29);
-                __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_29, __pyx_n_s_nan); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1150, __pyx_L1_error)
+                __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_29, __pyx_n_s_nan); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1207, __pyx_L1_error)
                 __Pyx_GOTREF(__pyx_t_6);
                 __Pyx_DECREF(__pyx_t_29); __pyx_t_29 = 0;
-                __pyx_t_29 = __Pyx_GetItemInt(__pyx_v_prev, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1150, __pyx_L1_error)
+                __pyx_t_29 = __Pyx_GetItemInt(__pyx_v_prev, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1207, __pyx_L1_error)
                 __Pyx_GOTREF(__pyx_t_29);
-                __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_29, __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1150, __pyx_L1_error)
+                __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_29, __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1207, __pyx_L1_error)
                 __Pyx_GOTREF(__pyx_t_1);
                 __Pyx_DECREF(__pyx_t_29); __pyx_t_29 = 0;
-                if (unlikely(PyObject_SetItem(__pyx_t_1, __pyx_v_j, __pyx_t_6) < 0)) __PYX_ERR(0, 1150, __pyx_L1_error)
+                if (unlikely(PyObject_SetItem(__pyx_t_1, __pyx_v_j, __pyx_t_6) < 0)) __PYX_ERR(0, 1207, __pyx_L1_error)
                 __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
                 __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
 
-                /* "soapcw/soapcw.pyx":1151
+                /* "soapcw/soapcw.pyx":1208
  *                                     val[0][i][j]    = value
  *                                     prev[0][i][j]   = np.nan
  *                                     pos1[0][i][j]   = k             # <<<<<<<<<<<<<<
  *                                     pos2[0][i][j]   = m
  * 
  */
-                __pyx_t_6 = __Pyx_PyInt_From_int(__pyx_v_k); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1151, __pyx_L1_error)
+                __pyx_t_6 = __Pyx_PyInt_From_int(__pyx_v_k); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1208, __pyx_L1_error)
                 __Pyx_GOTREF(__pyx_t_6);
-                __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_pos1, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1151, __pyx_L1_error)
+                __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_pos1, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1208, __pyx_L1_error)
                 __Pyx_GOTREF(__pyx_t_1);
-                __pyx_t_29 = __Pyx_GetItemInt(__pyx_t_1, __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1151, __pyx_L1_error)
+                __pyx_t_29 = __Pyx_GetItemInt(__pyx_t_1, __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1208, __pyx_L1_error)
                 __Pyx_GOTREF(__pyx_t_29);
                 __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-                if (unlikely(PyObject_SetItem(__pyx_t_29, __pyx_v_j, __pyx_t_6) < 0)) __PYX_ERR(0, 1151, __pyx_L1_error)
+                if (unlikely(PyObject_SetItem(__pyx_t_29, __pyx_v_j, __pyx_t_6) < 0)) __PYX_ERR(0, 1208, __pyx_L1_error)
                 __Pyx_DECREF(__pyx_t_29); __pyx_t_29 = 0;
                 __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
 
-                /* "soapcw/soapcw.pyx":1152
+                /* "soapcw/soapcw.pyx":1209
  *                                     prev[0][i][j]   = np.nan
  *                                     pos1[0][i][j]   = k
  *                                     pos2[0][i][j]   = m             # <<<<<<<<<<<<<<
  * 
  *         pbar = 0
  */
-                __pyx_t_6 = __Pyx_PyInt_From_int(__pyx_v_m); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1152, __pyx_L1_error)
+                __pyx_t_6 = __Pyx_PyInt_From_int(__pyx_v_m); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1209, __pyx_L1_error)
                 __Pyx_GOTREF(__pyx_t_6);
-                __pyx_t_29 = __Pyx_GetItemInt(__pyx_v_pos2, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1152, __pyx_L1_error)
+                __pyx_t_29 = __Pyx_GetItemInt(__pyx_v_pos2, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1209, __pyx_L1_error)
                 __Pyx_GOTREF(__pyx_t_29);
-                __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_29, __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1152, __pyx_L1_error)
+                __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_29, __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1209, __pyx_L1_error)
                 __Pyx_GOTREF(__pyx_t_1);
                 __Pyx_DECREF(__pyx_t_29); __pyx_t_29 = 0;
-                if (unlikely(PyObject_SetItem(__pyx_t_1, __pyx_v_j, __pyx_t_6) < 0)) __PYX_ERR(0, 1152, __pyx_L1_error)
+                if (unlikely(PyObject_SetItem(__pyx_t_1, __pyx_v_j, __pyx_t_6) < 0)) __PYX_ERR(0, 1209, __pyx_L1_error)
                 __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
                 __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
 
-                /* "soapcw/soapcw.pyx":1147
+                /* "soapcw/soapcw.pyx":1204
  *                             if i+m-1>=0 and i+m-1<width:
  *                                 value = obs1[0][i+k-1] + obs2[0][i+m-1] + tr[tuple(np.ones(len(shape)-2).astype('int'))][k][m]
  *                                 if value>temp:             # <<<<<<<<<<<<<<
  *                                     temp = value
  *                                     val[0][i][j]    = value
  */
               }
 
-              /* "soapcw/soapcw.pyx":1145
+              /* "soapcw/soapcw.pyx":1202
  *                     if i+k-1>=0 and i+k-1<width:
  *                         for m in range(n):
  *                             if i+m-1>=0 and i+m-1<width:             # <<<<<<<<<<<<<<
  *                                 value = obs1[0][i+k-1] + obs2[0][i+m-1] + tr[tuple(np.ones(len(shape)-2).astype('int'))][k][m]
  *                                 if value>temp:
  */
             }
           }
 
-          /* "soapcw/soapcw.pyx":1143
+          /* "soapcw/soapcw.pyx":1200
  *                 temp = -1e6
  *                 for k in range(n):
  *                     if i+k-1>=0 and i+k-1<width:             # <<<<<<<<<<<<<<
  *                         for m in range(n):
  *                             if i+m-1>=0 and i+m-1<width:
  */
         }
       }
 
-      /* "soapcw/soapcw.pyx":1140
+      /* "soapcw/soapcw.pyx":1197
  * 
  *         for i in range(width):
  *             for j in range_j:             # <<<<<<<<<<<<<<
  *                 temp = -1e6
  *                 for k in range(n):
  */
     }
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   }
 
-  /* "soapcw/soapcw.pyx":1154
+  /* "soapcw/soapcw.pyx":1211
  *                                     pos2[0][i][j]   = m
  * 
  *         pbar = 0             # <<<<<<<<<<<<<<
  *         for t in range(1,length_t):
  *             obs1t = obs1[t]
  */
   __Pyx_INCREF(__pyx_int_0);
   __pyx_v_pbar = __pyx_int_0;
 
-  /* "soapcw/soapcw.pyx":1155
+  /* "soapcw/soapcw.pyx":1212
  * 
  *         pbar = 0
  *         for t in range(1,length_t):             # <<<<<<<<<<<<<<
  *             obs1t = obs1[t]
  *             obs2t = obs2[t]
  */
   __pyx_t_11 = __pyx_v_length_t;
   __pyx_t_14 = __pyx_t_11;
   for (__pyx_t_15 = 1; __pyx_t_15 < __pyx_t_14; __pyx_t_15+=1) {
     __pyx_v_t = __pyx_t_15;
 
-    /* "soapcw/soapcw.pyx":1156
+    /* "soapcw/soapcw.pyx":1213
  *         pbar = 0
  *         for t in range(1,length_t):
  *             obs1t = obs1[t]             # <<<<<<<<<<<<<<
  *             obs2t = obs2[t]
  *             valt = val[t-1]
  */
     __pyx_t_10.data = __pyx_v_obs1.data;
@@ -22553,32 +22891,32 @@
         Py_ssize_t __pyx_tmp_shape = __pyx_v_obs1.shape[0];
     Py_ssize_t __pyx_tmp_stride = __pyx_v_obs1.strides[0];
         if (__pyx_tmp_idx < 0)
             __pyx_tmp_idx += __pyx_tmp_shape;
         if (unlikely(!__Pyx_is_valid_index(__pyx_tmp_idx, __pyx_tmp_shape))) {
             PyErr_SetString(PyExc_IndexError,
                             "Index out of bounds (axis 0)");
-            __PYX_ERR(0, 1156, __pyx_L1_error)
+            __PYX_ERR(0, 1213, __pyx_L1_error)
         }
         __pyx_t_10.data += __pyx_tmp_idx * __pyx_tmp_stride;
 }
 
 __pyx_t_10.shape[0] = __pyx_v_obs1.shape[1];
 __pyx_t_10.strides[0] = __pyx_v_obs1.strides[1];
     __pyx_t_10.suboffsets[0] = -1;
 
-__pyx_t_2 = __pyx_memoryview_fromslice(__pyx_t_10, 1, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1156, __pyx_L1_error)
+__pyx_t_2 = __pyx_memoryview_fromslice(__pyx_t_10, 1, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1213, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __PYX_XDEC_MEMVIEW(&__pyx_t_10, 1);
     __pyx_t_10.memview = NULL;
     __pyx_t_10.data = NULL;
     __Pyx_XDECREF_SET(__pyx_v_obs1t, __pyx_t_2);
     __pyx_t_2 = 0;
 
-    /* "soapcw/soapcw.pyx":1157
+    /* "soapcw/soapcw.pyx":1214
  *         for t in range(1,length_t):
  *             obs1t = obs1[t]
  *             obs2t = obs2[t]             # <<<<<<<<<<<<<<
  *             valt = val[t-1]
  *             pt = t/float(length_t)*100.
  */
     __pyx_t_10.data = __pyx_v_obs2.data;
@@ -22589,161 +22927,161 @@
         Py_ssize_t __pyx_tmp_shape = __pyx_v_obs2.shape[0];
     Py_ssize_t __pyx_tmp_stride = __pyx_v_obs2.strides[0];
         if (__pyx_tmp_idx < 0)
             __pyx_tmp_idx += __pyx_tmp_shape;
         if (unlikely(!__Pyx_is_valid_index(__pyx_tmp_idx, __pyx_tmp_shape))) {
             PyErr_SetString(PyExc_IndexError,
                             "Index out of bounds (axis 0)");
-            __PYX_ERR(0, 1157, __pyx_L1_error)
+            __PYX_ERR(0, 1214, __pyx_L1_error)
         }
         __pyx_t_10.data += __pyx_tmp_idx * __pyx_tmp_stride;
 }
 
 __pyx_t_10.shape[0] = __pyx_v_obs2.shape[1];
 __pyx_t_10.strides[0] = __pyx_v_obs2.strides[1];
     __pyx_t_10.suboffsets[0] = -1;
 
-__pyx_t_2 = __pyx_memoryview_fromslice(__pyx_t_10, 1, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1157, __pyx_L1_error)
+__pyx_t_2 = __pyx_memoryview_fromslice(__pyx_t_10, 1, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1214, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __PYX_XDEC_MEMVIEW(&__pyx_t_10, 1);
     __pyx_t_10.memview = NULL;
     __pyx_t_10.data = NULL;
     __Pyx_XDECREF_SET(__pyx_v_obs2t, __pyx_t_2);
     __pyx_t_2 = 0;
 
-    /* "soapcw/soapcw.pyx":1158
+    /* "soapcw/soapcw.pyx":1215
  *             obs1t = obs1[t]
  *             obs2t = obs2[t]
  *             valt = val[t-1]             # <<<<<<<<<<<<<<
  *             pt = t/float(length_t)*100.
  *             for i in range(width):
  */
     __pyx_t_32 = (__pyx_v_t - 1);
-    __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_val, __pyx_t_32, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1158, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_val, __pyx_t_32, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1215, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_XDECREF_SET(__pyx_v_valt, __pyx_t_2);
     __pyx_t_2 = 0;
 
-    /* "soapcw/soapcw.pyx":1159
+    /* "soapcw/soapcw.pyx":1216
  *             obs2t = obs2[t]
  *             valt = val[t-1]
  *             pt = t/float(length_t)*100.             # <<<<<<<<<<<<<<
  *             for i in range(width):
  *                 for j in range_j:
  */
     if (unlikely(((double)__pyx_v_length_t) == 0)) {
       PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-      __PYX_ERR(0, 1159, __pyx_L1_error)
+      __PYX_ERR(0, 1216, __pyx_L1_error)
     }
     __pyx_v_pt = ((((double)__pyx_v_t) / ((double)__pyx_v_length_t)) * 100.);
 
-    /* "soapcw/soapcw.pyx":1160
+    /* "soapcw/soapcw.pyx":1217
  *             valt = val[t-1]
  *             pt = t/float(length_t)*100.
  *             for i in range(width):             # <<<<<<<<<<<<<<
  *                 for j in range_j:
  *                     cond = True
  */
     __pyx_t_16 = __pyx_v_width;
     __pyx_t_17 = __pyx_t_16;
     for (__pyx_t_18 = 0; __pyx_t_18 < __pyx_t_17; __pyx_t_18+=1) {
       __pyx_v_i = __pyx_t_18;
 
-      /* "soapcw/soapcw.pyx":1161
+      /* "soapcw/soapcw.pyx":1218
  *             pt = t/float(length_t)*100.
  *             for i in range(width):
  *                 for j in range_j:             # <<<<<<<<<<<<<<
  *                     cond = True
  *                     for c in range(1,len(j)+1):
  */
       __pyx_t_2 = __pyx_v_range_j; __Pyx_INCREF(__pyx_t_2); __pyx_t_12 = 0;
       for (;;) {
         if (__pyx_t_12 >= PyList_GET_SIZE(__pyx_t_2)) break;
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_6 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_12); __Pyx_INCREF(__pyx_t_6); __pyx_t_12++; if (unlikely(0 < 0)) __PYX_ERR(0, 1161, __pyx_L1_error)
+        __pyx_t_6 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_12); __Pyx_INCREF(__pyx_t_6); __pyx_t_12++; if (unlikely(0 < 0)) __PYX_ERR(0, 1218, __pyx_L1_error)
         #else
-        __pyx_t_6 = PySequence_ITEM(__pyx_t_2, __pyx_t_12); __pyx_t_12++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1161, __pyx_L1_error)
+        __pyx_t_6 = PySequence_ITEM(__pyx_t_2, __pyx_t_12); __pyx_t_12++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1218, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         #endif
         __Pyx_XDECREF_SET(__pyx_v_j, __pyx_t_6);
         __pyx_t_6 = 0;
 
-        /* "soapcw/soapcw.pyx":1162
+        /* "soapcw/soapcw.pyx":1219
  *             for i in range(width):
  *                 for j in range_j:
  *                     cond = True             # <<<<<<<<<<<<<<
  *                     for c in range(1,len(j)+1):
  *                         b = i+np.sum(j[:c])-len(j[:c])
  */
         __pyx_v_cond = 1;
 
-        /* "soapcw/soapcw.pyx":1163
+        /* "soapcw/soapcw.pyx":1220
  *                 for j in range_j:
  *                     cond = True
  *                     for c in range(1,len(j)+1):             # <<<<<<<<<<<<<<
  *                         b = i+np.sum(j[:c])-len(j[:c])
  *                         if b >= 0 and b<width:
  */
-        __pyx_t_4 = PyObject_Length(__pyx_v_j); if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1163, __pyx_L1_error)
+        __pyx_t_4 = PyObject_Length(__pyx_v_j); if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1220, __pyx_L1_error)
         __pyx_t_33 = (__pyx_t_4 + 1);
         __pyx_t_4 = __pyx_t_33;
         for (__pyx_t_34 = 1; __pyx_t_34 < __pyx_t_4; __pyx_t_34+=1) {
           __pyx_v_c = __pyx_t_34;
 
-          /* "soapcw/soapcw.pyx":1164
+          /* "soapcw/soapcw.pyx":1221
  *                     cond = True
  *                     for c in range(1,len(j)+1):
  *                         b = i+np.sum(j[:c])-len(j[:c])             # <<<<<<<<<<<<<<
  *                         if b >= 0 and b<width:
  *                             continue
  */
-          __pyx_t_6 = __Pyx_PyInt_From_int(__pyx_v_i); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1164, __pyx_L1_error)
+          __pyx_t_6 = __Pyx_PyInt_From_int(__pyx_v_i); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1221, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
-          __Pyx_GetModuleGlobalName(__pyx_t_29, __pyx_n_s_np); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1164, __pyx_L1_error)
+          __Pyx_GetModuleGlobalName(__pyx_t_29, __pyx_n_s_np); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1221, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_29);
-          __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_29, __pyx_n_s_sum); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1164, __pyx_L1_error)
+          __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_29, __pyx_n_s_sum); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1221, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_3);
           __Pyx_DECREF(__pyx_t_29); __pyx_t_29 = 0;
-          __pyx_t_29 = __Pyx_PyObject_GetSlice(__pyx_v_j, 0, __pyx_v_c, NULL, NULL, NULL, 0, 1, 1); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1164, __pyx_L1_error)
+          __pyx_t_29 = __Pyx_PyObject_GetSlice(__pyx_v_j, 0, __pyx_v_c, NULL, NULL, NULL, 0, 1, 1); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1221, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_29);
           __pyx_t_28 = NULL;
           if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
             __pyx_t_28 = PyMethod_GET_SELF(__pyx_t_3);
             if (likely(__pyx_t_28)) {
               PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
               __Pyx_INCREF(__pyx_t_28);
               __Pyx_INCREF(function);
               __Pyx_DECREF_SET(__pyx_t_3, function);
             }
           }
           __pyx_t_1 = (__pyx_t_28) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_28, __pyx_t_29) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_29);
           __Pyx_XDECREF(__pyx_t_28); __pyx_t_28 = 0;
           __Pyx_DECREF(__pyx_t_29); __pyx_t_29 = 0;
-          if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1164, __pyx_L1_error)
+          if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1221, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_1);
           __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-          __pyx_t_3 = PyNumber_Add(__pyx_t_6, __pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1164, __pyx_L1_error)
+          __pyx_t_3 = PyNumber_Add(__pyx_t_6, __pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1221, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_3);
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-          __pyx_t_1 = __Pyx_PyObject_GetSlice(__pyx_v_j, 0, __pyx_v_c, NULL, NULL, NULL, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1164, __pyx_L1_error)
+          __pyx_t_1 = __Pyx_PyObject_GetSlice(__pyx_v_j, 0, __pyx_v_c, NULL, NULL, NULL, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1221, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_1);
-          __pyx_t_35 = PyObject_Length(__pyx_t_1); if (unlikely(__pyx_t_35 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1164, __pyx_L1_error)
+          __pyx_t_35 = PyObject_Length(__pyx_t_1); if (unlikely(__pyx_t_35 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1221, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-          __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_35); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1164, __pyx_L1_error)
+          __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_35); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1221, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_1);
-          __pyx_t_6 = PyNumber_Subtract(__pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1164, __pyx_L1_error)
+          __pyx_t_6 = PyNumber_Subtract(__pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1221, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
           __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
           __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-          __pyx_t_20 = __Pyx_PyInt_As_int(__pyx_t_6); if (unlikely((__pyx_t_20 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 1164, __pyx_L1_error)
+          __pyx_t_20 = __Pyx_PyInt_As_int(__pyx_t_6); if (unlikely((__pyx_t_20 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 1221, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_v_b = __pyx_t_20;
 
-          /* "soapcw/soapcw.pyx":1165
+          /* "soapcw/soapcw.pyx":1222
  *                     for c in range(1,len(j)+1):
  *                         b = i+np.sum(j[:c])-len(j[:c])
  *                         if b >= 0 and b<width:             # <<<<<<<<<<<<<<
  *                             continue
  *                         else:
  */
           __pyx_t_19 = ((__pyx_v_b >= 0) != 0);
@@ -22753,198 +23091,198 @@
             goto __pyx_L30_bool_binop_done;
           }
           __pyx_t_19 = ((__pyx_v_b < __pyx_v_width) != 0);
           __pyx_t_5 = __pyx_t_19;
           __pyx_L30_bool_binop_done:;
           if (__pyx_t_5) {
 
-            /* "soapcw/soapcw.pyx":1166
+            /* "soapcw/soapcw.pyx":1223
  *                         b = i+np.sum(j[:c])-len(j[:c])
  *                         if b >= 0 and b<width:
  *                             continue             # <<<<<<<<<<<<<<
  *                         else:
  *                             cond = False
  */
             goto __pyx_L27_continue;
 
-            /* "soapcw/soapcw.pyx":1165
+            /* "soapcw/soapcw.pyx":1222
  *                     for c in range(1,len(j)+1):
  *                         b = i+np.sum(j[:c])-len(j[:c])
  *                         if b >= 0 and b<width:             # <<<<<<<<<<<<<<
  *                             continue
  *                         else:
  */
           }
 
-          /* "soapcw/soapcw.pyx":1168
+          /* "soapcw/soapcw.pyx":1225
  *                             continue
  *                         else:
  *                             cond = False             # <<<<<<<<<<<<<<
  *                             break
  *                     if cond:
  */
           /*else*/ {
             __pyx_v_cond = 0;
 
-            /* "soapcw/soapcw.pyx":1169
+            /* "soapcw/soapcw.pyx":1226
  *                         else:
  *                             cond = False
  *                             break             # <<<<<<<<<<<<<<
  *                     if cond:
  *                         temp = -1e6
  */
             goto __pyx_L28_break;
           }
           __pyx_L27_continue:;
         }
         __pyx_L28_break:;
 
-        /* "soapcw/soapcw.pyx":1170
+        /* "soapcw/soapcw.pyx":1227
  *                             cond = False
  *                             break
  *                     if cond:             # <<<<<<<<<<<<<<
  *                         temp = -1e6
  *                         for j1 in range(n):
  */
         __pyx_t_5 = (__pyx_v_cond != 0);
         if (__pyx_t_5) {
 
-          /* "soapcw/soapcw.pyx":1171
+          /* "soapcw/soapcw.pyx":1228
  *                             break
  *                     if cond:
  *                         temp = -1e6             # <<<<<<<<<<<<<<
  *                         for j1 in range(n):
  *                             a = list(j[1:])
  */
           __pyx_v_temp = -1e6;
 
-          /* "soapcw/soapcw.pyx":1172
+          /* "soapcw/soapcw.pyx":1229
  *                     if cond:
  *                         temp = -1e6
  *                         for j1 in range(n):             # <<<<<<<<<<<<<<
  *                             a = list(j[1:])
  *                             a.append(j1)
  */
           __pyx_t_20 = __pyx_v_n;
           __pyx_t_21 = __pyx_t_20;
           for (__pyx_t_22 = 0; __pyx_t_22 < __pyx_t_21; __pyx_t_22+=1) {
             __pyx_v_j1 = __pyx_t_22;
 
-            /* "soapcw/soapcw.pyx":1173
+            /* "soapcw/soapcw.pyx":1230
  *                         temp = -1e6
  *                         for j1 in range(n):
  *                             a = list(j[1:])             # <<<<<<<<<<<<<<
  *                             a.append(j1)
  *                             if t<length:
  */
-            __pyx_t_6 = __Pyx_PyObject_GetSlice(__pyx_v_j, 1, 0, NULL, NULL, &__pyx_slice__8, 1, 0, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1173, __pyx_L1_error)
+            __pyx_t_6 = __Pyx_PyObject_GetSlice(__pyx_v_j, 1, 0, NULL, NULL, &__pyx_slice__8, 1, 0, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1230, __pyx_L1_error)
             __Pyx_GOTREF(__pyx_t_6);
-            __pyx_t_1 = PySequence_List(__pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1173, __pyx_L1_error)
+            __pyx_t_1 = PySequence_List(__pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1230, __pyx_L1_error)
             __Pyx_GOTREF(__pyx_t_1);
             __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
             __Pyx_XDECREF_SET(__pyx_v_a, __pyx_t_1);
             __pyx_t_1 = 0;
 
-            /* "soapcw/soapcw.pyx":1174
+            /* "soapcw/soapcw.pyx":1231
  *                         for j1 in range(n):
  *                             a = list(j[1:])
  *                             a.append(j1)             # <<<<<<<<<<<<<<
  *                             if t<length:
  *                                 for n1 in range(len(a)):
  */
-            __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_j1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1174, __pyx_L1_error)
+            __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_j1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1231, __pyx_L1_error)
             __Pyx_GOTREF(__pyx_t_1);
-            __pyx_t_13 = __Pyx_PyObject_Append(__pyx_v_a, __pyx_t_1); if (unlikely(__pyx_t_13 == ((int)-1))) __PYX_ERR(0, 1174, __pyx_L1_error)
+            __pyx_t_13 = __Pyx_PyObject_Append(__pyx_v_a, __pyx_t_1); if (unlikely(__pyx_t_13 == ((int)-1))) __PYX_ERR(0, 1231, __pyx_L1_error)
             __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-            /* "soapcw/soapcw.pyx":1175
+            /* "soapcw/soapcw.pyx":1232
  *                             a = list(j[1:])
  *                             a.append(j1)
  *                             if t<length:             # <<<<<<<<<<<<<<
  *                                 for n1 in range(len(a)):
  *                                     if n1>=t-1:
  */
             __pyx_t_5 = ((__pyx_v_t < __pyx_v_length) != 0);
             if (__pyx_t_5) {
 
-              /* "soapcw/soapcw.pyx":1176
+              /* "soapcw/soapcw.pyx":1233
  *                             a.append(j1)
  *                             if t<length:
  *                                 for n1 in range(len(a)):             # <<<<<<<<<<<<<<
  *                                     if n1>=t-1:
  *                                         a[n1] = 1
  */
-              __pyx_t_33 = PyObject_Length(__pyx_v_a); if (unlikely(__pyx_t_33 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1176, __pyx_L1_error)
+              __pyx_t_33 = PyObject_Length(__pyx_v_a); if (unlikely(__pyx_t_33 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1233, __pyx_L1_error)
               __pyx_t_4 = __pyx_t_33;
               for (__pyx_t_25 = 0; __pyx_t_25 < __pyx_t_4; __pyx_t_25+=1) {
                 __pyx_v_n1 = __pyx_t_25;
 
-                /* "soapcw/soapcw.pyx":1177
+                /* "soapcw/soapcw.pyx":1234
  *                             if t<length:
  *                                 for n1 in range(len(a)):
  *                                     if n1>=t-1:             # <<<<<<<<<<<<<<
  *                                         a[n1] = 1
  *                             a = tuple(a)
  */
                 __pyx_t_5 = ((__pyx_v_n1 >= (__pyx_v_t - 1)) != 0);
                 if (__pyx_t_5) {
 
-                  /* "soapcw/soapcw.pyx":1178
+                  /* "soapcw/soapcw.pyx":1235
  *                                 for n1 in range(len(a)):
  *                                     if n1>=t-1:
  *                                         a[n1] = 1             # <<<<<<<<<<<<<<
  *                             a = tuple(a)
  *                             for k in range(n):
  */
-                  if (unlikely(__Pyx_SetItemInt(__pyx_v_a, __pyx_v_n1, __pyx_int_1, int, 1, __Pyx_PyInt_From_int, 0, 1, 1) < 0)) __PYX_ERR(0, 1178, __pyx_L1_error)
+                  if (unlikely(__Pyx_SetItemInt(__pyx_v_a, __pyx_v_n1, __pyx_int_1, int, 1, __Pyx_PyInt_From_int, 0, 1, 1) < 0)) __PYX_ERR(0, 1235, __pyx_L1_error)
 
-                  /* "soapcw/soapcw.pyx":1177
+                  /* "soapcw/soapcw.pyx":1234
  *                             if t<length:
  *                                 for n1 in range(len(a)):
  *                                     if n1>=t-1:             # <<<<<<<<<<<<<<
  *                                         a[n1] = 1
  *                             a = tuple(a)
  */
                 }
               }
 
-              /* "soapcw/soapcw.pyx":1175
+              /* "soapcw/soapcw.pyx":1232
  *                             a = list(j[1:])
  *                             a.append(j1)
  *                             if t<length:             # <<<<<<<<<<<<<<
  *                                 for n1 in range(len(a)):
  *                                     if n1>=t-1:
  */
             }
 
-            /* "soapcw/soapcw.pyx":1179
+            /* "soapcw/soapcw.pyx":1236
  *                                     if n1>=t-1:
  *                                         a[n1] = 1
  *                             a = tuple(a)             # <<<<<<<<<<<<<<
  *                             for k in range(n):
  *                                 if i+k-1>=0 and i+k-1<width:
  */
-            __pyx_t_1 = __Pyx_PySequence_Tuple(__pyx_v_a); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1179, __pyx_L1_error)
+            __pyx_t_1 = __Pyx_PySequence_Tuple(__pyx_v_a); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1236, __pyx_L1_error)
             __Pyx_GOTREF(__pyx_t_1);
             __Pyx_DECREF_SET(__pyx_v_a, __pyx_t_1);
             __pyx_t_1 = 0;
 
-            /* "soapcw/soapcw.pyx":1180
+            /* "soapcw/soapcw.pyx":1237
  *                                         a[n1] = 1
  *                             a = tuple(a)
  *                             for k in range(n):             # <<<<<<<<<<<<<<
  *                                 if i+k-1>=0 and i+k-1<width:
  *                                     for m in range(n):
  */
             __pyx_t_25 = __pyx_v_n;
             __pyx_t_36 = __pyx_t_25;
             for (__pyx_t_37 = 0; __pyx_t_37 < __pyx_t_36; __pyx_t_37+=1) {
               __pyx_v_k = __pyx_t_37;
 
-              /* "soapcw/soapcw.pyx":1181
+              /* "soapcw/soapcw.pyx":1238
  *                             a = tuple(a)
  *                             for k in range(n):
  *                                 if i+k-1>=0 and i+k-1<width:             # <<<<<<<<<<<<<<
  *                                     for m in range(n):
  *                                         if i+m-1>=0 and i+m-1<width:
  */
               __pyx_t_19 = ((((__pyx_v_i + __pyx_v_k) - 1) >= 0) != 0);
@@ -22954,27 +23292,27 @@
                 goto __pyx_L42_bool_binop_done;
               }
               __pyx_t_19 = ((((__pyx_v_i + __pyx_v_k) - 1) < __pyx_v_width) != 0);
               __pyx_t_5 = __pyx_t_19;
               __pyx_L42_bool_binop_done:;
               if (__pyx_t_5) {
 
-                /* "soapcw/soapcw.pyx":1182
+                /* "soapcw/soapcw.pyx":1239
  *                             for k in range(n):
  *                                 if i+k-1>=0 and i+k-1<width:
  *                                     for m in range(n):             # <<<<<<<<<<<<<<
  *                                         if i+m-1>=0 and i+m-1<width:
  *                                             value = obs1t[i+k-1] + obs2t[i+m-1] + tr[j][j1][k][m] + valt[i+j[0]-1][a]
  */
                 __pyx_t_38 = __pyx_v_n;
                 __pyx_t_39 = __pyx_t_38;
                 for (__pyx_t_40 = 0; __pyx_t_40 < __pyx_t_39; __pyx_t_40+=1) {
                   __pyx_v_m = __pyx_t_40;
 
-                  /* "soapcw/soapcw.pyx":1183
+                  /* "soapcw/soapcw.pyx":1240
  *                                 if i+k-1>=0 and i+k-1<width:
  *                                     for m in range(n):
  *                                         if i+m-1>=0 and i+m-1<width:             # <<<<<<<<<<<<<<
  *                                             value = obs1t[i+k-1] + obs2t[i+m-1] + tr[j][j1][k][m] + valt[i+j[0]-1][a]
  *                                             if value > temp:
  */
                   __pyx_t_19 = ((((__pyx_v_i + __pyx_v_m) - 1) >= 0) != 0);
@@ -22984,259 +23322,259 @@
                     goto __pyx_L47_bool_binop_done;
                   }
                   __pyx_t_19 = ((((__pyx_v_i + __pyx_v_m) - 1) < __pyx_v_width) != 0);
                   __pyx_t_5 = __pyx_t_19;
                   __pyx_L47_bool_binop_done:;
                   if (__pyx_t_5) {
 
-                    /* "soapcw/soapcw.pyx":1184
+                    /* "soapcw/soapcw.pyx":1241
  *                                     for m in range(n):
  *                                         if i+m-1>=0 and i+m-1<width:
  *                                             value = obs1t[i+k-1] + obs2t[i+m-1] + tr[j][j1][k][m] + valt[i+j[0]-1][a]             # <<<<<<<<<<<<<<
  *                                             if value > temp:
  *                                                 temp = value
  */
                     __pyx_t_32 = ((__pyx_v_i + __pyx_v_k) - 1);
-                    __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_obs1t, __pyx_t_32, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1184, __pyx_L1_error)
+                    __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_obs1t, __pyx_t_32, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1241, __pyx_L1_error)
                     __Pyx_GOTREF(__pyx_t_1);
                     __pyx_t_32 = ((__pyx_v_i + __pyx_v_m) - 1);
-                    __pyx_t_6 = __Pyx_GetItemInt(__pyx_v_obs2t, __pyx_t_32, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1184, __pyx_L1_error)
+                    __pyx_t_6 = __Pyx_GetItemInt(__pyx_v_obs2t, __pyx_t_32, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1241, __pyx_L1_error)
                     __Pyx_GOTREF(__pyx_t_6);
-                    __pyx_t_3 = PyNumber_Add(__pyx_t_1, __pyx_t_6); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1184, __pyx_L1_error)
+                    __pyx_t_3 = PyNumber_Add(__pyx_t_1, __pyx_t_6); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1241, __pyx_L1_error)
                     __Pyx_GOTREF(__pyx_t_3);
                     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
                     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-                    __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_v_tr, __pyx_v_j); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1184, __pyx_L1_error)
+                    __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_v_tr, __pyx_v_j); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1241, __pyx_L1_error)
                     __Pyx_GOTREF(__pyx_t_6);
-                    __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_6, __pyx_v_j1, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1184, __pyx_L1_error)
+                    __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_6, __pyx_v_j1, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1241, __pyx_L1_error)
                     __Pyx_GOTREF(__pyx_t_1);
                     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-                    __pyx_t_6 = __Pyx_GetItemInt(__pyx_t_1, __pyx_v_k, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1184, __pyx_L1_error)
+                    __pyx_t_6 = __Pyx_GetItemInt(__pyx_t_1, __pyx_v_k, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1241, __pyx_L1_error)
                     __Pyx_GOTREF(__pyx_t_6);
                     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-                    __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_6, __pyx_v_m, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1184, __pyx_L1_error)
+                    __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_6, __pyx_v_m, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1241, __pyx_L1_error)
                     __Pyx_GOTREF(__pyx_t_1);
                     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-                    __pyx_t_6 = PyNumber_Add(__pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1184, __pyx_L1_error)
+                    __pyx_t_6 = PyNumber_Add(__pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1241, __pyx_L1_error)
                     __Pyx_GOTREF(__pyx_t_6);
                     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
                     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-                    __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_i); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1184, __pyx_L1_error)
+                    __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_i); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1241, __pyx_L1_error)
                     __Pyx_GOTREF(__pyx_t_1);
-                    __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_j, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1184, __pyx_L1_error)
+                    __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_j, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1241, __pyx_L1_error)
                     __Pyx_GOTREF(__pyx_t_3);
-                    __pyx_t_29 = PyNumber_Add(__pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1184, __pyx_L1_error)
+                    __pyx_t_29 = PyNumber_Add(__pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1241, __pyx_L1_error)
                     __Pyx_GOTREF(__pyx_t_29);
                     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
                     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-                    __pyx_t_3 = __Pyx_PyInt_SubtractObjC(__pyx_t_29, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1184, __pyx_L1_error)
+                    __pyx_t_3 = __Pyx_PyInt_SubtractObjC(__pyx_t_29, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1241, __pyx_L1_error)
                     __Pyx_GOTREF(__pyx_t_3);
                     __Pyx_DECREF(__pyx_t_29); __pyx_t_29 = 0;
-                    __pyx_t_29 = __Pyx_PyObject_GetItem(__pyx_v_valt, __pyx_t_3); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1184, __pyx_L1_error)
+                    __pyx_t_29 = __Pyx_PyObject_GetItem(__pyx_v_valt, __pyx_t_3); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1241, __pyx_L1_error)
                     __Pyx_GOTREF(__pyx_t_29);
                     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-                    __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_t_29, __pyx_v_a); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1184, __pyx_L1_error)
+                    __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_t_29, __pyx_v_a); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1241, __pyx_L1_error)
                     __Pyx_GOTREF(__pyx_t_3);
                     __Pyx_DECREF(__pyx_t_29); __pyx_t_29 = 0;
-                    __pyx_t_29 = PyNumber_Add(__pyx_t_6, __pyx_t_3); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1184, __pyx_L1_error)
+                    __pyx_t_29 = PyNumber_Add(__pyx_t_6, __pyx_t_3); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1241, __pyx_L1_error)
                     __Pyx_GOTREF(__pyx_t_29);
                     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
                     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-                    __pyx_t_31 = __pyx_PyFloat_AsDouble(__pyx_t_29); if (unlikely((__pyx_t_31 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1184, __pyx_L1_error)
+                    __pyx_t_31 = __pyx_PyFloat_AsDouble(__pyx_t_29); if (unlikely((__pyx_t_31 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1241, __pyx_L1_error)
                     __Pyx_DECREF(__pyx_t_29); __pyx_t_29 = 0;
                     __pyx_v_value = __pyx_t_31;
 
-                    /* "soapcw/soapcw.pyx":1185
+                    /* "soapcw/soapcw.pyx":1242
  *                                         if i+m-1>=0 and i+m-1<width:
  *                                             value = obs1t[i+k-1] + obs2t[i+m-1] + tr[j][j1][k][m] + valt[i+j[0]-1][a]
  *                                             if value > temp:             # <<<<<<<<<<<<<<
  *                                                 temp = value
  *                                                 val[t][i][j]  = temp
  */
                     __pyx_t_5 = ((__pyx_v_value > __pyx_v_temp) != 0);
                     if (__pyx_t_5) {
 
-                      /* "soapcw/soapcw.pyx":1186
+                      /* "soapcw/soapcw.pyx":1243
  *                                             value = obs1t[i+k-1] + obs2t[i+m-1] + tr[j][j1][k][m] + valt[i+j[0]-1][a]
  *                                             if value > temp:
  *                                                 temp = value             # <<<<<<<<<<<<<<
  *                                                 val[t][i][j]  = temp
  *                                                 prev[t][i][j] = j1
  */
                       __pyx_v_temp = __pyx_v_value;
 
-                      /* "soapcw/soapcw.pyx":1187
+                      /* "soapcw/soapcw.pyx":1244
  *                                             if value > temp:
  *                                                 temp = value
  *                                                 val[t][i][j]  = temp             # <<<<<<<<<<<<<<
  *                                                 prev[t][i][j] = j1
  *                                                 pos1[t][i][j] = k
  */
-                      __pyx_t_29 = PyFloat_FromDouble(__pyx_v_temp); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1187, __pyx_L1_error)
+                      __pyx_t_29 = PyFloat_FromDouble(__pyx_v_temp); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1244, __pyx_L1_error)
                       __Pyx_GOTREF(__pyx_t_29);
-                      __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_val, __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1187, __pyx_L1_error)
+                      __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_val, __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1244, __pyx_L1_error)
                       __Pyx_GOTREF(__pyx_t_3);
-                      __pyx_t_6 = __Pyx_GetItemInt(__pyx_t_3, __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1187, __pyx_L1_error)
+                      __pyx_t_6 = __Pyx_GetItemInt(__pyx_t_3, __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1244, __pyx_L1_error)
                       __Pyx_GOTREF(__pyx_t_6);
                       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-                      if (unlikely(PyObject_SetItem(__pyx_t_6, __pyx_v_j, __pyx_t_29) < 0)) __PYX_ERR(0, 1187, __pyx_L1_error)
+                      if (unlikely(PyObject_SetItem(__pyx_t_6, __pyx_v_j, __pyx_t_29) < 0)) __PYX_ERR(0, 1244, __pyx_L1_error)
                       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
                       __Pyx_DECREF(__pyx_t_29); __pyx_t_29 = 0;
 
-                      /* "soapcw/soapcw.pyx":1188
+                      /* "soapcw/soapcw.pyx":1245
  *                                                 temp = value
  *                                                 val[t][i][j]  = temp
  *                                                 prev[t][i][j] = j1             # <<<<<<<<<<<<<<
  *                                                 pos1[t][i][j] = k
  *                                                 pos2[t][i][j] = m
  */
-                      __pyx_t_29 = __Pyx_PyInt_From_int(__pyx_v_j1); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1188, __pyx_L1_error)
+                      __pyx_t_29 = __Pyx_PyInt_From_int(__pyx_v_j1); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1245, __pyx_L1_error)
                       __Pyx_GOTREF(__pyx_t_29);
-                      __pyx_t_6 = __Pyx_GetItemInt(__pyx_v_prev, __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1188, __pyx_L1_error)
+                      __pyx_t_6 = __Pyx_GetItemInt(__pyx_v_prev, __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1245, __pyx_L1_error)
                       __Pyx_GOTREF(__pyx_t_6);
-                      __pyx_t_3 = __Pyx_GetItemInt(__pyx_t_6, __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1188, __pyx_L1_error)
+                      __pyx_t_3 = __Pyx_GetItemInt(__pyx_t_6, __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1245, __pyx_L1_error)
                       __Pyx_GOTREF(__pyx_t_3);
                       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-                      if (unlikely(PyObject_SetItem(__pyx_t_3, __pyx_v_j, __pyx_t_29) < 0)) __PYX_ERR(0, 1188, __pyx_L1_error)
+                      if (unlikely(PyObject_SetItem(__pyx_t_3, __pyx_v_j, __pyx_t_29) < 0)) __PYX_ERR(0, 1245, __pyx_L1_error)
                       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
                       __Pyx_DECREF(__pyx_t_29); __pyx_t_29 = 0;
 
-                      /* "soapcw/soapcw.pyx":1189
+                      /* "soapcw/soapcw.pyx":1246
  *                                                 val[t][i][j]  = temp
  *                                                 prev[t][i][j] = j1
  *                                                 pos1[t][i][j] = k             # <<<<<<<<<<<<<<
  *                                                 pos2[t][i][j] = m
  *                         """
  */
-                      __pyx_t_29 = __Pyx_PyInt_From_int(__pyx_v_k); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1189, __pyx_L1_error)
+                      __pyx_t_29 = __Pyx_PyInt_From_int(__pyx_v_k); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1246, __pyx_L1_error)
                       __Pyx_GOTREF(__pyx_t_29);
-                      __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_pos1, __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1189, __pyx_L1_error)
+                      __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_pos1, __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1246, __pyx_L1_error)
                       __Pyx_GOTREF(__pyx_t_3);
-                      __pyx_t_6 = __Pyx_GetItemInt(__pyx_t_3, __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1189, __pyx_L1_error)
+                      __pyx_t_6 = __Pyx_GetItemInt(__pyx_t_3, __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1246, __pyx_L1_error)
                       __Pyx_GOTREF(__pyx_t_6);
                       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-                      if (unlikely(PyObject_SetItem(__pyx_t_6, __pyx_v_j, __pyx_t_29) < 0)) __PYX_ERR(0, 1189, __pyx_L1_error)
+                      if (unlikely(PyObject_SetItem(__pyx_t_6, __pyx_v_j, __pyx_t_29) < 0)) __PYX_ERR(0, 1246, __pyx_L1_error)
                       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
                       __Pyx_DECREF(__pyx_t_29); __pyx_t_29 = 0;
 
-                      /* "soapcw/soapcw.pyx":1190
+                      /* "soapcw/soapcw.pyx":1247
  *                                                 prev[t][i][j] = j1
  *                                                 pos1[t][i][j] = k
  *                                                 pos2[t][i][j] = m             # <<<<<<<<<<<<<<
  *                         """
  *                         for k in range(length):
  */
-                      __pyx_t_29 = __Pyx_PyInt_From_int(__pyx_v_m); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1190, __pyx_L1_error)
+                      __pyx_t_29 = __Pyx_PyInt_From_int(__pyx_v_m); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1247, __pyx_L1_error)
                       __Pyx_GOTREF(__pyx_t_29);
-                      __pyx_t_6 = __Pyx_GetItemInt(__pyx_v_pos2, __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1190, __pyx_L1_error)
+                      __pyx_t_6 = __Pyx_GetItemInt(__pyx_v_pos2, __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1247, __pyx_L1_error)
                       __Pyx_GOTREF(__pyx_t_6);
-                      __pyx_t_3 = __Pyx_GetItemInt(__pyx_t_6, __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1190, __pyx_L1_error)
+                      __pyx_t_3 = __Pyx_GetItemInt(__pyx_t_6, __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1247, __pyx_L1_error)
                       __Pyx_GOTREF(__pyx_t_3);
                       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-                      if (unlikely(PyObject_SetItem(__pyx_t_3, __pyx_v_j, __pyx_t_29) < 0)) __PYX_ERR(0, 1190, __pyx_L1_error)
+                      if (unlikely(PyObject_SetItem(__pyx_t_3, __pyx_v_j, __pyx_t_29) < 0)) __PYX_ERR(0, 1247, __pyx_L1_error)
                       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
                       __Pyx_DECREF(__pyx_t_29); __pyx_t_29 = 0;
 
-                      /* "soapcw/soapcw.pyx":1185
+                      /* "soapcw/soapcw.pyx":1242
  *                                         if i+m-1>=0 and i+m-1<width:
  *                                             value = obs1t[i+k-1] + obs2t[i+m-1] + tr[j][j1][k][m] + valt[i+j[0]-1][a]
  *                                             if value > temp:             # <<<<<<<<<<<<<<
  *                                                 temp = value
  *                                                 val[t][i][j]  = temp
  */
                     }
 
-                    /* "soapcw/soapcw.pyx":1183
+                    /* "soapcw/soapcw.pyx":1240
  *                                 if i+k-1>=0 and i+k-1<width:
  *                                     for m in range(n):
  *                                         if i+m-1>=0 and i+m-1<width:             # <<<<<<<<<<<<<<
  *                                             value = obs1t[i+k-1] + obs2t[i+m-1] + tr[j][j1][k][m] + valt[i+j[0]-1][a]
  *                                             if value > temp:
  */
                   }
                 }
 
-                /* "soapcw/soapcw.pyx":1181
+                /* "soapcw/soapcw.pyx":1238
  *                             a = tuple(a)
  *                             for k in range(n):
  *                                 if i+k-1>=0 and i+k-1<width:             # <<<<<<<<<<<<<<
  *                                     for m in range(n):
  *                                         if i+m-1>=0 and i+m-1<width:
  */
               }
             }
           }
 
-          /* "soapcw/soapcw.pyx":1170
+          /* "soapcw/soapcw.pyx":1227
  *                             cond = False
  *                             break
  *                     if cond:             # <<<<<<<<<<<<<<
  *                         temp = -1e6
  *                         for j1 in range(n):
  */
         }
 
-        /* "soapcw/soapcw.pyx":1161
+        /* "soapcw/soapcw.pyx":1218
  *             pt = t/float(length_t)*100.
  *             for i in range(width):
  *                 for j in range_j:             # <<<<<<<<<<<<<<
  *                     cond = True
  *                     for c in range(1,len(j)+1):
  */
       }
       __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     }
 
-    /* "soapcw/soapcw.pyx":1207
+    /* "soapcw/soapcw.pyx":1264
  *                         """
  * 
  *             if self.prog == True:             # <<<<<<<<<<<<<<
  *                 if pt>pbar:
  *                     stdout.write('\r{} %'.format(round(pt)))
  */
-    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_prog); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1207, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_prog); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1264, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_29 = PyObject_RichCompare(__pyx_t_2, Py_True, Py_EQ); __Pyx_XGOTREF(__pyx_t_29); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1207, __pyx_L1_error)
+    __pyx_t_29 = PyObject_RichCompare(__pyx_t_2, Py_True, Py_EQ); __Pyx_XGOTREF(__pyx_t_29); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1264, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_29); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 1207, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_29); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 1264, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_29); __pyx_t_29 = 0;
     if (__pyx_t_5) {
 
-      /* "soapcw/soapcw.pyx":1208
+      /* "soapcw/soapcw.pyx":1265
  * 
  *             if self.prog == True:
  *                 if pt>pbar:             # <<<<<<<<<<<<<<
  *                     stdout.write('\r{} %'.format(round(pt)))
  *                     stdout.flush()
  */
-      __pyx_t_29 = PyFloat_FromDouble(__pyx_v_pt); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1208, __pyx_L1_error)
+      __pyx_t_29 = PyFloat_FromDouble(__pyx_v_pt); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1265, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_29);
-      __pyx_t_2 = PyObject_RichCompare(__pyx_t_29, __pyx_v_pbar, Py_GT); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1208, __pyx_L1_error)
+      __pyx_t_2 = PyObject_RichCompare(__pyx_t_29, __pyx_v_pbar, Py_GT); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1265, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_29); __pyx_t_29 = 0;
-      __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 1208, __pyx_L1_error)
+      __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 1265, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
       if (__pyx_t_5) {
 
-        /* "soapcw/soapcw.pyx":1209
+        /* "soapcw/soapcw.pyx":1266
  *             if self.prog == True:
  *                 if pt>pbar:
  *                     stdout.write('\r{} %'.format(round(pt)))             # <<<<<<<<<<<<<<
  *                     stdout.flush()
  *                     pbar+=100./length_t
  */
-        __Pyx_GetModuleGlobalName(__pyx_t_29, __pyx_n_s_stdout); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1209, __pyx_L1_error)
+        __Pyx_GetModuleGlobalName(__pyx_t_29, __pyx_n_s_stdout); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1266, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_29);
-        __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_29, __pyx_n_s_write); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1209, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_29, __pyx_n_s_write); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1266, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
         __Pyx_DECREF(__pyx_t_29); __pyx_t_29 = 0;
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u__4, __pyx_n_s_format); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1209, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u__4, __pyx_n_s_format); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1266, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_1 = PyFloat_FromDouble(__pyx_v_pt); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1209, __pyx_L1_error)
+        __pyx_t_1 = PyFloat_FromDouble(__pyx_v_pt); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1266, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
-        __pyx_t_28 = __Pyx_PyObject_CallOneArg(__pyx_builtin_round, __pyx_t_1); if (unlikely(!__pyx_t_28)) __PYX_ERR(0, 1209, __pyx_L1_error)
+        __pyx_t_28 = __Pyx_PyObject_CallOneArg(__pyx_builtin_round, __pyx_t_1); if (unlikely(!__pyx_t_28)) __PYX_ERR(0, 1266, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_28);
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         __pyx_t_1 = NULL;
         if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_6))) {
           __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_6);
           if (likely(__pyx_t_1)) {
             PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
@@ -23244,15 +23582,15 @@
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_6, function);
           }
         }
         __pyx_t_29 = (__pyx_t_1) ? __Pyx_PyObject_Call2Args(__pyx_t_6, __pyx_t_1, __pyx_t_28) : __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_t_28);
         __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
         __Pyx_DECREF(__pyx_t_28); __pyx_t_28 = 0;
-        if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1209, __pyx_L1_error)
+        if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1266, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_29);
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __pyx_t_6 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_3);
           if (likely(__pyx_t_6)) {
             PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
@@ -23260,698 +23598,698 @@
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_6, __pyx_t_29) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_29);
         __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
         __Pyx_DECREF(__pyx_t_29); __pyx_t_29 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1209, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1266, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-        /* "soapcw/soapcw.pyx":1210
+        /* "soapcw/soapcw.pyx":1267
  *                 if pt>pbar:
  *                     stdout.write('\r{} %'.format(round(pt)))
  *                     stdout.flush()             # <<<<<<<<<<<<<<
  *                     pbar+=100./length_t
  * 
  */
-        __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_stdout); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1210, __pyx_L1_error)
+        __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_stdout); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1267, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
-        __pyx_t_29 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_flush); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1210, __pyx_L1_error)
+        __pyx_t_29 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_flush); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1267, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_29);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         __pyx_t_3 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_29))) {
           __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_29);
           if (likely(__pyx_t_3)) {
             PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_29);
             __Pyx_INCREF(__pyx_t_3);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_29, function);
           }
         }
         __pyx_t_2 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_29, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_29);
         __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1210, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1267, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_29); __pyx_t_29 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-        /* "soapcw/soapcw.pyx":1211
+        /* "soapcw/soapcw.pyx":1268
  *                     stdout.write('\r{} %'.format(round(pt)))
  *                     stdout.flush()
  *                     pbar+=100./length_t             # <<<<<<<<<<<<<<
  * 
  *         previous   = 1
  */
         if (unlikely(__pyx_v_length_t == 0)) {
           PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-          __PYX_ERR(0, 1211, __pyx_L1_error)
+          __PYX_ERR(0, 1268, __pyx_L1_error)
         }
-        __pyx_t_2 = PyFloat_FromDouble((100. / ((double)__pyx_v_length_t))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1211, __pyx_L1_error)
+        __pyx_t_2 = PyFloat_FromDouble((100. / ((double)__pyx_v_length_t))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1268, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
-        __pyx_t_29 = PyNumber_InPlaceAdd(__pyx_v_pbar, __pyx_t_2); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1211, __pyx_L1_error)
+        __pyx_t_29 = PyNumber_InPlaceAdd(__pyx_v_pbar, __pyx_t_2); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1268, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_29);
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __Pyx_DECREF_SET(__pyx_v_pbar, __pyx_t_29);
         __pyx_t_29 = 0;
 
-        /* "soapcw/soapcw.pyx":1208
+        /* "soapcw/soapcw.pyx":1265
  * 
  *             if self.prog == True:
  *                 if pt>pbar:             # <<<<<<<<<<<<<<
  *                     stdout.write('\r{} %'.format(round(pt)))
  *                     stdout.flush()
  */
       }
 
-      /* "soapcw/soapcw.pyx":1207
+      /* "soapcw/soapcw.pyx":1264
  *                         """
  * 
  *             if self.prog == True:             # <<<<<<<<<<<<<<
  *                 if pt>pbar:
  *                     stdout.write('\r{} %'.format(round(pt)))
  */
     }
   }
 
-  /* "soapcw/soapcw.pyx":1213
+  /* "soapcw/soapcw.pyx":1270
  *                     pbar+=100./length_t
  * 
  *         previous   = 1             # <<<<<<<<<<<<<<
  *         previous_1 = None
  *         vit_track1  = [0]
  */
   __Pyx_INCREF(__pyx_int_1);
   __pyx_v_previous = __pyx_int_1;
 
-  /* "soapcw/soapcw.pyx":1214
+  /* "soapcw/soapcw.pyx":1271
  * 
  *         previous   = 1
  *         previous_1 = None             # <<<<<<<<<<<<<<
  *         vit_track1  = [0]
  *         vit_track2  = [0]
  */
   __Pyx_INCREF(Py_None);
   __pyx_v_previous_1 = Py_None;
 
-  /* "soapcw/soapcw.pyx":1215
+  /* "soapcw/soapcw.pyx":1272
  *         previous   = 1
  *         previous_1 = None
  *         vit_track1  = [0]             # <<<<<<<<<<<<<<
  *         vit_track2  = [0]
  *         vit_trackr  = [0]
  */
-  __pyx_t_29 = PyList_New(1); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1215, __pyx_L1_error)
+  __pyx_t_29 = PyList_New(1); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1272, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_29);
   __Pyx_INCREF(__pyx_int_0);
   __Pyx_GIVEREF(__pyx_int_0);
   PyList_SET_ITEM(__pyx_t_29, 0, __pyx_int_0);
   __pyx_v_vit_track1 = ((PyObject*)__pyx_t_29);
   __pyx_t_29 = 0;
 
-  /* "soapcw/soapcw.pyx":1216
+  /* "soapcw/soapcw.pyx":1273
  *         previous_1 = None
  *         vit_track1  = [0]
  *         vit_track2  = [0]             # <<<<<<<<<<<<<<
  *         vit_trackr  = [0]
  * 
  */
-  __pyx_t_29 = PyList_New(1); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1216, __pyx_L1_error)
+  __pyx_t_29 = PyList_New(1); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1273, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_29);
   __Pyx_INCREF(__pyx_int_0);
   __Pyx_GIVEREF(__pyx_int_0);
   PyList_SET_ITEM(__pyx_t_29, 0, __pyx_int_0);
   __pyx_v_vit_track2 = ((PyObject*)__pyx_t_29);
   __pyx_t_29 = 0;
 
-  /* "soapcw/soapcw.pyx":1217
+  /* "soapcw/soapcw.pyx":1274
  *         vit_track1  = [0]
  *         vit_track2  = [0]
  *         vit_trackr  = [0]             # <<<<<<<<<<<<<<
  * 
  *         temp = -1e6
  */
-  __pyx_t_29 = PyList_New(1); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1217, __pyx_L1_error)
+  __pyx_t_29 = PyList_New(1); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1274, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_29);
   __Pyx_INCREF(__pyx_int_0);
   __Pyx_GIVEREF(__pyx_int_0);
   PyList_SET_ITEM(__pyx_t_29, 0, __pyx_int_0);
   __pyx_v_vit_trackr = ((PyObject*)__pyx_t_29);
   __pyx_t_29 = 0;
 
-  /* "soapcw/soapcw.pyx":1219
+  /* "soapcw/soapcw.pyx":1276
  *         vit_trackr  = [0]
  * 
  *         temp = -1e6             # <<<<<<<<<<<<<<
  *         for i in range(width):
  *             for j in range_j:
  */
   __pyx_v_temp = -1e6;
 
-  /* "soapcw/soapcw.pyx":1220
+  /* "soapcw/soapcw.pyx":1277
  * 
  *         temp = -1e6
  *         for i in range(width):             # <<<<<<<<<<<<<<
  *             for j in range_j:
  *                 value = val[-1][i][j]
  */
   __pyx_t_11 = __pyx_v_width;
   __pyx_t_14 = __pyx_t_11;
   for (__pyx_t_15 = 0; __pyx_t_15 < __pyx_t_14; __pyx_t_15+=1) {
     __pyx_v_i = __pyx_t_15;
 
-    /* "soapcw/soapcw.pyx":1221
+    /* "soapcw/soapcw.pyx":1278
  *         temp = -1e6
  *         for i in range(width):
  *             for j in range_j:             # <<<<<<<<<<<<<<
  *                 value = val[-1][i][j]
  *                 if value>temp:
  */
     __pyx_t_29 = __pyx_v_range_j; __Pyx_INCREF(__pyx_t_29); __pyx_t_12 = 0;
     for (;;) {
       if (__pyx_t_12 >= PyList_GET_SIZE(__pyx_t_29)) break;
       #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-      __pyx_t_2 = PyList_GET_ITEM(__pyx_t_29, __pyx_t_12); __Pyx_INCREF(__pyx_t_2); __pyx_t_12++; if (unlikely(0 < 0)) __PYX_ERR(0, 1221, __pyx_L1_error)
+      __pyx_t_2 = PyList_GET_ITEM(__pyx_t_29, __pyx_t_12); __Pyx_INCREF(__pyx_t_2); __pyx_t_12++; if (unlikely(0 < 0)) __PYX_ERR(0, 1278, __pyx_L1_error)
       #else
-      __pyx_t_2 = PySequence_ITEM(__pyx_t_29, __pyx_t_12); __pyx_t_12++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1221, __pyx_L1_error)
+      __pyx_t_2 = PySequence_ITEM(__pyx_t_29, __pyx_t_12); __pyx_t_12++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1278, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
       #endif
       __Pyx_XDECREF_SET(__pyx_v_j, __pyx_t_2);
       __pyx_t_2 = 0;
 
-      /* "soapcw/soapcw.pyx":1222
+      /* "soapcw/soapcw.pyx":1279
  *         for i in range(width):
  *             for j in range_j:
  *                 value = val[-1][i][j]             # <<<<<<<<<<<<<<
  *                 if value>temp:
  *                     temp = value
  */
-      __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_val, -1L, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1222, __pyx_L1_error)
+      __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_val, -1L, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1279, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
-      __pyx_t_3 = __Pyx_GetItemInt(__pyx_t_2, __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1222, __pyx_L1_error)
+      __pyx_t_3 = __Pyx_GetItemInt(__pyx_t_2, __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1279, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
       __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-      __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_t_3, __pyx_v_j); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1222, __pyx_L1_error)
+      __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_t_3, __pyx_v_j); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1279, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-      __pyx_t_31 = __pyx_PyFloat_AsDouble(__pyx_t_2); if (unlikely((__pyx_t_31 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1222, __pyx_L1_error)
+      __pyx_t_31 = __pyx_PyFloat_AsDouble(__pyx_t_2); if (unlikely((__pyx_t_31 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1279, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
       __pyx_v_value = __pyx_t_31;
 
-      /* "soapcw/soapcw.pyx":1223
+      /* "soapcw/soapcw.pyx":1280
  *             for j in range_j:
  *                 value = val[-1][i][j]
  *                 if value>temp:             # <<<<<<<<<<<<<<
  *                     temp = value
  *                     vit_trackr[0] = i
  */
       __pyx_t_5 = ((__pyx_v_value > __pyx_v_temp) != 0);
       if (__pyx_t_5) {
 
-        /* "soapcw/soapcw.pyx":1224
+        /* "soapcw/soapcw.pyx":1281
  *                 value = val[-1][i][j]
  *                 if value>temp:
  *                     temp = value             # <<<<<<<<<<<<<<
  *                     vit_trackr[0] = i
  *                     vit_track1[0] = i+pos1[-1][i][j]-1
  */
         __pyx_v_temp = __pyx_v_value;
 
-        /* "soapcw/soapcw.pyx":1225
+        /* "soapcw/soapcw.pyx":1282
  *                 if value>temp:
  *                     temp = value
  *                     vit_trackr[0] = i             # <<<<<<<<<<<<<<
  *                     vit_track1[0] = i+pos1[-1][i][j]-1
  *                     vit_track2[0] = i+pos2[-1][i][j]-1
  */
-        __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_i); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1225, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_i); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1282, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_vit_trackr, 0, __pyx_t_2, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0)) __PYX_ERR(0, 1225, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_vit_trackr, 0, __pyx_t_2, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0)) __PYX_ERR(0, 1282, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-        /* "soapcw/soapcw.pyx":1226
+        /* "soapcw/soapcw.pyx":1283
  *                     temp = value
  *                     vit_trackr[0] = i
  *                     vit_track1[0] = i+pos1[-1][i][j]-1             # <<<<<<<<<<<<<<
  *                     vit_track2[0] = i+pos2[-1][i][j]-1
  *                     previous = i
  */
-        __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_i); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1226, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_i); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1283, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
-        __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_pos1, -1L, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1226, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_pos1, -1L, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1283, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
-        __pyx_t_6 = __Pyx_GetItemInt(__pyx_t_3, __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1226, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_GetItemInt(__pyx_t_3, __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1283, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_t_6, __pyx_v_j); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1226, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_t_6, __pyx_v_j); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1283, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-        __pyx_t_6 = PyNumber_Add(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1226, __pyx_L1_error)
+        __pyx_t_6 = PyNumber_Add(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1283, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        __pyx_t_3 = __Pyx_PyInt_SubtractObjC(__pyx_t_6, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1226, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_PyInt_SubtractObjC(__pyx_t_6, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1283, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_vit_track1, 0, __pyx_t_3, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0)) __PYX_ERR(0, 1226, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_vit_track1, 0, __pyx_t_3, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0)) __PYX_ERR(0, 1283, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-        /* "soapcw/soapcw.pyx":1227
+        /* "soapcw/soapcw.pyx":1284
  *                     vit_trackr[0] = i
  *                     vit_track1[0] = i+pos1[-1][i][j]-1
  *                     vit_track2[0] = i+pos2[-1][i][j]-1             # <<<<<<<<<<<<<<
  *                     previous = i
  *                     previous_1 = j
  */
-        __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_i); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1227, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_i); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1284, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
-        __pyx_t_6 = __Pyx_GetItemInt(__pyx_v_pos2, -1L, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1227, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_GetItemInt(__pyx_v_pos2, -1L, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1284, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_2 = __Pyx_GetItemInt(__pyx_t_6, __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1227, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_GetItemInt(__pyx_t_6, __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1284, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-        __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_t_2, __pyx_v_j); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1227, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_t_2, __pyx_v_j); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1284, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-        __pyx_t_2 = PyNumber_Add(__pyx_t_3, __pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1227, __pyx_L1_error)
+        __pyx_t_2 = PyNumber_Add(__pyx_t_3, __pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1284, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-        __pyx_t_6 = __Pyx_PyInt_SubtractObjC(__pyx_t_2, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1227, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyInt_SubtractObjC(__pyx_t_2, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1284, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_vit_track2, 0, __pyx_t_6, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0)) __PYX_ERR(0, 1227, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_vit_track2, 0, __pyx_t_6, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0)) __PYX_ERR(0, 1284, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
 
-        /* "soapcw/soapcw.pyx":1228
+        /* "soapcw/soapcw.pyx":1285
  *                     vit_track1[0] = i+pos1[-1][i][j]-1
  *                     vit_track2[0] = i+pos2[-1][i][j]-1
  *                     previous = i             # <<<<<<<<<<<<<<
  *                     previous_1 = j
  *                     previous_2 = int(prev[-1][i][j])
  */
-        __pyx_t_6 = __Pyx_PyInt_From_int(__pyx_v_i); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1228, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyInt_From_int(__pyx_v_i); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1285, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __Pyx_DECREF_SET(__pyx_v_previous, __pyx_t_6);
         __pyx_t_6 = 0;
 
-        /* "soapcw/soapcw.pyx":1229
+        /* "soapcw/soapcw.pyx":1286
  *                     vit_track2[0] = i+pos2[-1][i][j]-1
  *                     previous = i
  *                     previous_1 = j             # <<<<<<<<<<<<<<
  *                     previous_2 = int(prev[-1][i][j])
  * 
  */
         __Pyx_INCREF(__pyx_v_j);
         __Pyx_DECREF_SET(__pyx_v_previous_1, __pyx_v_j);
 
-        /* "soapcw/soapcw.pyx":1230
+        /* "soapcw/soapcw.pyx":1287
  *                     previous = i
  *                     previous_1 = j
  *                     previous_2 = int(prev[-1][i][j])             # <<<<<<<<<<<<<<
  * 
  * 
  */
-        __pyx_t_6 = __Pyx_GetItemInt(__pyx_v_prev, -1L, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1230, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_GetItemInt(__pyx_v_prev, -1L, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1287, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_2 = __Pyx_GetItemInt(__pyx_t_6, __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1230, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_GetItemInt(__pyx_t_6, __pyx_v_i, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1287, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-        __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_t_2, __pyx_v_j); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1230, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_t_2, __pyx_v_j); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1287, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-        __pyx_t_2 = __Pyx_PyNumber_Int(__pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1230, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyNumber_Int(__pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1287, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __Pyx_XDECREF_SET(__pyx_v_previous_2, __pyx_t_2);
         __pyx_t_2 = 0;
 
-        /* "soapcw/soapcw.pyx":1223
+        /* "soapcw/soapcw.pyx":1280
  *             for j in range_j:
  *                 value = val[-1][i][j]
  *                 if value>temp:             # <<<<<<<<<<<<<<
  *                     temp = value
  *                     vit_trackr[0] = i
  */
       }
 
-      /* "soapcw/soapcw.pyx":1221
+      /* "soapcw/soapcw.pyx":1278
  *         temp = -1e6
  *         for i in range(width):
  *             for j in range_j:             # <<<<<<<<<<<<<<
  *                 value = val[-1][i][j]
  *                 if value>temp:
  */
     }
     __Pyx_DECREF(__pyx_t_29); __pyx_t_29 = 0;
   }
 
-  /* "soapcw/soapcw.pyx":1233
+  /* "soapcw/soapcw.pyx":1290
  * 
  * 
  *         for t in range(length_t-2,-1,-1):             # <<<<<<<<<<<<<<
  *             vit_trackr.append(previous+previous_1[0]-1)
  *             previous += previous_1[0]-1
  */
   for (__pyx_t_11 = (__pyx_v_length_t - 2); __pyx_t_11 > -1; __pyx_t_11-=1) {
     __pyx_v_t = __pyx_t_11;
 
-    /* "soapcw/soapcw.pyx":1234
+    /* "soapcw/soapcw.pyx":1291
  * 
  *         for t in range(length_t-2,-1,-1):
  *             vit_trackr.append(previous+previous_1[0]-1)             # <<<<<<<<<<<<<<
  *             previous += previous_1[0]-1
  *             previous_1 = list(previous_1[1:])
  */
-    __pyx_t_29 = __Pyx_GetItemInt(__pyx_v_previous_1, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1234, __pyx_L1_error)
+    __pyx_t_29 = __Pyx_GetItemInt(__pyx_v_previous_1, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1291, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_29);
-    __pyx_t_2 = PyNumber_Add(__pyx_v_previous, __pyx_t_29); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1234, __pyx_L1_error)
+    __pyx_t_2 = PyNumber_Add(__pyx_v_previous, __pyx_t_29); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1291, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_29); __pyx_t_29 = 0;
-    __pyx_t_29 = __Pyx_PyInt_SubtractObjC(__pyx_t_2, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1234, __pyx_L1_error)
+    __pyx_t_29 = __Pyx_PyInt_SubtractObjC(__pyx_t_2, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1291, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_29);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __pyx_t_13 = __Pyx_PyList_Append(__pyx_v_vit_trackr, __pyx_t_29); if (unlikely(__pyx_t_13 == ((int)-1))) __PYX_ERR(0, 1234, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyList_Append(__pyx_v_vit_trackr, __pyx_t_29); if (unlikely(__pyx_t_13 == ((int)-1))) __PYX_ERR(0, 1291, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_29); __pyx_t_29 = 0;
 
-    /* "soapcw/soapcw.pyx":1235
+    /* "soapcw/soapcw.pyx":1292
  *         for t in range(length_t-2,-1,-1):
  *             vit_trackr.append(previous+previous_1[0]-1)
  *             previous += previous_1[0]-1             # <<<<<<<<<<<<<<
  *             previous_1 = list(previous_1[1:])
  *             previous_1.append(int(previous_2))
  */
-    __pyx_t_29 = __Pyx_GetItemInt(__pyx_v_previous_1, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1235, __pyx_L1_error)
+    __pyx_t_29 = __Pyx_GetItemInt(__pyx_v_previous_1, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1292, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_29);
-    __pyx_t_2 = __Pyx_PyInt_SubtractObjC(__pyx_t_29, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1235, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyInt_SubtractObjC(__pyx_t_29, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1292, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_29); __pyx_t_29 = 0;
-    __pyx_t_29 = PyNumber_InPlaceAdd(__pyx_v_previous, __pyx_t_2); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1235, __pyx_L1_error)
+    __pyx_t_29 = PyNumber_InPlaceAdd(__pyx_v_previous, __pyx_t_2); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1292, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_29);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_DECREF_SET(__pyx_v_previous, __pyx_t_29);
     __pyx_t_29 = 0;
 
-    /* "soapcw/soapcw.pyx":1236
+    /* "soapcw/soapcw.pyx":1293
  *             vit_trackr.append(previous+previous_1[0]-1)
  *             previous += previous_1[0]-1
  *             previous_1 = list(previous_1[1:])             # <<<<<<<<<<<<<<
  *             previous_1.append(int(previous_2))
  *             previous_1 = tuple(previous_1)
  */
-    __pyx_t_29 = __Pyx_PyObject_GetSlice(__pyx_v_previous_1, 1, 0, NULL, NULL, &__pyx_slice__8, 1, 0, 1); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1236, __pyx_L1_error)
+    __pyx_t_29 = __Pyx_PyObject_GetSlice(__pyx_v_previous_1, 1, 0, NULL, NULL, &__pyx_slice__8, 1, 0, 1); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1293, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_29);
-    __pyx_t_2 = PySequence_List(__pyx_t_29); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1236, __pyx_L1_error)
+    __pyx_t_2 = PySequence_List(__pyx_t_29); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1293, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_29); __pyx_t_29 = 0;
     __Pyx_DECREF_SET(__pyx_v_previous_1, __pyx_t_2);
     __pyx_t_2 = 0;
 
-    /* "soapcw/soapcw.pyx":1237
+    /* "soapcw/soapcw.pyx":1294
  *             previous += previous_1[0]-1
  *             previous_1 = list(previous_1[1:])
  *             previous_1.append(int(previous_2))             # <<<<<<<<<<<<<<
  *             previous_1 = tuple(previous_1)
  *             vit_track1.append(previous+pos1[t][previous][previous_1]-1)
  */
-    if (unlikely(!__pyx_v_previous_2)) { __Pyx_RaiseUnboundLocalError("previous_2"); __PYX_ERR(0, 1237, __pyx_L1_error) }
-    __pyx_t_2 = __Pyx_PyNumber_Int(__pyx_v_previous_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1237, __pyx_L1_error)
+    if (unlikely(!__pyx_v_previous_2)) { __Pyx_RaiseUnboundLocalError("previous_2"); __PYX_ERR(0, 1294, __pyx_L1_error) }
+    __pyx_t_2 = __Pyx_PyNumber_Int(__pyx_v_previous_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1294, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_13 = __Pyx_PyObject_Append(__pyx_v_previous_1, __pyx_t_2); if (unlikely(__pyx_t_13 == ((int)-1))) __PYX_ERR(0, 1237, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyObject_Append(__pyx_v_previous_1, __pyx_t_2); if (unlikely(__pyx_t_13 == ((int)-1))) __PYX_ERR(0, 1294, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-    /* "soapcw/soapcw.pyx":1238
+    /* "soapcw/soapcw.pyx":1295
  *             previous_1 = list(previous_1[1:])
  *             previous_1.append(int(previous_2))
  *             previous_1 = tuple(previous_1)             # <<<<<<<<<<<<<<
  *             vit_track1.append(previous+pos1[t][previous][previous_1]-1)
  *             vit_track2.append(previous+pos2[t][previous][previous_1]-1)
  */
-    __pyx_t_2 = __Pyx_PySequence_Tuple(__pyx_v_previous_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1238, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PySequence_Tuple(__pyx_v_previous_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1295, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF_SET(__pyx_v_previous_1, __pyx_t_2);
     __pyx_t_2 = 0;
 
-    /* "soapcw/soapcw.pyx":1239
+    /* "soapcw/soapcw.pyx":1296
  *             previous_1.append(int(previous_2))
  *             previous_1 = tuple(previous_1)
  *             vit_track1.append(previous+pos1[t][previous][previous_1]-1)             # <<<<<<<<<<<<<<
  *             vit_track2.append(previous+pos2[t][previous][previous_1]-1)
  *             previous_2 = prev[t][previous][previous_1]
  */
-    __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_pos1, __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1239, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_pos1, __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1296, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_29 = __Pyx_PyObject_GetItem(__pyx_t_2, __pyx_v_previous); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1239, __pyx_L1_error)
+    __pyx_t_29 = __Pyx_PyObject_GetItem(__pyx_t_2, __pyx_v_previous); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1296, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_29);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_t_29, __pyx_v_previous_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1239, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_t_29, __pyx_v_previous_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1296, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_29); __pyx_t_29 = 0;
-    __pyx_t_29 = PyNumber_Add(__pyx_v_previous, __pyx_t_2); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1239, __pyx_L1_error)
+    __pyx_t_29 = PyNumber_Add(__pyx_v_previous, __pyx_t_2); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1296, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_29);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __pyx_t_2 = __Pyx_PyInt_SubtractObjC(__pyx_t_29, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1239, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyInt_SubtractObjC(__pyx_t_29, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1296, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_29); __pyx_t_29 = 0;
-    __pyx_t_13 = __Pyx_PyList_Append(__pyx_v_vit_track1, __pyx_t_2); if (unlikely(__pyx_t_13 == ((int)-1))) __PYX_ERR(0, 1239, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyList_Append(__pyx_v_vit_track1, __pyx_t_2); if (unlikely(__pyx_t_13 == ((int)-1))) __PYX_ERR(0, 1296, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-    /* "soapcw/soapcw.pyx":1240
+    /* "soapcw/soapcw.pyx":1297
  *             previous_1 = tuple(previous_1)
  *             vit_track1.append(previous+pos1[t][previous][previous_1]-1)
  *             vit_track2.append(previous+pos2[t][previous][previous_1]-1)             # <<<<<<<<<<<<<<
  *             previous_2 = prev[t][previous][previous_1]
  * 
  */
-    __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_pos2, __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1240, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_pos2, __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1297, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_29 = __Pyx_PyObject_GetItem(__pyx_t_2, __pyx_v_previous); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1240, __pyx_L1_error)
+    __pyx_t_29 = __Pyx_PyObject_GetItem(__pyx_t_2, __pyx_v_previous); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1297, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_29);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_t_29, __pyx_v_previous_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1240, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_t_29, __pyx_v_previous_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1297, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_29); __pyx_t_29 = 0;
-    __pyx_t_29 = PyNumber_Add(__pyx_v_previous, __pyx_t_2); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1240, __pyx_L1_error)
+    __pyx_t_29 = PyNumber_Add(__pyx_v_previous, __pyx_t_2); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1297, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_29);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __pyx_t_2 = __Pyx_PyInt_SubtractObjC(__pyx_t_29, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1240, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyInt_SubtractObjC(__pyx_t_29, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1297, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_29); __pyx_t_29 = 0;
-    __pyx_t_13 = __Pyx_PyList_Append(__pyx_v_vit_track2, __pyx_t_2); if (unlikely(__pyx_t_13 == ((int)-1))) __PYX_ERR(0, 1240, __pyx_L1_error)
+    __pyx_t_13 = __Pyx_PyList_Append(__pyx_v_vit_track2, __pyx_t_2); if (unlikely(__pyx_t_13 == ((int)-1))) __PYX_ERR(0, 1297, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-    /* "soapcw/soapcw.pyx":1241
+    /* "soapcw/soapcw.pyx":1298
  *             vit_track1.append(previous+pos1[t][previous][previous_1]-1)
  *             vit_track2.append(previous+pos2[t][previous][previous_1]-1)
  *             previous_2 = prev[t][previous][previous_1]             # <<<<<<<<<<<<<<
  * 
  *         vit_trackr = vit_trackr[::-1]
  */
-    __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_prev, __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1241, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_prev, __pyx_v_t, int, 1, __Pyx_PyInt_From_int, 0, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1298, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_29 = __Pyx_PyObject_GetItem(__pyx_t_2, __pyx_v_previous); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1241, __pyx_L1_error)
+    __pyx_t_29 = __Pyx_PyObject_GetItem(__pyx_t_2, __pyx_v_previous); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1298, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_29);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_t_29, __pyx_v_previous_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1241, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_t_29, __pyx_v_previous_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1298, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_29); __pyx_t_29 = 0;
     __Pyx_XDECREF_SET(__pyx_v_previous_2, __pyx_t_2);
     __pyx_t_2 = 0;
   }
 
-  /* "soapcw/soapcw.pyx":1243
+  /* "soapcw/soapcw.pyx":1300
  *             previous_2 = prev[t][previous][previous_1]
  * 
  *         vit_trackr = vit_trackr[::-1]             # <<<<<<<<<<<<<<
  *         vit_track1 = vit_track1[::-1]
  *         vit_track2 = vit_track2[::-1]
  */
-  __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_v_vit_trackr, __pyx_slice__9); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1243, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_v_vit_trackr, __pyx_slice__9); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1300, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF_SET(__pyx_v_vit_trackr, ((PyObject*)__pyx_t_2));
   __pyx_t_2 = 0;
 
-  /* "soapcw/soapcw.pyx":1244
+  /* "soapcw/soapcw.pyx":1301
  * 
  *         vit_trackr = vit_trackr[::-1]
  *         vit_track1 = vit_track1[::-1]             # <<<<<<<<<<<<<<
  *         vit_track2 = vit_track2[::-1]
  * 
  */
-  __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_v_vit_track1, __pyx_slice__9); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1244, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_v_vit_track1, __pyx_slice__9); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1301, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF_SET(__pyx_v_vit_track1, ((PyObject*)__pyx_t_2));
   __pyx_t_2 = 0;
 
-  /* "soapcw/soapcw.pyx":1245
+  /* "soapcw/soapcw.pyx":1302
  *         vit_trackr = vit_trackr[::-1]
  *         vit_track1 = vit_track1[::-1]
  *         vit_track2 = vit_track2[::-1]             # <<<<<<<<<<<<<<
  * 
  *         self.vit_track1 = np.array(vit_track1)
  */
-  __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_v_vit_track2, __pyx_slice__9); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1245, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_v_vit_track2, __pyx_slice__9); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1302, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF_SET(__pyx_v_vit_track2, ((PyObject*)__pyx_t_2));
   __pyx_t_2 = 0;
 
-  /* "soapcw/soapcw.pyx":1247
+  /* "soapcw/soapcw.pyx":1304
  *         vit_track2 = vit_track2[::-1]
  * 
  *         self.vit_track1 = np.array(vit_track1)             # <<<<<<<<<<<<<<
  *         self.vit_track2 = np.array(vit_track2)
  *         self.vit_track = np.array(vit_trackr)
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_29, __pyx_n_s_np); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1247, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_29, __pyx_n_s_np); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1304, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_29);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_29, __pyx_n_s_array); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1247, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_29, __pyx_n_s_array); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1304, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_29); __pyx_t_29 = 0;
   __pyx_t_29 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_6))) {
     __pyx_t_29 = PyMethod_GET_SELF(__pyx_t_6);
     if (likely(__pyx_t_29)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
       __Pyx_INCREF(__pyx_t_29);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_6, function);
     }
   }
   __pyx_t_2 = (__pyx_t_29) ? __Pyx_PyObject_Call2Args(__pyx_t_6, __pyx_t_29, __pyx_v_vit_track1) : __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_v_vit_track1);
   __Pyx_XDECREF(__pyx_t_29); __pyx_t_29 = 0;
-  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1247, __pyx_L1_error)
+  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1304, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_vit_track1, __pyx_t_2) < 0) __PYX_ERR(0, 1247, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_vit_track1, __pyx_t_2) < 0) __PYX_ERR(0, 1304, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "soapcw/soapcw.pyx":1248
+  /* "soapcw/soapcw.pyx":1305
  * 
  *         self.vit_track1 = np.array(vit_track1)
  *         self.vit_track2 = np.array(vit_track2)             # <<<<<<<<<<<<<<
  *         self.vit_track = np.array(vit_trackr)
  *         self.V = np.array(val)
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1248, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1305, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_29 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_array); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1248, __pyx_L1_error)
+  __pyx_t_29 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_array); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1305, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_29);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_t_6 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_29))) {
     __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_29);
     if (likely(__pyx_t_6)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_29);
       __Pyx_INCREF(__pyx_t_6);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_29, function);
     }
   }
   __pyx_t_2 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_29, __pyx_t_6, __pyx_v_vit_track2) : __Pyx_PyObject_CallOneArg(__pyx_t_29, __pyx_v_vit_track2);
   __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
-  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1248, __pyx_L1_error)
+  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1305, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_29); __pyx_t_29 = 0;
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_vit_track2, __pyx_t_2) < 0) __PYX_ERR(0, 1248, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_vit_track2, __pyx_t_2) < 0) __PYX_ERR(0, 1305, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "soapcw/soapcw.pyx":1249
+  /* "soapcw/soapcw.pyx":1306
  *         self.vit_track1 = np.array(vit_track1)
  *         self.vit_track2 = np.array(vit_track2)
  *         self.vit_track = np.array(vit_trackr)             # <<<<<<<<<<<<<<
  *         self.V = np.array(val)
  *         self.prev = np.array(prev)
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_29, __pyx_n_s_np); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1249, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_29, __pyx_n_s_np); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1306, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_29);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_29, __pyx_n_s_array); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1249, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_29, __pyx_n_s_array); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1306, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_29); __pyx_t_29 = 0;
   __pyx_t_29 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_6))) {
     __pyx_t_29 = PyMethod_GET_SELF(__pyx_t_6);
     if (likely(__pyx_t_29)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
       __Pyx_INCREF(__pyx_t_29);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_6, function);
     }
   }
   __pyx_t_2 = (__pyx_t_29) ? __Pyx_PyObject_Call2Args(__pyx_t_6, __pyx_t_29, __pyx_v_vit_trackr) : __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_v_vit_trackr);
   __Pyx_XDECREF(__pyx_t_29); __pyx_t_29 = 0;
-  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1249, __pyx_L1_error)
+  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1306, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_vit_track, __pyx_t_2) < 0) __PYX_ERR(0, 1249, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_vit_track, __pyx_t_2) < 0) __PYX_ERR(0, 1306, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "soapcw/soapcw.pyx":1250
+  /* "soapcw/soapcw.pyx":1307
  *         self.vit_track2 = np.array(vit_track2)
  *         self.vit_track = np.array(vit_trackr)
  *         self.V = np.array(val)             # <<<<<<<<<<<<<<
  *         self.prev = np.array(prev)
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1250, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1307, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_29 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_array); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1250, __pyx_L1_error)
+  __pyx_t_29 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_array); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1307, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_29);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_t_6 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_29))) {
     __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_29);
     if (likely(__pyx_t_6)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_29);
       __Pyx_INCREF(__pyx_t_6);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_29, function);
     }
   }
   __pyx_t_2 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_29, __pyx_t_6, __pyx_v_val) : __Pyx_PyObject_CallOneArg(__pyx_t_29, __pyx_v_val);
   __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
-  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1250, __pyx_L1_error)
+  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1307, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_29); __pyx_t_29 = 0;
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_V, __pyx_t_2) < 0) __PYX_ERR(0, 1250, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_V, __pyx_t_2) < 0) __PYX_ERR(0, 1307, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "soapcw/soapcw.pyx":1251
+  /* "soapcw/soapcw.pyx":1308
  *         self.vit_track = np.array(vit_trackr)
  *         self.V = np.array(val)
  *         self.prev = np.array(prev)             # <<<<<<<<<<<<<<
  * 
  *         #return (vit_track1,vit_track2,vit_trackr,val,prev)
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_29, __pyx_n_s_np); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1251, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_29, __pyx_n_s_np); if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 1308, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_29);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_29, __pyx_n_s_array); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1251, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_29, __pyx_n_s_array); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1308, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_29); __pyx_t_29 = 0;
   __pyx_t_29 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_6))) {
     __pyx_t_29 = PyMethod_GET_SELF(__pyx_t_6);
     if (likely(__pyx_t_29)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
       __Pyx_INCREF(__pyx_t_29);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_6, function);
     }
   }
   __pyx_t_2 = (__pyx_t_29) ? __Pyx_PyObject_Call2Args(__pyx_t_6, __pyx_t_29, __pyx_v_prev) : __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_v_prev);
   __Pyx_XDECREF(__pyx_t_29); __pyx_t_29 = 0;
-  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1251, __pyx_L1_error)
+  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1308, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_prev, __pyx_t_2) < 0) __PYX_ERR(0, 1251, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_prev, __pyx_t_2) < 0) __PYX_ERR(0, 1308, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "soapcw/soapcw.pyx":1084
+  /* "soapcw/soapcw.pyx":1141
  * 
  * 
  *     def run(self, tr, obs11, obs22):             # <<<<<<<<<<<<<<
  *         ''' Run viterbi algroithm with memory of n
  *         the amount of memory is determined by the transition matrix
  */
 
@@ -23994,15 +24332,15 @@
   __Pyx_XDECREF(__pyx_v_vit_trackr);
   __Pyx_XDECREF(__pyx_v_previous_2);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "soapcw/soapcw.pyx":1264
+/* "soapcw/soapcw.pyx":1321
  * class single_detector_gaps(object):
  * 
  *     def __init__(self, tr, obs,times,tsft):             # <<<<<<<<<<<<<<
  *         """
  *         single detector viterbi algorithm where the data can include large gaps in data
  */
 
@@ -24047,37 +24385,37 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_tr)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__init__", 1, 5, 5, 1); __PYX_ERR(0, 1264, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__init__", 1, 5, 5, 1); __PYX_ERR(0, 1321, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_obs)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__init__", 1, 5, 5, 2); __PYX_ERR(0, 1264, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__init__", 1, 5, 5, 2); __PYX_ERR(0, 1321, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_times)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__init__", 1, 5, 5, 3); __PYX_ERR(0, 1264, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__init__", 1, 5, 5, 3); __PYX_ERR(0, 1321, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (likely((values[4] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_tsft)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("__init__", 1, 5, 5, 4); __PYX_ERR(0, 1264, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("__init__", 1, 5, 5, 4); __PYX_ERR(0, 1321, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) __PYX_ERR(0, 1264, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") < 0)) __PYX_ERR(0, 1321, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 5) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
@@ -24088,15 +24426,15 @@
     __pyx_v_tr = values[1];
     __pyx_v_obs = values[2];
     __pyx_v_times = values[3];
     __pyx_v_tsft = values[4];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__init__", 1, 5, 5, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1264, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("__init__", 1, 5, 5, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1321, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("soapcw.soapcw.single_detector_gaps.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6soapcw_6soapcw_20single_detector_gaps___init__(__pyx_self, __pyx_v_self, __pyx_v_tr, __pyx_v_obs, __pyx_v_times, __pyx_v_tsft);
 
@@ -24115,47 +24453,47 @@
   PyObject *__pyx_t_5 = NULL;
   PyObject *(*__pyx_t_6)(PyObject *);
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__init__", 0);
 
-  /* "soapcw/soapcw.pyx":1286
+  /* "soapcw/soapcw.pyx":1343
  *             list of the times corresponding to each of the path elements
  *         """
  *         self.vits, self.sts, self.gps = self.vit_gaps(obs, times, tr=tr, tsft=tsft)             # <<<<<<<<<<<<<<
  *         self.vit_track, self.vit_track_times = self.get_track(self.vits, self.sts, self.gps,tsft=tsft)
  *         self.max_end_prob = max(self.vits[-1].V[-1])
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_vit_gaps); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1286, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_vit_gaps); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1343, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1286, __pyx_L1_error)
+  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1343, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_INCREF(__pyx_v_obs);
   __Pyx_GIVEREF(__pyx_v_obs);
   PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_obs);
   __Pyx_INCREF(__pyx_v_times);
   __Pyx_GIVEREF(__pyx_v_times);
   PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_times);
-  __pyx_t_3 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1286, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1343, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_tr, __pyx_v_tr) < 0) __PYX_ERR(0, 1286, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_tsft, __pyx_v_tsft) < 0) __PYX_ERR(0, 1286, __pyx_L1_error)
-  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1286, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_tr, __pyx_v_tr) < 0) __PYX_ERR(0, 1343, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_tsft, __pyx_v_tsft) < 0) __PYX_ERR(0, 1343, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1343, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   if ((likely(PyTuple_CheckExact(__pyx_t_4))) || (PyList_CheckExact(__pyx_t_4))) {
     PyObject* sequence = __pyx_t_4;
     Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
     if (unlikely(size != 3)) {
       if (size > 3) __Pyx_RaiseTooManyValuesError(3);
       else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
-      __PYX_ERR(0, 1286, __pyx_L1_error)
+      __PYX_ERR(0, 1343, __pyx_L1_error)
     }
     #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
     if (likely(PyTuple_CheckExact(sequence))) {
       __pyx_t_3 = PyTuple_GET_ITEM(sequence, 0); 
       __pyx_t_2 = PyTuple_GET_ITEM(sequence, 1); 
       __pyx_t_1 = PyTuple_GET_ITEM(sequence, 2); 
     } else {
@@ -24163,162 +24501,162 @@
       __pyx_t_2 = PyList_GET_ITEM(sequence, 1); 
       __pyx_t_1 = PyList_GET_ITEM(sequence, 2); 
     }
     __Pyx_INCREF(__pyx_t_3);
     __Pyx_INCREF(__pyx_t_2);
     __Pyx_INCREF(__pyx_t_1);
     #else
-    __pyx_t_3 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1286, __pyx_L1_error)
+    __pyx_t_3 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1343, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_2 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1286, __pyx_L1_error)
+    __pyx_t_2 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1343, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_1 = PySequence_ITEM(sequence, 2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1286, __pyx_L1_error)
+    __pyx_t_1 = PySequence_ITEM(sequence, 2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1343, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     #endif
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   } else {
     Py_ssize_t index = -1;
-    __pyx_t_5 = PyObject_GetIter(__pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1286, __pyx_L1_error)
+    __pyx_t_5 = PyObject_GetIter(__pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1343, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __pyx_t_6 = Py_TYPE(__pyx_t_5)->tp_iternext;
     index = 0; __pyx_t_3 = __pyx_t_6(__pyx_t_5); if (unlikely(!__pyx_t_3)) goto __pyx_L3_unpacking_failed;
     __Pyx_GOTREF(__pyx_t_3);
     index = 1; __pyx_t_2 = __pyx_t_6(__pyx_t_5); if (unlikely(!__pyx_t_2)) goto __pyx_L3_unpacking_failed;
     __Pyx_GOTREF(__pyx_t_2);
     index = 2; __pyx_t_1 = __pyx_t_6(__pyx_t_5); if (unlikely(!__pyx_t_1)) goto __pyx_L3_unpacking_failed;
     __Pyx_GOTREF(__pyx_t_1);
-    if (__Pyx_IternextUnpackEndCheck(__pyx_t_6(__pyx_t_5), 3) < 0) __PYX_ERR(0, 1286, __pyx_L1_error)
+    if (__Pyx_IternextUnpackEndCheck(__pyx_t_6(__pyx_t_5), 3) < 0) __PYX_ERR(0, 1343, __pyx_L1_error)
     __pyx_t_6 = NULL;
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     goto __pyx_L4_unpacking_done;
     __pyx_L3_unpacking_failed:;
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     __pyx_t_6 = NULL;
     if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
-    __PYX_ERR(0, 1286, __pyx_L1_error)
+    __PYX_ERR(0, 1343, __pyx_L1_error)
     __pyx_L4_unpacking_done:;
   }
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_vits, __pyx_t_3) < 0) __PYX_ERR(0, 1286, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_vits, __pyx_t_3) < 0) __PYX_ERR(0, 1343, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_sts, __pyx_t_2) < 0) __PYX_ERR(0, 1286, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_sts, __pyx_t_2) < 0) __PYX_ERR(0, 1343, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_gps, __pyx_t_1) < 0) __PYX_ERR(0, 1286, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_gps, __pyx_t_1) < 0) __PYX_ERR(0, 1343, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "soapcw/soapcw.pyx":1287
+  /* "soapcw/soapcw.pyx":1344
  *         """
  *         self.vits, self.sts, self.gps = self.vit_gaps(obs, times, tr=tr, tsft=tsft)
  *         self.vit_track, self.vit_track_times = self.get_track(self.vits, self.sts, self.gps,tsft=tsft)             # <<<<<<<<<<<<<<
  *         self.max_end_prob = max(self.vits[-1].V[-1])
  * 
  */
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_get_track); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1287, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_get_track); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1344, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_vits); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1287, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_vits); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1344, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_sts); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1287, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_sts); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1344, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_gps); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1287, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_gps); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1344, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_5 = PyTuple_New(3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1287, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_New(3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1344, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_2);
   PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_2);
   __Pyx_GIVEREF(__pyx_t_3);
   PyTuple_SET_ITEM(__pyx_t_5, 2, __pyx_t_3);
   __pyx_t_1 = 0;
   __pyx_t_2 = 0;
   __pyx_t_3 = 0;
-  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1287, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1344, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_tsft, __pyx_v_tsft) < 0) __PYX_ERR(0, 1287, __pyx_L1_error)
-  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_5, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1287, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_tsft, __pyx_v_tsft) < 0) __PYX_ERR(0, 1344, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_5, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1344, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   if ((likely(PyTuple_CheckExact(__pyx_t_2))) || (PyList_CheckExact(__pyx_t_2))) {
     PyObject* sequence = __pyx_t_2;
     Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
     if (unlikely(size != 2)) {
       if (size > 2) __Pyx_RaiseTooManyValuesError(2);
       else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
-      __PYX_ERR(0, 1287, __pyx_L1_error)
+      __PYX_ERR(0, 1344, __pyx_L1_error)
     }
     #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
     if (likely(PyTuple_CheckExact(sequence))) {
       __pyx_t_3 = PyTuple_GET_ITEM(sequence, 0); 
       __pyx_t_5 = PyTuple_GET_ITEM(sequence, 1); 
     } else {
       __pyx_t_3 = PyList_GET_ITEM(sequence, 0); 
       __pyx_t_5 = PyList_GET_ITEM(sequence, 1); 
     }
     __Pyx_INCREF(__pyx_t_3);
     __Pyx_INCREF(__pyx_t_5);
     #else
-    __pyx_t_3 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1287, __pyx_L1_error)
+    __pyx_t_3 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1344, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_5 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1287, __pyx_L1_error)
+    __pyx_t_5 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1344, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     #endif
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   } else {
     Py_ssize_t index = -1;
-    __pyx_t_4 = PyObject_GetIter(__pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1287, __pyx_L1_error)
+    __pyx_t_4 = PyObject_GetIter(__pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1344, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __pyx_t_6 = Py_TYPE(__pyx_t_4)->tp_iternext;
     index = 0; __pyx_t_3 = __pyx_t_6(__pyx_t_4); if (unlikely(!__pyx_t_3)) goto __pyx_L5_unpacking_failed;
     __Pyx_GOTREF(__pyx_t_3);
     index = 1; __pyx_t_5 = __pyx_t_6(__pyx_t_4); if (unlikely(!__pyx_t_5)) goto __pyx_L5_unpacking_failed;
     __Pyx_GOTREF(__pyx_t_5);
-    if (__Pyx_IternextUnpackEndCheck(__pyx_t_6(__pyx_t_4), 2) < 0) __PYX_ERR(0, 1287, __pyx_L1_error)
+    if (__Pyx_IternextUnpackEndCheck(__pyx_t_6(__pyx_t_4), 2) < 0) __PYX_ERR(0, 1344, __pyx_L1_error)
     __pyx_t_6 = NULL;
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     goto __pyx_L6_unpacking_done;
     __pyx_L5_unpacking_failed:;
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __pyx_t_6 = NULL;
     if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
-    __PYX_ERR(0, 1287, __pyx_L1_error)
+    __PYX_ERR(0, 1344, __pyx_L1_error)
     __pyx_L6_unpacking_done:;
   }
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_vit_track, __pyx_t_3) < 0) __PYX_ERR(0, 1287, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_vit_track, __pyx_t_3) < 0) __PYX_ERR(0, 1344, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_vit_track_times, __pyx_t_5) < 0) __PYX_ERR(0, 1287, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_vit_track_times, __pyx_t_5) < 0) __PYX_ERR(0, 1344, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-  /* "soapcw/soapcw.pyx":1288
+  /* "soapcw/soapcw.pyx":1345
  *         self.vits, self.sts, self.gps = self.vit_gaps(obs, times, tr=tr, tsft=tsft)
  *         self.vit_track, self.vit_track_times = self.get_track(self.vits, self.sts, self.gps,tsft=tsft)
  *         self.max_end_prob = max(self.vits[-1].V[-1])             # <<<<<<<<<<<<<<
  * 
  *     def max_track(self,tr,length,diff,bnd,ind,band_width):
  */
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_vits); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1288, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_vits); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1345, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_2, -1L, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1288, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_2, -1L, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1345, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_V); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1288, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_V); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1345, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_2, -1L, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1288, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_2, -1L, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1345, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_builtin_max, __pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1288, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_builtin_max, __pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1345, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_max_end_prob, __pyx_t_2) < 0) __PYX_ERR(0, 1288, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_max_end_prob, __pyx_t_2) < 0) __PYX_ERR(0, 1345, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "soapcw/soapcw.pyx":1264
+  /* "soapcw/soapcw.pyx":1321
  * class single_detector_gaps(object):
  * 
  *     def __init__(self, tr, obs,times,tsft):             # <<<<<<<<<<<<<<
  *         """
  *         single detector viterbi algorithm where the data can include large gaps in data
  */
 
@@ -24335,15 +24673,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "soapcw/soapcw.pyx":1290
+/* "soapcw/soapcw.pyx":1347
  *         self.max_end_prob = max(self.vits[-1].V[-1])
  * 
  *     def max_track(self,tr,length,diff,bnd,ind,band_width):             # <<<<<<<<<<<<<<
  *         tr_val = np.arange(len(tr)).astype(int) - np.floor(len(tr)/2).astype(int)
  *         result = [seq for seq in itertools.combinations_with_replacement(tr_val, length) if sum(seq) == diff]
  */
 
@@ -24393,49 +24731,49 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_tr)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("max_track", 1, 7, 7, 1); __PYX_ERR(0, 1290, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("max_track", 1, 7, 7, 1); __PYX_ERR(0, 1347, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_length)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("max_track", 1, 7, 7, 2); __PYX_ERR(0, 1290, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("max_track", 1, 7, 7, 2); __PYX_ERR(0, 1347, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_diff)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("max_track", 1, 7, 7, 3); __PYX_ERR(0, 1290, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("max_track", 1, 7, 7, 3); __PYX_ERR(0, 1347, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (likely((values[4] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_bnd)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("max_track", 1, 7, 7, 4); __PYX_ERR(0, 1290, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("max_track", 1, 7, 7, 4); __PYX_ERR(0, 1347, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  5:
         if (likely((values[5] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_ind)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("max_track", 1, 7, 7, 5); __PYX_ERR(0, 1290, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("max_track", 1, 7, 7, 5); __PYX_ERR(0, 1347, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  6:
         if (likely((values[6] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_band_width)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("max_track", 1, 7, 7, 6); __PYX_ERR(0, 1290, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("max_track", 1, 7, 7, 6); __PYX_ERR(0, 1347, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "max_track") < 0)) __PYX_ERR(0, 1290, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "max_track") < 0)) __PYX_ERR(0, 1347, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 7) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
@@ -24450,15 +24788,15 @@
     __pyx_v_diff = values[3];
     __pyx_v_bnd = values[4];
     __pyx_v_ind = values[5];
     __pyx_v_band_width = values[6];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("max_track", 1, 7, 7, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1290, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("max_track", 1, 7, 7, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1347, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("soapcw.soapcw.single_detector_gaps.max_track", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6soapcw_6soapcw_20single_detector_gaps_2max_track(__pyx_self, __pyx_v_self, __pyx_v_tr, __pyx_v_length, __pyx_v_diff, __pyx_v_bnd, __pyx_v_ind, __pyx_v_band_width);
 
@@ -24494,125 +24832,125 @@
   int __pyx_t_11;
   Py_ssize_t __pyx_t_12;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("max_track", 0);
 
-  /* "soapcw/soapcw.pyx":1291
+  /* "soapcw/soapcw.pyx":1348
  * 
  *     def max_track(self,tr,length,diff,bnd,ind,band_width):
  *         tr_val = np.arange(len(tr)).astype(int) - np.floor(len(tr)/2).astype(int)             # <<<<<<<<<<<<<<
  *         result = [seq for seq in itertools.combinations_with_replacement(tr_val, length) if sum(seq) == diff]
  *         max_seq = None
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1291, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1348, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_arange); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1291, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_arange); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1348, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_5 = PyObject_Length(__pyx_v_tr); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1291, __pyx_L1_error)
-  __pyx_t_3 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1291, __pyx_L1_error)
+  __pyx_t_5 = PyObject_Length(__pyx_v_tr); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1348, __pyx_L1_error)
+  __pyx_t_3 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1348, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __pyx_t_6 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
     __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_4);
     if (likely(__pyx_t_6)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
       __Pyx_INCREF(__pyx_t_6);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_4, function);
     }
   }
   __pyx_t_2 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_6, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_3);
   __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1291, __pyx_L1_error)
+  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1348, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_astype); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1291, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_astype); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1348, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_t_2 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
     __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_4);
     if (likely(__pyx_t_2)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
       __Pyx_INCREF(__pyx_t_2);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_4, function);
     }
   }
   __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_2, ((PyObject *)(&PyInt_Type))) : __Pyx_PyObject_CallOneArg(__pyx_t_4, ((PyObject *)(&PyInt_Type)));
   __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1291, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1348, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1291, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1348, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_floor); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1291, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_floor); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1348, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_5 = PyObject_Length(__pyx_v_tr); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1291, __pyx_L1_error)
-  __pyx_t_3 = PyFloat_FromDouble((((double)__pyx_t_5) / 2.0)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1291, __pyx_L1_error)
+  __pyx_t_5 = PyObject_Length(__pyx_v_tr); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1348, __pyx_L1_error)
+  __pyx_t_3 = PyFloat_FromDouble((((double)__pyx_t_5) / 2.0)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1348, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __pyx_t_7 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_6))) {
     __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_6);
     if (likely(__pyx_t_7)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
       __Pyx_INCREF(__pyx_t_7);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_6, function);
     }
   }
   __pyx_t_2 = (__pyx_t_7) ? __Pyx_PyObject_Call2Args(__pyx_t_6, __pyx_t_7, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_t_3);
   __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1291, __pyx_L1_error)
+  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1348, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_astype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1291, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_astype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1348, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_t_2 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_6))) {
     __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_6);
     if (likely(__pyx_t_2)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
       __Pyx_INCREF(__pyx_t_2);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_6, function);
     }
   }
   __pyx_t_4 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_6, __pyx_t_2, ((PyObject *)(&PyInt_Type))) : __Pyx_PyObject_CallOneArg(__pyx_t_6, ((PyObject *)(&PyInt_Type)));
   __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1291, __pyx_L1_error)
+  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1348, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = PyNumber_Subtract(__pyx_t_1, __pyx_t_4); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1291, __pyx_L1_error)
+  __pyx_t_6 = PyNumber_Subtract(__pyx_t_1, __pyx_t_4); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1348, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_v_tr_val = __pyx_t_6;
   __pyx_t_6 = 0;
 
-  /* "soapcw/soapcw.pyx":1292
+  /* "soapcw/soapcw.pyx":1349
  *     def max_track(self,tr,length,diff,bnd,ind,band_width):
  *         tr_val = np.arange(len(tr)).astype(int) - np.floor(len(tr)/2).astype(int)
  *         result = [seq for seq in itertools.combinations_with_replacement(tr_val, length) if sum(seq) == diff]             # <<<<<<<<<<<<<<
  *         max_seq = None
  *         thresh = -np.inf
  */
   { /* enter inner scope */
-    __pyx_t_6 = PyList_New(0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1292, __pyx_L5_error)
+    __pyx_t_6 = PyList_New(0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1349, __pyx_L5_error)
     __Pyx_GOTREF(__pyx_t_6);
-    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_itertools); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1292, __pyx_L5_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_itertools); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1349, __pyx_L5_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_combinations_with_replacement); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1292, __pyx_L5_error)
+    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_combinations_with_replacement); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1349, __pyx_L5_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __pyx_t_1 = NULL;
     __pyx_t_8 = 0;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
       __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_2);
       if (likely(__pyx_t_1)) {
@@ -24622,205 +24960,205 @@
         __Pyx_DECREF_SET(__pyx_t_2, function);
         __pyx_t_8 = 1;
       }
     }
     #if CYTHON_FAST_PYCALL
     if (PyFunction_Check(__pyx_t_2)) {
       PyObject *__pyx_temp[3] = {__pyx_t_1, __pyx_v_tr_val, __pyx_v_length};
-      __pyx_t_4 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1292, __pyx_L5_error)
+      __pyx_t_4 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1349, __pyx_L5_error)
       __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
       __Pyx_GOTREF(__pyx_t_4);
     } else
     #endif
     #if CYTHON_FAST_PYCCALL
     if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
       PyObject *__pyx_temp[3] = {__pyx_t_1, __pyx_v_tr_val, __pyx_v_length};
-      __pyx_t_4 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1292, __pyx_L5_error)
+      __pyx_t_4 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1349, __pyx_L5_error)
       __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
       __Pyx_GOTREF(__pyx_t_4);
     } else
     #endif
     {
-      __pyx_t_3 = PyTuple_New(2+__pyx_t_8); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1292, __pyx_L5_error)
+      __pyx_t_3 = PyTuple_New(2+__pyx_t_8); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1349, __pyx_L5_error)
       __Pyx_GOTREF(__pyx_t_3);
       if (__pyx_t_1) {
         __Pyx_GIVEREF(__pyx_t_1); PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_1); __pyx_t_1 = NULL;
       }
       __Pyx_INCREF(__pyx_v_tr_val);
       __Pyx_GIVEREF(__pyx_v_tr_val);
       PyTuple_SET_ITEM(__pyx_t_3, 0+__pyx_t_8, __pyx_v_tr_val);
       __Pyx_INCREF(__pyx_v_length);
       __Pyx_GIVEREF(__pyx_v_length);
       PyTuple_SET_ITEM(__pyx_t_3, 1+__pyx_t_8, __pyx_v_length);
-      __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1292, __pyx_L5_error)
+      __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1349, __pyx_L5_error)
       __Pyx_GOTREF(__pyx_t_4);
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     }
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     if (likely(PyList_CheckExact(__pyx_t_4)) || PyTuple_CheckExact(__pyx_t_4)) {
       __pyx_t_2 = __pyx_t_4; __Pyx_INCREF(__pyx_t_2); __pyx_t_5 = 0;
       __pyx_t_9 = NULL;
     } else {
-      __pyx_t_5 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1292, __pyx_L5_error)
+      __pyx_t_5 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1349, __pyx_L5_error)
       __Pyx_GOTREF(__pyx_t_2);
-      __pyx_t_9 = Py_TYPE(__pyx_t_2)->tp_iternext; if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1292, __pyx_L5_error)
+      __pyx_t_9 = Py_TYPE(__pyx_t_2)->tp_iternext; if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1349, __pyx_L5_error)
     }
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     for (;;) {
       if (likely(!__pyx_t_9)) {
         if (likely(PyList_CheckExact(__pyx_t_2))) {
           if (__pyx_t_5 >= PyList_GET_SIZE(__pyx_t_2)) break;
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-          __pyx_t_4 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_5); __Pyx_INCREF(__pyx_t_4); __pyx_t_5++; if (unlikely(0 < 0)) __PYX_ERR(0, 1292, __pyx_L5_error)
+          __pyx_t_4 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_5); __Pyx_INCREF(__pyx_t_4); __pyx_t_5++; if (unlikely(0 < 0)) __PYX_ERR(0, 1349, __pyx_L5_error)
           #else
-          __pyx_t_4 = PySequence_ITEM(__pyx_t_2, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1292, __pyx_L5_error)
+          __pyx_t_4 = PySequence_ITEM(__pyx_t_2, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1349, __pyx_L5_error)
           __Pyx_GOTREF(__pyx_t_4);
           #endif
         } else {
           if (__pyx_t_5 >= PyTuple_GET_SIZE(__pyx_t_2)) break;
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-          __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_5); __Pyx_INCREF(__pyx_t_4); __pyx_t_5++; if (unlikely(0 < 0)) __PYX_ERR(0, 1292, __pyx_L5_error)
+          __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_5); __Pyx_INCREF(__pyx_t_4); __pyx_t_5++; if (unlikely(0 < 0)) __PYX_ERR(0, 1349, __pyx_L5_error)
           #else
-          __pyx_t_4 = PySequence_ITEM(__pyx_t_2, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1292, __pyx_L5_error)
+          __pyx_t_4 = PySequence_ITEM(__pyx_t_2, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1349, __pyx_L5_error)
           __Pyx_GOTREF(__pyx_t_4);
           #endif
         }
       } else {
         __pyx_t_4 = __pyx_t_9(__pyx_t_2);
         if (unlikely(!__pyx_t_4)) {
           PyObject* exc_type = PyErr_Occurred();
           if (exc_type) {
             if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-            else __PYX_ERR(0, 1292, __pyx_L5_error)
+            else __PYX_ERR(0, 1349, __pyx_L5_error)
           }
           break;
         }
         __Pyx_GOTREF(__pyx_t_4);
       }
       __Pyx_XDECREF_SET(__pyx_8genexpr9__pyx_v_seq, __pyx_t_4);
       __pyx_t_4 = 0;
-      __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_builtin_sum, __pyx_8genexpr9__pyx_v_seq); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1292, __pyx_L5_error)
+      __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_builtin_sum, __pyx_8genexpr9__pyx_v_seq); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1349, __pyx_L5_error)
       __Pyx_GOTREF(__pyx_t_4);
-      __pyx_t_3 = PyObject_RichCompare(__pyx_t_4, __pyx_v_diff, Py_EQ); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1292, __pyx_L5_error)
+      __pyx_t_3 = PyObject_RichCompare(__pyx_t_4, __pyx_v_diff, Py_EQ); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1349, __pyx_L5_error)
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-      __pyx_t_10 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_10 < 0)) __PYX_ERR(0, 1292, __pyx_L5_error)
+      __pyx_t_10 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_10 < 0)) __PYX_ERR(0, 1349, __pyx_L5_error)
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
       if (__pyx_t_10) {
-        if (unlikely(__Pyx_ListComp_Append(__pyx_t_6, (PyObject*)__pyx_8genexpr9__pyx_v_seq))) __PYX_ERR(0, 1292, __pyx_L5_error)
+        if (unlikely(__Pyx_ListComp_Append(__pyx_t_6, (PyObject*)__pyx_8genexpr9__pyx_v_seq))) __PYX_ERR(0, 1349, __pyx_L5_error)
       }
     }
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_XDECREF(__pyx_8genexpr9__pyx_v_seq); __pyx_8genexpr9__pyx_v_seq = 0;
     goto __pyx_L9_exit_scope;
     __pyx_L5_error:;
     __Pyx_XDECREF(__pyx_8genexpr9__pyx_v_seq); __pyx_8genexpr9__pyx_v_seq = 0;
     goto __pyx_L1_error;
     __pyx_L9_exit_scope:;
   } /* exit inner scope */
   __pyx_v_result = ((PyObject*)__pyx_t_6);
   __pyx_t_6 = 0;
 
-  /* "soapcw/soapcw.pyx":1293
+  /* "soapcw/soapcw.pyx":1350
  *         tr_val = np.arange(len(tr)).astype(int) - np.floor(len(tr)/2).astype(int)
  *         result = [seq for seq in itertools.combinations_with_replacement(tr_val, length) if sum(seq) == diff]
  *         max_seq = None             # <<<<<<<<<<<<<<
  *         thresh = -np.inf
  *         thresh2 = -np.inf
  */
   __Pyx_INCREF(Py_None);
   __pyx_v_max_seq = Py_None;
 
-  /* "soapcw/soapcw.pyx":1294
+  /* "soapcw/soapcw.pyx":1351
  *         result = [seq for seq in itertools.combinations_with_replacement(tr_val, length) if sum(seq) == diff]
  *         max_seq = None
  *         thresh = -np.inf             # <<<<<<<<<<<<<<
  *         thresh2 = -np.inf
  *         #print ind,bnd, diff, [np.cumsum(s)+ind for s in result]
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1294, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1351, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_inf); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1294, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_inf); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1351, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = PyNumber_Negative(__pyx_t_2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1294, __pyx_L1_error)
+  __pyx_t_6 = PyNumber_Negative(__pyx_t_2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1351, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_v_thresh = __pyx_t_6;
   __pyx_t_6 = 0;
 
-  /* "soapcw/soapcw.pyx":1295
+  /* "soapcw/soapcw.pyx":1352
  *         max_seq = None
  *         thresh = -np.inf
  *         thresh2 = -np.inf             # <<<<<<<<<<<<<<
  *         #print ind,bnd, diff, [np.cumsum(s)+ind for s in result]
  *         for seq in result:
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1295, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1352, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_inf); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1295, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_inf); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1352, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = PyNumber_Negative(__pyx_t_2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1295, __pyx_L1_error)
+  __pyx_t_6 = PyNumber_Negative(__pyx_t_2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1352, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_v_thresh2 = __pyx_t_6;
   __pyx_t_6 = 0;
 
-  /* "soapcw/soapcw.pyx":1297
+  /* "soapcw/soapcw.pyx":1354
  *         thresh2 = -np.inf
  *         #print ind,bnd, diff, [np.cumsum(s)+ind for s in result]
  *         for seq in result:             # <<<<<<<<<<<<<<
  *             #print seq
  *             abspath = np.array(np.cumsum(seq) + ind)
  */
   __pyx_t_6 = __pyx_v_result; __Pyx_INCREF(__pyx_t_6); __pyx_t_5 = 0;
   for (;;) {
     if (__pyx_t_5 >= PyList_GET_SIZE(__pyx_t_6)) break;
     #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-    __pyx_t_2 = PyList_GET_ITEM(__pyx_t_6, __pyx_t_5); __Pyx_INCREF(__pyx_t_2); __pyx_t_5++; if (unlikely(0 < 0)) __PYX_ERR(0, 1297, __pyx_L1_error)
+    __pyx_t_2 = PyList_GET_ITEM(__pyx_t_6, __pyx_t_5); __Pyx_INCREF(__pyx_t_2); __pyx_t_5++; if (unlikely(0 < 0)) __PYX_ERR(0, 1354, __pyx_L1_error)
     #else
-    __pyx_t_2 = PySequence_ITEM(__pyx_t_6, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1297, __pyx_L1_error)
+    __pyx_t_2 = PySequence_ITEM(__pyx_t_6, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1354, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     #endif
     __Pyx_XDECREF_SET(__pyx_v_seq, __pyx_t_2);
     __pyx_t_2 = 0;
 
-    /* "soapcw/soapcw.pyx":1299
+    /* "soapcw/soapcw.pyx":1356
  *         for seq in result:
  *             #print seq
  *             abspath = np.array(np.cumsum(seq) + ind)             # <<<<<<<<<<<<<<
  *             if np.any(abspath < 0) == True or np.any(abspath >= band_width) == True:
  *                 continue
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1299, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1356, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_array); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1299, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_array); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1356, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1299, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1356, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_cumsum); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1299, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_cumsum); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1356, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __pyx_t_1 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_7))) {
       __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_7);
       if (likely(__pyx_t_1)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
         __Pyx_INCREF(__pyx_t_1);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_7, function);
       }
     }
     __pyx_t_3 = (__pyx_t_1) ? __Pyx_PyObject_Call2Args(__pyx_t_7, __pyx_t_1, __pyx_v_seq) : __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_v_seq);
     __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
-    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1299, __pyx_L1_error)
+    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1356, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-    __pyx_t_7 = PyNumber_Add(__pyx_t_3, __pyx_v_ind); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1299, __pyx_L1_error)
+    __pyx_t_7 = PyNumber_Add(__pyx_t_3, __pyx_v_ind); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1356, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_t_3 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
       __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_4);
       if (likely(__pyx_t_3)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
@@ -24828,213 +25166,213 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_4, function);
       }
     }
     __pyx_t_2 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_3, __pyx_t_7) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_7);
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1299, __pyx_L1_error)
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1356, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_XDECREF_SET(__pyx_v_abspath, __pyx_t_2);
     __pyx_t_2 = 0;
 
-    /* "soapcw/soapcw.pyx":1300
+    /* "soapcw/soapcw.pyx":1357
  *             #print seq
  *             abspath = np.array(np.cumsum(seq) + ind)
  *             if np.any(abspath < 0) == True or np.any(abspath >= band_width) == True:             # <<<<<<<<<<<<<<
  *                 continue
  *             else:
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1300, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1357, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_any); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1300, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_any); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1357, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_t_4 = PyObject_RichCompare(__pyx_v_abspath, __pyx_int_0, Py_LT); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1300, __pyx_L1_error)
+    __pyx_t_4 = PyObject_RichCompare(__pyx_v_abspath, __pyx_int_0, Py_LT); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1357, __pyx_L1_error)
     __pyx_t_3 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_7))) {
       __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_7);
       if (likely(__pyx_t_3)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
         __Pyx_INCREF(__pyx_t_3);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_7, function);
       }
     }
     __pyx_t_2 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_7, __pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_t_4);
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1300, __pyx_L1_error)
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1357, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-    __pyx_t_7 = PyObject_RichCompare(__pyx_t_2, Py_True, Py_EQ); __Pyx_XGOTREF(__pyx_t_7); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1300, __pyx_L1_error)
+    __pyx_t_7 = PyObject_RichCompare(__pyx_t_2, Py_True, Py_EQ); __Pyx_XGOTREF(__pyx_t_7); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1357, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely(__pyx_t_11 < 0)) __PYX_ERR(0, 1300, __pyx_L1_error)
+    __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely(__pyx_t_11 < 0)) __PYX_ERR(0, 1357, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     if (!__pyx_t_11) {
     } else {
       __pyx_t_10 = __pyx_t_11;
       goto __pyx_L13_bool_binop_done;
     }
-    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1300, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1357, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_any); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1300, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_any); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1357, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __pyx_t_2 = PyObject_RichCompare(__pyx_v_abspath, __pyx_v_band_width, Py_GE); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1300, __pyx_L1_error)
+    __pyx_t_2 = PyObject_RichCompare(__pyx_v_abspath, __pyx_v_band_width, Py_GE); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1357, __pyx_L1_error)
     __pyx_t_3 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
       __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_4);
       if (likely(__pyx_t_3)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
         __Pyx_INCREF(__pyx_t_3);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_4, function);
       }
     }
     __pyx_t_7 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_3, __pyx_t_2) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_2);
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1300, __pyx_L1_error)
+    if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1357, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_t_4 = PyObject_RichCompare(__pyx_t_7, Py_True, Py_EQ); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1300, __pyx_L1_error)
+    __pyx_t_4 = PyObject_RichCompare(__pyx_t_7, Py_True, Py_EQ); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1357, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-    __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_11 < 0)) __PYX_ERR(0, 1300, __pyx_L1_error)
+    __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_11 < 0)) __PYX_ERR(0, 1357, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __pyx_t_10 = __pyx_t_11;
     __pyx_L13_bool_binop_done:;
     if (__pyx_t_10) {
 
-      /* "soapcw/soapcw.pyx":1301
+      /* "soapcw/soapcw.pyx":1358
  *             abspath = np.array(np.cumsum(seq) + ind)
  *             if np.any(abspath < 0) == True or np.any(abspath >= band_width) == True:
  *                 continue             # <<<<<<<<<<<<<<
  *             else:
  *                 s = sum([tr[elem+1] for elem in seq])
  */
       goto __pyx_L10_continue;
 
-      /* "soapcw/soapcw.pyx":1300
+      /* "soapcw/soapcw.pyx":1357
  *             #print seq
  *             abspath = np.array(np.cumsum(seq) + ind)
  *             if np.any(abspath < 0) == True or np.any(abspath >= band_width) == True:             # <<<<<<<<<<<<<<
  *                 continue
  *             else:
  */
     }
 
-    /* "soapcw/soapcw.pyx":1303
+    /* "soapcw/soapcw.pyx":1360
  *                 continue
  *             else:
  *                 s = sum([tr[elem+1] for elem in seq])             # <<<<<<<<<<<<<<
  *                 l = len(np.where(np.array(seq) == 0)[0])
  *                 if s > thresh:
  */
     /*else*/ {
       { /* enter inner scope */
-        __pyx_t_4 = PyList_New(0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1303, __pyx_L17_error)
+        __pyx_t_4 = PyList_New(0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1360, __pyx_L17_error)
         __Pyx_GOTREF(__pyx_t_4);
         if (likely(PyList_CheckExact(__pyx_v_seq)) || PyTuple_CheckExact(__pyx_v_seq)) {
           __pyx_t_7 = __pyx_v_seq; __Pyx_INCREF(__pyx_t_7); __pyx_t_12 = 0;
           __pyx_t_9 = NULL;
         } else {
-          __pyx_t_12 = -1; __pyx_t_7 = PyObject_GetIter(__pyx_v_seq); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1303, __pyx_L17_error)
+          __pyx_t_12 = -1; __pyx_t_7 = PyObject_GetIter(__pyx_v_seq); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1360, __pyx_L17_error)
           __Pyx_GOTREF(__pyx_t_7);
-          __pyx_t_9 = Py_TYPE(__pyx_t_7)->tp_iternext; if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1303, __pyx_L17_error)
+          __pyx_t_9 = Py_TYPE(__pyx_t_7)->tp_iternext; if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1360, __pyx_L17_error)
         }
         for (;;) {
           if (likely(!__pyx_t_9)) {
             if (likely(PyList_CheckExact(__pyx_t_7))) {
               if (__pyx_t_12 >= PyList_GET_SIZE(__pyx_t_7)) break;
               #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-              __pyx_t_2 = PyList_GET_ITEM(__pyx_t_7, __pyx_t_12); __Pyx_INCREF(__pyx_t_2); __pyx_t_12++; if (unlikely(0 < 0)) __PYX_ERR(0, 1303, __pyx_L17_error)
+              __pyx_t_2 = PyList_GET_ITEM(__pyx_t_7, __pyx_t_12); __Pyx_INCREF(__pyx_t_2); __pyx_t_12++; if (unlikely(0 < 0)) __PYX_ERR(0, 1360, __pyx_L17_error)
               #else
-              __pyx_t_2 = PySequence_ITEM(__pyx_t_7, __pyx_t_12); __pyx_t_12++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1303, __pyx_L17_error)
+              __pyx_t_2 = PySequence_ITEM(__pyx_t_7, __pyx_t_12); __pyx_t_12++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1360, __pyx_L17_error)
               __Pyx_GOTREF(__pyx_t_2);
               #endif
             } else {
               if (__pyx_t_12 >= PyTuple_GET_SIZE(__pyx_t_7)) break;
               #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-              __pyx_t_2 = PyTuple_GET_ITEM(__pyx_t_7, __pyx_t_12); __Pyx_INCREF(__pyx_t_2); __pyx_t_12++; if (unlikely(0 < 0)) __PYX_ERR(0, 1303, __pyx_L17_error)
+              __pyx_t_2 = PyTuple_GET_ITEM(__pyx_t_7, __pyx_t_12); __Pyx_INCREF(__pyx_t_2); __pyx_t_12++; if (unlikely(0 < 0)) __PYX_ERR(0, 1360, __pyx_L17_error)
               #else
-              __pyx_t_2 = PySequence_ITEM(__pyx_t_7, __pyx_t_12); __pyx_t_12++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1303, __pyx_L17_error)
+              __pyx_t_2 = PySequence_ITEM(__pyx_t_7, __pyx_t_12); __pyx_t_12++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1360, __pyx_L17_error)
               __Pyx_GOTREF(__pyx_t_2);
               #endif
             }
           } else {
             __pyx_t_2 = __pyx_t_9(__pyx_t_7);
             if (unlikely(!__pyx_t_2)) {
               PyObject* exc_type = PyErr_Occurred();
               if (exc_type) {
                 if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-                else __PYX_ERR(0, 1303, __pyx_L17_error)
+                else __PYX_ERR(0, 1360, __pyx_L17_error)
               }
               break;
             }
             __Pyx_GOTREF(__pyx_t_2);
           }
           __Pyx_XDECREF_SET(__pyx_9genexpr10__pyx_v_elem, __pyx_t_2);
           __pyx_t_2 = 0;
-          __pyx_t_2 = __Pyx_PyInt_AddObjC(__pyx_9genexpr10__pyx_v_elem, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1303, __pyx_L17_error)
+          __pyx_t_2 = __Pyx_PyInt_AddObjC(__pyx_9genexpr10__pyx_v_elem, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1360, __pyx_L17_error)
           __Pyx_GOTREF(__pyx_t_2);
-          __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_v_tr, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1303, __pyx_L17_error)
+          __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_v_tr, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1360, __pyx_L17_error)
           __Pyx_GOTREF(__pyx_t_3);
           __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-          if (unlikely(__Pyx_ListComp_Append(__pyx_t_4, (PyObject*)__pyx_t_3))) __PYX_ERR(0, 1303, __pyx_L17_error)
+          if (unlikely(__Pyx_ListComp_Append(__pyx_t_4, (PyObject*)__pyx_t_3))) __PYX_ERR(0, 1360, __pyx_L17_error)
           __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         }
         __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
         __Pyx_XDECREF(__pyx_9genexpr10__pyx_v_elem); __pyx_9genexpr10__pyx_v_elem = 0;
         goto __pyx_L20_exit_scope;
         __pyx_L17_error:;
         __Pyx_XDECREF(__pyx_9genexpr10__pyx_v_elem); __pyx_9genexpr10__pyx_v_elem = 0;
         goto __pyx_L1_error;
         __pyx_L20_exit_scope:;
       } /* exit inner scope */
-      __pyx_t_7 = __Pyx_PyObject_CallOneArg(__pyx_builtin_sum, __pyx_t_4); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1303, __pyx_L1_error)
+      __pyx_t_7 = __Pyx_PyObject_CallOneArg(__pyx_builtin_sum, __pyx_t_4); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1360, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_7);
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
       __Pyx_XDECREF_SET(__pyx_v_s, __pyx_t_7);
       __pyx_t_7 = 0;
 
-      /* "soapcw/soapcw.pyx":1304
+      /* "soapcw/soapcw.pyx":1361
  *             else:
  *                 s = sum([tr[elem+1] for elem in seq])
  *                 l = len(np.where(np.array(seq) == 0)[0])             # <<<<<<<<<<<<<<
  *                 if s > thresh:
  *                     max_seq = np.insert(abspath,0,ind)[:-1]
  */
-      __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1304, __pyx_L1_error)
+      __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1361, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
-      __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_where); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1304, __pyx_L1_error)
+      __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_where); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1361, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-      __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1304, __pyx_L1_error)
+      __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1361, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_array); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1304, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_array); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1361, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
       __pyx_t_2 = NULL;
       if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_1))) {
         __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_1);
         if (likely(__pyx_t_2)) {
           PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
           __Pyx_INCREF(__pyx_t_2);
           __Pyx_INCREF(function);
           __Pyx_DECREF_SET(__pyx_t_1, function);
         }
       }
       __pyx_t_4 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_2, __pyx_v_seq) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_v_seq);
       __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-      if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1304, __pyx_L1_error)
+      if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1361, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-      __pyx_t_1 = __Pyx_PyInt_EqObjC(__pyx_t_4, __pyx_int_0, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1304, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyInt_EqObjC(__pyx_t_4, __pyx_int_0, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1361, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
       __pyx_t_4 = NULL;
       if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
         __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
         if (likely(__pyx_t_4)) {
           PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
@@ -25042,46 +25380,46 @@
           __Pyx_INCREF(function);
           __Pyx_DECREF_SET(__pyx_t_3, function);
         }
       }
       __pyx_t_7 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_t_1) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_1);
       __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-      if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1304, __pyx_L1_error)
+      if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1361, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_7);
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-      __pyx_t_3 = __Pyx_GetItemInt(__pyx_t_7, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1304, __pyx_L1_error)
+      __pyx_t_3 = __Pyx_GetItemInt(__pyx_t_7, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1361, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
       __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-      __pyx_t_12 = PyObject_Length(__pyx_t_3); if (unlikely(__pyx_t_12 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1304, __pyx_L1_error)
+      __pyx_t_12 = PyObject_Length(__pyx_t_3); if (unlikely(__pyx_t_12 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1361, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
       __pyx_v_l = __pyx_t_12;
 
-      /* "soapcw/soapcw.pyx":1305
+      /* "soapcw/soapcw.pyx":1362
  *                 s = sum([tr[elem+1] for elem in seq])
  *                 l = len(np.where(np.array(seq) == 0)[0])
  *                 if s > thresh:             # <<<<<<<<<<<<<<
  *                     max_seq = np.insert(abspath,0,ind)[:-1]
  *                     thresh = s
  */
-      __pyx_t_3 = PyObject_RichCompare(__pyx_v_s, __pyx_v_thresh, Py_GT); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1305, __pyx_L1_error)
-      __pyx_t_10 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_10 < 0)) __PYX_ERR(0, 1305, __pyx_L1_error)
+      __pyx_t_3 = PyObject_RichCompare(__pyx_v_s, __pyx_v_thresh, Py_GT); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1362, __pyx_L1_error)
+      __pyx_t_10 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_10 < 0)) __PYX_ERR(0, 1362, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
       if (__pyx_t_10) {
 
-        /* "soapcw/soapcw.pyx":1306
+        /* "soapcw/soapcw.pyx":1363
  *                 l = len(np.where(np.array(seq) == 0)[0])
  *                 if s > thresh:
  *                     max_seq = np.insert(abspath,0,ind)[:-1]             # <<<<<<<<<<<<<<
  *                     thresh = s
  *                 elif s == thresh and l > thresh2:
  */
-        __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1306, __pyx_L1_error)
+        __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1363, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_7);
-        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_insert); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1306, __pyx_L1_error)
+        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_insert); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1363, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
         __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
         __pyx_t_7 = NULL;
         __pyx_t_8 = 0;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_1))) {
           __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_1);
           if (likely(__pyx_t_7)) {
@@ -25091,108 +25429,108 @@
             __Pyx_DECREF_SET(__pyx_t_1, function);
             __pyx_t_8 = 1;
           }
         }
         #if CYTHON_FAST_PYCALL
         if (PyFunction_Check(__pyx_t_1)) {
           PyObject *__pyx_temp[4] = {__pyx_t_7, __pyx_v_abspath, __pyx_int_0, __pyx_v_ind};
-          __pyx_t_3 = __Pyx_PyFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_8, 3+__pyx_t_8); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1306, __pyx_L1_error)
+          __pyx_t_3 = __Pyx_PyFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_8, 3+__pyx_t_8); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1363, __pyx_L1_error)
           __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
           __Pyx_GOTREF(__pyx_t_3);
         } else
         #endif
         #if CYTHON_FAST_PYCCALL
         if (__Pyx_PyFastCFunction_Check(__pyx_t_1)) {
           PyObject *__pyx_temp[4] = {__pyx_t_7, __pyx_v_abspath, __pyx_int_0, __pyx_v_ind};
-          __pyx_t_3 = __Pyx_PyCFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_8, 3+__pyx_t_8); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1306, __pyx_L1_error)
+          __pyx_t_3 = __Pyx_PyCFunction_FastCall(__pyx_t_1, __pyx_temp+1-__pyx_t_8, 3+__pyx_t_8); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1363, __pyx_L1_error)
           __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
           __Pyx_GOTREF(__pyx_t_3);
         } else
         #endif
         {
-          __pyx_t_4 = PyTuple_New(3+__pyx_t_8); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1306, __pyx_L1_error)
+          __pyx_t_4 = PyTuple_New(3+__pyx_t_8); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1363, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_4);
           if (__pyx_t_7) {
             __Pyx_GIVEREF(__pyx_t_7); PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_7); __pyx_t_7 = NULL;
           }
           __Pyx_INCREF(__pyx_v_abspath);
           __Pyx_GIVEREF(__pyx_v_abspath);
           PyTuple_SET_ITEM(__pyx_t_4, 0+__pyx_t_8, __pyx_v_abspath);
           __Pyx_INCREF(__pyx_int_0);
           __Pyx_GIVEREF(__pyx_int_0);
           PyTuple_SET_ITEM(__pyx_t_4, 1+__pyx_t_8, __pyx_int_0);
           __Pyx_INCREF(__pyx_v_ind);
           __Pyx_GIVEREF(__pyx_v_ind);
           PyTuple_SET_ITEM(__pyx_t_4, 2+__pyx_t_8, __pyx_v_ind);
-          __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_4, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1306, __pyx_L1_error)
+          __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_4, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1363, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_3);
           __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
         }
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-        __pyx_t_1 = __Pyx_PyObject_GetSlice(__pyx_t_3, 0, -1L, NULL, NULL, &__pyx_slice__10, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1306, __pyx_L1_error)
+        __pyx_t_1 = __Pyx_PyObject_GetSlice(__pyx_t_3, 0, -1L, NULL, NULL, &__pyx_slice__10, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1363, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         __Pyx_DECREF_SET(__pyx_v_max_seq, __pyx_t_1);
         __pyx_t_1 = 0;
 
-        /* "soapcw/soapcw.pyx":1307
+        /* "soapcw/soapcw.pyx":1364
  *                 if s > thresh:
  *                     max_seq = np.insert(abspath,0,ind)[:-1]
  *                     thresh = s             # <<<<<<<<<<<<<<
  *                 elif s == thresh and l > thresh2:
  *                     max_seq = np.insert(abspath,0,ind)[:-1]
  */
         __Pyx_INCREF(__pyx_v_s);
         __Pyx_DECREF_SET(__pyx_v_thresh, __pyx_v_s);
 
-        /* "soapcw/soapcw.pyx":1305
+        /* "soapcw/soapcw.pyx":1362
  *                 s = sum([tr[elem+1] for elem in seq])
  *                 l = len(np.where(np.array(seq) == 0)[0])
  *                 if s > thresh:             # <<<<<<<<<<<<<<
  *                     max_seq = np.insert(abspath,0,ind)[:-1]
  *                     thresh = s
  */
         goto __pyx_L21;
       }
 
-      /* "soapcw/soapcw.pyx":1308
+      /* "soapcw/soapcw.pyx":1365
  *                     max_seq = np.insert(abspath,0,ind)[:-1]
  *                     thresh = s
  *                 elif s == thresh and l > thresh2:             # <<<<<<<<<<<<<<
  *                     max_seq = np.insert(abspath,0,ind)[:-1]
  *                     thresh = s
  */
-      __pyx_t_1 = PyObject_RichCompare(__pyx_v_s, __pyx_v_thresh, Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1308, __pyx_L1_error)
-      __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_11 < 0)) __PYX_ERR(0, 1308, __pyx_L1_error)
+      __pyx_t_1 = PyObject_RichCompare(__pyx_v_s, __pyx_v_thresh, Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1365, __pyx_L1_error)
+      __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_11 < 0)) __PYX_ERR(0, 1365, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       if (__pyx_t_11) {
       } else {
         __pyx_t_10 = __pyx_t_11;
         goto __pyx_L22_bool_binop_done;
       }
-      __pyx_t_1 = PyInt_FromSsize_t(__pyx_v_l); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1308, __pyx_L1_error)
+      __pyx_t_1 = PyInt_FromSsize_t(__pyx_v_l); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1365, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
-      __pyx_t_3 = PyObject_RichCompare(__pyx_t_1, __pyx_v_thresh2, Py_GT); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1308, __pyx_L1_error)
+      __pyx_t_3 = PyObject_RichCompare(__pyx_t_1, __pyx_v_thresh2, Py_GT); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1365, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-      __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_11 < 0)) __PYX_ERR(0, 1308, __pyx_L1_error)
+      __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_11 < 0)) __PYX_ERR(0, 1365, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
       __pyx_t_10 = __pyx_t_11;
       __pyx_L22_bool_binop_done:;
       if (__pyx_t_10) {
 
-        /* "soapcw/soapcw.pyx":1309
+        /* "soapcw/soapcw.pyx":1366
  *                     thresh = s
  *                 elif s == thresh and l > thresh2:
  *                     max_seq = np.insert(abspath,0,ind)[:-1]             # <<<<<<<<<<<<<<
  *                     thresh = s
  *                     thresh2 = l
  */
-        __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1309, __pyx_L1_error)
+        __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1366, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
-        __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_insert); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1309, __pyx_L1_error)
+        __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_insert); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1366, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         __pyx_t_1 = NULL;
         __pyx_t_8 = 0;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
           __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_4);
           if (likely(__pyx_t_1)) {
@@ -25202,119 +25540,119 @@
             __Pyx_DECREF_SET(__pyx_t_4, function);
             __pyx_t_8 = 1;
           }
         }
         #if CYTHON_FAST_PYCALL
         if (PyFunction_Check(__pyx_t_4)) {
           PyObject *__pyx_temp[4] = {__pyx_t_1, __pyx_v_abspath, __pyx_int_0, __pyx_v_ind};
-          __pyx_t_3 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_8, 3+__pyx_t_8); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1309, __pyx_L1_error)
+          __pyx_t_3 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_8, 3+__pyx_t_8); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1366, __pyx_L1_error)
           __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
           __Pyx_GOTREF(__pyx_t_3);
         } else
         #endif
         #if CYTHON_FAST_PYCCALL
         if (__Pyx_PyFastCFunction_Check(__pyx_t_4)) {
           PyObject *__pyx_temp[4] = {__pyx_t_1, __pyx_v_abspath, __pyx_int_0, __pyx_v_ind};
-          __pyx_t_3 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_8, 3+__pyx_t_8); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1309, __pyx_L1_error)
+          __pyx_t_3 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_8, 3+__pyx_t_8); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1366, __pyx_L1_error)
           __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
           __Pyx_GOTREF(__pyx_t_3);
         } else
         #endif
         {
-          __pyx_t_7 = PyTuple_New(3+__pyx_t_8); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1309, __pyx_L1_error)
+          __pyx_t_7 = PyTuple_New(3+__pyx_t_8); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1366, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_7);
           if (__pyx_t_1) {
             __Pyx_GIVEREF(__pyx_t_1); PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_1); __pyx_t_1 = NULL;
           }
           __Pyx_INCREF(__pyx_v_abspath);
           __Pyx_GIVEREF(__pyx_v_abspath);
           PyTuple_SET_ITEM(__pyx_t_7, 0+__pyx_t_8, __pyx_v_abspath);
           __Pyx_INCREF(__pyx_int_0);
           __Pyx_GIVEREF(__pyx_int_0);
           PyTuple_SET_ITEM(__pyx_t_7, 1+__pyx_t_8, __pyx_int_0);
           __Pyx_INCREF(__pyx_v_ind);
           __Pyx_GIVEREF(__pyx_v_ind);
           PyTuple_SET_ITEM(__pyx_t_7, 2+__pyx_t_8, __pyx_v_ind);
-          __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_7, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1309, __pyx_L1_error)
+          __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_7, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1366, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_3);
           __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
         }
         __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-        __pyx_t_4 = __Pyx_PyObject_GetSlice(__pyx_t_3, 0, -1L, NULL, NULL, &__pyx_slice__10, 0, 1, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1309, __pyx_L1_error)
+        __pyx_t_4 = __Pyx_PyObject_GetSlice(__pyx_t_3, 0, -1L, NULL, NULL, &__pyx_slice__10, 0, 1, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1366, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         __Pyx_DECREF_SET(__pyx_v_max_seq, __pyx_t_4);
         __pyx_t_4 = 0;
 
-        /* "soapcw/soapcw.pyx":1310
+        /* "soapcw/soapcw.pyx":1367
  *                 elif s == thresh and l > thresh2:
  *                     max_seq = np.insert(abspath,0,ind)[:-1]
  *                     thresh = s             # <<<<<<<<<<<<<<
  *                     thresh2 = l
  * 
  */
         __Pyx_INCREF(__pyx_v_s);
         __Pyx_DECREF_SET(__pyx_v_thresh, __pyx_v_s);
 
-        /* "soapcw/soapcw.pyx":1311
+        /* "soapcw/soapcw.pyx":1368
  *                     max_seq = np.insert(abspath,0,ind)[:-1]
  *                     thresh = s
  *                     thresh2 = l             # <<<<<<<<<<<<<<
  * 
  *         return max_seq,s
  */
-        __pyx_t_4 = PyInt_FromSsize_t(__pyx_v_l); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1311, __pyx_L1_error)
+        __pyx_t_4 = PyInt_FromSsize_t(__pyx_v_l); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1368, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
         __Pyx_DECREF_SET(__pyx_v_thresh2, __pyx_t_4);
         __pyx_t_4 = 0;
 
-        /* "soapcw/soapcw.pyx":1308
+        /* "soapcw/soapcw.pyx":1365
  *                     max_seq = np.insert(abspath,0,ind)[:-1]
  *                     thresh = s
  *                 elif s == thresh and l > thresh2:             # <<<<<<<<<<<<<<
  *                     max_seq = np.insert(abspath,0,ind)[:-1]
  *                     thresh = s
  */
       }
       __pyx_L21:;
     }
 
-    /* "soapcw/soapcw.pyx":1297
+    /* "soapcw/soapcw.pyx":1354
  *         thresh2 = -np.inf
  *         #print ind,bnd, diff, [np.cumsum(s)+ind for s in result]
  *         for seq in result:             # <<<<<<<<<<<<<<
  *             #print seq
  *             abspath = np.array(np.cumsum(seq) + ind)
  */
     __pyx_L10_continue:;
   }
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
 
-  /* "soapcw/soapcw.pyx":1313
+  /* "soapcw/soapcw.pyx":1370
  *                     thresh2 = l
  * 
  *         return max_seq,s             # <<<<<<<<<<<<<<
  * 
  *     def gap_run(self,viterbi, band_width, diff, tsft, tr):
  */
   __Pyx_XDECREF(__pyx_r);
-  if (unlikely(!__pyx_v_s)) { __Pyx_RaiseUnboundLocalError("s"); __PYX_ERR(0, 1313, __pyx_L1_error) }
-  __pyx_t_6 = PyTuple_New(2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1313, __pyx_L1_error)
+  if (unlikely(!__pyx_v_s)) { __Pyx_RaiseUnboundLocalError("s"); __PYX_ERR(0, 1370, __pyx_L1_error) }
+  __pyx_t_6 = PyTuple_New(2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1370, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_INCREF(__pyx_v_max_seq);
   __Pyx_GIVEREF(__pyx_v_max_seq);
   PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_v_max_seq);
   __Pyx_INCREF(__pyx_v_s);
   __Pyx_GIVEREF(__pyx_v_s);
   PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_v_s);
   __pyx_r = __pyx_t_6;
   __pyx_t_6 = 0;
   goto __pyx_L0;
 
-  /* "soapcw/soapcw.pyx":1290
+  /* "soapcw/soapcw.pyx":1347
  *         self.max_end_prob = max(self.vits[-1].V[-1])
  * 
  *     def max_track(self,tr,length,diff,bnd,ind,band_width):             # <<<<<<<<<<<<<<
  *         tr_val = np.arange(len(tr)).astype(int) - np.floor(len(tr)/2).astype(int)
  *         result = [seq for seq in itertools.combinations_with_replacement(tr_val, length) if sum(seq) == diff]
  */
 
@@ -25340,15 +25678,15 @@
   __Pyx_XDECREF(__pyx_8genexpr9__pyx_v_seq);
   __Pyx_XDECREF(__pyx_9genexpr10__pyx_v_elem);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "soapcw/soapcw.pyx":1315
+/* "soapcw/soapcw.pyx":1372
  *         return max_seq,s
  * 
  *     def gap_run(self,viterbi, band_width, diff, tsft, tr):             # <<<<<<<<<<<<<<
  *         length = diff - 1
  *         max_vals = np.zeros(band_width)
  */
 
@@ -25395,43 +25733,43 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_viterbi)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("gap_run", 1, 6, 6, 1); __PYX_ERR(0, 1315, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("gap_run", 1, 6, 6, 1); __PYX_ERR(0, 1372, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_band_width)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("gap_run", 1, 6, 6, 2); __PYX_ERR(0, 1315, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("gap_run", 1, 6, 6, 2); __PYX_ERR(0, 1372, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_diff)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("gap_run", 1, 6, 6, 3); __PYX_ERR(0, 1315, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("gap_run", 1, 6, 6, 3); __PYX_ERR(0, 1372, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (likely((values[4] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_tsft)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("gap_run", 1, 6, 6, 4); __PYX_ERR(0, 1315, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("gap_run", 1, 6, 6, 4); __PYX_ERR(0, 1372, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  5:
         if (likely((values[5] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_tr)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("gap_run", 1, 6, 6, 5); __PYX_ERR(0, 1315, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("gap_run", 1, 6, 6, 5); __PYX_ERR(0, 1372, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "gap_run") < 0)) __PYX_ERR(0, 1315, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "gap_run") < 0)) __PYX_ERR(0, 1372, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 6) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
@@ -25444,15 +25782,15 @@
     __pyx_v_band_width = values[2];
     __pyx_v_diff = values[3];
     __pyx_v_tsft = values[4];
     __pyx_v_tr = values[5];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("gap_run", 1, 6, 6, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1315, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("gap_run", 1, 6, 6, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1372, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("soapcw.soapcw.single_detector_gaps.gap_run", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6soapcw_6soapcw_20single_detector_gaps_4gap_run(__pyx_self, __pyx_v_self, __pyx_v_viterbi, __pyx_v_band_width, __pyx_v_diff, __pyx_v_tsft, __pyx_v_tr);
 
@@ -25489,69 +25827,69 @@
   int __pyx_t_10;
   PyObject *__pyx_t_11 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("gap_run", 0);
 
-  /* "soapcw/soapcw.pyx":1316
+  /* "soapcw/soapcw.pyx":1373
  * 
  *     def gap_run(self,viterbi, band_width, diff, tsft, tr):
  *         length = diff - 1             # <<<<<<<<<<<<<<
  *         max_vals = np.zeros(band_width)
  *         max_paths = np.zeros((band_width,length))
  */
-  __pyx_t_1 = __Pyx_PyInt_SubtractObjC(__pyx_v_diff, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1316, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_SubtractObjC(__pyx_v_diff, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1373, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_length = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "soapcw/soapcw.pyx":1317
+  /* "soapcw/soapcw.pyx":1374
  *     def gap_run(self,viterbi, band_width, diff, tsft, tr):
  *         length = diff - 1
  *         max_vals = np.zeros(band_width)             # <<<<<<<<<<<<<<
  *         max_paths = np.zeros((band_width,length))
  *         #print band_width, length
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1317, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1374, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_zeros); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1317, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_zeros); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1374, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_t_2 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
     __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
     if (likely(__pyx_t_2)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
       __Pyx_INCREF(__pyx_t_2);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_3, function);
     }
   }
   __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_2, __pyx_v_band_width) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_band_width);
   __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1317, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1374, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_v_max_vals = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "soapcw/soapcw.pyx":1318
+  /* "soapcw/soapcw.pyx":1375
  *         length = diff - 1
  *         max_vals = np.zeros(band_width)
  *         max_paths = np.zeros((band_width,length))             # <<<<<<<<<<<<<<
  *         #print band_width, length
  *         for bnd in range(band_width):
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1318, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1375, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1318, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1375, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1318, __pyx_L1_error)
+  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1375, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_INCREF(__pyx_v_band_width);
   __Pyx_GIVEREF(__pyx_v_band_width);
   PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_band_width);
   __Pyx_INCREF(__pyx_v_length);
   __Pyx_GIVEREF(__pyx_v_length);
   PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_v_length);
@@ -25564,363 +25902,363 @@
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_2, function);
     }
   }
   __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_4, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3);
   __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1318, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1375, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_v_max_paths = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "soapcw/soapcw.pyx":1320
+  /* "soapcw/soapcw.pyx":1377
  *         max_paths = np.zeros((band_width,length))
  *         #print band_width, length
  *         for bnd in range(band_width):             # <<<<<<<<<<<<<<
  *             low = bnd - length
  *             high = bnd + length + 1
  */
-  __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_builtin_range, __pyx_v_band_width); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1320, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_builtin_range, __pyx_v_band_width); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1377, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   if (likely(PyList_CheckExact(__pyx_t_1)) || PyTuple_CheckExact(__pyx_t_1)) {
     __pyx_t_2 = __pyx_t_1; __Pyx_INCREF(__pyx_t_2); __pyx_t_5 = 0;
     __pyx_t_6 = NULL;
   } else {
-    __pyx_t_5 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1320, __pyx_L1_error)
+    __pyx_t_5 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1377, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_6 = Py_TYPE(__pyx_t_2)->tp_iternext; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1320, __pyx_L1_error)
+    __pyx_t_6 = Py_TYPE(__pyx_t_2)->tp_iternext; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1377, __pyx_L1_error)
   }
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   for (;;) {
     if (likely(!__pyx_t_6)) {
       if (likely(PyList_CheckExact(__pyx_t_2))) {
         if (__pyx_t_5 >= PyList_GET_SIZE(__pyx_t_2)) break;
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_1 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_5); __Pyx_INCREF(__pyx_t_1); __pyx_t_5++; if (unlikely(0 < 0)) __PYX_ERR(0, 1320, __pyx_L1_error)
+        __pyx_t_1 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_5); __Pyx_INCREF(__pyx_t_1); __pyx_t_5++; if (unlikely(0 < 0)) __PYX_ERR(0, 1377, __pyx_L1_error)
         #else
-        __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1320, __pyx_L1_error)
+        __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1377, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
         #endif
       } else {
         if (__pyx_t_5 >= PyTuple_GET_SIZE(__pyx_t_2)) break;
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_5); __Pyx_INCREF(__pyx_t_1); __pyx_t_5++; if (unlikely(0 < 0)) __PYX_ERR(0, 1320, __pyx_L1_error)
+        __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_5); __Pyx_INCREF(__pyx_t_1); __pyx_t_5++; if (unlikely(0 < 0)) __PYX_ERR(0, 1377, __pyx_L1_error)
         #else
-        __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1320, __pyx_L1_error)
+        __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1377, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
         #endif
       }
     } else {
       __pyx_t_1 = __pyx_t_6(__pyx_t_2);
       if (unlikely(!__pyx_t_1)) {
         PyObject* exc_type = PyErr_Occurred();
         if (exc_type) {
           if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-          else __PYX_ERR(0, 1320, __pyx_L1_error)
+          else __PYX_ERR(0, 1377, __pyx_L1_error)
         }
         break;
       }
       __Pyx_GOTREF(__pyx_t_1);
     }
     __Pyx_XDECREF_SET(__pyx_v_bnd, __pyx_t_1);
     __pyx_t_1 = 0;
 
-    /* "soapcw/soapcw.pyx":1321
+    /* "soapcw/soapcw.pyx":1378
  *         #print band_width, length
  *         for bnd in range(band_width):
  *             low = bnd - length             # <<<<<<<<<<<<<<
  *             high = bnd + length + 1
  *             if low < 0:
  */
-    __pyx_t_1 = PyNumber_Subtract(__pyx_v_bnd, __pyx_v_length); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1321, __pyx_L1_error)
+    __pyx_t_1 = PyNumber_Subtract(__pyx_v_bnd, __pyx_v_length); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1378, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_XDECREF_SET(__pyx_v_low, __pyx_t_1);
     __pyx_t_1 = 0;
 
-    /* "soapcw/soapcw.pyx":1322
+    /* "soapcw/soapcw.pyx":1379
  *         for bnd in range(band_width):
  *             low = bnd - length
  *             high = bnd + length + 1             # <<<<<<<<<<<<<<
  *             if low < 0:
  *                 low = 0
  */
-    __pyx_t_1 = PyNumber_Add(__pyx_v_bnd, __pyx_v_length); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1322, __pyx_L1_error)
+    __pyx_t_1 = PyNumber_Add(__pyx_v_bnd, __pyx_v_length); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1379, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_3 = __Pyx_PyInt_AddObjC(__pyx_t_1, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1322, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyInt_AddObjC(__pyx_t_1, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1379, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_XDECREF_SET(__pyx_v_high, __pyx_t_3);
     __pyx_t_3 = 0;
 
-    /* "soapcw/soapcw.pyx":1323
+    /* "soapcw/soapcw.pyx":1380
  *             low = bnd - length
  *             high = bnd + length + 1
  *             if low < 0:             # <<<<<<<<<<<<<<
  *                 low = 0
  *             if high >= band_width:
  */
-    __pyx_t_3 = PyObject_RichCompare(__pyx_v_low, __pyx_int_0, Py_LT); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1323, __pyx_L1_error)
-    __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 1323, __pyx_L1_error)
+    __pyx_t_3 = PyObject_RichCompare(__pyx_v_low, __pyx_int_0, Py_LT); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1380, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 1380, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     if (__pyx_t_7) {
 
-      /* "soapcw/soapcw.pyx":1324
+      /* "soapcw/soapcw.pyx":1381
  *             high = bnd + length + 1
  *             if low < 0:
  *                 low = 0             # <<<<<<<<<<<<<<
  *             if high >= band_width:
  *                 high = band_width
  */
       __Pyx_INCREF(__pyx_int_0);
       __Pyx_DECREF_SET(__pyx_v_low, __pyx_int_0);
 
-      /* "soapcw/soapcw.pyx":1323
+      /* "soapcw/soapcw.pyx":1380
  *             low = bnd - length
  *             high = bnd + length + 1
  *             if low < 0:             # <<<<<<<<<<<<<<
  *                 low = 0
  *             if high >= band_width:
  */
     }
 
-    /* "soapcw/soapcw.pyx":1325
+    /* "soapcw/soapcw.pyx":1382
  *             if low < 0:
  *                 low = 0
  *             if high >= band_width:             # <<<<<<<<<<<<<<
  *                 high = band_width
  *             thres = 0
  */
-    __pyx_t_3 = PyObject_RichCompare(__pyx_v_high, __pyx_v_band_width, Py_GE); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1325, __pyx_L1_error)
-    __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 1325, __pyx_L1_error)
+    __pyx_t_3 = PyObject_RichCompare(__pyx_v_high, __pyx_v_band_width, Py_GE); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1382, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 1382, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     if (__pyx_t_7) {
 
-      /* "soapcw/soapcw.pyx":1326
+      /* "soapcw/soapcw.pyx":1383
  *                 low = 0
  *             if high >= band_width:
  *                 high = band_width             # <<<<<<<<<<<<<<
  *             thres = 0
  *             vend = viterbi.V[-1,low:high]
  */
       __Pyx_INCREF(__pyx_v_band_width);
       __Pyx_DECREF_SET(__pyx_v_high, __pyx_v_band_width);
 
-      /* "soapcw/soapcw.pyx":1325
+      /* "soapcw/soapcw.pyx":1382
  *             if low < 0:
  *                 low = 0
  *             if high >= band_width:             # <<<<<<<<<<<<<<
  *                 high = band_width
  *             thres = 0
  */
     }
 
-    /* "soapcw/soapcw.pyx":1327
+    /* "soapcw/soapcw.pyx":1384
  *             if high >= band_width:
  *                 high = band_width
  *             thres = 0             # <<<<<<<<<<<<<<
  *             vend = viterbi.V[-1,low:high]
  * 
  */
     __Pyx_INCREF(__pyx_int_0);
     __Pyx_XDECREF_SET(__pyx_v_thres, __pyx_int_0);
 
-    /* "soapcw/soapcw.pyx":1328
+    /* "soapcw/soapcw.pyx":1385
  *                 high = band_width
  *             thres = 0
  *             vend = viterbi.V[-1,low:high]             # <<<<<<<<<<<<<<
  * 
  *             val = 0
  */
-    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_viterbi, __pyx_n_s_V); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1328, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_viterbi, __pyx_n_s_V); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1385, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_1 = PySlice_New(__pyx_v_low, __pyx_v_high, Py_None); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1328, __pyx_L1_error)
+    __pyx_t_1 = PySlice_New(__pyx_v_low, __pyx_v_high, Py_None); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1385, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1328, __pyx_L1_error)
+    __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1385, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_INCREF(__pyx_int_neg_1);
     __Pyx_GIVEREF(__pyx_int_neg_1);
     PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_int_neg_1);
     __Pyx_GIVEREF(__pyx_t_1);
     PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_1);
     __pyx_t_1 = 0;
-    __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_t_3, __pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1328, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_t_3, __pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1385, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_XDECREF_SET(__pyx_v_vend, __pyx_t_1);
     __pyx_t_1 = 0;
 
-    /* "soapcw/soapcw.pyx":1330
+    /* "soapcw/soapcw.pyx":1387
  *             vend = viterbi.V[-1,low:high]
  * 
  *             val = 0             # <<<<<<<<<<<<<<
  *             ind = 0
  *             for j in range(len(vend)):
  */
     __Pyx_INCREF(__pyx_int_0);
     __Pyx_XDECREF_SET(__pyx_v_val, __pyx_int_0);
 
-    /* "soapcw/soapcw.pyx":1331
+    /* "soapcw/soapcw.pyx":1388
  * 
  *             val = 0
  *             ind = 0             # <<<<<<<<<<<<<<
  *             for j in range(len(vend)):
  *                 if vend[j] > thres:
  */
     __Pyx_INCREF(__pyx_int_0);
     __Pyx_XDECREF_SET(__pyx_v_ind, __pyx_int_0);
 
-    /* "soapcw/soapcw.pyx":1332
+    /* "soapcw/soapcw.pyx":1389
  *             val = 0
  *             ind = 0
  *             for j in range(len(vend)):             # <<<<<<<<<<<<<<
  *                 if vend[j] > thres:
  *                     val = vend[j]
  */
-    __pyx_t_8 = PyObject_Length(__pyx_v_vend); if (unlikely(__pyx_t_8 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1332, __pyx_L1_error)
-    __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_8); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1332, __pyx_L1_error)
+    __pyx_t_8 = PyObject_Length(__pyx_v_vend); if (unlikely(__pyx_t_8 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1389, __pyx_L1_error)
+    __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_8); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1389, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_builtin_range, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1332, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_builtin_range, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1389, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     if (likely(PyList_CheckExact(__pyx_t_4)) || PyTuple_CheckExact(__pyx_t_4)) {
       __pyx_t_1 = __pyx_t_4; __Pyx_INCREF(__pyx_t_1); __pyx_t_8 = 0;
       __pyx_t_9 = NULL;
     } else {
-      __pyx_t_8 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1332, __pyx_L1_error)
+      __pyx_t_8 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1389, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
-      __pyx_t_9 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1332, __pyx_L1_error)
+      __pyx_t_9 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1389, __pyx_L1_error)
     }
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     for (;;) {
       if (likely(!__pyx_t_9)) {
         if (likely(PyList_CheckExact(__pyx_t_1))) {
           if (__pyx_t_8 >= PyList_GET_SIZE(__pyx_t_1)) break;
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-          __pyx_t_4 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_8); __Pyx_INCREF(__pyx_t_4); __pyx_t_8++; if (unlikely(0 < 0)) __PYX_ERR(0, 1332, __pyx_L1_error)
+          __pyx_t_4 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_8); __Pyx_INCREF(__pyx_t_4); __pyx_t_8++; if (unlikely(0 < 0)) __PYX_ERR(0, 1389, __pyx_L1_error)
           #else
-          __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1332, __pyx_L1_error)
+          __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1389, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_4);
           #endif
         } else {
           if (__pyx_t_8 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-          __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_8); __Pyx_INCREF(__pyx_t_4); __pyx_t_8++; if (unlikely(0 < 0)) __PYX_ERR(0, 1332, __pyx_L1_error)
+          __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_8); __Pyx_INCREF(__pyx_t_4); __pyx_t_8++; if (unlikely(0 < 0)) __PYX_ERR(0, 1389, __pyx_L1_error)
           #else
-          __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1332, __pyx_L1_error)
+          __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1389, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_4);
           #endif
         }
       } else {
         __pyx_t_4 = __pyx_t_9(__pyx_t_1);
         if (unlikely(!__pyx_t_4)) {
           PyObject* exc_type = PyErr_Occurred();
           if (exc_type) {
             if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-            else __PYX_ERR(0, 1332, __pyx_L1_error)
+            else __PYX_ERR(0, 1389, __pyx_L1_error)
           }
           break;
         }
         __Pyx_GOTREF(__pyx_t_4);
       }
       __Pyx_XDECREF_SET(__pyx_v_j, __pyx_t_4);
       __pyx_t_4 = 0;
 
-      /* "soapcw/soapcw.pyx":1333
+      /* "soapcw/soapcw.pyx":1390
  *             ind = 0
  *             for j in range(len(vend)):
  *                 if vend[j] > thres:             # <<<<<<<<<<<<<<
  *                     val = vend[j]
  *                     ind = low + j
  */
-      __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_v_vend, __pyx_v_j); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1333, __pyx_L1_error)
+      __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_v_vend, __pyx_v_j); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1390, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
-      __pyx_t_3 = PyObject_RichCompare(__pyx_t_4, __pyx_v_thres, Py_GT); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1333, __pyx_L1_error)
+      __pyx_t_3 = PyObject_RichCompare(__pyx_t_4, __pyx_v_thres, Py_GT); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1390, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-      __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 1333, __pyx_L1_error)
+      __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 1390, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
       if (__pyx_t_7) {
 
-        /* "soapcw/soapcw.pyx":1334
+        /* "soapcw/soapcw.pyx":1391
  *             for j in range(len(vend)):
  *                 if vend[j] > thres:
  *                     val = vend[j]             # <<<<<<<<<<<<<<
  *                     ind = low + j
  *                     thres = vend[j]
  */
-        __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_v_vend, __pyx_v_j); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1334, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_v_vend, __pyx_v_j); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1391, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
         __Pyx_DECREF_SET(__pyx_v_val, __pyx_t_3);
         __pyx_t_3 = 0;
 
-        /* "soapcw/soapcw.pyx":1335
+        /* "soapcw/soapcw.pyx":1392
  *                 if vend[j] > thres:
  *                     val = vend[j]
  *                     ind = low + j             # <<<<<<<<<<<<<<
  *                     thres = vend[j]
  *             diff_ind = bnd-ind
  */
-        __pyx_t_3 = PyNumber_Add(__pyx_v_low, __pyx_v_j); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1335, __pyx_L1_error)
+        __pyx_t_3 = PyNumber_Add(__pyx_v_low, __pyx_v_j); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1392, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
         __Pyx_DECREF_SET(__pyx_v_ind, __pyx_t_3);
         __pyx_t_3 = 0;
 
-        /* "soapcw/soapcw.pyx":1336
+        /* "soapcw/soapcw.pyx":1393
  *                     val = vend[j]
  *                     ind = low + j
  *                     thres = vend[j]             # <<<<<<<<<<<<<<
  *             diff_ind = bnd-ind
  *             gaptrack = self.max_track(tr,length,diff_ind,bnd,ind,band_width)
  */
-        __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_v_vend, __pyx_v_j); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1336, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_v_vend, __pyx_v_j); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1393, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
         __Pyx_DECREF_SET(__pyx_v_thres, __pyx_t_3);
         __pyx_t_3 = 0;
 
-        /* "soapcw/soapcw.pyx":1333
+        /* "soapcw/soapcw.pyx":1390
  *             ind = 0
  *             for j in range(len(vend)):
  *                 if vend[j] > thres:             # <<<<<<<<<<<<<<
  *                     val = vend[j]
  *                     ind = low + j
  */
       }
 
-      /* "soapcw/soapcw.pyx":1332
+      /* "soapcw/soapcw.pyx":1389
  *             val = 0
  *             ind = 0
  *             for j in range(len(vend)):             # <<<<<<<<<<<<<<
  *                 if vend[j] > thres:
  *                     val = vend[j]
  */
     }
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-    /* "soapcw/soapcw.pyx":1337
+    /* "soapcw/soapcw.pyx":1394
  *                     ind = low + j
  *                     thres = vend[j]
  *             diff_ind = bnd-ind             # <<<<<<<<<<<<<<
  *             gaptrack = self.max_track(tr,length,diff_ind,bnd,ind,band_width)
  *             #print bnd,ind,low,high,diff_ind,length,gaptrack
  */
-    __pyx_t_1 = PyNumber_Subtract(__pyx_v_bnd, __pyx_v_ind); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1337, __pyx_L1_error)
+    __pyx_t_1 = PyNumber_Subtract(__pyx_v_bnd, __pyx_v_ind); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1394, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_XDECREF_SET(__pyx_v_diff_ind, __pyx_t_1);
     __pyx_t_1 = 0;
 
-    /* "soapcw/soapcw.pyx":1338
+    /* "soapcw/soapcw.pyx":1395
  *                     thres = vend[j]
  *             diff_ind = bnd-ind
  *             gaptrack = self.max_track(tr,length,diff_ind,bnd,ind,band_width)             # <<<<<<<<<<<<<<
  *             #print bnd,ind,low,high,diff_ind,length,gaptrack
  * 
  */
-    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_max_track); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1338, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_max_track); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1395, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __pyx_t_4 = NULL;
     __pyx_t_10 = 0;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
       __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
       if (likely(__pyx_t_4)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
@@ -25929,29 +26267,29 @@
         __Pyx_DECREF_SET(__pyx_t_3, function);
         __pyx_t_10 = 1;
       }
     }
     #if CYTHON_FAST_PYCALL
     if (PyFunction_Check(__pyx_t_3)) {
       PyObject *__pyx_temp[7] = {__pyx_t_4, __pyx_v_tr, __pyx_v_length, __pyx_v_diff_ind, __pyx_v_bnd, __pyx_v_ind, __pyx_v_band_width};
-      __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_10, 6+__pyx_t_10); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1338, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_10, 6+__pyx_t_10); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1395, __pyx_L1_error)
       __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
       __Pyx_GOTREF(__pyx_t_1);
     } else
     #endif
     #if CYTHON_FAST_PYCCALL
     if (__Pyx_PyFastCFunction_Check(__pyx_t_3)) {
       PyObject *__pyx_temp[7] = {__pyx_t_4, __pyx_v_tr, __pyx_v_length, __pyx_v_diff_ind, __pyx_v_bnd, __pyx_v_ind, __pyx_v_band_width};
-      __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_10, 6+__pyx_t_10); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1338, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_10, 6+__pyx_t_10); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1395, __pyx_L1_error)
       __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
       __Pyx_GOTREF(__pyx_t_1);
     } else
     #endif
     {
-      __pyx_t_11 = PyTuple_New(6+__pyx_t_10); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1338, __pyx_L1_error)
+      __pyx_t_11 = PyTuple_New(6+__pyx_t_10); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1395, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_11);
       if (__pyx_t_4) {
         __Pyx_GIVEREF(__pyx_t_4); PyTuple_SET_ITEM(__pyx_t_11, 0, __pyx_t_4); __pyx_t_4 = NULL;
       }
       __Pyx_INCREF(__pyx_v_tr);
       __Pyx_GIVEREF(__pyx_v_tr);
       PyTuple_SET_ITEM(__pyx_t_11, 0+__pyx_t_10, __pyx_v_tr);
@@ -25966,107 +26304,107 @@
       PyTuple_SET_ITEM(__pyx_t_11, 3+__pyx_t_10, __pyx_v_bnd);
       __Pyx_INCREF(__pyx_v_ind);
       __Pyx_GIVEREF(__pyx_v_ind);
       PyTuple_SET_ITEM(__pyx_t_11, 4+__pyx_t_10, __pyx_v_ind);
       __Pyx_INCREF(__pyx_v_band_width);
       __Pyx_GIVEREF(__pyx_v_band_width);
       PyTuple_SET_ITEM(__pyx_t_11, 5+__pyx_t_10, __pyx_v_band_width);
-      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_11, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1338, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_11, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1395, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
     }
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_XDECREF_SET(__pyx_v_gaptrack, __pyx_t_1);
     __pyx_t_1 = 0;
 
-    /* "soapcw/soapcw.pyx":1341
+    /* "soapcw/soapcw.pyx":1398
  *             #print bnd,ind,low,high,diff_ind,length,gaptrack
  * 
  *             max_paths[bnd] = np.array(gaptrack[0])             # <<<<<<<<<<<<<<
  *             max_vals[bnd] = gaptrack[1] + val + length*2
  * 
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1341, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1398, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_array); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1341, __pyx_L1_error)
+    __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_array); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1398, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_11);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_gaptrack, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1341, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_gaptrack, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1398, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __pyx_t_4 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_11))) {
       __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_11);
       if (likely(__pyx_t_4)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_11);
         __Pyx_INCREF(__pyx_t_4);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_11, function);
       }
     }
     __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_11, __pyx_t_4, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_11, __pyx_t_3);
     __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1341, __pyx_L1_error)
+    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1398, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
-    if (unlikely(PyObject_SetItem(__pyx_v_max_paths, __pyx_v_bnd, __pyx_t_1) < 0)) __PYX_ERR(0, 1341, __pyx_L1_error)
+    if (unlikely(PyObject_SetItem(__pyx_v_max_paths, __pyx_v_bnd, __pyx_t_1) < 0)) __PYX_ERR(0, 1398, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-    /* "soapcw/soapcw.pyx":1342
+    /* "soapcw/soapcw.pyx":1399
  * 
  *             max_paths[bnd] = np.array(gaptrack[0])
  *             max_vals[bnd] = gaptrack[1] + val + length*2             # <<<<<<<<<<<<<<
  * 
  *         return max_vals, max_paths
  */
-    __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_gaptrack, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1342, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_gaptrack, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1399, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_11 = PyNumber_Add(__pyx_t_1, __pyx_v_val); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1342, __pyx_L1_error)
+    __pyx_t_11 = PyNumber_Add(__pyx_t_1, __pyx_v_val); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1399, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_11);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_1 = PyNumber_Multiply(__pyx_v_length, __pyx_int_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1342, __pyx_L1_error)
+    __pyx_t_1 = PyNumber_Multiply(__pyx_v_length, __pyx_int_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1399, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_3 = PyNumber_Add(__pyx_t_11, __pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1342, __pyx_L1_error)
+    __pyx_t_3 = PyNumber_Add(__pyx_t_11, __pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1399, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    if (unlikely(PyObject_SetItem(__pyx_v_max_vals, __pyx_v_bnd, __pyx_t_3) < 0)) __PYX_ERR(0, 1342, __pyx_L1_error)
+    if (unlikely(PyObject_SetItem(__pyx_v_max_vals, __pyx_v_bnd, __pyx_t_3) < 0)) __PYX_ERR(0, 1399, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-    /* "soapcw/soapcw.pyx":1320
+    /* "soapcw/soapcw.pyx":1377
  *         max_paths = np.zeros((band_width,length))
  *         #print band_width, length
  *         for bnd in range(band_width):             # <<<<<<<<<<<<<<
  *             low = bnd - length
  *             high = bnd + length + 1
  */
   }
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "soapcw/soapcw.pyx":1344
+  /* "soapcw/soapcw.pyx":1401
  *             max_vals[bnd] = gaptrack[1] + val + length*2
  * 
  *         return max_vals, max_paths             # <<<<<<<<<<<<<<
  * 
  *     def find_path(self,prev,end_ind):
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1344, __pyx_L1_error)
+  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1401, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_INCREF(__pyx_v_max_vals);
   __Pyx_GIVEREF(__pyx_v_max_vals);
   PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_max_vals);
   __Pyx_INCREF(__pyx_v_max_paths);
   __Pyx_GIVEREF(__pyx_v_max_paths);
   PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_max_paths);
   __pyx_r = __pyx_t_2;
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
-  /* "soapcw/soapcw.pyx":1315
+  /* "soapcw/soapcw.pyx":1372
  *         return max_seq,s
  * 
  *     def gap_run(self,viterbi, band_width, diff, tsft, tr):             # <<<<<<<<<<<<<<
  *         length = diff - 1
  *         max_vals = np.zeros(band_width)
  */
 
@@ -26094,15 +26432,15 @@
   __Pyx_XDECREF(__pyx_v_diff_ind);
   __Pyx_XDECREF(__pyx_v_gaptrack);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "soapcw/soapcw.pyx":1346
+/* "soapcw/soapcw.pyx":1403
  *         return max_vals, max_paths
  * 
  *     def find_path(self,prev,end_ind):             # <<<<<<<<<<<<<<
  *         length = len(prev)
  *         previous = prev[-1][end_ind]
  */
 
@@ -26140,40 +26478,40 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_prev)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("find_path", 1, 3, 3, 1); __PYX_ERR(0, 1346, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("find_path", 1, 3, 3, 1); __PYX_ERR(0, 1403, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_end_ind)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("find_path", 1, 3, 3, 2); __PYX_ERR(0, 1346, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("find_path", 1, 3, 3, 2); __PYX_ERR(0, 1403, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "find_path") < 0)) __PYX_ERR(0, 1346, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "find_path") < 0)) __PYX_ERR(0, 1403, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
     }
     __pyx_v_self = values[0];
     __pyx_v_prev = values[1];
     __pyx_v_end_ind = values[2];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("find_path", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1346, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("find_path", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1403, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("soapcw.soapcw.single_detector_gaps.find_path", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6soapcw_6soapcw_20single_detector_gaps_6find_path(__pyx_self, __pyx_v_self, __pyx_v_prev, __pyx_v_end_ind);
 
@@ -26197,198 +26535,198 @@
   PyObject *__pyx_t_6 = NULL;
   PyObject *(*__pyx_t_7)(PyObject *);
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("find_path", 0);
 
-  /* "soapcw/soapcw.pyx":1347
+  /* "soapcw/soapcw.pyx":1404
  * 
  *     def find_path(self,prev,end_ind):
  *         length = len(prev)             # <<<<<<<<<<<<<<
  *         previous = prev[-1][end_ind]
  *         vit_track =  np.zeros(length,dtype=np.int32)
  */
-  __pyx_t_1 = PyObject_Length(__pyx_v_prev); if (unlikely(__pyx_t_1 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1347, __pyx_L1_error)
-  __pyx_t_2 = PyInt_FromSsize_t(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1347, __pyx_L1_error)
+  __pyx_t_1 = PyObject_Length(__pyx_v_prev); if (unlikely(__pyx_t_1 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1404, __pyx_L1_error)
+  __pyx_t_2 = PyInt_FromSsize_t(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1404, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_v_length = __pyx_t_2;
   __pyx_t_2 = 0;
 
-  /* "soapcw/soapcw.pyx":1348
+  /* "soapcw/soapcw.pyx":1405
  *     def find_path(self,prev,end_ind):
  *         length = len(prev)
  *         previous = prev[-1][end_ind]             # <<<<<<<<<<<<<<
  *         vit_track =  np.zeros(length,dtype=np.int32)
  *         vit_track[-1] = end_ind
  */
-  __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_prev, -1L, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1348, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_prev, -1L, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1405, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_t_2, __pyx_v_end_ind); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1348, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_t_2, __pyx_v_end_ind); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1405, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_v_previous = __pyx_t_3;
   __pyx_t_3 = 0;
 
-  /* "soapcw/soapcw.pyx":1349
+  /* "soapcw/soapcw.pyx":1406
  *         length = len(prev)
  *         previous = prev[-1][end_ind]
  *         vit_track =  np.zeros(length,dtype=np.int32)             # <<<<<<<<<<<<<<
  *         vit_track[-1] = end_ind
  *         for t in range(length-2,-1,-1):
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1349, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1406, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1349, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1406, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1349, __pyx_L1_error)
+  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1406, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_INCREF(__pyx_v_length);
   __Pyx_GIVEREF(__pyx_v_length);
   PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_length);
-  __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1349, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1406, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1349, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1406, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_int32); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1349, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_int32); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1406, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 1349, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 1406, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, __pyx_t_4); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1349, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, __pyx_t_4); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1406, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_v_vit_track = __pyx_t_6;
   __pyx_t_6 = 0;
 
-  /* "soapcw/soapcw.pyx":1350
+  /* "soapcw/soapcw.pyx":1407
  *         previous = prev[-1][end_ind]
  *         vit_track =  np.zeros(length,dtype=np.int32)
  *         vit_track[-1] = end_ind             # <<<<<<<<<<<<<<
  *         for t in range(length-2,-1,-1):
  *             vit_track[t] = previous # insert previous step
  */
-  if (unlikely(__Pyx_SetItemInt(__pyx_v_vit_track, -1L, __pyx_v_end_ind, long, 1, __Pyx_PyInt_From_long, 0, 1, 1) < 0)) __PYX_ERR(0, 1350, __pyx_L1_error)
+  if (unlikely(__Pyx_SetItemInt(__pyx_v_vit_track, -1L, __pyx_v_end_ind, long, 1, __Pyx_PyInt_From_long, 0, 1, 1) < 0)) __PYX_ERR(0, 1407, __pyx_L1_error)
 
-  /* "soapcw/soapcw.pyx":1351
+  /* "soapcw/soapcw.pyx":1408
  *         vit_track =  np.zeros(length,dtype=np.int32)
  *         vit_track[-1] = end_ind
  *         for t in range(length-2,-1,-1):             # <<<<<<<<<<<<<<
  *             vit_track[t] = previous # insert previous step
  *             previous = prev[t][previous]
  */
-  __pyx_t_6 = __Pyx_PyInt_SubtractObjC(__pyx_v_length, __pyx_int_2, 2, 0, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1351, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyInt_SubtractObjC(__pyx_v_length, __pyx_int_2, 2, 0, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1408, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_4 = PyTuple_New(3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1351, __pyx_L1_error)
+  __pyx_t_4 = PyTuple_New(3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1408, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_6);
   __Pyx_INCREF(__pyx_int_neg_1);
   __Pyx_GIVEREF(__pyx_int_neg_1);
   PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_int_neg_1);
   __Pyx_INCREF(__pyx_int_neg_1);
   __Pyx_GIVEREF(__pyx_int_neg_1);
   PyTuple_SET_ITEM(__pyx_t_4, 2, __pyx_int_neg_1);
   __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_builtin_range, __pyx_t_4, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1351, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_builtin_range, __pyx_t_4, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1408, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   if (likely(PyList_CheckExact(__pyx_t_6)) || PyTuple_CheckExact(__pyx_t_6)) {
     __pyx_t_4 = __pyx_t_6; __Pyx_INCREF(__pyx_t_4); __pyx_t_1 = 0;
     __pyx_t_7 = NULL;
   } else {
-    __pyx_t_1 = -1; __pyx_t_4 = PyObject_GetIter(__pyx_t_6); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1351, __pyx_L1_error)
+    __pyx_t_1 = -1; __pyx_t_4 = PyObject_GetIter(__pyx_t_6); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1408, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_7 = Py_TYPE(__pyx_t_4)->tp_iternext; if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1351, __pyx_L1_error)
+    __pyx_t_7 = Py_TYPE(__pyx_t_4)->tp_iternext; if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1408, __pyx_L1_error)
   }
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   for (;;) {
     if (likely(!__pyx_t_7)) {
       if (likely(PyList_CheckExact(__pyx_t_4))) {
         if (__pyx_t_1 >= PyList_GET_SIZE(__pyx_t_4)) break;
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_6 = PyList_GET_ITEM(__pyx_t_4, __pyx_t_1); __Pyx_INCREF(__pyx_t_6); __pyx_t_1++; if (unlikely(0 < 0)) __PYX_ERR(0, 1351, __pyx_L1_error)
+        __pyx_t_6 = PyList_GET_ITEM(__pyx_t_4, __pyx_t_1); __Pyx_INCREF(__pyx_t_6); __pyx_t_1++; if (unlikely(0 < 0)) __PYX_ERR(0, 1408, __pyx_L1_error)
         #else
-        __pyx_t_6 = PySequence_ITEM(__pyx_t_4, __pyx_t_1); __pyx_t_1++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1351, __pyx_L1_error)
+        __pyx_t_6 = PySequence_ITEM(__pyx_t_4, __pyx_t_1); __pyx_t_1++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1408, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         #endif
       } else {
         if (__pyx_t_1 >= PyTuple_GET_SIZE(__pyx_t_4)) break;
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_6 = PyTuple_GET_ITEM(__pyx_t_4, __pyx_t_1); __Pyx_INCREF(__pyx_t_6); __pyx_t_1++; if (unlikely(0 < 0)) __PYX_ERR(0, 1351, __pyx_L1_error)
+        __pyx_t_6 = PyTuple_GET_ITEM(__pyx_t_4, __pyx_t_1); __Pyx_INCREF(__pyx_t_6); __pyx_t_1++; if (unlikely(0 < 0)) __PYX_ERR(0, 1408, __pyx_L1_error)
         #else
-        __pyx_t_6 = PySequence_ITEM(__pyx_t_4, __pyx_t_1); __pyx_t_1++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1351, __pyx_L1_error)
+        __pyx_t_6 = PySequence_ITEM(__pyx_t_4, __pyx_t_1); __pyx_t_1++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1408, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         #endif
       }
     } else {
       __pyx_t_6 = __pyx_t_7(__pyx_t_4);
       if (unlikely(!__pyx_t_6)) {
         PyObject* exc_type = PyErr_Occurred();
         if (exc_type) {
           if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-          else __PYX_ERR(0, 1351, __pyx_L1_error)
+          else __PYX_ERR(0, 1408, __pyx_L1_error)
         }
         break;
       }
       __Pyx_GOTREF(__pyx_t_6);
     }
     __Pyx_XDECREF_SET(__pyx_v_t, __pyx_t_6);
     __pyx_t_6 = 0;
 
-    /* "soapcw/soapcw.pyx":1352
+    /* "soapcw/soapcw.pyx":1409
  *         vit_track[-1] = end_ind
  *         for t in range(length-2,-1,-1):
  *             vit_track[t] = previous # insert previous step             # <<<<<<<<<<<<<<
  *             previous = prev[t][previous]
  * 
  */
-    if (unlikely(PyObject_SetItem(__pyx_v_vit_track, __pyx_v_t, __pyx_v_previous) < 0)) __PYX_ERR(0, 1352, __pyx_L1_error)
+    if (unlikely(PyObject_SetItem(__pyx_v_vit_track, __pyx_v_t, __pyx_v_previous) < 0)) __PYX_ERR(0, 1409, __pyx_L1_error)
 
-    /* "soapcw/soapcw.pyx":1353
+    /* "soapcw/soapcw.pyx":1410
  *         for t in range(length-2,-1,-1):
  *             vit_track[t] = previous # insert previous step
  *             previous = prev[t][previous]             # <<<<<<<<<<<<<<
  * 
  *         return vit_track
  */
-    __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_v_prev, __pyx_v_t); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1353, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_v_prev, __pyx_v_t); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1410, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
-    __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_t_6, __pyx_v_previous); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1353, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_t_6, __pyx_v_previous); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1410, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_DECREF_SET(__pyx_v_previous, __pyx_t_3);
     __pyx_t_3 = 0;
 
-    /* "soapcw/soapcw.pyx":1351
+    /* "soapcw/soapcw.pyx":1408
  *         vit_track =  np.zeros(length,dtype=np.int32)
  *         vit_track[-1] = end_ind
  *         for t in range(length-2,-1,-1):             # <<<<<<<<<<<<<<
  *             vit_track[t] = previous # insert previous step
  *             previous = prev[t][previous]
  */
   }
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "soapcw/soapcw.pyx":1355
+  /* "soapcw/soapcw.pyx":1412
  *             previous = prev[t][previous]
  * 
  *         return vit_track             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_vit_track);
   __pyx_r = __pyx_v_vit_track;
   goto __pyx_L0;
 
-  /* "soapcw/soapcw.pyx":1346
+  /* "soapcw/soapcw.pyx":1403
  *         return max_vals, max_paths
  * 
  *     def find_path(self,prev,end_ind):             # <<<<<<<<<<<<<<
  *         length = len(prev)
  *         previous = prev[-1][end_ind]
  */
 
@@ -26407,15 +26745,15 @@
   __Pyx_XDECREF(__pyx_v_vit_track);
   __Pyx_XDECREF(__pyx_v_t);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "soapcw/soapcw.pyx":1358
+/* "soapcw/soapcw.pyx":1415
  * 
  * 
  *     def vit_gaps(self,data1,epochs1,tr,tsft):             # <<<<<<<<<<<<<<
  * 
  *         band_width = len(data1[0])
  */
 
@@ -26459,37 +26797,37 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_data1)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("vit_gaps", 1, 5, 5, 1); __PYX_ERR(0, 1358, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("vit_gaps", 1, 5, 5, 1); __PYX_ERR(0, 1415, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_epochs1)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("vit_gaps", 1, 5, 5, 2); __PYX_ERR(0, 1358, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("vit_gaps", 1, 5, 5, 2); __PYX_ERR(0, 1415, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_tr)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("vit_gaps", 1, 5, 5, 3); __PYX_ERR(0, 1358, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("vit_gaps", 1, 5, 5, 3); __PYX_ERR(0, 1415, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (likely((values[4] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_tsft)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("vit_gaps", 1, 5, 5, 4); __PYX_ERR(0, 1358, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("vit_gaps", 1, 5, 5, 4); __PYX_ERR(0, 1415, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "vit_gaps") < 0)) __PYX_ERR(0, 1358, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "vit_gaps") < 0)) __PYX_ERR(0, 1415, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 5) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
@@ -26500,15 +26838,15 @@
     __pyx_v_data1 = values[1];
     __pyx_v_epochs1 = values[2];
     __pyx_v_tr = values[3];
     __pyx_v_tsft = values[4];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("vit_gaps", 1, 5, 5, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1358, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("vit_gaps", 1, 5, 5, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1415, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("soapcw.soapcw.single_detector_gaps.vit_gaps", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6soapcw_6soapcw_20single_detector_gaps_8vit_gaps(__pyx_self, __pyx_v_self, __pyx_v_data1, __pyx_v_epochs1, __pyx_v_tr, __pyx_v_tsft);
 
@@ -26553,653 +26891,653 @@
   int __pyx_t_15;
   PyObject *(*__pyx_t_16)(PyObject *);
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("vit_gaps", 0);
 
-  /* "soapcw/soapcw.pyx":1360
+  /* "soapcw/soapcw.pyx":1417
  *     def vit_gaps(self,data1,epochs1,tr,tsft):
  * 
  *         band_width = len(data1[0])             # <<<<<<<<<<<<<<
  *         vit = []
  *         starts = []
  */
-  __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_data1, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1360, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_data1, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1417, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = PyObject_Length(__pyx_t_1); if (unlikely(__pyx_t_2 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1360, __pyx_L1_error)
+  __pyx_t_2 = PyObject_Length(__pyx_t_1); if (unlikely(__pyx_t_2 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1417, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1360, __pyx_L1_error)
+  __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1417, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_band_width = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "soapcw/soapcw.pyx":1361
+  /* "soapcw/soapcw.pyx":1418
  * 
  *         band_width = len(data1[0])
  *         vit = []             # <<<<<<<<<<<<<<
  *         starts = []
  *         gappaths = []
  */
-  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1361, __pyx_L1_error)
+  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1418, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_vit = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "soapcw/soapcw.pyx":1362
+  /* "soapcw/soapcw.pyx":1419
  *         band_width = len(data1[0])
  *         vit = []
  *         starts = []             # <<<<<<<<<<<<<<
  *         gappaths = []
  *         gapend = 0
  */
-  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1362, __pyx_L1_error)
+  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1419, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_starts = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "soapcw/soapcw.pyx":1363
+  /* "soapcw/soapcw.pyx":1420
  *         vit = []
  *         starts = []
  *         gappaths = []             # <<<<<<<<<<<<<<
  *         gapend = 0
  *         vitstart = epochs1[0]
  */
-  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1363, __pyx_L1_error)
+  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1420, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_gappaths = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "soapcw/soapcw.pyx":1364
+  /* "soapcw/soapcw.pyx":1421
  *         starts = []
  *         gappaths = []
  *         gapend = 0             # <<<<<<<<<<<<<<
  *         vitstart = epochs1[0]
  *         max_vals = None
  */
   __Pyx_INCREF(__pyx_int_0);
   __pyx_v_gapend = __pyx_int_0;
 
-  /* "soapcw/soapcw.pyx":1365
+  /* "soapcw/soapcw.pyx":1422
  *         gappaths = []
  *         gapend = 0
  *         vitstart = epochs1[0]             # <<<<<<<<<<<<<<
  *         max_vals = None
  * 
  */
-  __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_epochs1, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1365, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_epochs1, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1422, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_vitstart = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "soapcw/soapcw.pyx":1366
+  /* "soapcw/soapcw.pyx":1423
  *         gapend = 0
  *         vitstart = epochs1[0]
  *         max_vals = None             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_INCREF(Py_None);
   __pyx_v_max_vals = Py_None;
 
-  /* "soapcw/soapcw.pyx":1369
+  /* "soapcw/soapcw.pyx":1426
  * 
  * 
  *         data = []             # <<<<<<<<<<<<<<
  *         epochs = []
  *         for i,idx in enumerate(epochs1):
  */
-  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1369, __pyx_L1_error)
+  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1426, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_data = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "soapcw/soapcw.pyx":1370
+  /* "soapcw/soapcw.pyx":1427
  * 
  *         data = []
  *         epochs = []             # <<<<<<<<<<<<<<
  *         for i,idx in enumerate(epochs1):
  *             if i == 0 or i == len(epochs1)-1:
  */
-  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1370, __pyx_L1_error)
+  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1427, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_epochs = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "soapcw/soapcw.pyx":1371
+  /* "soapcw/soapcw.pyx":1428
  *         data = []
  *         epochs = []
  *         for i,idx in enumerate(epochs1):             # <<<<<<<<<<<<<<
  *             if i == 0 or i == len(epochs1)-1:
  *                 data.append(data1[i])
  */
   __Pyx_INCREF(__pyx_int_0);
   __pyx_t_1 = __pyx_int_0;
   if (likely(PyList_CheckExact(__pyx_v_epochs1)) || PyTuple_CheckExact(__pyx_v_epochs1)) {
     __pyx_t_3 = __pyx_v_epochs1; __Pyx_INCREF(__pyx_t_3); __pyx_t_2 = 0;
     __pyx_t_4 = NULL;
   } else {
-    __pyx_t_2 = -1; __pyx_t_3 = PyObject_GetIter(__pyx_v_epochs1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1371, __pyx_L1_error)
+    __pyx_t_2 = -1; __pyx_t_3 = PyObject_GetIter(__pyx_v_epochs1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1428, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_4 = Py_TYPE(__pyx_t_3)->tp_iternext; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1371, __pyx_L1_error)
+    __pyx_t_4 = Py_TYPE(__pyx_t_3)->tp_iternext; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1428, __pyx_L1_error)
   }
   for (;;) {
     if (likely(!__pyx_t_4)) {
       if (likely(PyList_CheckExact(__pyx_t_3))) {
         if (__pyx_t_2 >= PyList_GET_SIZE(__pyx_t_3)) break;
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_5 = PyList_GET_ITEM(__pyx_t_3, __pyx_t_2); __Pyx_INCREF(__pyx_t_5); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 1371, __pyx_L1_error)
+        __pyx_t_5 = PyList_GET_ITEM(__pyx_t_3, __pyx_t_2); __Pyx_INCREF(__pyx_t_5); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 1428, __pyx_L1_error)
         #else
-        __pyx_t_5 = PySequence_ITEM(__pyx_t_3, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1371, __pyx_L1_error)
+        __pyx_t_5 = PySequence_ITEM(__pyx_t_3, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1428, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_5);
         #endif
       } else {
         if (__pyx_t_2 >= PyTuple_GET_SIZE(__pyx_t_3)) break;
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_5 = PyTuple_GET_ITEM(__pyx_t_3, __pyx_t_2); __Pyx_INCREF(__pyx_t_5); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 1371, __pyx_L1_error)
+        __pyx_t_5 = PyTuple_GET_ITEM(__pyx_t_3, __pyx_t_2); __Pyx_INCREF(__pyx_t_5); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 1428, __pyx_L1_error)
         #else
-        __pyx_t_5 = PySequence_ITEM(__pyx_t_3, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1371, __pyx_L1_error)
+        __pyx_t_5 = PySequence_ITEM(__pyx_t_3, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1428, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_5);
         #endif
       }
     } else {
       __pyx_t_5 = __pyx_t_4(__pyx_t_3);
       if (unlikely(!__pyx_t_5)) {
         PyObject* exc_type = PyErr_Occurred();
         if (exc_type) {
           if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-          else __PYX_ERR(0, 1371, __pyx_L1_error)
+          else __PYX_ERR(0, 1428, __pyx_L1_error)
         }
         break;
       }
       __Pyx_GOTREF(__pyx_t_5);
     }
     __Pyx_XDECREF_SET(__pyx_v_idx, __pyx_t_5);
     __pyx_t_5 = 0;
     __Pyx_INCREF(__pyx_t_1);
     __Pyx_XDECREF_SET(__pyx_v_i, __pyx_t_1);
-    __pyx_t_5 = __Pyx_PyInt_AddObjC(__pyx_t_1, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1371, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyInt_AddObjC(__pyx_t_1, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1428, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_1);
     __pyx_t_1 = __pyx_t_5;
     __pyx_t_5 = 0;
 
-    /* "soapcw/soapcw.pyx":1372
+    /* "soapcw/soapcw.pyx":1429
  *         epochs = []
  *         for i,idx in enumerate(epochs1):
  *             if i == 0 or i == len(epochs1)-1:             # <<<<<<<<<<<<<<
  *                 data.append(data1[i])
  *                 epochs.append(idx)
  */
-    __pyx_t_5 = __Pyx_PyInt_EqObjC(__pyx_v_i, __pyx_int_0, 0, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1372, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyInt_EqObjC(__pyx_v_i, __pyx_int_0, 0, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1429, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 1372, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 1429, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     if (!__pyx_t_7) {
     } else {
       __pyx_t_6 = __pyx_t_7;
       goto __pyx_L6_bool_binop_done;
     }
-    __pyx_t_8 = PyObject_Length(__pyx_v_epochs1); if (unlikely(__pyx_t_8 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1372, __pyx_L1_error)
-    __pyx_t_5 = PyInt_FromSsize_t((__pyx_t_8 - 1)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1372, __pyx_L1_error)
+    __pyx_t_8 = PyObject_Length(__pyx_v_epochs1); if (unlikely(__pyx_t_8 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1429, __pyx_L1_error)
+    __pyx_t_5 = PyInt_FromSsize_t((__pyx_t_8 - 1)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1429, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_9 = PyObject_RichCompare(__pyx_v_i, __pyx_t_5, Py_EQ); __Pyx_XGOTREF(__pyx_t_9); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1372, __pyx_L1_error)
+    __pyx_t_9 = PyObject_RichCompare(__pyx_v_i, __pyx_t_5, Py_EQ); __Pyx_XGOTREF(__pyx_t_9); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1429, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_9); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 1372, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_9); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 1429, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
     __pyx_t_6 = __pyx_t_7;
     __pyx_L6_bool_binop_done:;
     if (__pyx_t_6) {
 
-      /* "soapcw/soapcw.pyx":1373
+      /* "soapcw/soapcw.pyx":1430
  *         for i,idx in enumerate(epochs1):
  *             if i == 0 or i == len(epochs1)-1:
  *                 data.append(data1[i])             # <<<<<<<<<<<<<<
  *                 epochs.append(idx)
  *             elif i > 0 and i != len(epochs1)-1:
  */
-      __pyx_t_9 = __Pyx_PyObject_GetItem(__pyx_v_data1, __pyx_v_i); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1373, __pyx_L1_error)
+      __pyx_t_9 = __Pyx_PyObject_GetItem(__pyx_v_data1, __pyx_v_i); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1430, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_9);
-      __pyx_t_10 = __Pyx_PyObject_Append(__pyx_v_data, __pyx_t_9); if (unlikely(__pyx_t_10 == ((int)-1))) __PYX_ERR(0, 1373, __pyx_L1_error)
+      __pyx_t_10 = __Pyx_PyObject_Append(__pyx_v_data, __pyx_t_9); if (unlikely(__pyx_t_10 == ((int)-1))) __PYX_ERR(0, 1430, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
 
-      /* "soapcw/soapcw.pyx":1374
+      /* "soapcw/soapcw.pyx":1431
  *             if i == 0 or i == len(epochs1)-1:
  *                 data.append(data1[i])
  *                 epochs.append(idx)             # <<<<<<<<<<<<<<
  *             elif i > 0 and i != len(epochs1)-1:
  *                 diff = epochs1[i]-epochs1[i-1]
  */
-      __pyx_t_10 = __Pyx_PyObject_Append(__pyx_v_epochs, __pyx_v_idx); if (unlikely(__pyx_t_10 == ((int)-1))) __PYX_ERR(0, 1374, __pyx_L1_error)
+      __pyx_t_10 = __Pyx_PyObject_Append(__pyx_v_epochs, __pyx_v_idx); if (unlikely(__pyx_t_10 == ((int)-1))) __PYX_ERR(0, 1431, __pyx_L1_error)
 
-      /* "soapcw/soapcw.pyx":1372
+      /* "soapcw/soapcw.pyx":1429
  *         epochs = []
  *         for i,idx in enumerate(epochs1):
  *             if i == 0 or i == len(epochs1)-1:             # <<<<<<<<<<<<<<
  *                 data.append(data1[i])
  *                 epochs.append(idx)
  */
       goto __pyx_L5;
     }
 
-    /* "soapcw/soapcw.pyx":1375
+    /* "soapcw/soapcw.pyx":1432
  *                 data.append(data1[i])
  *                 epochs.append(idx)
  *             elif i > 0 and i != len(epochs1)-1:             # <<<<<<<<<<<<<<
  *                 diff = epochs1[i]-epochs1[i-1]
  *                 if diff == 2:
  */
-    __pyx_t_9 = PyObject_RichCompare(__pyx_v_i, __pyx_int_0, Py_GT); __Pyx_XGOTREF(__pyx_t_9); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1375, __pyx_L1_error)
-    __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_9); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 1375, __pyx_L1_error)
+    __pyx_t_9 = PyObject_RichCompare(__pyx_v_i, __pyx_int_0, Py_GT); __Pyx_XGOTREF(__pyx_t_9); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1432, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_9); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 1432, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
     if (__pyx_t_7) {
     } else {
       __pyx_t_6 = __pyx_t_7;
       goto __pyx_L8_bool_binop_done;
     }
-    __pyx_t_8 = PyObject_Length(__pyx_v_epochs1); if (unlikely(__pyx_t_8 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1375, __pyx_L1_error)
-    __pyx_t_9 = PyInt_FromSsize_t((__pyx_t_8 - 1)); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1375, __pyx_L1_error)
+    __pyx_t_8 = PyObject_Length(__pyx_v_epochs1); if (unlikely(__pyx_t_8 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1432, __pyx_L1_error)
+    __pyx_t_9 = PyInt_FromSsize_t((__pyx_t_8 - 1)); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1432, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
-    __pyx_t_5 = PyObject_RichCompare(__pyx_v_i, __pyx_t_9, Py_NE); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1375, __pyx_L1_error)
+    __pyx_t_5 = PyObject_RichCompare(__pyx_v_i, __pyx_t_9, Py_NE); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1432, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-    __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 1375, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 1432, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     __pyx_t_6 = __pyx_t_7;
     __pyx_L8_bool_binop_done:;
     if (__pyx_t_6) {
 
-      /* "soapcw/soapcw.pyx":1376
+      /* "soapcw/soapcw.pyx":1433
  *                 epochs.append(idx)
  *             elif i > 0 and i != len(epochs1)-1:
  *                 diff = epochs1[i]-epochs1[i-1]             # <<<<<<<<<<<<<<
  *                 if diff == 2:
  *                     data.append(np.ones(band_width)*2)
  */
-      __pyx_t_5 = __Pyx_PyObject_GetItem(__pyx_v_epochs1, __pyx_v_i); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1376, __pyx_L1_error)
+      __pyx_t_5 = __Pyx_PyObject_GetItem(__pyx_v_epochs1, __pyx_v_i); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1433, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_5);
-      __pyx_t_9 = __Pyx_PyInt_SubtractObjC(__pyx_v_i, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1376, __pyx_L1_error)
+      __pyx_t_9 = __Pyx_PyInt_SubtractObjC(__pyx_v_i, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1433, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_9);
-      __pyx_t_11 = __Pyx_PyObject_GetItem(__pyx_v_epochs1, __pyx_t_9); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1376, __pyx_L1_error)
+      __pyx_t_11 = __Pyx_PyObject_GetItem(__pyx_v_epochs1, __pyx_t_9); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1433, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_11);
       __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-      __pyx_t_9 = PyNumber_Subtract(__pyx_t_5, __pyx_t_11); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1376, __pyx_L1_error)
+      __pyx_t_9 = PyNumber_Subtract(__pyx_t_5, __pyx_t_11); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1433, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_9);
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
       __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
       __Pyx_XDECREF_SET(__pyx_v_diff, __pyx_t_9);
       __pyx_t_9 = 0;
 
-      /* "soapcw/soapcw.pyx":1377
+      /* "soapcw/soapcw.pyx":1434
  *             elif i > 0 and i != len(epochs1)-1:
  *                 diff = epochs1[i]-epochs1[i-1]
  *                 if diff == 2:             # <<<<<<<<<<<<<<
  *                     data.append(np.ones(band_width)*2)
  *                     epochs.append(idx-tsft)
  */
-      __pyx_t_9 = __Pyx_PyInt_EqObjC(__pyx_v_diff, __pyx_int_2, 2, 0); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1377, __pyx_L1_error)
+      __pyx_t_9 = __Pyx_PyInt_EqObjC(__pyx_v_diff, __pyx_int_2, 2, 0); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1434, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_9);
-      __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_9); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 1377, __pyx_L1_error)
+      __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_9); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 1434, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
       if (__pyx_t_6) {
 
-        /* "soapcw/soapcw.pyx":1378
+        /* "soapcw/soapcw.pyx":1435
  *                 diff = epochs1[i]-epochs1[i-1]
  *                 if diff == 2:
  *                     data.append(np.ones(band_width)*2)             # <<<<<<<<<<<<<<
  *                     epochs.append(idx-tsft)
  *                     data.append(data1[i])
  */
-        __Pyx_GetModuleGlobalName(__pyx_t_11, __pyx_n_s_np); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1378, __pyx_L1_error)
+        __Pyx_GetModuleGlobalName(__pyx_t_11, __pyx_n_s_np); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1435, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_11);
-        __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_11, __pyx_n_s_ones); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1378, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_11, __pyx_n_s_ones); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1435, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_5);
         __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
         __pyx_t_11 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
           __pyx_t_11 = PyMethod_GET_SELF(__pyx_t_5);
           if (likely(__pyx_t_11)) {
             PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
             __Pyx_INCREF(__pyx_t_11);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_5, function);
           }
         }
         __pyx_t_9 = (__pyx_t_11) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_11, __pyx_v_band_width) : __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_v_band_width);
         __Pyx_XDECREF(__pyx_t_11); __pyx_t_11 = 0;
-        if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1378, __pyx_L1_error)
+        if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1435, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_9);
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-        __pyx_t_5 = PyNumber_Multiply(__pyx_t_9, __pyx_int_2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1378, __pyx_L1_error)
+        __pyx_t_5 = PyNumber_Multiply(__pyx_t_9, __pyx_int_2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1435, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_5);
         __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-        __pyx_t_10 = __Pyx_PyObject_Append(__pyx_v_data, __pyx_t_5); if (unlikely(__pyx_t_10 == ((int)-1))) __PYX_ERR(0, 1378, __pyx_L1_error)
+        __pyx_t_10 = __Pyx_PyObject_Append(__pyx_v_data, __pyx_t_5); if (unlikely(__pyx_t_10 == ((int)-1))) __PYX_ERR(0, 1435, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-        /* "soapcw/soapcw.pyx":1379
+        /* "soapcw/soapcw.pyx":1436
  *                 if diff == 2:
  *                     data.append(np.ones(band_width)*2)
  *                     epochs.append(idx-tsft)             # <<<<<<<<<<<<<<
  *                     data.append(data1[i])
  *                     epochs.append(idx)
  */
-        __pyx_t_5 = PyNumber_Subtract(__pyx_v_idx, __pyx_v_tsft); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1379, __pyx_L1_error)
+        __pyx_t_5 = PyNumber_Subtract(__pyx_v_idx, __pyx_v_tsft); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1436, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_5);
-        __pyx_t_10 = __Pyx_PyObject_Append(__pyx_v_epochs, __pyx_t_5); if (unlikely(__pyx_t_10 == ((int)-1))) __PYX_ERR(0, 1379, __pyx_L1_error)
+        __pyx_t_10 = __Pyx_PyObject_Append(__pyx_v_epochs, __pyx_t_5); if (unlikely(__pyx_t_10 == ((int)-1))) __PYX_ERR(0, 1436, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-        /* "soapcw/soapcw.pyx":1380
+        /* "soapcw/soapcw.pyx":1437
  *                     data.append(np.ones(band_width)*2)
  *                     epochs.append(idx-tsft)
  *                     data.append(data1[i])             # <<<<<<<<<<<<<<
  *                     epochs.append(idx)
  *                 else:
  */
-        __pyx_t_5 = __Pyx_PyObject_GetItem(__pyx_v_data1, __pyx_v_i); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1380, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyObject_GetItem(__pyx_v_data1, __pyx_v_i); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1437, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_5);
-        __pyx_t_10 = __Pyx_PyObject_Append(__pyx_v_data, __pyx_t_5); if (unlikely(__pyx_t_10 == ((int)-1))) __PYX_ERR(0, 1380, __pyx_L1_error)
+        __pyx_t_10 = __Pyx_PyObject_Append(__pyx_v_data, __pyx_t_5); if (unlikely(__pyx_t_10 == ((int)-1))) __PYX_ERR(0, 1437, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-        /* "soapcw/soapcw.pyx":1381
+        /* "soapcw/soapcw.pyx":1438
  *                     epochs.append(idx-tsft)
  *                     data.append(data1[i])
  *                     epochs.append(idx)             # <<<<<<<<<<<<<<
  *                 else:
  *                     data.append(data1[i])
  */
-        __pyx_t_10 = __Pyx_PyObject_Append(__pyx_v_epochs, __pyx_v_idx); if (unlikely(__pyx_t_10 == ((int)-1))) __PYX_ERR(0, 1381, __pyx_L1_error)
+        __pyx_t_10 = __Pyx_PyObject_Append(__pyx_v_epochs, __pyx_v_idx); if (unlikely(__pyx_t_10 == ((int)-1))) __PYX_ERR(0, 1438, __pyx_L1_error)
 
-        /* "soapcw/soapcw.pyx":1377
+        /* "soapcw/soapcw.pyx":1434
  *             elif i > 0 and i != len(epochs1)-1:
  *                 diff = epochs1[i]-epochs1[i-1]
  *                 if diff == 2:             # <<<<<<<<<<<<<<
  *                     data.append(np.ones(band_width)*2)
  *                     epochs.append(idx-tsft)
  */
         goto __pyx_L10;
       }
 
-      /* "soapcw/soapcw.pyx":1383
+      /* "soapcw/soapcw.pyx":1440
  *                     epochs.append(idx)
  *                 else:
  *                     data.append(data1[i])             # <<<<<<<<<<<<<<
  *                     epochs.append(idx)
  *         data = np.array(data)
  */
       /*else*/ {
-        __pyx_t_5 = __Pyx_PyObject_GetItem(__pyx_v_data1, __pyx_v_i); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1383, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyObject_GetItem(__pyx_v_data1, __pyx_v_i); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1440, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_5);
-        __pyx_t_10 = __Pyx_PyObject_Append(__pyx_v_data, __pyx_t_5); if (unlikely(__pyx_t_10 == ((int)-1))) __PYX_ERR(0, 1383, __pyx_L1_error)
+        __pyx_t_10 = __Pyx_PyObject_Append(__pyx_v_data, __pyx_t_5); if (unlikely(__pyx_t_10 == ((int)-1))) __PYX_ERR(0, 1440, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-        /* "soapcw/soapcw.pyx":1384
+        /* "soapcw/soapcw.pyx":1441
  *                 else:
  *                     data.append(data1[i])
  *                     epochs.append(idx)             # <<<<<<<<<<<<<<
  *         data = np.array(data)
  *         epochs = np.array(epochs)
  */
-        __pyx_t_10 = __Pyx_PyObject_Append(__pyx_v_epochs, __pyx_v_idx); if (unlikely(__pyx_t_10 == ((int)-1))) __PYX_ERR(0, 1384, __pyx_L1_error)
+        __pyx_t_10 = __Pyx_PyObject_Append(__pyx_v_epochs, __pyx_v_idx); if (unlikely(__pyx_t_10 == ((int)-1))) __PYX_ERR(0, 1441, __pyx_L1_error)
       }
       __pyx_L10:;
 
-      /* "soapcw/soapcw.pyx":1375
+      /* "soapcw/soapcw.pyx":1432
  *                 data.append(data1[i])
  *                 epochs.append(idx)
  *             elif i > 0 and i != len(epochs1)-1:             # <<<<<<<<<<<<<<
  *                 diff = epochs1[i]-epochs1[i-1]
  *                 if diff == 2:
  */
     }
     __pyx_L5:;
 
-    /* "soapcw/soapcw.pyx":1371
+    /* "soapcw/soapcw.pyx":1428
  *         data = []
  *         epochs = []
  *         for i,idx in enumerate(epochs1):             # <<<<<<<<<<<<<<
  *             if i == 0 or i == len(epochs1)-1:
  *                 data.append(data1[i])
  */
   }
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "soapcw/soapcw.pyx":1385
+  /* "soapcw/soapcw.pyx":1442
  *                     data.append(data1[i])
  *                     epochs.append(idx)
  *         data = np.array(data)             # <<<<<<<<<<<<<<
  *         epochs = np.array(epochs)
  * 
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1385, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1442, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_array); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1385, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_array); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1442, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_t_3 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
     __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_5);
     if (likely(__pyx_t_3)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
       __Pyx_INCREF(__pyx_t_3);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_5, function);
     }
   }
   __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_3, __pyx_v_data) : __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_v_data);
   __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1385, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1442, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF_SET(__pyx_v_data, __pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "soapcw/soapcw.pyx":1386
+  /* "soapcw/soapcw.pyx":1443
  *                     epochs.append(idx)
  *         data = np.array(data)
  *         epochs = np.array(epochs)             # <<<<<<<<<<<<<<
  * 
  *         for i,idx in enumerate(epochs):
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1386, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1443, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_array); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1386, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_array); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1443, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __pyx_t_5 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
     __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_3);
     if (likely(__pyx_t_5)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
       __Pyx_INCREF(__pyx_t_5);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_3, function);
     }
   }
   __pyx_t_1 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_5, __pyx_v_epochs) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_epochs);
   __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1386, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1443, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF_SET(__pyx_v_epochs, __pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "soapcw/soapcw.pyx":1388
+  /* "soapcw/soapcw.pyx":1445
  *         epochs = np.array(epochs)
  * 
  *         for i,idx in enumerate(epochs):             # <<<<<<<<<<<<<<
  *             if i == 0 :
  *                 pass
  */
   __Pyx_INCREF(__pyx_int_0);
   __pyx_t_1 = __pyx_int_0;
   if (likely(PyList_CheckExact(__pyx_v_epochs)) || PyTuple_CheckExact(__pyx_v_epochs)) {
     __pyx_t_3 = __pyx_v_epochs; __Pyx_INCREF(__pyx_t_3); __pyx_t_2 = 0;
     __pyx_t_4 = NULL;
   } else {
-    __pyx_t_2 = -1; __pyx_t_3 = PyObject_GetIter(__pyx_v_epochs); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1388, __pyx_L1_error)
+    __pyx_t_2 = -1; __pyx_t_3 = PyObject_GetIter(__pyx_v_epochs); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1445, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_4 = Py_TYPE(__pyx_t_3)->tp_iternext; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1388, __pyx_L1_error)
+    __pyx_t_4 = Py_TYPE(__pyx_t_3)->tp_iternext; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1445, __pyx_L1_error)
   }
   for (;;) {
     if (likely(!__pyx_t_4)) {
       if (likely(PyList_CheckExact(__pyx_t_3))) {
         if (__pyx_t_2 >= PyList_GET_SIZE(__pyx_t_3)) break;
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_5 = PyList_GET_ITEM(__pyx_t_3, __pyx_t_2); __Pyx_INCREF(__pyx_t_5); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 1388, __pyx_L1_error)
+        __pyx_t_5 = PyList_GET_ITEM(__pyx_t_3, __pyx_t_2); __Pyx_INCREF(__pyx_t_5); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 1445, __pyx_L1_error)
         #else
-        __pyx_t_5 = PySequence_ITEM(__pyx_t_3, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1388, __pyx_L1_error)
+        __pyx_t_5 = PySequence_ITEM(__pyx_t_3, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1445, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_5);
         #endif
       } else {
         if (__pyx_t_2 >= PyTuple_GET_SIZE(__pyx_t_3)) break;
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_5 = PyTuple_GET_ITEM(__pyx_t_3, __pyx_t_2); __Pyx_INCREF(__pyx_t_5); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 1388, __pyx_L1_error)
+        __pyx_t_5 = PyTuple_GET_ITEM(__pyx_t_3, __pyx_t_2); __Pyx_INCREF(__pyx_t_5); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 1445, __pyx_L1_error)
         #else
-        __pyx_t_5 = PySequence_ITEM(__pyx_t_3, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1388, __pyx_L1_error)
+        __pyx_t_5 = PySequence_ITEM(__pyx_t_3, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1445, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_5);
         #endif
       }
     } else {
       __pyx_t_5 = __pyx_t_4(__pyx_t_3);
       if (unlikely(!__pyx_t_5)) {
         PyObject* exc_type = PyErr_Occurred();
         if (exc_type) {
           if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-          else __PYX_ERR(0, 1388, __pyx_L1_error)
+          else __PYX_ERR(0, 1445, __pyx_L1_error)
         }
         break;
       }
       __Pyx_GOTREF(__pyx_t_5);
     }
     __Pyx_XDECREF_SET(__pyx_v_idx, __pyx_t_5);
     __pyx_t_5 = 0;
     __Pyx_INCREF(__pyx_t_1);
     __Pyx_XDECREF_SET(__pyx_v_i, __pyx_t_1);
-    __pyx_t_5 = __Pyx_PyInt_AddObjC(__pyx_t_1, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1388, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyInt_AddObjC(__pyx_t_1, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1445, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_1);
     __pyx_t_1 = __pyx_t_5;
     __pyx_t_5 = 0;
 
-    /* "soapcw/soapcw.pyx":1389
+    /* "soapcw/soapcw.pyx":1446
  * 
  *         for i,idx in enumerate(epochs):
  *             if i == 0 :             # <<<<<<<<<<<<<<
  *                 pass
  *             elif i > 0:# and i != len(epochs)-1:
  */
-    __pyx_t_5 = __Pyx_PyInt_EqObjC(__pyx_v_i, __pyx_int_0, 0, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1389, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyInt_EqObjC(__pyx_v_i, __pyx_int_0, 0, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1446, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 1389, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 1446, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     if (__pyx_t_6) {
       goto __pyx_L13;
     }
 
-    /* "soapcw/soapcw.pyx":1391
+    /* "soapcw/soapcw.pyx":1448
  *             if i == 0 :
  *                 pass
  *             elif i > 0:# and i != len(epochs)-1:             # <<<<<<<<<<<<<<
  *                 diff = epochs[i]-epochs[i-1]
  *                 diff_ind = int(diff/tsft)
  */
-    __pyx_t_5 = PyObject_RichCompare(__pyx_v_i, __pyx_int_0, Py_GT); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1391, __pyx_L1_error)
-    __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 1391, __pyx_L1_error)
+    __pyx_t_5 = PyObject_RichCompare(__pyx_v_i, __pyx_int_0, Py_GT); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1448, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 1448, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     if (__pyx_t_6) {
 
-      /* "soapcw/soapcw.pyx":1392
+      /* "soapcw/soapcw.pyx":1449
  *                 pass
  *             elif i > 0:# and i != len(epochs)-1:
  *                 diff = epochs[i]-epochs[i-1]             # <<<<<<<<<<<<<<
  *                 diff_ind = int(diff/tsft)
  *                 if diff_ind >= 2 and diff_ind < band_width + 1:
  */
-      __pyx_t_5 = __Pyx_PyObject_GetItem(__pyx_v_epochs, __pyx_v_i); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1392, __pyx_L1_error)
+      __pyx_t_5 = __Pyx_PyObject_GetItem(__pyx_v_epochs, __pyx_v_i); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1449, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_5);
-      __pyx_t_9 = __Pyx_PyInt_SubtractObjC(__pyx_v_i, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1392, __pyx_L1_error)
+      __pyx_t_9 = __Pyx_PyInt_SubtractObjC(__pyx_v_i, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1449, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_9);
-      __pyx_t_11 = __Pyx_PyObject_GetItem(__pyx_v_epochs, __pyx_t_9); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1392, __pyx_L1_error)
+      __pyx_t_11 = __Pyx_PyObject_GetItem(__pyx_v_epochs, __pyx_t_9); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1449, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_11);
       __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-      __pyx_t_9 = PyNumber_Subtract(__pyx_t_5, __pyx_t_11); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1392, __pyx_L1_error)
+      __pyx_t_9 = PyNumber_Subtract(__pyx_t_5, __pyx_t_11); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1449, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_9);
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
       __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
       __Pyx_XDECREF_SET(__pyx_v_diff, __pyx_t_9);
       __pyx_t_9 = 0;
 
-      /* "soapcw/soapcw.pyx":1393
+      /* "soapcw/soapcw.pyx":1450
  *             elif i > 0:# and i != len(epochs)-1:
  *                 diff = epochs[i]-epochs[i-1]
  *                 diff_ind = int(diff/tsft)             # <<<<<<<<<<<<<<
  *                 if diff_ind >= 2 and diff_ind < band_width + 1:
  *                     if max_vals is not None:
  */
-      __pyx_t_9 = __Pyx_PyNumber_Divide(__pyx_v_diff, __pyx_v_tsft); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1393, __pyx_L1_error)
+      __pyx_t_9 = __Pyx_PyNumber_Divide(__pyx_v_diff, __pyx_v_tsft); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1450, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_9);
-      __pyx_t_11 = __Pyx_PyNumber_Int(__pyx_t_9); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1393, __pyx_L1_error)
+      __pyx_t_11 = __Pyx_PyNumber_Int(__pyx_t_9); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1450, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_11);
       __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
       __Pyx_XDECREF_SET(__pyx_v_diff_ind, __pyx_t_11);
       __pyx_t_11 = 0;
 
-      /* "soapcw/soapcw.pyx":1394
+      /* "soapcw/soapcw.pyx":1451
  *                 diff = epochs[i]-epochs[i-1]
  *                 diff_ind = int(diff/tsft)
  *                 if diff_ind >= 2 and diff_ind < band_width + 1:             # <<<<<<<<<<<<<<
  *                     if max_vals is not None:
  *                         viterbi = single_detector(tr, np.vstack([max_vals,data[gapend:i]]))
  */
-      __pyx_t_11 = PyObject_RichCompare(__pyx_v_diff_ind, __pyx_int_2, Py_GE); __Pyx_XGOTREF(__pyx_t_11); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1394, __pyx_L1_error)
-      __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_11); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 1394, __pyx_L1_error)
+      __pyx_t_11 = PyObject_RichCompare(__pyx_v_diff_ind, __pyx_int_2, Py_GE); __Pyx_XGOTREF(__pyx_t_11); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1451, __pyx_L1_error)
+      __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_11); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 1451, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
       if (__pyx_t_7) {
       } else {
         __pyx_t_6 = __pyx_t_7;
         goto __pyx_L15_bool_binop_done;
       }
-      __pyx_t_11 = __Pyx_PyInt_AddObjC(__pyx_v_band_width, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1394, __pyx_L1_error)
+      __pyx_t_11 = __Pyx_PyInt_AddObjC(__pyx_v_band_width, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1451, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_11);
-      __pyx_t_9 = PyObject_RichCompare(__pyx_v_diff_ind, __pyx_t_11, Py_LT); __Pyx_XGOTREF(__pyx_t_9); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1394, __pyx_L1_error)
+      __pyx_t_9 = PyObject_RichCompare(__pyx_v_diff_ind, __pyx_t_11, Py_LT); __Pyx_XGOTREF(__pyx_t_9); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1451, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
-      __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_9); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 1394, __pyx_L1_error)
+      __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_9); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 1451, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
       __pyx_t_6 = __pyx_t_7;
       __pyx_L15_bool_binop_done:;
       if (__pyx_t_6) {
 
-        /* "soapcw/soapcw.pyx":1395
+        /* "soapcw/soapcw.pyx":1452
  *                 diff_ind = int(diff/tsft)
  *                 if diff_ind >= 2 and diff_ind < band_width + 1:
  *                     if max_vals is not None:             # <<<<<<<<<<<<<<
  *                         viterbi = single_detector(tr, np.vstack([max_vals,data[gapend:i]]))
  *                         starts.append(np.arange(len(viterbi.vit_track))*tsft + vitstart - tsft)
  */
         __pyx_t_6 = (__pyx_v_max_vals != Py_None);
         __pyx_t_7 = (__pyx_t_6 != 0);
         if (__pyx_t_7) {
 
-          /* "soapcw/soapcw.pyx":1396
+          /* "soapcw/soapcw.pyx":1453
  *                 if diff_ind >= 2 and diff_ind < band_width + 1:
  *                     if max_vals is not None:
  *                         viterbi = single_detector(tr, np.vstack([max_vals,data[gapend:i]]))             # <<<<<<<<<<<<<<
  *                         starts.append(np.arange(len(viterbi.vit_track))*tsft + vitstart - tsft)
  *                         vitstart = idx
  */
-          __Pyx_GetModuleGlobalName(__pyx_t_11, __pyx_n_s_single_detector); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1396, __pyx_L1_error)
+          __Pyx_GetModuleGlobalName(__pyx_t_11, __pyx_n_s_single_detector); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1453, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_11);
-          __Pyx_GetModuleGlobalName(__pyx_t_12, __pyx_n_s_np); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 1396, __pyx_L1_error)
+          __Pyx_GetModuleGlobalName(__pyx_t_12, __pyx_n_s_np); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 1453, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_12);
-          __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_12, __pyx_n_s_vstack); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 1396, __pyx_L1_error)
+          __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_12, __pyx_n_s_vstack); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 1453, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_13);
           __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
-          __pyx_t_12 = __Pyx_PyObject_GetSlice(__pyx_v_data, 0, 0, &__pyx_v_gapend, &__pyx_v_i, NULL, 0, 0, 1); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 1396, __pyx_L1_error)
+          __pyx_t_12 = __Pyx_PyObject_GetSlice(__pyx_v_data, 0, 0, &__pyx_v_gapend, &__pyx_v_i, NULL, 0, 0, 1); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 1453, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_12);
-          __pyx_t_14 = PyList_New(2); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 1396, __pyx_L1_error)
+          __pyx_t_14 = PyList_New(2); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 1453, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_14);
           __Pyx_INCREF(__pyx_v_max_vals);
           __Pyx_GIVEREF(__pyx_v_max_vals);
           PyList_SET_ITEM(__pyx_t_14, 0, __pyx_v_max_vals);
           __Pyx_GIVEREF(__pyx_t_12);
           PyList_SET_ITEM(__pyx_t_14, 1, __pyx_t_12);
           __pyx_t_12 = 0;
@@ -27212,15 +27550,15 @@
               __Pyx_INCREF(function);
               __Pyx_DECREF_SET(__pyx_t_13, function);
             }
           }
           __pyx_t_5 = (__pyx_t_12) ? __Pyx_PyObject_Call2Args(__pyx_t_13, __pyx_t_12, __pyx_t_14) : __Pyx_PyObject_CallOneArg(__pyx_t_13, __pyx_t_14);
           __Pyx_XDECREF(__pyx_t_12); __pyx_t_12 = 0;
           __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
-          if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1396, __pyx_L1_error)
+          if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1453, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_5);
           __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
           __pyx_t_13 = NULL;
           __pyx_t_15 = 0;
           if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_11))) {
             __pyx_t_13 = PyMethod_GET_SELF(__pyx_t_11);
             if (likely(__pyx_t_13)) {
@@ -27230,126 +27568,126 @@
               __Pyx_DECREF_SET(__pyx_t_11, function);
               __pyx_t_15 = 1;
             }
           }
           #if CYTHON_FAST_PYCALL
           if (PyFunction_Check(__pyx_t_11)) {
             PyObject *__pyx_temp[3] = {__pyx_t_13, __pyx_v_tr, __pyx_t_5};
-            __pyx_t_9 = __Pyx_PyFunction_FastCall(__pyx_t_11, __pyx_temp+1-__pyx_t_15, 2+__pyx_t_15); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1396, __pyx_L1_error)
+            __pyx_t_9 = __Pyx_PyFunction_FastCall(__pyx_t_11, __pyx_temp+1-__pyx_t_15, 2+__pyx_t_15); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1453, __pyx_L1_error)
             __Pyx_XDECREF(__pyx_t_13); __pyx_t_13 = 0;
             __Pyx_GOTREF(__pyx_t_9);
             __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
           } else
           #endif
           #if CYTHON_FAST_PYCCALL
           if (__Pyx_PyFastCFunction_Check(__pyx_t_11)) {
             PyObject *__pyx_temp[3] = {__pyx_t_13, __pyx_v_tr, __pyx_t_5};
-            __pyx_t_9 = __Pyx_PyCFunction_FastCall(__pyx_t_11, __pyx_temp+1-__pyx_t_15, 2+__pyx_t_15); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1396, __pyx_L1_error)
+            __pyx_t_9 = __Pyx_PyCFunction_FastCall(__pyx_t_11, __pyx_temp+1-__pyx_t_15, 2+__pyx_t_15); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1453, __pyx_L1_error)
             __Pyx_XDECREF(__pyx_t_13); __pyx_t_13 = 0;
             __Pyx_GOTREF(__pyx_t_9);
             __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
           } else
           #endif
           {
-            __pyx_t_14 = PyTuple_New(2+__pyx_t_15); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 1396, __pyx_L1_error)
+            __pyx_t_14 = PyTuple_New(2+__pyx_t_15); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 1453, __pyx_L1_error)
             __Pyx_GOTREF(__pyx_t_14);
             if (__pyx_t_13) {
               __Pyx_GIVEREF(__pyx_t_13); PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_t_13); __pyx_t_13 = NULL;
             }
             __Pyx_INCREF(__pyx_v_tr);
             __Pyx_GIVEREF(__pyx_v_tr);
             PyTuple_SET_ITEM(__pyx_t_14, 0+__pyx_t_15, __pyx_v_tr);
             __Pyx_GIVEREF(__pyx_t_5);
             PyTuple_SET_ITEM(__pyx_t_14, 1+__pyx_t_15, __pyx_t_5);
             __pyx_t_5 = 0;
-            __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_11, __pyx_t_14, NULL); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1396, __pyx_L1_error)
+            __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_11, __pyx_t_14, NULL); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1453, __pyx_L1_error)
             __Pyx_GOTREF(__pyx_t_9);
             __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
           }
           __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
           __Pyx_XDECREF_SET(__pyx_v_viterbi, __pyx_t_9);
           __pyx_t_9 = 0;
 
-          /* "soapcw/soapcw.pyx":1397
+          /* "soapcw/soapcw.pyx":1454
  *                     if max_vals is not None:
  *                         viterbi = single_detector(tr, np.vstack([max_vals,data[gapend:i]]))
  *                         starts.append(np.arange(len(viterbi.vit_track))*tsft + vitstart - tsft)             # <<<<<<<<<<<<<<
  *                         vitstart = idx
  *                     else:
  */
-          __Pyx_GetModuleGlobalName(__pyx_t_11, __pyx_n_s_np); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1397, __pyx_L1_error)
+          __Pyx_GetModuleGlobalName(__pyx_t_11, __pyx_n_s_np); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1454, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_11);
-          __pyx_t_14 = __Pyx_PyObject_GetAttrStr(__pyx_t_11, __pyx_n_s_arange); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 1397, __pyx_L1_error)
+          __pyx_t_14 = __Pyx_PyObject_GetAttrStr(__pyx_t_11, __pyx_n_s_arange); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 1454, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_14);
           __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
-          __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_v_viterbi, __pyx_n_s_vit_track); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1397, __pyx_L1_error)
+          __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_v_viterbi, __pyx_n_s_vit_track); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1454, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_11);
-          __pyx_t_8 = PyObject_Length(__pyx_t_11); if (unlikely(__pyx_t_8 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1397, __pyx_L1_error)
+          __pyx_t_8 = PyObject_Length(__pyx_t_11); if (unlikely(__pyx_t_8 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1454, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
-          __pyx_t_11 = PyInt_FromSsize_t(__pyx_t_8); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1397, __pyx_L1_error)
+          __pyx_t_11 = PyInt_FromSsize_t(__pyx_t_8); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1454, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_11);
           __pyx_t_5 = NULL;
           if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_14))) {
             __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_14);
             if (likely(__pyx_t_5)) {
               PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_14);
               __Pyx_INCREF(__pyx_t_5);
               __Pyx_INCREF(function);
               __Pyx_DECREF_SET(__pyx_t_14, function);
             }
           }
           __pyx_t_9 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_14, __pyx_t_5, __pyx_t_11) : __Pyx_PyObject_CallOneArg(__pyx_t_14, __pyx_t_11);
           __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
           __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
-          if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1397, __pyx_L1_error)
+          if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1454, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_9);
           __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
-          __pyx_t_14 = PyNumber_Multiply(__pyx_t_9, __pyx_v_tsft); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 1397, __pyx_L1_error)
+          __pyx_t_14 = PyNumber_Multiply(__pyx_t_9, __pyx_v_tsft); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 1454, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_14);
           __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-          __pyx_t_9 = PyNumber_Add(__pyx_t_14, __pyx_v_vitstart); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1397, __pyx_L1_error)
+          __pyx_t_9 = PyNumber_Add(__pyx_t_14, __pyx_v_vitstart); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1454, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_9);
           __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
-          __pyx_t_14 = PyNumber_Subtract(__pyx_t_9, __pyx_v_tsft); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 1397, __pyx_L1_error)
+          __pyx_t_14 = PyNumber_Subtract(__pyx_t_9, __pyx_v_tsft); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 1454, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_14);
           __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-          __pyx_t_10 = __Pyx_PyList_Append(__pyx_v_starts, __pyx_t_14); if (unlikely(__pyx_t_10 == ((int)-1))) __PYX_ERR(0, 1397, __pyx_L1_error)
+          __pyx_t_10 = __Pyx_PyList_Append(__pyx_v_starts, __pyx_t_14); if (unlikely(__pyx_t_10 == ((int)-1))) __PYX_ERR(0, 1454, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
 
-          /* "soapcw/soapcw.pyx":1398
+          /* "soapcw/soapcw.pyx":1455
  *                         viterbi = single_detector(tr, np.vstack([max_vals,data[gapend:i]]))
  *                         starts.append(np.arange(len(viterbi.vit_track))*tsft + vitstart - tsft)
  *                         vitstart = idx             # <<<<<<<<<<<<<<
  *                     else:
  *                         viterbi = single_detector(tr, data[gapend:i])
  */
           __Pyx_INCREF(__pyx_v_idx);
           __Pyx_DECREF_SET(__pyx_v_vitstart, __pyx_v_idx);
 
-          /* "soapcw/soapcw.pyx":1395
+          /* "soapcw/soapcw.pyx":1452
  *                 diff_ind = int(diff/tsft)
  *                 if diff_ind >= 2 and diff_ind < band_width + 1:
  *                     if max_vals is not None:             # <<<<<<<<<<<<<<
  *                         viterbi = single_detector(tr, np.vstack([max_vals,data[gapend:i]]))
  *                         starts.append(np.arange(len(viterbi.vit_track))*tsft + vitstart - tsft)
  */
           goto __pyx_L17;
         }
 
-        /* "soapcw/soapcw.pyx":1400
+        /* "soapcw/soapcw.pyx":1457
  *                         vitstart = idx
  *                     else:
  *                         viterbi = single_detector(tr, data[gapend:i])             # <<<<<<<<<<<<<<
  *                         starts.append(np.arange(len(viterbi.vit_track))*tsft + vitstart)
  *                         vitstart = idx
  */
         /*else*/ {
-          __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_single_detector); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1400, __pyx_L1_error)
+          __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_single_detector); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1457, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_9);
-          __pyx_t_11 = __Pyx_PyObject_GetSlice(__pyx_v_data, 0, 0, &__pyx_v_gapend, &__pyx_v_i, NULL, 0, 0, 1); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1400, __pyx_L1_error)
+          __pyx_t_11 = __Pyx_PyObject_GetSlice(__pyx_v_data, 0, 0, &__pyx_v_gapend, &__pyx_v_i, NULL, 0, 0, 1); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1457, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_11);
           __pyx_t_5 = NULL;
           __pyx_t_15 = 0;
           if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_9))) {
             __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_9);
             if (likely(__pyx_t_5)) {
               PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_9);
@@ -27358,131 +27696,131 @@
               __Pyx_DECREF_SET(__pyx_t_9, function);
               __pyx_t_15 = 1;
             }
           }
           #if CYTHON_FAST_PYCALL
           if (PyFunction_Check(__pyx_t_9)) {
             PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_v_tr, __pyx_t_11};
-            __pyx_t_14 = __Pyx_PyFunction_FastCall(__pyx_t_9, __pyx_temp+1-__pyx_t_15, 2+__pyx_t_15); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 1400, __pyx_L1_error)
+            __pyx_t_14 = __Pyx_PyFunction_FastCall(__pyx_t_9, __pyx_temp+1-__pyx_t_15, 2+__pyx_t_15); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 1457, __pyx_L1_error)
             __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
             __Pyx_GOTREF(__pyx_t_14);
             __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
           } else
           #endif
           #if CYTHON_FAST_PYCCALL
           if (__Pyx_PyFastCFunction_Check(__pyx_t_9)) {
             PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_v_tr, __pyx_t_11};
-            __pyx_t_14 = __Pyx_PyCFunction_FastCall(__pyx_t_9, __pyx_temp+1-__pyx_t_15, 2+__pyx_t_15); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 1400, __pyx_L1_error)
+            __pyx_t_14 = __Pyx_PyCFunction_FastCall(__pyx_t_9, __pyx_temp+1-__pyx_t_15, 2+__pyx_t_15); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 1457, __pyx_L1_error)
             __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
             __Pyx_GOTREF(__pyx_t_14);
             __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
           } else
           #endif
           {
-            __pyx_t_13 = PyTuple_New(2+__pyx_t_15); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 1400, __pyx_L1_error)
+            __pyx_t_13 = PyTuple_New(2+__pyx_t_15); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 1457, __pyx_L1_error)
             __Pyx_GOTREF(__pyx_t_13);
             if (__pyx_t_5) {
               __Pyx_GIVEREF(__pyx_t_5); PyTuple_SET_ITEM(__pyx_t_13, 0, __pyx_t_5); __pyx_t_5 = NULL;
             }
             __Pyx_INCREF(__pyx_v_tr);
             __Pyx_GIVEREF(__pyx_v_tr);
             PyTuple_SET_ITEM(__pyx_t_13, 0+__pyx_t_15, __pyx_v_tr);
             __Pyx_GIVEREF(__pyx_t_11);
             PyTuple_SET_ITEM(__pyx_t_13, 1+__pyx_t_15, __pyx_t_11);
             __pyx_t_11 = 0;
-            __pyx_t_14 = __Pyx_PyObject_Call(__pyx_t_9, __pyx_t_13, NULL); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 1400, __pyx_L1_error)
+            __pyx_t_14 = __Pyx_PyObject_Call(__pyx_t_9, __pyx_t_13, NULL); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 1457, __pyx_L1_error)
             __Pyx_GOTREF(__pyx_t_14);
             __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
           }
           __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
           __Pyx_XDECREF_SET(__pyx_v_viterbi, __pyx_t_14);
           __pyx_t_14 = 0;
 
-          /* "soapcw/soapcw.pyx":1401
+          /* "soapcw/soapcw.pyx":1458
  *                     else:
  *                         viterbi = single_detector(tr, data[gapend:i])
  *                         starts.append(np.arange(len(viterbi.vit_track))*tsft + vitstart)             # <<<<<<<<<<<<<<
  *                         vitstart = idx
  * 
  */
-          __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_np); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1401, __pyx_L1_error)
+          __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_np); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1458, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_9);
-          __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_arange); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 1401, __pyx_L1_error)
+          __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_arange); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 1458, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_13);
           __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-          __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_v_viterbi, __pyx_n_s_vit_track); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1401, __pyx_L1_error)
+          __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_v_viterbi, __pyx_n_s_vit_track); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1458, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_9);
-          __pyx_t_8 = PyObject_Length(__pyx_t_9); if (unlikely(__pyx_t_8 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1401, __pyx_L1_error)
+          __pyx_t_8 = PyObject_Length(__pyx_t_9); if (unlikely(__pyx_t_8 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1458, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-          __pyx_t_9 = PyInt_FromSsize_t(__pyx_t_8); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1401, __pyx_L1_error)
+          __pyx_t_9 = PyInt_FromSsize_t(__pyx_t_8); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1458, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_9);
           __pyx_t_11 = NULL;
           if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_13))) {
             __pyx_t_11 = PyMethod_GET_SELF(__pyx_t_13);
             if (likely(__pyx_t_11)) {
               PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_13);
               __Pyx_INCREF(__pyx_t_11);
               __Pyx_INCREF(function);
               __Pyx_DECREF_SET(__pyx_t_13, function);
             }
           }
           __pyx_t_14 = (__pyx_t_11) ? __Pyx_PyObject_Call2Args(__pyx_t_13, __pyx_t_11, __pyx_t_9) : __Pyx_PyObject_CallOneArg(__pyx_t_13, __pyx_t_9);
           __Pyx_XDECREF(__pyx_t_11); __pyx_t_11 = 0;
           __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-          if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 1401, __pyx_L1_error)
+          if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 1458, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_14);
           __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-          __pyx_t_13 = PyNumber_Multiply(__pyx_t_14, __pyx_v_tsft); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 1401, __pyx_L1_error)
+          __pyx_t_13 = PyNumber_Multiply(__pyx_t_14, __pyx_v_tsft); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 1458, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_13);
           __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
-          __pyx_t_14 = PyNumber_Add(__pyx_t_13, __pyx_v_vitstart); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 1401, __pyx_L1_error)
+          __pyx_t_14 = PyNumber_Add(__pyx_t_13, __pyx_v_vitstart); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 1458, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_14);
           __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-          __pyx_t_10 = __Pyx_PyList_Append(__pyx_v_starts, __pyx_t_14); if (unlikely(__pyx_t_10 == ((int)-1))) __PYX_ERR(0, 1401, __pyx_L1_error)
+          __pyx_t_10 = __Pyx_PyList_Append(__pyx_v_starts, __pyx_t_14); if (unlikely(__pyx_t_10 == ((int)-1))) __PYX_ERR(0, 1458, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
 
-          /* "soapcw/soapcw.pyx":1402
+          /* "soapcw/soapcw.pyx":1459
  *                         viterbi = single_detector(tr, data[gapend:i])
  *                         starts.append(np.arange(len(viterbi.vit_track))*tsft + vitstart)
  *                         vitstart = idx             # <<<<<<<<<<<<<<
  * 
  *                     vit.append(viterbi)
  */
           __Pyx_INCREF(__pyx_v_idx);
           __Pyx_DECREF_SET(__pyx_v_vitstart, __pyx_v_idx);
         }
         __pyx_L17:;
 
-        /* "soapcw/soapcw.pyx":1404
+        /* "soapcw/soapcw.pyx":1461
  *                         vitstart = idx
  * 
  *                     vit.append(viterbi)             # <<<<<<<<<<<<<<
  *                     gapend = i
  *                     max_vals, max_paths = self.gap_run(viterbi, band_width, diff_ind, tsft, tr)
  */
-        __pyx_t_10 = __Pyx_PyList_Append(__pyx_v_vit, __pyx_v_viterbi); if (unlikely(__pyx_t_10 == ((int)-1))) __PYX_ERR(0, 1404, __pyx_L1_error)
+        __pyx_t_10 = __Pyx_PyList_Append(__pyx_v_vit, __pyx_v_viterbi); if (unlikely(__pyx_t_10 == ((int)-1))) __PYX_ERR(0, 1461, __pyx_L1_error)
 
-        /* "soapcw/soapcw.pyx":1405
+        /* "soapcw/soapcw.pyx":1462
  * 
  *                     vit.append(viterbi)
  *                     gapend = i             # <<<<<<<<<<<<<<
  *                     max_vals, max_paths = self.gap_run(viterbi, band_width, diff_ind, tsft, tr)
  *                     #print max_vals, max_paths
  */
         __Pyx_INCREF(__pyx_v_i);
         __Pyx_DECREF_SET(__pyx_v_gapend, __pyx_v_i);
 
-        /* "soapcw/soapcw.pyx":1406
+        /* "soapcw/soapcw.pyx":1463
  *                     vit.append(viterbi)
  *                     gapend = i
  *                     max_vals, max_paths = self.gap_run(viterbi, band_width, diff_ind, tsft, tr)             # <<<<<<<<<<<<<<
  *                     #print max_vals, max_paths
  *                     gappaths.append(max_paths)
  */
-        __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_gap_run); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 1406, __pyx_L1_error)
+        __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_gap_run); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 1463, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_13);
         __pyx_t_9 = NULL;
         __pyx_t_15 = 0;
         if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_13))) {
           __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_13);
           if (likely(__pyx_t_9)) {
             PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_13);
@@ -27491,29 +27829,29 @@
             __Pyx_DECREF_SET(__pyx_t_13, function);
             __pyx_t_15 = 1;
           }
         }
         #if CYTHON_FAST_PYCALL
         if (PyFunction_Check(__pyx_t_13)) {
           PyObject *__pyx_temp[6] = {__pyx_t_9, __pyx_v_viterbi, __pyx_v_band_width, __pyx_v_diff_ind, __pyx_v_tsft, __pyx_v_tr};
-          __pyx_t_14 = __Pyx_PyFunction_FastCall(__pyx_t_13, __pyx_temp+1-__pyx_t_15, 5+__pyx_t_15); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 1406, __pyx_L1_error)
+          __pyx_t_14 = __Pyx_PyFunction_FastCall(__pyx_t_13, __pyx_temp+1-__pyx_t_15, 5+__pyx_t_15); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 1463, __pyx_L1_error)
           __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
           __Pyx_GOTREF(__pyx_t_14);
         } else
         #endif
         #if CYTHON_FAST_PYCCALL
         if (__Pyx_PyFastCFunction_Check(__pyx_t_13)) {
           PyObject *__pyx_temp[6] = {__pyx_t_9, __pyx_v_viterbi, __pyx_v_band_width, __pyx_v_diff_ind, __pyx_v_tsft, __pyx_v_tr};
-          __pyx_t_14 = __Pyx_PyCFunction_FastCall(__pyx_t_13, __pyx_temp+1-__pyx_t_15, 5+__pyx_t_15); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 1406, __pyx_L1_error)
+          __pyx_t_14 = __Pyx_PyCFunction_FastCall(__pyx_t_13, __pyx_temp+1-__pyx_t_15, 5+__pyx_t_15); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 1463, __pyx_L1_error)
           __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
           __Pyx_GOTREF(__pyx_t_14);
         } else
         #endif
         {
-          __pyx_t_11 = PyTuple_New(5+__pyx_t_15); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1406, __pyx_L1_error)
+          __pyx_t_11 = PyTuple_New(5+__pyx_t_15); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1463, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_11);
           if (__pyx_t_9) {
             __Pyx_GIVEREF(__pyx_t_9); PyTuple_SET_ITEM(__pyx_t_11, 0, __pyx_t_9); __pyx_t_9 = NULL;
           }
           __Pyx_INCREF(__pyx_v_viterbi);
           __Pyx_GIVEREF(__pyx_v_viterbi);
           PyTuple_SET_ITEM(__pyx_t_11, 0+__pyx_t_15, __pyx_v_viterbi);
@@ -27525,112 +27863,112 @@
           PyTuple_SET_ITEM(__pyx_t_11, 2+__pyx_t_15, __pyx_v_diff_ind);
           __Pyx_INCREF(__pyx_v_tsft);
           __Pyx_GIVEREF(__pyx_v_tsft);
           PyTuple_SET_ITEM(__pyx_t_11, 3+__pyx_t_15, __pyx_v_tsft);
           __Pyx_INCREF(__pyx_v_tr);
           __Pyx_GIVEREF(__pyx_v_tr);
           PyTuple_SET_ITEM(__pyx_t_11, 4+__pyx_t_15, __pyx_v_tr);
-          __pyx_t_14 = __Pyx_PyObject_Call(__pyx_t_13, __pyx_t_11, NULL); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 1406, __pyx_L1_error)
+          __pyx_t_14 = __Pyx_PyObject_Call(__pyx_t_13, __pyx_t_11, NULL); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 1463, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_14);
           __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
         }
         __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
         if ((likely(PyTuple_CheckExact(__pyx_t_14))) || (PyList_CheckExact(__pyx_t_14))) {
           PyObject* sequence = __pyx_t_14;
           Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
           if (unlikely(size != 2)) {
             if (size > 2) __Pyx_RaiseTooManyValuesError(2);
             else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
-            __PYX_ERR(0, 1406, __pyx_L1_error)
+            __PYX_ERR(0, 1463, __pyx_L1_error)
           }
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
           if (likely(PyTuple_CheckExact(sequence))) {
             __pyx_t_13 = PyTuple_GET_ITEM(sequence, 0); 
             __pyx_t_11 = PyTuple_GET_ITEM(sequence, 1); 
           } else {
             __pyx_t_13 = PyList_GET_ITEM(sequence, 0); 
             __pyx_t_11 = PyList_GET_ITEM(sequence, 1); 
           }
           __Pyx_INCREF(__pyx_t_13);
           __Pyx_INCREF(__pyx_t_11);
           #else
-          __pyx_t_13 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 1406, __pyx_L1_error)
+          __pyx_t_13 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 1463, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_13);
-          __pyx_t_11 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1406, __pyx_L1_error)
+          __pyx_t_11 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1463, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_11);
           #endif
           __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
         } else {
           Py_ssize_t index = -1;
-          __pyx_t_9 = PyObject_GetIter(__pyx_t_14); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1406, __pyx_L1_error)
+          __pyx_t_9 = PyObject_GetIter(__pyx_t_14); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1463, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_9);
           __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
           __pyx_t_16 = Py_TYPE(__pyx_t_9)->tp_iternext;
           index = 0; __pyx_t_13 = __pyx_t_16(__pyx_t_9); if (unlikely(!__pyx_t_13)) goto __pyx_L18_unpacking_failed;
           __Pyx_GOTREF(__pyx_t_13);
           index = 1; __pyx_t_11 = __pyx_t_16(__pyx_t_9); if (unlikely(!__pyx_t_11)) goto __pyx_L18_unpacking_failed;
           __Pyx_GOTREF(__pyx_t_11);
-          if (__Pyx_IternextUnpackEndCheck(__pyx_t_16(__pyx_t_9), 2) < 0) __PYX_ERR(0, 1406, __pyx_L1_error)
+          if (__Pyx_IternextUnpackEndCheck(__pyx_t_16(__pyx_t_9), 2) < 0) __PYX_ERR(0, 1463, __pyx_L1_error)
           __pyx_t_16 = NULL;
           __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
           goto __pyx_L19_unpacking_done;
           __pyx_L18_unpacking_failed:;
           __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
           __pyx_t_16 = NULL;
           if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
-          __PYX_ERR(0, 1406, __pyx_L1_error)
+          __PYX_ERR(0, 1463, __pyx_L1_error)
           __pyx_L19_unpacking_done:;
         }
         __Pyx_DECREF_SET(__pyx_v_max_vals, __pyx_t_13);
         __pyx_t_13 = 0;
         __Pyx_XDECREF_SET(__pyx_v_max_paths, __pyx_t_11);
         __pyx_t_11 = 0;
 
-        /* "soapcw/soapcw.pyx":1408
+        /* "soapcw/soapcw.pyx":1465
  *                     max_vals, max_paths = self.gap_run(viterbi, band_width, diff_ind, tsft, tr)
  *                     #print max_vals, max_paths
  *                     gappaths.append(max_paths)             # <<<<<<<<<<<<<<
  *                     if i == len(epochs)-1:
  *                         viterbi = single_detector(tr, np.vstack([max_vals,data[gapend:]]))
  */
-        __pyx_t_10 = __Pyx_PyList_Append(__pyx_v_gappaths, __pyx_v_max_paths); if (unlikely(__pyx_t_10 == ((int)-1))) __PYX_ERR(0, 1408, __pyx_L1_error)
+        __pyx_t_10 = __Pyx_PyList_Append(__pyx_v_gappaths, __pyx_v_max_paths); if (unlikely(__pyx_t_10 == ((int)-1))) __PYX_ERR(0, 1465, __pyx_L1_error)
 
-        /* "soapcw/soapcw.pyx":1409
+        /* "soapcw/soapcw.pyx":1466
  *                     #print max_vals, max_paths
  *                     gappaths.append(max_paths)
  *                     if i == len(epochs)-1:             # <<<<<<<<<<<<<<
  *                         viterbi = single_detector(tr, np.vstack([max_vals,data[gapend:]]))
  *                         starts.append(np.arange(len(viterbi.vit_track))*tsft + idx - tsft)
  */
-        __pyx_t_8 = PyObject_Length(__pyx_v_epochs); if (unlikely(__pyx_t_8 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1409, __pyx_L1_error)
-        __pyx_t_14 = PyInt_FromSsize_t((__pyx_t_8 - 1)); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 1409, __pyx_L1_error)
+        __pyx_t_8 = PyObject_Length(__pyx_v_epochs); if (unlikely(__pyx_t_8 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1466, __pyx_L1_error)
+        __pyx_t_14 = PyInt_FromSsize_t((__pyx_t_8 - 1)); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 1466, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_14);
-        __pyx_t_11 = PyObject_RichCompare(__pyx_v_i, __pyx_t_14, Py_EQ); __Pyx_XGOTREF(__pyx_t_11); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1409, __pyx_L1_error)
+        __pyx_t_11 = PyObject_RichCompare(__pyx_v_i, __pyx_t_14, Py_EQ); __Pyx_XGOTREF(__pyx_t_11); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1466, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
-        __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_11); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 1409, __pyx_L1_error)
+        __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_11); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 1466, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
         if (__pyx_t_7) {
 
-          /* "soapcw/soapcw.pyx":1410
+          /* "soapcw/soapcw.pyx":1467
  *                     gappaths.append(max_paths)
  *                     if i == len(epochs)-1:
  *                         viterbi = single_detector(tr, np.vstack([max_vals,data[gapend:]]))             # <<<<<<<<<<<<<<
  *                         starts.append(np.arange(len(viterbi.vit_track))*tsft + idx - tsft)
  *                         vit.append(viterbi)
  */
-          __Pyx_GetModuleGlobalName(__pyx_t_14, __pyx_n_s_single_detector); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 1410, __pyx_L1_error)
+          __Pyx_GetModuleGlobalName(__pyx_t_14, __pyx_n_s_single_detector); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 1467, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_14);
-          __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_np); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1410, __pyx_L1_error)
+          __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_np); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1467, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_9);
-          __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_vstack); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1410, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_vstack); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1467, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_5);
           __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-          __pyx_t_9 = __Pyx_PyObject_GetSlice(__pyx_v_data, 0, 0, &__pyx_v_gapend, NULL, NULL, 0, 0, 1); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1410, __pyx_L1_error)
+          __pyx_t_9 = __Pyx_PyObject_GetSlice(__pyx_v_data, 0, 0, &__pyx_v_gapend, NULL, NULL, 0, 0, 1); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1467, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_9);
-          __pyx_t_12 = PyList_New(2); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 1410, __pyx_L1_error)
+          __pyx_t_12 = PyList_New(2); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 1467, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_12);
           __Pyx_INCREF(__pyx_v_max_vals);
           __Pyx_GIVEREF(__pyx_v_max_vals);
           PyList_SET_ITEM(__pyx_t_12, 0, __pyx_v_max_vals);
           __Pyx_GIVEREF(__pyx_t_9);
           PyList_SET_ITEM(__pyx_t_12, 1, __pyx_t_9);
           __pyx_t_9 = 0;
@@ -27643,15 +27981,15 @@
               __Pyx_INCREF(function);
               __Pyx_DECREF_SET(__pyx_t_5, function);
             }
           }
           __pyx_t_13 = (__pyx_t_9) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_9, __pyx_t_12) : __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_12);
           __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
           __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
-          if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 1410, __pyx_L1_error)
+          if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 1467, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_13);
           __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
           __pyx_t_5 = NULL;
           __pyx_t_15 = 0;
           if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_14))) {
             __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_14);
             if (likely(__pyx_t_5)) {
@@ -27661,178 +27999,178 @@
               __Pyx_DECREF_SET(__pyx_t_14, function);
               __pyx_t_15 = 1;
             }
           }
           #if CYTHON_FAST_PYCALL
           if (PyFunction_Check(__pyx_t_14)) {
             PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_v_tr, __pyx_t_13};
-            __pyx_t_11 = __Pyx_PyFunction_FastCall(__pyx_t_14, __pyx_temp+1-__pyx_t_15, 2+__pyx_t_15); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1410, __pyx_L1_error)
+            __pyx_t_11 = __Pyx_PyFunction_FastCall(__pyx_t_14, __pyx_temp+1-__pyx_t_15, 2+__pyx_t_15); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1467, __pyx_L1_error)
             __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
             __Pyx_GOTREF(__pyx_t_11);
             __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
           } else
           #endif
           #if CYTHON_FAST_PYCCALL
           if (__Pyx_PyFastCFunction_Check(__pyx_t_14)) {
             PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_v_tr, __pyx_t_13};
-            __pyx_t_11 = __Pyx_PyCFunction_FastCall(__pyx_t_14, __pyx_temp+1-__pyx_t_15, 2+__pyx_t_15); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1410, __pyx_L1_error)
+            __pyx_t_11 = __Pyx_PyCFunction_FastCall(__pyx_t_14, __pyx_temp+1-__pyx_t_15, 2+__pyx_t_15); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1467, __pyx_L1_error)
             __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
             __Pyx_GOTREF(__pyx_t_11);
             __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
           } else
           #endif
           {
-            __pyx_t_12 = PyTuple_New(2+__pyx_t_15); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 1410, __pyx_L1_error)
+            __pyx_t_12 = PyTuple_New(2+__pyx_t_15); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 1467, __pyx_L1_error)
             __Pyx_GOTREF(__pyx_t_12);
             if (__pyx_t_5) {
               __Pyx_GIVEREF(__pyx_t_5); PyTuple_SET_ITEM(__pyx_t_12, 0, __pyx_t_5); __pyx_t_5 = NULL;
             }
             __Pyx_INCREF(__pyx_v_tr);
             __Pyx_GIVEREF(__pyx_v_tr);
             PyTuple_SET_ITEM(__pyx_t_12, 0+__pyx_t_15, __pyx_v_tr);
             __Pyx_GIVEREF(__pyx_t_13);
             PyTuple_SET_ITEM(__pyx_t_12, 1+__pyx_t_15, __pyx_t_13);
             __pyx_t_13 = 0;
-            __pyx_t_11 = __Pyx_PyObject_Call(__pyx_t_14, __pyx_t_12, NULL); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1410, __pyx_L1_error)
+            __pyx_t_11 = __Pyx_PyObject_Call(__pyx_t_14, __pyx_t_12, NULL); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1467, __pyx_L1_error)
             __Pyx_GOTREF(__pyx_t_11);
             __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
           }
           __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
           __Pyx_DECREF_SET(__pyx_v_viterbi, __pyx_t_11);
           __pyx_t_11 = 0;
 
-          /* "soapcw/soapcw.pyx":1411
+          /* "soapcw/soapcw.pyx":1468
  *                     if i == len(epochs)-1:
  *                         viterbi = single_detector(tr, np.vstack([max_vals,data[gapend:]]))
  *                         starts.append(np.arange(len(viterbi.vit_track))*tsft + idx - tsft)             # <<<<<<<<<<<<<<
  *                         vit.append(viterbi)
  * 
  */
-          __Pyx_GetModuleGlobalName(__pyx_t_14, __pyx_n_s_np); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 1411, __pyx_L1_error)
+          __Pyx_GetModuleGlobalName(__pyx_t_14, __pyx_n_s_np); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 1468, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_14);
-          __pyx_t_12 = __Pyx_PyObject_GetAttrStr(__pyx_t_14, __pyx_n_s_arange); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 1411, __pyx_L1_error)
+          __pyx_t_12 = __Pyx_PyObject_GetAttrStr(__pyx_t_14, __pyx_n_s_arange); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 1468, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_12);
           __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
-          __pyx_t_14 = __Pyx_PyObject_GetAttrStr(__pyx_v_viterbi, __pyx_n_s_vit_track); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 1411, __pyx_L1_error)
+          __pyx_t_14 = __Pyx_PyObject_GetAttrStr(__pyx_v_viterbi, __pyx_n_s_vit_track); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 1468, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_14);
-          __pyx_t_8 = PyObject_Length(__pyx_t_14); if (unlikely(__pyx_t_8 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1411, __pyx_L1_error)
+          __pyx_t_8 = PyObject_Length(__pyx_t_14); if (unlikely(__pyx_t_8 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1468, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
-          __pyx_t_14 = PyInt_FromSsize_t(__pyx_t_8); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 1411, __pyx_L1_error)
+          __pyx_t_14 = PyInt_FromSsize_t(__pyx_t_8); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 1468, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_14);
           __pyx_t_13 = NULL;
           if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_12))) {
             __pyx_t_13 = PyMethod_GET_SELF(__pyx_t_12);
             if (likely(__pyx_t_13)) {
               PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_12);
               __Pyx_INCREF(__pyx_t_13);
               __Pyx_INCREF(function);
               __Pyx_DECREF_SET(__pyx_t_12, function);
             }
           }
           __pyx_t_11 = (__pyx_t_13) ? __Pyx_PyObject_Call2Args(__pyx_t_12, __pyx_t_13, __pyx_t_14) : __Pyx_PyObject_CallOneArg(__pyx_t_12, __pyx_t_14);
           __Pyx_XDECREF(__pyx_t_13); __pyx_t_13 = 0;
           __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
-          if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1411, __pyx_L1_error)
+          if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1468, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_11);
           __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
-          __pyx_t_12 = PyNumber_Multiply(__pyx_t_11, __pyx_v_tsft); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 1411, __pyx_L1_error)
+          __pyx_t_12 = PyNumber_Multiply(__pyx_t_11, __pyx_v_tsft); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 1468, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_12);
           __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
-          __pyx_t_11 = PyNumber_Add(__pyx_t_12, __pyx_v_idx); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1411, __pyx_L1_error)
+          __pyx_t_11 = PyNumber_Add(__pyx_t_12, __pyx_v_idx); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1468, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_11);
           __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
-          __pyx_t_12 = PyNumber_Subtract(__pyx_t_11, __pyx_v_tsft); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 1411, __pyx_L1_error)
+          __pyx_t_12 = PyNumber_Subtract(__pyx_t_11, __pyx_v_tsft); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 1468, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_12);
           __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
-          __pyx_t_10 = __Pyx_PyList_Append(__pyx_v_starts, __pyx_t_12); if (unlikely(__pyx_t_10 == ((int)-1))) __PYX_ERR(0, 1411, __pyx_L1_error)
+          __pyx_t_10 = __Pyx_PyList_Append(__pyx_v_starts, __pyx_t_12); if (unlikely(__pyx_t_10 == ((int)-1))) __PYX_ERR(0, 1468, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
 
-          /* "soapcw/soapcw.pyx":1412
+          /* "soapcw/soapcw.pyx":1469
  *                         viterbi = single_detector(tr, np.vstack([max_vals,data[gapend:]]))
  *                         starts.append(np.arange(len(viterbi.vit_track))*tsft + idx - tsft)
  *                         vit.append(viterbi)             # <<<<<<<<<<<<<<
  * 
  *                 elif diff_ind >= band_width + 1:
  */
-          __pyx_t_10 = __Pyx_PyList_Append(__pyx_v_vit, __pyx_v_viterbi); if (unlikely(__pyx_t_10 == ((int)-1))) __PYX_ERR(0, 1412, __pyx_L1_error)
+          __pyx_t_10 = __Pyx_PyList_Append(__pyx_v_vit, __pyx_v_viterbi); if (unlikely(__pyx_t_10 == ((int)-1))) __PYX_ERR(0, 1469, __pyx_L1_error)
 
-          /* "soapcw/soapcw.pyx":1409
+          /* "soapcw/soapcw.pyx":1466
  *                     #print max_vals, max_paths
  *                     gappaths.append(max_paths)
  *                     if i == len(epochs)-1:             # <<<<<<<<<<<<<<
  *                         viterbi = single_detector(tr, np.vstack([max_vals,data[gapend:]]))
  *                         starts.append(np.arange(len(viterbi.vit_track))*tsft + idx - tsft)
  */
         }
 
-        /* "soapcw/soapcw.pyx":1394
+        /* "soapcw/soapcw.pyx":1451
  *                 diff = epochs[i]-epochs[i-1]
  *                 diff_ind = int(diff/tsft)
  *                 if diff_ind >= 2 and diff_ind < band_width + 1:             # <<<<<<<<<<<<<<
  *                     if max_vals is not None:
  *                         viterbi = single_detector(tr, np.vstack([max_vals,data[gapend:i]]))
  */
         goto __pyx_L14;
       }
 
-      /* "soapcw/soapcw.pyx":1414
+      /* "soapcw/soapcw.pyx":1471
  *                         vit.append(viterbi)
  * 
  *                 elif diff_ind >= band_width + 1:             # <<<<<<<<<<<<<<
  * 
  *                     diff1 = band_width + 1
  */
-      __pyx_t_12 = __Pyx_PyInt_AddObjC(__pyx_v_band_width, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 1414, __pyx_L1_error)
+      __pyx_t_12 = __Pyx_PyInt_AddObjC(__pyx_v_band_width, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 1471, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_12);
-      __pyx_t_11 = PyObject_RichCompare(__pyx_v_diff_ind, __pyx_t_12, Py_GE); __Pyx_XGOTREF(__pyx_t_11); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1414, __pyx_L1_error)
+      __pyx_t_11 = PyObject_RichCompare(__pyx_v_diff_ind, __pyx_t_12, Py_GE); __Pyx_XGOTREF(__pyx_t_11); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1471, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
-      __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_11); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 1414, __pyx_L1_error)
+      __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_11); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 1471, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
       if (__pyx_t_7) {
 
-        /* "soapcw/soapcw.pyx":1416
+        /* "soapcw/soapcw.pyx":1473
  *                 elif diff_ind >= band_width + 1:
  * 
  *                     diff1 = band_width + 1             # <<<<<<<<<<<<<<
  *                     if max_vals is not None:
  *                         viterbi = single_detector(tr, np.vstack([max_vals,data[gapend:i]]))
  */
-        __pyx_t_11 = __Pyx_PyInt_AddObjC(__pyx_v_band_width, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1416, __pyx_L1_error)
+        __pyx_t_11 = __Pyx_PyInt_AddObjC(__pyx_v_band_width, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1473, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_11);
         __Pyx_XDECREF_SET(__pyx_v_diff1, __pyx_t_11);
         __pyx_t_11 = 0;
 
-        /* "soapcw/soapcw.pyx":1417
+        /* "soapcw/soapcw.pyx":1474
  * 
  *                     diff1 = band_width + 1
  *                     if max_vals is not None:             # <<<<<<<<<<<<<<
  *                         viterbi = single_detector(tr, np.vstack([max_vals,data[gapend:i]]))
  *                         starts.append(np.arange(len(viterbi.vit_track))*tsft + vitstart - tsft)
  */
         __pyx_t_7 = (__pyx_v_max_vals != Py_None);
         __pyx_t_6 = (__pyx_t_7 != 0);
         if (__pyx_t_6) {
 
-          /* "soapcw/soapcw.pyx":1418
+          /* "soapcw/soapcw.pyx":1475
  *                     diff1 = band_width + 1
  *                     if max_vals is not None:
  *                         viterbi = single_detector(tr, np.vstack([max_vals,data[gapend:i]]))             # <<<<<<<<<<<<<<
  *                         starts.append(np.arange(len(viterbi.vit_track))*tsft + vitstart - tsft)
  *                         vitstart = idx
  */
-          __Pyx_GetModuleGlobalName(__pyx_t_12, __pyx_n_s_single_detector); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 1418, __pyx_L1_error)
+          __Pyx_GetModuleGlobalName(__pyx_t_12, __pyx_n_s_single_detector); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 1475, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_12);
-          __Pyx_GetModuleGlobalName(__pyx_t_13, __pyx_n_s_np); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 1418, __pyx_L1_error)
+          __Pyx_GetModuleGlobalName(__pyx_t_13, __pyx_n_s_np); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 1475, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_13);
-          __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_13, __pyx_n_s_vstack); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1418, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_13, __pyx_n_s_vstack); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1475, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_5);
           __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-          __pyx_t_13 = __Pyx_PyObject_GetSlice(__pyx_v_data, 0, 0, &__pyx_v_gapend, &__pyx_v_i, NULL, 0, 0, 1); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 1418, __pyx_L1_error)
+          __pyx_t_13 = __Pyx_PyObject_GetSlice(__pyx_v_data, 0, 0, &__pyx_v_gapend, &__pyx_v_i, NULL, 0, 0, 1); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 1475, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_13);
-          __pyx_t_9 = PyList_New(2); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1418, __pyx_L1_error)
+          __pyx_t_9 = PyList_New(2); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1475, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_9);
           __Pyx_INCREF(__pyx_v_max_vals);
           __Pyx_GIVEREF(__pyx_v_max_vals);
           PyList_SET_ITEM(__pyx_t_9, 0, __pyx_v_max_vals);
           __Pyx_GIVEREF(__pyx_t_13);
           PyList_SET_ITEM(__pyx_t_9, 1, __pyx_t_13);
           __pyx_t_13 = 0;
@@ -27845,15 +28183,15 @@
               __Pyx_INCREF(function);
               __Pyx_DECREF_SET(__pyx_t_5, function);
             }
           }
           __pyx_t_14 = (__pyx_t_13) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_13, __pyx_t_9) : __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_9);
           __Pyx_XDECREF(__pyx_t_13); __pyx_t_13 = 0;
           __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-          if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 1418, __pyx_L1_error)
+          if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 1475, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_14);
           __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
           __pyx_t_5 = NULL;
           __pyx_t_15 = 0;
           if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_12))) {
             __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_12);
             if (likely(__pyx_t_5)) {
@@ -27863,126 +28201,126 @@
               __Pyx_DECREF_SET(__pyx_t_12, function);
               __pyx_t_15 = 1;
             }
           }
           #if CYTHON_FAST_PYCALL
           if (PyFunction_Check(__pyx_t_12)) {
             PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_v_tr, __pyx_t_14};
-            __pyx_t_11 = __Pyx_PyFunction_FastCall(__pyx_t_12, __pyx_temp+1-__pyx_t_15, 2+__pyx_t_15); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1418, __pyx_L1_error)
+            __pyx_t_11 = __Pyx_PyFunction_FastCall(__pyx_t_12, __pyx_temp+1-__pyx_t_15, 2+__pyx_t_15); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1475, __pyx_L1_error)
             __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
             __Pyx_GOTREF(__pyx_t_11);
             __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
           } else
           #endif
           #if CYTHON_FAST_PYCCALL
           if (__Pyx_PyFastCFunction_Check(__pyx_t_12)) {
             PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_v_tr, __pyx_t_14};
-            __pyx_t_11 = __Pyx_PyCFunction_FastCall(__pyx_t_12, __pyx_temp+1-__pyx_t_15, 2+__pyx_t_15); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1418, __pyx_L1_error)
+            __pyx_t_11 = __Pyx_PyCFunction_FastCall(__pyx_t_12, __pyx_temp+1-__pyx_t_15, 2+__pyx_t_15); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1475, __pyx_L1_error)
             __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
             __Pyx_GOTREF(__pyx_t_11);
             __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
           } else
           #endif
           {
-            __pyx_t_9 = PyTuple_New(2+__pyx_t_15); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1418, __pyx_L1_error)
+            __pyx_t_9 = PyTuple_New(2+__pyx_t_15); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1475, __pyx_L1_error)
             __Pyx_GOTREF(__pyx_t_9);
             if (__pyx_t_5) {
               __Pyx_GIVEREF(__pyx_t_5); PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_t_5); __pyx_t_5 = NULL;
             }
             __Pyx_INCREF(__pyx_v_tr);
             __Pyx_GIVEREF(__pyx_v_tr);
             PyTuple_SET_ITEM(__pyx_t_9, 0+__pyx_t_15, __pyx_v_tr);
             __Pyx_GIVEREF(__pyx_t_14);
             PyTuple_SET_ITEM(__pyx_t_9, 1+__pyx_t_15, __pyx_t_14);
             __pyx_t_14 = 0;
-            __pyx_t_11 = __Pyx_PyObject_Call(__pyx_t_12, __pyx_t_9, NULL); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1418, __pyx_L1_error)
+            __pyx_t_11 = __Pyx_PyObject_Call(__pyx_t_12, __pyx_t_9, NULL); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1475, __pyx_L1_error)
             __Pyx_GOTREF(__pyx_t_11);
             __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
           }
           __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
           __Pyx_XDECREF_SET(__pyx_v_viterbi, __pyx_t_11);
           __pyx_t_11 = 0;
 
-          /* "soapcw/soapcw.pyx":1419
+          /* "soapcw/soapcw.pyx":1476
  *                     if max_vals is not None:
  *                         viterbi = single_detector(tr, np.vstack([max_vals,data[gapend:i]]))
  *                         starts.append(np.arange(len(viterbi.vit_track))*tsft + vitstart - tsft)             # <<<<<<<<<<<<<<
  *                         vitstart = idx
  *                     else:
  */
-          __Pyx_GetModuleGlobalName(__pyx_t_12, __pyx_n_s_np); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 1419, __pyx_L1_error)
+          __Pyx_GetModuleGlobalName(__pyx_t_12, __pyx_n_s_np); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 1476, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_12);
-          __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_12, __pyx_n_s_arange); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1419, __pyx_L1_error)
+          __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_12, __pyx_n_s_arange); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1476, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_9);
           __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
-          __pyx_t_12 = __Pyx_PyObject_GetAttrStr(__pyx_v_viterbi, __pyx_n_s_vit_track); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 1419, __pyx_L1_error)
+          __pyx_t_12 = __Pyx_PyObject_GetAttrStr(__pyx_v_viterbi, __pyx_n_s_vit_track); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 1476, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_12);
-          __pyx_t_8 = PyObject_Length(__pyx_t_12); if (unlikely(__pyx_t_8 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1419, __pyx_L1_error)
+          __pyx_t_8 = PyObject_Length(__pyx_t_12); if (unlikely(__pyx_t_8 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1476, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
-          __pyx_t_12 = PyInt_FromSsize_t(__pyx_t_8); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 1419, __pyx_L1_error)
+          __pyx_t_12 = PyInt_FromSsize_t(__pyx_t_8); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 1476, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_12);
           __pyx_t_14 = NULL;
           if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_9))) {
             __pyx_t_14 = PyMethod_GET_SELF(__pyx_t_9);
             if (likely(__pyx_t_14)) {
               PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_9);
               __Pyx_INCREF(__pyx_t_14);
               __Pyx_INCREF(function);
               __Pyx_DECREF_SET(__pyx_t_9, function);
             }
           }
           __pyx_t_11 = (__pyx_t_14) ? __Pyx_PyObject_Call2Args(__pyx_t_9, __pyx_t_14, __pyx_t_12) : __Pyx_PyObject_CallOneArg(__pyx_t_9, __pyx_t_12);
           __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
           __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
-          if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1419, __pyx_L1_error)
+          if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1476, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_11);
           __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-          __pyx_t_9 = PyNumber_Multiply(__pyx_t_11, __pyx_v_tsft); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1419, __pyx_L1_error)
+          __pyx_t_9 = PyNumber_Multiply(__pyx_t_11, __pyx_v_tsft); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1476, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_9);
           __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
-          __pyx_t_11 = PyNumber_Add(__pyx_t_9, __pyx_v_vitstart); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1419, __pyx_L1_error)
+          __pyx_t_11 = PyNumber_Add(__pyx_t_9, __pyx_v_vitstart); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1476, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_11);
           __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-          __pyx_t_9 = PyNumber_Subtract(__pyx_t_11, __pyx_v_tsft); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1419, __pyx_L1_error)
+          __pyx_t_9 = PyNumber_Subtract(__pyx_t_11, __pyx_v_tsft); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1476, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_9);
           __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
-          __pyx_t_10 = __Pyx_PyList_Append(__pyx_v_starts, __pyx_t_9); if (unlikely(__pyx_t_10 == ((int)-1))) __PYX_ERR(0, 1419, __pyx_L1_error)
+          __pyx_t_10 = __Pyx_PyList_Append(__pyx_v_starts, __pyx_t_9); if (unlikely(__pyx_t_10 == ((int)-1))) __PYX_ERR(0, 1476, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
 
-          /* "soapcw/soapcw.pyx":1420
+          /* "soapcw/soapcw.pyx":1477
  *                         viterbi = single_detector(tr, np.vstack([max_vals,data[gapend:i]]))
  *                         starts.append(np.arange(len(viterbi.vit_track))*tsft + vitstart - tsft)
  *                         vitstart = idx             # <<<<<<<<<<<<<<
  *                     else:
  *                         viterbi = single_detector(tr, data[gapend:i])
  */
           __Pyx_INCREF(__pyx_v_idx);
           __Pyx_DECREF_SET(__pyx_v_vitstart, __pyx_v_idx);
 
-          /* "soapcw/soapcw.pyx":1417
+          /* "soapcw/soapcw.pyx":1474
  * 
  *                     diff1 = band_width + 1
  *                     if max_vals is not None:             # <<<<<<<<<<<<<<
  *                         viterbi = single_detector(tr, np.vstack([max_vals,data[gapend:i]]))
  *                         starts.append(np.arange(len(viterbi.vit_track))*tsft + vitstart - tsft)
  */
           goto __pyx_L21;
         }
 
-        /* "soapcw/soapcw.pyx":1422
+        /* "soapcw/soapcw.pyx":1479
  *                         vitstart = idx
  *                     else:
  *                         viterbi = single_detector(tr, data[gapend:i])             # <<<<<<<<<<<<<<
  *                         starts.append(np.arange(len(viterbi.vit_track))*tsft + vitstart)
  *                         vitstart = idx
  */
         /*else*/ {
-          __Pyx_GetModuleGlobalName(__pyx_t_11, __pyx_n_s_single_detector); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1422, __pyx_L1_error)
+          __Pyx_GetModuleGlobalName(__pyx_t_11, __pyx_n_s_single_detector); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1479, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_11);
-          __pyx_t_12 = __Pyx_PyObject_GetSlice(__pyx_v_data, 0, 0, &__pyx_v_gapend, &__pyx_v_i, NULL, 0, 0, 1); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 1422, __pyx_L1_error)
+          __pyx_t_12 = __Pyx_PyObject_GetSlice(__pyx_v_data, 0, 0, &__pyx_v_gapend, &__pyx_v_i, NULL, 0, 0, 1); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 1479, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_12);
           __pyx_t_14 = NULL;
           __pyx_t_15 = 0;
           if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_11))) {
             __pyx_t_14 = PyMethod_GET_SELF(__pyx_t_11);
             if (likely(__pyx_t_14)) {
               PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_11);
@@ -27991,131 +28329,131 @@
               __Pyx_DECREF_SET(__pyx_t_11, function);
               __pyx_t_15 = 1;
             }
           }
           #if CYTHON_FAST_PYCALL
           if (PyFunction_Check(__pyx_t_11)) {
             PyObject *__pyx_temp[3] = {__pyx_t_14, __pyx_v_tr, __pyx_t_12};
-            __pyx_t_9 = __Pyx_PyFunction_FastCall(__pyx_t_11, __pyx_temp+1-__pyx_t_15, 2+__pyx_t_15); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1422, __pyx_L1_error)
+            __pyx_t_9 = __Pyx_PyFunction_FastCall(__pyx_t_11, __pyx_temp+1-__pyx_t_15, 2+__pyx_t_15); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1479, __pyx_L1_error)
             __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
             __Pyx_GOTREF(__pyx_t_9);
             __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
           } else
           #endif
           #if CYTHON_FAST_PYCCALL
           if (__Pyx_PyFastCFunction_Check(__pyx_t_11)) {
             PyObject *__pyx_temp[3] = {__pyx_t_14, __pyx_v_tr, __pyx_t_12};
-            __pyx_t_9 = __Pyx_PyCFunction_FastCall(__pyx_t_11, __pyx_temp+1-__pyx_t_15, 2+__pyx_t_15); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1422, __pyx_L1_error)
+            __pyx_t_9 = __Pyx_PyCFunction_FastCall(__pyx_t_11, __pyx_temp+1-__pyx_t_15, 2+__pyx_t_15); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1479, __pyx_L1_error)
             __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
             __Pyx_GOTREF(__pyx_t_9);
             __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
           } else
           #endif
           {
-            __pyx_t_5 = PyTuple_New(2+__pyx_t_15); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1422, __pyx_L1_error)
+            __pyx_t_5 = PyTuple_New(2+__pyx_t_15); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1479, __pyx_L1_error)
             __Pyx_GOTREF(__pyx_t_5);
             if (__pyx_t_14) {
               __Pyx_GIVEREF(__pyx_t_14); PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_14); __pyx_t_14 = NULL;
             }
             __Pyx_INCREF(__pyx_v_tr);
             __Pyx_GIVEREF(__pyx_v_tr);
             PyTuple_SET_ITEM(__pyx_t_5, 0+__pyx_t_15, __pyx_v_tr);
             __Pyx_GIVEREF(__pyx_t_12);
             PyTuple_SET_ITEM(__pyx_t_5, 1+__pyx_t_15, __pyx_t_12);
             __pyx_t_12 = 0;
-            __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_11, __pyx_t_5, NULL); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1422, __pyx_L1_error)
+            __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_11, __pyx_t_5, NULL); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1479, __pyx_L1_error)
             __Pyx_GOTREF(__pyx_t_9);
             __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
           }
           __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
           __Pyx_XDECREF_SET(__pyx_v_viterbi, __pyx_t_9);
           __pyx_t_9 = 0;
 
-          /* "soapcw/soapcw.pyx":1423
+          /* "soapcw/soapcw.pyx":1480
  *                     else:
  *                         viterbi = single_detector(tr, data[gapend:i])
  *                         starts.append(np.arange(len(viterbi.vit_track))*tsft + vitstart)             # <<<<<<<<<<<<<<
  *                         vitstart = idx
  * 
  */
-          __Pyx_GetModuleGlobalName(__pyx_t_11, __pyx_n_s_np); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1423, __pyx_L1_error)
+          __Pyx_GetModuleGlobalName(__pyx_t_11, __pyx_n_s_np); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1480, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_11);
-          __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_11, __pyx_n_s_arange); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1423, __pyx_L1_error)
+          __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_11, __pyx_n_s_arange); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1480, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_5);
           __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
-          __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_v_viterbi, __pyx_n_s_vit_track); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1423, __pyx_L1_error)
+          __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_v_viterbi, __pyx_n_s_vit_track); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1480, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_11);
-          __pyx_t_8 = PyObject_Length(__pyx_t_11); if (unlikely(__pyx_t_8 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1423, __pyx_L1_error)
+          __pyx_t_8 = PyObject_Length(__pyx_t_11); if (unlikely(__pyx_t_8 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1480, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
-          __pyx_t_11 = PyInt_FromSsize_t(__pyx_t_8); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1423, __pyx_L1_error)
+          __pyx_t_11 = PyInt_FromSsize_t(__pyx_t_8); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1480, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_11);
           __pyx_t_12 = NULL;
           if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
             __pyx_t_12 = PyMethod_GET_SELF(__pyx_t_5);
             if (likely(__pyx_t_12)) {
               PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
               __Pyx_INCREF(__pyx_t_12);
               __Pyx_INCREF(function);
               __Pyx_DECREF_SET(__pyx_t_5, function);
             }
           }
           __pyx_t_9 = (__pyx_t_12) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_12, __pyx_t_11) : __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_11);
           __Pyx_XDECREF(__pyx_t_12); __pyx_t_12 = 0;
           __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
-          if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1423, __pyx_L1_error)
+          if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1480, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_9);
           __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-          __pyx_t_5 = PyNumber_Multiply(__pyx_t_9, __pyx_v_tsft); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1423, __pyx_L1_error)
+          __pyx_t_5 = PyNumber_Multiply(__pyx_t_9, __pyx_v_tsft); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1480, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_5);
           __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-          __pyx_t_9 = PyNumber_Add(__pyx_t_5, __pyx_v_vitstart); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1423, __pyx_L1_error)
+          __pyx_t_9 = PyNumber_Add(__pyx_t_5, __pyx_v_vitstart); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1480, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_9);
           __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-          __pyx_t_10 = __Pyx_PyList_Append(__pyx_v_starts, __pyx_t_9); if (unlikely(__pyx_t_10 == ((int)-1))) __PYX_ERR(0, 1423, __pyx_L1_error)
+          __pyx_t_10 = __Pyx_PyList_Append(__pyx_v_starts, __pyx_t_9); if (unlikely(__pyx_t_10 == ((int)-1))) __PYX_ERR(0, 1480, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
 
-          /* "soapcw/soapcw.pyx":1424
+          /* "soapcw/soapcw.pyx":1481
  *                         viterbi = single_detector(tr, data[gapend:i])
  *                         starts.append(np.arange(len(viterbi.vit_track))*tsft + vitstart)
  *                         vitstart = idx             # <<<<<<<<<<<<<<
  * 
  * 
  */
           __Pyx_INCREF(__pyx_v_idx);
           __Pyx_DECREF_SET(__pyx_v_vitstart, __pyx_v_idx);
         }
         __pyx_L21:;
 
-        /* "soapcw/soapcw.pyx":1427
+        /* "soapcw/soapcw.pyx":1484
  * 
  * 
  *                     vit.append(viterbi)             # <<<<<<<<<<<<<<
  *                     gapend = i
  *                     max_vals, max_paths = self.gap_run(viterbi, band_width , diff1, tsft, tr)
  */
-        __pyx_t_10 = __Pyx_PyList_Append(__pyx_v_vit, __pyx_v_viterbi); if (unlikely(__pyx_t_10 == ((int)-1))) __PYX_ERR(0, 1427, __pyx_L1_error)
+        __pyx_t_10 = __Pyx_PyList_Append(__pyx_v_vit, __pyx_v_viterbi); if (unlikely(__pyx_t_10 == ((int)-1))) __PYX_ERR(0, 1484, __pyx_L1_error)
 
-        /* "soapcw/soapcw.pyx":1428
+        /* "soapcw/soapcw.pyx":1485
  * 
  *                     vit.append(viterbi)
  *                     gapend = i             # <<<<<<<<<<<<<<
  *                     max_vals, max_paths = self.gap_run(viterbi, band_width , diff1, tsft, tr)
  *                     #print max_vals, max_paths
  */
         __Pyx_INCREF(__pyx_v_i);
         __Pyx_DECREF_SET(__pyx_v_gapend, __pyx_v_i);
 
-        /* "soapcw/soapcw.pyx":1429
+        /* "soapcw/soapcw.pyx":1486
  *                     vit.append(viterbi)
  *                     gapend = i
  *                     max_vals, max_paths = self.gap_run(viterbi, band_width , diff1, tsft, tr)             # <<<<<<<<<<<<<<
  *                     #print max_vals, max_paths
  *                     gappaths.append(max_paths)
  */
-        __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_gap_run); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1429, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_gap_run); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1486, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_5);
         __pyx_t_11 = NULL;
         __pyx_t_15 = 0;
         if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
           __pyx_t_11 = PyMethod_GET_SELF(__pyx_t_5);
           if (likely(__pyx_t_11)) {
             PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
@@ -28124,29 +28462,29 @@
             __Pyx_DECREF_SET(__pyx_t_5, function);
             __pyx_t_15 = 1;
           }
         }
         #if CYTHON_FAST_PYCALL
         if (PyFunction_Check(__pyx_t_5)) {
           PyObject *__pyx_temp[6] = {__pyx_t_11, __pyx_v_viterbi, __pyx_v_band_width, __pyx_v_diff1, __pyx_v_tsft, __pyx_v_tr};
-          __pyx_t_9 = __Pyx_PyFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_15, 5+__pyx_t_15); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1429, __pyx_L1_error)
+          __pyx_t_9 = __Pyx_PyFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_15, 5+__pyx_t_15); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1486, __pyx_L1_error)
           __Pyx_XDECREF(__pyx_t_11); __pyx_t_11 = 0;
           __Pyx_GOTREF(__pyx_t_9);
         } else
         #endif
         #if CYTHON_FAST_PYCCALL
         if (__Pyx_PyFastCFunction_Check(__pyx_t_5)) {
           PyObject *__pyx_temp[6] = {__pyx_t_11, __pyx_v_viterbi, __pyx_v_band_width, __pyx_v_diff1, __pyx_v_tsft, __pyx_v_tr};
-          __pyx_t_9 = __Pyx_PyCFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_15, 5+__pyx_t_15); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1429, __pyx_L1_error)
+          __pyx_t_9 = __Pyx_PyCFunction_FastCall(__pyx_t_5, __pyx_temp+1-__pyx_t_15, 5+__pyx_t_15); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1486, __pyx_L1_error)
           __Pyx_XDECREF(__pyx_t_11); __pyx_t_11 = 0;
           __Pyx_GOTREF(__pyx_t_9);
         } else
         #endif
         {
-          __pyx_t_12 = PyTuple_New(5+__pyx_t_15); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 1429, __pyx_L1_error)
+          __pyx_t_12 = PyTuple_New(5+__pyx_t_15); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 1486, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_12);
           if (__pyx_t_11) {
             __Pyx_GIVEREF(__pyx_t_11); PyTuple_SET_ITEM(__pyx_t_12, 0, __pyx_t_11); __pyx_t_11 = NULL;
           }
           __Pyx_INCREF(__pyx_v_viterbi);
           __Pyx_GIVEREF(__pyx_v_viterbi);
           PyTuple_SET_ITEM(__pyx_t_12, 0+__pyx_t_15, __pyx_v_viterbi);
@@ -28158,112 +28496,112 @@
           PyTuple_SET_ITEM(__pyx_t_12, 2+__pyx_t_15, __pyx_v_diff1);
           __Pyx_INCREF(__pyx_v_tsft);
           __Pyx_GIVEREF(__pyx_v_tsft);
           PyTuple_SET_ITEM(__pyx_t_12, 3+__pyx_t_15, __pyx_v_tsft);
           __Pyx_INCREF(__pyx_v_tr);
           __Pyx_GIVEREF(__pyx_v_tr);
           PyTuple_SET_ITEM(__pyx_t_12, 4+__pyx_t_15, __pyx_v_tr);
-          __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_12, NULL); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1429, __pyx_L1_error)
+          __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_12, NULL); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1486, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_9);
           __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
         }
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
         if ((likely(PyTuple_CheckExact(__pyx_t_9))) || (PyList_CheckExact(__pyx_t_9))) {
           PyObject* sequence = __pyx_t_9;
           Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
           if (unlikely(size != 2)) {
             if (size > 2) __Pyx_RaiseTooManyValuesError(2);
             else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
-            __PYX_ERR(0, 1429, __pyx_L1_error)
+            __PYX_ERR(0, 1486, __pyx_L1_error)
           }
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
           if (likely(PyTuple_CheckExact(sequence))) {
             __pyx_t_5 = PyTuple_GET_ITEM(sequence, 0); 
             __pyx_t_12 = PyTuple_GET_ITEM(sequence, 1); 
           } else {
             __pyx_t_5 = PyList_GET_ITEM(sequence, 0); 
             __pyx_t_12 = PyList_GET_ITEM(sequence, 1); 
           }
           __Pyx_INCREF(__pyx_t_5);
           __Pyx_INCREF(__pyx_t_12);
           #else
-          __pyx_t_5 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1429, __pyx_L1_error)
+          __pyx_t_5 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1486, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_5);
-          __pyx_t_12 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 1429, __pyx_L1_error)
+          __pyx_t_12 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 1486, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_12);
           #endif
           __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
         } else {
           Py_ssize_t index = -1;
-          __pyx_t_11 = PyObject_GetIter(__pyx_t_9); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1429, __pyx_L1_error)
+          __pyx_t_11 = PyObject_GetIter(__pyx_t_9); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1486, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_11);
           __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
           __pyx_t_16 = Py_TYPE(__pyx_t_11)->tp_iternext;
           index = 0; __pyx_t_5 = __pyx_t_16(__pyx_t_11); if (unlikely(!__pyx_t_5)) goto __pyx_L22_unpacking_failed;
           __Pyx_GOTREF(__pyx_t_5);
           index = 1; __pyx_t_12 = __pyx_t_16(__pyx_t_11); if (unlikely(!__pyx_t_12)) goto __pyx_L22_unpacking_failed;
           __Pyx_GOTREF(__pyx_t_12);
-          if (__Pyx_IternextUnpackEndCheck(__pyx_t_16(__pyx_t_11), 2) < 0) __PYX_ERR(0, 1429, __pyx_L1_error)
+          if (__Pyx_IternextUnpackEndCheck(__pyx_t_16(__pyx_t_11), 2) < 0) __PYX_ERR(0, 1486, __pyx_L1_error)
           __pyx_t_16 = NULL;
           __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
           goto __pyx_L23_unpacking_done;
           __pyx_L22_unpacking_failed:;
           __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
           __pyx_t_16 = NULL;
           if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
-          __PYX_ERR(0, 1429, __pyx_L1_error)
+          __PYX_ERR(0, 1486, __pyx_L1_error)
           __pyx_L23_unpacking_done:;
         }
         __Pyx_DECREF_SET(__pyx_v_max_vals, __pyx_t_5);
         __pyx_t_5 = 0;
         __Pyx_XDECREF_SET(__pyx_v_max_paths, __pyx_t_12);
         __pyx_t_12 = 0;
 
-        /* "soapcw/soapcw.pyx":1431
+        /* "soapcw/soapcw.pyx":1488
  *                     max_vals, max_paths = self.gap_run(viterbi, band_width , diff1, tsft, tr)
  *                     #print max_vals, max_paths
  *                     gappaths.append(max_paths)             # <<<<<<<<<<<<<<
  *                     if i == len(epochs)-1:
  *                         viterbi = single_detector(tr, np.vstack([max_vals,data[gapend:]]))
  */
-        __pyx_t_10 = __Pyx_PyList_Append(__pyx_v_gappaths, __pyx_v_max_paths); if (unlikely(__pyx_t_10 == ((int)-1))) __PYX_ERR(0, 1431, __pyx_L1_error)
+        __pyx_t_10 = __Pyx_PyList_Append(__pyx_v_gappaths, __pyx_v_max_paths); if (unlikely(__pyx_t_10 == ((int)-1))) __PYX_ERR(0, 1488, __pyx_L1_error)
 
-        /* "soapcw/soapcw.pyx":1432
+        /* "soapcw/soapcw.pyx":1489
  *                     #print max_vals, max_paths
  *                     gappaths.append(max_paths)
  *                     if i == len(epochs)-1:             # <<<<<<<<<<<<<<
  *                         viterbi = single_detector(tr, np.vstack([max_vals,data[gapend:]]))
  *                         starts.append(np.arange(len(viterbi.vit_track))*tsft + idx - tsft)
  */
-        __pyx_t_8 = PyObject_Length(__pyx_v_epochs); if (unlikely(__pyx_t_8 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1432, __pyx_L1_error)
-        __pyx_t_9 = PyInt_FromSsize_t((__pyx_t_8 - 1)); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1432, __pyx_L1_error)
+        __pyx_t_8 = PyObject_Length(__pyx_v_epochs); if (unlikely(__pyx_t_8 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1489, __pyx_L1_error)
+        __pyx_t_9 = PyInt_FromSsize_t((__pyx_t_8 - 1)); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1489, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_9);
-        __pyx_t_12 = PyObject_RichCompare(__pyx_v_i, __pyx_t_9, Py_EQ); __Pyx_XGOTREF(__pyx_t_12); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 1432, __pyx_L1_error)
+        __pyx_t_12 = PyObject_RichCompare(__pyx_v_i, __pyx_t_9, Py_EQ); __Pyx_XGOTREF(__pyx_t_12); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 1489, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-        __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_12); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 1432, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_12); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 1489, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
         if (__pyx_t_6) {
 
-          /* "soapcw/soapcw.pyx":1433
+          /* "soapcw/soapcw.pyx":1490
  *                     gappaths.append(max_paths)
  *                     if i == len(epochs)-1:
  *                         viterbi = single_detector(tr, np.vstack([max_vals,data[gapend:]]))             # <<<<<<<<<<<<<<
  *                         starts.append(np.arange(len(viterbi.vit_track))*tsft + idx - tsft)
  *                         vit.append(viterbi)
  */
-          __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_single_detector); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1433, __pyx_L1_error)
+          __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_single_detector); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1490, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_9);
-          __Pyx_GetModuleGlobalName(__pyx_t_11, __pyx_n_s_np); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1433, __pyx_L1_error)
+          __Pyx_GetModuleGlobalName(__pyx_t_11, __pyx_n_s_np); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1490, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_11);
-          __pyx_t_14 = __Pyx_PyObject_GetAttrStr(__pyx_t_11, __pyx_n_s_vstack); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 1433, __pyx_L1_error)
+          __pyx_t_14 = __Pyx_PyObject_GetAttrStr(__pyx_t_11, __pyx_n_s_vstack); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 1490, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_14);
           __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
-          __pyx_t_11 = __Pyx_PyObject_GetSlice(__pyx_v_data, 0, 0, &__pyx_v_gapend, NULL, NULL, 0, 0, 1); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1433, __pyx_L1_error)
+          __pyx_t_11 = __Pyx_PyObject_GetSlice(__pyx_v_data, 0, 0, &__pyx_v_gapend, NULL, NULL, 0, 0, 1); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1490, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_11);
-          __pyx_t_13 = PyList_New(2); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 1433, __pyx_L1_error)
+          __pyx_t_13 = PyList_New(2); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 1490, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_13);
           __Pyx_INCREF(__pyx_v_max_vals);
           __Pyx_GIVEREF(__pyx_v_max_vals);
           PyList_SET_ITEM(__pyx_t_13, 0, __pyx_v_max_vals);
           __Pyx_GIVEREF(__pyx_t_11);
           PyList_SET_ITEM(__pyx_t_13, 1, __pyx_t_11);
           __pyx_t_11 = 0;
@@ -28276,15 +28614,15 @@
               __Pyx_INCREF(function);
               __Pyx_DECREF_SET(__pyx_t_14, function);
             }
           }
           __pyx_t_5 = (__pyx_t_11) ? __Pyx_PyObject_Call2Args(__pyx_t_14, __pyx_t_11, __pyx_t_13) : __Pyx_PyObject_CallOneArg(__pyx_t_14, __pyx_t_13);
           __Pyx_XDECREF(__pyx_t_11); __pyx_t_11 = 0;
           __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-          if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1433, __pyx_L1_error)
+          if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1490, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_5);
           __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
           __pyx_t_14 = NULL;
           __pyx_t_15 = 0;
           if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_9))) {
             __pyx_t_14 = PyMethod_GET_SELF(__pyx_t_9);
             if (likely(__pyx_t_14)) {
@@ -28294,181 +28632,181 @@
               __Pyx_DECREF_SET(__pyx_t_9, function);
               __pyx_t_15 = 1;
             }
           }
           #if CYTHON_FAST_PYCALL
           if (PyFunction_Check(__pyx_t_9)) {
             PyObject *__pyx_temp[3] = {__pyx_t_14, __pyx_v_tr, __pyx_t_5};
-            __pyx_t_12 = __Pyx_PyFunction_FastCall(__pyx_t_9, __pyx_temp+1-__pyx_t_15, 2+__pyx_t_15); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 1433, __pyx_L1_error)
+            __pyx_t_12 = __Pyx_PyFunction_FastCall(__pyx_t_9, __pyx_temp+1-__pyx_t_15, 2+__pyx_t_15); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 1490, __pyx_L1_error)
             __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
             __Pyx_GOTREF(__pyx_t_12);
             __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
           } else
           #endif
           #if CYTHON_FAST_PYCCALL
           if (__Pyx_PyFastCFunction_Check(__pyx_t_9)) {
             PyObject *__pyx_temp[3] = {__pyx_t_14, __pyx_v_tr, __pyx_t_5};
-            __pyx_t_12 = __Pyx_PyCFunction_FastCall(__pyx_t_9, __pyx_temp+1-__pyx_t_15, 2+__pyx_t_15); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 1433, __pyx_L1_error)
+            __pyx_t_12 = __Pyx_PyCFunction_FastCall(__pyx_t_9, __pyx_temp+1-__pyx_t_15, 2+__pyx_t_15); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 1490, __pyx_L1_error)
             __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
             __Pyx_GOTREF(__pyx_t_12);
             __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
           } else
           #endif
           {
-            __pyx_t_13 = PyTuple_New(2+__pyx_t_15); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 1433, __pyx_L1_error)
+            __pyx_t_13 = PyTuple_New(2+__pyx_t_15); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 1490, __pyx_L1_error)
             __Pyx_GOTREF(__pyx_t_13);
             if (__pyx_t_14) {
               __Pyx_GIVEREF(__pyx_t_14); PyTuple_SET_ITEM(__pyx_t_13, 0, __pyx_t_14); __pyx_t_14 = NULL;
             }
             __Pyx_INCREF(__pyx_v_tr);
             __Pyx_GIVEREF(__pyx_v_tr);
             PyTuple_SET_ITEM(__pyx_t_13, 0+__pyx_t_15, __pyx_v_tr);
             __Pyx_GIVEREF(__pyx_t_5);
             PyTuple_SET_ITEM(__pyx_t_13, 1+__pyx_t_15, __pyx_t_5);
             __pyx_t_5 = 0;
-            __pyx_t_12 = __Pyx_PyObject_Call(__pyx_t_9, __pyx_t_13, NULL); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 1433, __pyx_L1_error)
+            __pyx_t_12 = __Pyx_PyObject_Call(__pyx_t_9, __pyx_t_13, NULL); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 1490, __pyx_L1_error)
             __Pyx_GOTREF(__pyx_t_12);
             __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
           }
           __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
           __Pyx_DECREF_SET(__pyx_v_viterbi, __pyx_t_12);
           __pyx_t_12 = 0;
 
-          /* "soapcw/soapcw.pyx":1434
+          /* "soapcw/soapcw.pyx":1491
  *                     if i == len(epochs)-1:
  *                         viterbi = single_detector(tr, np.vstack([max_vals,data[gapend:]]))
  *                         starts.append(np.arange(len(viterbi.vit_track))*tsft + idx - tsft)             # <<<<<<<<<<<<<<
  *                         vit.append(viterbi)
  * 
  */
-          __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_np); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1434, __pyx_L1_error)
+          __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_np); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1491, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_9);
-          __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_arange); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 1434, __pyx_L1_error)
+          __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_arange); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 1491, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_13);
           __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-          __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_v_viterbi, __pyx_n_s_vit_track); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1434, __pyx_L1_error)
+          __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_v_viterbi, __pyx_n_s_vit_track); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1491, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_9);
-          __pyx_t_8 = PyObject_Length(__pyx_t_9); if (unlikely(__pyx_t_8 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1434, __pyx_L1_error)
+          __pyx_t_8 = PyObject_Length(__pyx_t_9); if (unlikely(__pyx_t_8 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1491, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-          __pyx_t_9 = PyInt_FromSsize_t(__pyx_t_8); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1434, __pyx_L1_error)
+          __pyx_t_9 = PyInt_FromSsize_t(__pyx_t_8); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1491, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_9);
           __pyx_t_5 = NULL;
           if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_13))) {
             __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_13);
             if (likely(__pyx_t_5)) {
               PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_13);
               __Pyx_INCREF(__pyx_t_5);
               __Pyx_INCREF(function);
               __Pyx_DECREF_SET(__pyx_t_13, function);
             }
           }
           __pyx_t_12 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_13, __pyx_t_5, __pyx_t_9) : __Pyx_PyObject_CallOneArg(__pyx_t_13, __pyx_t_9);
           __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
           __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-          if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 1434, __pyx_L1_error)
+          if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 1491, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_12);
           __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-          __pyx_t_13 = PyNumber_Multiply(__pyx_t_12, __pyx_v_tsft); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 1434, __pyx_L1_error)
+          __pyx_t_13 = PyNumber_Multiply(__pyx_t_12, __pyx_v_tsft); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 1491, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_13);
           __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
-          __pyx_t_12 = PyNumber_Add(__pyx_t_13, __pyx_v_idx); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 1434, __pyx_L1_error)
+          __pyx_t_12 = PyNumber_Add(__pyx_t_13, __pyx_v_idx); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 1491, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_12);
           __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
-          __pyx_t_13 = PyNumber_Subtract(__pyx_t_12, __pyx_v_tsft); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 1434, __pyx_L1_error)
+          __pyx_t_13 = PyNumber_Subtract(__pyx_t_12, __pyx_v_tsft); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 1491, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_13);
           __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
-          __pyx_t_10 = __Pyx_PyList_Append(__pyx_v_starts, __pyx_t_13); if (unlikely(__pyx_t_10 == ((int)-1))) __PYX_ERR(0, 1434, __pyx_L1_error)
+          __pyx_t_10 = __Pyx_PyList_Append(__pyx_v_starts, __pyx_t_13); if (unlikely(__pyx_t_10 == ((int)-1))) __PYX_ERR(0, 1491, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
 
-          /* "soapcw/soapcw.pyx":1435
+          /* "soapcw/soapcw.pyx":1492
  *                         viterbi = single_detector(tr, np.vstack([max_vals,data[gapend:]]))
  *                         starts.append(np.arange(len(viterbi.vit_track))*tsft + idx - tsft)
  *                         vit.append(viterbi)             # <<<<<<<<<<<<<<
  * 
  *                 else:
  */
-          __pyx_t_10 = __Pyx_PyList_Append(__pyx_v_vit, __pyx_v_viterbi); if (unlikely(__pyx_t_10 == ((int)-1))) __PYX_ERR(0, 1435, __pyx_L1_error)
+          __pyx_t_10 = __Pyx_PyList_Append(__pyx_v_vit, __pyx_v_viterbi); if (unlikely(__pyx_t_10 == ((int)-1))) __PYX_ERR(0, 1492, __pyx_L1_error)
 
-          /* "soapcw/soapcw.pyx":1432
+          /* "soapcw/soapcw.pyx":1489
  *                     #print max_vals, max_paths
  *                     gappaths.append(max_paths)
  *                     if i == len(epochs)-1:             # <<<<<<<<<<<<<<
  *                         viterbi = single_detector(tr, np.vstack([max_vals,data[gapend:]]))
  *                         starts.append(np.arange(len(viterbi.vit_track))*tsft + idx - tsft)
  */
         }
 
-        /* "soapcw/soapcw.pyx":1414
+        /* "soapcw/soapcw.pyx":1471
  *                         vit.append(viterbi)
  * 
  *                 elif diff_ind >= band_width + 1:             # <<<<<<<<<<<<<<
  * 
  *                     diff1 = band_width + 1
  */
         goto __pyx_L14;
       }
 
-      /* "soapcw/soapcw.pyx":1438
+      /* "soapcw/soapcw.pyx":1495
  * 
  *                 else:
  *                     continue             # <<<<<<<<<<<<<<
  * 
  *         return vit,starts, gappaths
  */
       /*else*/ {
         goto __pyx_L11_continue;
       }
       __pyx_L14:;
 
-      /* "soapcw/soapcw.pyx":1391
+      /* "soapcw/soapcw.pyx":1448
  *             if i == 0 :
  *                 pass
  *             elif i > 0:# and i != len(epochs)-1:             # <<<<<<<<<<<<<<
  *                 diff = epochs[i]-epochs[i-1]
  *                 diff_ind = int(diff/tsft)
  */
     }
     __pyx_L13:;
 
-    /* "soapcw/soapcw.pyx":1388
+    /* "soapcw/soapcw.pyx":1445
  *         epochs = np.array(epochs)
  * 
  *         for i,idx in enumerate(epochs):             # <<<<<<<<<<<<<<
  *             if i == 0 :
  *                 pass
  */
     __pyx_L11_continue:;
   }
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "soapcw/soapcw.pyx":1440
+  /* "soapcw/soapcw.pyx":1497
  *                     continue
  * 
  *         return vit,starts, gappaths             # <<<<<<<<<<<<<<
  * 
  *     def get_track(self,vit,starts,gappaths,tsft=1):
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1440, __pyx_L1_error)
+  __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1497, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_INCREF(__pyx_v_vit);
   __Pyx_GIVEREF(__pyx_v_vit);
   PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_vit);
   __Pyx_INCREF(__pyx_v_starts);
   __Pyx_GIVEREF(__pyx_v_starts);
   PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_starts);
   __Pyx_INCREF(__pyx_v_gappaths);
   __Pyx_GIVEREF(__pyx_v_gappaths);
   PyTuple_SET_ITEM(__pyx_t_1, 2, __pyx_v_gappaths);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "soapcw/soapcw.pyx":1358
+  /* "soapcw/soapcw.pyx":1415
  * 
  * 
  *     def vit_gaps(self,data1,epochs1,tr,tsft):             # <<<<<<<<<<<<<<
  * 
  *         band_width = len(data1[0])
  */
 
@@ -28502,15 +28840,15 @@
   __Pyx_XDECREF(__pyx_v_max_paths);
   __Pyx_XDECREF(__pyx_v_diff1);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "soapcw/soapcw.pyx":1442
+/* "soapcw/soapcw.pyx":1499
  *         return vit,starts, gappaths
  * 
  *     def get_track(self,vit,starts,gappaths,tsft=1):             # <<<<<<<<<<<<<<
  *         vit_track = []
  *         vit_track_time = []
  */
 
@@ -28555,37 +28893,37 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_self)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_vit)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("get_track", 0, 4, 5, 1); __PYX_ERR(0, 1442, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("get_track", 0, 4, 5, 1); __PYX_ERR(0, 1499, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_starts)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("get_track", 0, 4, 5, 2); __PYX_ERR(0, 1442, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("get_track", 0, 4, 5, 2); __PYX_ERR(0, 1499, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  3:
         if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_gappaths)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("get_track", 0, 4, 5, 3); __PYX_ERR(0, 1442, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("get_track", 0, 4, 5, 3); __PYX_ERR(0, 1499, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  4:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_tsft);
           if (value) { values[4] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "get_track") < 0)) __PYX_ERR(0, 1442, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "get_track") < 0)) __PYX_ERR(0, 1499, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
         CYTHON_FALLTHROUGH;
         case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
         values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
@@ -28599,15 +28937,15 @@
     __pyx_v_vit = values[1];
     __pyx_v_starts = values[2];
     __pyx_v_gappaths = values[3];
     __pyx_v_tsft = values[4];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("get_track", 0, 4, 5, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1442, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("get_track", 0, 4, 5, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1499, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("soapcw.soapcw.single_detector_gaps.get_track", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_6soapcw_6soapcw_20single_detector_gaps_10get_track(__pyx_self, __pyx_v_self, __pyx_v_vit, __pyx_v_starts, __pyx_v_gappaths, __pyx_v_tsft);
 
@@ -28640,154 +28978,154 @@
   int __pyx_t_12;
   Py_ssize_t __pyx_t_13;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("get_track", 0);
 
-  /* "soapcw/soapcw.pyx":1443
+  /* "soapcw/soapcw.pyx":1500
  * 
  *     def get_track(self,vit,starts,gappaths,tsft=1):
  *         vit_track = []             # <<<<<<<<<<<<<<
  *         vit_track_time = []
  *         gpb = False
  */
-  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1443, __pyx_L1_error)
+  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1500, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_vit_track = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "soapcw/soapcw.pyx":1444
+  /* "soapcw/soapcw.pyx":1501
  *     def get_track(self,vit,starts,gappaths,tsft=1):
  *         vit_track = []
  *         vit_track_time = []             # <<<<<<<<<<<<<<
  *         gpb = False
  *         gp = None
  */
-  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1444, __pyx_L1_error)
+  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1501, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_vit_track_time = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "soapcw/soapcw.pyx":1445
+  /* "soapcw/soapcw.pyx":1502
  *         vit_track = []
  *         vit_track_time = []
  *         gpb = False             # <<<<<<<<<<<<<<
  *         gp = None
  *         if len(starts) > 1:
  */
   __pyx_v_gpb = 0;
 
-  /* "soapcw/soapcw.pyx":1446
+  /* "soapcw/soapcw.pyx":1503
  *         vit_track_time = []
  *         gpb = False
  *         gp = None             # <<<<<<<<<<<<<<
  *         if len(starts) > 1:
  *             for v in range(len(starts))[::-1]:
  */
   __Pyx_INCREF(Py_None);
   __pyx_v_gp = Py_None;
 
-  /* "soapcw/soapcw.pyx":1447
+  /* "soapcw/soapcw.pyx":1504
  *         gpb = False
  *         gp = None
  *         if len(starts) > 1:             # <<<<<<<<<<<<<<
  *             for v in range(len(starts))[::-1]:
  *                 if gpb:
  */
-  __pyx_t_2 = PyObject_Length(__pyx_v_starts); if (unlikely(__pyx_t_2 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1447, __pyx_L1_error)
+  __pyx_t_2 = PyObject_Length(__pyx_v_starts); if (unlikely(__pyx_t_2 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1504, __pyx_L1_error)
   __pyx_t_3 = ((__pyx_t_2 > 1) != 0);
   if (__pyx_t_3) {
 
-    /* "soapcw/soapcw.pyx":1448
+    /* "soapcw/soapcw.pyx":1505
  *         gp = None
  *         if len(starts) > 1:
  *             for v in range(len(starts))[::-1]:             # <<<<<<<<<<<<<<
  *                 if gpb:
  *                     p1 = self.find_path(vit[v].prev,int(vit_track[-1]))[::-1]
  */
-    __pyx_t_2 = PyObject_Length(__pyx_v_starts); if (unlikely(__pyx_t_2 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1448, __pyx_L1_error)
-    __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1448, __pyx_L1_error)
+    __pyx_t_2 = PyObject_Length(__pyx_v_starts); if (unlikely(__pyx_t_2 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1505, __pyx_L1_error)
+    __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1505, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_builtin_range, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1448, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_builtin_range, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1505, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_t_4, __pyx_slice__9); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1448, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_t_4, __pyx_slice__9); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1505, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     if (likely(PyList_CheckExact(__pyx_t_1)) || PyTuple_CheckExact(__pyx_t_1)) {
       __pyx_t_4 = __pyx_t_1; __Pyx_INCREF(__pyx_t_4); __pyx_t_2 = 0;
       __pyx_t_5 = NULL;
     } else {
-      __pyx_t_2 = -1; __pyx_t_4 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1448, __pyx_L1_error)
+      __pyx_t_2 = -1; __pyx_t_4 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1505, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
-      __pyx_t_5 = Py_TYPE(__pyx_t_4)->tp_iternext; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1448, __pyx_L1_error)
+      __pyx_t_5 = Py_TYPE(__pyx_t_4)->tp_iternext; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1505, __pyx_L1_error)
     }
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     for (;;) {
       if (likely(!__pyx_t_5)) {
         if (likely(PyList_CheckExact(__pyx_t_4))) {
           if (__pyx_t_2 >= PyList_GET_SIZE(__pyx_t_4)) break;
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-          __pyx_t_1 = PyList_GET_ITEM(__pyx_t_4, __pyx_t_2); __Pyx_INCREF(__pyx_t_1); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 1448, __pyx_L1_error)
+          __pyx_t_1 = PyList_GET_ITEM(__pyx_t_4, __pyx_t_2); __Pyx_INCREF(__pyx_t_1); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 1505, __pyx_L1_error)
           #else
-          __pyx_t_1 = PySequence_ITEM(__pyx_t_4, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1448, __pyx_L1_error)
+          __pyx_t_1 = PySequence_ITEM(__pyx_t_4, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1505, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_1);
           #endif
         } else {
           if (__pyx_t_2 >= PyTuple_GET_SIZE(__pyx_t_4)) break;
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-          __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_4, __pyx_t_2); __Pyx_INCREF(__pyx_t_1); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 1448, __pyx_L1_error)
+          __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_4, __pyx_t_2); __Pyx_INCREF(__pyx_t_1); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 1505, __pyx_L1_error)
           #else
-          __pyx_t_1 = PySequence_ITEM(__pyx_t_4, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1448, __pyx_L1_error)
+          __pyx_t_1 = PySequence_ITEM(__pyx_t_4, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1505, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_1);
           #endif
         }
       } else {
         __pyx_t_1 = __pyx_t_5(__pyx_t_4);
         if (unlikely(!__pyx_t_1)) {
           PyObject* exc_type = PyErr_Occurred();
           if (exc_type) {
             if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-            else __PYX_ERR(0, 1448, __pyx_L1_error)
+            else __PYX_ERR(0, 1505, __pyx_L1_error)
           }
           break;
         }
         __Pyx_GOTREF(__pyx_t_1);
       }
       __Pyx_XDECREF_SET(__pyx_v_v, __pyx_t_1);
       __pyx_t_1 = 0;
 
-      /* "soapcw/soapcw.pyx":1449
+      /* "soapcw/soapcw.pyx":1506
  *         if len(starts) > 1:
  *             for v in range(len(starts))[::-1]:
  *                 if gpb:             # <<<<<<<<<<<<<<
  *                     p1 = self.find_path(vit[v].prev,int(vit_track[-1]))[::-1]
  *                     vit_track.extend(p1[1:])
  */
       __pyx_t_3 = (__pyx_v_gpb != 0);
       if (__pyx_t_3) {
 
-        /* "soapcw/soapcw.pyx":1450
+        /* "soapcw/soapcw.pyx":1507
  *             for v in range(len(starts))[::-1]:
  *                 if gpb:
  *                     p1 = self.find_path(vit[v].prev,int(vit_track[-1]))[::-1]             # <<<<<<<<<<<<<<
  *                     vit_track.extend(p1[1:])
  *                     vit_track_time.extend(starts[v][::-1][1:])
  */
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_find_path); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1450, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_find_path); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1507, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_7 = __Pyx_PyObject_GetItem(__pyx_v_vit, __pyx_v_v); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1450, __pyx_L1_error)
+        __pyx_t_7 = __Pyx_PyObject_GetItem(__pyx_v_vit, __pyx_v_v); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1507, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_7);
-        __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_prev); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1450, __pyx_L1_error)
+        __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_prev); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1507, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
         __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-        __pyx_t_7 = __Pyx_GetItemInt(__pyx_v_vit_track, -1L, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1450, __pyx_L1_error)
+        __pyx_t_7 = __Pyx_GetItemInt(__pyx_v_vit_track, -1L, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1507, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_7);
-        __pyx_t_9 = __Pyx_PyNumber_Int(__pyx_t_7); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1450, __pyx_L1_error)
+        __pyx_t_9 = __Pyx_PyNumber_Int(__pyx_t_7); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1507, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_9);
         __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
         __pyx_t_7 = NULL;
         __pyx_t_10 = 0;
         if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_6))) {
           __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_6);
           if (likely(__pyx_t_7)) {
@@ -28797,295 +29135,295 @@
             __Pyx_DECREF_SET(__pyx_t_6, function);
             __pyx_t_10 = 1;
           }
         }
         #if CYTHON_FAST_PYCALL
         if (PyFunction_Check(__pyx_t_6)) {
           PyObject *__pyx_temp[3] = {__pyx_t_7, __pyx_t_8, __pyx_t_9};
-          __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_6, __pyx_temp+1-__pyx_t_10, 2+__pyx_t_10); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1450, __pyx_L1_error)
+          __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_6, __pyx_temp+1-__pyx_t_10, 2+__pyx_t_10); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1507, __pyx_L1_error)
           __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
           __Pyx_GOTREF(__pyx_t_1);
           __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
           __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
         } else
         #endif
         #if CYTHON_FAST_PYCCALL
         if (__Pyx_PyFastCFunction_Check(__pyx_t_6)) {
           PyObject *__pyx_temp[3] = {__pyx_t_7, __pyx_t_8, __pyx_t_9};
-          __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_6, __pyx_temp+1-__pyx_t_10, 2+__pyx_t_10); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1450, __pyx_L1_error)
+          __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_6, __pyx_temp+1-__pyx_t_10, 2+__pyx_t_10); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1507, __pyx_L1_error)
           __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
           __Pyx_GOTREF(__pyx_t_1);
           __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
           __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
         } else
         #endif
         {
-          __pyx_t_11 = PyTuple_New(2+__pyx_t_10); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1450, __pyx_L1_error)
+          __pyx_t_11 = PyTuple_New(2+__pyx_t_10); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1507, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_11);
           if (__pyx_t_7) {
             __Pyx_GIVEREF(__pyx_t_7); PyTuple_SET_ITEM(__pyx_t_11, 0, __pyx_t_7); __pyx_t_7 = NULL;
           }
           __Pyx_GIVEREF(__pyx_t_8);
           PyTuple_SET_ITEM(__pyx_t_11, 0+__pyx_t_10, __pyx_t_8);
           __Pyx_GIVEREF(__pyx_t_9);
           PyTuple_SET_ITEM(__pyx_t_11, 1+__pyx_t_10, __pyx_t_9);
           __pyx_t_8 = 0;
           __pyx_t_9 = 0;
-          __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_11, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1450, __pyx_L1_error)
+          __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_11, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1507, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_1);
           __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
         }
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-        __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_t_1, __pyx_slice__9); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1450, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_t_1, __pyx_slice__9); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1507, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         __Pyx_XDECREF_SET(__pyx_v_p1, __pyx_t_6);
         __pyx_t_6 = 0;
 
-        /* "soapcw/soapcw.pyx":1451
+        /* "soapcw/soapcw.pyx":1508
  *                 if gpb:
  *                     p1 = self.find_path(vit[v].prev,int(vit_track[-1]))[::-1]
  *                     vit_track.extend(p1[1:])             # <<<<<<<<<<<<<<
  *                     vit_track_time.extend(starts[v][::-1][1:])
  *                 else:
  */
-        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_vit_track, __pyx_n_s_extend); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1451, __pyx_L1_error)
+        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_vit_track, __pyx_n_s_extend); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1508, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
-        __pyx_t_11 = __Pyx_PyObject_GetSlice(__pyx_v_p1, 1, 0, NULL, NULL, &__pyx_slice__8, 1, 0, 1); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1451, __pyx_L1_error)
+        __pyx_t_11 = __Pyx_PyObject_GetSlice(__pyx_v_p1, 1, 0, NULL, NULL, &__pyx_slice__8, 1, 0, 1); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1508, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_11);
         __pyx_t_9 = NULL;
         if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
           __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_1);
           if (likely(__pyx_t_9)) {
             PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
             __Pyx_INCREF(__pyx_t_9);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_1, function);
           }
         }
         __pyx_t_6 = (__pyx_t_9) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_9, __pyx_t_11) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_11);
         __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
         __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
-        if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1451, __pyx_L1_error)
+        if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1508, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
 
-        /* "soapcw/soapcw.pyx":1452
+        /* "soapcw/soapcw.pyx":1509
  *                     p1 = self.find_path(vit[v].prev,int(vit_track[-1]))[::-1]
  *                     vit_track.extend(p1[1:])
  *                     vit_track_time.extend(starts[v][::-1][1:])             # <<<<<<<<<<<<<<
  *                 else:
  *                     p1 = vit[v].vit_track[::-1]
  */
-        __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_v_starts, __pyx_v_v); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1452, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_v_starts, __pyx_v_v); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1509, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_t_6, __pyx_slice__9); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1452, __pyx_L1_error)
+        __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_t_6, __pyx_slice__9); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1509, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-        __pyx_t_6 = __Pyx_PyObject_GetSlice(__pyx_t_1, 1, 0, NULL, NULL, &__pyx_slice__8, 1, 0, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1452, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetSlice(__pyx_t_1, 1, 0, NULL, NULL, &__pyx_slice__8, 1, 0, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1509, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-        __pyx_t_12 = __Pyx_PyList_Extend(__pyx_v_vit_track_time, __pyx_t_6); if (unlikely(__pyx_t_12 == ((int)-1))) __PYX_ERR(0, 1452, __pyx_L1_error)
+        __pyx_t_12 = __Pyx_PyList_Extend(__pyx_v_vit_track_time, __pyx_t_6); if (unlikely(__pyx_t_12 == ((int)-1))) __PYX_ERR(0, 1509, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
 
-        /* "soapcw/soapcw.pyx":1449
+        /* "soapcw/soapcw.pyx":1506
  *         if len(starts) > 1:
  *             for v in range(len(starts))[::-1]:
  *                 if gpb:             # <<<<<<<<<<<<<<
  *                     p1 = self.find_path(vit[v].prev,int(vit_track[-1]))[::-1]
  *                     vit_track.extend(p1[1:])
  */
         goto __pyx_L6;
       }
 
-      /* "soapcw/soapcw.pyx":1454
+      /* "soapcw/soapcw.pyx":1511
  *                     vit_track_time.extend(starts[v][::-1][1:])
  *                 else:
  *                     p1 = vit[v].vit_track[::-1]             # <<<<<<<<<<<<<<
  *                     vit_track.extend(p1)
  *                     vit_track_time.extend(starts[v][::-1])
  */
       /*else*/ {
-        __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_v_vit, __pyx_v_v); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1454, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_v_vit, __pyx_v_v); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1511, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_vit_track); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1454, __pyx_L1_error)
+        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_vit_track); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1511, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-        __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_t_1, __pyx_slice__9); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1454, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_t_1, __pyx_slice__9); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1511, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         __Pyx_XDECREF_SET(__pyx_v_p1, __pyx_t_6);
         __pyx_t_6 = 0;
 
-        /* "soapcw/soapcw.pyx":1455
+        /* "soapcw/soapcw.pyx":1512
  *                 else:
  *                     p1 = vit[v].vit_track[::-1]
  *                     vit_track.extend(p1)             # <<<<<<<<<<<<<<
  *                     vit_track_time.extend(starts[v][::-1])
  *                 st = vit_track[-1]
  */
-        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_vit_track, __pyx_n_s_extend); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1455, __pyx_L1_error)
+        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_vit_track, __pyx_n_s_extend); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1512, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
         __pyx_t_11 = NULL;
         if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
           __pyx_t_11 = PyMethod_GET_SELF(__pyx_t_1);
           if (likely(__pyx_t_11)) {
             PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
             __Pyx_INCREF(__pyx_t_11);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_1, function);
           }
         }
         __pyx_t_6 = (__pyx_t_11) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_11, __pyx_v_p1) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_v_p1);
         __Pyx_XDECREF(__pyx_t_11); __pyx_t_11 = 0;
-        if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1455, __pyx_L1_error)
+        if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1512, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
 
-        /* "soapcw/soapcw.pyx":1456
+        /* "soapcw/soapcw.pyx":1513
  *                     p1 = vit[v].vit_track[::-1]
  *                     vit_track.extend(p1)
  *                     vit_track_time.extend(starts[v][::-1])             # <<<<<<<<<<<<<<
  *                 st = vit_track[-1]
  *                 if v-1 >= 0:
  */
-        __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_v_starts, __pyx_v_v); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1456, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_v_starts, __pyx_v_v); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1513, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_t_6, __pyx_slice__9); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1456, __pyx_L1_error)
+        __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_t_6, __pyx_slice__9); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1513, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-        __pyx_t_12 = __Pyx_PyList_Extend(__pyx_v_vit_track_time, __pyx_t_1); if (unlikely(__pyx_t_12 == ((int)-1))) __PYX_ERR(0, 1456, __pyx_L1_error)
+        __pyx_t_12 = __Pyx_PyList_Extend(__pyx_v_vit_track_time, __pyx_t_1); if (unlikely(__pyx_t_12 == ((int)-1))) __PYX_ERR(0, 1513, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       }
       __pyx_L6:;
 
-      /* "soapcw/soapcw.pyx":1457
+      /* "soapcw/soapcw.pyx":1514
  *                     vit_track.extend(p1)
  *                     vit_track_time.extend(starts[v][::-1])
  *                 st = vit_track[-1]             # <<<<<<<<<<<<<<
  *                 if v-1 >= 0:
  *                     gp = gappaths[v-1][st][::-1]
  */
-      __pyx_t_1 = __Pyx_GetItemInt_List(__pyx_v_vit_track, -1L, long, 1, __Pyx_PyInt_From_long, 1, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1457, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_GetItemInt_List(__pyx_v_vit_track, -1L, long, 1, __Pyx_PyInt_From_long, 1, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1514, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       __Pyx_XDECREF_SET(__pyx_v_st, __pyx_t_1);
       __pyx_t_1 = 0;
 
-      /* "soapcw/soapcw.pyx":1458
+      /* "soapcw/soapcw.pyx":1515
  *                     vit_track_time.extend(starts[v][::-1])
  *                 st = vit_track[-1]
  *                 if v-1 >= 0:             # <<<<<<<<<<<<<<
  *                     gp = gappaths[v-1][st][::-1]
  *                     vit_track.extend(gp)
  */
-      __pyx_t_1 = __Pyx_PyInt_SubtractObjC(__pyx_v_v, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1458, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyInt_SubtractObjC(__pyx_v_v, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1515, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
-      __pyx_t_6 = PyObject_RichCompare(__pyx_t_1, __pyx_int_0, Py_GE); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1458, __pyx_L1_error)
+      __pyx_t_6 = PyObject_RichCompare(__pyx_t_1, __pyx_int_0, Py_GE); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1515, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-      __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 1458, __pyx_L1_error)
+      __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 1515, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
       if (__pyx_t_3) {
 
-        /* "soapcw/soapcw.pyx":1459
+        /* "soapcw/soapcw.pyx":1516
  *                 st = vit_track[-1]
  *                 if v-1 >= 0:
  *                     gp = gappaths[v-1][st][::-1]             # <<<<<<<<<<<<<<
  *                     vit_track.extend(gp)
  *                     vit_track_time.extend(np.array(np.arange(len(gp))*tsft + starts[v-1][-1])[::-1])#+np.array(range(len(gp))[::-1]))
  */
-        __pyx_t_6 = __Pyx_PyInt_SubtractObjC(__pyx_v_v, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1459, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyInt_SubtractObjC(__pyx_v_v, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1516, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_v_gappaths, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1459, __pyx_L1_error)
+        __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_v_gappaths, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1516, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-        __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_t_1, __pyx_v_st); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1459, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_t_1, __pyx_v_st); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1516, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-        __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_t_6, __pyx_slice__9); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1459, __pyx_L1_error)
+        __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_t_6, __pyx_slice__9); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1516, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __Pyx_DECREF_SET(__pyx_v_gp, __pyx_t_1);
         __pyx_t_1 = 0;
 
-        /* "soapcw/soapcw.pyx":1460
+        /* "soapcw/soapcw.pyx":1517
  *                 if v-1 >= 0:
  *                     gp = gappaths[v-1][st][::-1]
  *                     vit_track.extend(gp)             # <<<<<<<<<<<<<<
  *                     vit_track_time.extend(np.array(np.arange(len(gp))*tsft + starts[v-1][-1])[::-1])#+np.array(range(len(gp))[::-1]))
  *                     #vit_track_time.extend(range(len(gp))[::-1])
  */
-        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_vit_track, __pyx_n_s_extend); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1460, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_vit_track, __pyx_n_s_extend); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1517, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __pyx_t_11 = NULL;
         if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_6))) {
           __pyx_t_11 = PyMethod_GET_SELF(__pyx_t_6);
           if (likely(__pyx_t_11)) {
             PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
             __Pyx_INCREF(__pyx_t_11);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_6, function);
           }
         }
         __pyx_t_1 = (__pyx_t_11) ? __Pyx_PyObject_Call2Args(__pyx_t_6, __pyx_t_11, __pyx_v_gp) : __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_v_gp);
         __Pyx_XDECREF(__pyx_t_11); __pyx_t_11 = 0;
-        if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1460, __pyx_L1_error)
+        if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1517, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-        /* "soapcw/soapcw.pyx":1461
+        /* "soapcw/soapcw.pyx":1518
  *                     gp = gappaths[v-1][st][::-1]
  *                     vit_track.extend(gp)
  *                     vit_track_time.extend(np.array(np.arange(len(gp))*tsft + starts[v-1][-1])[::-1])#+np.array(range(len(gp))[::-1]))             # <<<<<<<<<<<<<<
  *                     #vit_track_time.extend(range(len(gp))[::-1])
  *                     gpb = True
  */
-        __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1461, __pyx_L1_error)
+        __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1518, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_array); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1461, __pyx_L1_error)
+        __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_array); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1518, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_11);
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-        __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_np); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1461, __pyx_L1_error)
+        __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_np); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1518, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_9);
-        __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_arange); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1461, __pyx_L1_error)
+        __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_arange); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1518, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
         __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-        __pyx_t_13 = PyObject_Length(__pyx_v_gp); if (unlikely(__pyx_t_13 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1461, __pyx_L1_error)
-        __pyx_t_9 = PyInt_FromSsize_t(__pyx_t_13); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1461, __pyx_L1_error)
+        __pyx_t_13 = PyObject_Length(__pyx_v_gp); if (unlikely(__pyx_t_13 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1518, __pyx_L1_error)
+        __pyx_t_9 = PyInt_FromSsize_t(__pyx_t_13); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1518, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_9);
         __pyx_t_7 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_8))) {
           __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_8);
           if (likely(__pyx_t_7)) {
             PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
             __Pyx_INCREF(__pyx_t_7);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_8, function);
           }
         }
         __pyx_t_6 = (__pyx_t_7) ? __Pyx_PyObject_Call2Args(__pyx_t_8, __pyx_t_7, __pyx_t_9) : __Pyx_PyObject_CallOneArg(__pyx_t_8, __pyx_t_9);
         __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
         __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-        if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1461, __pyx_L1_error)
+        if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1518, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-        __pyx_t_8 = PyNumber_Multiply(__pyx_t_6, __pyx_v_tsft); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1461, __pyx_L1_error)
+        __pyx_t_8 = PyNumber_Multiply(__pyx_t_6, __pyx_v_tsft); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1518, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-        __pyx_t_6 = __Pyx_PyInt_SubtractObjC(__pyx_v_v, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1461, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyInt_SubtractObjC(__pyx_v_v, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1518, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_9 = __Pyx_PyObject_GetItem(__pyx_v_starts, __pyx_t_6); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1461, __pyx_L1_error)
+        __pyx_t_9 = __Pyx_PyObject_GetItem(__pyx_v_starts, __pyx_t_6); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1518, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_9);
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-        __pyx_t_6 = __Pyx_GetItemInt(__pyx_t_9, -1L, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1461, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_GetItemInt(__pyx_t_9, -1L, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1518, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-        __pyx_t_9 = PyNumber_Add(__pyx_t_8, __pyx_t_6); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1461, __pyx_L1_error)
+        __pyx_t_9 = PyNumber_Add(__pyx_t_8, __pyx_t_6); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1518, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_9);
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __pyx_t_6 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_11))) {
           __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_11);
           if (likely(__pyx_t_6)) {
@@ -29094,117 +29432,117 @@
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_11, function);
           }
         }
         __pyx_t_1 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_11, __pyx_t_6, __pyx_t_9) : __Pyx_PyObject_CallOneArg(__pyx_t_11, __pyx_t_9);
         __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
         __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-        if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1461, __pyx_L1_error)
+        if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1518, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
         __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
-        __pyx_t_11 = __Pyx_PyObject_GetItem(__pyx_t_1, __pyx_slice__9); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1461, __pyx_L1_error)
+        __pyx_t_11 = __Pyx_PyObject_GetItem(__pyx_t_1, __pyx_slice__9); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1518, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_11);
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-        __pyx_t_12 = __Pyx_PyList_Extend(__pyx_v_vit_track_time, __pyx_t_11); if (unlikely(__pyx_t_12 == ((int)-1))) __PYX_ERR(0, 1461, __pyx_L1_error)
+        __pyx_t_12 = __Pyx_PyList_Extend(__pyx_v_vit_track_time, __pyx_t_11); if (unlikely(__pyx_t_12 == ((int)-1))) __PYX_ERR(0, 1518, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
 
-        /* "soapcw/soapcw.pyx":1463
+        /* "soapcw/soapcw.pyx":1520
  *                     vit_track_time.extend(np.array(np.arange(len(gp))*tsft + starts[v-1][-1])[::-1])#+np.array(range(len(gp))[::-1]))
  *                     #vit_track_time.extend(range(len(gp))[::-1])
  *                     gpb = True             # <<<<<<<<<<<<<<
  *                 else:
  *                     gpb = False
  */
         __pyx_v_gpb = 1;
 
-        /* "soapcw/soapcw.pyx":1458
+        /* "soapcw/soapcw.pyx":1515
  *                     vit_track_time.extend(starts[v][::-1])
  *                 st = vit_track[-1]
  *                 if v-1 >= 0:             # <<<<<<<<<<<<<<
  *                     gp = gappaths[v-1][st][::-1]
  *                     vit_track.extend(gp)
  */
         goto __pyx_L7;
       }
 
-      /* "soapcw/soapcw.pyx":1465
+      /* "soapcw/soapcw.pyx":1522
  *                     gpb = True
  *                 else:
  *                     gpb = False             # <<<<<<<<<<<<<<
  *         else:
  *             vit_track = vit[0].vit_track
  */
       /*else*/ {
         __pyx_v_gpb = 0;
       }
       __pyx_L7:;
 
-      /* "soapcw/soapcw.pyx":1448
+      /* "soapcw/soapcw.pyx":1505
  *         gp = None
  *         if len(starts) > 1:
  *             for v in range(len(starts))[::-1]:             # <<<<<<<<<<<<<<
  *                 if gpb:
  *                     p1 = self.find_path(vit[v].prev,int(vit_track[-1]))[::-1]
  */
     }
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-    /* "soapcw/soapcw.pyx":1447
+    /* "soapcw/soapcw.pyx":1504
  *         gpb = False
  *         gp = None
  *         if len(starts) > 1:             # <<<<<<<<<<<<<<
  *             for v in range(len(starts))[::-1]:
  *                 if gpb:
  */
     goto __pyx_L3;
   }
 
-  /* "soapcw/soapcw.pyx":1467
+  /* "soapcw/soapcw.pyx":1524
  *                     gpb = False
  *         else:
  *             vit_track = vit[0].vit_track             # <<<<<<<<<<<<<<
  *         return vit_track[::-1], vit_track_time[::-1]
  * 
  */
   /*else*/ {
-    __pyx_t_4 = __Pyx_GetItemInt(__pyx_v_vit, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1467, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_GetItemInt(__pyx_v_vit, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1524, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_vit_track); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1467, __pyx_L1_error)
+    __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_vit_track); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1524, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_11);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_DECREF_SET(__pyx_v_vit_track, __pyx_t_11);
     __pyx_t_11 = 0;
   }
   __pyx_L3:;
 
-  /* "soapcw/soapcw.pyx":1468
+  /* "soapcw/soapcw.pyx":1525
  *         else:
  *             vit_track = vit[0].vit_track
  *         return vit_track[::-1], vit_track_time[::-1]             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_11 = __Pyx_PyObject_GetItem(__pyx_v_vit_track, __pyx_slice__9); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1468, __pyx_L1_error)
+  __pyx_t_11 = __Pyx_PyObject_GetItem(__pyx_v_vit_track, __pyx_slice__9); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1525, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_11);
-  __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_v_vit_track_time, __pyx_slice__9); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1468, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_v_vit_track_time, __pyx_slice__9); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1525, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1468, __pyx_L1_error)
+  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1525, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_11);
   PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_11);
   __Pyx_GIVEREF(__pyx_t_4);
   PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_4);
   __pyx_t_11 = 0;
   __pyx_t_4 = 0;
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "soapcw/soapcw.pyx":1442
+  /* "soapcw/soapcw.pyx":1499
  *         return vit,starts, gappaths
  * 
  *     def get_track(self,vit,starts,gappaths,tsft=1):             # <<<<<<<<<<<<<<
  *         vit_track = []
  *         vit_track_time = []
  */
 
@@ -36565,15 +36903,15 @@
  *     cdef _memoryviewslice memviewsliceobj
  * 
  *     assert memview.view.ndim > 0             # <<<<<<<<<<<<<<
  * 
  *     if isinstance(memview, _memoryviewslice):
  */
   #ifndef CYTHON_WITHOUT_ASSERTIONS
-  if (unlikely(!Py_OptimizeFlag)) {
+  if (unlikely(__pyx_assertions_enabled())) {
     if (unlikely(!((__pyx_v_memview->view.ndim > 0) != 0))) {
       PyErr_SetNone(PyExc_AssertionError);
       __PYX_ERR(1, 724, __pyx_L1_error)
     }
   }
   #endif
 
@@ -42503,15 +42841,15 @@
   Py_DECREF(o); o = 0;
   return NULL;
 }
 
 static void __pyx_tp_dealloc_array(PyObject *o) {
   struct __pyx_array_obj *p = (struct __pyx_array_obj *)o;
   #if CYTHON_USE_TP_FINALIZE
-  if (unlikely(PyType_HasFeature(Py_TYPE(o), Py_TPFLAGS_HAVE_FINALIZE) && Py_TYPE(o)->tp_finalize) && (!PyType_IS_GC(Py_TYPE(o)) || !_PyGC_FINALIZED(o))) {
+  if (unlikely(PyType_HasFeature(Py_TYPE(o), Py_TPFLAGS_HAVE_FINALIZE) && Py_TYPE(o)->tp_finalize) && (!PyType_IS_GC(Py_TYPE(o)) || !__Pyx_PyObject_GC_IsFinalized(o))) {
     if (PyObject_CallFinalizerFromDealloc(o)) return;
   }
   #endif
   {
     PyObject *etype, *eval, *etb;
     PyErr_Fetch(&etype, &eval, &etb);
     __Pyx_SET_REFCNT(o, Py_REFCNT(o) + 1);
@@ -42688,15 +43026,15 @@
   p->name = Py_None; Py_INCREF(Py_None);
   return o;
 }
 
 static void __pyx_tp_dealloc_Enum(PyObject *o) {
   struct __pyx_MemviewEnum_obj *p = (struct __pyx_MemviewEnum_obj *)o;
   #if CYTHON_USE_TP_FINALIZE
-  if (unlikely(PyType_HasFeature(Py_TYPE(o), Py_TPFLAGS_HAVE_FINALIZE) && Py_TYPE(o)->tp_finalize) && !_PyGC_FINALIZED(o)) {
+  if (unlikely(PyType_HasFeature(Py_TYPE(o), Py_TPFLAGS_HAVE_FINALIZE) && Py_TYPE(o)->tp_finalize) && !__Pyx_PyObject_GC_IsFinalized(o)) {
     if (PyObject_CallFinalizerFromDealloc(o)) return;
   }
   #endif
   PyObject_GC_UnTrack(o);
   Py_CLEAR(p->name);
   (*Py_TYPE(o)->tp_free)(o);
 }
@@ -42819,15 +43157,15 @@
   Py_DECREF(o); o = 0;
   return NULL;
 }
 
 static void __pyx_tp_dealloc_memoryview(PyObject *o) {
   struct __pyx_memoryview_obj *p = (struct __pyx_memoryview_obj *)o;
   #if CYTHON_USE_TP_FINALIZE
-  if (unlikely(PyType_HasFeature(Py_TYPE(o), Py_TPFLAGS_HAVE_FINALIZE) && Py_TYPE(o)->tp_finalize) && !_PyGC_FINALIZED(o)) {
+  if (unlikely(PyType_HasFeature(Py_TYPE(o), Py_TPFLAGS_HAVE_FINALIZE) && Py_TYPE(o)->tp_finalize) && !__Pyx_PyObject_GC_IsFinalized(o)) {
     if (PyObject_CallFinalizerFromDealloc(o)) return;
   }
   #endif
   PyObject_GC_UnTrack(o);
   {
     PyObject *etype, *eval, *etb;
     PyErr_Fetch(&etype, &eval, &etb);
@@ -43072,15 +43410,15 @@
   p->from_slice.memview = NULL;
   return o;
 }
 
 static void __pyx_tp_dealloc__memoryviewslice(PyObject *o) {
   struct __pyx_memoryviewslice_obj *p = (struct __pyx_memoryviewslice_obj *)o;
   #if CYTHON_USE_TP_FINALIZE
-  if (unlikely(PyType_HasFeature(Py_TYPE(o), Py_TPFLAGS_HAVE_FINALIZE) && Py_TYPE(o)->tp_finalize) && !_PyGC_FINALIZED(o)) {
+  if (unlikely(PyType_HasFeature(Py_TYPE(o), Py_TPFLAGS_HAVE_FINALIZE) && Py_TYPE(o)->tp_finalize) && !__Pyx_PyObject_GC_IsFinalized(o)) {
     if (PyObject_CallFinalizerFromDealloc(o)) return;
   }
   #endif
   PyObject_GC_UnTrack(o);
   {
     PyObject *etype, *eval, *etb;
     PyErr_Fetch(&etype, &eval, &etb);
@@ -43340,15 +43678,14 @@
   {&__pyx_n_s_exp, __pyx_k_exp, sizeof(__pyx_k_exp), 0, 0, 1, 1},
   {&__pyx_n_s_extend, __pyx_k_extend, sizeof(__pyx_k_extend), 0, 0, 1, 1},
   {&__pyx_n_s_f1, __pyx_k_f1, sizeof(__pyx_k_f1), 0, 0, 1, 1},
   {&__pyx_n_s_fact, __pyx_k_fact, sizeof(__pyx_k_fact), 0, 0, 1, 1},
   {&__pyx_n_s_fact_1d, __pyx_k_fact_1d, sizeof(__pyx_k_fact_1d), 0, 0, 1, 1},
   {&__pyx_n_s_fact_2d, __pyx_k_fact_2d, sizeof(__pyx_k_fact_2d), 0, 0, 1, 1},
   {&__pyx_n_s_fact_frac, __pyx_k_fact_frac, sizeof(__pyx_k_fact_frac), 0, 0, 1, 1},
-  {&__pyx_n_s_filename, __pyx_k_filename, sizeof(__pyx_k_filename), 0, 0, 1, 1},
   {&__pyx_n_s_find_path, __pyx_k_find_path, sizeof(__pyx_k_find_path), 0, 0, 1, 1},
   {&__pyx_n_s_flags, __pyx_k_flags, sizeof(__pyx_k_flags), 0, 0, 1, 1},
   {&__pyx_n_s_floor, __pyx_k_floor, sizeof(__pyx_k_floor), 0, 0, 1, 1},
   {&__pyx_n_s_flush, __pyx_k_flush, sizeof(__pyx_k_flush), 0, 0, 1, 1},
   {&__pyx_n_s_format, __pyx_k_format, sizeof(__pyx_k_format), 0, 0, 1, 1},
   {&__pyx_n_s_fortran, __pyx_k_fortran, sizeof(__pyx_k_fortran), 0, 0, 1, 1},
   {&__pyx_n_u_fortran, __pyx_k_fortran, sizeof(__pyx_k_fortran), 0, 1, 0, 1},
@@ -43397,17 +43734,17 @@
   {&__pyx_n_s_load, __pyx_k_load, sizeof(__pyx_k_load), 0, 0, 1, 1},
   {&__pyx_n_s_log, __pyx_k_log, sizeof(__pyx_k_log), 0, 0, 1, 1},
   {&__pyx_n_s_logarr, __pyx_k_logarr, sizeof(__pyx_k_logarr), 0, 0, 1, 1},
   {&__pyx_n_s_logarr1, __pyx_k_logarr1, sizeof(__pyx_k_logarr1), 0, 0, 1, 1},
   {&__pyx_n_s_logarr_1d, __pyx_k_logarr_1d, sizeof(__pyx_k_logarr_1d), 0, 0, 1, 1},
   {&__pyx_n_s_logarr_2d, __pyx_k_logarr_2d, sizeof(__pyx_k_logarr_2d), 0, 0, 1, 1},
   {&__pyx_n_s_logsumexp, __pyx_k_logsumexp, sizeof(__pyx_k_logsumexp), 0, 0, 1, 1},
-  {&__pyx_n_s_lookup_file, __pyx_k_lookup_file, sizeof(__pyx_k_lookup_file), 0, 0, 1, 1},
-  {&__pyx_n_s_lookup_file_1det, __pyx_k_lookup_file_1det, sizeof(__pyx_k_lookup_file_1det), 0, 0, 1, 1},
-  {&__pyx_n_s_lookup_file_2det, __pyx_k_lookup_file_2det, sizeof(__pyx_k_lookup_file_2det), 0, 0, 1, 1},
+  {&__pyx_n_s_lookup_table, __pyx_k_lookup_table, sizeof(__pyx_k_lookup_table), 0, 0, 1, 1},
+  {&__pyx_n_s_lookup_table_1det, __pyx_k_lookup_table_1det, sizeof(__pyx_k_lookup_table_1det), 0, 0, 1, 1},
+  {&__pyx_n_s_lookup_table_2det, __pyx_k_lookup_table_2det, sizeof(__pyx_k_lookup_table_2det), 0, 0, 1, 1},
   {&__pyx_n_s_low, __pyx_k_low, sizeof(__pyx_k_low), 0, 0, 1, 1},
   {&__pyx_n_s_m, __pyx_k_m, sizeof(__pyx_k_m), 0, 0, 1, 1},
   {&__pyx_n_s_main, __pyx_k_main, sizeof(__pyx_k_main), 0, 0, 1, 1},
   {&__pyx_n_s_make_vitmap, __pyx_k_make_vitmap, sizeof(__pyx_k_make_vitmap), 0, 0, 1, 1},
   {&__pyx_n_s_max, __pyx_k_max, sizeof(__pyx_k_max), 0, 0, 1, 1},
   {&__pyx_n_s_max_end_prob, __pyx_k_max_end_prob, sizeof(__pyx_k_max_end_prob), 0, 0, 1, 1},
   {&__pyx_n_s_max_paths, __pyx_k_max_paths, sizeof(__pyx_k_max_paths), 0, 0, 1, 1},
@@ -43476,14 +43813,15 @@
   {&__pyx_n_s_pbar, __pyx_k_pbar, sizeof(__pyx_k_pbar), 0, 0, 1, 1},
   {&__pyx_n_s_pickle, __pyx_k_pickle, sizeof(__pyx_k_pickle), 0, 0, 1, 1},
   {&__pyx_n_s_pos1, __pyx_k_pos1, sizeof(__pyx_k_pos1), 0, 0, 1, 1},
   {&__pyx_n_s_pos2, __pyx_k_pos2, sizeof(__pyx_k_pos2), 0, 0, 1, 1},
   {&__pyx_n_s_pow_fact, __pyx_k_pow_fact, sizeof(__pyx_k_pow_fact), 0, 0, 1, 1},
   {&__pyx_n_s_pow_ranges, __pyx_k_pow_ranges, sizeof(__pyx_k_pow_ranges), 0, 0, 1, 1},
   {&__pyx_n_u_power_ranges, __pyx_k_power_ranges, sizeof(__pyx_k_power_ranges), 0, 1, 0, 1},
+  {&__pyx_n_s_powers, __pyx_k_powers, sizeof(__pyx_k_powers), 0, 0, 1, 1},
   {&__pyx_n_s_prepare, __pyx_k_prepare, sizeof(__pyx_k_prepare), 0, 0, 1, 1},
   {&__pyx_n_s_prev, __pyx_k_prev, sizeof(__pyx_k_prev), 0, 0, 1, 1},
   {&__pyx_n_s_previous, __pyx_k_previous, sizeof(__pyx_k_previous), 0, 0, 1, 1},
   {&__pyx_n_s_previous_1, __pyx_k_previous_1, sizeof(__pyx_k_previous_1), 0, 0, 1, 1},
   {&__pyx_n_s_previous_2, __pyx_k_previous_2, sizeof(__pyx_k_previous_2), 0, 0, 1, 1},
   {&__pyx_n_s_prod, __pyx_k_prod, sizeof(__pyx_k_prod), 0, 0, 1, 1},
   {&__pyx_n_s_product, __pyx_k_product, sizeof(__pyx_k_product), 0, 0, 1, 1},
@@ -43524,14 +43862,15 @@
   {&__pyx_n_s_sep_dist, __pyx_k_sep_dist, sizeof(__pyx_k_sep_dist), 0, 0, 1, 1},
   {&__pyx_n_s_sep_len, __pyx_k_sep_len, sizeof(__pyx_k_sep_len), 0, 0, 1, 1},
   {&__pyx_n_s_seq, __pyx_k_seq, sizeof(__pyx_k_seq), 0, 0, 1, 1},
   {&__pyx_n_s_setstate, __pyx_k_setstate, sizeof(__pyx_k_setstate), 0, 0, 1, 1},
   {&__pyx_n_s_setstate_cython, __pyx_k_setstate_cython, sizeof(__pyx_k_setstate_cython), 0, 0, 1, 1},
   {&__pyx_n_s_shape, __pyx_k_shape, sizeof(__pyx_k_shape), 0, 0, 1, 1},
   {&__pyx_n_s_shp, __pyx_k_shp, sizeof(__pyx_k_shp), 0, 0, 1, 1},
+  {&__pyx_n_s_signoiseline, __pyx_k_signoiseline, sizeof(__pyx_k_signoiseline), 0, 0, 1, 1},
   {&__pyx_n_s_single_detector, __pyx_k_single_detector, sizeof(__pyx_k_single_detector), 0, 0, 1, 1},
   {&__pyx_n_s_single_detector___init, __pyx_k_single_detector___init, sizeof(__pyx_k_single_detector___init), 0, 0, 1, 1},
   {&__pyx_n_s_single_detector_gaps, __pyx_k_single_detector_gaps, sizeof(__pyx_k_single_detector_gaps), 0, 0, 1, 1},
   {&__pyx_n_s_single_detector_gaps___init, __pyx_k_single_detector_gaps___init, sizeof(__pyx_k_single_detector_gaps___init), 0, 0, 1, 1},
   {&__pyx_n_s_single_detector_gaps_find_path, __pyx_k_single_detector_gaps_find_path, sizeof(__pyx_k_single_detector_gaps_find_path), 0, 0, 1, 1},
   {&__pyx_n_s_single_detector_gaps_gap_run, __pyx_k_single_detector_gaps_gap_run, sizeof(__pyx_k_single_detector_gaps_gap_run), 0, 0, 1, 1},
   {&__pyx_n_s_single_detector_gaps_get_track, __pyx_k_single_detector_gaps_get_track, sizeof(__pyx_k_single_detector_gaps_get_track), 0, 0, 1, 1},
@@ -43627,20 +43966,20 @@
   {&__pyx_n_s_write, __pyx_k_write, sizeof(__pyx_k_write), 0, 0, 1, 1},
   {&__pyx_n_s_x, __pyx_k_x, sizeof(__pyx_k_x), 0, 0, 1, 1},
   {&__pyx_n_s_zeros, __pyx_k_zeros, sizeof(__pyx_k_zeros), 0, 0, 1, 1},
   {0, 0, 0, 0, 0, 0, 0}
 };
 static CYTHON_SMALL_CODE int __Pyx_InitCachedBuiltins(void) {
   __pyx_builtin_object = __Pyx_GetBuiltinName(__pyx_n_s_object); if (!__pyx_builtin_object) __PYX_ERR(0, 14, __pyx_L1_error)
-  __pyx_builtin_open = __Pyx_GetBuiltinName(__pyx_n_s_open); if (!__pyx_builtin_open) __PYX_ERR(0, 64, __pyx_L1_error)
-  __pyx_builtin_range = __Pyx_GetBuiltinName(__pyx_n_s_range); if (!__pyx_builtin_range) __PYX_ERR(0, 139, __pyx_L1_error)
-  __pyx_builtin_round = __Pyx_GetBuiltinName(__pyx_n_s_round); if (!__pyx_builtin_round) __PYX_ERR(0, 165, __pyx_L1_error)
-  __pyx_builtin_max = __Pyx_GetBuiltinName(__pyx_n_s_max); if (!__pyx_builtin_max) __PYX_ERR(0, 169, __pyx_L1_error)
-  __pyx_builtin_sum = __Pyx_GetBuiltinName(__pyx_n_s_sum); if (!__pyx_builtin_sum) __PYX_ERR(0, 1303, __pyx_L1_error)
-  __pyx_builtin_enumerate = __Pyx_GetBuiltinName(__pyx_n_s_enumerate); if (!__pyx_builtin_enumerate) __PYX_ERR(0, 1371, __pyx_L1_error)
+  __pyx_builtin_open = __Pyx_GetBuiltinName(__pyx_n_s_open); if (!__pyx_builtin_open) __PYX_ERR(0, 65, __pyx_L1_error)
+  __pyx_builtin_range = __Pyx_GetBuiltinName(__pyx_n_s_range); if (!__pyx_builtin_range) __PYX_ERR(0, 146, __pyx_L1_error)
+  __pyx_builtin_round = __Pyx_GetBuiltinName(__pyx_n_s_round); if (!__pyx_builtin_round) __PYX_ERR(0, 172, __pyx_L1_error)
+  __pyx_builtin_max = __Pyx_GetBuiltinName(__pyx_n_s_max); if (!__pyx_builtin_max) __PYX_ERR(0, 176, __pyx_L1_error)
+  __pyx_builtin_sum = __Pyx_GetBuiltinName(__pyx_n_s_sum); if (!__pyx_builtin_sum) __PYX_ERR(0, 1360, __pyx_L1_error)
+  __pyx_builtin_enumerate = __Pyx_GetBuiltinName(__pyx_n_s_enumerate); if (!__pyx_builtin_enumerate) __PYX_ERR(0, 1428, __pyx_L1_error)
   __pyx_builtin_ValueError = __Pyx_GetBuiltinName(__pyx_n_s_ValueError); if (!__pyx_builtin_ValueError) __PYX_ERR(1, 134, __pyx_L1_error)
   __pyx_builtin_MemoryError = __Pyx_GetBuiltinName(__pyx_n_s_MemoryError); if (!__pyx_builtin_MemoryError) __PYX_ERR(1, 149, __pyx_L1_error)
   __pyx_builtin_TypeError = __Pyx_GetBuiltinName(__pyx_n_s_TypeError); if (!__pyx_builtin_TypeError) __PYX_ERR(1, 2, __pyx_L1_error)
   __pyx_builtin_Ellipsis = __Pyx_GetBuiltinName(__pyx_n_s_Ellipsis); if (!__pyx_builtin_Ellipsis) __PYX_ERR(1, 406, __pyx_L1_error)
   __pyx_builtin_id = __Pyx_GetBuiltinName(__pyx_n_s_id); if (!__pyx_builtin_id) __PYX_ERR(1, 615, __pyx_L1_error)
   __pyx_builtin_IndexError = __Pyx_GetBuiltinName(__pyx_n_s_IndexError); if (!__pyx_builtin_IndexError) __PYX_ERR(1, 834, __pyx_L1_error)
   return 0;
@@ -43664,94 +44003,94 @@
   __Pyx_GIVEREF(__pyx_tuple_);
 
   /* "soapcw/soapcw.pyx":30
  *             raise Exception("transition matrix wrong shape, should be Kx1 array")
  *         if len(np.shape(obs)) != 2:
  *             raise Exception("observation wrong shape, should be NxM array")             # <<<<<<<<<<<<<<
  * 
- *         self.run(tr, obs, lookup_file)
+ *         self.run(tr, obs, lookup_table)
  */
   __pyx_tuple__2 = PyTuple_Pack(1, __pyx_kp_u_observation_wrong_shape_should_b); if (unlikely(!__pyx_tuple__2)) __PYX_ERR(0, 30, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__2);
   __Pyx_GIVEREF(__pyx_tuple__2);
 
-  /* "soapcw/soapcw.pyx":64
- *         Read the lookup table for chosen statistic
+  /* "soapcw/soapcw.pyx":65
  *         """
- *         with open(filename,'rb') as f1:             # <<<<<<<<<<<<<<
- *             likelihood, params = pickle.load(f1)
- *         ranges = np.linspace(params["power_ranges"][0],params["power_ranges"][1],int(params["power_ranges"][2]))
+ *         if isinstance(lookup_table, str):
+ *             with open(lookup_table,'rb') as f1:             # <<<<<<<<<<<<<<
+ *                 likelihood, params = pickle.load(f1)
+ *             ranges = np.linspace(params["power_ranges"][0],params["power_ranges"][1],int(params["power_ranges"][2]))
  */
-  __pyx_tuple__3 = PyTuple_Pack(3, Py_None, Py_None, Py_None); if (unlikely(!__pyx_tuple__3)) __PYX_ERR(0, 64, __pyx_L1_error)
+  __pyx_tuple__3 = PyTuple_Pack(3, Py_None, Py_None, Py_None); if (unlikely(!__pyx_tuple__3)) __PYX_ERR(0, 65, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__3);
   __Pyx_GIVEREF(__pyx_tuple__3);
 
-  /* "soapcw/soapcw.pyx":231
+  /* "soapcw/soapcw.pyx":238
  * 
  *         if len(np.shape(obs1)) < 2 or len(np.shape(obs1)) < 2:
  *             raise Exception("Please input 2D array for observation data")             # <<<<<<<<<<<<<<
  *         if np.shape(obs1) != np.shape(obs2):
  *             raise Exception("Please make sure teh two input data have the same dimensions")
  */
-  __pyx_tuple__5 = PyTuple_Pack(1, __pyx_kp_u_Please_input_2D_array_for_observ); if (unlikely(!__pyx_tuple__5)) __PYX_ERR(0, 231, __pyx_L1_error)
+  __pyx_tuple__5 = PyTuple_Pack(1, __pyx_kp_u_Please_input_2D_array_for_observ); if (unlikely(!__pyx_tuple__5)) __PYX_ERR(0, 238, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__5);
   __Pyx_GIVEREF(__pyx_tuple__5);
 
-  /* "soapcw/soapcw.pyx":233
+  /* "soapcw/soapcw.pyx":240
  *             raise Exception("Please input 2D array for observation data")
  *         if np.shape(obs1) != np.shape(obs2):
  *             raise Exception("Please make sure teh two input data have the same dimensions")             # <<<<<<<<<<<<<<
  * 
  *         tr = np.array(tr).astype('double')
  */
-  __pyx_tuple__6 = PyTuple_Pack(1, __pyx_kp_u_Please_make_sure_teh_two_input_d); if (unlikely(!__pyx_tuple__6)) __PYX_ERR(0, 233, __pyx_L1_error)
+  __pyx_tuple__6 = PyTuple_Pack(1, __pyx_kp_u_Please_make_sure_teh_two_input_d); if (unlikely(!__pyx_tuple__6)) __PYX_ERR(0, 240, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__6);
   __Pyx_GIVEREF(__pyx_tuple__6);
 
-  /* "soapcw/soapcw.pyx":953
+  /* "soapcw/soapcw.pyx":1010
  * 
  *         if len(np.shape(tr))<=1:
  *             raise Exception("ERROR: Please use a transition matrix with dimensions larger than one")             # <<<<<<<<<<<<<<
  * 
  *         #np.insert(obs,0,-1e6,axis=1)
  */
-  __pyx_tuple__7 = PyTuple_Pack(1, __pyx_kp_u_ERROR_Please_use_a_transition_ma); if (unlikely(!__pyx_tuple__7)) __PYX_ERR(0, 953, __pyx_L1_error)
+  __pyx_tuple__7 = PyTuple_Pack(1, __pyx_kp_u_ERROR_Please_use_a_transition_ma); if (unlikely(!__pyx_tuple__7)) __PYX_ERR(0, 1010, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__7);
   __Pyx_GIVEREF(__pyx_tuple__7);
 
-  /* "soapcw/soapcw.pyx":1013
+  /* "soapcw/soapcw.pyx":1070
  *                         temp = -1e6
  *                         for k in range(n):
  *                             m = list(j[1:])             # <<<<<<<<<<<<<<
  *                             m.append(k)
  *                             if t<length:
  */
-  __pyx_slice__8 = PySlice_New(__pyx_int_1, Py_None, Py_None); if (unlikely(!__pyx_slice__8)) __PYX_ERR(0, 1013, __pyx_L1_error)
+  __pyx_slice__8 = PySlice_New(__pyx_int_1, Py_None, Py_None); if (unlikely(!__pyx_slice__8)) __PYX_ERR(0, 1070, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_slice__8);
   __Pyx_GIVEREF(__pyx_slice__8);
 
-  /* "soapcw/soapcw.pyx":1060
+  /* "soapcw/soapcw.pyx":1117
  *             previous_2 = prev[t][previous][previous_1]
  * 
  *         vit_track = vit_track[::-1]             # <<<<<<<<<<<<<<
  * 
  *         self.vit_track = np.array(vit_track)
  */
-  __pyx_slice__9 = PySlice_New(Py_None, Py_None, __pyx_int_neg_1); if (unlikely(!__pyx_slice__9)) __PYX_ERR(0, 1060, __pyx_L1_error)
+  __pyx_slice__9 = PySlice_New(Py_None, Py_None, __pyx_int_neg_1); if (unlikely(!__pyx_slice__9)) __PYX_ERR(0, 1117, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_slice__9);
   __Pyx_GIVEREF(__pyx_slice__9);
 
-  /* "soapcw/soapcw.pyx":1306
+  /* "soapcw/soapcw.pyx":1363
  *                 l = len(np.where(np.array(seq) == 0)[0])
  *                 if s > thresh:
  *                     max_seq = np.insert(abspath,0,ind)[:-1]             # <<<<<<<<<<<<<<
  *                     thresh = s
  *                 elif s == thresh and l > thresh2:
  */
-  __pyx_slice__10 = PySlice_New(Py_None, __pyx_int_neg_1, Py_None); if (unlikely(!__pyx_slice__10)) __PYX_ERR(0, 1306, __pyx_L1_error)
+  __pyx_slice__10 = PySlice_New(Py_None, __pyx_int_neg_1, Py_None); if (unlikely(!__pyx_slice__10)) __PYX_ERR(0, 1363, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_slice__10);
   __Pyx_GIVEREF(__pyx_slice__10);
 
   /* "View.MemoryView":134
  * 
  *         if not self.ndim:
  *             raise ValueError("Empty shape tuple for cython.array")             # <<<<<<<<<<<<<<
@@ -43947,28 +44286,28 @@
   __Pyx_GIVEREF(__pyx_tuple__29);
 
   /* "soapcw/soapcw.pyx":14
  * from scipy.special import logsumexp
  * 
  * class single_detector(object):             # <<<<<<<<<<<<<<
  * 
- *     def __init__(self, tr, obs, prog = False, lookup_file=None, make_vitmap = True):
+ *     def __init__(self, tr, obs, prog = False, lookup_table=None, make_vitmap = True):
  */
   __pyx_tuple__30 = PyTuple_Pack(1, __pyx_builtin_object); if (unlikely(!__pyx_tuple__30)) __PYX_ERR(0, 14, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__30);
   __Pyx_GIVEREF(__pyx_tuple__30);
 
   /* "soapcw/soapcw.pyx":16
  * class single_detector(object):
  * 
- *     def __init__(self, tr, obs, prog = False, lookup_file=None, make_vitmap = True):             # <<<<<<<<<<<<<<
+ *     def __init__(self, tr, obs, prog = False, lookup_table=None, make_vitmap = True):             # <<<<<<<<<<<<<<
  *         '''
  *         initialising viterbi class
  */
-  __pyx_tuple__31 = PyTuple_Pack(6, __pyx_n_s_self, __pyx_n_s_tr, __pyx_n_s_obs, __pyx_n_s_prog, __pyx_n_s_lookup_file, __pyx_n_s_make_vitmap); if (unlikely(!__pyx_tuple__31)) __PYX_ERR(0, 16, __pyx_L1_error)
+  __pyx_tuple__31 = PyTuple_Pack(6, __pyx_n_s_self, __pyx_n_s_tr, __pyx_n_s_obs, __pyx_n_s_prog, __pyx_n_s_lookup_table, __pyx_n_s_make_vitmap); if (unlikely(!__pyx_tuple__31)) __PYX_ERR(0, 16, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__31);
   __Pyx_GIVEREF(__pyx_tuple__31);
   __pyx_codeobj__32 = (PyObject*)__Pyx_PyCode_New(6, 0, 6, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__31, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_soapcw_soapcw_pyx, __pyx_n_s_init, 16, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__32)) __PYX_ERR(0, 16, __pyx_L1_error)
   __pyx_tuple__33 = PyTuple_Pack(3, ((PyObject *)Py_False), ((PyObject *)Py_None), ((PyObject *)Py_True)); if (unlikely(!__pyx_tuple__33)) __PYX_ERR(0, 16, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__33);
   __Pyx_GIVEREF(__pyx_tuple__33);
 
@@ -43986,342 +44325,342 @@
   __pyx_tuple__36 = PyTuple_Pack(1, ((PyObject *)Py_False)); if (unlikely(!__pyx_tuple__36)) __PYX_ERR(0, 41, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__36);
   __Pyx_GIVEREF(__pyx_tuple__36);
 
   /* "soapcw/soapcw.pyx":60
  *     #--------------------------
  * 
- *     def read_lookup(self,filename):             # <<<<<<<<<<<<<<
+ *     def read_lookup(self,lookup_table):             # <<<<<<<<<<<<<<
  *         """
  *         Read the lookup table for chosen statistic
  */
-  __pyx_tuple__37 = PyTuple_Pack(7, __pyx_n_s_self, __pyx_n_s_filename, __pyx_n_s_f1, __pyx_n_s_likelihood, __pyx_n_s_params, __pyx_n_s_ranges, __pyx_n_s_fact); if (unlikely(!__pyx_tuple__37)) __PYX_ERR(0, 60, __pyx_L1_error)
+  __pyx_tuple__37 = PyTuple_Pack(7, __pyx_n_s_self, __pyx_n_s_lookup_table, __pyx_n_s_f1, __pyx_n_s_likelihood, __pyx_n_s_params, __pyx_n_s_ranges, __pyx_n_s_fact); if (unlikely(!__pyx_tuple__37)) __PYX_ERR(0, 60, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__37);
   __Pyx_GIVEREF(__pyx_tuple__37);
   __pyx_codeobj__38 = (PyObject*)__Pyx_PyCode_New(2, 0, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__37, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_soapcw_soapcw_pyx, __pyx_n_s_read_lookup, 60, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__38)) __PYX_ERR(0, 60, __pyx_L1_error)
 
-  /* "soapcw/soapcw.pyx":77
+  /* "soapcw/soapcw.pyx":84
  * 
  * 
- *     def run(self,double[:] tr, double[:, :] obs, lookup_file = None):             # <<<<<<<<<<<<<<
+ *     def run(self,double[:] tr, double[:, :] obs, lookup_table = None):             # <<<<<<<<<<<<<<
  *         '''
  *         Run the viterbi algorithm for given single set of data and 3x1 transition matrix.
  */
-  __pyx_tuple__39 = PyTuple_Pack(29, __pyx_n_s_self, __pyx_n_s_tr, __pyx_n_s_obs, __pyx_n_s_lookup_file, __pyx_n_s_shape, __pyx_n_s_V, __pyx_n_s_prev, __pyx_n_s_t, __pyx_n_s_i, __pyx_n_s_j, __pyx_n_s_pbar, __pyx_n_s_pt, __pyx_n_s_length, __pyx_n_s_width, __pyx_n_s_tr_length, __pyx_n_s_tr_width, __pyx_n_s_logarr, __pyx_n_s_fact, __pyx_n_s_obs_ind, __pyx_n_s_ranges, __pyx_n_s_obs_ind_arr, __pyx_n_s_temp, __pyx_n_s_o, __pyx_n_s_value, __pyx_n_s_max_end_prob, __pyx_n_s_previous, __pyx_n_s_vit_track, __pyx_n_s_genexpr, __pyx_n_s_genexpr); if (unlikely(!__pyx_tuple__39)) __PYX_ERR(0, 77, __pyx_L1_error)
+  __pyx_tuple__39 = PyTuple_Pack(29, __pyx_n_s_self, __pyx_n_s_tr, __pyx_n_s_obs, __pyx_n_s_lookup_table, __pyx_n_s_shape, __pyx_n_s_V, __pyx_n_s_prev, __pyx_n_s_t, __pyx_n_s_i, __pyx_n_s_j, __pyx_n_s_pbar, __pyx_n_s_pt, __pyx_n_s_length, __pyx_n_s_width, __pyx_n_s_tr_length, __pyx_n_s_tr_width, __pyx_n_s_logarr, __pyx_n_s_fact, __pyx_n_s_obs_ind, __pyx_n_s_ranges, __pyx_n_s_obs_ind_arr, __pyx_n_s_temp, __pyx_n_s_o, __pyx_n_s_value, __pyx_n_s_max_end_prob, __pyx_n_s_previous, __pyx_n_s_vit_track, __pyx_n_s_genexpr, __pyx_n_s_genexpr); if (unlikely(!__pyx_tuple__39)) __PYX_ERR(0, 84, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__39);
   __Pyx_GIVEREF(__pyx_tuple__39);
-  __pyx_codeobj__40 = (PyObject*)__Pyx_PyCode_New(4, 0, 29, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__39, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_soapcw_soapcw_pyx, __pyx_n_s_run, 77, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__40)) __PYX_ERR(0, 77, __pyx_L1_error)
-  __pyx_tuple__41 = PyTuple_Pack(1, ((PyObject *)Py_None)); if (unlikely(!__pyx_tuple__41)) __PYX_ERR(0, 77, __pyx_L1_error)
+  __pyx_codeobj__40 = (PyObject*)__Pyx_PyCode_New(4, 0, 29, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__39, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_soapcw_soapcw_pyx, __pyx_n_s_run, 84, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__40)) __PYX_ERR(0, 84, __pyx_L1_error)
+  __pyx_tuple__41 = PyTuple_Pack(1, ((PyObject *)Py_None)); if (unlikely(!__pyx_tuple__41)) __PYX_ERR(0, 84, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__41);
   __Pyx_GIVEREF(__pyx_tuple__41);
 
-  /* "soapcw/soapcw.pyx":190
+  /* "soapcw/soapcw.pyx":197
  * 
  * 
  * class two_detector(object):             # <<<<<<<<<<<<<<
  * 
- *     def __init__(self, tr, obs1, obs2, lookup_file_2det = None, lookup_file_1det = None, prog = False,fractions=None, make_vitmap=True):
+ *     def __init__(self, tr, obs1, obs2, lookup_table_2det = None, lookup_table_1det = None, prog = False,fractions=None, make_vitmap=True):
  */
-  __pyx_tuple__42 = PyTuple_Pack(1, __pyx_builtin_object); if (unlikely(!__pyx_tuple__42)) __PYX_ERR(0, 190, __pyx_L1_error)
+  __pyx_tuple__42 = PyTuple_Pack(1, __pyx_builtin_object); if (unlikely(!__pyx_tuple__42)) __PYX_ERR(0, 197, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__42);
   __Pyx_GIVEREF(__pyx_tuple__42);
 
-  /* "soapcw/soapcw.pyx":192
+  /* "soapcw/soapcw.pyx":199
  * class two_detector(object):
  * 
- *     def __init__(self, tr, obs1, obs2, lookup_file_2det = None, lookup_file_1det = None, prog = False,fractions=None, make_vitmap=True):             # <<<<<<<<<<<<<<
+ *     def __init__(self, tr, obs1, obs2, lookup_table_2det = None, lookup_table_1det = None, prog = False,fractions=None, make_vitmap=True):             # <<<<<<<<<<<<<<
  *         '''
  *         viterbi algorithm for two detectors with an optional line aware statistic
  */
-  __pyx_tuple__43 = PyTuple_Pack(9, __pyx_n_s_self, __pyx_n_s_tr, __pyx_n_s_obs1, __pyx_n_s_obs2, __pyx_n_s_lookup_file_2det, __pyx_n_s_lookup_file_1det, __pyx_n_s_prog, __pyx_n_s_fractions, __pyx_n_s_make_vitmap); if (unlikely(!__pyx_tuple__43)) __PYX_ERR(0, 192, __pyx_L1_error)
+  __pyx_tuple__43 = PyTuple_Pack(9, __pyx_n_s_self, __pyx_n_s_tr, __pyx_n_s_obs1, __pyx_n_s_obs2, __pyx_n_s_lookup_table_2det, __pyx_n_s_lookup_table_1det, __pyx_n_s_prog, __pyx_n_s_fractions, __pyx_n_s_make_vitmap); if (unlikely(!__pyx_tuple__43)) __PYX_ERR(0, 199, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__43);
   __Pyx_GIVEREF(__pyx_tuple__43);
-  __pyx_codeobj__44 = (PyObject*)__Pyx_PyCode_New(9, 0, 9, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__43, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_soapcw_soapcw_pyx, __pyx_n_s_init, 192, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__44)) __PYX_ERR(0, 192, __pyx_L1_error)
-  __pyx_tuple__45 = PyTuple_Pack(5, ((PyObject *)Py_None), ((PyObject *)Py_None), ((PyObject *)Py_False), ((PyObject *)Py_None), ((PyObject *)Py_True)); if (unlikely(!__pyx_tuple__45)) __PYX_ERR(0, 192, __pyx_L1_error)
+  __pyx_codeobj__44 = (PyObject*)__Pyx_PyCode_New(9, 0, 9, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__43, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_soapcw_soapcw_pyx, __pyx_n_s_init, 199, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__44)) __PYX_ERR(0, 199, __pyx_L1_error)
+  __pyx_tuple__45 = PyTuple_Pack(5, ((PyObject *)Py_None), ((PyObject *)Py_None), ((PyObject *)Py_False), ((PyObject *)Py_None), ((PyObject *)Py_True)); if (unlikely(!__pyx_tuple__45)) __PYX_ERR(0, 199, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__45);
   __Pyx_GIVEREF(__pyx_tuple__45);
 
-  /* "soapcw/soapcw.pyx":253
+  /* "soapcw/soapcw.pyx":260
  *     #------------------------------------------------------------------------------------------------
  * 
  *     def get_vitmap(self,log=False):             # <<<<<<<<<<<<<<
  *         """
  *         normalise the viterbi output such that the sum of eah column is 1
  */
-  __pyx_tuple__46 = PyTuple_Pack(6, __pyx_n_s_self, __pyx_n_s_log, __pyx_n_s_path_m, __pyx_n_s_i, __pyx_n_s_sump, __pyx_n_s_val); if (unlikely(!__pyx_tuple__46)) __PYX_ERR(0, 253, __pyx_L1_error)
+  __pyx_tuple__46 = PyTuple_Pack(6, __pyx_n_s_self, __pyx_n_s_log, __pyx_n_s_path_m, __pyx_n_s_i, __pyx_n_s_sump, __pyx_n_s_val); if (unlikely(!__pyx_tuple__46)) __PYX_ERR(0, 260, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__46);
   __Pyx_GIVEREF(__pyx_tuple__46);
-  __pyx_codeobj__47 = (PyObject*)__Pyx_PyCode_New(2, 0, 6, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__46, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_soapcw_soapcw_pyx, __pyx_n_s_get_vitmap, 253, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__47)) __PYX_ERR(0, 253, __pyx_L1_error)
-  __pyx_tuple__48 = PyTuple_Pack(1, ((PyObject *)Py_False)); if (unlikely(!__pyx_tuple__48)) __PYX_ERR(0, 253, __pyx_L1_error)
+  __pyx_codeobj__47 = (PyObject*)__Pyx_PyCode_New(2, 0, 6, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__46, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_soapcw_soapcw_pyx, __pyx_n_s_get_vitmap, 260, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__47)) __PYX_ERR(0, 260, __pyx_L1_error)
+  __pyx_tuple__48 = PyTuple_Pack(1, ((PyObject *)Py_False)); if (unlikely(!__pyx_tuple__48)) __PYX_ERR(0, 260, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__48);
   __Pyx_GIVEREF(__pyx_tuple__48);
 
-  /* "soapcw/soapcw.pyx":273
+  /* "soapcw/soapcw.pyx":280
  *     #--------------------------------------------------------
  * 
- *     def read_lookup(self,filename):             # <<<<<<<<<<<<<<
- * 
- *         with open(filename,'rb') as f1:
+ *     def read_lookup(self,lookup_table):             # <<<<<<<<<<<<<<
+ *         """
+ *         Read a lookup table from a file of a LineAwareStatistic object
  */
-  __pyx_tuple__49 = PyTuple_Pack(7, __pyx_n_s_self, __pyx_n_s_filename, __pyx_n_s_f1, __pyx_n_s_likelihood, __pyx_n_s_params, __pyx_n_s_ranges, __pyx_n_s_fact); if (unlikely(!__pyx_tuple__49)) __PYX_ERR(0, 273, __pyx_L1_error)
+  __pyx_tuple__49 = PyTuple_Pack(7, __pyx_n_s_self, __pyx_n_s_lookup_table, __pyx_n_s_f1, __pyx_n_s_likelihood, __pyx_n_s_params, __pyx_n_s_ranges, __pyx_n_s_fact); if (unlikely(!__pyx_tuple__49)) __PYX_ERR(0, 280, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__49);
   __Pyx_GIVEREF(__pyx_tuple__49);
-  __pyx_codeobj__50 = (PyObject*)__Pyx_PyCode_New(2, 0, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__49, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_soapcw_soapcw_pyx, __pyx_n_s_read_lookup, 273, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__50)) __PYX_ERR(0, 273, __pyx_L1_error)
+  __pyx_codeobj__50 = (PyObject*)__Pyx_PyCode_New(2, 0, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__49, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_soapcw_soapcw_pyx, __pyx_n_s_read_lookup, 280, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__50)) __PYX_ERR(0, 280, __pyx_L1_error)
 
-  /* "soapcw/soapcw.pyx":283
+  /* "soapcw/soapcw.pyx":313
  *         return likelihood, ranges, fact
  * 
- *     def read_lookup_amp(self,filename):             # <<<<<<<<<<<<<<
- * 
- *         with open(filename,'rb') as f1:
+ *     def read_lookup_amp(self,lookup_table):             # <<<<<<<<<<<<<<
+ *         """
+ *         Read a lookup table from a file of a LineAwareStatisticAmplitude object
  */
-  __pyx_tuple__51 = PyTuple_Pack(9, __pyx_n_s_self, __pyx_n_s_filename, __pyx_n_s_f1, __pyx_n_s_likelihood, __pyx_n_s_params, __pyx_n_s_pow_ranges, __pyx_n_s_frac_ranges, __pyx_n_s_pow_fact, __pyx_n_s_frac_fact); if (unlikely(!__pyx_tuple__51)) __PYX_ERR(0, 283, __pyx_L1_error)
+  __pyx_tuple__51 = PyTuple_Pack(9, __pyx_n_s_self, __pyx_n_s_lookup_table, __pyx_n_s_f1, __pyx_n_s_likelihood, __pyx_n_s_params, __pyx_n_s_pow_ranges, __pyx_n_s_frac_ranges, __pyx_n_s_pow_fact, __pyx_n_s_frac_fact); if (unlikely(!__pyx_tuple__51)) __PYX_ERR(0, 313, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__51);
   __Pyx_GIVEREF(__pyx_tuple__51);
-  __pyx_codeobj__52 = (PyObject*)__Pyx_PyCode_New(2, 0, 9, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__51, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_soapcw_soapcw_pyx, __pyx_n_s_read_lookup_amp, 283, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__52)) __PYX_ERR(0, 283, __pyx_L1_error)
+  __pyx_codeobj__52 = (PyObject*)__Pyx_PyCode_New(2, 0, 9, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__51, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_soapcw_soapcw_pyx, __pyx_n_s_read_lookup_amp, 313, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__52)) __PYX_ERR(0, 313, __pyx_L1_error)
 
-  /* "soapcw/soapcw.pyx":300
+  /* "soapcw/soapcw.pyx":357
  *     #--------------------------------------------------------
  * 
- *     def run(self,transition, obs1, obs2, lookup_file_1det = None,lookup_file_2det = None):             # <<<<<<<<<<<<<<
+ *     def run(self,transition, obs1, obs2, lookup_table_1det = None,lookup_table_2det = None):             # <<<<<<<<<<<<<<
  *         """
  *         viterbi algorithm for two detectors with an lookup table for the line veto statistic
  */
-  __pyx_tuple__53 = PyTuple_Pack(55, __pyx_n_s_self, __pyx_n_s_transition, __pyx_n_s_obs1, __pyx_n_s_obs2, __pyx_n_s_lookup_file_1det, __pyx_n_s_lookup_file_2det, __pyx_n_s_tr, __pyx_n_s_shape, __pyx_n_s_length, __pyx_n_s_width, __pyx_n_s_val, __pyx_n_s_prev, __pyx_n_s_det1, __pyx_n_s_det2, __pyx_n_s_tr_len, __pyx_n_s_sep_len, __pyx_n_s_tr_dist, __pyx_n_s_sep_dist, __pyx_n_s_i, __pyx_n_s_j, __pyx_n_s_k, __pyx_n_s_m, __pyx_n_s_t, __pyx_n_s_x, __pyx_n_s_o1, __pyx_n_s_o2, __pyx_n_s_max_pos, __pyx_n_s_indicies, __pyx_n_s_max_val, __pyx_n_s_value, __pyx_n_s_temp, __pyx_n_s_edge_range, __pyx_n_s_logarr_2d, __pyx_n_s_logarr_1d, __pyx_n_s_fact_1d, __pyx_n_s_fact_2d, __pyx_n_s_obs1_ind_1d, __pyx_n_s_obs1_ind_2d, __pyx_n_s_obs1data, __pyx_n_s_obs2data, __pyx_n_s_ranges_1d, __pyx_n_s_obs1_ind_arr_1d, __pyx_n_s_obs2_ind_arr_1d, __pyx_n_s_obs2_ind_1d, __pyx_n_s_logarr, __pyx_n_s_ranges_2d, __pyx_n_s_diag, __pyx_n_s_obs1_ind_arr_2d, __pyx_n_s_obs2_ind_arr_2d, __pyx_n_s_obs2_ind_2d, __pyx_n_s_sumv, __pyx_n_s_pbar, __pyx_n_s_pt, __pyx_n_s_obs1seg, __pyx_n_s_obs2seg); if (unlikely(!__pyx_tuple__53)) __PYX_ERR(0, 300, __pyx_L1_error)
+  __pyx_tuple__53 = PyTuple_Pack(55, __pyx_n_s_self, __pyx_n_s_transition, __pyx_n_s_obs1, __pyx_n_s_obs2, __pyx_n_s_lookup_table_1det, __pyx_n_s_lookup_table_2det, __pyx_n_s_tr, __pyx_n_s_shape, __pyx_n_s_length, __pyx_n_s_width, __pyx_n_s_val, __pyx_n_s_prev, __pyx_n_s_det1, __pyx_n_s_det2, __pyx_n_s_tr_len, __pyx_n_s_sep_len, __pyx_n_s_tr_dist, __pyx_n_s_sep_dist, __pyx_n_s_i, __pyx_n_s_j, __pyx_n_s_k, __pyx_n_s_m, __pyx_n_s_t, __pyx_n_s_x, __pyx_n_s_o1, __pyx_n_s_o2, __pyx_n_s_max_pos, __pyx_n_s_indicies, __pyx_n_s_max_val, __pyx_n_s_value, __pyx_n_s_temp, __pyx_n_s_edge_range, __pyx_n_s_logarr_2d, __pyx_n_s_logarr_1d, __pyx_n_s_fact_1d, __pyx_n_s_fact_2d, __pyx_n_s_obs1_ind_1d, __pyx_n_s_obs1_ind_2d, __pyx_n_s_obs1data, __pyx_n_s_obs2data, __pyx_n_s_ranges_1d, __pyx_n_s_obs1_ind_arr_1d, __pyx_n_s_obs2_ind_arr_1d, __pyx_n_s_obs2_ind_1d, __pyx_n_s_logarr, __pyx_n_s_ranges_2d, __pyx_n_s_diag, __pyx_n_s_obs1_ind_arr_2d, __pyx_n_s_obs2_ind_arr_2d, __pyx_n_s_obs2_ind_2d, __pyx_n_s_sumv, __pyx_n_s_pbar, __pyx_n_s_pt, __pyx_n_s_obs1seg, __pyx_n_s_obs2seg); if (unlikely(!__pyx_tuple__53)) __PYX_ERR(0, 357, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__53);
   __Pyx_GIVEREF(__pyx_tuple__53);
-  __pyx_codeobj__54 = (PyObject*)__Pyx_PyCode_New(6, 0, 55, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__53, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_soapcw_soapcw_pyx, __pyx_n_s_run, 300, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__54)) __PYX_ERR(0, 300, __pyx_L1_error)
-  __pyx_tuple__55 = PyTuple_Pack(2, ((PyObject *)Py_None), ((PyObject *)Py_None)); if (unlikely(!__pyx_tuple__55)) __PYX_ERR(0, 300, __pyx_L1_error)
+  __pyx_codeobj__54 = (PyObject*)__Pyx_PyCode_New(6, 0, 55, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__53, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_soapcw_soapcw_pyx, __pyx_n_s_run, 357, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__54)) __PYX_ERR(0, 357, __pyx_L1_error)
+  __pyx_tuple__55 = PyTuple_Pack(2, ((PyObject *)Py_None), ((PyObject *)Py_None)); if (unlikely(!__pyx_tuple__55)) __PYX_ERR(0, 357, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__55);
   __Pyx_GIVEREF(__pyx_tuple__55);
 
-  /* "soapcw/soapcw.pyx":542
+  /* "soapcw/soapcw.pyx":599
  *         self.length = length
  * 
- *     def run_lookup_amp(self,tr1, obs11, obs21,lookup_file = None, fractions = None):             # <<<<<<<<<<<<<<
+ *     def run_lookup_amp(self,tr1, obs11, obs21,lookup_table = None, fractions = None):             # <<<<<<<<<<<<<<
  *         """
  *         viterbi algorithm for two detectors with an lookup table for the line veto statistic
  */
-  __pyx_tuple__56 = PyTuple_Pack(56, __pyx_n_s_self, __pyx_n_s_tr1, __pyx_n_s_obs11, __pyx_n_s_obs21, __pyx_n_s_lookup_file, __pyx_n_s_fractions, __pyx_n_s_tr, __pyx_n_s_obs1, __pyx_n_s_obs2, __pyx_n_s_shape, __pyx_n_s_length, __pyx_n_s_width, __pyx_n_s_val, __pyx_n_s_prev, __pyx_n_s_det1, __pyx_n_s_det2, __pyx_n_s_tr_len, __pyx_n_s_sep_len, __pyx_n_s_tr_dist, __pyx_n_s_sep_dist, __pyx_n_s_i, __pyx_n_s_j, __pyx_n_s_k, __pyx_n_s_m, __pyx_n_s_t, __pyx_n_s_x, __pyx_n_s_o1, __pyx_n_s_o2, __pyx_n_s_max_pos, __pyx_n_s_indicies, __pyx_n_s_max_val, __pyx_n_s_value, __pyx_n_s_temp, __pyx_n_s_edge_range, __pyx_n_s_fact, __pyx_n_s_fact_frac, __pyx_n_s_likelihood, __pyx_n_s_pow_ranges, __pyx_n_s_frac_ranges, __pyx_n_s_pow_fact, __pyx_n_s_frac_fact, __pyx_n_s_shp, __pyx_n_s_logarr1, __pyx_n_s_logarr, __pyx_n_s_det_order1, __pyx_n_s_det_order, __pyx_n_s_frac_ind1, __pyx_n_s_frac_ind, __pyx_n_s_obs1_ind_arr, __pyx_n_s_obs1_ind, __pyx_n_s_obs2_ind_arr, __pyx_n_s_obs2_ind, __pyx_n_s_pbar, __pyx_n_s_pt, __pyx_n_s_lkl, __pyx_n_s_i); if (unlikely(!__pyx_tuple__56)) __PYX_ERR(0, 542, __pyx_L1_error)
+  __pyx_tuple__56 = PyTuple_Pack(56, __pyx_n_s_self, __pyx_n_s_tr1, __pyx_n_s_obs11, __pyx_n_s_obs21, __pyx_n_s_lookup_table, __pyx_n_s_fractions, __pyx_n_s_tr, __pyx_n_s_obs1, __pyx_n_s_obs2, __pyx_n_s_shape, __pyx_n_s_length, __pyx_n_s_width, __pyx_n_s_val, __pyx_n_s_prev, __pyx_n_s_det1, __pyx_n_s_det2, __pyx_n_s_tr_len, __pyx_n_s_sep_len, __pyx_n_s_tr_dist, __pyx_n_s_sep_dist, __pyx_n_s_i, __pyx_n_s_j, __pyx_n_s_k, __pyx_n_s_m, __pyx_n_s_t, __pyx_n_s_x, __pyx_n_s_o1, __pyx_n_s_o2, __pyx_n_s_max_pos, __pyx_n_s_indicies, __pyx_n_s_max_val, __pyx_n_s_value, __pyx_n_s_temp, __pyx_n_s_edge_range, __pyx_n_s_fact, __pyx_n_s_fact_frac, __pyx_n_s_likelihood, __pyx_n_s_pow_ranges, __pyx_n_s_frac_ranges, __pyx_n_s_pow_fact, __pyx_n_s_frac_fact, __pyx_n_s_shp, __pyx_n_s_logarr1, __pyx_n_s_logarr, __pyx_n_s_det_order1, __pyx_n_s_det_order, __pyx_n_s_frac_ind1, __pyx_n_s_frac_ind, __pyx_n_s_obs1_ind_arr, __pyx_n_s_obs1_ind, __pyx_n_s_obs2_ind_arr, __pyx_n_s_obs2_ind, __pyx_n_s_pbar, __pyx_n_s_pt, __pyx_n_s_lkl, __pyx_n_s_i); if (unlikely(!__pyx_tuple__56)) __PYX_ERR(0, 599, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__56);
   __Pyx_GIVEREF(__pyx_tuple__56);
-  __pyx_codeobj__57 = (PyObject*)__Pyx_PyCode_New(6, 0, 56, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__56, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_soapcw_soapcw_pyx, __pyx_n_s_run_lookup_amp, 542, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__57)) __PYX_ERR(0, 542, __pyx_L1_error)
-  __pyx_tuple__58 = PyTuple_Pack(2, ((PyObject *)Py_None), ((PyObject *)Py_None)); if (unlikely(!__pyx_tuple__58)) __PYX_ERR(0, 542, __pyx_L1_error)
+  __pyx_codeobj__57 = (PyObject*)__Pyx_PyCode_New(6, 0, 56, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__56, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_soapcw_soapcw_pyx, __pyx_n_s_run_lookup_amp, 599, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__57)) __PYX_ERR(0, 599, __pyx_L1_error)
+  __pyx_tuple__58 = PyTuple_Pack(2, ((PyObject *)Py_None), ((PyObject *)Py_None)); if (unlikely(!__pyx_tuple__58)) __PYX_ERR(0, 599, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__58);
   __Pyx_GIVEREF(__pyx_tuple__58);
 
-  /* "soapcw/soapcw.pyx":703
+  /* "soapcw/soapcw.pyx":760
  *         self.length = length
  * 
  *     def get_track(self):             # <<<<<<<<<<<<<<
  *         """
  *         Takes in the viterbi data from a run and identifies the track thorugh whcih gives the maximum probability
  */
-  __pyx_tuple__59 = PyTuple_Pack(10, __pyx_n_s_self, __pyx_n_s_previous, __pyx_n_s_vit_trackr, __pyx_n_s_vit_track2, __pyx_n_s_vit_track1, __pyx_n_s_max_prob, __pyx_n_s_max_prob_index, __pyx_n_s_t, __pyx_n_s_i, __pyx_n_s_i); if (unlikely(!__pyx_tuple__59)) __PYX_ERR(0, 703, __pyx_L1_error)
+  __pyx_tuple__59 = PyTuple_Pack(10, __pyx_n_s_self, __pyx_n_s_previous, __pyx_n_s_vit_trackr, __pyx_n_s_vit_track2, __pyx_n_s_vit_track1, __pyx_n_s_max_prob, __pyx_n_s_max_prob_index, __pyx_n_s_t, __pyx_n_s_i, __pyx_n_s_i); if (unlikely(!__pyx_tuple__59)) __PYX_ERR(0, 760, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__59);
   __Pyx_GIVEREF(__pyx_tuple__59);
-  __pyx_codeobj__60 = (PyObject*)__Pyx_PyCode_New(1, 0, 10, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__59, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_soapcw_soapcw_pyx, __pyx_n_s_get_track, 703, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__60)) __PYX_ERR(0, 703, __pyx_L1_error)
+  __pyx_codeobj__60 = (PyObject*)__Pyx_PyCode_New(1, 0, 10, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__59, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_soapcw_soapcw_pyx, __pyx_n_s_get_track, 760, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__60)) __PYX_ERR(0, 760, __pyx_L1_error)
 
-  /* "soapcw/soapcw.pyx":745
+  /* "soapcw/soapcw.pyx":802
  * 
  * 
  * class three_detector(object):             # <<<<<<<<<<<<<<
  * 
  *     def __init__(self, tr, obs1, obs2, obs3, prog = False):
  */
-  __pyx_tuple__61 = PyTuple_Pack(1, __pyx_builtin_object); if (unlikely(!__pyx_tuple__61)) __PYX_ERR(0, 745, __pyx_L1_error)
+  __pyx_tuple__61 = PyTuple_Pack(1, __pyx_builtin_object); if (unlikely(!__pyx_tuple__61)) __PYX_ERR(0, 802, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__61);
   __Pyx_GIVEREF(__pyx_tuple__61);
 
-  /* "soapcw/soapcw.pyx":747
+  /* "soapcw/soapcw.pyx":804
  * class three_detector(object):
  * 
  *     def __init__(self, tr, obs1, obs2, obs3, prog = False):             # <<<<<<<<<<<<<<
  *         '''
  *         initialising viterbi class
  */
-  __pyx_tuple__62 = PyTuple_Pack(6, __pyx_n_s_self, __pyx_n_s_tr, __pyx_n_s_obs1, __pyx_n_s_obs2, __pyx_n_s_obs3, __pyx_n_s_prog); if (unlikely(!__pyx_tuple__62)) __PYX_ERR(0, 747, __pyx_L1_error)
+  __pyx_tuple__62 = PyTuple_Pack(6, __pyx_n_s_self, __pyx_n_s_tr, __pyx_n_s_obs1, __pyx_n_s_obs2, __pyx_n_s_obs3, __pyx_n_s_prog); if (unlikely(!__pyx_tuple__62)) __PYX_ERR(0, 804, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__62);
   __Pyx_GIVEREF(__pyx_tuple__62);
-  __pyx_codeobj__63 = (PyObject*)__Pyx_PyCode_New(6, 0, 6, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__62, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_soapcw_soapcw_pyx, __pyx_n_s_init, 747, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__63)) __PYX_ERR(0, 747, __pyx_L1_error)
-  __pyx_tuple__64 = PyTuple_Pack(1, ((PyObject *)Py_False)); if (unlikely(!__pyx_tuple__64)) __PYX_ERR(0, 747, __pyx_L1_error)
+  __pyx_codeobj__63 = (PyObject*)__Pyx_PyCode_New(6, 0, 6, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__62, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_soapcw_soapcw_pyx, __pyx_n_s_init, 804, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__63)) __PYX_ERR(0, 804, __pyx_L1_error)
+  __pyx_tuple__64 = PyTuple_Pack(1, ((PyObject *)Py_False)); if (unlikely(!__pyx_tuple__64)) __PYX_ERR(0, 804, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__64);
   __Pyx_GIVEREF(__pyx_tuple__64);
 
-  /* "soapcw/soapcw.pyx":760
+  /* "soapcw/soapcw.pyx":817
  *     #--------------------------------------------------------
  * 
  *     def run(self,tr1, obs11, obs21, obs31):             # <<<<<<<<<<<<<<
  *         """
  *         viterbi algorithm for multiple detectors 2 at the moment
  */
-  __pyx_tuple__65 = PyTuple_Pack(41, __pyx_n_s_self, __pyx_n_s_tr1, __pyx_n_s_obs11, __pyx_n_s_obs21, __pyx_n_s_obs31, __pyx_n_s_tr, __pyx_n_s_obs1, __pyx_n_s_obs2, __pyx_n_s_obs3, __pyx_n_s_shape, __pyx_n_s_length, __pyx_n_s_width, __pyx_n_s_val, __pyx_n_s_prev, __pyx_n_s_det1, __pyx_n_s_det2, __pyx_n_s_det3, __pyx_n_s_tr_len, __pyx_n_s_i, __pyx_n_s_j, __pyx_n_s_k, __pyx_n_s_m, __pyx_n_s_t, __pyx_n_s_x, __pyx_n_s_max_pos, __pyx_n_s_indicies, __pyx_n_s_max_val, __pyx_n_s_value, __pyx_n_s_temp, __pyx_n_s_l, __pyx_n_s_pbar, __pyx_n_s_pt, __pyx_n_s_previous, __pyx_n_s_vit_trackr, __pyx_n_s_vit_track1, __pyx_n_s_vit_track2, __pyx_n_s_vit_track3, __pyx_n_s_max_prob, __pyx_n_s_max_prob_index, __pyx_n_s_i, __pyx_n_s_i); if (unlikely(!__pyx_tuple__65)) __PYX_ERR(0, 760, __pyx_L1_error)
+  __pyx_tuple__65 = PyTuple_Pack(41, __pyx_n_s_self, __pyx_n_s_tr1, __pyx_n_s_obs11, __pyx_n_s_obs21, __pyx_n_s_obs31, __pyx_n_s_tr, __pyx_n_s_obs1, __pyx_n_s_obs2, __pyx_n_s_obs3, __pyx_n_s_shape, __pyx_n_s_length, __pyx_n_s_width, __pyx_n_s_val, __pyx_n_s_prev, __pyx_n_s_det1, __pyx_n_s_det2, __pyx_n_s_det3, __pyx_n_s_tr_len, __pyx_n_s_i, __pyx_n_s_j, __pyx_n_s_k, __pyx_n_s_m, __pyx_n_s_t, __pyx_n_s_x, __pyx_n_s_max_pos, __pyx_n_s_indicies, __pyx_n_s_max_val, __pyx_n_s_value, __pyx_n_s_temp, __pyx_n_s_l, __pyx_n_s_pbar, __pyx_n_s_pt, __pyx_n_s_previous, __pyx_n_s_vit_trackr, __pyx_n_s_vit_track1, __pyx_n_s_vit_track2, __pyx_n_s_vit_track3, __pyx_n_s_max_prob, __pyx_n_s_max_prob_index, __pyx_n_s_i, __pyx_n_s_i); if (unlikely(!__pyx_tuple__65)) __PYX_ERR(0, 817, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__65);
   __Pyx_GIVEREF(__pyx_tuple__65);
-  __pyx_codeobj__66 = (PyObject*)__Pyx_PyCode_New(5, 0, 41, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__65, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_soapcw_soapcw_pyx, __pyx_n_s_run, 760, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__66)) __PYX_ERR(0, 760, __pyx_L1_error)
+  __pyx_codeobj__66 = (PyObject*)__Pyx_PyCode_New(5, 0, 41, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__65, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_soapcw_soapcw_pyx, __pyx_n_s_run, 817, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__66)) __PYX_ERR(0, 817, __pyx_L1_error)
 
-  /* "soapcw/soapcw.pyx":915
+  /* "soapcw/soapcw.pyx":972
  *         #return np.array(vit_track1), np.array(vit_track2), np.array(vit_track3), np.array(vit_trackr), np.array(val),np.array(prev), max_prob
  * 
  * class single_detector_mem_n(object):             # <<<<<<<<<<<<<<
  * 
  *     def __init__(self, tr, obs, prog = False):
  */
-  __pyx_tuple__67 = PyTuple_Pack(1, __pyx_builtin_object); if (unlikely(!__pyx_tuple__67)) __PYX_ERR(0, 915, __pyx_L1_error)
+  __pyx_tuple__67 = PyTuple_Pack(1, __pyx_builtin_object); if (unlikely(!__pyx_tuple__67)) __PYX_ERR(0, 972, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__67);
   __Pyx_GIVEREF(__pyx_tuple__67);
 
-  /* "soapcw/soapcw.pyx":917
+  /* "soapcw/soapcw.pyx":974
  * class single_detector_mem_n(object):
  * 
  *     def __init__(self, tr, obs, prog = False):             # <<<<<<<<<<<<<<
  *         '''
  * 
  */
-  __pyx_tuple__68 = PyTuple_Pack(4, __pyx_n_s_self, __pyx_n_s_tr, __pyx_n_s_obs, __pyx_n_s_prog); if (unlikely(!__pyx_tuple__68)) __PYX_ERR(0, 917, __pyx_L1_error)
+  __pyx_tuple__68 = PyTuple_Pack(4, __pyx_n_s_self, __pyx_n_s_tr, __pyx_n_s_obs, __pyx_n_s_prog); if (unlikely(!__pyx_tuple__68)) __PYX_ERR(0, 974, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__68);
   __Pyx_GIVEREF(__pyx_tuple__68);
-  __pyx_codeobj__69 = (PyObject*)__Pyx_PyCode_New(4, 0, 4, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__68, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_soapcw_soapcw_pyx, __pyx_n_s_init, 917, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__69)) __PYX_ERR(0, 917, __pyx_L1_error)
-  __pyx_tuple__70 = PyTuple_Pack(1, ((PyObject *)Py_False)); if (unlikely(!__pyx_tuple__70)) __PYX_ERR(0, 917, __pyx_L1_error)
+  __pyx_codeobj__69 = (PyObject*)__Pyx_PyCode_New(4, 0, 4, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__68, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_soapcw_soapcw_pyx, __pyx_n_s_init, 974, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__69)) __PYX_ERR(0, 974, __pyx_L1_error)
+  __pyx_tuple__70 = PyTuple_Pack(1, ((PyObject *)Py_False)); if (unlikely(!__pyx_tuple__70)) __PYX_ERR(0, 974, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__70);
   __Pyx_GIVEREF(__pyx_tuple__70);
 
-  /* "soapcw/soapcw.pyx":932
+  /* "soapcw/soapcw.pyx":989
  *     #------------------------------------------------------------------------
  * 
  *     def run(self, tr, obs):             # <<<<<<<<<<<<<<
  *         ''' Run viterbi algroithm with memory of n
  *         the amount of memory is determined by the transition matrix
  */
-  __pyx_tuple__71 = PyTuple_Pack(32, __pyx_n_s_self, __pyx_n_s_tr, __pyx_n_s_obs, __pyx_n_s_range_tr, __pyx_n_s_n, __pyx_n_s_shape, __pyx_n_s_length, __pyx_n_s_dimensions, __pyx_n_s_length_t, __pyx_n_s_width, __pyx_n_s_i, __pyx_n_s_t, __pyx_n_s_k, __pyx_n_s_c, __pyx_n_s_value, __pyx_n_s_temp, __pyx_n_s_val, __pyx_n_s_prev, __pyx_n_s_range_j, __pyx_n_s_j, __pyx_n_s_pbar, __pyx_n_s_obst, __pyx_n_s_valt, __pyx_n_s_pt, __pyx_n_s_cond, __pyx_n_s_b, __pyx_n_s_m, __pyx_n_s_n1, __pyx_n_s_previous, __pyx_n_s_previous_1, __pyx_n_s_vit_track, __pyx_n_s_previous_2); if (unlikely(!__pyx_tuple__71)) __PYX_ERR(0, 932, __pyx_L1_error)
+  __pyx_tuple__71 = PyTuple_Pack(32, __pyx_n_s_self, __pyx_n_s_tr, __pyx_n_s_obs, __pyx_n_s_range_tr, __pyx_n_s_n, __pyx_n_s_shape, __pyx_n_s_length, __pyx_n_s_dimensions, __pyx_n_s_length_t, __pyx_n_s_width, __pyx_n_s_i, __pyx_n_s_t, __pyx_n_s_k, __pyx_n_s_c, __pyx_n_s_value, __pyx_n_s_temp, __pyx_n_s_val, __pyx_n_s_prev, __pyx_n_s_range_j, __pyx_n_s_j, __pyx_n_s_pbar, __pyx_n_s_obst, __pyx_n_s_valt, __pyx_n_s_pt, __pyx_n_s_cond, __pyx_n_s_b, __pyx_n_s_m, __pyx_n_s_n1, __pyx_n_s_previous, __pyx_n_s_previous_1, __pyx_n_s_vit_track, __pyx_n_s_previous_2); if (unlikely(!__pyx_tuple__71)) __PYX_ERR(0, 989, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__71);
   __Pyx_GIVEREF(__pyx_tuple__71);
-  __pyx_codeobj__72 = (PyObject*)__Pyx_PyCode_New(3, 0, 32, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__71, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_soapcw_soapcw_pyx, __pyx_n_s_run, 932, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__72)) __PYX_ERR(0, 932, __pyx_L1_error)
+  __pyx_codeobj__72 = (PyObject*)__Pyx_PyCode_New(3, 0, 32, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__71, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_soapcw_soapcw_pyx, __pyx_n_s_run, 989, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__72)) __PYX_ERR(0, 989, __pyx_L1_error)
 
-  /* "soapcw/soapcw.pyx":1069
+  /* "soapcw/soapcw.pyx":1126
  *         #return (vit_track,val,prev)
  * 
  * class two_detector_mem_n(object):             # <<<<<<<<<<<<<<
  * 
  *     def __init__(self, tr, obs1, obs2, prog = False):
  */
-  __pyx_tuple__73 = PyTuple_Pack(1, __pyx_builtin_object); if (unlikely(!__pyx_tuple__73)) __PYX_ERR(0, 1069, __pyx_L1_error)
+  __pyx_tuple__73 = PyTuple_Pack(1, __pyx_builtin_object); if (unlikely(!__pyx_tuple__73)) __PYX_ERR(0, 1126, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__73);
   __Pyx_GIVEREF(__pyx_tuple__73);
 
-  /* "soapcw/soapcw.pyx":1071
+  /* "soapcw/soapcw.pyx":1128
  * class two_detector_mem_n(object):
  * 
  *     def __init__(self, tr, obs1, obs2, prog = False):             # <<<<<<<<<<<<<<
  *         '''
  *         initialising viterbi class
  */
-  __pyx_tuple__74 = PyTuple_Pack(5, __pyx_n_s_self, __pyx_n_s_tr, __pyx_n_s_obs1, __pyx_n_s_obs2, __pyx_n_s_prog); if (unlikely(!__pyx_tuple__74)) __PYX_ERR(0, 1071, __pyx_L1_error)
+  __pyx_tuple__74 = PyTuple_Pack(5, __pyx_n_s_self, __pyx_n_s_tr, __pyx_n_s_obs1, __pyx_n_s_obs2, __pyx_n_s_prog); if (unlikely(!__pyx_tuple__74)) __PYX_ERR(0, 1128, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__74);
   __Pyx_GIVEREF(__pyx_tuple__74);
-  __pyx_codeobj__75 = (PyObject*)__Pyx_PyCode_New(5, 0, 5, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__74, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_soapcw_soapcw_pyx, __pyx_n_s_init, 1071, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__75)) __PYX_ERR(0, 1071, __pyx_L1_error)
-  __pyx_tuple__76 = PyTuple_Pack(1, ((PyObject *)Py_False)); if (unlikely(!__pyx_tuple__76)) __PYX_ERR(0, 1071, __pyx_L1_error)
+  __pyx_codeobj__75 = (PyObject*)__Pyx_PyCode_New(5, 0, 5, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__74, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_soapcw_soapcw_pyx, __pyx_n_s_init, 1128, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__75)) __PYX_ERR(0, 1128, __pyx_L1_error)
+  __pyx_tuple__76 = PyTuple_Pack(1, ((PyObject *)Py_False)); if (unlikely(!__pyx_tuple__76)) __PYX_ERR(0, 1128, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__76);
   __Pyx_GIVEREF(__pyx_tuple__76);
 
-  /* "soapcw/soapcw.pyx":1084
+  /* "soapcw/soapcw.pyx":1141
  * 
  * 
  *     def run(self, tr, obs11, obs22):             # <<<<<<<<<<<<<<
  *         ''' Run viterbi algroithm with memory of n
  *         the amount of memory is determined by the transition matrix
  */
-  __pyx_tuple__77 = PyTuple_Pack(42, __pyx_n_s_self, __pyx_n_s_tr, __pyx_n_s_obs11, __pyx_n_s_obs22, __pyx_n_s_range_tr, __pyx_n_s_obs1, __pyx_n_s_obs2, __pyx_n_s_n, __pyx_n_s_shape, __pyx_n_s_length, __pyx_n_s_dimensions, __pyx_n_s_length_t, __pyx_n_s_width, __pyx_n_s_i, __pyx_n_s_k, __pyx_n_s_m, __pyx_n_s_j1, __pyx_n_s_n1, __pyx_n_s_b, __pyx_n_s_t, __pyx_n_s_value, __pyx_n_s_temp, __pyx_n_s_val, __pyx_n_s_prev, __pyx_n_s_pos1, __pyx_n_s_pos2, __pyx_n_s_range_j, __pyx_n_s_j, __pyx_n_s_pbar, __pyx_n_s_obs1t, __pyx_n_s_obs2t, __pyx_n_s_valt, __pyx_n_s_pt, __pyx_n_s_cond, __pyx_n_s_c, __pyx_n_s_a, __pyx_n_s_previous, __pyx_n_s_previous_1, __pyx_n_s_vit_track1, __pyx_n_s_vit_track2, __pyx_n_s_vit_trackr, __pyx_n_s_previous_2); if (unlikely(!__pyx_tuple__77)) __PYX_ERR(0, 1084, __pyx_L1_error)
+  __pyx_tuple__77 = PyTuple_Pack(42, __pyx_n_s_self, __pyx_n_s_tr, __pyx_n_s_obs11, __pyx_n_s_obs22, __pyx_n_s_range_tr, __pyx_n_s_obs1, __pyx_n_s_obs2, __pyx_n_s_n, __pyx_n_s_shape, __pyx_n_s_length, __pyx_n_s_dimensions, __pyx_n_s_length_t, __pyx_n_s_width, __pyx_n_s_i, __pyx_n_s_k, __pyx_n_s_m, __pyx_n_s_j1, __pyx_n_s_n1, __pyx_n_s_b, __pyx_n_s_t, __pyx_n_s_value, __pyx_n_s_temp, __pyx_n_s_val, __pyx_n_s_prev, __pyx_n_s_pos1, __pyx_n_s_pos2, __pyx_n_s_range_j, __pyx_n_s_j, __pyx_n_s_pbar, __pyx_n_s_obs1t, __pyx_n_s_obs2t, __pyx_n_s_valt, __pyx_n_s_pt, __pyx_n_s_cond, __pyx_n_s_c, __pyx_n_s_a, __pyx_n_s_previous, __pyx_n_s_previous_1, __pyx_n_s_vit_track1, __pyx_n_s_vit_track2, __pyx_n_s_vit_trackr, __pyx_n_s_previous_2); if (unlikely(!__pyx_tuple__77)) __PYX_ERR(0, 1141, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__77);
   __Pyx_GIVEREF(__pyx_tuple__77);
-  __pyx_codeobj__78 = (PyObject*)__Pyx_PyCode_New(4, 0, 42, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__77, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_soapcw_soapcw_pyx, __pyx_n_s_run, 1084, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__78)) __PYX_ERR(0, 1084, __pyx_L1_error)
+  __pyx_codeobj__78 = (PyObject*)__Pyx_PyCode_New(4, 0, 42, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__77, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_soapcw_soapcw_pyx, __pyx_n_s_run, 1141, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__78)) __PYX_ERR(0, 1141, __pyx_L1_error)
 
-  /* "soapcw/soapcw.pyx":1262
+  /* "soapcw/soapcw.pyx":1319
  * ### ----------------------------------------------------------------
  * 
  * class single_detector_gaps(object):             # <<<<<<<<<<<<<<
  * 
  *     def __init__(self, tr, obs,times,tsft):
  */
-  __pyx_tuple__79 = PyTuple_Pack(1, __pyx_builtin_object); if (unlikely(!__pyx_tuple__79)) __PYX_ERR(0, 1262, __pyx_L1_error)
+  __pyx_tuple__79 = PyTuple_Pack(1, __pyx_builtin_object); if (unlikely(!__pyx_tuple__79)) __PYX_ERR(0, 1319, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__79);
   __Pyx_GIVEREF(__pyx_tuple__79);
 
-  /* "soapcw/soapcw.pyx":1264
+  /* "soapcw/soapcw.pyx":1321
  * class single_detector_gaps(object):
  * 
  *     def __init__(self, tr, obs,times,tsft):             # <<<<<<<<<<<<<<
  *         """
  *         single detector viterbi algorithm where the data can include large gaps in data
  */
-  __pyx_tuple__80 = PyTuple_Pack(5, __pyx_n_s_self, __pyx_n_s_tr, __pyx_n_s_obs, __pyx_n_s_times, __pyx_n_s_tsft); if (unlikely(!__pyx_tuple__80)) __PYX_ERR(0, 1264, __pyx_L1_error)
+  __pyx_tuple__80 = PyTuple_Pack(5, __pyx_n_s_self, __pyx_n_s_tr, __pyx_n_s_obs, __pyx_n_s_times, __pyx_n_s_tsft); if (unlikely(!__pyx_tuple__80)) __PYX_ERR(0, 1321, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__80);
   __Pyx_GIVEREF(__pyx_tuple__80);
-  __pyx_codeobj__81 = (PyObject*)__Pyx_PyCode_New(5, 0, 5, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__80, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_soapcw_soapcw_pyx, __pyx_n_s_init, 1264, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__81)) __PYX_ERR(0, 1264, __pyx_L1_error)
+  __pyx_codeobj__81 = (PyObject*)__Pyx_PyCode_New(5, 0, 5, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__80, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_soapcw_soapcw_pyx, __pyx_n_s_init, 1321, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__81)) __PYX_ERR(0, 1321, __pyx_L1_error)
 
-  /* "soapcw/soapcw.pyx":1290
+  /* "soapcw/soapcw.pyx":1347
  *         self.max_end_prob = max(self.vits[-1].V[-1])
  * 
  *     def max_track(self,tr,length,diff,bnd,ind,band_width):             # <<<<<<<<<<<<<<
  *         tr_val = np.arange(len(tr)).astype(int) - np.floor(len(tr)/2).astype(int)
  *         result = [seq for seq in itertools.combinations_with_replacement(tr_val, length) if sum(seq) == diff]
  */
-  __pyx_tuple__82 = PyTuple_Pack(18, __pyx_n_s_self, __pyx_n_s_tr, __pyx_n_s_length, __pyx_n_s_diff, __pyx_n_s_bnd, __pyx_n_s_ind, __pyx_n_s_band_width, __pyx_n_s_tr_val, __pyx_n_s_result, __pyx_n_s_max_seq, __pyx_n_s_thresh, __pyx_n_s_thresh2, __pyx_n_s_seq, __pyx_n_s_abspath, __pyx_n_s_s, __pyx_n_s_l, __pyx_n_s_seq, __pyx_n_s_elem); if (unlikely(!__pyx_tuple__82)) __PYX_ERR(0, 1290, __pyx_L1_error)
+  __pyx_tuple__82 = PyTuple_Pack(18, __pyx_n_s_self, __pyx_n_s_tr, __pyx_n_s_length, __pyx_n_s_diff, __pyx_n_s_bnd, __pyx_n_s_ind, __pyx_n_s_band_width, __pyx_n_s_tr_val, __pyx_n_s_result, __pyx_n_s_max_seq, __pyx_n_s_thresh, __pyx_n_s_thresh2, __pyx_n_s_seq, __pyx_n_s_abspath, __pyx_n_s_s, __pyx_n_s_l, __pyx_n_s_seq, __pyx_n_s_elem); if (unlikely(!__pyx_tuple__82)) __PYX_ERR(0, 1347, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__82);
   __Pyx_GIVEREF(__pyx_tuple__82);
-  __pyx_codeobj__83 = (PyObject*)__Pyx_PyCode_New(7, 0, 18, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__82, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_soapcw_soapcw_pyx, __pyx_n_s_max_track, 1290, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__83)) __PYX_ERR(0, 1290, __pyx_L1_error)
+  __pyx_codeobj__83 = (PyObject*)__Pyx_PyCode_New(7, 0, 18, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__82, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_soapcw_soapcw_pyx, __pyx_n_s_max_track, 1347, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__83)) __PYX_ERR(0, 1347, __pyx_L1_error)
 
-  /* "soapcw/soapcw.pyx":1315
+  /* "soapcw/soapcw.pyx":1372
  *         return max_seq,s
  * 
  *     def gap_run(self,viterbi, band_width, diff, tsft, tr):             # <<<<<<<<<<<<<<
  *         length = diff - 1
  *         max_vals = np.zeros(band_width)
  */
-  __pyx_tuple__84 = PyTuple_Pack(19, __pyx_n_s_self, __pyx_n_s_viterbi, __pyx_n_s_band_width, __pyx_n_s_diff, __pyx_n_s_tsft, __pyx_n_s_tr, __pyx_n_s_length, __pyx_n_s_max_vals, __pyx_n_s_max_paths, __pyx_n_s_bnd, __pyx_n_s_low, __pyx_n_s_high, __pyx_n_s_thres, __pyx_n_s_vend, __pyx_n_s_val, __pyx_n_s_ind, __pyx_n_s_j, __pyx_n_s_diff_ind, __pyx_n_s_gaptrack); if (unlikely(!__pyx_tuple__84)) __PYX_ERR(0, 1315, __pyx_L1_error)
+  __pyx_tuple__84 = PyTuple_Pack(19, __pyx_n_s_self, __pyx_n_s_viterbi, __pyx_n_s_band_width, __pyx_n_s_diff, __pyx_n_s_tsft, __pyx_n_s_tr, __pyx_n_s_length, __pyx_n_s_max_vals, __pyx_n_s_max_paths, __pyx_n_s_bnd, __pyx_n_s_low, __pyx_n_s_high, __pyx_n_s_thres, __pyx_n_s_vend, __pyx_n_s_val, __pyx_n_s_ind, __pyx_n_s_j, __pyx_n_s_diff_ind, __pyx_n_s_gaptrack); if (unlikely(!__pyx_tuple__84)) __PYX_ERR(0, 1372, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__84);
   __Pyx_GIVEREF(__pyx_tuple__84);
-  __pyx_codeobj__85 = (PyObject*)__Pyx_PyCode_New(6, 0, 19, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__84, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_soapcw_soapcw_pyx, __pyx_n_s_gap_run, 1315, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__85)) __PYX_ERR(0, 1315, __pyx_L1_error)
+  __pyx_codeobj__85 = (PyObject*)__Pyx_PyCode_New(6, 0, 19, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__84, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_soapcw_soapcw_pyx, __pyx_n_s_gap_run, 1372, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__85)) __PYX_ERR(0, 1372, __pyx_L1_error)
 
-  /* "soapcw/soapcw.pyx":1346
+  /* "soapcw/soapcw.pyx":1403
  *         return max_vals, max_paths
  * 
  *     def find_path(self,prev,end_ind):             # <<<<<<<<<<<<<<
  *         length = len(prev)
  *         previous = prev[-1][end_ind]
  */
-  __pyx_tuple__86 = PyTuple_Pack(7, __pyx_n_s_self, __pyx_n_s_prev, __pyx_n_s_end_ind, __pyx_n_s_length, __pyx_n_s_previous, __pyx_n_s_vit_track, __pyx_n_s_t); if (unlikely(!__pyx_tuple__86)) __PYX_ERR(0, 1346, __pyx_L1_error)
+  __pyx_tuple__86 = PyTuple_Pack(7, __pyx_n_s_self, __pyx_n_s_prev, __pyx_n_s_end_ind, __pyx_n_s_length, __pyx_n_s_previous, __pyx_n_s_vit_track, __pyx_n_s_t); if (unlikely(!__pyx_tuple__86)) __PYX_ERR(0, 1403, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__86);
   __Pyx_GIVEREF(__pyx_tuple__86);
-  __pyx_codeobj__87 = (PyObject*)__Pyx_PyCode_New(3, 0, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__86, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_soapcw_soapcw_pyx, __pyx_n_s_find_path, 1346, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__87)) __PYX_ERR(0, 1346, __pyx_L1_error)
+  __pyx_codeobj__87 = (PyObject*)__Pyx_PyCode_New(3, 0, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__86, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_soapcw_soapcw_pyx, __pyx_n_s_find_path, 1403, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__87)) __PYX_ERR(0, 1403, __pyx_L1_error)
 
-  /* "soapcw/soapcw.pyx":1358
+  /* "soapcw/soapcw.pyx":1415
  * 
  * 
  *     def vit_gaps(self,data1,epochs1,tr,tsft):             # <<<<<<<<<<<<<<
  * 
  *         band_width = len(data1[0])
  */
-  __pyx_tuple__88 = PyTuple_Pack(21, __pyx_n_s_self, __pyx_n_s_data1, __pyx_n_s_epochs1, __pyx_n_s_tr, __pyx_n_s_tsft, __pyx_n_s_band_width, __pyx_n_s_vit, __pyx_n_s_starts, __pyx_n_s_gappaths, __pyx_n_s_gapend, __pyx_n_s_vitstart, __pyx_n_s_max_vals, __pyx_n_s_data, __pyx_n_s_epochs, __pyx_n_s_i, __pyx_n_s_idx, __pyx_n_s_diff, __pyx_n_s_diff_ind, __pyx_n_s_viterbi, __pyx_n_s_max_paths, __pyx_n_s_diff1); if (unlikely(!__pyx_tuple__88)) __PYX_ERR(0, 1358, __pyx_L1_error)
+  __pyx_tuple__88 = PyTuple_Pack(21, __pyx_n_s_self, __pyx_n_s_data1, __pyx_n_s_epochs1, __pyx_n_s_tr, __pyx_n_s_tsft, __pyx_n_s_band_width, __pyx_n_s_vit, __pyx_n_s_starts, __pyx_n_s_gappaths, __pyx_n_s_gapend, __pyx_n_s_vitstart, __pyx_n_s_max_vals, __pyx_n_s_data, __pyx_n_s_epochs, __pyx_n_s_i, __pyx_n_s_idx, __pyx_n_s_diff, __pyx_n_s_diff_ind, __pyx_n_s_viterbi, __pyx_n_s_max_paths, __pyx_n_s_diff1); if (unlikely(!__pyx_tuple__88)) __PYX_ERR(0, 1415, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__88);
   __Pyx_GIVEREF(__pyx_tuple__88);
-  __pyx_codeobj__89 = (PyObject*)__Pyx_PyCode_New(5, 0, 21, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__88, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_soapcw_soapcw_pyx, __pyx_n_s_vit_gaps, 1358, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__89)) __PYX_ERR(0, 1358, __pyx_L1_error)
+  __pyx_codeobj__89 = (PyObject*)__Pyx_PyCode_New(5, 0, 21, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__88, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_soapcw_soapcw_pyx, __pyx_n_s_vit_gaps, 1415, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__89)) __PYX_ERR(0, 1415, __pyx_L1_error)
 
-  /* "soapcw/soapcw.pyx":1442
+  /* "soapcw/soapcw.pyx":1499
  *         return vit,starts, gappaths
  * 
  *     def get_track(self,vit,starts,gappaths,tsft=1):             # <<<<<<<<<<<<<<
  *         vit_track = []
  *         vit_track_time = []
  */
-  __pyx_tuple__90 = PyTuple_Pack(12, __pyx_n_s_self, __pyx_n_s_vit, __pyx_n_s_starts, __pyx_n_s_gappaths, __pyx_n_s_tsft, __pyx_n_s_vit_track, __pyx_n_s_vit_track_time, __pyx_n_s_gpb, __pyx_n_s_gp, __pyx_n_s_v, __pyx_n_s_p1, __pyx_n_s_st); if (unlikely(!__pyx_tuple__90)) __PYX_ERR(0, 1442, __pyx_L1_error)
+  __pyx_tuple__90 = PyTuple_Pack(12, __pyx_n_s_self, __pyx_n_s_vit, __pyx_n_s_starts, __pyx_n_s_gappaths, __pyx_n_s_tsft, __pyx_n_s_vit_track, __pyx_n_s_vit_track_time, __pyx_n_s_gpb, __pyx_n_s_gp, __pyx_n_s_v, __pyx_n_s_p1, __pyx_n_s_st); if (unlikely(!__pyx_tuple__90)) __PYX_ERR(0, 1499, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__90);
   __Pyx_GIVEREF(__pyx_tuple__90);
-  __pyx_codeobj__91 = (PyObject*)__Pyx_PyCode_New(5, 0, 12, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__90, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_soapcw_soapcw_pyx, __pyx_n_s_get_track, 1442, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__91)) __PYX_ERR(0, 1442, __pyx_L1_error)
-  __pyx_tuple__92 = PyTuple_Pack(1, ((PyObject *)__pyx_int_1)); if (unlikely(!__pyx_tuple__92)) __PYX_ERR(0, 1442, __pyx_L1_error)
+  __pyx_codeobj__91 = (PyObject*)__Pyx_PyCode_New(5, 0, 12, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__90, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_soapcw_soapcw_pyx, __pyx_n_s_get_track, 1499, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__91)) __PYX_ERR(0, 1499, __pyx_L1_error)
+  __pyx_tuple__92 = PyTuple_Pack(1, ((PyObject *)__pyx_int_1)); if (unlikely(!__pyx_tuple__92)) __PYX_ERR(0, 1499, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__92);
   __Pyx_GIVEREF(__pyx_tuple__92);
 
   /* "View.MemoryView":287
  *         return self.name
  * 
  * cdef generic = Enum("<strided and direct or indirect>")             # <<<<<<<<<<<<<<
@@ -44389,14 +44728,19 @@
   return 0;
   __pyx_L1_error:;
   __Pyx_RefNannyFinishContext();
   return -1;
 }
 
 static CYTHON_SMALL_CODE int __Pyx_InitGlobals(void) {
+  /* AssertionsEnabled.init */
+  __Pyx_init_assertions_enabled();
+
+if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1, __pyx_L1_error)
+
   if (__Pyx_InitStrings(__pyx_string_tab) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_float_1_ = PyFloat_FromDouble(1.); if (unlikely(!__pyx_float_1_)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_float_neg_1e6 = PyFloat_FromDouble(-1e6); if (unlikely(!__pyx_float_neg_1e6)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_0 = PyInt_FromLong(0); if (unlikely(!__pyx_int_0)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_1 = PyInt_FromLong(1); if (unlikely(!__pyx_int_1)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_2 = PyInt_FromLong(2); if (unlikely(!__pyx_int_2)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_112105877 = PyInt_FromLong(112105877L); if (unlikely(!__pyx_int_112105877)) __PYX_ERR(0, 1, __pyx_L1_error)
@@ -44448,23 +44792,23 @@
 static int __Pyx_modinit_type_init_code(void) {
   __Pyx_RefNannyDeclarations
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__Pyx_modinit_type_init_code", 0);
   /*--- Type init code ---*/
-  if (PyType_Ready(&__pyx_type_6soapcw_6soapcw___pyx_scope_struct__run) < 0) __PYX_ERR(0, 77, __pyx_L1_error)
+  if (PyType_Ready(&__pyx_type_6soapcw_6soapcw___pyx_scope_struct__run) < 0) __PYX_ERR(0, 84, __pyx_L1_error)
   #if PY_VERSION_HEX < 0x030800B1
   __pyx_type_6soapcw_6soapcw___pyx_scope_struct__run.tp_print = 0;
   #endif
   if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_6soapcw_6soapcw___pyx_scope_struct__run.tp_dictoffset && __pyx_type_6soapcw_6soapcw___pyx_scope_struct__run.tp_getattro == PyObject_GenericGetAttr)) {
     __pyx_type_6soapcw_6soapcw___pyx_scope_struct__run.tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
   }
   __pyx_ptype_6soapcw_6soapcw___pyx_scope_struct__run = &__pyx_type_6soapcw_6soapcw___pyx_scope_struct__run;
-  if (PyType_Ready(&__pyx_type_6soapcw_6soapcw___pyx_scope_struct_1_genexpr) < 0) __PYX_ERR(0, 169, __pyx_L1_error)
+  if (PyType_Ready(&__pyx_type_6soapcw_6soapcw___pyx_scope_struct_1_genexpr) < 0) __PYX_ERR(0, 176, __pyx_L1_error)
   #if PY_VERSION_HEX < 0x030800B1
   __pyx_type_6soapcw_6soapcw___pyx_scope_struct_1_genexpr.tp_print = 0;
   #endif
   if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_6soapcw_6soapcw___pyx_scope_struct_1_genexpr.tp_dictoffset && __pyx_type_6soapcw_6soapcw___pyx_scope_struct_1_genexpr.tp_getattro == PyObject_GenericGetAttr)) {
     __pyx_type_6soapcw_6soapcw___pyx_scope_struct_1_genexpr.tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
   }
   __pyx_ptype_6soapcw_6soapcw___pyx_scope_struct_1_genexpr = &__pyx_type_6soapcw_6soapcw___pyx_scope_struct_1_genexpr;
@@ -44868,25 +45212,25 @@
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
   /* "soapcw/soapcw.pyx":14
  * from scipy.special import logsumexp
  * 
  * class single_detector(object):             # <<<<<<<<<<<<<<
  * 
- *     def __init__(self, tr, obs, prog = False, lookup_file=None, make_vitmap = True):
+ *     def __init__(self, tr, obs, prog = False, lookup_table=None, make_vitmap = True):
  */
   __pyx_t_1 = __Pyx_CalculateMetaclass(NULL, __pyx_tuple__30); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 14, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_t_2 = __Pyx_Py3MetaclassPrepare(__pyx_t_1, __pyx_tuple__30, __pyx_n_s_single_detector, __pyx_n_s_single_detector, (PyObject *) NULL, __pyx_n_s_soapcw_soapcw, (PyObject *) NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 14, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
 
   /* "soapcw/soapcw.pyx":16
  * class single_detector(object):
  * 
- *     def __init__(self, tr, obs, prog = False, lookup_file=None, make_vitmap = True):             # <<<<<<<<<<<<<<
+ *     def __init__(self, tr, obs, prog = False, lookup_table=None, make_vitmap = True):             # <<<<<<<<<<<<<<
  *         '''
  *         initialising viterbi class
  */
   __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6soapcw_6soapcw_15single_detector_1__init__, 0, __pyx_n_s_single_detector___init, NULL, __pyx_n_s_soapcw_soapcw, __pyx_d, ((PyObject *)__pyx_codeobj__32)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 16, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_3, __pyx_tuple__33);
   if (__Pyx_SetNameInClass(__pyx_t_2, __pyx_n_s_init, __pyx_t_3) < 0) __PYX_ERR(0, 16, __pyx_L1_error)
@@ -44904,412 +45248,412 @@
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_3, __pyx_tuple__36);
   if (__Pyx_SetNameInClass(__pyx_t_2, __pyx_n_s_get_vitmap, __pyx_t_3) < 0) __PYX_ERR(0, 41, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
   /* "soapcw/soapcw.pyx":60
  *     #--------------------------
  * 
- *     def read_lookup(self,filename):             # <<<<<<<<<<<<<<
+ *     def read_lookup(self,lookup_table):             # <<<<<<<<<<<<<<
  *         """
  *         Read the lookup table for chosen statistic
  */
   __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6soapcw_6soapcw_15single_detector_5read_lookup, 0, __pyx_n_s_single_detector_read_lookup, NULL, __pyx_n_s_soapcw_soapcw, __pyx_d, ((PyObject *)__pyx_codeobj__38)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 60, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   if (__Pyx_SetNameInClass(__pyx_t_2, __pyx_n_s_read_lookup, __pyx_t_3) < 0) __PYX_ERR(0, 60, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "soapcw/soapcw.pyx":77
+  /* "soapcw/soapcw.pyx":84
  * 
  * 
- *     def run(self,double[:] tr, double[:, :] obs, lookup_file = None):             # <<<<<<<<<<<<<<
+ *     def run(self,double[:] tr, double[:, :] obs, lookup_table = None):             # <<<<<<<<<<<<<<
  *         '''
  *         Run the viterbi algorithm for given single set of data and 3x1 transition matrix.
  */
-  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6soapcw_6soapcw_15single_detector_7run, 0, __pyx_n_s_single_detector_run, NULL, __pyx_n_s_soapcw_soapcw, __pyx_d, ((PyObject *)__pyx_codeobj__40)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 77, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6soapcw_6soapcw_15single_detector_7run, 0, __pyx_n_s_single_detector_run, NULL, __pyx_n_s_soapcw_soapcw, __pyx_d, ((PyObject *)__pyx_codeobj__40)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 84, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_3, __pyx_tuple__41);
-  if (__Pyx_SetNameInClass(__pyx_t_2, __pyx_n_s_run, __pyx_t_3) < 0) __PYX_ERR(0, 77, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_2, __pyx_n_s_run, __pyx_t_3) < 0) __PYX_ERR(0, 84, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
   /* "soapcw/soapcw.pyx":14
  * from scipy.special import logsumexp
  * 
  * class single_detector(object):             # <<<<<<<<<<<<<<
  * 
- *     def __init__(self, tr, obs, prog = False, lookup_file=None, make_vitmap = True):
+ *     def __init__(self, tr, obs, prog = False, lookup_table=None, make_vitmap = True):
  */
   __pyx_t_3 = __Pyx_Py3ClassCreate(__pyx_t_1, __pyx_n_s_single_detector, __pyx_tuple__30, __pyx_t_2, NULL, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 14, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   if (PyDict_SetItem(__pyx_d, __pyx_n_s_single_detector, __pyx_t_3) < 0) __PYX_ERR(0, 14, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "soapcw/soapcw.pyx":190
+  /* "soapcw/soapcw.pyx":197
  * 
  * 
  * class two_detector(object):             # <<<<<<<<<<<<<<
  * 
- *     def __init__(self, tr, obs1, obs2, lookup_file_2det = None, lookup_file_1det = None, prog = False,fractions=None, make_vitmap=True):
+ *     def __init__(self, tr, obs1, obs2, lookup_table_2det = None, lookup_table_1det = None, prog = False,fractions=None, make_vitmap=True):
  */
-  __pyx_t_1 = __Pyx_CalculateMetaclass(NULL, __pyx_tuple__42); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 190, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_CalculateMetaclass(NULL, __pyx_tuple__42); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 197, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_Py3MetaclassPrepare(__pyx_t_1, __pyx_tuple__42, __pyx_n_s_two_detector, __pyx_n_s_two_detector, (PyObject *) NULL, __pyx_n_s_soapcw_soapcw, (PyObject *) NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 190, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_Py3MetaclassPrepare(__pyx_t_1, __pyx_tuple__42, __pyx_n_s_two_detector, __pyx_n_s_two_detector, (PyObject *) NULL, __pyx_n_s_soapcw_soapcw, (PyObject *) NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 197, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
 
-  /* "soapcw/soapcw.pyx":192
+  /* "soapcw/soapcw.pyx":199
  * class two_detector(object):
  * 
- *     def __init__(self, tr, obs1, obs2, lookup_file_2det = None, lookup_file_1det = None, prog = False,fractions=None, make_vitmap=True):             # <<<<<<<<<<<<<<
+ *     def __init__(self, tr, obs1, obs2, lookup_table_2det = None, lookup_table_1det = None, prog = False,fractions=None, make_vitmap=True):             # <<<<<<<<<<<<<<
  *         '''
  *         viterbi algorithm for two detectors with an optional line aware statistic
  */
-  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6soapcw_6soapcw_12two_detector_1__init__, 0, __pyx_n_s_two_detector___init, NULL, __pyx_n_s_soapcw_soapcw, __pyx_d, ((PyObject *)__pyx_codeobj__44)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 192, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6soapcw_6soapcw_12two_detector_1__init__, 0, __pyx_n_s_two_detector___init, NULL, __pyx_n_s_soapcw_soapcw, __pyx_d, ((PyObject *)__pyx_codeobj__44)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 199, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_3, __pyx_tuple__45);
-  if (__Pyx_SetNameInClass(__pyx_t_2, __pyx_n_s_init, __pyx_t_3) < 0) __PYX_ERR(0, 192, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_2, __pyx_n_s_init, __pyx_t_3) < 0) __PYX_ERR(0, 199, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "soapcw/soapcw.pyx":253
+  /* "soapcw/soapcw.pyx":260
  *     #------------------------------------------------------------------------------------------------
  * 
  *     def get_vitmap(self,log=False):             # <<<<<<<<<<<<<<
  *         """
  *         normalise the viterbi output such that the sum of eah column is 1
  */
-  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6soapcw_6soapcw_12two_detector_3get_vitmap, 0, __pyx_n_s_two_detector_get_vitmap, NULL, __pyx_n_s_soapcw_soapcw, __pyx_d, ((PyObject *)__pyx_codeobj__47)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 253, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6soapcw_6soapcw_12two_detector_3get_vitmap, 0, __pyx_n_s_two_detector_get_vitmap, NULL, __pyx_n_s_soapcw_soapcw, __pyx_d, ((PyObject *)__pyx_codeobj__47)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 260, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_3, __pyx_tuple__48);
-  if (__Pyx_SetNameInClass(__pyx_t_2, __pyx_n_s_get_vitmap, __pyx_t_3) < 0) __PYX_ERR(0, 253, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_2, __pyx_n_s_get_vitmap, __pyx_t_3) < 0) __PYX_ERR(0, 260, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "soapcw/soapcw.pyx":273
+  /* "soapcw/soapcw.pyx":280
  *     #--------------------------------------------------------
  * 
- *     def read_lookup(self,filename):             # <<<<<<<<<<<<<<
- * 
- *         with open(filename,'rb') as f1:
+ *     def read_lookup(self,lookup_table):             # <<<<<<<<<<<<<<
+ *         """
+ *         Read a lookup table from a file of a LineAwareStatistic object
  */
-  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6soapcw_6soapcw_12two_detector_5read_lookup, 0, __pyx_n_s_two_detector_read_lookup, NULL, __pyx_n_s_soapcw_soapcw, __pyx_d, ((PyObject *)__pyx_codeobj__50)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 273, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6soapcw_6soapcw_12two_detector_5read_lookup, 0, __pyx_n_s_two_detector_read_lookup, NULL, __pyx_n_s_soapcw_soapcw, __pyx_d, ((PyObject *)__pyx_codeobj__50)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 280, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  if (__Pyx_SetNameInClass(__pyx_t_2, __pyx_n_s_read_lookup, __pyx_t_3) < 0) __PYX_ERR(0, 273, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_2, __pyx_n_s_read_lookup, __pyx_t_3) < 0) __PYX_ERR(0, 280, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "soapcw/soapcw.pyx":283
+  /* "soapcw/soapcw.pyx":313
  *         return likelihood, ranges, fact
  * 
- *     def read_lookup_amp(self,filename):             # <<<<<<<<<<<<<<
- * 
- *         with open(filename,'rb') as f1:
+ *     def read_lookup_amp(self,lookup_table):             # <<<<<<<<<<<<<<
+ *         """
+ *         Read a lookup table from a file of a LineAwareStatisticAmplitude object
  */
-  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6soapcw_6soapcw_12two_detector_7read_lookup_amp, 0, __pyx_n_s_two_detector_read_lookup_amp, NULL, __pyx_n_s_soapcw_soapcw, __pyx_d, ((PyObject *)__pyx_codeobj__52)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 283, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6soapcw_6soapcw_12two_detector_7read_lookup_amp, 0, __pyx_n_s_two_detector_read_lookup_amp, NULL, __pyx_n_s_soapcw_soapcw, __pyx_d, ((PyObject *)__pyx_codeobj__52)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 313, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  if (__Pyx_SetNameInClass(__pyx_t_2, __pyx_n_s_read_lookup_amp, __pyx_t_3) < 0) __PYX_ERR(0, 283, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_2, __pyx_n_s_read_lookup_amp, __pyx_t_3) < 0) __PYX_ERR(0, 313, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "soapcw/soapcw.pyx":300
+  /* "soapcw/soapcw.pyx":357
  *     #--------------------------------------------------------
  * 
- *     def run(self,transition, obs1, obs2, lookup_file_1det = None,lookup_file_2det = None):             # <<<<<<<<<<<<<<
+ *     def run(self,transition, obs1, obs2, lookup_table_1det = None,lookup_table_2det = None):             # <<<<<<<<<<<<<<
  *         """
  *         viterbi algorithm for two detectors with an lookup table for the line veto statistic
  */
-  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6soapcw_6soapcw_12two_detector_9run, 0, __pyx_n_s_two_detector_run, NULL, __pyx_n_s_soapcw_soapcw, __pyx_d, ((PyObject *)__pyx_codeobj__54)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 300, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6soapcw_6soapcw_12two_detector_9run, 0, __pyx_n_s_two_detector_run, NULL, __pyx_n_s_soapcw_soapcw, __pyx_d, ((PyObject *)__pyx_codeobj__54)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 357, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_3, __pyx_tuple__55);
-  if (__Pyx_SetNameInClass(__pyx_t_2, __pyx_n_s_run, __pyx_t_3) < 0) __PYX_ERR(0, 300, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_2, __pyx_n_s_run, __pyx_t_3) < 0) __PYX_ERR(0, 357, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "soapcw/soapcw.pyx":542
+  /* "soapcw/soapcw.pyx":599
  *         self.length = length
  * 
- *     def run_lookup_amp(self,tr1, obs11, obs21,lookup_file = None, fractions = None):             # <<<<<<<<<<<<<<
+ *     def run_lookup_amp(self,tr1, obs11, obs21,lookup_table = None, fractions = None):             # <<<<<<<<<<<<<<
  *         """
  *         viterbi algorithm for two detectors with an lookup table for the line veto statistic
  */
-  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6soapcw_6soapcw_12two_detector_11run_lookup_amp, 0, __pyx_n_s_two_detector_run_lookup_amp, NULL, __pyx_n_s_soapcw_soapcw, __pyx_d, ((PyObject *)__pyx_codeobj__57)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 542, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6soapcw_6soapcw_12two_detector_11run_lookup_amp, 0, __pyx_n_s_two_detector_run_lookup_amp, NULL, __pyx_n_s_soapcw_soapcw, __pyx_d, ((PyObject *)__pyx_codeobj__57)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 599, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_3, __pyx_tuple__58);
-  if (__Pyx_SetNameInClass(__pyx_t_2, __pyx_n_s_run_lookup_amp, __pyx_t_3) < 0) __PYX_ERR(0, 542, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_2, __pyx_n_s_run_lookup_amp, __pyx_t_3) < 0) __PYX_ERR(0, 599, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "soapcw/soapcw.pyx":703
+  /* "soapcw/soapcw.pyx":760
  *         self.length = length
  * 
  *     def get_track(self):             # <<<<<<<<<<<<<<
  *         """
  *         Takes in the viterbi data from a run and identifies the track thorugh whcih gives the maximum probability
  */
-  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6soapcw_6soapcw_12two_detector_13get_track, 0, __pyx_n_s_two_detector_get_track, NULL, __pyx_n_s_soapcw_soapcw, __pyx_d, ((PyObject *)__pyx_codeobj__60)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 703, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6soapcw_6soapcw_12two_detector_13get_track, 0, __pyx_n_s_two_detector_get_track, NULL, __pyx_n_s_soapcw_soapcw, __pyx_d, ((PyObject *)__pyx_codeobj__60)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 760, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  if (__Pyx_SetNameInClass(__pyx_t_2, __pyx_n_s_get_track, __pyx_t_3) < 0) __PYX_ERR(0, 703, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_2, __pyx_n_s_get_track, __pyx_t_3) < 0) __PYX_ERR(0, 760, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "soapcw/soapcw.pyx":190
+  /* "soapcw/soapcw.pyx":197
  * 
  * 
  * class two_detector(object):             # <<<<<<<<<<<<<<
  * 
- *     def __init__(self, tr, obs1, obs2, lookup_file_2det = None, lookup_file_1det = None, prog = False,fractions=None, make_vitmap=True):
+ *     def __init__(self, tr, obs1, obs2, lookup_table_2det = None, lookup_table_1det = None, prog = False,fractions=None, make_vitmap=True):
  */
-  __pyx_t_3 = __Pyx_Py3ClassCreate(__pyx_t_1, __pyx_n_s_two_detector, __pyx_tuple__42, __pyx_t_2, NULL, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 190, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_Py3ClassCreate(__pyx_t_1, __pyx_n_s_two_detector, __pyx_tuple__42, __pyx_t_2, NULL, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 197, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_two_detector, __pyx_t_3) < 0) __PYX_ERR(0, 190, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_two_detector, __pyx_t_3) < 0) __PYX_ERR(0, 197, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "soapcw/soapcw.pyx":745
+  /* "soapcw/soapcw.pyx":802
  * 
  * 
  * class three_detector(object):             # <<<<<<<<<<<<<<
  * 
  *     def __init__(self, tr, obs1, obs2, obs3, prog = False):
  */
-  __pyx_t_1 = __Pyx_CalculateMetaclass(NULL, __pyx_tuple__61); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 745, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_CalculateMetaclass(NULL, __pyx_tuple__61); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 802, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_Py3MetaclassPrepare(__pyx_t_1, __pyx_tuple__61, __pyx_n_s_three_detector, __pyx_n_s_three_detector, (PyObject *) NULL, __pyx_n_s_soapcw_soapcw, (PyObject *) NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 745, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_Py3MetaclassPrepare(__pyx_t_1, __pyx_tuple__61, __pyx_n_s_three_detector, __pyx_n_s_three_detector, (PyObject *) NULL, __pyx_n_s_soapcw_soapcw, (PyObject *) NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 802, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
 
-  /* "soapcw/soapcw.pyx":747
+  /* "soapcw/soapcw.pyx":804
  * class three_detector(object):
  * 
  *     def __init__(self, tr, obs1, obs2, obs3, prog = False):             # <<<<<<<<<<<<<<
  *         '''
  *         initialising viterbi class
  */
-  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6soapcw_6soapcw_14three_detector_1__init__, 0, __pyx_n_s_three_detector___init, NULL, __pyx_n_s_soapcw_soapcw, __pyx_d, ((PyObject *)__pyx_codeobj__63)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 747, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6soapcw_6soapcw_14three_detector_1__init__, 0, __pyx_n_s_three_detector___init, NULL, __pyx_n_s_soapcw_soapcw, __pyx_d, ((PyObject *)__pyx_codeobj__63)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 804, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_3, __pyx_tuple__64);
-  if (__Pyx_SetNameInClass(__pyx_t_2, __pyx_n_s_init, __pyx_t_3) < 0) __PYX_ERR(0, 747, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_2, __pyx_n_s_init, __pyx_t_3) < 0) __PYX_ERR(0, 804, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "soapcw/soapcw.pyx":760
+  /* "soapcw/soapcw.pyx":817
  *     #--------------------------------------------------------
  * 
  *     def run(self,tr1, obs11, obs21, obs31):             # <<<<<<<<<<<<<<
  *         """
  *         viterbi algorithm for multiple detectors 2 at the moment
  */
-  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6soapcw_6soapcw_14three_detector_3run, 0, __pyx_n_s_three_detector_run, NULL, __pyx_n_s_soapcw_soapcw, __pyx_d, ((PyObject *)__pyx_codeobj__66)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 760, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6soapcw_6soapcw_14three_detector_3run, 0, __pyx_n_s_three_detector_run, NULL, __pyx_n_s_soapcw_soapcw, __pyx_d, ((PyObject *)__pyx_codeobj__66)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 817, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  if (__Pyx_SetNameInClass(__pyx_t_2, __pyx_n_s_run, __pyx_t_3) < 0) __PYX_ERR(0, 760, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_2, __pyx_n_s_run, __pyx_t_3) < 0) __PYX_ERR(0, 817, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "soapcw/soapcw.pyx":745
+  /* "soapcw/soapcw.pyx":802
  * 
  * 
  * class three_detector(object):             # <<<<<<<<<<<<<<
  * 
  *     def __init__(self, tr, obs1, obs2, obs3, prog = False):
  */
-  __pyx_t_3 = __Pyx_Py3ClassCreate(__pyx_t_1, __pyx_n_s_three_detector, __pyx_tuple__61, __pyx_t_2, NULL, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 745, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_Py3ClassCreate(__pyx_t_1, __pyx_n_s_three_detector, __pyx_tuple__61, __pyx_t_2, NULL, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 802, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_three_detector, __pyx_t_3) < 0) __PYX_ERR(0, 745, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_three_detector, __pyx_t_3) < 0) __PYX_ERR(0, 802, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "soapcw/soapcw.pyx":915
+  /* "soapcw/soapcw.pyx":972
  *         #return np.array(vit_track1), np.array(vit_track2), np.array(vit_track3), np.array(vit_trackr), np.array(val),np.array(prev), max_prob
  * 
  * class single_detector_mem_n(object):             # <<<<<<<<<<<<<<
  * 
  *     def __init__(self, tr, obs, prog = False):
  */
-  __pyx_t_1 = __Pyx_CalculateMetaclass(NULL, __pyx_tuple__67); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 915, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_CalculateMetaclass(NULL, __pyx_tuple__67); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 972, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_Py3MetaclassPrepare(__pyx_t_1, __pyx_tuple__67, __pyx_n_s_single_detector_mem_n, __pyx_n_s_single_detector_mem_n, (PyObject *) NULL, __pyx_n_s_soapcw_soapcw, (PyObject *) NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 915, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_Py3MetaclassPrepare(__pyx_t_1, __pyx_tuple__67, __pyx_n_s_single_detector_mem_n, __pyx_n_s_single_detector_mem_n, (PyObject *) NULL, __pyx_n_s_soapcw_soapcw, (PyObject *) NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 972, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
 
-  /* "soapcw/soapcw.pyx":917
+  /* "soapcw/soapcw.pyx":974
  * class single_detector_mem_n(object):
  * 
  *     def __init__(self, tr, obs, prog = False):             # <<<<<<<<<<<<<<
  *         '''
  * 
  */
-  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6soapcw_6soapcw_21single_detector_mem_n_1__init__, 0, __pyx_n_s_single_detector_mem_n___init, NULL, __pyx_n_s_soapcw_soapcw, __pyx_d, ((PyObject *)__pyx_codeobj__69)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 917, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6soapcw_6soapcw_21single_detector_mem_n_1__init__, 0, __pyx_n_s_single_detector_mem_n___init, NULL, __pyx_n_s_soapcw_soapcw, __pyx_d, ((PyObject *)__pyx_codeobj__69)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 974, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_3, __pyx_tuple__70);
-  if (__Pyx_SetNameInClass(__pyx_t_2, __pyx_n_s_init, __pyx_t_3) < 0) __PYX_ERR(0, 917, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_2, __pyx_n_s_init, __pyx_t_3) < 0) __PYX_ERR(0, 974, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "soapcw/soapcw.pyx":932
+  /* "soapcw/soapcw.pyx":989
  *     #------------------------------------------------------------------------
  * 
  *     def run(self, tr, obs):             # <<<<<<<<<<<<<<
  *         ''' Run viterbi algroithm with memory of n
  *         the amount of memory is determined by the transition matrix
  */
-  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6soapcw_6soapcw_21single_detector_mem_n_3run, 0, __pyx_n_s_single_detector_mem_n_run, NULL, __pyx_n_s_soapcw_soapcw, __pyx_d, ((PyObject *)__pyx_codeobj__72)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 932, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6soapcw_6soapcw_21single_detector_mem_n_3run, 0, __pyx_n_s_single_detector_mem_n_run, NULL, __pyx_n_s_soapcw_soapcw, __pyx_d, ((PyObject *)__pyx_codeobj__72)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 989, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  if (__Pyx_SetNameInClass(__pyx_t_2, __pyx_n_s_run, __pyx_t_3) < 0) __PYX_ERR(0, 932, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_2, __pyx_n_s_run, __pyx_t_3) < 0) __PYX_ERR(0, 989, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "soapcw/soapcw.pyx":915
+  /* "soapcw/soapcw.pyx":972
  *         #return np.array(vit_track1), np.array(vit_track2), np.array(vit_track3), np.array(vit_trackr), np.array(val),np.array(prev), max_prob
  * 
  * class single_detector_mem_n(object):             # <<<<<<<<<<<<<<
  * 
  *     def __init__(self, tr, obs, prog = False):
  */
-  __pyx_t_3 = __Pyx_Py3ClassCreate(__pyx_t_1, __pyx_n_s_single_detector_mem_n, __pyx_tuple__67, __pyx_t_2, NULL, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 915, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_Py3ClassCreate(__pyx_t_1, __pyx_n_s_single_detector_mem_n, __pyx_tuple__67, __pyx_t_2, NULL, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 972, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_single_detector_mem_n, __pyx_t_3) < 0) __PYX_ERR(0, 915, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_single_detector_mem_n, __pyx_t_3) < 0) __PYX_ERR(0, 972, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "soapcw/soapcw.pyx":1069
+  /* "soapcw/soapcw.pyx":1126
  *         #return (vit_track,val,prev)
  * 
  * class two_detector_mem_n(object):             # <<<<<<<<<<<<<<
  * 
  *     def __init__(self, tr, obs1, obs2, prog = False):
  */
-  __pyx_t_1 = __Pyx_CalculateMetaclass(NULL, __pyx_tuple__73); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1069, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_CalculateMetaclass(NULL, __pyx_tuple__73); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1126, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_Py3MetaclassPrepare(__pyx_t_1, __pyx_tuple__73, __pyx_n_s_two_detector_mem_n, __pyx_n_s_two_detector_mem_n, (PyObject *) NULL, __pyx_n_s_soapcw_soapcw, (PyObject *) NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1069, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_Py3MetaclassPrepare(__pyx_t_1, __pyx_tuple__73, __pyx_n_s_two_detector_mem_n, __pyx_n_s_two_detector_mem_n, (PyObject *) NULL, __pyx_n_s_soapcw_soapcw, (PyObject *) NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1126, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
 
-  /* "soapcw/soapcw.pyx":1071
+  /* "soapcw/soapcw.pyx":1128
  * class two_detector_mem_n(object):
  * 
  *     def __init__(self, tr, obs1, obs2, prog = False):             # <<<<<<<<<<<<<<
  *         '''
  *         initialising viterbi class
  */
-  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6soapcw_6soapcw_18two_detector_mem_n_1__init__, 0, __pyx_n_s_two_detector_mem_n___init, NULL, __pyx_n_s_soapcw_soapcw, __pyx_d, ((PyObject *)__pyx_codeobj__75)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1071, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6soapcw_6soapcw_18two_detector_mem_n_1__init__, 0, __pyx_n_s_two_detector_mem_n___init, NULL, __pyx_n_s_soapcw_soapcw, __pyx_d, ((PyObject *)__pyx_codeobj__75)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1128, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_3, __pyx_tuple__76);
-  if (__Pyx_SetNameInClass(__pyx_t_2, __pyx_n_s_init, __pyx_t_3) < 0) __PYX_ERR(0, 1071, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_2, __pyx_n_s_init, __pyx_t_3) < 0) __PYX_ERR(0, 1128, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "soapcw/soapcw.pyx":1084
+  /* "soapcw/soapcw.pyx":1141
  * 
  * 
  *     def run(self, tr, obs11, obs22):             # <<<<<<<<<<<<<<
  *         ''' Run viterbi algroithm with memory of n
  *         the amount of memory is determined by the transition matrix
  */
-  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6soapcw_6soapcw_18two_detector_mem_n_3run, 0, __pyx_n_s_two_detector_mem_n_run, NULL, __pyx_n_s_soapcw_soapcw, __pyx_d, ((PyObject *)__pyx_codeobj__78)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1084, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6soapcw_6soapcw_18two_detector_mem_n_3run, 0, __pyx_n_s_two_detector_mem_n_run, NULL, __pyx_n_s_soapcw_soapcw, __pyx_d, ((PyObject *)__pyx_codeobj__78)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1141, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  if (__Pyx_SetNameInClass(__pyx_t_2, __pyx_n_s_run, __pyx_t_3) < 0) __PYX_ERR(0, 1084, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_2, __pyx_n_s_run, __pyx_t_3) < 0) __PYX_ERR(0, 1141, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "soapcw/soapcw.pyx":1069
+  /* "soapcw/soapcw.pyx":1126
  *         #return (vit_track,val,prev)
  * 
  * class two_detector_mem_n(object):             # <<<<<<<<<<<<<<
  * 
  *     def __init__(self, tr, obs1, obs2, prog = False):
  */
-  __pyx_t_3 = __Pyx_Py3ClassCreate(__pyx_t_1, __pyx_n_s_two_detector_mem_n, __pyx_tuple__73, __pyx_t_2, NULL, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1069, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_Py3ClassCreate(__pyx_t_1, __pyx_n_s_two_detector_mem_n, __pyx_tuple__73, __pyx_t_2, NULL, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1126, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_two_detector_mem_n, __pyx_t_3) < 0) __PYX_ERR(0, 1069, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_two_detector_mem_n, __pyx_t_3) < 0) __PYX_ERR(0, 1126, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "soapcw/soapcw.pyx":1262
+  /* "soapcw/soapcw.pyx":1319
  * ### ----------------------------------------------------------------
  * 
  * class single_detector_gaps(object):             # <<<<<<<<<<<<<<
  * 
  *     def __init__(self, tr, obs,times,tsft):
  */
-  __pyx_t_1 = __Pyx_CalculateMetaclass(NULL, __pyx_tuple__79); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1262, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_CalculateMetaclass(NULL, __pyx_tuple__79); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1319, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_Py3MetaclassPrepare(__pyx_t_1, __pyx_tuple__79, __pyx_n_s_single_detector_gaps, __pyx_n_s_single_detector_gaps, (PyObject *) NULL, __pyx_n_s_soapcw_soapcw, (PyObject *) NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1262, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_Py3MetaclassPrepare(__pyx_t_1, __pyx_tuple__79, __pyx_n_s_single_detector_gaps, __pyx_n_s_single_detector_gaps, (PyObject *) NULL, __pyx_n_s_soapcw_soapcw, (PyObject *) NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1319, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
 
-  /* "soapcw/soapcw.pyx":1264
+  /* "soapcw/soapcw.pyx":1321
  * class single_detector_gaps(object):
  * 
  *     def __init__(self, tr, obs,times,tsft):             # <<<<<<<<<<<<<<
  *         """
  *         single detector viterbi algorithm where the data can include large gaps in data
  */
-  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6soapcw_6soapcw_20single_detector_gaps_1__init__, 0, __pyx_n_s_single_detector_gaps___init, NULL, __pyx_n_s_soapcw_soapcw, __pyx_d, ((PyObject *)__pyx_codeobj__81)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1264, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6soapcw_6soapcw_20single_detector_gaps_1__init__, 0, __pyx_n_s_single_detector_gaps___init, NULL, __pyx_n_s_soapcw_soapcw, __pyx_d, ((PyObject *)__pyx_codeobj__81)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1321, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  if (__Pyx_SetNameInClass(__pyx_t_2, __pyx_n_s_init, __pyx_t_3) < 0) __PYX_ERR(0, 1264, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_2, __pyx_n_s_init, __pyx_t_3) < 0) __PYX_ERR(0, 1321, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "soapcw/soapcw.pyx":1290
+  /* "soapcw/soapcw.pyx":1347
  *         self.max_end_prob = max(self.vits[-1].V[-1])
  * 
  *     def max_track(self,tr,length,diff,bnd,ind,band_width):             # <<<<<<<<<<<<<<
  *         tr_val = np.arange(len(tr)).astype(int) - np.floor(len(tr)/2).astype(int)
  *         result = [seq for seq in itertools.combinations_with_replacement(tr_val, length) if sum(seq) == diff]
  */
-  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6soapcw_6soapcw_20single_detector_gaps_3max_track, 0, __pyx_n_s_single_detector_gaps_max_track, NULL, __pyx_n_s_soapcw_soapcw, __pyx_d, ((PyObject *)__pyx_codeobj__83)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1290, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6soapcw_6soapcw_20single_detector_gaps_3max_track, 0, __pyx_n_s_single_detector_gaps_max_track, NULL, __pyx_n_s_soapcw_soapcw, __pyx_d, ((PyObject *)__pyx_codeobj__83)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1347, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  if (__Pyx_SetNameInClass(__pyx_t_2, __pyx_n_s_max_track, __pyx_t_3) < 0) __PYX_ERR(0, 1290, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_2, __pyx_n_s_max_track, __pyx_t_3) < 0) __PYX_ERR(0, 1347, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "soapcw/soapcw.pyx":1315
+  /* "soapcw/soapcw.pyx":1372
  *         return max_seq,s
  * 
  *     def gap_run(self,viterbi, band_width, diff, tsft, tr):             # <<<<<<<<<<<<<<
  *         length = diff - 1
  *         max_vals = np.zeros(band_width)
  */
-  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6soapcw_6soapcw_20single_detector_gaps_5gap_run, 0, __pyx_n_s_single_detector_gaps_gap_run, NULL, __pyx_n_s_soapcw_soapcw, __pyx_d, ((PyObject *)__pyx_codeobj__85)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1315, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6soapcw_6soapcw_20single_detector_gaps_5gap_run, 0, __pyx_n_s_single_detector_gaps_gap_run, NULL, __pyx_n_s_soapcw_soapcw, __pyx_d, ((PyObject *)__pyx_codeobj__85)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1372, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  if (__Pyx_SetNameInClass(__pyx_t_2, __pyx_n_s_gap_run, __pyx_t_3) < 0) __PYX_ERR(0, 1315, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_2, __pyx_n_s_gap_run, __pyx_t_3) < 0) __PYX_ERR(0, 1372, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "soapcw/soapcw.pyx":1346
+  /* "soapcw/soapcw.pyx":1403
  *         return max_vals, max_paths
  * 
  *     def find_path(self,prev,end_ind):             # <<<<<<<<<<<<<<
  *         length = len(prev)
  *         previous = prev[-1][end_ind]
  */
-  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6soapcw_6soapcw_20single_detector_gaps_7find_path, 0, __pyx_n_s_single_detector_gaps_find_path, NULL, __pyx_n_s_soapcw_soapcw, __pyx_d, ((PyObject *)__pyx_codeobj__87)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1346, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6soapcw_6soapcw_20single_detector_gaps_7find_path, 0, __pyx_n_s_single_detector_gaps_find_path, NULL, __pyx_n_s_soapcw_soapcw, __pyx_d, ((PyObject *)__pyx_codeobj__87)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1403, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  if (__Pyx_SetNameInClass(__pyx_t_2, __pyx_n_s_find_path, __pyx_t_3) < 0) __PYX_ERR(0, 1346, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_2, __pyx_n_s_find_path, __pyx_t_3) < 0) __PYX_ERR(0, 1403, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "soapcw/soapcw.pyx":1358
+  /* "soapcw/soapcw.pyx":1415
  * 
  * 
  *     def vit_gaps(self,data1,epochs1,tr,tsft):             # <<<<<<<<<<<<<<
  * 
  *         band_width = len(data1[0])
  */
-  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6soapcw_6soapcw_20single_detector_gaps_9vit_gaps, 0, __pyx_n_s_single_detector_gaps_vit_gaps, NULL, __pyx_n_s_soapcw_soapcw, __pyx_d, ((PyObject *)__pyx_codeobj__89)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1358, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6soapcw_6soapcw_20single_detector_gaps_9vit_gaps, 0, __pyx_n_s_single_detector_gaps_vit_gaps, NULL, __pyx_n_s_soapcw_soapcw, __pyx_d, ((PyObject *)__pyx_codeobj__89)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1415, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  if (__Pyx_SetNameInClass(__pyx_t_2, __pyx_n_s_vit_gaps, __pyx_t_3) < 0) __PYX_ERR(0, 1358, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_2, __pyx_n_s_vit_gaps, __pyx_t_3) < 0) __PYX_ERR(0, 1415, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "soapcw/soapcw.pyx":1442
+  /* "soapcw/soapcw.pyx":1499
  *         return vit,starts, gappaths
  * 
  *     def get_track(self,vit,starts,gappaths,tsft=1):             # <<<<<<<<<<<<<<
  *         vit_track = []
  *         vit_track_time = []
  */
-  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6soapcw_6soapcw_20single_detector_gaps_11get_track, 0, __pyx_n_s_single_detector_gaps_get_track, NULL, __pyx_n_s_soapcw_soapcw, __pyx_d, ((PyObject *)__pyx_codeobj__91)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1442, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6soapcw_6soapcw_20single_detector_gaps_11get_track, 0, __pyx_n_s_single_detector_gaps_get_track, NULL, __pyx_n_s_soapcw_soapcw, __pyx_d, ((PyObject *)__pyx_codeobj__91)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1499, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_3, __pyx_tuple__92);
-  if (__Pyx_SetNameInClass(__pyx_t_2, __pyx_n_s_get_track, __pyx_t_3) < 0) __PYX_ERR(0, 1442, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_2, __pyx_n_s_get_track, __pyx_t_3) < 0) __PYX_ERR(0, 1499, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "soapcw/soapcw.pyx":1262
+  /* "soapcw/soapcw.pyx":1319
  * ### ----------------------------------------------------------------
  * 
  * class single_detector_gaps(object):             # <<<<<<<<<<<<<<
  * 
  *     def __init__(self, tr, obs,times,tsft):
  */
-  __pyx_t_3 = __Pyx_Py3ClassCreate(__pyx_t_1, __pyx_n_s_single_detector_gaps, __pyx_tuple__79, __pyx_t_2, NULL, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1262, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_Py3ClassCreate(__pyx_t_1, __pyx_n_s_single_detector_gaps, __pyx_tuple__79, __pyx_t_2, NULL, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1319, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_single_detector_gaps, __pyx_t_3) < 0) __PYX_ERR(0, 1262, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_single_detector_gaps, __pyx_t_3) < 0) __PYX_ERR(0, 1319, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
   /* "soapcw/soapcw.pyx":1
  * # cython: language_level=3             # <<<<<<<<<<<<<<
  * from __future__ import division
```

### Comparing `soapcw-0.1.7/soapcw/soapcw.pyx` & `soapcw-0.1.8/soapcw/soapcw.pyx`

 * *Files 2% similar despite different names*

```diff
@@ -9,15 +9,15 @@
 from sys import stdout
 from libc.math cimport log,exp,sqrt 
 #from scipy.interpolate import interp2d,RectBivariateSpline
 from scipy.special import logsumexp
 
 class single_detector(object):
  
-    def __init__(self, tr, obs, prog = False, lookup_file=None, make_vitmap = True):
+    def __init__(self, tr, obs, prog = False, lookup_table=None, make_vitmap = True):
         '''
         initialising viterbi class
         '''
         self.prog = prog
         
         # make sure input data of right type
         tr = np.array(tr).astype('double')
@@ -25,15 +25,15 @@
 
         # make sure input data of right shape
         if len(np.shape(tr)) != 1:
             raise Exception("transition matrix wrong shape, should be Kx1 array")
         if len(np.shape(obs)) != 2:
             raise Exception("observation wrong shape, should be NxM array")
         
-        self.run(tr, obs, lookup_file)
+        self.run(tr, obs, lookup_table)
         if make_vitmap:
             self.get_vitmap()
 
         
     #------------------------------------------------------------------------------------------------
     # Get Viterbi map
     #------------------------------------------------------------------------------------------------
@@ -53,32 +53,39 @@
 
         self.vitmap = path_m
 
     #------------------------
     # Read lookup table
     #--------------------------
     
-    def read_lookup(self,filename):
+    def read_lookup(self,lookup_table):
         """
         Read the lookup table for chosen statistic
         """
-        with open(filename,'rb') as f1:
-            likelihood, params = pickle.load(f1)
-        ranges = np.linspace(params["power_ranges"][0],params["power_ranges"][1],int(params["power_ranges"][2]))
-        fact = abs(1./(ranges[0] - ranges[1]))
+        if isinstance(lookup_table, str):
+            with open(lookup_table,'rb') as f1:
+                likelihood, params = pickle.load(f1)
+            ranges = np.linspace(params["power_ranges"][0],params["power_ranges"][1],int(params["power_ranges"][2]))
+            fact = abs(1./(ranges[0] - ranges[1]))
+        else:
+            # if it is a line aware stat object then creat ranges from the object
+            # get the log odds ratio as the statitsic to use 
+            likelihood = np.log(lookup_table.signoiseline)
+            ranges = lookup_table.powers
+            fact = abs(1./(ranges[0] - ranges[1]))
         
         return likelihood, ranges, fact
     
     
     #-------------------------------------------------------------------------------------------------
     # Basic Viterbi Algorithm
     #-------------------------------------------------------------------------------------------------
 
     
-    def run(self,double[:] tr, double[:, :] obs, lookup_file = None):
+    def run(self,double[:] tr, double[:, :] obs, lookup_table = None):
         '''
         Run the viterbi algorithm for given single set of data and 3x1 transition matrix.
         This returns the track through the data which gives the largest sum of power.
         Args
         ------
         tr: array
             transition matrix of sixe Kx1
@@ -115,17 +122,17 @@
         # find half width of transntion, i.e. number of bins up and down it can move
         cdef int tr_width = int((tr_length-1)/2 )
 
         # vectors to store lookup tables
         cdef double[:] logarr
         cdef double fact
         cdef int[:,:] obs_ind
-        if lookup_file is not None:
+        if lookup_table is not None:
             # get log statistic, the ranges of lookuptable and spacing factor
-            logarr, ranges, fact = self.read_lookup(lookup_file)
+            logarr, ranges, fact = self.read_lookup(lookup_table)
             # shift observation to index for array
             obs_ind_arr = (obs - ranges[0])*fact
             obs_ind_arr[obs_ind_arr >= len(ranges)] = len(ranges)-1
             obs_ind_arr[obs_ind_arr < 0] = 0
             # save array to vector
             obs_ind = np.array(obs_ind_arr).astype(np.int32)
             del obs_ind_arr
@@ -185,31 +192,31 @@
         self.max_end_prob = max_end_prob
         self.V = np.array(V)
         self.prev = np.array(prev)
         
 
 class two_detector(object):
  
-    def __init__(self, tr, obs1, obs2, lookup_file_2det = None, lookup_file_1det = None, prog = False,fractions=None, make_vitmap=True):
+    def __init__(self, tr, obs1, obs2, lookup_table_2det = None, lookup_table_1det = None, prog = False,fractions=None, make_vitmap=True):
         '''
         viterbi algorithm for two detectors with an optional line aware statistic
         uses S = \frac{p(ss \mid x)}{p(nn \mid x)+p(ns \mid x)+p(sn \mid x)}
         [currently configured for averaging over 48 SFT need to change to correctly use any]
         Args
         ---------
         tr1: array
             transition matrix
         obs11: array
             observation from detector 1 (float64 array)
         obs21: array
             observation from detector 2 (float64 array)
-        lookup_file_1det: string (optional)
-            filepath of lookup table for the one detector case
-        lookup_file_2det: string ( optional)
-            filepath of lookup table for the two detector case
+        lookup_table_1det: string (optional)
+            filepath of lookup table for the one detector case or LineAwareStatistic claess
+        lookup_table_2det: string ( optional)
+            filepath of lookup table for the two detector caseor LineAwareStatistic claess 
         prog: bool (optional)
             show progress bar if True 
         fractions: array (optional)
             array of the ratio of the noise floor and amount of data between detectors
         returns
         -----------
         vit_track1: array
@@ -233,18 +240,18 @@
             raise Exception("Please make sure teh two input data have the same dimensions")
 
         tr = np.array(tr).astype('double')
         obs1 = np.array(obs1).astype('double')
         obs2 = np.array(obs2).astype('double')
         self.prog = prog
 
-        if fractions is not None and lookup_file_2det is not None:
-            self.run_lookup_amp(tr, obs1, obs2,lookup_file=lookup_file_2det,fractions=fractions)
+        if fractions is not None and lookup_table_2det is not None:
+            self.run_lookup_amp(tr, obs1, obs2,lookup_table=lookup_table_2det,fractions=fractions)
         else:
-            self.run(tr, obs1, obs2,lookup_file_1det=lookup_file_1det, lookup_file_2det=lookup_file_2det)
+            self.run(tr, obs1, obs2,lookup_table_1det=lookup_table_1det, lookup_table_2det=lookup_table_2det)
             
         self.get_track()
         if make_vitmap:
             self.get_vitmap()
 
     #------------------------------------------------------------------------------------------------
     # Get Viterbi map
@@ -266,55 +273,105 @@
         self.vitmap = path_m
 
 
     #--------------------------------------------------------
     # Read lookup tables
     #--------------------------------------------------------
 
-    def read_lookup(self,filename):
-                
-        with open(filename,'rb') as f1:
-            likelihood, params = pickle.load(f1)
+    def read_lookup(self,lookup_table):
+        """
+        Read a lookup table from a file of a LineAwareStatistic object
+        args 
+        ------
+        lookup_table: string or LineAwareStatistic
+            filename to saved lookupt table or lineaware statistic object
+        returns
+        ---------
+        likelihood: array
+            returns odds ratio from file to use as statistic
+        ranges: array
+            ranges of the x,y axis of the odds ratio
+        fact: float
+            spacing of the ranges
+        """
 
-        ranges = np.linspace(params["power_ranges"][0],params["power_ranges"][1],int(params["power_ranges"][2]))
-        fact = abs(1./(ranges[0] - ranges[1]))
+        if isinstance(lookup_table, str):
+            # if it is a filename the load the file and create ranges from that
+            with open(lookup_table,'rb') as f1:
+                likelihood, params = pickle.load(f1)
+
+            ranges = np.linspace(params["power_ranges"][0],params["power_ranges"][1],int(params["power_ranges"][2]))
+            fact = abs(1./(ranges[0] - ranges[1]))
+        else:
+            # if it is a line aware stat object then creat ranges from the object
+            # get the log odds ratio as the statitsic to use 
+            likelihood = np.log(lookup_table.signoiseline)
+            ranges = lookup_table.powers
+            fact = abs(1./(ranges[0] - ranges[1]))
         
         return likelihood, ranges, fact
 
-    def read_lookup_amp(self,filename):
-                
-        with open(filename,'rb') as f1:
-            likelihood, params = pickle.load(f1)
-
-        pow_ranges = np.linspace(params["power_ranges"][0],params["power_ranges"][1],int(params["power_ranges"][2]))
-        frac_ranges = np.linspace(params["fraction_ranges"][0],params["fraction_ranges"][1],int(params["fraction_ranges"][2]))
-        pow_fact = abs(1./(pow_ranges[0] - pow_ranges[1]))
-        frac_fact = abs(1./(frac_ranges[0] - frac_ranges[1]))
+    def read_lookup_amp(self,lookup_table):
+        """
+        Read a lookup table from a file of a LineAwareStatisticAmplitude object
+        args 
+        ------
+        lookup_table: string or LineAwareStatisticAmplitude
+            filename to saved lookupt table or lineaware statistic object
+        returns
+        ---------
+        likelihood: array
+            returns odds ratio from file to use as statistic
+        pow_ranges: array
+            ranges of the x,y axis of the odds ratio (spectrogram power)
+        frac_ranges: array
+            ranges of the x,y axis of the odds ratio ()
+        pow_fact: float
+            spacing of the ranges of power
+        frac_fact: float
+            spacing of the ranges of data fraction
+        """
+        if isinstance(lookup_table, str):  
+            with open(lookup_table,'rb') as f1:
+                likelihood, params = pickle.load(f1)
+
+            pow_ranges = np.linspace(params["power_ranges"][0],params["power_ranges"][1],int(params["power_ranges"][2]))
+            frac_ranges = np.linspace(params["fraction_ranges"][0],params["fraction_ranges"][1],int(params["fraction_ranges"][2]))
+            pow_fact = abs(1./(pow_ranges[0] - pow_ranges[1]))
+            frac_fact = abs(1./(frac_ranges[0] - frac_ranges[1]))
+        else:
+            # if it is a line aware stat object then creat ranges from the object
+            # get the log odds ratio as the statitsic to use 
+            likelihood = np.log(lookup_table.signoiseline)
+            pow_ranges = lookup_table.powers
+            frac_ranges = lookup_table.fractions
+            pow_fact = abs(1./(pow_ranges[0] - pow_ranges[1]))
+            frac_fact = abs(1./(frac_ranges[0] - frac_ranges[1]))
         
         return likelihood.T, pow_ranges, frac_ranges, pow_fact, frac_fact
 
     
     #---------------------------------------------------------
     # Two detector viterbi
     #--------------------------------------------------------
 
-    def run(self,transition, obs1, obs2, lookup_file_1det = None,lookup_file_2det = None):
+    def run(self,transition, obs1, obs2, lookup_table_1det = None,lookup_table_2det = None):
         """
         viterbi algorithm for two detectors with an lookup table for the line veto statistic
 
         Where there is only one detectors data use the single detector search with the same statistic
         Args
         ---------
         tr1: array
             transition matrix
         obs11: array
             observation from detector 1
         obs21: array
             observation from detector 2 
-        lookup_file: float
+        lookup_table: float
             links to a file which contains a 2d lookup table
         returns
         -----------
         V: array
             viterbi values in reference detector
         prev: array
             previous positions before jump
@@ -363,31 +420,31 @@
         cdef double fact_2d
         cdef int[:,:] obs1_ind_1d
         cdef int[:,:] obs1_ind_2d
 
         obs1data = np.array([len(np.unique(obs1seg)) for obs1seg in obs1]) != 1
         obs2data = np.array([len(np.unique(obs2seg)) for obs2seg in obs2]) != 1
         
-        if lookup_file_1det is not None:
-            logarr_1d, ranges_1d, fact_1d = self.read_lookup(lookup_file_1det)
+        if lookup_table_1det is not None:
+            logarr_1d, ranges_1d, fact_1d = self.read_lookup(lookup_table_1det)
             
             obs1_ind_arr_1d = (obs1 - ranges_1d[0])*fact_1d
             obs1_ind_arr_1d[obs1_ind_arr_1d >= len(ranges_1d)] = len(ranges_1d)-1
             obs1_ind_arr_1d[obs1_ind_arr_1d < 0] = 0
             obs1_ind_1d = np.array(obs1_ind_arr_1d).astype(np.int32)
             del obs1_ind_arr_1d
 
             obs2_ind_arr_1d = (obs2-ranges_1d[0])*fact_1d
             obs2_ind_arr_1d[obs2_ind_arr_1d >= len(ranges_1d)] = len(ranges_1d)-1
             obs2_ind_arr_1d[obs2_ind_arr_1d < 0] = 0
             obs2_ind_1d = np.array(obs2_ind_arr_1d).astype(np.int32)
             del obs2_ind_arr_1d
 
-        if lookup_file_2det is not None:
-            logarr, ranges_2d, fact_2d = self.read_lookup(lookup_file_2det)
+        if lookup_table_2det is not None:
+            logarr, ranges_2d, fact_2d = self.read_lookup(lookup_table_2det)
             diag = copy.copy(np.diag(logarr))
             logarr_2d = logarr
 
             # normalise the input powers to the ranges of lookup table so they are now indices
             obs1_ind_arr_2d = (obs1 - ranges_2d[0])*fact_2d
             # set powers outside range to end index
             obs1_ind_arr_2d[obs1_ind_arr_2d >= len(ranges_2d)] = len(ranges_2d)-1
@@ -396,26 +453,26 @@
 
             # same for second detector
             obs2_ind_arr_2d = (obs2-ranges_2d[0])*fact_2d
             obs2_ind_arr_2d[obs2_ind_arr_2d >= len(ranges_2d)] = len(ranges_2d)-1
             obs2_ind_arr_2d[obs2_ind_arr_2d < 0] = 0
             obs2_ind_2d = np.array(obs2_ind_arr_2d).astype(np.int32)
 
-            if lookup_file_1det is None:
+            if lookup_table_1det is None:
                 obs1_ind_1d = np.array(obs1_ind_arr_2d).astype(np.int32)
                 obs2_ind_1d = np.array(obs2_ind_arr_2d).astype(np.int32)
                 logarr_1d = diag
             
             del diag    
             del obs2_ind_arr_2d
             del obs1_ind_arr_2d
 
         sumv = False
 	# if no lookup tables provided then use the sum of the powers
-        if lookup_file_1det is None and lookup_file_2det is None:
+        if lookup_table_1det is None and lookup_table_2det is None:
             # if using the sum of power, set element of index to 2d array
             obs1_ind_1d = np.arange(np.prod(shape)).reshape(shape).astype(np.int32)
             obs1_ind_2d = np.arange(np.prod(shape)).reshape(shape).astype(np.int32)
             obs2_ind_1d = np.arange(np.prod(shape)).reshape(shape).astype(np.int32) + np.prod(shape)
             obs2_ind_2d = np.arange(np.prod(shape)).reshape(shape).astype(np.int32) + np.prod(shape)
             # flatten input spectrogram for access in 1d
             logarr_1d = np.ravel([obs1,obs2])
@@ -535,27 +592,27 @@
         self.V = np.array(val)
         self.prev = np.array(prev)
         self.det1 = np.array(det1)
         self.det2 = np.array(det2)
         self.width = width
         self.length = length
 
-    def run_lookup_amp(self,tr1, obs11, obs21,lookup_file = None, fractions = None):
+    def run_lookup_amp(self,tr1, obs11, obs21,lookup_table = None, fractions = None):
         """
         viterbi algorithm for two detectors with an lookup table for the line veto statistic
         Args
         ---------
         tr1: array
             transition matrix
         obs11: array
             observation from detector 1
         obs21: array
             observation from detector 2 
-        lookup_file: float
-            links to a file which contains a 2d lookup table
+        lookup_table: float
+            links to a file which contains a 2d lookup table or LineAwareStatistic class
         returns
         -----------
         V: array
             viterbi values in reference detector
         prev: array
             previous positions before jump
         """
@@ -595,15 +652,15 @@
         cdef double temp
         cdef int edge_range = 0
 
 
         cdef double fact
         cdef double fact_frac
 
-        likelihood, pow_ranges, frac_ranges, pow_fact, frac_fact = self.read_lookup_amp(lookup_file)
+        likelihood, pow_ranges, frac_ranges, pow_fact, frac_fact = self.read_lookup_amp(lookup_table)
 
         # define the likelihood as two array one which is the transpose of the other, such that the fractions of time one detector can always be compared with a value less than 1
         shp = np.shape(likelihood)
         logarr1 = np.zeros((2,shp[0],shp[1],shp[2]))
         logarr1[0] = likelihood
         logarr1[1] = ([np.array(lkl).T for lkl in likelihood])
         cdef double[:,:,:,:] logarr = logarr1
```

### Comparing `soapcw-0.1.7/soapcw/tools/plots.py` & `soapcw-0.1.8/soapcw/tools/plots.py`

 * *Files identical despite different names*

### Comparing `soapcw-0.1.7/soapcw/tools/tools.py` & `soapcw-0.1.8/soapcw/tools/tools.py`

 * *Files identical despite different names*

### Comparing `soapcw-0.1.7/soapcw.egg-info/PKG-INFO` & `soapcw-0.1.8/soapcw.egg-info/PKG-INFO`

 * *Files 5% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: soapcw
-Version: 0.1.7
+Version: 0.1.8
 Summary: SOAP is a rapid algorithm to search for continuous sources of gravitational waves, with a wider application to long duration narrowband signals.
 Home-page: https://git.ligo.org/joseph.bayley/soapcw
 Author: Joe Bayley
 Author-email: joseph.bayley@glasgow.ac.uk
 License: MIT license
 Download-URL: https://git.ligo.org/joseph.bayley/soapcw/-/archive/0.1.2/soapcw-0.1.2.tar.gz
 Keywords: soapcw,soap,gravitational waves,pulsars,neutron stars,continuous waves
@@ -26,15 +26,15 @@
 
 .. image:: https://img.shields.io/pypi/v/soap.svg
         :target: https://pypi.python.org/pypi/soap
 
 SOAP: Applying the Viterbi algorithm to search for sources
 of continuous gravitational waves.
 
-.. image:: https://git.ligo.org/joseph.bayley/soapcw/-/raw/master/soapcw/summary_pages/images/vitmap_ex.png
+.. image:: https://git.ligo.org/joseph.bayley/soapcw/-/raw/master/pipeline/images/vitmap_ex.png
 
 SOAP is primarily developed to search for continuous sources of
 gravitational waves, however, has a more general application to search
 for and long duration weak signal.
 
 This package also includes tools to load in standard short Fourier transforms (SFTs) and prepare them for usage with the core SOAP search.
 
@@ -71,8 +71,13 @@
 =======
 
 0.1.0 (2019-04-23)
 ------------------
 
 * First release on PyPI.
 
+0.1.8 (2023-07-05)
+------------------
+
+* New release with CNNs
+
```

### Comparing `soapcw-0.1.7/soapcw.egg-info/SOURCES.txt` & `soapcw-0.1.8/soapcw.egg-info/SOURCES.txt`

 * *Files 13% similar despite different names*

```diff
@@ -11,14 +11,17 @@
 docs/conf.py
 docs/contributing.rst
 docs/history.rst
 docs/index.rst
 docs/installation.rst
 docs/make.bat
 docs/readme.rst
+docs/cnn_usage/data_generation.rst
+docs/cnn_usage/index.rst
+docs/cnn_usage/train_model.rst
 docs/pipeline_usage/index.rst
 docs/pipeline_usage/run_pipeline.rst
 docs/usage/index.rst
 pipeline/__init__.py
 pipeline/make_dag_files_astro.py
 pipeline/make_dag_files_lines.py
 pipeline/make_html_page.py
@@ -45,17 +48,15 @@
 soapcw/cnn/generate_gaussian_train_data.py
 soapcw/cnn/generate_test_data.py
 soapcw/cnn/generate_train_data.py
 soapcw/cnn/narrowband_sfts.py
 soapcw/cnn/train_model.py
 soapcw/cnn/pytorch/__init__.py
 soapcw/cnn/pytorch/load_models.py
-soapcw/cnn/pytorch/models/__init__.py
-soapcw/cnn/pytorch/models/cnn.py
-soapcw/cnn/pytorch/models/combined_cnn.py
+soapcw/cnn/pytorch/models.py
 soapcw/cw/__init__.py
 soapcw/cw/generate_data.py
 soapcw/cw/load_sfts.py
 soapcw/cw/make_sfts.py
 soapcw/cw/sft.py
 soapcw/cw/timeseries.py
 soapcw/cw/tools.py
```

### Comparing `soapcw-0.1.7/tests/SNR_injections.ipynb` & `soapcw-0.1.8/tests/SNR_injections.ipynb`

 * *Files identical despite different names*

### Comparing `soapcw-0.1.7/tests/test_cwload.py` & `soapcw-0.1.8/tests/test_cwload.py`

 * *Files identical despite different names*

### Comparing `soapcw-0.1.7/tests/test_line_aware_stat.py` & `soapcw-0.1.8/tests/test_line_aware_stat.py`

 * *Files identical despite different names*

### Comparing `soapcw-0.1.7/tests/test_soap.py` & `soapcw-0.1.8/tests/test_soap.py`

 * *Files identical despite different names*

