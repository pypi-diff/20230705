# Comparing `tmp/odoo_addon_hr_attendance_geolocation-15.0.1.0.3.2-py3-none-any.whl.zip` & `tmp/odoo_addon_hr_attendance_geolocation-16.0.1.0.1.3-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,25 +1,22 @@
-Zip file size: 27830 bytes, number of entries: 23
--rw-r--r--  2.0 unx     2962 b- defN 23-Jul-05 03:28 odoo/addons/hr_attendance_geolocation/README.rst
--rw-r--r--  2.0 unx       21 b- defN 23-Jul-05 03:28 odoo/addons/hr_attendance_geolocation/__init__.py
--rw-r--r--  2.0 unx      981 b- defN 23-Jul-05 03:28 odoo/addons/hr_attendance_geolocation/__manifest__.py
--rw-r--r--  2.0 unx      247 b- defN 23-Jul-05 03:28 odoo/addons/hr_attendance_geolocation/data/location_data.xml
--rw-r--r--  2.0 unx     2787 b- defN 23-Jul-05 03:28 odoo/addons/hr_attendance_geolocation/i18n/hr_attendance_geolocation.pot
--rw-r--r--  2.0 unx     3221 b- defN 23-Jul-05 03:28 odoo/addons/hr_attendance_geolocation/i18n/it.po
--rw-r--r--  2.0 unx       54 b- defN 23-Jul-05 03:28 odoo/addons/hr_attendance_geolocation/models/__init__.py
--rw-r--r--  2.0 unx     2811 b- defN 23-Jul-05 03:28 odoo/addons/hr_attendance_geolocation/models/hr_attendance.py
--rw-r--r--  2.0 unx      973 b- defN 23-Jul-05 03:28 odoo/addons/hr_attendance_geolocation/models/hr_employee.py
--rw-r--r--  2.0 unx      178 b- defN 23-Jul-05 03:28 odoo/addons/hr_attendance_geolocation/readme/CONTRIBUTORS.rst
--rw-r--r--  2.0 unx      148 b- defN 23-Jul-05 03:28 odoo/addons/hr_attendance_geolocation/readme/DESCRIPTION.rst
--rw-r--r--  2.0 unx     9455 b- defN 23-Jul-05 03:28 odoo/addons/hr_attendance_geolocation/static/description/icon.png
--rw-r--r--  2.0 unx    12194 b- defN 23-Jul-05 03:28 odoo/addons/hr_attendance_geolocation/static/description/index.html
--rw-r--r--  2.0 unx     1581 b- defN 23-Jul-05 03:28 odoo/addons/hr_attendance_geolocation/static/src/js/attendance_geolocation.js
--rw-r--r--  2.0 unx     2437 b- defN 23-Jul-05 03:28 odoo/addons/hr_attendance_geolocation/static/src/js/geolocation_service_legacy.js
--rw-r--r--  2.0 unx     1018 b- defN 23-Jul-05 03:28 odoo/addons/hr_attendance_geolocation/static/src/js/geolocation_user_context_legacy.esm.js
--rw-r--r--  2.0 unx       45 b- defN 23-Jul-05 03:28 odoo/addons/hr_attendance_geolocation/tests/__init__.py
--rw-r--r--  2.0 unx     1363 b- defN 23-Jul-05 03:28 odoo/addons/hr_attendance_geolocation/tests/test_hr_attendance_geolocation.py
--rw-r--r--  2.0 unx     2521 b- defN 23-Jul-05 03:28 odoo/addons/hr_attendance_geolocation/views/hr_attendance_views.xml
--rw-r--r--  2.0 unx     3602 b- defN 23-Jul-05 03:28 odoo_addon_hr_attendance_geolocation-15.0.1.0.3.2.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 23-Jul-05 03:28 odoo_addon_hr_attendance_geolocation-15.0.1.0.3.2.dist-info/WHEEL
--rw-r--r--  2.0 unx        5 b- defN 23-Jul-05 03:28 odoo_addon_hr_attendance_geolocation-15.0.1.0.3.2.dist-info/top_level.txt
--rw-rw-r--  2.0 unx     2720 b- defN 23-Jul-05 03:28 odoo_addon_hr_attendance_geolocation-15.0.1.0.3.2.dist-info/RECORD
-23 files, 51416 bytes uncompressed, 23104 bytes compressed:  55.1%
+Zip file size: 25143 bytes, number of entries: 20
+-rw-r--r--  2.0 unx     2804 b- defN 23-Jan-17 14:28 odoo/addons/hr_attendance_geolocation/README.rst
+-rw-r--r--  2.0 unx       21 b- defN 23-Jan-17 14:28 odoo/addons/hr_attendance_geolocation/__init__.py
+-rw-r--r--  2.0 unx      720 b- defN 23-Jan-17 14:28 odoo/addons/hr_attendance_geolocation/__manifest__.py
+-rw-r--r--  2.0 unx      247 b- defN 23-Jan-17 14:28 odoo/addons/hr_attendance_geolocation/data/location_data.xml
+-rw-r--r--  2.0 unx     2787 b- defN 23-Jan-17 14:28 odoo/addons/hr_attendance_geolocation/i18n/hr_attendance_geolocation.pot
+-rw-r--r--  2.0 unx       54 b- defN 23-Jan-17 14:28 odoo/addons/hr_attendance_geolocation/models/__init__.py
+-rw-r--r--  2.0 unx     2811 b- defN 23-Jan-17 14:28 odoo/addons/hr_attendance_geolocation/models/hr_attendance.py
+-rw-r--r--  2.0 unx      973 b- defN 23-Jan-17 14:28 odoo/addons/hr_attendance_geolocation/models/hr_employee.py
+-rw-r--r--  2.0 unx       47 b- defN 23-Jan-17 14:28 odoo/addons/hr_attendance_geolocation/readme/CONTRIBUTORS.rst
+-rw-r--r--  2.0 unx      148 b- defN 23-Jan-17 14:28 odoo/addons/hr_attendance_geolocation/readme/DESCRIPTION.rst
+-rw-r--r--  2.0 unx     9455 b- defN 23-Jan-17 14:28 odoo/addons/hr_attendance_geolocation/static/description/icon.png
+-rw-r--r--  2.0 unx    11923 b- defN 23-Jan-17 14:28 odoo/addons/hr_attendance_geolocation/static/description/index.html
+-rw-r--r--  2.0 unx     5311 b- defN 23-Jan-17 14:28 odoo/addons/hr_attendance_geolocation/static/src/js/attendance_geolocation.js
+-rw-r--r--  2.0 unx       45 b- defN 23-Jan-17 14:28 odoo/addons/hr_attendance_geolocation/tests/__init__.py
+-rw-r--r--  2.0 unx     1439 b- defN 23-Jan-17 14:28 odoo/addons/hr_attendance_geolocation/tests/test_hr_attendance_geolocation.py
+-rw-r--r--  2.0 unx     2521 b- defN 23-Jan-17 14:28 odoo/addons/hr_attendance_geolocation/views/hr_attendance_views.xml
+-rw-r--r--  2.0 unx     3420 b- defN 23-Jan-17 14:28 odoo_addon_hr_attendance_geolocation-16.0.1.0.1.3.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 23-Jan-17 14:28 odoo_addon_hr_attendance_geolocation-16.0.1.0.1.3.dist-info/WHEEL
+-rw-r--r--  2.0 unx        5 b- defN 23-Jan-17 14:28 odoo_addon_hr_attendance_geolocation-16.0.1.0.1.3.dist-info/top_level.txt
+?rw-rw-r--  2.0 unx     2329 b- defN 23-Jan-17 14:28 odoo_addon_hr_attendance_geolocation-16.0.1.0.1.3.dist-info/RECORD
+20 files, 47152 bytes uncompressed, 21083 bytes compressed:  55.3%
```

## zipnote {}

```diff
@@ -9,17 +9,14 @@
 
 Filename: odoo/addons/hr_attendance_geolocation/data/location_data.xml
 Comment: 
 
 Filename: odoo/addons/hr_attendance_geolocation/i18n/hr_attendance_geolocation.pot
 Comment: 
 
-Filename: odoo/addons/hr_attendance_geolocation/i18n/it.po
-Comment: 
-
 Filename: odoo/addons/hr_attendance_geolocation/models/__init__.py
 Comment: 
 
 Filename: odoo/addons/hr_attendance_geolocation/models/hr_attendance.py
 Comment: 
 
 Filename: odoo/addons/hr_attendance_geolocation/models/hr_employee.py
@@ -36,35 +33,29 @@
 
 Filename: odoo/addons/hr_attendance_geolocation/static/description/index.html
 Comment: 
 
 Filename: odoo/addons/hr_attendance_geolocation/static/src/js/attendance_geolocation.js
 Comment: 
 
-Filename: odoo/addons/hr_attendance_geolocation/static/src/js/geolocation_service_legacy.js
-Comment: 
-
-Filename: odoo/addons/hr_attendance_geolocation/static/src/js/geolocation_user_context_legacy.esm.js
-Comment: 
-
 Filename: odoo/addons/hr_attendance_geolocation/tests/__init__.py
 Comment: 
 
 Filename: odoo/addons/hr_attendance_geolocation/tests/test_hr_attendance_geolocation.py
 Comment: 
 
 Filename: odoo/addons/hr_attendance_geolocation/views/hr_attendance_views.xml
 Comment: 
 
-Filename: odoo_addon_hr_attendance_geolocation-15.0.1.0.3.2.dist-info/METADATA
+Filename: odoo_addon_hr_attendance_geolocation-16.0.1.0.1.3.dist-info/METADATA
 Comment: 
 
-Filename: odoo_addon_hr_attendance_geolocation-15.0.1.0.3.2.dist-info/WHEEL
+Filename: odoo_addon_hr_attendance_geolocation-16.0.1.0.1.3.dist-info/WHEEL
 Comment: 
 
-Filename: odoo_addon_hr_attendance_geolocation-15.0.1.0.3.2.dist-info/top_level.txt
+Filename: odoo_addon_hr_attendance_geolocation-16.0.1.0.1.3.dist-info/top_level.txt
 Comment: 
 
-Filename: odoo_addon_hr_attendance_geolocation-15.0.1.0.3.2.dist-info/RECORD
+Filename: odoo_addon_hr_attendance_geolocation-16.0.1.0.1.3.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## odoo/addons/hr_attendance_geolocation/README.rst

```diff
@@ -10,21 +10,21 @@
 .. |badge1| image:: https://img.shields.io/badge/maturity-Beta-yellow.png
     :target: https://odoo-community.org/page/development-status
     :alt: Beta
 .. |badge2| image:: https://img.shields.io/badge/licence-AGPL--3-blue.png
     :target: http://www.gnu.org/licenses/agpl-3.0-standalone.html
     :alt: License: AGPL-3
 .. |badge3| image:: https://img.shields.io/badge/github-OCA%2Fhr--attendance-lightgray.png?logo=github
-    :target: https://github.com/OCA/hr-attendance/tree/15.0/hr_attendance_geolocation
+    :target: https://github.com/OCA/hr-attendance/tree/16.0/hr_attendance_geolocation
     :alt: OCA/hr-attendance
 .. |badge4| image:: https://img.shields.io/badge/weblate-Translate%20me-F47D42.png
-    :target: https://translation.odoo-community.org/projects/hr-attendance-15-0/hr-attendance-15-0-hr_attendance_geolocation
+    :target: https://translation.odoo-community.org/projects/hr-attendance-16-0/hr-attendance-16-0-hr_attendance_geolocation
     :alt: Translate me on Weblate
 .. |badge5| image:: https://img.shields.io/badge/runbot-Try%20me-875A7B.png
-    :target: https://runbot.odoo-community.org/runbot/288/15.0
+    :target: https://runbot.odoo-community.org/runbot/288/16.0
     :alt: Try me on Runbot
 
 |badge1| |badge2| |badge3| |badge4| |badge5| 
 
 With this module the geolocation of the user is tracked at the
 check-in/check-out step.
 
@@ -37,47 +37,40 @@
 
 Bug Tracker
 ===========
 
 Bugs are tracked on `GitHub Issues <https://github.com/OCA/hr-attendance/issues>`_.
 In case of trouble, please check there if your issue has already been reported.
 If you spotted it first, help us smashing it by providing a detailed and welcomed
-`feedback <https://github.com/OCA/hr-attendance/issues/new?body=module:%20hr_attendance_geolocation%0Aversion:%2015.0%0A%0A**Steps%20to%20reproduce**%0A-%20...%0A%0A**Current%20behavior**%0A%0A**Expected%20behavior**>`_.
+`feedback <https://github.com/OCA/hr-attendance/issues/new?body=module:%20hr_attendance_geolocation%0Aversion:%2016.0%0A%0A**Steps%20to%20reproduce**%0A-%20...%0A%0A**Current%20behavior**%0A%0A**Expected%20behavior**>`_.
 
 Do not contact contributors directly about support or help with technical issues.
 
 Credits
 =======
 
 Authors
 ~~~~~~~
 
 * ForgeFlow S.L.
-* Tecnativa
-* Grupo Isonor
 
 Contributors
 ~~~~~~~~~~~~
 
 * Adria Gil Sorribes <adria.gil@forgeFlow.com>
-* `Tecnativa <https://www.tecnativa.com>`__:
-
-  * David Vidal
-
-* Alexandre D. Díaz (`Grupo Isonor <https://www.grupoisonor.es>`_)
 
 Maintainers
 ~~~~~~~~~~~
 
 This module is maintained by the OCA.
 
 .. image:: https://odoo-community.org/logo.png
    :alt: Odoo Community Association
    :target: https://odoo-community.org
 
 OCA, or the Odoo Community Association, is a nonprofit organization whose
 mission is to support the collaborative development of Odoo features and
 promote its widespread use.
 
-This module is part of the `OCA/hr-attendance <https://github.com/OCA/hr-attendance/tree/15.0/hr_attendance_geolocation>`_ project on GitHub.
+This module is part of the `OCA/hr-attendance <https://github.com/OCA/hr-attendance/tree/16.0/hr_attendance_geolocation>`_ project on GitHub.
 
 You are welcome to contribute. To learn how please visit https://odoo-community.org/page/Contribute.
```

### encoding

```diff
@@ -1 +1 @@
-utf-8
+us-ascii
```

## odoo/addons/hr_attendance_geolocation/__manifest__.py

```diff
@@ -1,27 +1,23 @@
 # Copyright 2019 ForgeFlow S.L.
-# Copyright 2023 Tecnativa
-# Copyright 2023 Grupo Isonor
 # License AGPL-3.0 or later (http://www.gnu.org/licenses/agpl).
 
 {
     "name": "Hr Attendance Geolocation",
     "summary": """
         With this module the geolocation of the user is tracked at the
         check-in/check-out step""",
-    "version": "15.0.1.0.3",
+    "version": "16.0.1.0.1",
     "license": "AGPL-3",
-    "author": "ForgeFlow S.L., Tecnativa, Grupo Isonor, Odoo Community Association (OCA)",
+    "author": "ForgeFlow S.L., Odoo Community Association (OCA)",
     "website": "https://github.com/OCA/hr-attendance",
     "depends": ["hr_attendance"],
     "data": [
         "views/hr_attendance_views.xml",
         "data/location_data.xml",
     ],
     "assets": {
         "web.assets_backend": [
-            "hr_attendance_geolocation/static/src/js/geolocation_user_context_legacy.esm.js",
-            "hr_attendance_geolocation/static/src/js/geolocation_service_legacy.js",
             "hr_attendance_geolocation/static/src/js/attendance_geolocation.js",
         ],
     },
 }
```

## odoo/addons/hr_attendance_geolocation/i18n/hr_attendance_geolocation.pot

```diff
@@ -1,14 +1,14 @@
 # Translation of Odoo Server.
 # This file contains the translation of the following modules:
 # 	* hr_attendance_geolocation
 #
 msgid ""
 msgstr ""
-"Project-Id-Version: Odoo Server 15.0\n"
+"Project-Id-Version: Odoo Server 16.0\n"
 "Report-Msgid-Bugs-To: \n"
 "Last-Translator: \n"
 "Language-Team: \n"
 "MIME-Version: 1.0\n"
 "Content-Type: text/plain; charset=UTF-8\n"
 "Content-Transfer-Encoding: \n"
 "Plural-Forms: \n"
```

## odoo/addons/hr_attendance_geolocation/readme/CONTRIBUTORS.rst

```diff
@@ -1,6 +1 @@
 * Adria Gil Sorribes <adria.gil@forgeFlow.com>
-* `Tecnativa <https://www.tecnativa.com>`__:
-
-  * David Vidal
-
-* Alexandre D. Díaz (`Grupo Isonor <https://www.grupoisonor.es>`_)
```

### encoding

```diff
@@ -1 +1 @@
-utf-8
+us-ascii
```

## odoo/addons/hr_attendance_geolocation/static/description/index.html

### odoo/addons/hr_attendance_geolocation/static/description/index.html

```diff
@@ -367,21 +367,21 @@
       <p>
         <a class="reference external" href="https://odoo-community.org/page/development-status">
           <img alt="Beta" src="https://img.shields.io/badge/maturity-Beta-yellow.png"/>
         </a>
         <a class="reference external" href="http://www.gnu.org/licenses/agpl-3.0-standalone.html">
           <img alt="License: AGPL-3" src="https://img.shields.io/badge/licence-AGPL--3-blue.png"/>
         </a>
-        <a class="reference external" href="https://github.com/OCA/hr-attendance/tree/15.0/hr_attendance_geolocation">
+        <a class="reference external" href="https://github.com/OCA/hr-attendance/tree/16.0/hr_attendance_geolocation">
           <img alt="OCA/hr-attendance" src="https://img.shields.io/badge/github-OCA%2Fhr--attendance-lightgray.png?logo=github"/>
         </a>
-        <a class="reference external" href="https://translation.odoo-community.org/projects/hr-attendance-15-0/hr-attendance-15-0-hr_attendance_geolocation">
+        <a class="reference external" href="https://translation.odoo-community.org/projects/hr-attendance-16-0/hr-attendance-16-0-hr_attendance_geolocation">
           <img alt="Translate me on Weblate" src="https://img.shields.io/badge/weblate-Translate%20me-F47D42.png"/>
         </a>
-        <a class="reference external" href="https://runbot.odoo-community.org/runbot/288/15.0">
+        <a class="reference external" href="https://runbot.odoo-community.org/runbot/288/16.0">
           <img alt="Try me on Runbot" src="https://img.shields.io/badge/runbot-Try%20me-875A7B.png"/>
         </a>
       </p>
       <p>With this module the geolocation of the user is tracked at the
 check-in/check-out step.</p>
       <p>This feature is available only in secure contexts (HTTPS).</p>
       <p>
@@ -414,55 +414,41 @@
         </h1>
         <p>
           Bugs are tracked on
           <a class="reference external" href="https://github.com/OCA/hr-attendance/issues">GitHub Issues</a>
           .
 In case of trouble, please check there if your issue has already been reported.
 If you spotted it first, help us smashing it by providing a detailed and welcomed
-          <a class="reference external" href="https://github.com/OCA/hr-attendance/issues/new?body=module:%20hr_attendance_geolocation%0Aversion:%2015.0%0A%0A**Steps%20to%20reproduce**%0A-%20...%0A%0A**Current%20behavior**%0A%0A**Expected%20behavior**">feedback</a>
+          <a class="reference external" href="https://github.com/OCA/hr-attendance/issues/new?body=module:%20hr_attendance_geolocation%0Aversion:%2016.0%0A%0A**Steps%20to%20reproduce**%0A-%20...%0A%0A**Current%20behavior**%0A%0A**Expected%20behavior**">feedback</a>
           .
         </p>
         <p>Do not contact contributors directly about support or help with technical issues.</p>
       </div>
       <div class="section" id="credits">
         <h1>
           <a class="toc-backref" href="#id2">Credits</a>
         </h1>
         <div class="section" id="authors">
           <h2>
             <a class="toc-backref" href="#id3">Authors</a>
           </h2>
           <ul class="simple">
             <li>ForgeFlow S.L.</li>
-            <li>Tecnativa</li>
-            <li>Grupo Isonor</li>
           </ul>
         </div>
         <div class="section" id="contributors">
           <h2>
             <a class="toc-backref" href="#id4">Contributors</a>
           </h2>
           <ul class="simple">
             <li>
               Adria Gil Sorribes &lt;
               <a class="reference external" href="mailto:adria.gil@forgeFlow.com">adria.gil@forgeFlow.com</a>
               &gt;
             </li>
-            <li>
-              <a class="reference external" href="https://www.tecnativa.com">Tecnativa</a>
-              :
-              <ul>
-                <li>David Vidal</li>
-              </ul>
-            </li>
-            <li>
-              Alexandre D. Díaz (
-              <a class="reference external" href="https://www.grupoisonor.es">Grupo Isonor</a>
-              )
-            </li>
           </ul>
         </div>
         <div class="section" id="maintainers">
           <h2>
             <a class="toc-backref" href="#id5">Maintainers</a>
           </h2>
           <p>This module is maintained by the OCA.</p>
@@ -470,15 +456,15 @@
             <img alt="Odoo Community Association" src="https://odoo-community.org/logo.png"/>
           </a>
           <p>OCA, or the Odoo Community Association, is a nonprofit organization whose
 mission is to support the collaborative development of Odoo features and
 promote its widespread use.</p>
           <p>
             This module is part of the
-            <a class="reference external" href="https://github.com/OCA/hr-attendance/tree/15.0/hr_attendance_geolocation">OCA/hr-attendance</a>
+            <a class="reference external" href="https://github.com/OCA/hr-attendance/tree/16.0/hr_attendance_geolocation">OCA/hr-attendance</a>
             project on GitHub.
           </p>
           <p>
             You are welcome to contribute. To learn how please visit
             <a class="reference external" href="https://odoo-community.org/page/Contribute">https://odoo-community.org/page/Contribute</a>
             .
           </p>
```

## odoo/addons/hr_attendance_geolocation/static/src/js/attendance_geolocation.js

### js-beautify {}

```diff
@@ -1,38 +1,154 @@
-/* Copyright ForgeFlow - Adria Gil Sorribes
-   Copyright Tecnativa - David Vidal
-   Copyright Grupo Isonor - Alexandre D. Díaz
-   License AGPL-3.0 or later (https://www.gnu.org/licenses/agpl).
-*/
 odoo.define("hr_attendance_geolocation.attendances_geolocation", function(require) {
     "use strict";
 
-    const MyAttendances = require("hr_attendance.my_attendances");
-    const KioskConfirm = require("hr_attendance.kiosk_confirm");
+    var MyAttendances = require("hr_attendance.my_attendances");
+    var KioskConfirm = require("hr_attendance.kiosk_confirm");
+    const session = require("web.session");
 
-    // After every check in or check out is made, the widget is reloaded, so we can
-    // rely on the init hook to load the users location. When the next check in or check
-    // is made, the location will be injected in the context so we can catch it in
-    // the server code.
     MyAttendances.include({
-        willStart: function() {
-            const prom = this.call(
-                "hr_attendance_geolocation_service",
-                "updateUserContextAsync"
-            );
-            return Promise.all([prom, this._super.apply(this, arguments)]);
+        // eslint-disable-next-line no-unused-vars
+        init: function(parent, action) {
+            this._super.apply(this, arguments);
+            this.location = (null, null);
+            this.errorCode = null;
+        },
+        update_attendance: function() {
+            var self = this;
+            var options = {
+                enableHighAccuracy: true,
+                timeout: 5000,
+                maximumAge: 60000,
+            };
+            if (navigator.geolocation) {
+                navigator.geolocation.getCurrentPosition(
+                    self._manual_attendance.bind(self),
+                    self._getPositionError.bind(self),
+                    options
+                );
+            }
+        },
+        _manual_attendance: function(position) {
+            var self = this;
+            const ctx = Object.assign(session.user_context, {
+                latitude: position.coords.latitude,
+                longitude: position.coords.longitude,
+            });
+            this._rpc({
+                model: "hr.employee",
+                method: "attendance_manual",
+                args: [
+                    [self.employee.id],
+                    "hr_attendance.hr_attendance_action_my_attendances",
+                ],
+                context: ctx,
+            }).then(function(result) {
+                if (result.action) {
+                    self.do_action(result.action);
+                } else if (result.warning) {
+                    self.do_warn(result.warning);
+                }
+            });
+        },
+        _getPositionError: function(error) {
+            console.warn("ERROR(" + error.code + "): " + error.message);
+            const position = {
+                coords: {
+                    latitude: 0.0,
+                    longitude: 0.0,
+                },
+            };
+            this._manual_attendance(position);
         },
     });
 
-    // With Kiosk, we had no method to override, as the event property that triggers the
-    // update is mapped directly to a function on the fly. In this case, we'll use the
-    // asyncronous willStart method so we can wait for the location to be resolved.
     KioskConfirm.include({
-        willStart: function() {
-            const prom = this.call(
-                "hr_attendance_geolocation_service",
-                "updateUserContextAsync"
-            );
-            return Promise.all([prom, this._super.apply(this, arguments)]);
+        events: _.extend(KioskConfirm.prototype.events, {
+            "click .o_hr_attendance_sign_in_out_icon": _.debounce(
+                function() {
+                    this.update_attendance();
+                },
+                200,
+                true
+            ),
+            "click .o_hr_attendance_pin_pad_button_ok": _.debounce(
+                function() {
+                    this.pin_pad = true;
+                    this.update_attendance();
+                },
+                200,
+                true
+            ),
+        }),
+        // eslint-disable-next-line no-unused-vars
+        init: function(parent, action) {
+            this._super.apply(this, arguments);
+            this.pin_pad = false;
+        },
+        update_attendance: function() {
+            var self = this;
+            var options = {
+                enableHighAccuracy: true,
+                timeout: 5000,
+                maximumAge: 0,
+            };
+            if (navigator.geolocation) {
+                navigator.geolocation.getCurrentPosition(
+                    self._manual_attendance.bind(self),
+                    self._getPositionError.bind(self),
+                    options
+                );
+            }
+        },
+        _manual_attendance: function(position) {
+            var self = this;
+            var pinBoxVal = null;
+            if (this.pin_pad) {
+                this.$(".o_hr_attendance_pin_pad_button_ok").attr(
+                    "disabled",
+                    "disabled"
+                );
+                pinBoxVal = this.$(".o_hr_attendance_PINbox").val();
+            }
+            const ctx = Object.assign(session.user_context, {
+                latitude: position.coords.latitude,
+                longitude: position.coords.longitude,
+            });
+            this._rpc({
+                model: "hr.employee",
+                method: "attendance_manual",
+                args: [
+                    [this.employee_id], this.next_action, pinBoxVal
+                ],
+                context: ctx,
+            }).then(function(result) {
+                if (result.action) {
+                    self.do_action(result.action);
+                } else if (result.warning) {
+                    self.displayNotification({
+                        title: result.warning,
+                        type: "danger"
+                    });
+                    if (self.pin_pad) {
+                        self.$(".o_hr_attendance_PINbox").val("");
+                        setTimeout(function() {
+                            self.$(".o_hr_attendance_pin_pad_button_ok").removeAttr(
+                                "disabled"
+                            );
+                        }, 500);
+                    }
+                    self.pin_pad = false;
+                }
+            });
+        },
+        _getPositionError: function(error) {
+            console.warn("ERROR(" + error.code + "): " + error.message);
+            const position = {
+                coords: {
+                    latitude: 0.0,
+                    longitude: 0.0,
+                },
+            };
+            this._manual_attendance(position);
         },
     });
 });
```

## odoo/addons/hr_attendance_geolocation/tests/test_hr_attendance_geolocation.py

```diff
@@ -17,13 +17,17 @@
         # Called from js
         lat, long = self.location
         self.employee.with_context(latitude=lat, longitude=long).attendance_manual({})
         attendances = self.hr_attendance_model.search(
             [("employee_id", "=", self.employee.id)]
         )
         self.assertEqual(len(attendances), 1, "One attendance should have been created")
-        self.assertEqual(attendances[0].check_in_latitude, float(self.location[0]))
-        self.assertEqual(attendances[0].check_in_longitude, float(self.location[1]))
+        self.assertAlmostEqual(
+            attendances[0].check_in_latitude, float(self.location[0]), places=7
+        )
+        self.assertAlmostEqual(
+            attendances[0].check_in_longitude, float(self.location[1]), places=7
+        )
         self.assertTrue(attendances[0].check_in_latitude_text)
         self.assertTrue(attendances[0].check_in_longitude_text)
         self.assertFalse(attendances[0].check_out_latitude_text)
         self.assertFalse(attendances[0].check_out_longitude_text)
```

## Comparing `odoo_addon_hr_attendance_geolocation-15.0.1.0.3.2.dist-info/METADATA` & `odoo_addon_hr_attendance_geolocation-16.0.1.0.1.3.dist-info/METADATA`

 * *Files 10% similar despite different names*

```diff
@@ -1,22 +1,22 @@
 Metadata-Version: 2.1
 Name: odoo-addon-hr-attendance-geolocation
-Version: 15.0.1.0.3.2
+Version: 16.0.1.0.1.3
 Summary: With this module the geolocation of the user is tracked at the check-in/check-out step
 Home-page: https://github.com/OCA/hr-attendance
-Author: ForgeFlow S.L., Tecnativa, Grupo Isonor, Odoo Community Association (OCA)
+Author: ForgeFlow S.L., Odoo Community Association (OCA)
 Author-email: support@odoo-community.org
 License: AGPL-3
 Platform: UNKNOWN
 Classifier: Programming Language :: Python
 Classifier: Framework :: Odoo
-Classifier: Framework :: Odoo :: 15.0
+Classifier: Framework :: Odoo :: 16.0
 Classifier: License :: OSI Approved :: GNU Affero General Public License v3
-Requires-Python: >=3.8
-Requires-Dist: odoo (<15.1dev,>=15.0a)
+Requires-Python: >=3.10
+Requires-Dist: odoo (<16.1dev,>=16.0a)
 
 =========================
 Hr Attendance Geolocation
 =========================
 
 .. !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    !! This file is generated by oca-gen-addon-readme !!
@@ -26,21 +26,21 @@
 .. |badge1| image:: https://img.shields.io/badge/maturity-Beta-yellow.png
     :target: https://odoo-community.org/page/development-status
     :alt: Beta
 .. |badge2| image:: https://img.shields.io/badge/licence-AGPL--3-blue.png
     :target: http://www.gnu.org/licenses/agpl-3.0-standalone.html
     :alt: License: AGPL-3
 .. |badge3| image:: https://img.shields.io/badge/github-OCA%2Fhr--attendance-lightgray.png?logo=github
-    :target: https://github.com/OCA/hr-attendance/tree/15.0/hr_attendance_geolocation
+    :target: https://github.com/OCA/hr-attendance/tree/16.0/hr_attendance_geolocation
     :alt: OCA/hr-attendance
 .. |badge4| image:: https://img.shields.io/badge/weblate-Translate%20me-F47D42.png
-    :target: https://translation.odoo-community.org/projects/hr-attendance-15-0/hr-attendance-15-0-hr_attendance_geolocation
+    :target: https://translation.odoo-community.org/projects/hr-attendance-16-0/hr-attendance-16-0-hr_attendance_geolocation
     :alt: Translate me on Weblate
 .. |badge5| image:: https://img.shields.io/badge/runbot-Try%20me-875A7B.png
-    :target: https://runbot.odoo-community.org/runbot/288/15.0
+    :target: https://runbot.odoo-community.org/runbot/288/16.0
     :alt: Try me on Runbot
 
 |badge1| |badge2| |badge3| |badge4| |badge5| 
 
 With this module the geolocation of the user is tracked at the
 check-in/check-out step.
 
@@ -53,49 +53,42 @@
 
 Bug Tracker
 ===========
 
 Bugs are tracked on `GitHub Issues <https://github.com/OCA/hr-attendance/issues>`_.
 In case of trouble, please check there if your issue has already been reported.
 If you spotted it first, help us smashing it by providing a detailed and welcomed
-`feedback <https://github.com/OCA/hr-attendance/issues/new?body=module:%20hr_attendance_geolocation%0Aversion:%2015.0%0A%0A**Steps%20to%20reproduce**%0A-%20...%0A%0A**Current%20behavior**%0A%0A**Expected%20behavior**>`_.
+`feedback <https://github.com/OCA/hr-attendance/issues/new?body=module:%20hr_attendance_geolocation%0Aversion:%2016.0%0A%0A**Steps%20to%20reproduce**%0A-%20...%0A%0A**Current%20behavior**%0A%0A**Expected%20behavior**>`_.
 
 Do not contact contributors directly about support or help with technical issues.
 
 Credits
 =======
 
 Authors
 ~~~~~~~
 
 * ForgeFlow S.L.
-* Tecnativa
-* Grupo Isonor
 
 Contributors
 ~~~~~~~~~~~~
 
 * Adria Gil Sorribes <adria.gil@forgeFlow.com>
-* `Tecnativa <https://www.tecnativa.com>`__:
-
-  * David Vidal
-
-* Alexandre D. Díaz (`Grupo Isonor <https://www.grupoisonor.es>`_)
 
 Maintainers
 ~~~~~~~~~~~
 
 This module is maintained by the OCA.
 
 .. image:: https://odoo-community.org/logo.png
    :alt: Odoo Community Association
    :target: https://odoo-community.org
 
 OCA, or the Odoo Community Association, is a nonprofit organization whose
 mission is to support the collaborative development of Odoo features and
 promote its widespread use.
 
-This module is part of the `OCA/hr-attendance <https://github.com/OCA/hr-attendance/tree/15.0/hr_attendance_geolocation>`_ project on GitHub.
+This module is part of the `OCA/hr-attendance <https://github.com/OCA/hr-attendance/tree/16.0/hr_attendance_geolocation>`_ project on GitHub.
 
 You are welcome to contribute. To learn how please visit https://odoo-community.org/page/Contribute.
```

### encoding

```diff
@@ -1 +1 @@
-utf-8
+us-ascii
```

## Comparing `odoo_addon_hr_attendance_geolocation-15.0.1.0.3.2.dist-info/RECORD` & `odoo_addon_hr_attendance_geolocation-16.0.1.0.1.3.dist-info/RECORD`

 * *Files 10% similar despite different names*

```diff
@@ -1,23 +1,20 @@
-odoo/addons/hr_attendance_geolocation/README.rst,sha256=I0HqcoHrhzSBmggOefkawx0lTREqbyG8OklUjSRk-fw,2962
+odoo/addons/hr_attendance_geolocation/README.rst,sha256=2o52Z49fso6ku2S35NaV0mYRqMA0jRCrLONGxiuHvI4,2804
 odoo/addons/hr_attendance_geolocation/__init__.py,sha256=X9EJGOE2GtZbS0G82PtSXmWSZ_R8jEM0rlJTDliQjp4,21
-odoo/addons/hr_attendance_geolocation/__manifest__.py,sha256=8aiOLADaiD4hFiqZx9YYGb4trB2ouzg_lkjq267Ymyk,981
+odoo/addons/hr_attendance_geolocation/__manifest__.py,sha256=NQIS0hQWxQFkp-6vToQYqRpbPX-9G2YcrL27vKpBslg,720
 odoo/addons/hr_attendance_geolocation/data/location_data.xml,sha256=2xjOsHK7ZlU5fBVg0Fka4_kmb8HVhYhGBxScmPMLe0E,247
-odoo/addons/hr_attendance_geolocation/i18n/hr_attendance_geolocation.pot,sha256=JyyXYE2EVV08D__Dv7nYqvn4Mcpy2VSojHgy2-lOLz4,2787
-odoo/addons/hr_attendance_geolocation/i18n/it.po,sha256=FgNFI_akJwTDMzTboHZc9qWziGnOLR0fhO7Ys322-Qc,3221
+odoo/addons/hr_attendance_geolocation/i18n/hr_attendance_geolocation.pot,sha256=DY6vfxC2CyWwSJYJGkdI4XytywI03bQCTHt8lFJZsdg,2787
 odoo/addons/hr_attendance_geolocation/models/__init__.py,sha256=MuXnlldSqQAhVTYUQF0FuFK0DM0eBw9McZjl_BuPyV4,54
 odoo/addons/hr_attendance_geolocation/models/hr_attendance.py,sha256=KTyYu2fWcJK6ewka35yF_vAlZ9Fzoo9KgFTY_0YN1jE,2811
 odoo/addons/hr_attendance_geolocation/models/hr_employee.py,sha256=WFpwIi-BJKzPeWkZKXsiPvc9w99r_P817JfcViNLc1Q,973
-odoo/addons/hr_attendance_geolocation/readme/CONTRIBUTORS.rst,sha256=xXWSRh-8x7YJziDXUgcKCYTXUQFwDKwueA625qFJpNc,178
+odoo/addons/hr_attendance_geolocation/readme/CONTRIBUTORS.rst,sha256=bIUBMHsgww7g8zZwvuswXnc6UOyJSzHSN3ZgCSTiIfA,47
 odoo/addons/hr_attendance_geolocation/readme/DESCRIPTION.rst,sha256=5inwdMDsyhMea8k4U8xSCQ9LtOpYleyD5LdocWpajs8,148
 odoo/addons/hr_attendance_geolocation/static/description/icon.png,sha256=6xBPJauaFOF0KDHfHgQopSc28kKvxMaeoQFQWZtfZDo,9455
-odoo/addons/hr_attendance_geolocation/static/description/index.html,sha256=maMbXDhYgMGyCD10k9YAWl3JtC9E7-LdOWmeUfFJwTE,12194
-odoo/addons/hr_attendance_geolocation/static/src/js/attendance_geolocation.js,sha256=l2acSO6BwiqC0-LGh-d5czeHFYQ1H1pEtzJwVtCwCs8,1581
-odoo/addons/hr_attendance_geolocation/static/src/js/geolocation_service_legacy.js,sha256=SmPkwlxNXsxbt9trrQeAFRaBti_U8_HjCJww0n3xGxc,2437
-odoo/addons/hr_attendance_geolocation/static/src/js/geolocation_user_context_legacy.esm.js,sha256=F8VpL4nkZNsjwV6ewAm91PIPx01L-P_0KkUt9zZy0EM,1018
+odoo/addons/hr_attendance_geolocation/static/description/index.html,sha256=PPML3_oaJLKDMbdwVKO2ckqCHFXSToHOhPL2A0VSBcU,11923
+odoo/addons/hr_attendance_geolocation/static/src/js/attendance_geolocation.js,sha256=OG-qDELDLEd-PMlxDnlTkSlnLtSszEtJ0ojfF2oIJnU,5311
 odoo/addons/hr_attendance_geolocation/tests/__init__.py,sha256=bWgqfBulu2wvVlfMLV1v06TX0vdZmcbmvBhRbba6QT0,45
-odoo/addons/hr_attendance_geolocation/tests/test_hr_attendance_geolocation.py,sha256=bpOLbRpHmgSPrFaIegHdGa9kSpPO3l1d3V7sug8rvs0,1363
+odoo/addons/hr_attendance_geolocation/tests/test_hr_attendance_geolocation.py,sha256=4Xe76xvCBeMLR-lUg4_-P09iBRYboW1fFBkfjg6zKiE,1439
 odoo/addons/hr_attendance_geolocation/views/hr_attendance_views.xml,sha256=cAG50NFzLXmrTBplxP9TraeTX2CXQun6VPW4TcoGRoY,2521
-odoo_addon_hr_attendance_geolocation-15.0.1.0.3.2.dist-info/METADATA,sha256=8gqjVlCjMgwF39XtYe97IyRXmN_rIm3F-tZokT1xtOc,3602
-odoo_addon_hr_attendance_geolocation-15.0.1.0.3.2.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
-odoo_addon_hr_attendance_geolocation-15.0.1.0.3.2.dist-info/top_level.txt,sha256=qBj40grFkGOfDZ2WDSw3y1RnDlgG0u8rP8pvGNdbz4w,5
-odoo_addon_hr_attendance_geolocation-15.0.1.0.3.2.dist-info/RECORD,,
+odoo_addon_hr_attendance_geolocation-16.0.1.0.1.3.dist-info/METADATA,sha256=eqTkKHnBb7pmAtAYMzZDHQj24C3bJaWAQJdJt3Ns_vg,3420
+odoo_addon_hr_attendance_geolocation-16.0.1.0.1.3.dist-info/WHEEL,sha256=G16H4A3IeoQmnOrYV4ueZGKSjhipXx8zc8nu9FGlvMA,92
+odoo_addon_hr_attendance_geolocation-16.0.1.0.1.3.dist-info/top_level.txt,sha256=qBj40grFkGOfDZ2WDSw3y1RnDlgG0u8rP8pvGNdbz4w,5
+odoo_addon_hr_attendance_geolocation-16.0.1.0.1.3.dist-info/RECORD,,
```

