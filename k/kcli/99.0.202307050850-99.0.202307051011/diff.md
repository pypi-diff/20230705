# Comparing `tmp/kcli-99.0.202307050850-py3-none-any.whl.zip` & `tmp/kcli-99.0.202307051011-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,615 +1,615 @@
-Zip file size: 1502516 bytes, number of entries: 613
--rw-r--r--  2.0 unx       15 b- defN 23-Jul-05 08:45 kvirt/__init__.py
--rw-r--r--  2.0 unx   100420 b- defN 23-Jul-05 08:45 kvirt/baseconfig.py
--rw-r--r--  2.0 unx   171487 b- defN 23-Jul-05 08:45 kvirt/bottle.py
--rw-r--r--  2.0 unx   254136 b- defN 23-Jul-05 08:45 kvirt/cli.py
--rw-r--r--  2.0 unx   193321 b- defN 23-Jul-05 08:45 kvirt/config.py
--rw-r--r--  2.0 unx     2851 b- defN 23-Jul-05 08:45 kvirt/containerconfig.py
--rw-r--r--  2.0 unx    11612 b- defN 23-Jul-05 08:45 kvirt/defaults.py
--rw-r--r--  2.0 unx     1475 b- defN 23-Jul-05 08:45 kvirt/ekstoken.py
--rw-r--r--  2.0 unx    21066 b- defN 23-Jul-05 08:45 kvirt/examples.py
--rw-r--r--  2.0 unx     1047 b- defN 23-Jul-05 08:45 kvirt/gketoken.py
--rw-r--r--  2.0 unx     4333 b- defN 23-Jul-05 08:45 kvirt/ignitionmerger.py
--rw-r--r--  2.0 unx     9871 b- defN 23-Jul-05 08:45 kvirt/keywords.yaml
--rw-r--r--  2.0 unx     3487 b- defN 23-Jul-05 08:45 kvirt/klist.py
--rw-r--r--  2.0 unx     6009 b- defN 23-Jul-05 08:45 kvirt/ansibleutils/__init__.py
--rw-r--r--  2.0 unx        0 b- defN 23-Jul-05 08:45 kvirt/cluster/__init__.py
--rw-r--r--  2.0 unx      204 b- defN 23-Jul-05 08:45 kvirt/cluster/sampleprovider.py
--rw-r--r--  2.0 unx    12259 b- defN 23-Jul-05 08:45 kvirt/cluster/eks/__init__.py
--rw-r--r--  2.0 unx       16 b- defN 23-Jul-05 08:45 kvirt/cluster/eks/fake.yml
--rw-r--r--  2.0 unx      169 b- defN 23-Jul-05 08:45 kvirt/cluster/eks/kcli_default.yml
--rw-r--r--  2.0 unx    12218 b- defN 23-Jul-05 08:45 kvirt/cluster/gke/__init__.py
--rw-r--r--  2.0 unx       16 b- defN 23-Jul-05 08:45 kvirt/cluster/gke/fake.yml
--rw-r--r--  2.0 unx      497 b- defN 23-Jul-05 08:45 kvirt/cluster/gke/kcli_default.yml
--rw-r--r--  2.0 unx      405 b- defN 23-Jul-05 08:45 kvirt/cluster/gke/kubeconfig.j2
--rw-r--r--  2.0 unx      931 b- defN 23-Jul-05 08:45 kvirt/cluster/hypershift/99-apps.yaml
--rw-r--r--  2.0 unx      694 b- defN 23-Jul-05 08:45 kvirt/cluster/hypershift/99-forcedns
--rw-r--r--  2.0 unx     1480 b- defN 23-Jul-05 08:45 kvirt/cluster/hypershift/99-notifications.yaml
--rw-r--r--  2.0 unx      653 b- defN 23-Jul-05 08:45 kvirt/cluster/hypershift/Corefile
--rw-r--r--  2.0 unx    44036 b- defN 23-Jul-05 08:45 kvirt/cluster/hypershift/__init__.py
--rw-r--r--  2.0 unx     1121 b- defN 23-Jul-05 08:45 kvirt/cluster/hypershift/assisted_infra.yml
--rw-r--r--  2.0 unx     1269 b- defN 23-Jul-05 08:45 kvirt/cluster/hypershift/assisted_ingress.yml
--rw-r--r--  2.0 unx     1366 b- defN 23-Jul-05 08:45 kvirt/cluster/hypershift/autoapprovercron.yml
--rw-r--r--  2.0 unx     1106 b- defN 23-Jul-05 08:45 kvirt/cluster/hypershift/bmc.yml.j2
--rw-r--r--  2.0 unx      511 b- defN 23-Jul-05 08:45 kvirt/cluster/hypershift/calico.sh.j2
--rw-r--r--  2.0 unx      200 b- defN 23-Jul-05 08:45 kvirt/cluster/hypershift/cloud_lb_apps.yml
--rw-r--r--  2.0 unx     1433 b- defN 23-Jul-05 08:45 kvirt/cluster/hypershift/disconnected.sh
--rw-r--r--  2.0 unx      184 b- defN 23-Jul-05 08:45 kvirt/cluster/hypershift/extras.service
--rw-r--r--  2.0 unx      839 b- defN 23-Jul-05 08:45 kvirt/cluster/hypershift/extras.sh
--rw-r--r--  2.0 unx     3131 b- defN 23-Jul-05 08:45 kvirt/cluster/hypershift/hostedcluster.yaml
--rw-r--r--  2.0 unx     1174 b- defN 23-Jul-05 08:45 kvirt/cluster/hypershift/httpd.yaml
--rw-r--r--  2.0 unx      889 b- defN 23-Jul-05 08:45 kvirt/cluster/hypershift/ignition.sh
--rw-r--r--  2.0 unx     2307 b- defN 23-Jul-05 08:45 kvirt/cluster/hypershift/kcli_plan.yml
--rw-r--r--  2.0 unx     2069 b- defN 23-Jul-05 08:45 kvirt/cluster/hypershift/kcli_plan_default.yml
--rw-r--r--  2.0 unx      502 b- defN 23-Jul-05 08:45 kvirt/cluster/hypershift/keepalived.conf
--rw-r--r--  2.0 unx     1587 b- defN 23-Jul-05 08:45 kvirt/cluster/hypershift/nmstateconfig.yml.j2
--rw-r--r--  2.0 unx      752 b- defN 23-Jul-05 08:45 kvirt/cluster/hypershift/nodepool.yaml
--rw-r--r--  2.0 unx       60 b- defN 23-Jul-05 08:45 kvirt/cluster/hypershift/nonlocalbind.conf
--rw-r--r--  2.0 unx     1890 b- defN 23-Jul-05 08:45 kvirt/cluster/hypershift/staticpods/coredns.yml
--rw-r--r--  2.0 unx     2142 b- defN 23-Jul-05 08:45 kvirt/cluster/hypershift/staticpods/keepalived.yml
--rw-r--r--  2.0 unx     1619 b- defN 23-Jul-05 08:45 kvirt/cluster/hypershift/staticpods/mdns.yml
--rw-r--r--  2.0 unx    13621 b- defN 23-Jul-05 08:45 kvirt/cluster/k3s/__init__.py
--rw-r--r--  2.0 unx     1117 b- defN 23-Jul-05 08:45 kvirt/cluster/k3s/bootstrap.sh
--rw-r--r--  2.0 unx     1035 b- defN 23-Jul-05 08:45 kvirt/cluster/k3s/bootstrap.yml
--rw-r--r--  2.0 unx      441 b- defN 23-Jul-05 08:45 kvirt/cluster/k3s/cloud_lb_api.yml
--rw-r--r--  2.0 unx      440 b- defN 23-Jul-05 08:45 kvirt/cluster/k3s/ctlplanes.sh
--rw-r--r--  2.0 unx     1068 b- defN 23-Jul-05 08:45 kvirt/cluster/k3s/ctlplanes.yml
--rw-r--r--  2.0 unx      231 b- defN 23-Jul-05 08:45 kvirt/cluster/k3s/join.sh
--rw-r--r--  2.0 unx     1271 b- defN 23-Jul-05 08:45 kvirt/cluster/k3s/kcli_default.yml
--rw-r--r--  2.0 unx      511 b- defN 23-Jul-05 08:45 kvirt/cluster/k3s/keepalived.conf
--rw-r--r--  2.0 unx      352 b- defN 23-Jul-05 08:45 kvirt/cluster/k3s/keepalived.sh
--rw-r--r--  2.0 unx      166 b- defN 23-Jul-05 08:45 kvirt/cluster/k3s/workers.sh
--rw-r--r--  2.0 unx      709 b- defN 23-Jul-05 08:45 kvirt/cluster/k3s/workers.yml
--rw-r--r--  2.0 unx    14254 b- defN 23-Jul-05 08:45 kvirt/cluster/kubeadm/__init__.py
--rwxr-xr-x  2.0 unx     2772 b- defN 23-Jul-05 08:45 kvirt/cluster/kubeadm/bootstrap.sh
--rw-r--r--  2.0 unx     1550 b- defN 23-Jul-05 08:45 kvirt/cluster/kubeadm/bootstrap.yml
--rw-r--r--  2.0 unx      338 b- defN 23-Jul-05 08:45 kvirt/cluster/kubeadm/cloud_lb_api.yml
--rw-r--r--  2.0 unx     1172 b- defN 23-Jul-05 08:45 kvirt/cluster/kubeadm/ctlplanes.yml
--rwxr-xr-x  2.0 unx      343 b- defN 23-Jul-05 08:45 kvirt/cluster/kubeadm/deploy.sh
--rwxr-xr-x  2.0 unx      308 b- defN 23-Jul-05 08:45 kvirt/cluster/kubeadm/join.sh
--rw-r--r--  2.0 unx     1839 b- defN 23-Jul-05 08:45 kvirt/cluster/kubeadm/kcli_default.yml
--rw-r--r--  2.0 unx      563 b- defN 23-Jul-05 08:45 kvirt/cluster/kubeadm/keepalived.conf
--rw-r--r--  2.0 unx      424 b- defN 23-Jul-05 08:45 kvirt/cluster/kubeadm/keepalived.sh
--rw-r--r--  2.0 unx      140 b- defN 23-Jul-05 08:45 kvirt/cluster/kubeadm/kubernetes.repo
--rw-r--r--  2.0 unx      179 b- defN 23-Jul-05 08:45 kvirt/cluster/kubeadm/multus.sh
--rw-r--r--  2.0 unx      572 b- defN 23-Jul-05 08:45 kvirt/cluster/kubeadm/nfs.sh
--rw-r--r--  2.0 unx      226 b- defN 23-Jul-05 08:45 kvirt/cluster/kubeadm/nfs.yml
--rw-r--r--  2.0 unx     4021 b- defN 23-Jul-05 08:45 kvirt/cluster/kubeadm/pre_el.sh
--rw-r--r--  2.0 unx     3906 b- defN 23-Jul-05 08:45 kvirt/cluster/kubeadm/pre_ubuntu.sh
--rw-r--r--  2.0 unx     2127 b- defN 23-Jul-05 08:45 kvirt/cluster/kubeadm/registry.yml
--rw-r--r--  2.0 unx      949 b- defN 23-Jul-05 08:45 kvirt/cluster/kubeadm/workers.yml
--rw-r--r--  2.0 unx      487 b- defN 23-Jul-05 08:45 kvirt/cluster/kubeadm/apps/argocd/ingress.yml
--rw-r--r--  2.0 unx     2134 b- defN 23-Jul-05 08:45 kvirt/cluster/kubeadm/apps/argocd/install.sh
--rw-r--r--  2.0 unx       71 b- defN 23-Jul-05 08:45 kvirt/cluster/kubeadm/apps/argocd/kcli_default.yml
--rw-r--r--  2.0 unx      314 b- defN 23-Jul-05 08:45 kvirt/cluster/kubeadm/apps/argocd/uninstall.sh
--rw-r--r--  2.0 unx       90 b- defN 23-Jul-05 08:45 kvirt/cluster/kubeadm/apps/autolabeller/install.sh
--rw-r--r--  2.0 unx       91 b- defN 23-Jul-05 08:45 kvirt/cluster/kubeadm/apps/autolabeller/uninstall.sh
--rw-r--r--  2.0 unx      380 b- defN 23-Jul-05 08:45 kvirt/cluster/kubeadm/apps/certmanager/install.sh
--rw-r--r--  2.0 unx      317 b- defN 23-Jul-05 08:45 kvirt/cluster/kubeadm/apps/dashboard/admin.yml
--rw-r--r--  2.0 unx      452 b- defN 23-Jul-05 08:45 kvirt/cluster/kubeadm/apps/dashboard/ingress.yml
--rw-r--r--  2.0 unx     1433 b- defN 23-Jul-05 08:45 kvirt/cluster/kubeadm/apps/dashboard/install.sh
--rw-r--r--  2.0 unx       23 b- defN 23-Jul-05 08:45 kvirt/cluster/kubeadm/apps/dashboard/kcli_default.yml
--rw-r--r--  2.0 unx      373 b- defN 23-Jul-05 08:45 kvirt/cluster/kubeadm/apps/dashboard/user.yml
--rw-r--r--  2.0 unx      157 b- defN 23-Jul-05 08:45 kvirt/cluster/kubeadm/apps/falco/falco_advertisements.yml
--rw-r--r--  2.0 unx      185 b- defN 23-Jul-05 08:45 kvirt/cluster/kubeadm/apps/falco/falco_ip.yml
--rw-r--r--  2.0 unx      839 b- defN 23-Jul-05 08:45 kvirt/cluster/kubeadm/apps/falco/install.sh
--rw-r--r--  2.0 unx       57 b- defN 23-Jul-05 08:45 kvirt/cluster/kubeadm/apps/falco/kcli_default.yml
--rw-r--r--  2.0 unx      133 b- defN 23-Jul-05 08:45 kvirt/cluster/kubeadm/apps/falco/uninstall.sh
--rw-r--r--  2.0 unx      175 b- defN 23-Jul-05 08:45 kvirt/cluster/kubeadm/apps/ingress/install.sh
--rw-r--r--  2.0 unx      176 b- defN 23-Jul-05 08:45 kvirt/cluster/kubeadm/apps/ingress/uninstall.sh
--rw-r--r--  2.0 unx      112 b- defN 23-Jul-05 08:45 kvirt/cluster/kubeadm/apps/istio/install.sh
--rw-r--r--  2.0 unx      910 b- defN 23-Jul-05 08:45 kvirt/cluster/kubeadm/apps/istio/istio-minimal-operator.yaml
--rw-r--r--  2.0 unx      766 b- defN 23-Jul-05 08:45 kvirt/cluster/kubeadm/apps/katacontainer/install.sh
--rw-r--r--  2.0 unx      913 b- defN 23-Jul-05 08:45 kvirt/cluster/kubeadm/apps/katacontainer/uninstall.sh
--rw-r--r--  2.0 unx      198 b- defN 23-Jul-05 08:45 kvirt/cluster/kubeadm/apps/knative/cr_eventing.yml
--rw-r--r--  2.0 unx      194 b- defN 23-Jul-05 08:45 kvirt/cluster/kubeadm/apps/knative/cr_serving.yml
--rw-r--r--  2.0 unx      253 b- defN 23-Jul-05 08:45 kvirt/cluster/kubeadm/apps/knative/install.sh
--rw-r--r--  2.0 unx      670 b- defN 23-Jul-05 08:45 kvirt/cluster/kubeadm/apps/kubevirt/install.sh
--rw-r--r--  2.0 unx       30 b- defN 23-Jul-05 08:45 kvirt/cluster/kubeadm/apps/kubevirt/kcli_default.yml
--rw-r--r--  2.0 unx      534 b- defN 23-Jul-05 08:45 kvirt/cluster/kubeadm/apps/metallb/install.sh
--rw-r--r--  2.0 unx       47 b- defN 23-Jul-05 08:45 kvirt/cluster/kubeadm/apps/metallb/kcli_default.yml
--rw-r--r--  2.0 unx      157 b- defN 23-Jul-05 08:45 kvirt/cluster/kubeadm/apps/metallb/metallb_advertisements.yml
--rw-r--r--  2.0 unx      150 b- defN 23-Jul-05 08:45 kvirt/cluster/kubeadm/apps/metallb/metallb_cr.yml
--rw-r--r--  2.0 unx      283 b- defN 23-Jul-05 08:45 kvirt/cluster/kubeadm/apps/metallb/uninstall.sh
--rw-r--r--  2.0 unx      348 b- defN 23-Jul-05 08:45 kvirt/cluster/kubeadm/apps/olm/install.sh
--rw-r--r--  2.0 unx      350 b- defN 23-Jul-05 08:45 kvirt/cluster/kubeadm/apps/olm/uninstall.sh
--rw-r--r--  2.0 unx      320 b- defN 23-Jul-05 08:45 kvirt/cluster/kubeadm/apps/policy_as_code/install.sh
--rw-r--r--  2.0 unx       34 b- defN 23-Jul-05 08:45 kvirt/cluster/kubeadm/apps/policy_as_code/kcli_default.yml
--rw-r--r--  2.0 unx      322 b- defN 23-Jul-05 08:45 kvirt/cluster/kubeadm/apps/policy_as_code/uninstall.sh
--rw-r--r--  2.0 unx     1662 b- defN 23-Jul-05 08:45 kvirt/cluster/kubeadm/apps/rancher/install.sh
--rw-r--r--  2.0 unx      103 b- defN 23-Jul-05 08:45 kvirt/cluster/kubeadm/apps/rancher/kcli_default.yml
--rw-r--r--  2.0 unx      161 b- defN 23-Jul-05 08:45 kvirt/cluster/kubeadm/apps/rancher/rancher_advertisements.yml
--rw-r--r--  2.0 unx      191 b- defN 23-Jul-05 08:45 kvirt/cluster/kubeadm/apps/rancher/rancher_ip.yml
--rw-r--r--  2.0 unx      151 b- defN 23-Jul-05 08:45 kvirt/cluster/kubeadm/apps/rancher/uninstall.sh
--rw-r--r--  2.0 unx      572 b- defN 23-Jul-05 08:45 kvirt/cluster/kubeadm/apps/rook/install.sh
--rw-r--r--  2.0 unx      190 b- defN 23-Jul-05 08:45 kvirt/cluster/kubeadm/apps/submariner/install.sh
--rw-r--r--  2.0 unx       22 b- defN 23-Jul-05 08:45 kvirt/cluster/kubeadm/apps/submariner/kcli_default.yml
--rw-r--r--  2.0 unx      277 b- defN 23-Jul-05 08:45 kvirt/cluster/kubeadm/apps/tekton/install.sh
--rw-r--r--  2.0 unx      278 b- defN 23-Jul-05 08:45 kvirt/cluster/kubeadm/apps/tekton/uninstall.sh
--rw-r--r--  2.0 unx     2970 b- defN 23-Jul-05 08:45 kvirt/cluster/kubecommon/__init__.py
--rw-r--r--  2.0 unx     9395 b- defN 23-Jul-05 08:45 kvirt/cluster/kubernetes/__init__.py
--rw-r--r--  2.0 unx     4782 b- defN 23-Jul-05 08:45 kvirt/cluster/microshift/__init__.py
--rw-r--r--  2.0 unx      603 b- defN 23-Jul-05 08:45 kvirt/cluster/microshift/kcli_plan.yml
--rw-r--r--  2.0 unx      625 b- defN 23-Jul-05 08:45 kvirt/cluster/microshift/kcli_plan_default.yml
--rw-r--r--  2.0 unx      262 b- defN 23-Jul-05 08:45 kvirt/cluster/microshift/scripts/00_sslip.sh
--rw-r--r--  2.0 unx      799 b- defN 23-Jul-05 08:45 kvirt/cluster/microshift/scripts/01_clients.sh
--rw-r--r--  2.0 unx      183 b- defN 23-Jul-05 08:45 kvirt/cluster/microshift/scripts/02_crio.sh
--rw-r--r--  2.0 unx      538 b- defN 23-Jul-05 08:45 kvirt/cluster/microshift/scripts/03_microshift.sh
--rw-r--r--  2.0 unx      341 b- defN 23-Jul-05 08:45 kvirt/cluster/microshift/scripts/04_kubeconfig.sh
--rw-r--r--  2.0 unx     2252 b- defN 23-Jul-05 08:45 kvirt/cluster/microshift/scripts/05_acm.sh
--rw-r--r--  2.0 unx      696 b- defN 23-Jul-05 08:45 kvirt/cluster/microshift/scripts/deploy.sh
--rw-r--r--  2.0 unx      219 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/01-workload-partitioning
--rw-r--r--  2.0 unx      573 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/10-node-ip-hint.yaml
--rw-r--r--  2.0 unx      980 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/99-apps.yaml
--rw-r--r--  2.0 unx      618 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/99-bootstrap-deletion-2.yaml
--rw-r--r--  2.0 unx     1239 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/99-bootstrap-deletion.yaml
--rw-r--r--  2.0 unx      529 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/99-chrony.yaml
--rw-r--r--  2.0 unx      646 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/99-forcedns
--rw-r--r--  2.0 unx      476 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/99-forcedns-ibm
--rw-r--r--  2.0 unx      854 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/99-kubevirt-fix.yaml
--rw-r--r--  2.0 unx     1127 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/99-localhost-fix.yaml
--rw-r--r--  2.0 unx      250 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/99-metal3-fake-machine.yaml
--rw-r--r--  2.0 unx      162 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/99-metal3-provisioning.yaml
--rw-r--r--  2.0 unx     1659 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/99-notifications.yaml
--rw-r--r--  2.0 unx      118 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/99-operatorhub.yaml
--rw-r--r--  2.0 unx      314 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/99-ovn.yaml
--rw-r--r--  2.0 unx      912 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/99-sno.yaml
--rw-r--r--  2.0 unx      762 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/Corefile
--rw-r--r--  2.0 unx    90139 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/__init__.py
--rw-r--r--  2.0 unx     1325 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/autoapprovercron.yml
--rw-r--r--  2.0 unx      987 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/autorules.yml
--rw-r--r--  2.0 unx     1630 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/bootstrap.yml
--rw-r--r--  2.0 unx      250 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/calico.sh.j2
--rw-r--r--  2.0 unx      107 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/chrony.conf
--rw-r--r--  2.0 unx      629 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/cloud_bootstrap.yml
--rw-r--r--  2.0 unx      792 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/cloud_ctlplanes.yml
--rw-r--r--  2.0 unx      217 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/cloud_dns.yml
--rw-r--r--  2.0 unx      616 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/cloud_lb_api.yml
--rw-r--r--  2.0 unx      224 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/cloud_lb_apps.yml
--rw-r--r--  2.0 unx      703 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/cloud_workers.yml
--rw-r--r--  2.0 unx      123 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/cluster-ingress-02-config.yml
--rw-r--r--  2.0 unx      159 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/cluster-scheduler-02-config.yml
--rw-r--r--  2.0 unx      224 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/config.hcl.templ
--rw-r--r--  2.0 unx       98 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/contrail-ca-patch.service
--rw-r--r--  2.0 unx      486 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/contrail-ca-patch.sh
--rw-r--r--  2.0 unx       87 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/contrail.auth
--rw-r--r--  2.0 unx     1108 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/contrail.sh.j2
--rw-r--r--  2.0 unx     2278 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/ctlplanes.yml
--rw-r--r--  2.0 unx      326 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/dhcp.conf
--rw-r--r--  2.0 unx      106 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/dhcp.sh
--rw-r--r--  2.0 unx      536 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/dhcp.yml
--rw-r--r--  2.0 unx      836 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/disconnected.yml
--rw-r--r--  2.0 unx     8945 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/fake_kubeconfig.json
--rw-r--r--  2.0 unx       35 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/fake_pull.json
--rw-r--r--  2.0 unx     1792 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/haproxy.cfg
--rw-r--r--  2.0 unx     2483 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/haproxy.cfg.kubevirt
--rw-r--r--  2.0 unx      902 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/httpd.yaml
--rw-r--r--  2.0 unx      524 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/ignition.j2
--rw-r--r--  2.0 unx     4088 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/install-config.yaml
--rw-r--r--  2.0 unx     2691 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/iso.sh
--rw-r--r--  2.0 unx      237 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/kcli-ipv6.conf.j2
--rw-r--r--  2.0 unx     4489 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/kcli_default.yml
--rw-r--r--  2.0 unx      982 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/keepalived.conf
--rw-r--r--  2.0 unx       60 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/nonlocalbind.conf
--rw-r--r--  2.0 unx       59 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/openshift-workload-pinning
--rw-r--r--  2.0 unx      157 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/relocate-ip-bootstrap.service
--rw-r--r--  2.0 unx      281 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/relocate-ip-bootstrap.sh
--rw-r--r--  2.0 unx      690 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/relocate-ip.sh
--rw-r--r--  2.0 unx      212 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/sno-finish.service
--rw-r--r--  2.0 unx     2085 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/sno-finish.sh
--rw-r--r--  2.0 unx      660 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/sno.yml
--rw-r--r--  2.0 unx     1615 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/workers.yml
--rw-r--r--  2.0 unx       40 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/apps/cr.sh
--rw-r--r--  2.0 unx      768 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/apps/install.yml.j2
--rw-r--r--  2.0 unx      162 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/apps/advanced-cluster-management/99-metal3-provisioning.yaml
--rw-r--r--  2.0 unx     2913 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/apps/advanced-cluster-management/assisted-service.sample.yml
--rwxr-xr-x  2.0 unx     2838 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/apps/advanced-cluster-management/assisted-service.sh
--rw-r--r--  2.0 unx      418 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/apps/advanced-cluster-management/cr.yml
--rw-r--r--  2.0 unx      625 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/apps/advanced-cluster-management/gen_registries.py
--rw-r--r--  2.0 unx      290 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/apps/advanced-cluster-management/kcli_default.yml
--rw-r--r--  2.0 unx     1219 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/apps/advanced-cluster-management/post.sh
--rw-r--r--  2.0 unx      645 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/apps/argocd/configmap.yml
--rw-r--r--  2.0 unx     2423 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/apps/argocd/install.sh
--rw-r--r--  2.0 unx       49 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/apps/argocd/kcli_default.yml
--rw-r--r--  2.0 unx     1093 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/apps/autolabeller/cr.yml
--rw-r--r--  2.0 unx      142 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/apps/autolabeller/install.sh
--rw-r--r--  2.0 unx     1093 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/apps/autolabeller/install.yml
--rw-r--r--  2.0 unx      165 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/apps/autolabeller/kcli_default.yml
--rw-r--r--  2.0 unx       25 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/apps/autolabeller/uninstall.sh
--rw-r--r--  2.0 unx      873 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/apps/cluster-logging/cr.yml
--rw-r--r--  2.0 unx       63 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/apps/cluster-logging/kcli_default.yml
--rw-r--r--  2.0 unx      265 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/apps/istio/install.sh
--rw-r--r--  2.0 unx      377 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/apps/istio/istio-cni.yaml
--rw-r--r--  2.0 unx     1039 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/apps/kubevirt-hyperconverged/cr.yml
--rw-r--r--  2.0 unx      154 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/apps/kubevirt-hyperconverged/kcli_default.yml
--rw-r--r--  2.0 unx      775 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/apps/local-storage-operator/cr.yml
--rw-r--r--  2.0 unx      227 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/apps/local-storage-operator/kcli_default.yml
--rw-r--r--  2.0 unx      642 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/apps/local-storage-operator/post.sh
--rw-r--r--  2.0 unx      349 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/apps/lvms-operator/cr.yml
--rw-r--r--  2.0 unx      137 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/apps/lvms-operator/kcli_default.yml
--rw-r--r--  2.0 unx      595 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/apps/lvms-operator/post.sh
--rw-r--r--  2.0 unx      510 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/apps/metallb-operator/cr.yml
--rw-r--r--  2.0 unx       94 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/apps/metallb-operator/kcli_default.yml
--rw-r--r--  2.0 unx      162 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/apps/multicluster-engine/99-metal3-provisioning.yaml
--rw-r--r--  2.0 unx     2913 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/apps/multicluster-engine/assisted-service.sample.yml
--rwxr-xr-x  2.0 unx     2845 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/apps/multicluster-engine/assisted-service.sh
--rw-r--r--  2.0 unx      245 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/apps/multicluster-engine/cr.yml
--rw-r--r--  2.0 unx      625 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/apps/multicluster-engine/gen_registries.py
--rw-r--r--  2.0 unx      149 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/apps/multicluster-engine/kcli_default.yml
--rwxr-xr-x  2.0 unx       55 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/apps/multicluster-engine/post.sh
--rwxr-xr-x  2.0 unx     2298 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/apps/nfs/install.sh
--rw-r--r--  2.0 unx      117 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/apps/nfs/kcli_default.yml
--rw-r--r--  2.0 unx      185 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/apps/nfs/uninstall.sh
--rw-r--r--  2.0 unx      849 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/apps/odf-operator/cr.yml
--rw-r--r--  2.0 unx      298 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/apps/odf-operator/kcli_default.yml
--rw-r--r--  2.0 unx      364 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/apps/odf-operator/nad_cluster.yml
--rw-r--r--  2.0 unx      362 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/apps/odf-operator/nad_public.yml
--rw-r--r--  2.0 unx      745 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/apps/odf-operator/post.sh
--rw-r--r--  2.0 unx      530 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/apps/odf-operator/pre.sh
--rw-r--r--  2.0 unx      363 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/apps/serverless-operator/cr.yml
--rw-r--r--  2.0 unx      157 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/apps/serverless-operator/kcli_default.yml
--rw-r--r--  2.0 unx      278 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/apps/serverless-operator/post.sh
--rw-r--r--  2.0 unx     1227 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/apps/users/install.sh
--rw-r--r--  2.0 unx       84 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/apps/users/kcli_default.yml
--rw-r--r--  2.0 unx      258 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/apps/users/oauth.yml
--rw-r--r--  2.0 unx      249 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/apps/users/oauth_hypershift.yml
--rw-r--r--  2.0 unx      422 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/apps/users/uninstall.sh
--rw-r--r--  2.0 unx       60 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/customisation/00-kcli-namespace.yaml
--rw-r--r--  2.0 unx       91 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/customisation/97-autoapprovercron-sa.yaml
--rw-r--r--  2.0 unx      264 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/customisation/98-autoapprovercron-binding.yaml
--rw-r--r--  2.0 unx      911 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/customisation/99-autoapprovercron-cronjob.yaml
--rw-r--r--  2.0 unx      389 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/customisation/99-ingress-controller.yaml
--rw-r--r--  2.0 unx      184 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/customisation/99-monitoring.yaml
--rw-r--r--  2.0 unx      289 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/customisation/99-registry.yaml
--rw-r--r--  2.0 unx     1685 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/disconnected/haproxy.cfg
--rw-r--r--  2.0 unx      211 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/disconnected/registry.service
--rwxr-xr-x  2.0 unx      328 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/disconnected/bin/sync_image.sh
--rwxr-xr-x  2.0 unx      201 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/disconnected/scripts/01_get_oc.sh
--rwxr-xr-x  2.0 unx     2381 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/disconnected/scripts/03_mirror.sh
--rwxr-xr-x  2.0 unx     2046 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/disconnected/scripts/03_registry.sh
--rwxr-xr-x  2.0 unx      337 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/disconnected/scripts/04_extras.sh
--rwxr-xr-x  2.0 unx     2319 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/disconnected/scripts/05_olm.sh
--rwxr-xr-x  2.0 unx      241 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/disconnected/scripts/06_web.sh
--rwxr-xr-x  2.0 unx      733 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/disconnected/scripts/deploy.sh
--rw-r--r--  2.0 unx     4223 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/disconnected/scripts/mirror-config.yaml.sample
--rw-r--r--  2.0 unx     2557 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/staticpods/coredns.yml
--rw-r--r--  2.0 unx      987 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/staticpods/haproxy.yml
--rw-r--r--  2.0 unx     2539 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/staticpods/keepalived.yml
--rw-r--r--  2.0 unx     1721 b- defN 23-Jul-05 08:45 kvirt/cluster/openshift/staticpods/mdns.yml
--rw-r--r--  2.0 unx      193 b- defN 23-Jul-05 08:45 kvirt/cluster/profiles/sample-kubeadm-default.yml
--rw-r--r--  2.0 unx      135 b- defN 23-Jul-05 08:45 kvirt/cluster/profiles/sample-openshift-compact.yml
--rw-r--r--  2.0 unx      210 b- defN 23-Jul-05 08:45 kvirt/cluster/profiles/sample-openshift-contrail.yml
--rw-r--r--  2.0 unx      157 b- defN 23-Jul-05 08:45 kvirt/cluster/profiles/sample-openshift-ipv6.yml
--rw-r--r--  2.0 unx       55 b- defN 23-Jul-05 08:45 kvirt/cluster/profiles/sample-openshift-sno-bm.yml
--rw-r--r--  2.0 unx      148 b- defN 23-Jul-05 08:45 kvirt/cluster/profiles/sample-openshift-sno.yml
--rw-r--r--  2.0 unx     3377 b- defN 23-Jul-05 08:45 kvirt/common/Jenkinsfile.j2
--rw-r--r--  2.0 unx    96580 b- defN 23-Jul-05 08:45 kvirt/common/__init__.py
--rw-r--r--  2.0 unx     1406 b- defN 23-Jul-05 08:45 kvirt/common/autoscale.yaml.j2
--rw-r--r--  2.0 unx     8945 b- defN 23-Jul-05 08:45 kvirt/common/fake_kubeconfig.json
--rw-r--r--  2.0 unx      669 b- defN 23-Jul-05 08:45 kvirt/common/ignition.j2
--rw-r--r--  2.0 unx      125 b- defN 23-Jul-05 08:45 kvirt/common/kubevirt_kcli_conf.j2
--rw-r--r--  2.0 unx       99 b- defN 23-Jul-05 08:45 kvirt/common/local_kcli_conf.j2
--rw-r--r--  2.0 unx     3068 b- defN 23-Jul-05 08:45 kvirt/common/pipeline.yml.j2
--rw-r--r--  2.0 unx     2377 b- defN 23-Jul-05 08:45 kvirt/common/pipeline_kube.yml.j2
--rw-r--r--  2.0 unx     1381 b- defN 23-Jul-05 08:45 kvirt/common/playbook.j2
--rw-r--r--  2.0 unx      833 b- defN 23-Jul-05 08:45 kvirt/common/storage.sh.aws
--rw-r--r--  2.0 unx      635 b- defN 23-Jul-05 08:45 kvirt/common/storage.sh.gcp
--rw-r--r--  2.0 unx       68 b- defN 23-Jul-05 08:45 kvirt/common/storage.sh.ibmcloud
--rw-r--r--  2.0 unx     4562 b- defN 23-Jul-05 08:45 kvirt/common/vm.ovf.j2
--rw-r--r--  2.0 unx     2241 b- defN 23-Jul-05 08:45 kvirt/common/workflow.yml.j2
--rw-r--r--  2.0 unx     2208 b- defN 23-Jul-05 08:45 kvirt/common/workflow_script.yml.j2
--rw-r--r--  2.0 unx    15041 b- defN 23-Jul-05 08:45 kvirt/container/__init__.py
--rw-r--r--  2.0 unx    11716 b- defN 23-Jul-05 08:45 kvirt/expose/__init__.py
--rw-r--r--  2.0 unx     4319 b- defN 23-Jul-05 08:45 kvirt/expose/swagger.yml
--rw-r--r--  2.0 unx      408 b- defN 23-Jul-05 08:45 kvirt/expose/static/css/bootstrap-notify.css
--rw-r--r--  2.0 unx   121125 b- defN 23-Jul-05 08:45 kvirt/expose/static/css/bootstrap.min.css
--rw-r--r--  2.0 unx      399 b- defN 23-Jul-05 08:45 kvirt/expose/static/css/dataTables.checkboxes.css
--rw-r--r--  2.0 unx    13587 b- defN 23-Jul-05 08:45 kvirt/expose/static/css/jquery.dataTables.min.css
--rw-r--r--  2.0 unx      868 b- defN 23-Jul-05 08:45 kvirt/expose/static/css/kcli.css
--rw-r--r--  2.0 unx      269 b- defN 23-Jul-05 08:45 kvirt/expose/static/css/wheel.css
--rw-r--r--  2.0 unx     1406 b- defN 23-Jul-05 08:45 kvirt/expose/static/images/favicon.ico
--rw-r--r--  2.0 unx      160 b- defN 23-Jul-05 08:45 kvirt/expose/static/images/sort_asc.png
--rw-r--r--  2.0 unx      201 b- defN 23-Jul-05 08:45 kvirt/expose/static/images/sort_both.png
--rw-r--r--  2.0 unx      158 b- defN 23-Jul-05 08:45 kvirt/expose/static/images/sort_desc.png
--rw-r--r--  2.0 unx    24772 b- defN 23-Jul-05 08:45 kvirt/expose/static/images/wheel.gif
--rw-r--r--  2.0 unx    12398 b- defN 23-Jul-05 08:45 kvirt/expose/static/js/dataTables.checkboxes.min.js
--rw-r--r--  2.0 unx      367 b- defN 23-Jul-05 08:45 kvirt/expose/static/js/exposeactions.js
--rw-r--r--  2.0 unx    83059 b- defN 23-Jul-05 08:45 kvirt/expose/static/js/jquery.dataTables.min.js
--rw-r--r--  2.0 unx    89795 b- defN 23-Jul-05 08:45 kvirt/expose/static/js/jquery.min.js
--rw-r--r--  2.0 unx      263 b- defN 23-Jul-05 08:45 kvirt/expose/static/js/list.js
--rw-r--r--  2.0 unx     1605 b- defN 23-Jul-05 08:45 kvirt/expose/templates/form.html
--rw-r--r--  2.0 unx     1035 b- defN 23-Jul-05 08:45 kvirt/expose/templates/head.html
--rw-r--r--  2.0 unx      406 b- defN 23-Jul-05 08:45 kvirt/expose/templates/index.html
--rw-r--r--  2.0 unx     1220 b- defN 23-Jul-05 08:45 kvirt/expose/templates/infoplan.html
--rw-r--r--  2.0 unx      574 b- defN 23-Jul-05 08:45 kvirt/expose/templates/planstable.html
--rw-r--r--  2.0 unx      550 b- defN 23-Jul-05 08:45 kvirt/expose/templates/result.html
--rw-r--r--  2.0 unx     1754 b- defN 23-Jul-05 08:45 kvirt/internalplans/__init__.py
--rw-r--r--  2.0 unx        0 b- defN 23-Jul-05 08:45 kvirt/jinjafilters/__init__.py
--rw-r--r--  2.0 unx     5351 b- defN 23-Jul-05 08:45 kvirt/jinjafilters/jinjafilters.py
--rw-r--r--  2.0 unx     9013 b- defN 23-Jul-05 08:45 kvirt/kfish/__init__.py
--rw-r--r--  2.0 unx    10455 b- defN 23-Jul-05 08:45 kvirt/ksushy/__init__.py
--rw-r--r--  2.0 unx      121 b- defN 23-Jul-05 08:45 kvirt/ksushy/main.py
--rw-r--r--  2.0 unx     1028 b- defN 23-Jul-05 08:45 kvirt/ksushy/templates/bios.json
--rw-r--r--  2.0 unx      443 b- defN 23-Jul-05 08:45 kvirt/ksushy/templates/interface.json
--rw-r--r--  2.0 unx      418 b- defN 23-Jul-05 08:45 kvirt/ksushy/templates/interfaces.json
--rw-r--r--  2.0 unx     1050 b- defN 23-Jul-05 08:45 kvirt/ksushy/templates/manager.json
--rw-r--r--  2.0 unx      571 b- defN 23-Jul-05 08:45 kvirt/ksushy/templates/managers.json
--rw-r--r--  2.0 unx      554 b- defN 23-Jul-05 08:45 kvirt/ksushy/templates/root.json
--rw-r--r--  2.0 unx     2760 b- defN 23-Jul-05 08:45 kvirt/ksushy/templates/system.json
--rw-r--r--  2.0 unx      511 b- defN 23-Jul-05 08:45 kvirt/ksushy/templates/systems.json
--rw-r--r--  2.0 unx     1219 b- defN 23-Jul-05 08:45 kvirt/ksushy/templates/virtualmedia_cd.json
--rw-r--r--  2.0 unx      705 b- defN 23-Jul-05 08:45 kvirt/ksushy/templates/virtualmedias.json
--rw-r--r--  2.0 unx     2780 b- defN 23-Jul-05 08:45 kvirt/miniconsole/__init__.py
--rw-r--r--  2.0 unx     3733 b- defN 23-Jul-05 08:45 kvirt/nameutils/__init__.py
--rw-r--r--  2.0 unx        0 b- defN 23-Jul-05 08:45 kvirt/providers/__init__.py
--rw-r--r--  2.0 unx     9038 b- defN 23-Jul-05 08:45 kvirt/providers/sampleprovider.py
--rw-r--r--  2.0 unx    71311 b- defN 23-Jul-05 08:45 kvirt/providers/aws/__init__.py
--rw-r--r--  2.0 unx      260 b- defN 23-Jul-05 08:45 kvirt/providers/aws/assume_policy.json
--rw-r--r--  2.0 unx     1764 b- defN 23-Jul-05 08:45 kvirt/providers/aws/ctlplane_policy.json
--rw-r--r--  2.0 unx      174 b- defN 23-Jul-05 08:45 kvirt/providers/aws/worker_policy.json
--rw-r--r--  2.0 unx      479 b- defN 23-Jul-05 08:45 kvirt/providers/fake/__init__.py
--rw-r--r--  2.0 unx    75004 b- defN 23-Jul-05 08:45 kvirt/providers/gcp/__init__.py
--rw-r--r--  2.0 unx      175 b- defN 23-Jul-05 08:45 kvirt/providers/gcp/gcp-hack.service
--rw-r--r--  2.0 unx      231 b- defN 23-Jul-05 08:45 kvirt/providers/gcp/gcp-hack.sh
--rw-r--r--  2.0 unx    65166 b- defN 23-Jul-05 08:45 kvirt/providers/ibm/__init__.py
--rw-r--r--  2.0 unx    81078 b- defN 23-Jul-05 08:45 kvirt/providers/kubevirt/__init__.py
--rw-r--r--  2.0 unx   186182 b- defN 23-Jul-05 08:45 kvirt/providers/kvm/__init__.py
--rw-r--r--  2.0 unx     1965 b- defN 23-Jul-05 08:45 kvirt/providers/kvm/helpers.py
--rw-r--r--  2.0 unx    57194 b- defN 23-Jul-05 08:45 kvirt/providers/openstack/__init__.py
--rw-r--r--  2.0 unx    62662 b- defN 23-Jul-05 08:45 kvirt/providers/ovirt/__init__.py
--rw-r--r--  2.0 unx    31230 b- defN 23-Jul-05 08:45 kvirt/providers/packet/__init__.py
--rw-r--r--  2.0 unx    29262 b- defN 23-Jul-05 08:45 kvirt/providers/proxmox/__init__.py
--rw-r--r--  2.0 unx    73215 b- defN 23-Jul-05 08:45 kvirt/providers/vsphere/__init__.py
--rw-r--r--  2.0 unx    13655 b- defN 23-Jul-05 08:45 kvirt/providers/vsphere/helpers.py
--rw-r--r--  2.0 unx     4893 b- defN 23-Jul-05 08:45 kvirt/providers/vsphere/tagging.py
--rw-r--r--  2.0 unx    21420 b- defN 23-Jul-05 08:45 kvirt/providers/web/__init__.py
--rw-r--r--  2.0 unx        0 b- defN 23-Jul-05 08:45 kvirt/version/__init__.py
--rw-r--r--  2.0 unx       19 b- defN 23-Jul-05 08:50 kvirt/version/git
--rw-r--r--  2.0 unx    46652 b- defN 23-Jul-05 08:45 kvirt/web/__init__.py
--rw-r--r--  2.0 unx      261 b- defN 23-Jul-05 08:45 kvirt/web/main.py
--rw-r--r--  2.0 unx      408 b- defN 23-Jul-05 08:45 kvirt/web/static/css/bootstrap-notify.css
--rw-r--r--  2.0 unx    23409 b- defN 23-Jul-05 08:45 kvirt/web/static/css/bootstrap-theme.min.css
--rw-r--r--  2.0 unx   121125 b- defN 23-Jul-05 08:45 kvirt/web/static/css/bootstrap.min.css
--rw-r--r--  2.0 unx      399 b- defN 23-Jul-05 08:45 kvirt/web/static/css/dataTables.checkboxes.css
--rw-r--r--  2.0 unx    13587 b- defN 23-Jul-05 08:45 kvirt/web/static/css/jquery.dataTables.min.css
--rw-r--r--  2.0 unx      816 b- defN 23-Jul-05 08:45 kvirt/web/static/css/kcli.css
--rw-r--r--  2.0 unx     3033 b- defN 23-Jul-05 08:45 kvirt/web/static/css/navbar.css
--rw-r--r--  2.0 unx     2908 b- defN 23-Jul-05 08:45 kvirt/web/static/css/spice.css
--rw-r--r--  2.0 unx      271 b- defN 23-Jul-05 08:45 kvirt/web/static/css/wheel.css
--rw-r--r--  2.0 unx    18028 b- defN 23-Jul-05 08:45 kvirt/web/static/fonts/glyphicons-halflings-regular.woff2
--rw-r--r--  2.0 unx      715 b- defN 23-Jul-05 08:45 kvirt/web/static/images/Centos.png
--rw-r--r--  2.0 unx      294 b- defN 23-Jul-05 08:45 kvirt/web/static/images/Debian.png
--rw-r--r--  2.0 unx      987 b- defN 23-Jul-05 08:45 kvirt/web/static/images/Fedora.png
--rw-r--r--  2.0 unx      672 b- defN 23-Jul-05 08:45 kvirt/web/static/images/Redhat.png
--rw-r--r--  2.0 unx     1278 b- defN 23-Jul-05 08:45 kvirt/web/static/images/Suse.png
--rw-r--r--  2.0 unx     1782 b- defN 23-Jul-05 08:45 kvirt/web/static/images/Tux.png
--rw-r--r--  2.0 unx      544 b- defN 23-Jul-05 08:45 kvirt/web/static/images/Ubuntu.png
--rw-r--r--  2.0 unx     4213 b- defN 23-Jul-05 08:45 kvirt/web/static/images/delete.png
--rw-r--r--  2.0 unx     1406 b- defN 23-Jul-05 08:45 kvirt/web/static/images/favicon.ico
--rw-r--r--  2.0 unx    23320 b- defN 23-Jul-05 08:45 kvirt/web/static/images/kcli-small.png
--rw-r--r--  2.0 unx    27185 b- defN 23-Jul-05 08:45 kvirt/web/static/images/kcli.jpg
--rw-r--r--  2.0 unx   113928 b- defN 23-Jul-05 08:45 kvirt/web/static/images/kcli.png
--rw-r--r--  2.0 unx    48809 b- defN 23-Jul-05 08:45 kvirt/web/static/images/logo-header.svg
--rw-r--r--  2.0 unx    48809 b- defN 23-Jul-05 08:45 kvirt/web/static/images/logo-main.svg
--rw-r--r--  2.0 unx      160 b- defN 23-Jul-05 08:45 kvirt/web/static/images/sort_asc.png
--rw-r--r--  2.0 unx      201 b- defN 23-Jul-05 08:45 kvirt/web/static/images/sort_both.png
--rw-r--r--  2.0 unx      158 b- defN 23-Jul-05 08:45 kvirt/web/static/images/sort_desc.png
--rw-r--r--  2.0 unx     3927 b- defN 23-Jul-05 08:45 kvirt/web/static/images/start.png
--rw-r--r--  2.0 unx     3631 b- defN 23-Jul-05 08:45 kvirt/web/static/images/stop.png
--rw-r--r--  2.0 unx    24772 b- defN 23-Jul-05 08:45 kvirt/web/static/images/wheel.gif
--rw-r--r--  2.0 unx     2933 b- defN 23-Jul-05 08:45 kvirt/web/static/js/bootstrap-notify.js
--rw-r--r--  2.0 unx    37045 b- defN 23-Jul-05 08:45 kvirt/web/static/js/bootstrap.min.js
--rw-r--r--  2.0 unx     2523 b- defN 23-Jul-05 08:45 kvirt/web/static/js/containeraction.js
--rw-r--r--  2.0 unx    12398 b- defN 23-Jul-05 08:45 kvirt/web/static/js/dataTables.checkboxes.min.js
--rw-r--r--  2.0 unx     1642 b- defN 23-Jul-05 08:45 kvirt/web/static/js/hostaction.js
--rw-r--r--  2.0 unx     1187 b- defN 23-Jul-05 08:45 kvirt/web/static/js/imageaction.js
--rw-r--r--  2.0 unx    83059 b- defN 23-Jul-05 08:45 kvirt/web/static/js/jquery.dataTables.min.js
--rw-r--r--  2.0 unx    87462 b- defN 23-Jul-05 08:45 kvirt/web/static/js/jquery.min.js
--rw-r--r--  2.0 unx     2704 b- defN 23-Jul-05 08:45 kvirt/web/static/js/kcli.js
--rw-r--r--  2.0 unx     1594 b- defN 23-Jul-05 08:45 kvirt/web/static/js/kubeaction.js
--rw-r--r--  2.0 unx     3907 b- defN 23-Jul-05 08:45 kvirt/web/static/js/list.js
--rw-r--r--  2.0 unx     1376 b- defN 23-Jul-05 08:45 kvirt/web/static/js/networkaction.js
--rw-r--r--  2.0 unx     2457 b- defN 23-Jul-05 08:45 kvirt/web/static/js/planaction.js
--rw-r--r--  2.0 unx     1237 b- defN 23-Jul-05 08:45 kvirt/web/static/js/poolaction.js
--rw-r--r--  2.0 unx      846 b- defN 23-Jul-05 08:45 kvirt/web/static/js/productaction.js
--rw-r--r--  2.0 unx      270 b- defN 23-Jul-05 08:45 kvirt/web/static/js/refresh.js
--rw-r--r--  2.0 unx     1835 b- defN 23-Jul-05 08:45 kvirt/web/static/js/repoaction.js
--rw-r--r--  2.0 unx     3463 b- defN 23-Jul-05 08:45 kvirt/web/static/js/snapshotaction.js
--rw-r--r--  2.0 unx     2745 b- defN 23-Jul-05 08:45 kvirt/web/static/js/vmaction.js
--rw-r--r--  2.0 unx      123 b- defN 23-Jul-05 08:45 kvirt/web/static/js/wheel.js
--rw-r--r--  2.0 unx     9944 b- defN 23-Jul-05 08:45 kvirt/web/static/js/spice/atKeynames.js
--rw-r--r--  2.0 unx     2335 b- defN 23-Jul-05 08:45 kvirt/web/static/js/spice/bitmap.js
--rw-r--r--  2.0 unx     4795 b- defN 23-Jul-05 08:45 kvirt/web/static/js/spice/cursor.js
--rw-r--r--  2.0 unx    49214 b- defN 23-Jul-05 08:45 kvirt/web/static/js/spice/display.js
--rw-r--r--  2.0 unx    13253 b- defN 23-Jul-05 08:45 kvirt/web/static/js/spice/enums.js
--rw-r--r--  2.0 unx     2847 b- defN 23-Jul-05 08:45 kvirt/web/static/js/spice/filexfer.js
--rw-r--r--  2.0 unx     9535 b- defN 23-Jul-05 08:45 kvirt/web/static/js/spice/inputs.js
--rw-r--r--  2.0 unx     6176 b- defN 23-Jul-05 08:45 kvirt/web/static/js/spice/lz.js
--rw-r--r--  2.0 unx    18370 b- defN 23-Jul-05 08:45 kvirt/web/static/js/spice/main.js
--rw-r--r--  2.0 unx    12677 b- defN 23-Jul-05 08:45 kvirt/web/static/js/spice/playback.js
--rw-r--r--  2.0 unx     7036 b- defN 23-Jul-05 08:45 kvirt/web/static/js/spice/png.js
--rw-r--r--  2.0 unx     3110 b- defN 23-Jul-05 08:45 kvirt/web/static/js/spice/port.js
--rw-r--r--  2.0 unx    44531 b- defN 23-Jul-05 08:45 kvirt/web/static/js/spice/quic.js
--rw-r--r--  2.0 unx     3030 b- defN 23-Jul-05 08:45 kvirt/web/static/js/spice/resize.js
--rw-r--r--  2.0 unx     7282 b- defN 23-Jul-05 08:45 kvirt/web/static/js/spice/simulatecursor.js
--rw-r--r--  2.0 unx     1895 b- defN 23-Jul-05 08:45 kvirt/web/static/js/spice/spicearraybuffer.js
--rw-r--r--  2.0 unx    18202 b- defN 23-Jul-05 08:45 kvirt/web/static/js/spice/spiceconn.js
--rw-r--r--  2.0 unx     3616 b- defN 23-Jul-05 08:45 kvirt/web/static/js/spice/spicedataview.js
--rw-r--r--  2.0 unx    33015 b- defN 23-Jul-05 08:45 kvirt/web/static/js/spice/spicemsg.js
--rw-r--r--  2.0 unx    12767 b- defN 23-Jul-05 08:45 kvirt/web/static/js/spice/spicetype.js
--rw-r--r--  2.0 unx     6808 b- defN 23-Jul-05 08:45 kvirt/web/static/js/spice/ticket.js
--rw-r--r--  2.0 unx    13628 b- defN 23-Jul-05 08:45 kvirt/web/static/js/spice/utils.js
--rw-r--r--  2.0 unx    21577 b- defN 23-Jul-05 08:45 kvirt/web/static/js/spice/webm.js
--rw-r--r--  2.0 unx     4131 b- defN 23-Jul-05 08:45 kvirt/web/static/js/spice/wire.js
--rw-r--r--  2.0 unx    16580 b- defN 23-Jul-05 08:45 kvirt/web/static/js/spice/thirdparty/jsbn.js
--rw-r--r--  2.0 unx     2529 b- defN 23-Jul-05 08:45 kvirt/web/static/js/spice/thirdparty/prng4.js
--rw-r--r--  2.0 unx     3442 b- defN 23-Jul-05 08:45 kvirt/web/static/js/spice/thirdparty/rng.js
--rw-r--r--  2.0 unx     4257 b- defN 23-Jul-05 08:45 kvirt/web/static/js/spice/thirdparty/rsa.js
--rw-r--r--  2.0 unx    10671 b- defN 23-Jul-05 08:45 kvirt/web/static/js/spice/thirdparty/sha1.js
--rw-r--r--  2.0 unx        0 b- defN 23-Jul-05 08:45 kvirt/web/static/js/spice/thirdparty/browser-es-module-loader/.npmignore
--rw-r--r--  2.0 unx      419 b- defN 23-Jul-05 08:45 kvirt/web/static/js/spice/thirdparty/browser-es-module-loader/README.md
--rw-r--r--  2.0 unx      359 b- defN 23-Jul-05 08:45 kvirt/web/static/js/spice/thirdparty/browser-es-module-loader/rollup.config.js
--rw-r--r--  2.0 unx     1113 b- defN 23-Jul-05 08:45 kvirt/web/static/js/spice/thirdparty/browser-es-module-loader/src/babel-worker.js
--rw-r--r--  2.0 unx     8601 b- defN 23-Jul-05 08:45 kvirt/web/static/js/spice/thirdparty/browser-es-module-loader/src/browser-es-module-loader.js
--rw-r--r--  2.0 unx     2176 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/app/error-handler.js
--rw-r--r--  2.0 unx     5682 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/app/localization.js
--rw-r--r--  2.0 unx    56845 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/app/ui.js
--rw-r--r--  2.0 unx     6696 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/app/webutil.js
--rw-r--r--  2.0 unx     3553 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/app/images/alt.svg
--rw-r--r--  2.0 unx     3980 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/app/images/clipboard.svg
--rw-r--r--  2.0 unx     3430 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/app/images/connect.svg
--rw-r--r--  2.0 unx     4381 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/app/images/ctrl.svg
--rw-r--r--  2.0 unx     3237 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/app/images/ctrlaltdel.svg
--rw-r--r--  2.0 unx     5062 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/app/images/disconnect.svg
--rw-r--r--  2.0 unx     4684 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/app/images/drag.svg
--rw-r--r--  2.0 unx     3106 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/app/images/error.svg
--rw-r--r--  2.0 unx     4522 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/app/images/esc.svg
--rw-r--r--  2.0 unx     3066 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/app/images/expander.svg
--rw-r--r--  2.0 unx     3139 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/app/images/fullscreen.svg
--rw-r--r--  2.0 unx     2559 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/app/images/handle.svg
--rw-r--r--  2.0 unx     6386 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/app/images/handle_bg.svg
--rw-r--r--  2.0 unx     3204 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/app/images/info.svg
--rw-r--r--  2.0 unx     6404 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/app/images/keyboard.svg
--rw-r--r--  2.0 unx     7000 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/app/images/mouse_left.svg
--rw-r--r--  2.0 unx     7002 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/app/images/mouse_middle.svg
--rw-r--r--  2.0 unx     6993 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/app/images/mouse_none.svg
--rw-r--r--  2.0 unx     7001 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/app/images/mouse_right.svg
--rw-r--r--  2.0 unx     3985 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/app/images/power.svg
--rw-r--r--  2.0 unx     3082 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/app/images/settings.svg
--rw-r--r--  2.0 unx     2953 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/app/images/tab.svg
--rw-r--r--  2.0 unx     4441 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/app/images/toggleextrakeys.svg
--rw-r--r--  2.0 unx     3869 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/app/images/warning.svg
--rw-r--r--  2.0 unx     3178 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/app/images/windows.svg
--rw-r--r--  2.0 unx      871 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/app/images/icons/Makefile
--rw-r--r--  2.0 unx     4028 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/app/images/icons/novnc-120x120.png
--rw-r--r--  2.0 unx     4582 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/app/images/icons/novnc-144x144.png
--rw-r--r--  2.0 unx     5216 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/app/images/icons/novnc-152x152.png
--rw-r--r--  2.0 unx      675 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/app/images/icons/novnc-16x16.png
--rw-r--r--  2.0 unx     5787 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/app/images/icons/novnc-192x192.png
--rw-r--r--  2.0 unx     1000 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/app/images/icons/novnc-24x24.png
--rw-r--r--  2.0 unx     1064 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/app/images/icons/novnc-32x32.png
--rw-r--r--  2.0 unx     1397 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/app/images/icons/novnc-48x48.png
--rw-r--r--  2.0 unx     1932 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/app/images/icons/novnc-60x60.png
--rw-r--r--  2.0 unx     1946 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/app/images/icons/novnc-64x64.png
--rw-r--r--  2.0 unx     2699 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/app/images/icons/novnc-72x72.png
--rw-r--r--  2.0 unx     2874 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/app/images/icons/novnc-76x76.png
--rw-r--r--  2.0 unx     2351 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/app/images/icons/novnc-96x96.png
--rw-r--r--  2.0 unx    11685 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/app/images/icons/novnc-icon-sm.svg
--rw-r--r--  2.0 unx    11549 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/app/images/icons/novnc-icon.svg
--rw-r--r--  2.0 unx     2885 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/app/locale/cs.json
--rw-r--r--  2.0 unx     2854 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/app/locale/de.json
--rw-r--r--  2.0 unx     3906 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/app/locale/el.json
--rw-r--r--  2.0 unx     2671 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/app/locale/es.json
--rw-r--r--  2.0 unx     3354 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/app/locale/ja.json
--rw-r--r--  2.0 unx     2961 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/app/locale/ko.json
--rw-r--r--  2.0 unx     3035 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/app/locale/nl.json
--rw-r--r--  2.0 unx     2830 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/app/locale/pl.json
--rw-r--r--  2.0 unx     3825 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/app/locale/ru.json
--rw-r--r--  2.0 unx     2845 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/app/locale/sv.json
--rw-r--r--  2.0 unx     2811 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/app/locale/tr.json
--rw-r--r--  2.0 unx     2597 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/app/locale/zh_CN.json
--rw-r--r--  2.0 unx     2606 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/app/locale/zh_TW.json
--rw-r--r--  2.0 unx      157 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/app/sounds/CREDITS
--rw-r--r--  2.0 unx     4531 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/app/sounds/bell.mp3
--rw-r--r--  2.0 unx     8495 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/app/sounds/bell.oga
--rw-r--r--  2.0 unx    38580 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/app/styles/Orbitron700.ttf
--rw-r--r--  2.0 unx    17472 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/app/styles/Orbitron700.woff
--rw-r--r--  2.0 unx    18450 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/app/styles/base.css
--rw-r--r--  2.0 unx     4189 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/core/base64.js
--rw-r--r--  2.0 unx    11241 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/core/des.js
--rw-r--r--  2.0 unx    20381 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/core/display.js
--rw-r--r--  2.0 unx     1374 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/core/encodings.js
--rw-r--r--  2.0 unx     1170 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/core/inflator.js
--rw-r--r--  2.0 unx    74196 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/core/rfb.js
--rw-r--r--  2.0 unx     9130 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/core/websock.js
--rw-r--r--  2.0 unx      628 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/core/decoders/copyrect.js
--rw-r--r--  2.0 unx     4814 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/core/decoders/hextile.js
--rw-r--r--  2.0 unx     1739 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/core/decoders/raw.js
--rw-r--r--  2.0 unx     1210 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/core/decoders/rre.js
--rw-r--r--  2.0 unx     9662 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/core/decoders/tight.js
--rw-r--r--  2.0 unx      768 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/core/decoders/tightpng.js
--rw-r--r--  2.0 unx    11438 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/core/input/domkeytable.js
--rw-r--r--  2.0 unx     3804 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/core/input/fixedkeys.js
--rw-r--r--  2.0 unx    13090 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/core/input/keyboard.js
--rw-r--r--  2.0 unx    34609 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/core/input/keysym.js
--rw-r--r--  2.0 unx    25374 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/core/input/keysymdef.js
--rw-r--r--  2.0 unx     9995 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/core/input/mouse.js
--rw-r--r--  2.0 unx     5283 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/core/input/util.js
--rw-r--r--  2.0 unx     2580 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/core/input/vkeys.js
--rw-r--r--  2.0 unx    14256 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/core/input/xtscancodes.js
--rw-r--r--  2.0 unx     3155 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/core/util/browser.js
--rw-r--r--  2.0 unx     7556 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/core/util/cursor.js
--rw-r--r--  2.0 unx     4221 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/core/util/events.js
--rw-r--r--  2.0 unx      896 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/core/util/eventtarget.js
--rw-r--r--  2.0 unx     1358 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/core/util/logging.js
--rw-r--r--  2.0 unx     1866 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/core/util/polyfill.js
--rw-r--r--  2.0 unx      301 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/core/util/strings.js
--rw-r--r--  2.0 unx     7388 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/vendor/promise.js
--rw-r--r--  2.0 unx      419 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/vendor/browser-es-module-loader/README.md
--rw-r--r--  2.0 unx      295 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/vendor/browser-es-module-loader/rollup.config.js
--rw-r--r--  2.0 unx     1113 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/vendor/browser-es-module-loader/src/babel-worker.js
--rw-r--r--  2.0 unx     8498 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/vendor/browser-es-module-loader/src/browser-es-module-loader.js
--rw-r--r--  2.0 unx     1084 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/vendor/pako/LICENSE
--rw-r--r--  2.0 unx      301 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/vendor/pako/README.md
--rw-r--r--  2.0 unx     1062 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/vendor/pako/lib/utils/common.js
--rw-r--r--  2.0 unx      666 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/vendor/pako/lib/zlib/adler32.js
--rw-r--r--  2.0 unx     1334 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/vendor/pako/lib/zlib/constants.js
--rw-r--r--  2.0 unx      764 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/vendor/pako/lib/zlib/crc32.js
--rw-r--r--  2.0 unx    60016 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/vendor/pako/lib/zlib/deflate.js
--rw-r--r--  2.0 unx     1251 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/vendor/pako/lib/zlib/gzheader.js
--rw-r--r--  2.0 unx    11690 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/vendor/pako/lib/zlib/inffast.js
--rw-r--r--  2.0 unx    47128 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/vendor/pako/lib/zlib/inflate.js
--rw-r--r--  2.0 unx    11527 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/vendor/pako/lib/zlib/inftrees.js
--rw-r--r--  2.0 unx      560 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/vendor/pako/lib/zlib/messages.js
--rw-r--r--  2.0 unx    38767 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/vendor/pako/lib/zlib/trees.js
--rw-r--r--  2.0 unx      823 b- defN 23-Jul-05 08:45 kvirt/web/static/vnc/vendor/pako/lib/zlib/zstream.js
--rw-r--r--  2.0 unx     2509 b- defN 23-Jul-05 08:45 kvirt/web/templates/bootstrap.html
--rw-r--r--  2.0 unx    14595 b- defN 23-Jul-05 08:45 kvirt/web/templates/console.html
--rw-r--r--  2.0 unx      717 b- defN 23-Jul-05 08:45 kvirt/web/templates/containercreate.html
--rw-r--r--  2.0 unx      493 b- defN 23-Jul-05 08:45 kvirt/web/templates/containerprofiles.html
--rw-r--r--  2.0 unx     1050 b- defN 23-Jul-05 08:45 kvirt/web/templates/containerprofilestable.html
--rw-r--r--  2.0 unx      490 b- defN 23-Jul-05 08:45 kvirt/web/templates/containers.html
--rw-r--r--  2.0 unx     1746 b- defN 23-Jul-05 08:45 kvirt/web/templates/containerstable.html
--rw-r--r--  2.0 unx     2123 b- defN 23-Jul-05 08:45 kvirt/web/templates/head.html
--rw-r--r--  2.0 unx      473 b- defN 23-Jul-05 08:45 kvirt/web/templates/hosts.html
--rw-r--r--  2.0 unx     1705 b- defN 23-Jul-05 08:45 kvirt/web/templates/hoststable.html
--rw-r--r--  2.0 unx     1119 b- defN 23-Jul-05 08:45 kvirt/web/templates/imagecreate.html
--rw-r--r--  2.0 unx      478 b- defN 23-Jul-05 08:45 kvirt/web/templates/images.html
--rw-r--r--  2.0 unx      646 b- defN 23-Jul-05 08:45 kvirt/web/templates/imagestable.html
--rw-r--r--  2.0 unx      472 b- defN 23-Jul-05 08:45 kvirt/web/templates/isos.html
--rw-r--r--  2.0 unx      261 b- defN 23-Jul-05 08:45 kvirt/web/templates/isostable.html
--rw-r--r--  2.0 unx      609 b- defN 23-Jul-05 08:45 kvirt/web/templates/kubecreate.html
--rw-r--r--  2.0 unx      622 b- defN 23-Jul-05 08:45 kvirt/web/templates/kubeinfo.html
--rw-r--r--  2.0 unx      488 b- defN 23-Jul-05 08:45 kvirt/web/templates/kubeprofiles.html
--rw-r--r--  2.0 unx      845 b- defN 23-Jul-05 08:45 kvirt/web/templates/kubeprofilestable.html
--rw-r--r--  2.0 unx      475 b- defN 23-Jul-05 08:45 kvirt/web/templates/kubes.html
--rw-r--r--  2.0 unx     1850 b- defN 23-Jul-05 08:45 kvirt/web/templates/kubestable.html
--rw-r--r--  2.0 unx      151 b- defN 23-Jul-05 08:45 kvirt/web/templates/layout.html
--rw-r--r--  2.0 unx     5517 b- defN 23-Jul-05 08:45 kvirt/web/templates/navbar.html
--rw-r--r--  2.0 unx      882 b- defN 23-Jul-05 08:45 kvirt/web/templates/networkcreate.html
--rw-r--r--  2.0 unx      537 b- defN 23-Jul-05 08:45 kvirt/web/templates/networks.html
--rw-r--r--  2.0 unx      845 b- defN 23-Jul-05 08:45 kvirt/web/templates/networkstable.html
--rw-r--r--  2.0 unx      750 b- defN 23-Jul-05 08:45 kvirt/web/templates/plancreate.html
--rw-r--r--  2.0 unx      475 b- defN 23-Jul-05 08:45 kvirt/web/templates/plans.html
--rw-r--r--  2.0 unx     1525 b- defN 23-Jul-05 08:45 kvirt/web/templates/planstable.html
--rw-r--r--  2.0 unx      859 b- defN 23-Jul-05 08:45 kvirt/web/templates/poolcreate.html
--rw-r--r--  2.0 unx      475 b- defN 23-Jul-05 08:45 kvirt/web/templates/pools.html
--rw-r--r--  2.0 unx      554 b- defN 23-Jul-05 08:45 kvirt/web/templates/poolstable.html
--rw-r--r--  2.0 unx     1282 b- defN 23-Jul-05 08:45 kvirt/web/templates/productcreate.html
--rw-r--r--  2.0 unx      484 b- defN 23-Jul-05 08:45 kvirt/web/templates/products.html
--rw-r--r--  2.0 unx      895 b- defN 23-Jul-05 08:45 kvirt/web/templates/productstable.html
--rw-r--r--  2.0 unx      699 b- defN 23-Jul-05 08:45 kvirt/web/templates/repocreate.html
--rw-r--r--  2.0 unx      475 b- defN 23-Jul-05 08:45 kvirt/web/templates/repos.html
--rw-r--r--  2.0 unx     1203 b- defN 23-Jul-05 08:45 kvirt/web/templates/repostable.html
--rw-r--r--  2.0 unx      958 b- defN 23-Jul-05 08:45 kvirt/web/templates/vmcreate.html
--rw-r--r--  2.0 unx      486 b- defN 23-Jul-05 08:45 kvirt/web/templates/vmprofiles.html
--rw-r--r--  2.0 unx     1420 b- defN 23-Jul-05 08:45 kvirt/web/templates/vmprofilestable.html
--rw-r--r--  2.0 unx      470 b- defN 23-Jul-05 08:45 kvirt/web/templates/vms.html
--rw-r--r--  2.0 unx     4894 b- defN 23-Jul-05 08:45 kvirt/web/templates/vmstable.html
--rw-r--r--  2.0 unx    11358 b- defN 23-Jul-05 08:50 kcli-99.0.202307050850.dist-info/LICENSE
--rw-r--r--  2.0 unx     3024 b- defN 23-Jul-05 08:50 kcli-99.0.202307050850.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 23-Jul-05 08:50 kcli-99.0.202307050850.dist-info/WHEEL
--rw-r--r--  2.0 unx      281 b- defN 23-Jul-05 08:50 kcli-99.0.202307050850.dist-info/entry_points.txt
--rw-r--r--  2.0 unx        6 b- defN 23-Jul-05 08:50 kcli-99.0.202307050850.dist-info/top_level.txt
-?rw-rw-r--  2.0 unx    60010 b- defN 23-Jul-05 08:50 kcli-99.0.202307050850.dist-info/RECORD
-613 files, 4656666 bytes uncompressed, 1405158 bytes compressed:  69.8%
+Zip file size: 1503564 bytes, number of entries: 613
+-rw-r--r--  2.0 unx       15 b- defN 23-Jul-05 10:03 kvirt/__init__.py
+-rw-r--r--  2.0 unx   100420 b- defN 23-Jul-05 10:03 kvirt/baseconfig.py
+-rw-r--r--  2.0 unx   171487 b- defN 23-Jul-05 10:03 kvirt/bottle.py
+-rw-r--r--  2.0 unx   259525 b- defN 23-Jul-05 10:03 kvirt/cli.py
+-rw-r--r--  2.0 unx   193245 b- defN 23-Jul-05 10:03 kvirt/config.py
+-rw-r--r--  2.0 unx     2851 b- defN 23-Jul-05 10:03 kvirt/containerconfig.py
+-rw-r--r--  2.0 unx    11612 b- defN 23-Jul-05 10:03 kvirt/defaults.py
+-rw-r--r--  2.0 unx     1475 b- defN 23-Jul-05 10:03 kvirt/ekstoken.py
+-rw-r--r--  2.0 unx    21243 b- defN 23-Jul-05 10:03 kvirt/examples.py
+-rw-r--r--  2.0 unx     1047 b- defN 23-Jul-05 10:03 kvirt/gketoken.py
+-rw-r--r--  2.0 unx     4333 b- defN 23-Jul-05 10:03 kvirt/ignitionmerger.py
+-rw-r--r--  2.0 unx     9871 b- defN 23-Jul-05 10:03 kvirt/keywords.yaml
+-rw-r--r--  2.0 unx     3487 b- defN 23-Jul-05 10:03 kvirt/klist.py
+-rw-r--r--  2.0 unx     6009 b- defN 23-Jul-05 10:03 kvirt/ansibleutils/__init__.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Jul-05 10:03 kvirt/cluster/__init__.py
+-rw-r--r--  2.0 unx      204 b- defN 23-Jul-05 10:03 kvirt/cluster/sampleprovider.py
+-rw-r--r--  2.0 unx    12259 b- defN 23-Jul-05 10:03 kvirt/cluster/eks/__init__.py
+-rw-r--r--  2.0 unx       16 b- defN 23-Jul-05 10:03 kvirt/cluster/eks/fake.yml
+-rw-r--r--  2.0 unx      169 b- defN 23-Jul-05 10:03 kvirt/cluster/eks/kcli_default.yml
+-rw-r--r--  2.0 unx    12218 b- defN 23-Jul-05 10:03 kvirt/cluster/gke/__init__.py
+-rw-r--r--  2.0 unx       16 b- defN 23-Jul-05 10:03 kvirt/cluster/gke/fake.yml
+-rw-r--r--  2.0 unx      497 b- defN 23-Jul-05 10:03 kvirt/cluster/gke/kcli_default.yml
+-rw-r--r--  2.0 unx      405 b- defN 23-Jul-05 10:03 kvirt/cluster/gke/kubeconfig.j2
+-rw-r--r--  2.0 unx      931 b- defN 23-Jul-05 10:03 kvirt/cluster/hypershift/99-apps.yaml
+-rw-r--r--  2.0 unx      694 b- defN 23-Jul-05 10:03 kvirt/cluster/hypershift/99-forcedns
+-rw-r--r--  2.0 unx     1480 b- defN 23-Jul-05 10:03 kvirt/cluster/hypershift/99-notifications.yaml
+-rw-r--r--  2.0 unx      653 b- defN 23-Jul-05 10:03 kvirt/cluster/hypershift/Corefile
+-rw-r--r--  2.0 unx    44036 b- defN 23-Jul-05 10:03 kvirt/cluster/hypershift/__init__.py
+-rw-r--r--  2.0 unx     1121 b- defN 23-Jul-05 10:03 kvirt/cluster/hypershift/assisted_infra.yml
+-rw-r--r--  2.0 unx     1269 b- defN 23-Jul-05 10:03 kvirt/cluster/hypershift/assisted_ingress.yml
+-rw-r--r--  2.0 unx     1366 b- defN 23-Jul-05 10:03 kvirt/cluster/hypershift/autoapprovercron.yml
+-rw-r--r--  2.0 unx     1106 b- defN 23-Jul-05 10:03 kvirt/cluster/hypershift/bmc.yml.j2
+-rw-r--r--  2.0 unx      511 b- defN 23-Jul-05 10:03 kvirt/cluster/hypershift/calico.sh.j2
+-rw-r--r--  2.0 unx      200 b- defN 23-Jul-05 10:03 kvirt/cluster/hypershift/cloud_lb_apps.yml
+-rw-r--r--  2.0 unx     1433 b- defN 23-Jul-05 10:03 kvirt/cluster/hypershift/disconnected.sh
+-rw-r--r--  2.0 unx      184 b- defN 23-Jul-05 10:03 kvirt/cluster/hypershift/extras.service
+-rw-r--r--  2.0 unx      839 b- defN 23-Jul-05 10:03 kvirt/cluster/hypershift/extras.sh
+-rw-r--r--  2.0 unx     3131 b- defN 23-Jul-05 10:03 kvirt/cluster/hypershift/hostedcluster.yaml
+-rw-r--r--  2.0 unx     1174 b- defN 23-Jul-05 10:03 kvirt/cluster/hypershift/httpd.yaml
+-rw-r--r--  2.0 unx      889 b- defN 23-Jul-05 10:03 kvirt/cluster/hypershift/ignition.sh
+-rw-r--r--  2.0 unx     2307 b- defN 23-Jul-05 10:03 kvirt/cluster/hypershift/kcli_plan.yml
+-rw-r--r--  2.0 unx     2069 b- defN 23-Jul-05 10:03 kvirt/cluster/hypershift/kcli_plan_default.yml
+-rw-r--r--  2.0 unx      502 b- defN 23-Jul-05 10:03 kvirt/cluster/hypershift/keepalived.conf
+-rw-r--r--  2.0 unx     1587 b- defN 23-Jul-05 10:03 kvirt/cluster/hypershift/nmstateconfig.yml.j2
+-rw-r--r--  2.0 unx      752 b- defN 23-Jul-05 10:03 kvirt/cluster/hypershift/nodepool.yaml
+-rw-r--r--  2.0 unx       60 b- defN 23-Jul-05 10:03 kvirt/cluster/hypershift/nonlocalbind.conf
+-rw-r--r--  2.0 unx     1890 b- defN 23-Jul-05 10:03 kvirt/cluster/hypershift/staticpods/coredns.yml
+-rw-r--r--  2.0 unx     2142 b- defN 23-Jul-05 10:03 kvirt/cluster/hypershift/staticpods/keepalived.yml
+-rw-r--r--  2.0 unx     1619 b- defN 23-Jul-05 10:03 kvirt/cluster/hypershift/staticpods/mdns.yml
+-rw-r--r--  2.0 unx    13621 b- defN 23-Jul-05 10:03 kvirt/cluster/k3s/__init__.py
+-rw-r--r--  2.0 unx     1117 b- defN 23-Jul-05 10:03 kvirt/cluster/k3s/bootstrap.sh
+-rw-r--r--  2.0 unx     1035 b- defN 23-Jul-05 10:03 kvirt/cluster/k3s/bootstrap.yml
+-rw-r--r--  2.0 unx      441 b- defN 23-Jul-05 10:03 kvirt/cluster/k3s/cloud_lb_api.yml
+-rw-r--r--  2.0 unx      440 b- defN 23-Jul-05 10:03 kvirt/cluster/k3s/ctlplanes.sh
+-rw-r--r--  2.0 unx     1068 b- defN 23-Jul-05 10:03 kvirt/cluster/k3s/ctlplanes.yml
+-rw-r--r--  2.0 unx      231 b- defN 23-Jul-05 10:03 kvirt/cluster/k3s/join.sh
+-rw-r--r--  2.0 unx     1271 b- defN 23-Jul-05 10:03 kvirt/cluster/k3s/kcli_default.yml
+-rw-r--r--  2.0 unx      511 b- defN 23-Jul-05 10:03 kvirt/cluster/k3s/keepalived.conf
+-rw-r--r--  2.0 unx      352 b- defN 23-Jul-05 10:03 kvirt/cluster/k3s/keepalived.sh
+-rw-r--r--  2.0 unx      166 b- defN 23-Jul-05 10:03 kvirt/cluster/k3s/workers.sh
+-rw-r--r--  2.0 unx      709 b- defN 23-Jul-05 10:03 kvirt/cluster/k3s/workers.yml
+-rw-r--r--  2.0 unx    14254 b- defN 23-Jul-05 10:03 kvirt/cluster/kubeadm/__init__.py
+-rwxr-xr-x  2.0 unx     2772 b- defN 23-Jul-05 10:03 kvirt/cluster/kubeadm/bootstrap.sh
+-rw-r--r--  2.0 unx     1550 b- defN 23-Jul-05 10:03 kvirt/cluster/kubeadm/bootstrap.yml
+-rw-r--r--  2.0 unx      338 b- defN 23-Jul-05 10:03 kvirt/cluster/kubeadm/cloud_lb_api.yml
+-rw-r--r--  2.0 unx     1172 b- defN 23-Jul-05 10:03 kvirt/cluster/kubeadm/ctlplanes.yml
+-rwxr-xr-x  2.0 unx      343 b- defN 23-Jul-05 10:03 kvirt/cluster/kubeadm/deploy.sh
+-rwxr-xr-x  2.0 unx      308 b- defN 23-Jul-05 10:03 kvirt/cluster/kubeadm/join.sh
+-rw-r--r--  2.0 unx     1839 b- defN 23-Jul-05 10:03 kvirt/cluster/kubeadm/kcli_default.yml
+-rw-r--r--  2.0 unx      563 b- defN 23-Jul-05 10:03 kvirt/cluster/kubeadm/keepalived.conf
+-rw-r--r--  2.0 unx      424 b- defN 23-Jul-05 10:03 kvirt/cluster/kubeadm/keepalived.sh
+-rw-r--r--  2.0 unx      140 b- defN 23-Jul-05 10:03 kvirt/cluster/kubeadm/kubernetes.repo
+-rw-r--r--  2.0 unx      179 b- defN 23-Jul-05 10:03 kvirt/cluster/kubeadm/multus.sh
+-rw-r--r--  2.0 unx      572 b- defN 23-Jul-05 10:03 kvirt/cluster/kubeadm/nfs.sh
+-rw-r--r--  2.0 unx      226 b- defN 23-Jul-05 10:03 kvirt/cluster/kubeadm/nfs.yml
+-rw-r--r--  2.0 unx     4021 b- defN 23-Jul-05 10:03 kvirt/cluster/kubeadm/pre_el.sh
+-rw-r--r--  2.0 unx     3906 b- defN 23-Jul-05 10:03 kvirt/cluster/kubeadm/pre_ubuntu.sh
+-rw-r--r--  2.0 unx     2127 b- defN 23-Jul-05 10:03 kvirt/cluster/kubeadm/registry.yml
+-rw-r--r--  2.0 unx      949 b- defN 23-Jul-05 10:03 kvirt/cluster/kubeadm/workers.yml
+-rw-r--r--  2.0 unx      487 b- defN 23-Jul-05 10:03 kvirt/cluster/kubeadm/apps/argocd/ingress.yml
+-rw-r--r--  2.0 unx     2134 b- defN 23-Jul-05 10:03 kvirt/cluster/kubeadm/apps/argocd/install.sh
+-rw-r--r--  2.0 unx       71 b- defN 23-Jul-05 10:03 kvirt/cluster/kubeadm/apps/argocd/kcli_default.yml
+-rw-r--r--  2.0 unx      314 b- defN 23-Jul-05 10:03 kvirt/cluster/kubeadm/apps/argocd/uninstall.sh
+-rw-r--r--  2.0 unx       90 b- defN 23-Jul-05 10:03 kvirt/cluster/kubeadm/apps/autolabeller/install.sh
+-rw-r--r--  2.0 unx       91 b- defN 23-Jul-05 10:03 kvirt/cluster/kubeadm/apps/autolabeller/uninstall.sh
+-rw-r--r--  2.0 unx      380 b- defN 23-Jul-05 10:03 kvirt/cluster/kubeadm/apps/certmanager/install.sh
+-rw-r--r--  2.0 unx      317 b- defN 23-Jul-05 10:03 kvirt/cluster/kubeadm/apps/dashboard/admin.yml
+-rw-r--r--  2.0 unx      452 b- defN 23-Jul-05 10:03 kvirt/cluster/kubeadm/apps/dashboard/ingress.yml
+-rw-r--r--  2.0 unx     1433 b- defN 23-Jul-05 10:03 kvirt/cluster/kubeadm/apps/dashboard/install.sh
+-rw-r--r--  2.0 unx       23 b- defN 23-Jul-05 10:03 kvirt/cluster/kubeadm/apps/dashboard/kcli_default.yml
+-rw-r--r--  2.0 unx      373 b- defN 23-Jul-05 10:03 kvirt/cluster/kubeadm/apps/dashboard/user.yml
+-rw-r--r--  2.0 unx      157 b- defN 23-Jul-05 10:03 kvirt/cluster/kubeadm/apps/falco/falco_advertisements.yml
+-rw-r--r--  2.0 unx      185 b- defN 23-Jul-05 10:03 kvirt/cluster/kubeadm/apps/falco/falco_ip.yml
+-rw-r--r--  2.0 unx      839 b- defN 23-Jul-05 10:03 kvirt/cluster/kubeadm/apps/falco/install.sh
+-rw-r--r--  2.0 unx       57 b- defN 23-Jul-05 10:03 kvirt/cluster/kubeadm/apps/falco/kcli_default.yml
+-rw-r--r--  2.0 unx      133 b- defN 23-Jul-05 10:03 kvirt/cluster/kubeadm/apps/falco/uninstall.sh
+-rw-r--r--  2.0 unx      175 b- defN 23-Jul-05 10:03 kvirt/cluster/kubeadm/apps/ingress/install.sh
+-rw-r--r--  2.0 unx      176 b- defN 23-Jul-05 10:03 kvirt/cluster/kubeadm/apps/ingress/uninstall.sh
+-rw-r--r--  2.0 unx      112 b- defN 23-Jul-05 10:03 kvirt/cluster/kubeadm/apps/istio/install.sh
+-rw-r--r--  2.0 unx      910 b- defN 23-Jul-05 10:03 kvirt/cluster/kubeadm/apps/istio/istio-minimal-operator.yaml
+-rw-r--r--  2.0 unx      766 b- defN 23-Jul-05 10:03 kvirt/cluster/kubeadm/apps/katacontainer/install.sh
+-rw-r--r--  2.0 unx      913 b- defN 23-Jul-05 10:03 kvirt/cluster/kubeadm/apps/katacontainer/uninstall.sh
+-rw-r--r--  2.0 unx      198 b- defN 23-Jul-05 10:03 kvirt/cluster/kubeadm/apps/knative/cr_eventing.yml
+-rw-r--r--  2.0 unx      194 b- defN 23-Jul-05 10:03 kvirt/cluster/kubeadm/apps/knative/cr_serving.yml
+-rw-r--r--  2.0 unx      253 b- defN 23-Jul-05 10:03 kvirt/cluster/kubeadm/apps/knative/install.sh
+-rw-r--r--  2.0 unx      670 b- defN 23-Jul-05 10:03 kvirt/cluster/kubeadm/apps/kubevirt/install.sh
+-rw-r--r--  2.0 unx       30 b- defN 23-Jul-05 10:03 kvirt/cluster/kubeadm/apps/kubevirt/kcli_default.yml
+-rw-r--r--  2.0 unx      534 b- defN 23-Jul-05 10:03 kvirt/cluster/kubeadm/apps/metallb/install.sh
+-rw-r--r--  2.0 unx       47 b- defN 23-Jul-05 10:03 kvirt/cluster/kubeadm/apps/metallb/kcli_default.yml
+-rw-r--r--  2.0 unx      157 b- defN 23-Jul-05 10:03 kvirt/cluster/kubeadm/apps/metallb/metallb_advertisements.yml
+-rw-r--r--  2.0 unx      150 b- defN 23-Jul-05 10:03 kvirt/cluster/kubeadm/apps/metallb/metallb_cr.yml
+-rw-r--r--  2.0 unx      283 b- defN 23-Jul-05 10:03 kvirt/cluster/kubeadm/apps/metallb/uninstall.sh
+-rw-r--r--  2.0 unx      348 b- defN 23-Jul-05 10:03 kvirt/cluster/kubeadm/apps/olm/install.sh
+-rw-r--r--  2.0 unx      350 b- defN 23-Jul-05 10:03 kvirt/cluster/kubeadm/apps/olm/uninstall.sh
+-rw-r--r--  2.0 unx      320 b- defN 23-Jul-05 10:03 kvirt/cluster/kubeadm/apps/policy_as_code/install.sh
+-rw-r--r--  2.0 unx       34 b- defN 23-Jul-05 10:03 kvirt/cluster/kubeadm/apps/policy_as_code/kcli_default.yml
+-rw-r--r--  2.0 unx      322 b- defN 23-Jul-05 10:03 kvirt/cluster/kubeadm/apps/policy_as_code/uninstall.sh
+-rw-r--r--  2.0 unx     1662 b- defN 23-Jul-05 10:03 kvirt/cluster/kubeadm/apps/rancher/install.sh
+-rw-r--r--  2.0 unx      103 b- defN 23-Jul-05 10:03 kvirt/cluster/kubeadm/apps/rancher/kcli_default.yml
+-rw-r--r--  2.0 unx      161 b- defN 23-Jul-05 10:03 kvirt/cluster/kubeadm/apps/rancher/rancher_advertisements.yml
+-rw-r--r--  2.0 unx      191 b- defN 23-Jul-05 10:03 kvirt/cluster/kubeadm/apps/rancher/rancher_ip.yml
+-rw-r--r--  2.0 unx      151 b- defN 23-Jul-05 10:03 kvirt/cluster/kubeadm/apps/rancher/uninstall.sh
+-rw-r--r--  2.0 unx      572 b- defN 23-Jul-05 10:03 kvirt/cluster/kubeadm/apps/rook/install.sh
+-rw-r--r--  2.0 unx      190 b- defN 23-Jul-05 10:03 kvirt/cluster/kubeadm/apps/submariner/install.sh
+-rw-r--r--  2.0 unx       22 b- defN 23-Jul-05 10:03 kvirt/cluster/kubeadm/apps/submariner/kcli_default.yml
+-rw-r--r--  2.0 unx      277 b- defN 23-Jul-05 10:03 kvirt/cluster/kubeadm/apps/tekton/install.sh
+-rw-r--r--  2.0 unx      278 b- defN 23-Jul-05 10:03 kvirt/cluster/kubeadm/apps/tekton/uninstall.sh
+-rw-r--r--  2.0 unx     2970 b- defN 23-Jul-05 10:03 kvirt/cluster/kubecommon/__init__.py
+-rw-r--r--  2.0 unx     9395 b- defN 23-Jul-05 10:03 kvirt/cluster/kubernetes/__init__.py
+-rw-r--r--  2.0 unx     4782 b- defN 23-Jul-05 10:03 kvirt/cluster/microshift/__init__.py
+-rw-r--r--  2.0 unx      603 b- defN 23-Jul-05 10:03 kvirt/cluster/microshift/kcli_plan.yml
+-rw-r--r--  2.0 unx      625 b- defN 23-Jul-05 10:03 kvirt/cluster/microshift/kcli_plan_default.yml
+-rw-r--r--  2.0 unx      262 b- defN 23-Jul-05 10:03 kvirt/cluster/microshift/scripts/00_sslip.sh
+-rw-r--r--  2.0 unx      799 b- defN 23-Jul-05 10:03 kvirt/cluster/microshift/scripts/01_clients.sh
+-rw-r--r--  2.0 unx      183 b- defN 23-Jul-05 10:03 kvirt/cluster/microshift/scripts/02_crio.sh
+-rw-r--r--  2.0 unx      538 b- defN 23-Jul-05 10:03 kvirt/cluster/microshift/scripts/03_microshift.sh
+-rw-r--r--  2.0 unx      341 b- defN 23-Jul-05 10:03 kvirt/cluster/microshift/scripts/04_kubeconfig.sh
+-rw-r--r--  2.0 unx     2252 b- defN 23-Jul-05 10:03 kvirt/cluster/microshift/scripts/05_acm.sh
+-rw-r--r--  2.0 unx      696 b- defN 23-Jul-05 10:03 kvirt/cluster/microshift/scripts/deploy.sh
+-rw-r--r--  2.0 unx      219 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/01-workload-partitioning
+-rw-r--r--  2.0 unx      573 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/10-node-ip-hint.yaml
+-rw-r--r--  2.0 unx      980 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/99-apps.yaml
+-rw-r--r--  2.0 unx      618 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/99-bootstrap-deletion-2.yaml
+-rw-r--r--  2.0 unx     1239 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/99-bootstrap-deletion.yaml
+-rw-r--r--  2.0 unx      529 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/99-chrony.yaml
+-rw-r--r--  2.0 unx      646 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/99-forcedns
+-rw-r--r--  2.0 unx      476 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/99-forcedns-ibm
+-rw-r--r--  2.0 unx      854 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/99-kubevirt-fix.yaml
+-rw-r--r--  2.0 unx     1127 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/99-localhost-fix.yaml
+-rw-r--r--  2.0 unx      250 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/99-metal3-fake-machine.yaml
+-rw-r--r--  2.0 unx      162 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/99-metal3-provisioning.yaml
+-rw-r--r--  2.0 unx     1659 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/99-notifications.yaml
+-rw-r--r--  2.0 unx      118 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/99-operatorhub.yaml
+-rw-r--r--  2.0 unx      314 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/99-ovn.yaml
+-rw-r--r--  2.0 unx      912 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/99-sno.yaml
+-rw-r--r--  2.0 unx      762 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/Corefile
+-rw-r--r--  2.0 unx    90139 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/__init__.py
+-rw-r--r--  2.0 unx     1325 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/autoapprovercron.yml
+-rw-r--r--  2.0 unx      987 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/autorules.yml
+-rw-r--r--  2.0 unx     1630 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/bootstrap.yml
+-rw-r--r--  2.0 unx      250 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/calico.sh.j2
+-rw-r--r--  2.0 unx      107 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/chrony.conf
+-rw-r--r--  2.0 unx      629 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/cloud_bootstrap.yml
+-rw-r--r--  2.0 unx      792 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/cloud_ctlplanes.yml
+-rw-r--r--  2.0 unx      217 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/cloud_dns.yml
+-rw-r--r--  2.0 unx      616 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/cloud_lb_api.yml
+-rw-r--r--  2.0 unx      224 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/cloud_lb_apps.yml
+-rw-r--r--  2.0 unx      703 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/cloud_workers.yml
+-rw-r--r--  2.0 unx      123 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/cluster-ingress-02-config.yml
+-rw-r--r--  2.0 unx      159 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/cluster-scheduler-02-config.yml
+-rw-r--r--  2.0 unx      224 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/config.hcl.templ
+-rw-r--r--  2.0 unx       98 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/contrail-ca-patch.service
+-rw-r--r--  2.0 unx      486 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/contrail-ca-patch.sh
+-rw-r--r--  2.0 unx       87 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/contrail.auth
+-rw-r--r--  2.0 unx     1108 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/contrail.sh.j2
+-rw-r--r--  2.0 unx     2278 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/ctlplanes.yml
+-rw-r--r--  2.0 unx      326 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/dhcp.conf
+-rw-r--r--  2.0 unx      106 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/dhcp.sh
+-rw-r--r--  2.0 unx      536 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/dhcp.yml
+-rw-r--r--  2.0 unx      836 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/disconnected.yml
+-rw-r--r--  2.0 unx     8945 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/fake_kubeconfig.json
+-rw-r--r--  2.0 unx       35 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/fake_pull.json
+-rw-r--r--  2.0 unx     1792 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/haproxy.cfg
+-rw-r--r--  2.0 unx     2483 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/haproxy.cfg.kubevirt
+-rw-r--r--  2.0 unx      902 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/httpd.yaml
+-rw-r--r--  2.0 unx      524 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/ignition.j2
+-rw-r--r--  2.0 unx     4088 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/install-config.yaml
+-rw-r--r--  2.0 unx     2691 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/iso.sh
+-rw-r--r--  2.0 unx      237 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/kcli-ipv6.conf.j2
+-rw-r--r--  2.0 unx     4489 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/kcli_default.yml
+-rw-r--r--  2.0 unx      982 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/keepalived.conf
+-rw-r--r--  2.0 unx       60 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/nonlocalbind.conf
+-rw-r--r--  2.0 unx       59 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/openshift-workload-pinning
+-rw-r--r--  2.0 unx      157 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/relocate-ip-bootstrap.service
+-rw-r--r--  2.0 unx      281 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/relocate-ip-bootstrap.sh
+-rw-r--r--  2.0 unx      690 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/relocate-ip.sh
+-rw-r--r--  2.0 unx      212 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/sno-finish.service
+-rw-r--r--  2.0 unx     2085 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/sno-finish.sh
+-rw-r--r--  2.0 unx      660 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/sno.yml
+-rw-r--r--  2.0 unx     1615 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/workers.yml
+-rw-r--r--  2.0 unx       40 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/apps/cr.sh
+-rw-r--r--  2.0 unx      768 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/apps/install.yml.j2
+-rw-r--r--  2.0 unx      162 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/apps/advanced-cluster-management/99-metal3-provisioning.yaml
+-rw-r--r--  2.0 unx     2913 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/apps/advanced-cluster-management/assisted-service.sample.yml
+-rwxr-xr-x  2.0 unx     2838 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/apps/advanced-cluster-management/assisted-service.sh
+-rw-r--r--  2.0 unx      418 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/apps/advanced-cluster-management/cr.yml
+-rw-r--r--  2.0 unx      625 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/apps/advanced-cluster-management/gen_registries.py
+-rw-r--r--  2.0 unx      290 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/apps/advanced-cluster-management/kcli_default.yml
+-rw-r--r--  2.0 unx     1219 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/apps/advanced-cluster-management/post.sh
+-rw-r--r--  2.0 unx      645 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/apps/argocd/configmap.yml
+-rw-r--r--  2.0 unx     2423 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/apps/argocd/install.sh
+-rw-r--r--  2.0 unx       49 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/apps/argocd/kcli_default.yml
+-rw-r--r--  2.0 unx     1093 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/apps/autolabeller/cr.yml
+-rw-r--r--  2.0 unx      142 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/apps/autolabeller/install.sh
+-rw-r--r--  2.0 unx     1093 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/apps/autolabeller/install.yml
+-rw-r--r--  2.0 unx      165 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/apps/autolabeller/kcli_default.yml
+-rw-r--r--  2.0 unx       25 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/apps/autolabeller/uninstall.sh
+-rw-r--r--  2.0 unx      873 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/apps/cluster-logging/cr.yml
+-rw-r--r--  2.0 unx       63 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/apps/cluster-logging/kcli_default.yml
+-rw-r--r--  2.0 unx      265 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/apps/istio/install.sh
+-rw-r--r--  2.0 unx      377 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/apps/istio/istio-cni.yaml
+-rw-r--r--  2.0 unx     1039 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/apps/kubevirt-hyperconverged/cr.yml
+-rw-r--r--  2.0 unx      154 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/apps/kubevirt-hyperconverged/kcli_default.yml
+-rw-r--r--  2.0 unx      775 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/apps/local-storage-operator/cr.yml
+-rw-r--r--  2.0 unx      227 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/apps/local-storage-operator/kcli_default.yml
+-rw-r--r--  2.0 unx      642 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/apps/local-storage-operator/post.sh
+-rw-r--r--  2.0 unx      349 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/apps/lvms-operator/cr.yml
+-rw-r--r--  2.0 unx      137 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/apps/lvms-operator/kcli_default.yml
+-rw-r--r--  2.0 unx      595 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/apps/lvms-operator/post.sh
+-rw-r--r--  2.0 unx      510 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/apps/metallb-operator/cr.yml
+-rw-r--r--  2.0 unx       94 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/apps/metallb-operator/kcli_default.yml
+-rw-r--r--  2.0 unx      162 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/apps/multicluster-engine/99-metal3-provisioning.yaml
+-rw-r--r--  2.0 unx     2913 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/apps/multicluster-engine/assisted-service.sample.yml
+-rwxr-xr-x  2.0 unx     2845 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/apps/multicluster-engine/assisted-service.sh
+-rw-r--r--  2.0 unx      245 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/apps/multicluster-engine/cr.yml
+-rw-r--r--  2.0 unx      625 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/apps/multicluster-engine/gen_registries.py
+-rw-r--r--  2.0 unx      149 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/apps/multicluster-engine/kcli_default.yml
+-rwxr-xr-x  2.0 unx       55 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/apps/multicluster-engine/post.sh
+-rwxr-xr-x  2.0 unx     2298 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/apps/nfs/install.sh
+-rw-r--r--  2.0 unx      117 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/apps/nfs/kcli_default.yml
+-rw-r--r--  2.0 unx      185 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/apps/nfs/uninstall.sh
+-rw-r--r--  2.0 unx      849 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/apps/odf-operator/cr.yml
+-rw-r--r--  2.0 unx      298 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/apps/odf-operator/kcli_default.yml
+-rw-r--r--  2.0 unx      364 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/apps/odf-operator/nad_cluster.yml
+-rw-r--r--  2.0 unx      362 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/apps/odf-operator/nad_public.yml
+-rw-r--r--  2.0 unx      745 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/apps/odf-operator/post.sh
+-rw-r--r--  2.0 unx      530 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/apps/odf-operator/pre.sh
+-rw-r--r--  2.0 unx      363 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/apps/serverless-operator/cr.yml
+-rw-r--r--  2.0 unx      157 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/apps/serverless-operator/kcli_default.yml
+-rw-r--r--  2.0 unx      278 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/apps/serverless-operator/post.sh
+-rw-r--r--  2.0 unx     1227 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/apps/users/install.sh
+-rw-r--r--  2.0 unx       84 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/apps/users/kcli_default.yml
+-rw-r--r--  2.0 unx      258 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/apps/users/oauth.yml
+-rw-r--r--  2.0 unx      249 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/apps/users/oauth_hypershift.yml
+-rw-r--r--  2.0 unx      422 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/apps/users/uninstall.sh
+-rw-r--r--  2.0 unx       60 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/customisation/00-kcli-namespace.yaml
+-rw-r--r--  2.0 unx       91 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/customisation/97-autoapprovercron-sa.yaml
+-rw-r--r--  2.0 unx      264 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/customisation/98-autoapprovercron-binding.yaml
+-rw-r--r--  2.0 unx      911 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/customisation/99-autoapprovercron-cronjob.yaml
+-rw-r--r--  2.0 unx      389 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/customisation/99-ingress-controller.yaml
+-rw-r--r--  2.0 unx      184 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/customisation/99-monitoring.yaml
+-rw-r--r--  2.0 unx      289 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/customisation/99-registry.yaml
+-rw-r--r--  2.0 unx     1685 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/disconnected/haproxy.cfg
+-rw-r--r--  2.0 unx      211 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/disconnected/registry.service
+-rwxr-xr-x  2.0 unx      328 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/disconnected/bin/sync_image.sh
+-rwxr-xr-x  2.0 unx      201 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/disconnected/scripts/01_get_oc.sh
+-rwxr-xr-x  2.0 unx     2381 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/disconnected/scripts/03_mirror.sh
+-rwxr-xr-x  2.0 unx     2046 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/disconnected/scripts/03_registry.sh
+-rwxr-xr-x  2.0 unx      337 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/disconnected/scripts/04_extras.sh
+-rwxr-xr-x  2.0 unx     2319 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/disconnected/scripts/05_olm.sh
+-rwxr-xr-x  2.0 unx      241 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/disconnected/scripts/06_web.sh
+-rwxr-xr-x  2.0 unx      733 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/disconnected/scripts/deploy.sh
+-rw-r--r--  2.0 unx     4223 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/disconnected/scripts/mirror-config.yaml.sample
+-rw-r--r--  2.0 unx     2557 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/staticpods/coredns.yml
+-rw-r--r--  2.0 unx      987 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/staticpods/haproxy.yml
+-rw-r--r--  2.0 unx     2539 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/staticpods/keepalived.yml
+-rw-r--r--  2.0 unx     1721 b- defN 23-Jul-05 10:03 kvirt/cluster/openshift/staticpods/mdns.yml
+-rw-r--r--  2.0 unx      193 b- defN 23-Jul-05 10:03 kvirt/cluster/profiles/sample-kubeadm-default.yml
+-rw-r--r--  2.0 unx      135 b- defN 23-Jul-05 10:03 kvirt/cluster/profiles/sample-openshift-compact.yml
+-rw-r--r--  2.0 unx      210 b- defN 23-Jul-05 10:03 kvirt/cluster/profiles/sample-openshift-contrail.yml
+-rw-r--r--  2.0 unx      157 b- defN 23-Jul-05 10:03 kvirt/cluster/profiles/sample-openshift-ipv6.yml
+-rw-r--r--  2.0 unx       55 b- defN 23-Jul-05 10:03 kvirt/cluster/profiles/sample-openshift-sno-bm.yml
+-rw-r--r--  2.0 unx      148 b- defN 23-Jul-05 10:03 kvirt/cluster/profiles/sample-openshift-sno.yml
+-rw-r--r--  2.0 unx     3377 b- defN 23-Jul-05 10:03 kvirt/common/Jenkinsfile.j2
+-rw-r--r--  2.0 unx    98898 b- defN 23-Jul-05 10:03 kvirt/common/__init__.py
+-rw-r--r--  2.0 unx     1406 b- defN 23-Jul-05 10:03 kvirt/common/autoscale.yaml.j2
+-rw-r--r--  2.0 unx     8945 b- defN 23-Jul-05 10:03 kvirt/common/fake_kubeconfig.json
+-rw-r--r--  2.0 unx      669 b- defN 23-Jul-05 10:03 kvirt/common/ignition.j2
+-rw-r--r--  2.0 unx      125 b- defN 23-Jul-05 10:03 kvirt/common/kubevirt_kcli_conf.j2
+-rw-r--r--  2.0 unx       99 b- defN 23-Jul-05 10:03 kvirt/common/local_kcli_conf.j2
+-rw-r--r--  2.0 unx     3068 b- defN 23-Jul-05 10:03 kvirt/common/pipeline.yml.j2
+-rw-r--r--  2.0 unx     2377 b- defN 23-Jul-05 10:03 kvirt/common/pipeline_kube.yml.j2
+-rw-r--r--  2.0 unx     1381 b- defN 23-Jul-05 10:03 kvirt/common/playbook.j2
+-rw-r--r--  2.0 unx      833 b- defN 23-Jul-05 10:03 kvirt/common/storage.sh.aws
+-rw-r--r--  2.0 unx      635 b- defN 23-Jul-05 10:03 kvirt/common/storage.sh.gcp
+-rw-r--r--  2.0 unx       68 b- defN 23-Jul-05 10:03 kvirt/common/storage.sh.ibmcloud
+-rw-r--r--  2.0 unx     4562 b- defN 23-Jul-05 10:03 kvirt/common/vm.ovf.j2
+-rw-r--r--  2.0 unx     2241 b- defN 23-Jul-05 10:03 kvirt/common/workflow.yml.j2
+-rw-r--r--  2.0 unx     2208 b- defN 23-Jul-05 10:03 kvirt/common/workflow_script.yml.j2
+-rw-r--r--  2.0 unx    15041 b- defN 23-Jul-05 10:03 kvirt/container/__init__.py
+-rw-r--r--  2.0 unx    11716 b- defN 23-Jul-05 10:03 kvirt/expose/__init__.py
+-rw-r--r--  2.0 unx     4319 b- defN 23-Jul-05 10:03 kvirt/expose/swagger.yml
+-rw-r--r--  2.0 unx      408 b- defN 23-Jul-05 10:03 kvirt/expose/static/css/bootstrap-notify.css
+-rw-r--r--  2.0 unx   121125 b- defN 23-Jul-05 10:03 kvirt/expose/static/css/bootstrap.min.css
+-rw-r--r--  2.0 unx      399 b- defN 23-Jul-05 10:03 kvirt/expose/static/css/dataTables.checkboxes.css
+-rw-r--r--  2.0 unx    13587 b- defN 23-Jul-05 10:03 kvirt/expose/static/css/jquery.dataTables.min.css
+-rw-r--r--  2.0 unx      868 b- defN 23-Jul-05 10:03 kvirt/expose/static/css/kcli.css
+-rw-r--r--  2.0 unx      269 b- defN 23-Jul-05 10:03 kvirt/expose/static/css/wheel.css
+-rw-r--r--  2.0 unx     1406 b- defN 23-Jul-05 10:03 kvirt/expose/static/images/favicon.ico
+-rw-r--r--  2.0 unx      160 b- defN 23-Jul-05 10:03 kvirt/expose/static/images/sort_asc.png
+-rw-r--r--  2.0 unx      201 b- defN 23-Jul-05 10:03 kvirt/expose/static/images/sort_both.png
+-rw-r--r--  2.0 unx      158 b- defN 23-Jul-05 10:03 kvirt/expose/static/images/sort_desc.png
+-rw-r--r--  2.0 unx    24772 b- defN 23-Jul-05 10:03 kvirt/expose/static/images/wheel.gif
+-rw-r--r--  2.0 unx    12398 b- defN 23-Jul-05 10:03 kvirt/expose/static/js/dataTables.checkboxes.min.js
+-rw-r--r--  2.0 unx      367 b- defN 23-Jul-05 10:03 kvirt/expose/static/js/exposeactions.js
+-rw-r--r--  2.0 unx    83059 b- defN 23-Jul-05 10:03 kvirt/expose/static/js/jquery.dataTables.min.js
+-rw-r--r--  2.0 unx    89795 b- defN 23-Jul-05 10:03 kvirt/expose/static/js/jquery.min.js
+-rw-r--r--  2.0 unx      263 b- defN 23-Jul-05 10:03 kvirt/expose/static/js/list.js
+-rw-r--r--  2.0 unx     1605 b- defN 23-Jul-05 10:03 kvirt/expose/templates/form.html
+-rw-r--r--  2.0 unx     1035 b- defN 23-Jul-05 10:03 kvirt/expose/templates/head.html
+-rw-r--r--  2.0 unx      406 b- defN 23-Jul-05 10:03 kvirt/expose/templates/index.html
+-rw-r--r--  2.0 unx     1220 b- defN 23-Jul-05 10:03 kvirt/expose/templates/infoplan.html
+-rw-r--r--  2.0 unx      574 b- defN 23-Jul-05 10:03 kvirt/expose/templates/planstable.html
+-rw-r--r--  2.0 unx      550 b- defN 23-Jul-05 10:03 kvirt/expose/templates/result.html
+-rw-r--r--  2.0 unx     1754 b- defN 23-Jul-05 10:03 kvirt/internalplans/__init__.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Jul-05 10:03 kvirt/jinjafilters/__init__.py
+-rw-r--r--  2.0 unx     5351 b- defN 23-Jul-05 10:03 kvirt/jinjafilters/jinjafilters.py
+-rw-r--r--  2.0 unx     9013 b- defN 23-Jul-05 10:03 kvirt/kfish/__init__.py
+-rw-r--r--  2.0 unx    10455 b- defN 23-Jul-05 10:03 kvirt/ksushy/__init__.py
+-rw-r--r--  2.0 unx      121 b- defN 23-Jul-05 10:03 kvirt/ksushy/main.py
+-rw-r--r--  2.0 unx     1028 b- defN 23-Jul-05 10:03 kvirt/ksushy/templates/bios.json
+-rw-r--r--  2.0 unx      443 b- defN 23-Jul-05 10:03 kvirt/ksushy/templates/interface.json
+-rw-r--r--  2.0 unx      418 b- defN 23-Jul-05 10:03 kvirt/ksushy/templates/interfaces.json
+-rw-r--r--  2.0 unx     1050 b- defN 23-Jul-05 10:03 kvirt/ksushy/templates/manager.json
+-rw-r--r--  2.0 unx      571 b- defN 23-Jul-05 10:03 kvirt/ksushy/templates/managers.json
+-rw-r--r--  2.0 unx      554 b- defN 23-Jul-05 10:03 kvirt/ksushy/templates/root.json
+-rw-r--r--  2.0 unx     2760 b- defN 23-Jul-05 10:03 kvirt/ksushy/templates/system.json
+-rw-r--r--  2.0 unx      511 b- defN 23-Jul-05 10:03 kvirt/ksushy/templates/systems.json
+-rw-r--r--  2.0 unx     1219 b- defN 23-Jul-05 10:03 kvirt/ksushy/templates/virtualmedia_cd.json
+-rw-r--r--  2.0 unx      705 b- defN 23-Jul-05 10:03 kvirt/ksushy/templates/virtualmedias.json
+-rw-r--r--  2.0 unx     2780 b- defN 23-Jul-05 10:03 kvirt/miniconsole/__init__.py
+-rw-r--r--  2.0 unx     3733 b- defN 23-Jul-05 10:03 kvirt/nameutils/__init__.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Jul-05 10:03 kvirt/providers/__init__.py
+-rw-r--r--  2.0 unx     9038 b- defN 23-Jul-05 10:03 kvirt/providers/sampleprovider.py
+-rw-r--r--  2.0 unx    71311 b- defN 23-Jul-05 10:03 kvirt/providers/aws/__init__.py
+-rw-r--r--  2.0 unx      260 b- defN 23-Jul-05 10:03 kvirt/providers/aws/assume_policy.json
+-rw-r--r--  2.0 unx     1764 b- defN 23-Jul-05 10:03 kvirt/providers/aws/ctlplane_policy.json
+-rw-r--r--  2.0 unx      174 b- defN 23-Jul-05 10:03 kvirt/providers/aws/worker_policy.json
+-rw-r--r--  2.0 unx      479 b- defN 23-Jul-05 10:03 kvirt/providers/fake/__init__.py
+-rw-r--r--  2.0 unx    75004 b- defN 23-Jul-05 10:03 kvirt/providers/gcp/__init__.py
+-rw-r--r--  2.0 unx      175 b- defN 23-Jul-05 10:03 kvirt/providers/gcp/gcp-hack.service
+-rw-r--r--  2.0 unx      231 b- defN 23-Jul-05 10:03 kvirt/providers/gcp/gcp-hack.sh
+-rw-r--r--  2.0 unx    65166 b- defN 23-Jul-05 10:03 kvirt/providers/ibm/__init__.py
+-rw-r--r--  2.0 unx    81078 b- defN 23-Jul-05 10:03 kvirt/providers/kubevirt/__init__.py
+-rw-r--r--  2.0 unx   186182 b- defN 23-Jul-05 10:03 kvirt/providers/kvm/__init__.py
+-rw-r--r--  2.0 unx     1965 b- defN 23-Jul-05 10:03 kvirt/providers/kvm/helpers.py
+-rw-r--r--  2.0 unx    57194 b- defN 23-Jul-05 10:03 kvirt/providers/openstack/__init__.py
+-rw-r--r--  2.0 unx    62662 b- defN 23-Jul-05 10:03 kvirt/providers/ovirt/__init__.py
+-rw-r--r--  2.0 unx    31230 b- defN 23-Jul-05 10:03 kvirt/providers/packet/__init__.py
+-rw-r--r--  2.0 unx    29262 b- defN 23-Jul-05 10:03 kvirt/providers/proxmox/__init__.py
+-rw-r--r--  2.0 unx    73215 b- defN 23-Jul-05 10:03 kvirt/providers/vsphere/__init__.py
+-rw-r--r--  2.0 unx    13655 b- defN 23-Jul-05 10:03 kvirt/providers/vsphere/helpers.py
+-rw-r--r--  2.0 unx     4893 b- defN 23-Jul-05 10:03 kvirt/providers/vsphere/tagging.py
+-rw-r--r--  2.0 unx    21420 b- defN 23-Jul-05 10:03 kvirt/providers/web/__init__.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Jul-05 10:03 kvirt/version/__init__.py
+-rw-r--r--  2.0 unx       19 b- defN 23-Jul-05 10:11 kvirt/version/git
+-rw-r--r--  2.0 unx    46652 b- defN 23-Jul-05 10:03 kvirt/web/__init__.py
+-rw-r--r--  2.0 unx      261 b- defN 23-Jul-05 10:03 kvirt/web/main.py
+-rw-r--r--  2.0 unx      408 b- defN 23-Jul-05 10:03 kvirt/web/static/css/bootstrap-notify.css
+-rw-r--r--  2.0 unx    23409 b- defN 23-Jul-05 10:03 kvirt/web/static/css/bootstrap-theme.min.css
+-rw-r--r--  2.0 unx   121125 b- defN 23-Jul-05 10:03 kvirt/web/static/css/bootstrap.min.css
+-rw-r--r--  2.0 unx      399 b- defN 23-Jul-05 10:03 kvirt/web/static/css/dataTables.checkboxes.css
+-rw-r--r--  2.0 unx    13587 b- defN 23-Jul-05 10:03 kvirt/web/static/css/jquery.dataTables.min.css
+-rw-r--r--  2.0 unx      816 b- defN 23-Jul-05 10:03 kvirt/web/static/css/kcli.css
+-rw-r--r--  2.0 unx     3033 b- defN 23-Jul-05 10:03 kvirt/web/static/css/navbar.css
+-rw-r--r--  2.0 unx     2908 b- defN 23-Jul-05 10:03 kvirt/web/static/css/spice.css
+-rw-r--r--  2.0 unx      271 b- defN 23-Jul-05 10:03 kvirt/web/static/css/wheel.css
+-rw-r--r--  2.0 unx    18028 b- defN 23-Jul-05 10:03 kvirt/web/static/fonts/glyphicons-halflings-regular.woff2
+-rw-r--r--  2.0 unx      715 b- defN 23-Jul-05 10:03 kvirt/web/static/images/Centos.png
+-rw-r--r--  2.0 unx      294 b- defN 23-Jul-05 10:03 kvirt/web/static/images/Debian.png
+-rw-r--r--  2.0 unx      987 b- defN 23-Jul-05 10:03 kvirt/web/static/images/Fedora.png
+-rw-r--r--  2.0 unx      672 b- defN 23-Jul-05 10:03 kvirt/web/static/images/Redhat.png
+-rw-r--r--  2.0 unx     1278 b- defN 23-Jul-05 10:03 kvirt/web/static/images/Suse.png
+-rw-r--r--  2.0 unx     1782 b- defN 23-Jul-05 10:03 kvirt/web/static/images/Tux.png
+-rw-r--r--  2.0 unx      544 b- defN 23-Jul-05 10:03 kvirt/web/static/images/Ubuntu.png
+-rw-r--r--  2.0 unx     4213 b- defN 23-Jul-05 10:03 kvirt/web/static/images/delete.png
+-rw-r--r--  2.0 unx     1406 b- defN 23-Jul-05 10:03 kvirt/web/static/images/favicon.ico
+-rw-r--r--  2.0 unx    23320 b- defN 23-Jul-05 10:03 kvirt/web/static/images/kcli-small.png
+-rw-r--r--  2.0 unx    27185 b- defN 23-Jul-05 10:03 kvirt/web/static/images/kcli.jpg
+-rw-r--r--  2.0 unx   113928 b- defN 23-Jul-05 10:03 kvirt/web/static/images/kcli.png
+-rw-r--r--  2.0 unx    48809 b- defN 23-Jul-05 10:03 kvirt/web/static/images/logo-header.svg
+-rw-r--r--  2.0 unx    48809 b- defN 23-Jul-05 10:03 kvirt/web/static/images/logo-main.svg
+-rw-r--r--  2.0 unx      160 b- defN 23-Jul-05 10:03 kvirt/web/static/images/sort_asc.png
+-rw-r--r--  2.0 unx      201 b- defN 23-Jul-05 10:03 kvirt/web/static/images/sort_both.png
+-rw-r--r--  2.0 unx      158 b- defN 23-Jul-05 10:03 kvirt/web/static/images/sort_desc.png
+-rw-r--r--  2.0 unx     3927 b- defN 23-Jul-05 10:03 kvirt/web/static/images/start.png
+-rw-r--r--  2.0 unx     3631 b- defN 23-Jul-05 10:03 kvirt/web/static/images/stop.png
+-rw-r--r--  2.0 unx    24772 b- defN 23-Jul-05 10:03 kvirt/web/static/images/wheel.gif
+-rw-r--r--  2.0 unx     2933 b- defN 23-Jul-05 10:03 kvirt/web/static/js/bootstrap-notify.js
+-rw-r--r--  2.0 unx    37045 b- defN 23-Jul-05 10:03 kvirt/web/static/js/bootstrap.min.js
+-rw-r--r--  2.0 unx     2523 b- defN 23-Jul-05 10:03 kvirt/web/static/js/containeraction.js
+-rw-r--r--  2.0 unx    12398 b- defN 23-Jul-05 10:03 kvirt/web/static/js/dataTables.checkboxes.min.js
+-rw-r--r--  2.0 unx     1642 b- defN 23-Jul-05 10:03 kvirt/web/static/js/hostaction.js
+-rw-r--r--  2.0 unx     1187 b- defN 23-Jul-05 10:03 kvirt/web/static/js/imageaction.js
+-rw-r--r--  2.0 unx    83059 b- defN 23-Jul-05 10:03 kvirt/web/static/js/jquery.dataTables.min.js
+-rw-r--r--  2.0 unx    87462 b- defN 23-Jul-05 10:03 kvirt/web/static/js/jquery.min.js
+-rw-r--r--  2.0 unx     2704 b- defN 23-Jul-05 10:03 kvirt/web/static/js/kcli.js
+-rw-r--r--  2.0 unx     1594 b- defN 23-Jul-05 10:03 kvirt/web/static/js/kubeaction.js
+-rw-r--r--  2.0 unx     3907 b- defN 23-Jul-05 10:03 kvirt/web/static/js/list.js
+-rw-r--r--  2.0 unx     1376 b- defN 23-Jul-05 10:03 kvirt/web/static/js/networkaction.js
+-rw-r--r--  2.0 unx     2457 b- defN 23-Jul-05 10:03 kvirt/web/static/js/planaction.js
+-rw-r--r--  2.0 unx     1237 b- defN 23-Jul-05 10:03 kvirt/web/static/js/poolaction.js
+-rw-r--r--  2.0 unx      846 b- defN 23-Jul-05 10:03 kvirt/web/static/js/productaction.js
+-rw-r--r--  2.0 unx      270 b- defN 23-Jul-05 10:03 kvirt/web/static/js/refresh.js
+-rw-r--r--  2.0 unx     1835 b- defN 23-Jul-05 10:03 kvirt/web/static/js/repoaction.js
+-rw-r--r--  2.0 unx     3463 b- defN 23-Jul-05 10:03 kvirt/web/static/js/snapshotaction.js
+-rw-r--r--  2.0 unx     2745 b- defN 23-Jul-05 10:03 kvirt/web/static/js/vmaction.js
+-rw-r--r--  2.0 unx      123 b- defN 23-Jul-05 10:03 kvirt/web/static/js/wheel.js
+-rw-r--r--  2.0 unx     9944 b- defN 23-Jul-05 10:03 kvirt/web/static/js/spice/atKeynames.js
+-rw-r--r--  2.0 unx     2335 b- defN 23-Jul-05 10:03 kvirt/web/static/js/spice/bitmap.js
+-rw-r--r--  2.0 unx     4795 b- defN 23-Jul-05 10:03 kvirt/web/static/js/spice/cursor.js
+-rw-r--r--  2.0 unx    49214 b- defN 23-Jul-05 10:03 kvirt/web/static/js/spice/display.js
+-rw-r--r--  2.0 unx    13253 b- defN 23-Jul-05 10:03 kvirt/web/static/js/spice/enums.js
+-rw-r--r--  2.0 unx     2847 b- defN 23-Jul-05 10:03 kvirt/web/static/js/spice/filexfer.js
+-rw-r--r--  2.0 unx     9535 b- defN 23-Jul-05 10:03 kvirt/web/static/js/spice/inputs.js
+-rw-r--r--  2.0 unx     6176 b- defN 23-Jul-05 10:03 kvirt/web/static/js/spice/lz.js
+-rw-r--r--  2.0 unx    18370 b- defN 23-Jul-05 10:03 kvirt/web/static/js/spice/main.js
+-rw-r--r--  2.0 unx    12677 b- defN 23-Jul-05 10:03 kvirt/web/static/js/spice/playback.js
+-rw-r--r--  2.0 unx     7036 b- defN 23-Jul-05 10:03 kvirt/web/static/js/spice/png.js
+-rw-r--r--  2.0 unx     3110 b- defN 23-Jul-05 10:03 kvirt/web/static/js/spice/port.js
+-rw-r--r--  2.0 unx    44531 b- defN 23-Jul-05 10:03 kvirt/web/static/js/spice/quic.js
+-rw-r--r--  2.0 unx     3030 b- defN 23-Jul-05 10:03 kvirt/web/static/js/spice/resize.js
+-rw-r--r--  2.0 unx     7282 b- defN 23-Jul-05 10:03 kvirt/web/static/js/spice/simulatecursor.js
+-rw-r--r--  2.0 unx     1895 b- defN 23-Jul-05 10:03 kvirt/web/static/js/spice/spicearraybuffer.js
+-rw-r--r--  2.0 unx    18202 b- defN 23-Jul-05 10:03 kvirt/web/static/js/spice/spiceconn.js
+-rw-r--r--  2.0 unx     3616 b- defN 23-Jul-05 10:03 kvirt/web/static/js/spice/spicedataview.js
+-rw-r--r--  2.0 unx    33015 b- defN 23-Jul-05 10:03 kvirt/web/static/js/spice/spicemsg.js
+-rw-r--r--  2.0 unx    12767 b- defN 23-Jul-05 10:03 kvirt/web/static/js/spice/spicetype.js
+-rw-r--r--  2.0 unx     6808 b- defN 23-Jul-05 10:03 kvirt/web/static/js/spice/ticket.js
+-rw-r--r--  2.0 unx    13628 b- defN 23-Jul-05 10:03 kvirt/web/static/js/spice/utils.js
+-rw-r--r--  2.0 unx    21577 b- defN 23-Jul-05 10:03 kvirt/web/static/js/spice/webm.js
+-rw-r--r--  2.0 unx     4131 b- defN 23-Jul-05 10:03 kvirt/web/static/js/spice/wire.js
+-rw-r--r--  2.0 unx    16580 b- defN 23-Jul-05 10:03 kvirt/web/static/js/spice/thirdparty/jsbn.js
+-rw-r--r--  2.0 unx     2529 b- defN 23-Jul-05 10:03 kvirt/web/static/js/spice/thirdparty/prng4.js
+-rw-r--r--  2.0 unx     3442 b- defN 23-Jul-05 10:03 kvirt/web/static/js/spice/thirdparty/rng.js
+-rw-r--r--  2.0 unx     4257 b- defN 23-Jul-05 10:03 kvirt/web/static/js/spice/thirdparty/rsa.js
+-rw-r--r--  2.0 unx    10671 b- defN 23-Jul-05 10:03 kvirt/web/static/js/spice/thirdparty/sha1.js
+-rw-r--r--  2.0 unx        0 b- defN 23-Jul-05 10:03 kvirt/web/static/js/spice/thirdparty/browser-es-module-loader/.npmignore
+-rw-r--r--  2.0 unx      419 b- defN 23-Jul-05 10:03 kvirt/web/static/js/spice/thirdparty/browser-es-module-loader/README.md
+-rw-r--r--  2.0 unx      359 b- defN 23-Jul-05 10:03 kvirt/web/static/js/spice/thirdparty/browser-es-module-loader/rollup.config.js
+-rw-r--r--  2.0 unx     1113 b- defN 23-Jul-05 10:03 kvirt/web/static/js/spice/thirdparty/browser-es-module-loader/src/babel-worker.js
+-rw-r--r--  2.0 unx     8601 b- defN 23-Jul-05 10:03 kvirt/web/static/js/spice/thirdparty/browser-es-module-loader/src/browser-es-module-loader.js
+-rw-r--r--  2.0 unx     2176 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/app/error-handler.js
+-rw-r--r--  2.0 unx     5682 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/app/localization.js
+-rw-r--r--  2.0 unx    56845 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/app/ui.js
+-rw-r--r--  2.0 unx     6696 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/app/webutil.js
+-rw-r--r--  2.0 unx     3553 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/app/images/alt.svg
+-rw-r--r--  2.0 unx     3980 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/app/images/clipboard.svg
+-rw-r--r--  2.0 unx     3430 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/app/images/connect.svg
+-rw-r--r--  2.0 unx     4381 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/app/images/ctrl.svg
+-rw-r--r--  2.0 unx     3237 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/app/images/ctrlaltdel.svg
+-rw-r--r--  2.0 unx     5062 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/app/images/disconnect.svg
+-rw-r--r--  2.0 unx     4684 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/app/images/drag.svg
+-rw-r--r--  2.0 unx     3106 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/app/images/error.svg
+-rw-r--r--  2.0 unx     4522 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/app/images/esc.svg
+-rw-r--r--  2.0 unx     3066 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/app/images/expander.svg
+-rw-r--r--  2.0 unx     3139 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/app/images/fullscreen.svg
+-rw-r--r--  2.0 unx     2559 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/app/images/handle.svg
+-rw-r--r--  2.0 unx     6386 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/app/images/handle_bg.svg
+-rw-r--r--  2.0 unx     3204 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/app/images/info.svg
+-rw-r--r--  2.0 unx     6404 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/app/images/keyboard.svg
+-rw-r--r--  2.0 unx     7000 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/app/images/mouse_left.svg
+-rw-r--r--  2.0 unx     7002 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/app/images/mouse_middle.svg
+-rw-r--r--  2.0 unx     6993 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/app/images/mouse_none.svg
+-rw-r--r--  2.0 unx     7001 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/app/images/mouse_right.svg
+-rw-r--r--  2.0 unx     3985 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/app/images/power.svg
+-rw-r--r--  2.0 unx     3082 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/app/images/settings.svg
+-rw-r--r--  2.0 unx     2953 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/app/images/tab.svg
+-rw-r--r--  2.0 unx     4441 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/app/images/toggleextrakeys.svg
+-rw-r--r--  2.0 unx     3869 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/app/images/warning.svg
+-rw-r--r--  2.0 unx     3178 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/app/images/windows.svg
+-rw-r--r--  2.0 unx      871 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/app/images/icons/Makefile
+-rw-r--r--  2.0 unx     4028 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/app/images/icons/novnc-120x120.png
+-rw-r--r--  2.0 unx     4582 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/app/images/icons/novnc-144x144.png
+-rw-r--r--  2.0 unx     5216 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/app/images/icons/novnc-152x152.png
+-rw-r--r--  2.0 unx      675 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/app/images/icons/novnc-16x16.png
+-rw-r--r--  2.0 unx     5787 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/app/images/icons/novnc-192x192.png
+-rw-r--r--  2.0 unx     1000 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/app/images/icons/novnc-24x24.png
+-rw-r--r--  2.0 unx     1064 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/app/images/icons/novnc-32x32.png
+-rw-r--r--  2.0 unx     1397 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/app/images/icons/novnc-48x48.png
+-rw-r--r--  2.0 unx     1932 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/app/images/icons/novnc-60x60.png
+-rw-r--r--  2.0 unx     1946 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/app/images/icons/novnc-64x64.png
+-rw-r--r--  2.0 unx     2699 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/app/images/icons/novnc-72x72.png
+-rw-r--r--  2.0 unx     2874 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/app/images/icons/novnc-76x76.png
+-rw-r--r--  2.0 unx     2351 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/app/images/icons/novnc-96x96.png
+-rw-r--r--  2.0 unx    11685 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/app/images/icons/novnc-icon-sm.svg
+-rw-r--r--  2.0 unx    11549 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/app/images/icons/novnc-icon.svg
+-rw-r--r--  2.0 unx     2885 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/app/locale/cs.json
+-rw-r--r--  2.0 unx     2854 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/app/locale/de.json
+-rw-r--r--  2.0 unx     3906 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/app/locale/el.json
+-rw-r--r--  2.0 unx     2671 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/app/locale/es.json
+-rw-r--r--  2.0 unx     3354 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/app/locale/ja.json
+-rw-r--r--  2.0 unx     2961 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/app/locale/ko.json
+-rw-r--r--  2.0 unx     3035 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/app/locale/nl.json
+-rw-r--r--  2.0 unx     2830 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/app/locale/pl.json
+-rw-r--r--  2.0 unx     3825 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/app/locale/ru.json
+-rw-r--r--  2.0 unx     2845 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/app/locale/sv.json
+-rw-r--r--  2.0 unx     2811 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/app/locale/tr.json
+-rw-r--r--  2.0 unx     2597 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/app/locale/zh_CN.json
+-rw-r--r--  2.0 unx     2606 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/app/locale/zh_TW.json
+-rw-r--r--  2.0 unx      157 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/app/sounds/CREDITS
+-rw-r--r--  2.0 unx     4531 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/app/sounds/bell.mp3
+-rw-r--r--  2.0 unx     8495 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/app/sounds/bell.oga
+-rw-r--r--  2.0 unx    38580 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/app/styles/Orbitron700.ttf
+-rw-r--r--  2.0 unx    17472 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/app/styles/Orbitron700.woff
+-rw-r--r--  2.0 unx    18450 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/app/styles/base.css
+-rw-r--r--  2.0 unx     4189 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/core/base64.js
+-rw-r--r--  2.0 unx    11241 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/core/des.js
+-rw-r--r--  2.0 unx    20381 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/core/display.js
+-rw-r--r--  2.0 unx     1374 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/core/encodings.js
+-rw-r--r--  2.0 unx     1170 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/core/inflator.js
+-rw-r--r--  2.0 unx    74196 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/core/rfb.js
+-rw-r--r--  2.0 unx     9130 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/core/websock.js
+-rw-r--r--  2.0 unx      628 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/core/decoders/copyrect.js
+-rw-r--r--  2.0 unx     4814 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/core/decoders/hextile.js
+-rw-r--r--  2.0 unx     1739 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/core/decoders/raw.js
+-rw-r--r--  2.0 unx     1210 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/core/decoders/rre.js
+-rw-r--r--  2.0 unx     9662 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/core/decoders/tight.js
+-rw-r--r--  2.0 unx      768 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/core/decoders/tightpng.js
+-rw-r--r--  2.0 unx    11438 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/core/input/domkeytable.js
+-rw-r--r--  2.0 unx     3804 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/core/input/fixedkeys.js
+-rw-r--r--  2.0 unx    13090 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/core/input/keyboard.js
+-rw-r--r--  2.0 unx    34609 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/core/input/keysym.js
+-rw-r--r--  2.0 unx    25374 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/core/input/keysymdef.js
+-rw-r--r--  2.0 unx     9995 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/core/input/mouse.js
+-rw-r--r--  2.0 unx     5283 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/core/input/util.js
+-rw-r--r--  2.0 unx     2580 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/core/input/vkeys.js
+-rw-r--r--  2.0 unx    14256 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/core/input/xtscancodes.js
+-rw-r--r--  2.0 unx     3155 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/core/util/browser.js
+-rw-r--r--  2.0 unx     7556 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/core/util/cursor.js
+-rw-r--r--  2.0 unx     4221 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/core/util/events.js
+-rw-r--r--  2.0 unx      896 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/core/util/eventtarget.js
+-rw-r--r--  2.0 unx     1358 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/core/util/logging.js
+-rw-r--r--  2.0 unx     1866 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/core/util/polyfill.js
+-rw-r--r--  2.0 unx      301 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/core/util/strings.js
+-rw-r--r--  2.0 unx     7388 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/vendor/promise.js
+-rw-r--r--  2.0 unx      419 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/vendor/browser-es-module-loader/README.md
+-rw-r--r--  2.0 unx      295 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/vendor/browser-es-module-loader/rollup.config.js
+-rw-r--r--  2.0 unx     1113 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/vendor/browser-es-module-loader/src/babel-worker.js
+-rw-r--r--  2.0 unx     8498 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/vendor/browser-es-module-loader/src/browser-es-module-loader.js
+-rw-r--r--  2.0 unx     1084 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/vendor/pako/LICENSE
+-rw-r--r--  2.0 unx      301 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/vendor/pako/README.md
+-rw-r--r--  2.0 unx     1062 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/vendor/pako/lib/utils/common.js
+-rw-r--r--  2.0 unx      666 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/vendor/pako/lib/zlib/adler32.js
+-rw-r--r--  2.0 unx     1334 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/vendor/pako/lib/zlib/constants.js
+-rw-r--r--  2.0 unx      764 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/vendor/pako/lib/zlib/crc32.js
+-rw-r--r--  2.0 unx    60016 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/vendor/pako/lib/zlib/deflate.js
+-rw-r--r--  2.0 unx     1251 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/vendor/pako/lib/zlib/gzheader.js
+-rw-r--r--  2.0 unx    11690 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/vendor/pako/lib/zlib/inffast.js
+-rw-r--r--  2.0 unx    47128 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/vendor/pako/lib/zlib/inflate.js
+-rw-r--r--  2.0 unx    11527 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/vendor/pako/lib/zlib/inftrees.js
+-rw-r--r--  2.0 unx      560 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/vendor/pako/lib/zlib/messages.js
+-rw-r--r--  2.0 unx    38767 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/vendor/pako/lib/zlib/trees.js
+-rw-r--r--  2.0 unx      823 b- defN 23-Jul-05 10:03 kvirt/web/static/vnc/vendor/pako/lib/zlib/zstream.js
+-rw-r--r--  2.0 unx     2509 b- defN 23-Jul-05 10:03 kvirt/web/templates/bootstrap.html
+-rw-r--r--  2.0 unx    14595 b- defN 23-Jul-05 10:03 kvirt/web/templates/console.html
+-rw-r--r--  2.0 unx      717 b- defN 23-Jul-05 10:03 kvirt/web/templates/containercreate.html
+-rw-r--r--  2.0 unx      493 b- defN 23-Jul-05 10:03 kvirt/web/templates/containerprofiles.html
+-rw-r--r--  2.0 unx     1050 b- defN 23-Jul-05 10:03 kvirt/web/templates/containerprofilestable.html
+-rw-r--r--  2.0 unx      490 b- defN 23-Jul-05 10:03 kvirt/web/templates/containers.html
+-rw-r--r--  2.0 unx     1746 b- defN 23-Jul-05 10:03 kvirt/web/templates/containerstable.html
+-rw-r--r--  2.0 unx     2123 b- defN 23-Jul-05 10:03 kvirt/web/templates/head.html
+-rw-r--r--  2.0 unx      473 b- defN 23-Jul-05 10:03 kvirt/web/templates/hosts.html
+-rw-r--r--  2.0 unx     1705 b- defN 23-Jul-05 10:03 kvirt/web/templates/hoststable.html
+-rw-r--r--  2.0 unx     1119 b- defN 23-Jul-05 10:03 kvirt/web/templates/imagecreate.html
+-rw-r--r--  2.0 unx      478 b- defN 23-Jul-05 10:03 kvirt/web/templates/images.html
+-rw-r--r--  2.0 unx      646 b- defN 23-Jul-05 10:03 kvirt/web/templates/imagestable.html
+-rw-r--r--  2.0 unx      472 b- defN 23-Jul-05 10:03 kvirt/web/templates/isos.html
+-rw-r--r--  2.0 unx      261 b- defN 23-Jul-05 10:03 kvirt/web/templates/isostable.html
+-rw-r--r--  2.0 unx      609 b- defN 23-Jul-05 10:03 kvirt/web/templates/kubecreate.html
+-rw-r--r--  2.0 unx      622 b- defN 23-Jul-05 10:03 kvirt/web/templates/kubeinfo.html
+-rw-r--r--  2.0 unx      488 b- defN 23-Jul-05 10:03 kvirt/web/templates/kubeprofiles.html
+-rw-r--r--  2.0 unx      845 b- defN 23-Jul-05 10:03 kvirt/web/templates/kubeprofilestable.html
+-rw-r--r--  2.0 unx      475 b- defN 23-Jul-05 10:03 kvirt/web/templates/kubes.html
+-rw-r--r--  2.0 unx     1850 b- defN 23-Jul-05 10:03 kvirt/web/templates/kubestable.html
+-rw-r--r--  2.0 unx      151 b- defN 23-Jul-05 10:03 kvirt/web/templates/layout.html
+-rw-r--r--  2.0 unx     5517 b- defN 23-Jul-05 10:03 kvirt/web/templates/navbar.html
+-rw-r--r--  2.0 unx      882 b- defN 23-Jul-05 10:03 kvirt/web/templates/networkcreate.html
+-rw-r--r--  2.0 unx      537 b- defN 23-Jul-05 10:03 kvirt/web/templates/networks.html
+-rw-r--r--  2.0 unx      845 b- defN 23-Jul-05 10:03 kvirt/web/templates/networkstable.html
+-rw-r--r--  2.0 unx      750 b- defN 23-Jul-05 10:03 kvirt/web/templates/plancreate.html
+-rw-r--r--  2.0 unx      475 b- defN 23-Jul-05 10:03 kvirt/web/templates/plans.html
+-rw-r--r--  2.0 unx     1525 b- defN 23-Jul-05 10:03 kvirt/web/templates/planstable.html
+-rw-r--r--  2.0 unx      859 b- defN 23-Jul-05 10:03 kvirt/web/templates/poolcreate.html
+-rw-r--r--  2.0 unx      475 b- defN 23-Jul-05 10:03 kvirt/web/templates/pools.html
+-rw-r--r--  2.0 unx      554 b- defN 23-Jul-05 10:03 kvirt/web/templates/poolstable.html
+-rw-r--r--  2.0 unx     1282 b- defN 23-Jul-05 10:03 kvirt/web/templates/productcreate.html
+-rw-r--r--  2.0 unx      484 b- defN 23-Jul-05 10:03 kvirt/web/templates/products.html
+-rw-r--r--  2.0 unx      895 b- defN 23-Jul-05 10:03 kvirt/web/templates/productstable.html
+-rw-r--r--  2.0 unx      699 b- defN 23-Jul-05 10:03 kvirt/web/templates/repocreate.html
+-rw-r--r--  2.0 unx      475 b- defN 23-Jul-05 10:03 kvirt/web/templates/repos.html
+-rw-r--r--  2.0 unx     1203 b- defN 23-Jul-05 10:03 kvirt/web/templates/repostable.html
+-rw-r--r--  2.0 unx      958 b- defN 23-Jul-05 10:03 kvirt/web/templates/vmcreate.html
+-rw-r--r--  2.0 unx      486 b- defN 23-Jul-05 10:03 kvirt/web/templates/vmprofiles.html
+-rw-r--r--  2.0 unx     1420 b- defN 23-Jul-05 10:03 kvirt/web/templates/vmprofilestable.html
+-rw-r--r--  2.0 unx      470 b- defN 23-Jul-05 10:03 kvirt/web/templates/vms.html
+-rw-r--r--  2.0 unx     4894 b- defN 23-Jul-05 10:03 kvirt/web/templates/vmstable.html
+-rw-r--r--  2.0 unx    11358 b- defN 23-Jul-05 10:11 kcli-99.0.202307051011.dist-info/LICENSE
+-rw-r--r--  2.0 unx     3118 b- defN 23-Jul-05 10:11 kcli-99.0.202307051011.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 23-Jul-05 10:11 kcli-99.0.202307051011.dist-info/WHEEL
+-rw-r--r--  2.0 unx      281 b- defN 23-Jul-05 10:11 kcli-99.0.202307051011.dist-info/entry_points.txt
+-rw-r--r--  2.0 unx        6 b- defN 23-Jul-05 10:11 kcli-99.0.202307051011.dist-info/top_level.txt
+?rw-rw-r--  2.0 unx    60010 b- defN 23-Jul-05 10:11 kcli-99.0.202307051011.dist-info/RECORD
+613 files, 4664568 bytes uncompressed, 1406206 bytes compressed:  69.9%
```

## zipnote {}

```diff
@@ -1815,26 +1815,26 @@
 
 Filename: kvirt/web/templates/vms.html
 Comment: 
 
 Filename: kvirt/web/templates/vmstable.html
 Comment: 
 
-Filename: kcli-99.0.202307050850.dist-info/LICENSE
+Filename: kcli-99.0.202307051011.dist-info/LICENSE
 Comment: 
 
-Filename: kcli-99.0.202307050850.dist-info/METADATA
+Filename: kcli-99.0.202307051011.dist-info/METADATA
 Comment: 
 
-Filename: kcli-99.0.202307050850.dist-info/WHEEL
+Filename: kcli-99.0.202307051011.dist-info/WHEEL
 Comment: 
 
-Filename: kcli-99.0.202307050850.dist-info/entry_points.txt
+Filename: kcli-99.0.202307051011.dist-info/entry_points.txt
 Comment: 
 
-Filename: kcli-99.0.202307050850.dist-info/top_level.txt
+Filename: kcli-99.0.202307051011.dist-info/top_level.txt
 Comment: 
 
-Filename: kcli-99.0.202307050850.dist-info/RECORD
+Filename: kcli-99.0.202307051011.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## kvirt/cli.py

```diff
@@ -10,15 +10,15 @@
 from kvirt.examples import repocreate, isocreate, networkupdate
 from kvirt.examples import kubegenericcreate, kubek3screate, kubeopenshiftcreate, kubemicroshiftcreate, kubegkecreate
 from kvirt.examples import dnscreate, diskcreate, diskdelete, vmcreate, vmconsole, vmexport, niccreate, nicdelete
 from kvirt.examples import disconnectedcreate, appopenshiftcreate, plantemplatecreate, kubehypershiftcreate
 from kvirt.examples import workflowcreate, kubegenericscale, kubek3sscale, kubeopenshiftscale, kubegkescale
 from kvirt.examples import changelog, starthosts, stophosts, infohosts, ocdownload, openshiftdownload, ocmirrordownload
 from kvirt.examples import kubeekscreate, kubeeksscale
-from kvirt.examples import networkcreate, securitygroupcreate, profilecreate, vmupdate, vmlist
+from kvirt.examples import networkcreate, securitygroupcreate, profilecreate, vmupdate, vmlist, providercreate
 from kvirt.baseconfig import Kbaseconfig
 from kvirt.containerconfig import Kcontainerconfig
 from kvirt.defaults import IMAGES, VERSION, LOCAL_OPENSHIFT_APPS, SSH_PUB_LOCATIONS, PLANTYPES
 from prettytable import PrettyTable
 import argcomplete
 import argparse
 from argparse import RawDescriptionHelpFormatter as rawhelp
@@ -3078,14 +3078,20 @@
         data['node'] = args.node
     common.create_host(data)
     baseconfig = Kbaseconfig(client=args.client, debug=args.debug, quiet=True)
     if len(baseconfig.clients) == 1:
         baseconfig.set_defaults()
 
 
+def install_provider(args):
+    """Install Provider"""
+    provider = args.subcommand_create_provider
+    common.install_provider(provider, pip=args.pip)
+
+
 def create_container(args):
     """Create container"""
     name = args.name
     image = args.image
     profile = args.profile
     overrides = handle_parameters(args.param, args.paramfile)
     config = Kconfig(client=args.client, debug=args.debug, region=args.region, zone=args.zone, namespace=args.namespace)
@@ -3470,15 +3476,16 @@
     changelog_parser = argparse.ArgumentParser(add_help=False)
     changelog_parser.add_argument('diff', metavar='DIFF', nargs=argparse.REMAINDER)
     changelog_parser.set_defaults(func=get_changelog)
     subparsers.add_parser('changelog', parents=[changelog_parser], description=changelog_desc, help=changelog_desc,
                           epilog=changelog_epilog, formatter_class=rawhelp)
 
     create_desc = 'Create Object'
-    create_parser = subparsers.add_parser('create', description=create_desc, help=create_desc, aliases=['add', 'run'])
+    create_parser = subparsers.add_parser('create', description=create_desc, help=create_desc,
+                                          aliases=['add', 'run', 'install'])
     create_subparsers = create_parser.add_subparsers(metavar='', dest='subcommand_create')
 
     createapp_desc = 'Create Kube Apps'
     createapp_parser = create_subparsers.add_parser('app', description=createapp_desc,
                                                     help=createapp_desc, aliases=['apps', 'operator', 'operators'])
     createapp_subparsers = createapp_parser.add_subparsers(metavar='', dest='subcommand_create_app')
 
@@ -3662,40 +3669,40 @@
     ovirthostcreate_parser.add_argument('-p', '--password', help='Password to use', metavar='PASSWORD', required=True)
     ovirthostcreate_parser.add_argument('--pool', help='Storage Domain', metavar='POOL')
     ovirthostcreate_parser.add_argument('-u', '--user', help='User. Defaults to admin@internal',
                                         metavar='USER', default='admin@internal')
     ovirthostcreate_parser.add_argument('name', metavar='NAME')
     ovirthostcreate_parser.set_defaults(func=create_host_ovirt)
 
-    vspherehostcreate_desc = 'Create Vsphere Host'
-    vspherehostcreate_parser = hostcreate_subparsers.add_parser('vsphere', help=vspherehostcreate_desc,
-                                                                description=vspherehostcreate_desc)
-    vspherehostcreate_parser.add_argument('-c', '--cluster', help='Cluster', metavar='CLUSTER', required=True)
-    vspherehostcreate_parser.add_argument('-d', '--datacenter', help='Datacenter', metavar='DATACENTER', required=True)
-    vspherehostcreate_parser.add_argument('-H', '--host', help='Vcenter Host', metavar='HOST', required=True)
-    vspherehostcreate_parser.add_argument('-p', '--password', help='Password', metavar='PASSWORD', required=True)
-    vspherehostcreate_parser.add_argument('-u', '--user', help='User', metavar='USER', required=True)
-    vspherehostcreate_parser.add_argument('--pool', help='Pool', metavar='POOL')
-    vspherehostcreate_parser.add_argument('name', metavar='NAME')
-    vspherehostcreate_parser.set_defaults(func=create_host_vsphere)
-
     proxmoxhostcreate_desc = 'Create Proxmox Host'
     proxmoxhostcreate_parser = hostcreate_subparsers.add_parser('proxmox', help=proxmoxhostcreate_desc,
                                                                 description=proxmoxhostcreate_desc)
     proxmoxhostcreate_parser.add_argument('-H', '--host', help='Host to use', metavar='HOST', required=True)
     proxmoxhostcreate_parser.add_argument('-u', '--user', help='User. Default to root@pam', metavar='USER',
                                           default='root@pam')
     proxmoxhostcreate_parser.add_argument('-p', '--password', help='Password', metavar='PASSWORD', required=True)
     proxmoxhostcreate_parser.add_argument('--pool', help='Storage Name', metavar='POOL')
     proxmoxhostcreate_parser.add_argument('--node', help='Cluster node where VMs will be created. Default to HOST',
                                           metavar='NODE')
     proxmoxhostcreate_parser.add_argument('-k', '--insecure', help='Disable SSL verification', action='store_true')
     proxmoxhostcreate_parser.add_argument('name', metavar='NAME')
     proxmoxhostcreate_parser.set_defaults(func=create_host_proxmox)
 
+    vspherehostcreate_desc = 'Create Vsphere Host'
+    vspherehostcreate_parser = hostcreate_subparsers.add_parser('vsphere', help=vspherehostcreate_desc,
+                                                                description=vspherehostcreate_desc)
+    vspherehostcreate_parser.add_argument('-c', '--cluster', help='Cluster', metavar='CLUSTER', required=True)
+    vspherehostcreate_parser.add_argument('-d', '--datacenter', help='Datacenter', metavar='DATACENTER', required=True)
+    vspherehostcreate_parser.add_argument('-H', '--host', help='Vcenter Host', metavar='HOST', required=True)
+    vspherehostcreate_parser.add_argument('-p', '--password', help='Password', metavar='PASSWORD', required=True)
+    vspherehostcreate_parser.add_argument('-u', '--user', help='User', metavar='USER', required=True)
+    vspherehostcreate_parser.add_argument('--pool', help='Pool', metavar='POOL')
+    vspherehostcreate_parser.add_argument('name', metavar='NAME')
+    vspherehostcreate_parser.set_defaults(func=create_host_vsphere)
+
     kubecreate_desc = 'Create Kube'
     kubecreate_parser = create_subparsers.add_parser('kube', description=kubecreate_desc, help=kubecreate_desc,
                                                      aliases=['cluster'])
     kubecreate_subparsers = kubecreate_parser.add_subparsers(metavar='', dest='subcommand_create_kube')
 
     kubeekscreate_desc = 'Create Eks Kube'
     kubeekscreate_epilog = f"examples:\n{kubeekscreate}"
@@ -3806,14 +3813,82 @@
                                       help='specify parameter or keyword for rendering (can specify multiple)',
                                       metavar='PARAM')
     profilecreate_parser.add_argument('profile', metavar='PROFILE')
     profilecreate_parser.set_defaults(func=create_profile)
     create_subparsers.add_parser('profile', parents=[profilecreate_parser], description=profilecreate_desc,
                                  help=profilecreate_desc, epilog=profilecreate_epilog, formatter_class=rawhelp)
 
+    providercreate_desc = 'Install Provider'
+    providercreate_epilog = f"examples:\n{providercreate}"
+    providercreate_parser = create_subparsers.add_parser('provider', help=providercreate_desc,
+                                                         description=providercreate_desc, epilog=providercreate_epilog,
+                                                         formatter_class=rawhelp)
+    providercreate_subparsers = providercreate_parser.add_subparsers(metavar='', dest='subcommand_create_provider')
+
+    awsprovidercreate_desc = 'Install Aws Provider'
+    awsprovidercreate_parser = providercreate_subparsers.add_parser('aws', help=awsprovidercreate_desc,
+                                                                    description=awsprovidercreate_desc)
+    awsprovidercreate_parser.add_argument('-p', '--pip', action='store_true', help='Force pip installation')
+    awsprovidercreate_parser.set_defaults(func=install_provider)
+
+    gcpprovidercreate_desc = 'Install Gcp Provider'
+    gcpprovidercreate_parser = providercreate_subparsers.add_parser('gcp', help=gcpprovidercreate_desc,
+                                                                    description=gcpprovidercreate_desc)
+    gcpprovidercreate_parser.add_argument('-p', '--pip', action='store_true', help='Force pip installation')
+    gcpprovidercreate_parser.set_defaults(func=install_provider)
+
+    ibmprovidercreate_desc = 'Install IBM Cloud Provider'
+    ibmprovidercreate_parser = providercreate_subparsers.add_parser('ibm', help=ibmprovidercreate_desc,
+                                                                    description=ibmprovidercreate_desc)
+    ibmprovidercreate_parser.add_argument('-p', '--pip', action='store_true', help='Force pip installation')
+    ibmprovidercreate_parser.set_defaults(func=install_provider)
+
+    kvmprovidercreate_desc = 'Install Kvm Provider'
+    kvmprovidercreate_parser = providercreate_subparsers.add_parser('kvm', help=kvmprovidercreate_desc,
+                                                                    description=kvmprovidercreate_desc)
+    kvmprovidercreate_parser.add_argument('-p', '--pip', action='store_true', help='Force pip installation')
+    kvmprovidercreate_parser.set_defaults(func=install_provider)
+
+    kubevirtprovidercreate_desc = 'Install Kubevirt Provider'
+    kubevirtprovidercreate_parser = providercreate_subparsers.add_parser('kubevirt', help=kubevirtprovidercreate_desc,
+                                                                         description=kubevirtprovidercreate_desc)
+    kubevirtprovidercreate_parser.add_argument('-p', '--pip', action='store_true', help='Force pip installation')
+    kubevirtprovidercreate_parser.set_defaults(func=install_provider)
+
+    openstackprovidercreate_desc = 'Install Openstack Provider'
+    openstackprovidercreate_parser = providercreate_subparsers.add_parser('openstack',
+                                                                          help=openstackprovidercreate_desc,
+                                                                          description=openstackprovidercreate_desc)
+    openstackprovidercreate_parser.add_argument('-p', '--pip', action='store_true', help='Force pip installation')
+    openstackprovidercreate_parser.set_defaults(func=install_provider)
+
+    ovirtprovidercreate_desc = 'Install Ovirt Provider'
+    ovirtprovidercreate_parser = providercreate_subparsers.add_parser('ovirt', help=ovirtprovidercreate_desc,
+                                                                      description=ovirtprovidercreate_desc)
+    ovirtprovidercreate_parser.add_argument('-p', '--pip', action='store_true', help='Force pip installation')
+    ovirtprovidercreate_parser.set_defaults(func=install_provider)
+
+    packetprovidercreate_desc = 'Install Packet Provider'
+    packetprovidercreate_parser = providercreate_subparsers.add_parser('packet', help=packetprovidercreate_desc,
+                                                                       description=packetprovidercreate_desc)
+    packetprovidercreate_parser.add_argument('-p', '--pip', action='store_true', help='Force pip installation')
+    packetprovidercreate_parser.set_defaults(func=install_provider)
+
+    proxmoxprovidercreate_desc = 'Install Proxmox Provider'
+    proxmoxprovidercreate_parser = providercreate_subparsers.add_parser('proxmox', help=proxmoxprovidercreate_desc,
+                                                                        description=proxmoxprovidercreate_desc)
+    proxmoxprovidercreate_parser.add_argument('-p', '--pip', action='store_true', help='Force pip installation')
+    proxmoxprovidercreate_parser.set_defaults(func=install_provider)
+
+    vsphereprovidercreate_desc = 'Install Vsphere Provider'
+    vsphereprovidercreate_parser = providercreate_subparsers.add_parser('vsphere', help=vsphereprovidercreate_desc,
+                                                                        description=vsphereprovidercreate_desc)
+    vsphereprovidercreate_parser.add_argument('-p', '--pip', action='store_true', help='Force pip installation')
+    vsphereprovidercreate_parser.set_defaults(func=install_provider)
+
     networkcreate_desc = 'Create Network'
     networkcreate_epilog = f"examples:\n{networkcreate}"
     networkcreate_parser = create_subparsers.add_parser('network', description=networkcreate_desc,
                                                         help=networkcreate_desc, parents=[parent_parser],
                                                         epilog=networkcreate_epilog, formatter_class=rawhelp,
                                                         aliases=['net'])
     networkcreate_parser.add_argument('-i', '--isolated', action='store_true', help='Isolated Network')
```

## kvirt/config.py

```diff
@@ -90,11994 +90,11989 @@
 00000590: 6262 726f 7773 6572 0a69 6d70 6f72 7420  bbrowser.import 
 000005a0: 7961 6d6c 0a0a 636c 6f75 6470 6c61 7466  yaml..cloudplatf
 000005b0: 6f72 6d73 203d 205b 2761 7773 272c 2027  orms = ['aws', '
 000005c0: 6763 7027 2c20 2770 6163 6b65 7427 2c20  gcp', 'packet', 
 000005d0: 2769 626d 636c 6f75 6427 5d0a 0a0a 6465  'ibmcloud']...de
 000005e0: 6620 6465 7065 6e64 656e 6379 5f65 7272  f dependency_err
 000005f0: 6f72 2870 726f 7669 6465 7229 3a0a 2020  or(provider):.  
-00000600: 2020 646f 635f 7061 6765 203d 2022 6874    doc_page = "ht
-00000610: 7470 733a 2f2f 6b63 6c69 2e72 6561 6474  tps://kcli.readt
-00000620: 6865 646f 6373 2e69 6f2f 656e 2f6c 6174  hedocs.io/en/lat
-00000630: 6573 7422 0a20 2020 206d 7367 203d 2066  est".    msg = f
-00000640: 2243 6f75 6c64 6e74 2069 6d70 6f72 7420  "Couldnt import 
-00000650: 7b70 726f 7669 6465 727d 2e20 4368 6563  {provider}. Chec
-00000660: 6b20 6465 7065 6e64 656e 6369 6573 2061  k dependencies a
-00000670: 7420 7b64 6f63 5f70 6167 657d 2f23 7b70  t {doc_page}/#{p
-00000680: 726f 7669 6465 722e 6361 7069 7461 6c69  rovider.capitali
-00000690: 7a65 2829 7d22 0a20 2020 2065 7272 6f72  ze()}".    error
-000006a0: 286d 7367 290a 2020 2020 7379 732e 6578  (msg).    sys.ex
-000006b0: 6974 2831 290a 0a0a 636c 6173 7320 4b63  it(1)...class Kc
-000006c0: 6f6e 6669 6728 4b62 6173 6563 6f6e 6669  onfig(Kbaseconfi
-000006d0: 6729 3a0a 2020 2020 2222 220a 0a20 2020  g):.    """..   
-000006e0: 2022 2222 0a20 2020 2064 6566 205f 5f69   """.    def __i
-000006f0: 6e69 745f 5f28 7365 6c66 2c20 636c 6965  nit__(self, clie
-00000700: 6e74 3d4e 6f6e 652c 2064 6562 7567 3d46  nt=None, debug=F
-00000710: 616c 7365 2c20 7175 6965 743d 4661 6c73  alse, quiet=Fals
-00000720: 652c 2072 6567 696f 6e3d 4e6f 6e65 2c20  e, region=None, 
-00000730: 7a6f 6e65 3d4e 6f6e 652c 206e 616d 6573  zone=None, names
-00000740: 7061 6365 3d4e 6f6e 652c 206f 6666 6c69  pace=None, offli
-00000750: 6e65 3d46 616c 7365 293a 0a20 2020 2020  ne=False):.     
-00000760: 2020 204b 6261 7365 636f 6e66 6967 2e5f     Kbaseconfig._
-00000770: 5f69 6e69 745f 5f28 7365 6c66 2c20 636c  _init__(self, cl
-00000780: 6965 6e74 3d63 6c69 656e 742c 2064 6562  ient=client, deb
-00000790: 7567 3d64 6562 7567 2c20 7175 6965 743d  ug=debug, quiet=
-000007a0: 7175 6965 742c 206f 6666 6c69 6e65 3d6f  quiet, offline=o
-000007b0: 6666 6c69 6e65 290a 2020 2020 2020 2020  ffline).        
-000007c0: 6966 206e 6f74 2073 656c 662e 656e 6162  if not self.enab
-000007d0: 6c65 643a 0a20 2020 2020 2020 2020 2020  led:.           
-000007e0: 206b 203d 204e 6f6e 650a 2020 2020 2020   k = None.      
-000007f0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00000800: 2020 2020 6966 2073 656c 662e 7479 7065      if self.type
-00000810: 203d 3d20 276b 7562 6576 6972 7427 3a0a   == 'kubevirt':.
-00000820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000830: 6966 206e 616d 6573 7061 6365 2069 7320  if namespace is 
-00000840: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00000850: 2020 2020 2020 2020 2020 6e61 6d65 7370            namesp
-00000860: 6163 6520 3d20 7365 6c66 2e6f 7074 696f  ace = self.optio
-00000870: 6e73 2e67 6574 2827 6e61 6d65 7370 6163  ns.get('namespac
-00000880: 6527 290a 2020 2020 2020 2020 2020 2020  e').            
-00000890: 2020 2020 636f 6e74 6578 7420 3d20 7365      context = se
-000008a0: 6c66 2e6f 7074 696f 6e73 2e67 6574 2827  lf.options.get('
-000008b0: 636f 6e74 6578 7427 290a 2020 2020 2020  context').      
-000008c0: 2020 2020 2020 2020 2020 6461 7461 766f            datavo
-000008d0: 6c75 6d65 7320 3d20 7365 6c66 2e6f 7074  lumes = self.opt
-000008e0: 696f 6e73 2e67 6574 2827 6461 7461 766f  ions.get('datavo
-000008f0: 6c75 6d65 7327 2c20 5472 7565 290a 2020  lumes', True).  
-00000900: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00000910: 6164 7772 6974 656d 616e 7920 3d20 7365  adwritemany = se
-00000920: 6c66 2e6f 7074 696f 6e73 2e67 6574 2827  lf.options.get('
-00000930: 7265 6164 7772 6974 656d 616e 7927 2c20  readwritemany', 
-00000940: 4661 6c73 6529 0a20 2020 2020 2020 2020  False).         
-00000950: 2020 2020 2020 2063 615f 6669 6c65 203d         ca_file =
-00000960: 2073 656c 662e 6f70 7469 6f6e 732e 6765   self.options.ge
-00000970: 7428 2763 615f 6669 6c65 2729 0a20 2020  t('ca_file').   
-00000980: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00000990: 6361 5f66 696c 6520 6973 206e 6f74 204e  ca_file is not N
-000009a0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-000009b0: 2020 2020 2020 2020 2063 615f 6669 6c65           ca_file
-000009c0: 203d 206f 732e 7061 7468 2e65 7870 616e   = os.path.expan
-000009d0: 6475 7365 7228 6361 5f66 696c 6529 0a20  duser(ca_file). 
-000009e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000009f0: 2020 2069 6620 6e6f 7420 6f73 2e70 6174     if not os.pat
-00000a00: 682e 6578 6973 7473 2863 615f 6669 6c65  h.exists(ca_file
-00000a10: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00000a20: 2020 2020 2020 2020 2020 2065 7272 6f72             error
-00000a30: 2866 2243 6120 6669 6c65 207b 6361 5f66  (f"Ca file {ca_f
-00000a40: 696c 657d 2064 6f65 736e 2774 2065 7869  ile} doesn't exi
-00000a50: 7374 2e20 4c65 6176 696e 6722 290a 2020  st. Leaving").  
-00000a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000a70: 2020 2020 2020 7379 732e 6578 6974 2831        sys.exit(1
-00000a80: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00000a90: 2020 6469 736b 5f68 6f74 706c 7567 203d    disk_hotplug =
-00000aa0: 2073 656c 662e 6f70 7469 6f6e 732e 6765   self.options.ge
-00000ab0: 7428 2764 6973 6b5f 686f 7470 6c75 6727  t('disk_hotplug'
-00000ac0: 2c20 4661 6c73 6529 0a20 2020 2020 2020  , False).       
-00000ad0: 2020 2020 2020 2020 206b 7562 6563 6f6e           kubecon
-00000ae0: 6669 675f 6669 6c65 203d 2073 656c 662e  fig_file = self.
-00000af0: 6f70 7469 6f6e 732e 6765 7428 276b 7562  options.get('kub
-00000b00: 6563 6f6e 6669 6727 290a 2020 2020 2020  econfig').      
-00000b10: 2020 2020 2020 2020 2020 746f 6b65 6e20            token 
-00000b20: 3d20 7365 6c66 2e6f 7074 696f 6e73 2e67  = self.options.g
-00000b30: 6574 2827 746f 6b65 6e27 290a 2020 2020  et('token').    
-00000b40: 2020 2020 2020 2020 2020 2020 746f 6b65              toke
-00000b50: 6e5f 6669 6c65 203d 2073 656c 662e 6f70  n_file = self.op
-00000b60: 7469 6f6e 732e 6765 7428 2774 6f6b 656e  tions.get('token
-00000b70: 5f66 696c 6527 290a 2020 2020 2020 2020  _file').        
-00000b80: 2020 2020 2020 2020 6966 2074 6f6b 656e          if token
-00000b90: 5f66 696c 6520 6973 206e 6f74 204e 6f6e  _file is not Non
-00000ba0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00000bb0: 2020 2020 2020 2074 6f6b 656e 5f66 696c         token_fil
-00000bc0: 6520 3d20 6f73 2e70 6174 682e 6578 7061  e = os.path.expa
-00000bd0: 6e64 7573 6572 2874 6f6b 656e 5f66 696c  nduser(token_fil
-00000be0: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-00000bf0: 2020 2020 2020 2069 6620 6e6f 7420 6f73         if not os
-00000c00: 2e70 6174 682e 6578 6973 7473 2874 6f6b  .path.exists(tok
-00000c10: 656e 5f66 696c 6529 3a0a 2020 2020 2020  en_file):.      
-00000c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000c30: 2020 6572 726f 7228 2254 6f6b 656e 2066    error("Token f
-00000c40: 696c 6520 7061 7468 2064 6f65 736e 2774  ile path doesn't
-00000c50: 2065 7869 7374 2e20 4c65 6176 696e 6722   exist. Leaving"
-00000c60: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00000c70: 2020 2020 2020 2020 2020 7379 732e 6578            sys.ex
-00000c80: 6974 2831 290a 2020 2020 2020 2020 2020  it(1).          
-00000c90: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-00000ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000cb0: 2020 2020 2020 2020 746f 6b65 6e20 3d20          token = 
-00000cc0: 6f70 656e 2874 6f6b 656e 5f66 696c 6529  open(token_file)
-00000cd0: 2e72 6561 6428 290a 2020 2020 2020 2020  .read().        
-00000ce0: 2020 2020 2020 2020 7265 6769 7374 7279          registry
-00000cf0: 203d 2073 656c 662e 6f70 7469 6f6e 732e   = self.options.
-00000d00: 6765 7428 2772 6567 6973 7472 7927 290a  get('registry').
-00000d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000d20: 6163 6365 7373 5f6d 6f64 6520 3d20 7365  access_mode = se
-00000d30: 6c66 2e6f 7074 696f 6e73 2e67 6574 2827  lf.options.get('
-00000d40: 6163 6365 7373 5f6d 6f64 6527 2c20 274e  access_mode', 'N
-00000d50: 6f64 6550 6f72 7427 290a 2020 2020 2020  odePort').      
-00000d60: 2020 2020 2020 2020 2020 6966 2061 6363            if acc
-00000d70: 6573 735f 6d6f 6465 206e 6f74 2069 6e20  ess_mode not in 
-00000d80: 5b27 4578 7465 726e 616c 272c 2027 4c6f  ['External', 'Lo
-00000d90: 6164 4261 6c61 6e63 6572 272c 2027 4e6f  adBalancer', 'No
-00000da0: 6465 506f 7274 275d 3a0a 2020 2020 2020  dePort']:.      
-00000db0: 2020 2020 2020 2020 2020 2020 2020 6d73                ms
-00000dc0: 6720 3d20 6622 496e 636f 7272 6563 7420  g = f"Incorrect 
-00000dd0: 6163 6365 7373 5f6d 6f64 6520 7b61 6363  access_mode {acc
-00000de0: 6573 735f 6d6f 6465 7d2e 2053 686f 756c  ess_mode}. Shoul
-00000df0: 6420 6265 2045 7874 6572 6e61 6c2c 204e  d be External, N
-00000e00: 6f64 6550 6f72 7420 6f72 204c 6f61 6442  odePort or LoadB
-00000e10: 616c 616e 6365 7222 0a20 2020 2020 2020  alancer".       
-00000e20: 2020 2020 2020 2020 2020 2020 2065 7272               err
-00000e30: 6f72 286d 7367 290a 2020 2020 2020 2020  or(msg).        
-00000e40: 2020 2020 2020 2020 2020 2020 7379 732e              sys.
-00000e50: 6578 6974 2831 290a 2020 2020 2020 2020  exit(1).        
-00000e60: 2020 2020 2020 2020 766f 6c75 6d65 5f6d          volume_m
-00000e70: 6f64 6520 3d20 7365 6c66 2e6f 7074 696f  ode = self.optio
-00000e80: 6e73 2e67 6574 2827 766f 6c75 6d65 5f6d  ns.get('volume_m
-00000e90: 6f64 6527 2c20 2746 696c 6573 7973 7465  ode', 'Filesyste
-00000ea0: 6d27 290a 2020 2020 2020 2020 2020 2020  m').            
-00000eb0: 2020 2020 6966 2076 6f6c 756d 655f 6d6f      if volume_mo
-00000ec0: 6465 206e 6f74 2069 6e20 5b27 4669 6c65  de not in ['File
-00000ed0: 7379 7374 656d 272c 2027 426c 6f63 6b27  system', 'Block'
-00000ee0: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
-00000ef0: 2020 2020 2020 206d 7367 203d 2066 2249         msg = f"I
-00000f00: 6e63 6f72 7265 6374 2076 6f6c 756d 655f  ncorrect volume_
-00000f10: 6d6f 6465 207b 766f 6c75 6d65 5f6d 6f64  mode {volume_mod
-00000f20: 657d 2e20 5368 6f75 6c64 2062 6520 4669  e}. Should be Fi
-00000f30: 6c65 7379 7374 656d 206f 7220 426c 6f63  lesystem or Bloc
-00000f40: 6b22 0a20 2020 2020 2020 2020 2020 2020  k".             
-00000f50: 2020 2020 2020 2065 7272 6f72 286d 7367         error(msg
-00000f60: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00000f70: 2020 2020 2020 7379 732e 6578 6974 2831        sys.exit(1
-00000f80: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00000f90: 2020 766f 6c75 6d65 5f61 6363 6573 7320    volume_access 
-00000fa0: 3d20 7365 6c66 2e6f 7074 696f 6e73 2e67  = self.options.g
-00000fb0: 6574 2827 766f 6c75 6d65 5f61 6363 6573  et('volume_acces
-00000fc0: 7327 2c20 2752 6561 6457 7269 7465 4f6e  s', 'ReadWriteOn
-00000fd0: 6365 2729 0a20 2020 2020 2020 2020 2020  ce').           
-00000fe0: 2020 2020 2069 6620 766f 6c75 6d65 5f61       if volume_a
-00000ff0: 6363 6573 7320 6e6f 7420 696e 205b 2752  ccess not in ['R
-00001000: 6561 6457 7269 7465 4d61 6e79 272c 2027  eadWriteMany', '
-00001010: 5265 6164 5772 6974 654f 6e63 6527 5d3a  ReadWriteOnce']:
-00001020: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00001030: 2020 2020 206d 7367 203d 2066 2249 6e63       msg = f"Inc
-00001040: 6f72 7265 6374 2076 6f6c 756d 655f 6163  orrect volume_ac
-00001050: 6365 7373 207b 766f 6c75 6d65 5f61 6363  cess {volume_acc
-00001060: 6573 737d 2e20 5368 6f75 6c64 2062 6520  ess}. Should be 
-00001070: 5265 6164 5772 6974 654f 6e63 6520 6f72  ReadWriteOnce or
-00001080: 2052 6561 6457 7269 7465 4f6e 6365 220a   ReadWriteOnce".
-00001090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000010a0: 2020 2020 6572 726f 7228 6d73 6729 0a20      error(msg). 
-000010b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000010c0: 2020 2073 7973 2e65 7869 7428 3129 0a20     sys.exit(1). 
-000010d0: 2020 2020 2020 2020 2020 2020 2020 2068                 h
-000010e0: 6172 7665 7374 6572 203d 2073 656c 662e  arvester = self.
-000010f0: 6f70 7469 6f6e 732e 6765 7428 2768 6172  options.get('har
-00001100: 7665 7374 6572 272c 2046 616c 7365 290a  vester', False).
-00001110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001120: 656d 6265 645f 7573 6572 6461 7461 203d  embed_userdata =
-00001130: 2073 656c 662e 6f70 7469 6f6e 732e 6765   self.options.ge
-00001140: 7428 2765 6d62 6564 5f75 7365 7264 6174  t('embed_userdat
-00001150: 6127 2c20 4661 6c73 6529 0a20 2020 2020  a', False).     
-00001160: 2020 2020 2020 2020 2020 2066 6972 7374             first
-00001170: 5f63 6f6e 7375 6d65 7220 3d20 7365 6c66  _consumer = self
-00001180: 2e6f 7074 696f 6e73 2e67 6574 2827 6669  .options.get('fi
-00001190: 7273 745f 636f 6e73 756d 6572 272c 2046  rst_consumer', F
-000011a0: 616c 7365 290a 2020 2020 2020 2020 2020  alse).          
-000011b0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-000011c0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-000011d0: 726f 6d20 6b76 6972 742e 7072 6f76 6964  rom kvirt.provid
-000011e0: 6572 732e 6b75 6265 7669 7274 2069 6d70  ers.kubevirt imp
-000011f0: 6f72 7420 4b75 6265 7669 7274 0a20 2020  ort Kubevirt.   
-00001200: 2020 2020 2020 2020 2020 2020 2065 7863               exc
-00001210: 6570 743a 0a20 2020 2020 2020 2020 2020  ept:.           
-00001220: 2020 2020 2020 2020 2064 6570 656e 6465           depende
-00001230: 6e63 795f 6572 726f 7228 276b 7562 6576  ncy_error('kubev
-00001240: 6972 7427 290a 2020 2020 2020 2020 2020  irt').          
-00001250: 2020 2020 2020 6b20 3d20 4b75 6265 7669        k = Kubevi
-00001260: 7274 2863 6f6e 7465 7874 3d63 6f6e 7465  rt(context=conte
-00001270: 7874 2c20 746f 6b65 6e3d 746f 6b65 6e2c  xt, token=token,
-00001280: 2063 615f 6669 6c65 3d63 615f 6669 6c65   ca_file=ca_file
-00001290: 2c20 686f 7374 3d73 656c 662e 686f 7374  , host=self.host
-000012a0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000012b0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-000012c0: 6f72 743d 3634 3433 2c20 7573 6572 3d73  ort=6443, user=s
-000012d0: 656c 662e 7573 6572 2c20 6465 6275 673d  elf.user, debug=
-000012e0: 6465 6275 672c 206e 616d 6573 7061 6365  debug, namespace
-000012f0: 3d6e 616d 6573 7061 6365 2c0a 2020 2020  =namespace,.    
-00001300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001310: 2020 2020 2020 2020 2064 6174 6176 6f6c           datavol
-00001320: 756d 6573 3d64 6174 6176 6f6c 756d 6573  umes=datavolumes
-00001330: 2c20 6469 736b 5f68 6f74 706c 7567 3d64  , disk_hotplug=d
-00001340: 6973 6b5f 686f 7470 6c75 672c 2072 6561  isk_hotplug, rea
-00001350: 6477 7269 7465 6d61 6e79 3d72 6561 6477  dwritemany=readw
-00001360: 7269 7465 6d61 6e79 2c0a 2020 2020 2020  ritemany,.      
-00001370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001380: 2020 2020 2020 2072 6567 6973 7472 793d         registry=
-00001390: 7265 6769 7374 7279 2c20 6163 6365 7373  registry, access
-000013a0: 5f6d 6f64 653d 6163 6365 7373 5f6d 6f64  _mode=access_mod
-000013b0: 652c 2076 6f6c 756d 655f 6d6f 6465 3d76  e, volume_mode=v
-000013c0: 6f6c 756d 655f 6d6f 6465 2c0a 2020 2020  olume_mode,.    
-000013d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000013e0: 2020 2020 2020 2020 2076 6f6c 756d 655f           volume_
-000013f0: 6163 6365 7373 3d76 6f6c 756d 655f 6163  access=volume_ac
-00001400: 6365 7373 2c20 6861 7276 6573 7465 723d  cess, harvester=
-00001410: 6861 7276 6573 7465 722c 2065 6d62 6564  harvester, embed
-00001420: 5f75 7365 7264 6174 613d 656d 6265 645f  _userdata=embed_
-00001430: 7573 6572 6461 7461 2c0a 2020 2020 2020  userdata,.      
-00001440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001450: 2020 2020 2020 2066 6972 7374 5f63 6f6e         first_con
-00001460: 7375 6d65 723d 6669 7273 745f 636f 6e73  sumer=first_cons
-00001470: 756d 6572 2c20 6b75 6265 636f 6e66 6967  umer, kubeconfig
-00001480: 5f66 696c 653d 6b75 6265 636f 6e66 6967  _file=kubeconfig
-00001490: 5f66 696c 6529 0a20 2020 2020 2020 2020  _file).         
-000014a0: 2020 2020 2020 2073 656c 662e 686f 7374         self.host
-000014b0: 203d 206b 2e68 6f73 740a 2020 2020 2020   = k.host.      
-000014c0: 2020 2020 2020 656c 6966 2073 656c 662e        elif self.
-000014d0: 7479 7065 203d 3d20 2767 6370 273a 0a20  type == 'gcp':. 
-000014e0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-000014f0: 7265 6465 6e74 6961 6c73 203d 2073 656c  redentials = sel
-00001500: 662e 6f70 7469 6f6e 732e 6765 7428 2763  f.options.get('c
-00001510: 7265 6465 6e74 6961 6c73 2729 0a20 2020  redentials').   
-00001520: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00001530: 6372 6564 656e 7469 616c 7320 6973 206e  credentials is n
-00001540: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-00001550: 2020 2020 2020 2020 2020 2020 206f 732e               os.
-00001560: 656e 7669 726f 6e5b 2747 4f4f 474c 455f  environ['GOOGLE_
-00001570: 4150 504c 4943 4154 494f 4e5f 4352 4544  APPLICATION_CRED
-00001580: 454e 5449 414c 5327 5d20 3d20 6f73 2e70  ENTIALS'] = os.p
-00001590: 6174 682e 6578 7061 6e64 7573 6572 2863  ath.expanduser(c
-000015a0: 7265 6465 6e74 6961 6c73 290a 2020 2020  redentials).    
-000015b0: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-000015c0: 2027 474f 4f47 4c45 5f41 5050 4c49 4341   'GOOGLE_APPLICA
-000015d0: 5449 4f4e 5f43 5245 4445 4e54 4941 4c53  TION_CREDENTIALS
-000015e0: 2720 6e6f 7420 696e 206f 732e 656e 7669  ' not in os.envi
-000015f0: 726f 6e3a 0a20 2020 2020 2020 2020 2020  ron:.           
-00001600: 2020 2020 2020 2020 2065 7272 6f72 2822           error("
-00001610: 7365 7420 474f 4f47 4c45 5f41 5050 4c49  set GOOGLE_APPLI
-00001620: 4341 5449 4f4e 5f43 5245 4445 4e54 4941  CATION_CREDENTIA
-00001630: 4c53 2076 6172 6961 626c 652e 4c65 6176  LS variable.Leav
-00001640: 696e 672e 2e2e 2229 0a20 2020 2020 2020  ing...").       
-00001650: 2020 2020 2020 2020 2020 2020 2073 7973               sys
-00001660: 2e65 7869 7428 3129 0a20 2020 2020 2020  .exit(1).       
-00001670: 2020 2020 2020 2020 2070 726f 6a65 6374           project
-00001680: 203d 2073 656c 662e 6f70 7469 6f6e 732e   = self.options.
-00001690: 6765 7428 2770 726f 6a65 6374 2729 0a20  get('project'). 
-000016a0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000016b0: 6620 7072 6f6a 6563 7420 6973 204e 6f6e  f project is Non
-000016c0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-000016d0: 2020 2020 2020 2065 7272 6f72 2822 4d69         error("Mi
-000016e0: 7373 696e 6720 7072 6f6a 6563 7420 696e  ssing project in
-000016f0: 2074 6865 2063 6f6e 6669 6775 7261 7469   the configurati
-00001700: 6f6e 2e20 4c65 6176 696e 6722 290a 2020  on. Leaving").  
-00001710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001720: 2020 7379 732e 6578 6974 2831 290a 2020    sys.exit(1).  
-00001730: 2020 2020 2020 2020 2020 2020 2020 7a6f                zo
-00001740: 6e65 203d 2073 656c 662e 6f70 7469 6f6e  ne = self.option
-00001750: 732e 6765 7428 277a 6f6e 6527 2c20 2765  s.get('zone', 'e
-00001760: 7572 6f70 652d 7765 7374 312d 6227 2920  urope-west1-b') 
-00001770: 6966 207a 6f6e 6520 6973 204e 6f6e 6520  if zone is None 
-00001780: 656c 7365 207a 6f6e 650a 2020 2020 2020  else zone.      
-00001790: 2020 2020 2020 2020 2020 7265 6769 6f6e            region
-000017a0: 203d 2073 656c 662e 6f70 7469 6f6e 732e   = self.options.
-000017b0: 6765 7428 2772 6567 696f 6e27 2920 6966  get('region') if
-000017c0: 2072 6567 696f 6e20 6973 204e 6f6e 6520   region is None 
-000017d0: 656c 7365 2072 6567 696f 6e0a 2020 2020  else region.    
-000017e0: 2020 2020 2020 2020 2020 2020 7265 6769              regi
-000017f0: 6f6e 203d 207a 6f6e 655b 3a2d 325d 2069  on = zone[:-2] i
-00001800: 6620 7265 6769 6f6e 2069 7320 4e6f 6e65  f region is None
-00001810: 2065 6c73 6520 7265 6769 6f6e 0a20 2020   else region.   
-00001820: 2020 2020 2020 2020 2020 2020 2070 7562               pub
-00001830: 6c69 6320 3d20 7365 6c66 2e6f 7074 696f  lic = self.optio
-00001840: 6e73 2e67 6574 2827 7075 626c 6963 272c  ns.get('public',
-00001850: 2054 7275 6529 0a20 2020 2020 2020 2020   True).         
-00001860: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-00001870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001880: 6672 6f6d 206b 7669 7274 2e70 726f 7669  from kvirt.provi
-00001890: 6465 7273 2e67 6370 2069 6d70 6f72 7420  ders.gcp import 
-000018a0: 4b67 6370 0a20 2020 2020 2020 2020 2020  Kgcp.           
-000018b0: 2020 2020 2065 7863 6570 743a 0a20 2020       except:.   
-000018c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000018d0: 2064 6570 656e 6465 6e63 795f 6572 726f   dependency_erro
-000018e0: 7228 2767 6370 2729 0a20 2020 2020 2020  r('gcp').       
-000018f0: 2020 2020 2020 2020 206b 203d 204b 6763           k = Kgc
-00001900: 7028 7072 6f6a 6563 742c 207a 6f6e 653d  p(project, zone=
-00001910: 7a6f 6e65 2c20 7265 6769 6f6e 3d72 6567  zone, region=reg
-00001920: 696f 6e2c 2064 6562 7567 3d64 6562 7567  ion, debug=debug
-00001930: 2c20 7075 626c 6963 3d70 7562 6c69 6329  , public=public)
-00001940: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00001950: 2073 656c 662e 6f76 6572 7269 6465 732e   self.overrides.
-00001960: 7570 6461 7465 287b 2770 726f 6a65 6374  update({'project
-00001970: 273a 2070 726f 6a65 6374 7d29 0a20 2020  ': project}).   
-00001980: 2020 2020 2020 2020 2065 6c69 6620 7365           elif se
-00001990: 6c66 2e74 7970 6520 3d3d 2027 6177 7327  lf.type == 'aws'
-000019a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000019b0: 2020 6163 6365 7373 5f6b 6579 5f69 6420    access_key_id 
-000019c0: 3d20 7365 6c66 2e6f 7074 696f 6e73 2e67  = self.options.g
-000019d0: 6574 2827 6163 6365 7373 5f6b 6579 5f69  et('access_key_i
-000019e0: 6427 290a 2020 2020 2020 2020 2020 2020  d').            
-000019f0: 2020 2020 6163 6365 7373 5f6b 6579 5f73      access_key_s
-00001a00: 6563 7265 7420 3d20 7365 6c66 2e6f 7074  ecret = self.opt
-00001a10: 696f 6e73 2e67 6574 2827 6163 6365 7373  ions.get('access
-00001a20: 5f6b 6579 5f73 6563 7265 7427 290a 2020  _key_secret').  
-00001a30: 2020 2020 2020 2020 2020 2020 2020 6b65                ke
-00001a40: 7970 6169 7220 3d20 7365 6c66 2e6f 7074  ypair = self.opt
-00001a50: 696f 6e73 2e67 6574 2827 6b65 7970 6169  ions.get('keypai
-00001a60: 7227 290a 2020 2020 2020 2020 2020 2020  r').            
-00001a70: 2020 2020 7365 7373 696f 6e5f 746f 6b65      session_toke
-00001a80: 6e20 3d20 7365 6c66 2e6f 7074 696f 6e73  n = self.options
-00001a90: 2e67 6574 2827 7365 7373 696f 6e5f 746f  .get('session_to
-00001aa0: 6b65 6e27 290a 2020 2020 2020 2020 2020  ken').          
-00001ab0: 2020 2020 2020 7265 6769 6f6e 203d 2073        region = s
-00001ac0: 656c 662e 6f70 7469 6f6e 732e 6765 7428  elf.options.get(
-00001ad0: 2772 6567 696f 6e27 2920 6966 2072 6567  'region') if reg
-00001ae0: 696f 6e20 6973 204e 6f6e 6520 656c 7365  ion is None else
-00001af0: 2072 6567 696f 6e0a 2020 2020 2020 2020   region.        
-00001b00: 2020 2020 2020 2020 6966 2072 6567 696f          if regio
-00001b10: 6e20 6973 204e 6f6e 653a 0a20 2020 2020  n is None:.     
-00001b20: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00001b30: 7272 6f72 2822 4d69 7373 696e 6720 7265  rror("Missing re
-00001b40: 6769 6f6e 2069 6e20 7468 6520 636f 6e66  gion in the conf
-00001b50: 6967 7572 6174 696f 6e2e 204c 6561 7669  iguration. Leavi
-00001b60: 6e67 2229 0a20 2020 2020 2020 2020 2020  ng").           
-00001b70: 2020 2020 2020 2020 2073 7973 2e65 7869           sys.exi
-00001b80: 7428 3129 0a20 2020 2020 2020 2020 2020  t(1).           
-00001b90: 2020 2020 2069 6620 6163 6365 7373 5f6b       if access_k
-00001ba0: 6579 5f69 6420 6973 204e 6f6e 653a 0a20  ey_id is None:. 
-00001bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001bc0: 2020 2065 7272 6f72 2822 4d69 7373 696e     error("Missin
-00001bd0: 6720 6163 6365 7373 5f6b 6579 5f69 6420  g access_key_id 
-00001be0: 696e 2074 6865 2063 6f6e 6669 6775 7261  in the configura
-00001bf0: 7469 6f6e 2e20 4c65 6176 696e 6722 290a  tion. Leaving").
-00001c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001c10: 2020 2020 7379 732e 6578 6974 2831 290a      sys.exit(1).
-00001c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001c30: 6966 2061 6363 6573 735f 6b65 795f 7365  if access_key_se
-00001c40: 6372 6574 2069 7320 4e6f 6e65 3a0a 2020  cret is None:.  
-00001c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001c60: 2020 6572 726f 7228 224d 6973 7369 6e67    error("Missing
-00001c70: 2061 6363 6573 735f 6b65 795f 7365 6372   access_key_secr
-00001c80: 6574 2069 6e20 7468 6520 636f 6e66 6967  et in the config
-00001c90: 7572 6174 696f 6e2e 204c 6561 7669 6e67  uration. Leaving
-00001ca0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-00001cb0: 2020 2020 2020 2073 7973 2e65 7869 7428         sys.exit(
-00001cc0: 3129 0a20 2020 2020 2020 2020 2020 2020  1).             
-00001cd0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-00001ce0: 2020 2020 2020 2020 2020 2020 6672 6f6d              from
-00001cf0: 206b 7669 7274 2e70 726f 7669 6465 7273   kvirt.providers
-00001d00: 2e61 7773 2069 6d70 6f72 7420 4b61 7773  .aws import Kaws
-00001d10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00001d20: 2065 7863 6570 743a 0a20 2020 2020 2020   except:.       
-00001d30: 2020 2020 2020 2020 2020 2020 2064 6570               dep
-00001d40: 656e 6465 6e63 795f 6572 726f 7228 2761  endency_error('a
-00001d50: 7773 2729 0a20 2020 2020 2020 2020 2020  ws').           
-00001d60: 2020 2020 206b 203d 204b 6177 7328 6163       k = Kaws(ac
-00001d70: 6365 7373 5f6b 6579 5f69 643d 6163 6365  cess_key_id=acce
-00001d80: 7373 5f6b 6579 5f69 642c 2061 6363 6573  ss_key_id, acces
-00001d90: 735f 6b65 795f 7365 6372 6574 3d61 6363  s_key_secret=acc
-00001da0: 6573 735f 6b65 795f 7365 6372 6574 2c20  ess_key_secret, 
-00001db0: 7265 6769 6f6e 3d72 6567 696f 6e2c 0a20  region=region,. 
-00001dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001dd0: 2020 2020 2020 2020 6465 6275 673d 6465          debug=de
-00001de0: 6275 672c 206b 6579 7061 6972 3d6b 6579  bug, keypair=key
-00001df0: 7061 6972 2c20 7365 7373 696f 6e5f 746f  pair, session_to
-00001e00: 6b65 6e3d 7365 7373 696f 6e5f 746f 6b65  ken=session_toke
-00001e10: 6e29 0a20 2020 2020 2020 2020 2020 2065  n).            e
-00001e20: 6c69 6620 7365 6c66 2e74 7970 6520 3d3d  lif self.type ==
-00001e30: 2027 6962 6d27 3a0a 2020 2020 2020 2020   'ibm':.        
-00001e40: 2020 2020 2020 2020 6966 206c 656e 2873          if len(s
-00001e50: 656c 662e 6f70 7469 6f6e 7329 203d 3d20  elf.options) == 
-00001e60: 313a 0a20 2020 2020 2020 2020 2020 2020  1:.             
-00001e70: 2020 2020 2020 2068 6f6d 6520 3d20 6f73         home = os
-00001e80: 2e65 6e76 6972 6f6e 5b27 484f 4d45 275d  .environ['HOME']
+00000600: 2020 6d73 6720 3d20 6622 436f 756c 646e    msg = f"Couldn
+00000610: 7420 696d 706f 7274 207b 7072 6f76 6964  t import {provid
+00000620: 6572 7d2e 2055 7365 206b 636c 6920 696e  er}. Use kcli in
+00000630: 7374 616c 6c20 7072 6f76 6964 6572 207b  stall provider {
+00000640: 7072 6f76 6964 6572 7d22 0a20 2020 2065  provider}".    e
+00000650: 7272 6f72 286d 7367 290a 2020 2020 7379  rror(msg).    sy
+00000660: 732e 6578 6974 2831 290a 0a0a 636c 6173  s.exit(1)...clas
+00000670: 7320 4b63 6f6e 6669 6728 4b62 6173 6563  s Kconfig(Kbasec
+00000680: 6f6e 6669 6729 3a0a 2020 2020 2222 220a  onfig):.    """.
+00000690: 0a20 2020 2022 2222 0a20 2020 2064 6566  .    """.    def
+000006a0: 205f 5f69 6e69 745f 5f28 7365 6c66 2c20   __init__(self, 
+000006b0: 636c 6965 6e74 3d4e 6f6e 652c 2064 6562  client=None, deb
+000006c0: 7567 3d46 616c 7365 2c20 7175 6965 743d  ug=False, quiet=
+000006d0: 4661 6c73 652c 2072 6567 696f 6e3d 4e6f  False, region=No
+000006e0: 6e65 2c20 7a6f 6e65 3d4e 6f6e 652c 206e  ne, zone=None, n
+000006f0: 616d 6573 7061 6365 3d4e 6f6e 652c 206f  amespace=None, o
+00000700: 6666 6c69 6e65 3d46 616c 7365 293a 0a20  ffline=False):. 
+00000710: 2020 2020 2020 204b 6261 7365 636f 6e66         Kbaseconf
+00000720: 6967 2e5f 5f69 6e69 745f 5f28 7365 6c66  ig.__init__(self
+00000730: 2c20 636c 6965 6e74 3d63 6c69 656e 742c  , client=client,
+00000740: 2064 6562 7567 3d64 6562 7567 2c20 7175   debug=debug, qu
+00000750: 6965 743d 7175 6965 742c 206f 6666 6c69  iet=quiet, offli
+00000760: 6e65 3d6f 6666 6c69 6e65 290a 2020 2020  ne=offline).    
+00000770: 2020 2020 6966 206e 6f74 2073 656c 662e      if not self.
+00000780: 656e 6162 6c65 643a 0a20 2020 2020 2020  enabled:.       
+00000790: 2020 2020 206b 203d 204e 6f6e 650a 2020       k = None.  
+000007a0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+000007b0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+000007c0: 7479 7065 203d 3d20 276b 7562 6576 6972  type == 'kubevir
+000007d0: 7427 3a0a 2020 2020 2020 2020 2020 2020  t':.            
+000007e0: 2020 2020 6966 206e 616d 6573 7061 6365      if namespace
+000007f0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+00000800: 2020 2020 2020 2020 2020 2020 2020 6e61                na
+00000810: 6d65 7370 6163 6520 3d20 7365 6c66 2e6f  mespace = self.o
+00000820: 7074 696f 6e73 2e67 6574 2827 6e61 6d65  ptions.get('name
+00000830: 7370 6163 6527 290a 2020 2020 2020 2020  space').        
+00000840: 2020 2020 2020 2020 636f 6e74 6578 7420          context 
+00000850: 3d20 7365 6c66 2e6f 7074 696f 6e73 2e67  = self.options.g
+00000860: 6574 2827 636f 6e74 6578 7427 290a 2020  et('context').  
+00000870: 2020 2020 2020 2020 2020 2020 2020 6461                da
+00000880: 7461 766f 6c75 6d65 7320 3d20 7365 6c66  tavolumes = self
+00000890: 2e6f 7074 696f 6e73 2e67 6574 2827 6461  .options.get('da
+000008a0: 7461 766f 6c75 6d65 7327 2c20 5472 7565  tavolumes', True
+000008b0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000008c0: 2020 7265 6164 7772 6974 656d 616e 7920    readwritemany 
+000008d0: 3d20 7365 6c66 2e6f 7074 696f 6e73 2e67  = self.options.g
+000008e0: 6574 2827 7265 6164 7772 6974 656d 616e  et('readwriteman
+000008f0: 7927 2c20 4661 6c73 6529 0a20 2020 2020  y', False).     
+00000900: 2020 2020 2020 2020 2020 2063 615f 6669             ca_fi
+00000910: 6c65 203d 2073 656c 662e 6f70 7469 6f6e  le = self.option
+00000920: 732e 6765 7428 2763 615f 6669 6c65 2729  s.get('ca_file')
+00000930: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00000940: 2069 6620 6361 5f66 696c 6520 6973 206e   if ca_file is n
+00000950: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+00000960: 2020 2020 2020 2020 2020 2020 2063 615f               ca_
+00000970: 6669 6c65 203d 206f 732e 7061 7468 2e65  file = os.path.e
+00000980: 7870 616e 6475 7365 7228 6361 5f66 696c  xpanduser(ca_fil
+00000990: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
+000009a0: 2020 2020 2020 2069 6620 6e6f 7420 6f73         if not os
+000009b0: 2e70 6174 682e 6578 6973 7473 2863 615f  .path.exists(ca_
+000009c0: 6669 6c65 293a 0a20 2020 2020 2020 2020  file):.         
+000009d0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+000009e0: 7272 6f72 2866 2243 6120 6669 6c65 207b  rror(f"Ca file {
+000009f0: 6361 5f66 696c 657d 2064 6f65 736e 2774  ca_file} doesn't
+00000a00: 2065 7869 7374 2e20 4c65 6176 696e 6722   exist. Leaving"
+00000a10: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00000a20: 2020 2020 2020 2020 2020 7379 732e 6578            sys.ex
+00000a30: 6974 2831 290a 2020 2020 2020 2020 2020  it(1).          
+00000a40: 2020 2020 2020 6469 736b 5f68 6f74 706c        disk_hotpl
+00000a50: 7567 203d 2073 656c 662e 6f70 7469 6f6e  ug = self.option
+00000a60: 732e 6765 7428 2764 6973 6b5f 686f 7470  s.get('disk_hotp
+00000a70: 6c75 6727 2c20 4661 6c73 6529 0a20 2020  lug', False).   
+00000a80: 2020 2020 2020 2020 2020 2020 206b 7562               kub
+00000a90: 6563 6f6e 6669 675f 6669 6c65 203d 2073  econfig_file = s
+00000aa0: 656c 662e 6f70 7469 6f6e 732e 6765 7428  elf.options.get(
+00000ab0: 276b 7562 6563 6f6e 6669 6727 290a 2020  'kubeconfig').  
+00000ac0: 2020 2020 2020 2020 2020 2020 2020 746f                to
+00000ad0: 6b65 6e20 3d20 7365 6c66 2e6f 7074 696f  ken = self.optio
+00000ae0: 6e73 2e67 6574 2827 746f 6b65 6e27 290a  ns.get('token').
+00000af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000b00: 746f 6b65 6e5f 6669 6c65 203d 2073 656c  token_file = sel
+00000b10: 662e 6f70 7469 6f6e 732e 6765 7428 2774  f.options.get('t
+00000b20: 6f6b 656e 5f66 696c 6527 290a 2020 2020  oken_file').    
+00000b30: 2020 2020 2020 2020 2020 2020 6966 2074              if t
+00000b40: 6f6b 656e 5f66 696c 6520 6973 206e 6f74  oken_file is not
+00000b50: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00000b60: 2020 2020 2020 2020 2020 2074 6f6b 656e             token
+00000b70: 5f66 696c 6520 3d20 6f73 2e70 6174 682e  _file = os.path.
+00000b80: 6578 7061 6e64 7573 6572 2874 6f6b 656e  expanduser(token
+00000b90: 5f66 696c 6529 0a20 2020 2020 2020 2020  _file).         
+00000ba0: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+00000bb0: 7420 6f73 2e70 6174 682e 6578 6973 7473  t os.path.exists
+00000bc0: 2874 6f6b 656e 5f66 696c 6529 3a0a 2020  (token_file):.  
+00000bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000be0: 2020 2020 2020 6572 726f 7228 2254 6f6b        error("Tok
+00000bf0: 656e 2066 696c 6520 7061 7468 2064 6f65  en file path doe
+00000c00: 736e 2774 2065 7869 7374 2e20 4c65 6176  sn't exist. Leav
+00000c10: 696e 6722 290a 2020 2020 2020 2020 2020  ing").          
+00000c20: 2020 2020 2020 2020 2020 2020 2020 7379                sy
+00000c30: 732e 6578 6974 2831 290a 2020 2020 2020  s.exit(1).      
+00000c40: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00000c50: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00000c60: 2020 2020 2020 2020 2020 2020 746f 6b65              toke
+00000c70: 6e20 3d20 6f70 656e 2874 6f6b 656e 5f66  n = open(token_f
+00000c80: 696c 6529 2e72 6561 6428 290a 2020 2020  ile).read().    
+00000c90: 2020 2020 2020 2020 2020 2020 7265 6769              regi
+00000ca0: 7374 7279 203d 2073 656c 662e 6f70 7469  stry = self.opti
+00000cb0: 6f6e 732e 6765 7428 2772 6567 6973 7472  ons.get('registr
+00000cc0: 7927 290a 2020 2020 2020 2020 2020 2020  y').            
+00000cd0: 2020 2020 6163 6365 7373 5f6d 6f64 6520      access_mode 
+00000ce0: 3d20 7365 6c66 2e6f 7074 696f 6e73 2e67  = self.options.g
+00000cf0: 6574 2827 6163 6365 7373 5f6d 6f64 6527  et('access_mode'
+00000d00: 2c20 274e 6f64 6550 6f72 7427 290a 2020  , 'NodePort').  
+00000d10: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00000d20: 2061 6363 6573 735f 6d6f 6465 206e 6f74   access_mode not
+00000d30: 2069 6e20 5b27 4578 7465 726e 616c 272c   in ['External',
+00000d40: 2027 4c6f 6164 4261 6c61 6e63 6572 272c   'LoadBalancer',
+00000d50: 2027 4e6f 6465 506f 7274 275d 3a0a 2020   'NodePort']:.  
+00000d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000d70: 2020 6d73 6720 3d20 6622 496e 636f 7272    msg = f"Incorr
+00000d80: 6563 7420 6163 6365 7373 5f6d 6f64 6520  ect access_mode 
+00000d90: 7b61 6363 6573 735f 6d6f 6465 7d2e 2053  {access_mode}. S
+00000da0: 686f 756c 6420 6265 2045 7874 6572 6e61  hould be Externa
+00000db0: 6c2c 204e 6f64 6550 6f72 7420 6f72 204c  l, NodePort or L
+00000dc0: 6f61 6442 616c 616e 6365 7222 0a20 2020  oadBalancer".   
+00000dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000de0: 2065 7272 6f72 286d 7367 290a 2020 2020   error(msg).    
+00000df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000e00: 7379 732e 6578 6974 2831 290a 2020 2020  sys.exit(1).    
+00000e10: 2020 2020 2020 2020 2020 2020 766f 6c75              volu
+00000e20: 6d65 5f6d 6f64 6520 3d20 7365 6c66 2e6f  me_mode = self.o
+00000e30: 7074 696f 6e73 2e67 6574 2827 766f 6c75  ptions.get('volu
+00000e40: 6d65 5f6d 6f64 6527 2c20 2746 696c 6573  me_mode', 'Files
+00000e50: 7973 7465 6d27 290a 2020 2020 2020 2020  ystem').        
+00000e60: 2020 2020 2020 2020 6966 2076 6f6c 756d          if volum
+00000e70: 655f 6d6f 6465 206e 6f74 2069 6e20 5b27  e_mode not in ['
+00000e80: 4669 6c65 7379 7374 656d 272c 2027 426c  Filesystem', 'Bl
+00000e90: 6f63 6b27 5d3a 0a20 2020 2020 2020 2020  ock']:.         
+00000ea0: 2020 2020 2020 2020 2020 206d 7367 203d             msg =
+00000eb0: 2066 2249 6e63 6f72 7265 6374 2076 6f6c   f"Incorrect vol
+00000ec0: 756d 655f 6d6f 6465 207b 766f 6c75 6d65  ume_mode {volume
+00000ed0: 5f6d 6f64 657d 2e20 5368 6f75 6c64 2062  _mode}. Should b
+00000ee0: 6520 4669 6c65 7379 7374 656d 206f 7220  e Filesystem or 
+00000ef0: 426c 6f63 6b22 0a20 2020 2020 2020 2020  Block".         
+00000f00: 2020 2020 2020 2020 2020 2065 7272 6f72             error
+00000f10: 286d 7367 290a 2020 2020 2020 2020 2020  (msg).          
+00000f20: 2020 2020 2020 2020 2020 7379 732e 6578            sys.ex
+00000f30: 6974 2831 290a 2020 2020 2020 2020 2020  it(1).          
+00000f40: 2020 2020 2020 766f 6c75 6d65 5f61 6363        volume_acc
+00000f50: 6573 7320 3d20 7365 6c66 2e6f 7074 696f  ess = self.optio
+00000f60: 6e73 2e67 6574 2827 766f 6c75 6d65 5f61  ns.get('volume_a
+00000f70: 6363 6573 7327 2c20 2752 6561 6457 7269  ccess', 'ReadWri
+00000f80: 7465 4f6e 6365 2729 0a20 2020 2020 2020  teOnce').       
+00000f90: 2020 2020 2020 2020 2069 6620 766f 6c75           if volu
+00000fa0: 6d65 5f61 6363 6573 7320 6e6f 7420 696e  me_access not in
+00000fb0: 205b 2752 6561 6457 7269 7465 4d61 6e79   ['ReadWriteMany
+00000fc0: 272c 2027 5265 6164 5772 6974 654f 6e63  ', 'ReadWriteOnc
+00000fd0: 6527 5d3a 0a20 2020 2020 2020 2020 2020  e']:.           
+00000fe0: 2020 2020 2020 2020 206d 7367 203d 2066           msg = f
+00000ff0: 2249 6e63 6f72 7265 6374 2076 6f6c 756d  "Incorrect volum
+00001000: 655f 6163 6365 7373 207b 766f 6c75 6d65  e_access {volume
+00001010: 5f61 6363 6573 737d 2e20 5368 6f75 6c64  _access}. Should
+00001020: 2062 6520 5265 6164 5772 6974 654f 6e63   be ReadWriteOnc
+00001030: 6520 6f72 2052 6561 6457 7269 7465 4f6e  e or ReadWriteOn
+00001040: 6365 220a 2020 2020 2020 2020 2020 2020  ce".            
+00001050: 2020 2020 2020 2020 6572 726f 7228 6d73          error(ms
+00001060: 6729 0a20 2020 2020 2020 2020 2020 2020  g).             
+00001070: 2020 2020 2020 2073 7973 2e65 7869 7428         sys.exit(
+00001080: 3129 0a20 2020 2020 2020 2020 2020 2020  1).             
+00001090: 2020 2068 6172 7665 7374 6572 203d 2073     harvester = s
+000010a0: 656c 662e 6f70 7469 6f6e 732e 6765 7428  elf.options.get(
+000010b0: 2768 6172 7665 7374 6572 272c 2046 616c  'harvester', Fal
+000010c0: 7365 290a 2020 2020 2020 2020 2020 2020  se).            
+000010d0: 2020 2020 656d 6265 645f 7573 6572 6461      embed_userda
+000010e0: 7461 203d 2073 656c 662e 6f70 7469 6f6e  ta = self.option
+000010f0: 732e 6765 7428 2765 6d62 6564 5f75 7365  s.get('embed_use
+00001100: 7264 6174 6127 2c20 4661 6c73 6529 0a20  rdata', False). 
+00001110: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00001120: 6972 7374 5f63 6f6e 7375 6d65 7220 3d20  irst_consumer = 
+00001130: 7365 6c66 2e6f 7074 696f 6e73 2e67 6574  self.options.get
+00001140: 2827 6669 7273 745f 636f 6e73 756d 6572  ('first_consumer
+00001150: 272c 2046 616c 7365 290a 2020 2020 2020  ', False).      
+00001160: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
+00001170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001180: 2020 2066 726f 6d20 6b76 6972 742e 7072     from kvirt.pr
+00001190: 6f76 6964 6572 732e 6b75 6265 7669 7274  oviders.kubevirt
+000011a0: 2069 6d70 6f72 7420 4b75 6265 7669 7274   import Kubevirt
+000011b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000011c0: 2065 7863 6570 743a 0a20 2020 2020 2020   except:.       
+000011d0: 2020 2020 2020 2020 2020 2020 2064 6570               dep
+000011e0: 656e 6465 6e63 795f 6572 726f 7228 276b  endency_error('k
+000011f0: 7562 6576 6972 7427 290a 2020 2020 2020  ubevirt').      
+00001200: 2020 2020 2020 2020 2020 6b20 3d20 4b75            k = Ku
+00001210: 6265 7669 7274 2863 6f6e 7465 7874 3d63  bevirt(context=c
+00001220: 6f6e 7465 7874 2c20 746f 6b65 6e3d 746f  ontext, token=to
+00001230: 6b65 6e2c 2063 615f 6669 6c65 3d63 615f  ken, ca_file=ca_
+00001240: 6669 6c65 2c20 686f 7374 3d73 656c 662e  file, host=self.
+00001250: 686f 7374 2c0a 2020 2020 2020 2020 2020  host,.          
+00001260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001270: 2020 2070 6f72 743d 3634 3433 2c20 7573     port=6443, us
+00001280: 6572 3d73 656c 662e 7573 6572 2c20 6465  er=self.user, de
+00001290: 6275 673d 6465 6275 672c 206e 616d 6573  bug=debug, names
+000012a0: 7061 6365 3d6e 616d 6573 7061 6365 2c0a  pace=namespace,.
+000012b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000012c0: 2020 2020 2020 2020 2020 2020 2064 6174               dat
+000012d0: 6176 6f6c 756d 6573 3d64 6174 6176 6f6c  avolumes=datavol
+000012e0: 756d 6573 2c20 6469 736b 5f68 6f74 706c  umes, disk_hotpl
+000012f0: 7567 3d64 6973 6b5f 686f 7470 6c75 672c  ug=disk_hotplug,
+00001300: 2072 6561 6477 7269 7465 6d61 6e79 3d72   readwritemany=r
+00001310: 6561 6477 7269 7465 6d61 6e79 2c0a 2020  eadwritemany,.  
+00001320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001330: 2020 2020 2020 2020 2020 2072 6567 6973             regis
+00001340: 7472 793d 7265 6769 7374 7279 2c20 6163  try=registry, ac
+00001350: 6365 7373 5f6d 6f64 653d 6163 6365 7373  cess_mode=access
+00001360: 5f6d 6f64 652c 2076 6f6c 756d 655f 6d6f  _mode, volume_mo
+00001370: 6465 3d76 6f6c 756d 655f 6d6f 6465 2c0a  de=volume_mode,.
+00001380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001390: 2020 2020 2020 2020 2020 2020 2076 6f6c               vol
+000013a0: 756d 655f 6163 6365 7373 3d76 6f6c 756d  ume_access=volum
+000013b0: 655f 6163 6365 7373 2c20 6861 7276 6573  e_access, harves
+000013c0: 7465 723d 6861 7276 6573 7465 722c 2065  ter=harvester, e
+000013d0: 6d62 6564 5f75 7365 7264 6174 613d 656d  mbed_userdata=em
+000013e0: 6265 645f 7573 6572 6461 7461 2c0a 2020  bed_userdata,.  
+000013f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001400: 2020 2020 2020 2020 2020 2066 6972 7374             first
+00001410: 5f63 6f6e 7375 6d65 723d 6669 7273 745f  _consumer=first_
+00001420: 636f 6e73 756d 6572 2c20 6b75 6265 636f  consumer, kubeco
+00001430: 6e66 6967 5f66 696c 653d 6b75 6265 636f  nfig_file=kubeco
+00001440: 6e66 6967 5f66 696c 6529 0a20 2020 2020  nfig_file).     
+00001450: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00001460: 686f 7374 203d 206b 2e68 6f73 740a 2020  host = k.host.  
+00001470: 2020 2020 2020 2020 2020 656c 6966 2073            elif s
+00001480: 656c 662e 7479 7065 203d 3d20 2767 6370  elf.type == 'gcp
+00001490: 273a 0a20 2020 2020 2020 2020 2020 2020  ':.             
+000014a0: 2020 2063 7265 6465 6e74 6961 6c73 203d     credentials =
+000014b0: 2073 656c 662e 6f70 7469 6f6e 732e 6765   self.options.ge
+000014c0: 7428 2763 7265 6465 6e74 6961 6c73 2729  t('credentials')
+000014d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000014e0: 2069 6620 6372 6564 656e 7469 616c 7320   if credentials 
+000014f0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+00001500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001510: 206f 732e 656e 7669 726f 6e5b 2747 4f4f   os.environ['GOO
+00001520: 474c 455f 4150 504c 4943 4154 494f 4e5f  GLE_APPLICATION_
+00001530: 4352 4544 454e 5449 414c 5327 5d20 3d20  CREDENTIALS'] = 
+00001540: 6f73 2e70 6174 682e 6578 7061 6e64 7573  os.path.expandus
+00001550: 6572 2863 7265 6465 6e74 6961 6c73 290a  er(credentials).
+00001560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001570: 656c 6966 2027 474f 4f47 4c45 5f41 5050  elif 'GOOGLE_APP
+00001580: 4c49 4341 5449 4f4e 5f43 5245 4445 4e54  LICATION_CREDENT
+00001590: 4941 4c53 2720 6e6f 7420 696e 206f 732e  IALS' not in os.
+000015a0: 656e 7669 726f 6e3a 0a20 2020 2020 2020  environ:.       
+000015b0: 2020 2020 2020 2020 2020 2020 2065 7272               err
+000015c0: 6f72 2822 7365 7420 474f 4f47 4c45 5f41  or("set GOOGLE_A
+000015d0: 5050 4c49 4341 5449 4f4e 5f43 5245 4445  PPLICATION_CREDE
+000015e0: 4e54 4941 4c53 2076 6172 6961 626c 652e  NTIALS variable.
+000015f0: 4c65 6176 696e 672e 2e2e 2229 0a20 2020  Leaving...").   
+00001600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001610: 2073 7973 2e65 7869 7428 3129 0a20 2020   sys.exit(1).   
+00001620: 2020 2020 2020 2020 2020 2020 2070 726f               pro
+00001630: 6a65 6374 203d 2073 656c 662e 6f70 7469  ject = self.opti
+00001640: 6f6e 732e 6765 7428 2770 726f 6a65 6374  ons.get('project
+00001650: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
+00001660: 2020 2069 6620 7072 6f6a 6563 7420 6973     if project is
+00001670: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00001680: 2020 2020 2020 2020 2020 2065 7272 6f72             error
+00001690: 2822 4d69 7373 696e 6720 7072 6f6a 6563  ("Missing projec
+000016a0: 7420 696e 2074 6865 2063 6f6e 6669 6775  t in the configu
+000016b0: 7261 7469 6f6e 2e20 4c65 6176 696e 6722  ration. Leaving"
+000016c0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000016d0: 2020 2020 2020 7379 732e 6578 6974 2831        sys.exit(1
+000016e0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000016f0: 2020 7a6f 6e65 203d 2073 656c 662e 6f70    zone = self.op
+00001700: 7469 6f6e 732e 6765 7428 277a 6f6e 6527  tions.get('zone'
+00001710: 2c20 2765 7572 6f70 652d 7765 7374 312d  , 'europe-west1-
+00001720: 6227 2920 6966 207a 6f6e 6520 6973 204e  b') if zone is N
+00001730: 6f6e 6520 656c 7365 207a 6f6e 650a 2020  one else zone.  
+00001740: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00001750: 6769 6f6e 203d 2073 656c 662e 6f70 7469  gion = self.opti
+00001760: 6f6e 732e 6765 7428 2772 6567 696f 6e27  ons.get('region'
+00001770: 2920 6966 2072 6567 696f 6e20 6973 204e  ) if region is N
+00001780: 6f6e 6520 656c 7365 2072 6567 696f 6e0a  one else region.
+00001790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000017a0: 7265 6769 6f6e 203d 207a 6f6e 655b 3a2d  region = zone[:-
+000017b0: 325d 2069 6620 7265 6769 6f6e 2069 7320  2] if region is 
+000017c0: 4e6f 6e65 2065 6c73 6520 7265 6769 6f6e  None else region
+000017d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000017e0: 2070 7562 6c69 6320 3d20 7365 6c66 2e6f   public = self.o
+000017f0: 7074 696f 6e73 2e67 6574 2827 7075 626c  ptions.get('publ
+00001800: 6963 272c 2054 7275 6529 0a20 2020 2020  ic', True).     
+00001810: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
+00001820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001830: 2020 2020 6672 6f6d 206b 7669 7274 2e70      from kvirt.p
+00001840: 726f 7669 6465 7273 2e67 6370 2069 6d70  roviders.gcp imp
+00001850: 6f72 7420 4b67 6370 0a20 2020 2020 2020  ort Kgcp.       
+00001860: 2020 2020 2020 2020 2065 7863 6570 743a           except:
+00001870: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00001880: 2020 2020 2064 6570 656e 6465 6e63 795f       dependency_
+00001890: 6572 726f 7228 2767 6370 2729 0a20 2020  error('gcp').   
+000018a0: 2020 2020 2020 2020 2020 2020 206b 203d               k =
+000018b0: 204b 6763 7028 7072 6f6a 6563 742c 207a   Kgcp(project, z
+000018c0: 6f6e 653d 7a6f 6e65 2c20 7265 6769 6f6e  one=zone, region
+000018d0: 3d72 6567 696f 6e2c 2064 6562 7567 3d64  =region, debug=d
+000018e0: 6562 7567 2c20 7075 626c 6963 3d70 7562  ebug, public=pub
+000018f0: 6c69 6329 0a20 2020 2020 2020 2020 2020  lic).           
+00001900: 2020 2020 2073 656c 662e 6f76 6572 7269       self.overri
+00001910: 6465 732e 7570 6461 7465 287b 2770 726f  des.update({'pro
+00001920: 6a65 6374 273a 2070 726f 6a65 6374 7d29  ject': project})
+00001930: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
+00001940: 6620 7365 6c66 2e74 7970 6520 3d3d 2027  f self.type == '
+00001950: 6177 7327 3a0a 2020 2020 2020 2020 2020  aws':.          
+00001960: 2020 2020 2020 6163 6365 7373 5f6b 6579        access_key
+00001970: 5f69 6420 3d20 7365 6c66 2e6f 7074 696f  _id = self.optio
+00001980: 6e73 2e67 6574 2827 6163 6365 7373 5f6b  ns.get('access_k
+00001990: 6579 5f69 6427 290a 2020 2020 2020 2020  ey_id').        
+000019a0: 2020 2020 2020 2020 6163 6365 7373 5f6b          access_k
+000019b0: 6579 5f73 6563 7265 7420 3d20 7365 6c66  ey_secret = self
+000019c0: 2e6f 7074 696f 6e73 2e67 6574 2827 6163  .options.get('ac
+000019d0: 6365 7373 5f6b 6579 5f73 6563 7265 7427  cess_key_secret'
+000019e0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000019f0: 2020 6b65 7970 6169 7220 3d20 7365 6c66    keypair = self
+00001a00: 2e6f 7074 696f 6e73 2e67 6574 2827 6b65  .options.get('ke
+00001a10: 7970 6169 7227 290a 2020 2020 2020 2020  ypair').        
+00001a20: 2020 2020 2020 2020 7365 7373 696f 6e5f          session_
+00001a30: 746f 6b65 6e20 3d20 7365 6c66 2e6f 7074  token = self.opt
+00001a40: 696f 6e73 2e67 6574 2827 7365 7373 696f  ions.get('sessio
+00001a50: 6e5f 746f 6b65 6e27 290a 2020 2020 2020  n_token').      
+00001a60: 2020 2020 2020 2020 2020 7265 6769 6f6e            region
+00001a70: 203d 2073 656c 662e 6f70 7469 6f6e 732e   = self.options.
+00001a80: 6765 7428 2772 6567 696f 6e27 2920 6966  get('region') if
+00001a90: 2072 6567 696f 6e20 6973 204e 6f6e 6520   region is None 
+00001aa0: 656c 7365 2072 6567 696f 6e0a 2020 2020  else region.    
+00001ab0: 2020 2020 2020 2020 2020 2020 6966 2072              if r
+00001ac0: 6567 696f 6e20 6973 204e 6f6e 653a 0a20  egion is None:. 
+00001ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001ae0: 2020 2065 7272 6f72 2822 4d69 7373 696e     error("Missin
+00001af0: 6720 7265 6769 6f6e 2069 6e20 7468 6520  g region in the 
+00001b00: 636f 6e66 6967 7572 6174 696f 6e2e 204c  configuration. L
+00001b10: 6561 7669 6e67 2229 0a20 2020 2020 2020  eaving").       
+00001b20: 2020 2020 2020 2020 2020 2020 2073 7973               sys
+00001b30: 2e65 7869 7428 3129 0a20 2020 2020 2020  .exit(1).       
+00001b40: 2020 2020 2020 2020 2069 6620 6163 6365           if acce
+00001b50: 7373 5f6b 6579 5f69 6420 6973 204e 6f6e  ss_key_id is Non
+00001b60: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00001b70: 2020 2020 2020 2065 7272 6f72 2822 4d69         error("Mi
+00001b80: 7373 696e 6720 6163 6365 7373 5f6b 6579  ssing access_key
+00001b90: 5f69 6420 696e 2074 6865 2063 6f6e 6669  _id in the confi
+00001ba0: 6775 7261 7469 6f6e 2e20 4c65 6176 696e  guration. Leavin
+00001bb0: 6722 290a 2020 2020 2020 2020 2020 2020  g").            
+00001bc0: 2020 2020 2020 2020 7379 732e 6578 6974          sys.exit
+00001bd0: 2831 290a 2020 2020 2020 2020 2020 2020  (1).            
+00001be0: 2020 2020 6966 2061 6363 6573 735f 6b65      if access_ke
+00001bf0: 795f 7365 6372 6574 2069 7320 4e6f 6e65  y_secret is None
+00001c00: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00001c10: 2020 2020 2020 6572 726f 7228 224d 6973        error("Mis
+00001c20: 7369 6e67 2061 6363 6573 735f 6b65 795f  sing access_key_
+00001c30: 7365 6372 6574 2069 6e20 7468 6520 636f  secret in the co
+00001c40: 6e66 6967 7572 6174 696f 6e2e 204c 6561  nfiguration. Lea
+00001c50: 7669 6e67 2229 0a20 2020 2020 2020 2020  ving").         
+00001c60: 2020 2020 2020 2020 2020 2073 7973 2e65             sys.e
+00001c70: 7869 7428 3129 0a20 2020 2020 2020 2020  xit(1).         
+00001c80: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+00001c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001ca0: 6672 6f6d 206b 7669 7274 2e70 726f 7669  from kvirt.provi
+00001cb0: 6465 7273 2e61 7773 2069 6d70 6f72 7420  ders.aws import 
+00001cc0: 4b61 7773 0a20 2020 2020 2020 2020 2020  Kaws.           
+00001cd0: 2020 2020 2065 7863 6570 743a 0a20 2020       except:.   
+00001ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001cf0: 2064 6570 656e 6465 6e63 795f 6572 726f   dependency_erro
+00001d00: 7228 2761 7773 2729 0a20 2020 2020 2020  r('aws').       
+00001d10: 2020 2020 2020 2020 206b 203d 204b 6177           k = Kaw
+00001d20: 7328 6163 6365 7373 5f6b 6579 5f69 643d  s(access_key_id=
+00001d30: 6163 6365 7373 5f6b 6579 5f69 642c 2061  access_key_id, a
+00001d40: 6363 6573 735f 6b65 795f 7365 6372 6574  ccess_key_secret
+00001d50: 3d61 6363 6573 735f 6b65 795f 7365 6372  =access_key_secr
+00001d60: 6574 2c20 7265 6769 6f6e 3d72 6567 696f  et, region=regio
+00001d70: 6e2c 0a20 2020 2020 2020 2020 2020 2020  n,.             
+00001d80: 2020 2020 2020 2020 2020 2020 6465 6275              debu
+00001d90: 673d 6465 6275 672c 206b 6579 7061 6972  g=debug, keypair
+00001da0: 3d6b 6579 7061 6972 2c20 7365 7373 696f  =keypair, sessio
+00001db0: 6e5f 746f 6b65 6e3d 7365 7373 696f 6e5f  n_token=session_
+00001dc0: 746f 6b65 6e29 0a20 2020 2020 2020 2020  token).         
+00001dd0: 2020 2065 6c69 6620 7365 6c66 2e74 7970     elif self.typ
+00001de0: 6520 3d3d 2027 6962 6d27 3a0a 2020 2020  e == 'ibm':.    
+00001df0: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+00001e00: 656e 2873 656c 662e 6f70 7469 6f6e 7329  en(self.options)
+00001e10: 203d 3d20 313a 0a20 2020 2020 2020 2020   == 1:.         
+00001e20: 2020 2020 2020 2020 2020 2068 6f6d 6520             home 
+00001e30: 3d20 6f73 2e65 6e76 6972 6f6e 5b27 484f  = os.environ['HO
+00001e40: 4d45 275d 0a20 2020 2020 2020 2020 2020  ME'].           
+00001e50: 2020 2020 2020 2020 2069 616d 5f61 7069           iam_api
+00001e60: 5f6b 6579 2c20 7265 6769 6f6e 2c20 7a6f  _key, region, zo
+00001e70: 6e65 2c20 7670 6320 3d20 4e6f 6e65 2c20  ne, vpc = None, 
+00001e80: 4e6f 6e65 2c20 4e6f 6e65 2c20 4e6f 6e65  None, None, None
 00001e90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00001ea0: 2020 2020 2069 616d 5f61 7069 5f6b 6579       iam_api_key
-00001eb0: 2c20 7265 6769 6f6e 2c20 7a6f 6e65 2c20  , region, zone, 
-00001ec0: 7670 6320 3d20 4e6f 6e65 2c20 4e6f 6e65  vpc = None, None
-00001ed0: 2c20 4e6f 6e65 2c20 4e6f 6e65 0a20 2020  , None, None.   
-00001ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001ef0: 2063 6f73 5f61 7069 5f6b 6579 2c20 636f   cos_api_key, co
-00001f00: 735f 7265 736f 7572 6365 5f69 6e73 7461  s_resource_insta
-00001f10: 6e63 655f 6964 2c20 6369 735f 7265 736f  nce_id, cis_reso
-00001f20: 7572 6365 5f69 6e73 7461 6e63 655f 6964  urce_instance_id
-00001f30: 203d 204e 6f6e 652c 204e 6f6e 652c 204e   = None, None, N
-00001f40: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-00001f50: 2020 2020 2020 2020 696d 706f 7274 2063          import c
-00001f60: 6f6e 6669 6770 6172 7365 720a 2020 2020  onfigparser.    
-00001f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001f80: 6966 206f 732e 7061 7468 2e65 7869 7374  if os.path.exist
-00001f90: 7328 6622 7b68 6f6d 657d 2f2e 6962 6d2f  s(f"{home}/.ibm/
-00001fa0: 6372 6564 656e 7469 616c 7322 293a 0a20  credentials"):. 
-00001fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001fc0: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+00001ea0: 2020 2020 2063 6f73 5f61 7069 5f6b 6579       cos_api_key
+00001eb0: 2c20 636f 735f 7265 736f 7572 6365 5f69  , cos_resource_i
+00001ec0: 6e73 7461 6e63 655f 6964 2c20 6369 735f  nstance_id, cis_
+00001ed0: 7265 736f 7572 6365 5f69 6e73 7461 6e63  resource_instanc
+00001ee0: 655f 6964 203d 204e 6f6e 652c 204e 6f6e  e_id = None, Non
+00001ef0: 652c 204e 6f6e 650a 2020 2020 2020 2020  e, None.        
+00001f00: 2020 2020 2020 2020 2020 2020 696d 706f              impo
+00001f10: 7274 2063 6f6e 6669 6770 6172 7365 720a  rt configparser.
+00001f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001f30: 2020 2020 6966 206f 732e 7061 7468 2e65      if os.path.e
+00001f40: 7869 7374 7328 6622 7b68 6f6d 657d 2f2e  xists(f"{home}/.
+00001f50: 6962 6d2f 6372 6564 656e 7469 616c 7322  ibm/credentials"
+00001f60: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00001f70: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
+00001f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001f90: 2020 2020 2020 2020 2020 2020 6372 6564              cred
+00001fa0: 636f 6e66 6967 203d 2063 6f6e 6669 6770  config = configp
+00001fb0: 6172 7365 722e 436f 6e66 6967 5061 7273  arser.ConfigPars
+00001fc0: 6572 2829 0a20 2020 2020 2020 2020 2020  er().           
 00001fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001fe0: 2020 2020 2020 2020 6372 6564 636f 6e66          credconf
-00001ff0: 6967 203d 2063 6f6e 6669 6770 6172 7365  ig = configparse
-00002000: 722e 436f 6e66 6967 5061 7273 6572 2829  r.ConfigParser()
-00002010: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002020: 2020 2020 2020 2020 2020 2020 2063 7265               cre
-00002030: 6463 6f6e 6669 672e 7265 6164 2866 227b  dconfig.read(f"{
-00002040: 686f 6d65 7d2f 2e69 626d 2f63 7265 6465  home}/.ibm/crede
-00002050: 6e74 6961 6c73 2229 0a20 2020 2020 2020  ntials").       
-00002060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002070: 2020 2020 2069 6620 2764 6566 6175 6c74       if 'default
-00002080: 2720 6e6f 7420 696e 2063 7265 6463 6f6e  ' not in credcon
-00002090: 6669 673a 0a20 2020 2020 2020 2020 2020  fig:.           
-000020a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000020b0: 2020 2020 2065 7272 6f72 280a 2020 2020       error(.    
-000020c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000020d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000020e0: 224d 6973 7369 6e67 2064 6566 6175 6c74  "Missing default
-000020f0: 2073 6563 7469 6f6e 2069 6e20 7e2f 2e69   section in ~/.i
-00002100: 626d 2f63 7265 6465 6e74 6961 6c73 2066  bm/credentials f
-00002110: 696c 652e 204c 6561 7669 6e67 2229 0a20  ile. Leaving"). 
-00002120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002130: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00002140: 7973 2e65 7869 7428 3129 0a20 2020 2020  ys.exit(1).     
+00001fe0: 2063 7265 6463 6f6e 6669 672e 7265 6164   credconfig.read
+00001ff0: 2866 227b 686f 6d65 7d2f 2e69 626d 2f63  (f"{home}/.ibm/c
+00002000: 7265 6465 6e74 6961 6c73 2229 0a20 2020  redentials").   
+00002010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002020: 2020 2020 2020 2020 2069 6620 2764 6566           if 'def
+00002030: 6175 6c74 2720 6e6f 7420 696e 2063 7265  ault' not in cre
+00002040: 6463 6f6e 6669 673a 0a20 2020 2020 2020  dconfig:.       
+00002050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002060: 2020 2020 2020 2020 2065 7272 6f72 280a           error(.
+00002070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002090: 2020 2020 224d 6973 7369 6e67 2064 6566      "Missing def
+000020a0: 6175 6c74 2073 6563 7469 6f6e 2069 6e20  ault section in 
+000020b0: 7e2f 2e69 626d 2f63 7265 6465 6e74 6961  ~/.ibm/credentia
+000020c0: 6c73 2066 696c 652e 204c 6561 7669 6e67  ls file. Leaving
+000020d0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+000020e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000020f0: 2020 2073 7973 2e65 7869 7428 3129 0a20     sys.exit(1). 
+00002100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002110: 2020 2020 2020 2020 2020 2069 6620 2769             if 'i
+00002120: 616d 5f61 7069 5f6b 6579 2720 696e 2063  am_api_key' in c
+00002130: 7265 6463 6f6e 6669 675b 2764 6566 6175  redconfig['defau
+00002140: 6c74 275d 3a0a 2020 2020 2020 2020 2020  lt']:.          
 00002150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002160: 2020 2020 2020 2069 6620 2769 616d 5f61         if 'iam_a
-00002170: 7069 5f6b 6579 2720 696e 2063 7265 6463  pi_key' in credc
-00002180: 6f6e 6669 675b 2764 6566 6175 6c74 275d  onfig['default']
-00002190: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00002160: 2020 2020 2020 6961 6d5f 6170 695f 6b65        iam_api_ke
+00002170: 7920 3d20 6372 6564 636f 6e66 6967 5b27  y = credconfig['
+00002180: 6465 6661 756c 7427 5d5b 2769 616d 5f61  default']['iam_a
+00002190: 7069 5f6b 6579 275d 0a20 2020 2020 2020  pi_key'].       
 000021a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000021b0: 2020 6961 6d5f 6170 695f 6b65 7920 3d20    iam_api_key = 
-000021c0: 6372 6564 636f 6e66 6967 5b27 6465 6661  credconfig['defa
-000021d0: 756c 7427 5d5b 2769 616d 5f61 7069 5f6b  ult']['iam_api_k
-000021e0: 6579 275d 0a20 2020 2020 2020 2020 2020  ey'].           
+000021b0: 2020 2020 2069 6620 2761 6363 6573 735f       if 'access_
+000021c0: 6b65 795f 6964 2720 696e 2063 7265 6463  key_id' in credc
+000021d0: 6f6e 6669 675b 2764 6566 6175 6c74 275d  onfig['default']
+000021e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
 000021f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002200: 2069 6620 2761 6363 6573 735f 6b65 795f   if 'access_key_
-00002210: 6964 2720 696e 2063 7265 6463 6f6e 6669  id' in credconfi
-00002220: 675b 2764 6566 6175 6c74 275d 3a0a 2020  g['default']:.  
-00002230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002240: 2020 2020 2020 2020 2020 2020 2020 636f                co
-00002250: 735f 6170 695f 6b65 7920 3d20 6372 6564  s_api_key = cred
-00002260: 636f 6e66 6967 5b27 6465 6661 756c 7427  config['default'
-00002270: 5d5b 2761 6363 6573 735f 6b65 795f 6964  ]['access_key_id
-00002280: 275d 0a20 2020 2020 2020 2020 2020 2020  '].             
-00002290: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000022a0: 6620 2773 6563 7265 745f 6163 6365 7373  f 'secret_access
-000022b0: 5f6b 6579 2720 696e 2063 7265 6463 6f6e  _key' in credcon
-000022c0: 6669 675b 2764 6566 6175 6c74 275d 3a0a  fig['default']:.
-000022d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000022e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000022f0: 636f 735f 7265 736f 7572 6365 5f69 6e73  cos_resource_ins
-00002300: 7461 6e63 655f 6964 203d 2063 7265 6463  tance_id = credc
-00002310: 6f6e 6669 675b 2764 6566 6175 6c74 275d  onfig['default']
-00002320: 5b27 7365 6372 6574 5f61 6363 6573 735f  ['secret_access_
-00002330: 6b65 7927 5d0a 2020 2020 2020 2020 2020  key'].          
-00002340: 2020 2020 2020 2020 2020 2020 2020 6578                ex
-00002350: 6365 7074 3a0a 2020 2020 2020 2020 2020  cept:.          
+00002200: 2020 636f 735f 6170 695f 6b65 7920 3d20    cos_api_key = 
+00002210: 6372 6564 636f 6e66 6967 5b27 6465 6661  credconfig['defa
+00002220: 756c 7427 5d5b 2761 6363 6573 735f 6b65  ult']['access_ke
+00002230: 795f 6964 275d 0a20 2020 2020 2020 2020  y_id'].         
+00002240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002250: 2020 2069 6620 2773 6563 7265 745f 6163     if 'secret_ac
+00002260: 6365 7373 5f6b 6579 2720 696e 2063 7265  cess_key' in cre
+00002270: 6463 6f6e 6669 675b 2764 6566 6175 6c74  dconfig['default
+00002280: 275d 3a0a 2020 2020 2020 2020 2020 2020  ']:.            
+00002290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000022a0: 2020 2020 636f 735f 7265 736f 7572 6365      cos_resource
+000022b0: 5f69 6e73 7461 6e63 655f 6964 203d 2063  _instance_id = c
+000022c0: 7265 6463 6f6e 6669 675b 2764 6566 6175  redconfig['defau
+000022d0: 6c74 275d 5b27 7365 6372 6574 5f61 6363  lt']['secret_acc
+000022e0: 6573 735f 6b65 7927 5d0a 2020 2020 2020  ess_key'].      
+000022f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002300: 2020 6578 6365 7074 3a0a 2020 2020 2020    except:.      
+00002310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002320: 2020 2020 2020 6572 726f 7228 2243 6f75        error("Cou
+00002330: 646c 6e27 7420 7061 7273 6520 7e2f 2e69  dln't parse ~/.i
+00002340: 626d 2f63 7265 6465 6e74 6961 6c73 2066  bm/credentials f
+00002350: 696c 652e 204c 6561 7669 6e67 2229 0a20  ile. Leaving"). 
 00002360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002370: 2020 6572 726f 7228 2243 6f75 646c 6e27    error("Coudln'
-00002380: 7420 7061 7273 6520 7e2f 2e69 626d 2f63  t parse ~/.ibm/c
-00002390: 7265 6465 6e74 6961 6c73 2066 696c 652e  redentials file.
-000023a0: 204c 6561 7669 6e67 2229 0a20 2020 2020   Leaving").     
-000023b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000023c0: 2020 2020 2020 2073 7973 2e65 7869 7428         sys.exit(
-000023d0: 3129 0a20 2020 2020 2020 2020 2020 2020  1).             
-000023e0: 2020 2020 2020 2069 6620 6f73 2e70 6174         if os.pat
-000023f0: 682e 6578 6973 7473 2866 227b 686f 6d65  h.exists(f"{home
-00002400: 7d2f 2e69 626d 2f63 6f6e 6669 6722 293a  }/.ibm/config"):
-00002410: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002420: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
+00002370: 2020 2020 2020 2020 2020 2073 7973 2e65             sys.e
+00002380: 7869 7428 3129 0a20 2020 2020 2020 2020  xit(1).         
+00002390: 2020 2020 2020 2020 2020 2069 6620 6f73             if os
+000023a0: 2e70 6174 682e 6578 6973 7473 2866 227b  .path.exists(f"{
+000023b0: 686f 6d65 7d2f 2e69 626d 2f63 6f6e 6669  home}/.ibm/confi
+000023c0: 6722 293a 0a20 2020 2020 2020 2020 2020  g"):.           
+000023d0: 2020 2020 2020 2020 2020 2020 2074 7279               try
+000023e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000023f0: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00002400: 6e66 636f 6e66 6967 203d 2063 6f6e 6669  nfconfig = confi
+00002410: 6770 6172 7365 722e 436f 6e66 6967 5061  gparser.ConfigPa
+00002420: 7273 6572 2829 0a20 2020 2020 2020 2020  rser().         
 00002430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002440: 2020 2020 2020 2020 2020 636f 6e66 636f            confco
-00002450: 6e66 6967 203d 2063 6f6e 6669 6770 6172  nfig = configpar
-00002460: 7365 722e 436f 6e66 6967 5061 7273 6572  ser.ConfigParser
-00002470: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
-00002480: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00002490: 6f6e 6663 6f6e 6669 672e 7265 6164 2866  onfconfig.read(f
-000024a0: 227b 686f 6d65 7d2f 2e69 626d 2f63 6f6e  "{home}/.ibm/con
-000024b0: 6669 6722 290a 2020 2020 2020 2020 2020  fig").          
-000024c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000024d0: 2020 6966 2027 6465 6661 756c 7427 206e    if 'default' n
-000024e0: 6f74 2069 6e20 636f 6e66 636f 6e66 6967  ot in confconfig
-000024f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00002500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002510: 2020 6572 726f 7228 0a20 2020 2020 2020    error(.       
-00002520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002530: 2020 2020 2020 2020 2020 2020 2022 4d69               "Mi
-00002540: 7373 696e 6720 6465 6661 756c 7420 7365  ssing default se
-00002550: 6374 696f 6e20 696e 207e 2f2e 6962 6d2f  ction in ~/.ibm/
-00002560: 636f 6e66 6967 2066 696c 652e 204c 6561  config file. Lea
-00002570: 7669 6e67 2229 0a20 2020 2020 2020 2020  ving").         
-00002580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002590: 2020 2020 2020 2073 7973 2e65 7869 7428         sys.exit(
-000025a0: 3129 0a20 2020 2020 2020 2020 2020 2020  1).             
-000025b0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000025c0: 6620 2769 616d 5f61 7069 5f6b 6579 2720  f 'iam_api_key' 
-000025d0: 696e 2063 6f6e 6663 6f6e 6669 675b 2764  in confconfig['d
-000025e0: 6566 6175 6c74 275d 3a0a 2020 2020 2020  efault']:.      
-000025f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002600: 2020 2020 2020 2020 2020 6961 6d5f 6170            iam_ap
-00002610: 695f 6b65 7920 3d20 636f 6e66 636f 6e66  i_key = confconf
-00002620: 6967 5b27 6465 6661 756c 7427 5d5b 2769  ig['default']['i
-00002630: 616d 5f61 7069 5f6b 6579 275d 0a20 2020  am_api_key'].   
+00002440: 2020 2063 6f6e 6663 6f6e 6669 672e 7265     confconfig.re
+00002450: 6164 2866 227b 686f 6d65 7d2f 2e69 626d  ad(f"{home}/.ibm
+00002460: 2f63 6f6e 6669 6722 290a 2020 2020 2020  /config").      
+00002470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002480: 2020 2020 2020 6966 2027 6465 6661 756c        if 'defaul
+00002490: 7427 206e 6f74 2069 6e20 636f 6e66 636f  t' not in confco
+000024a0: 6e66 6967 3a0a 2020 2020 2020 2020 2020  nfig:.          
+000024b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000024c0: 2020 2020 2020 6572 726f 7228 0a20 2020        error(.   
+000024d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000024e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000024f0: 2022 4d69 7373 696e 6720 6465 6661 756c   "Missing defaul
+00002500: 7420 7365 6374 696f 6e20 696e 207e 2f2e  t section in ~/.
+00002510: 6962 6d2f 636f 6e66 6967 2066 696c 652e  ibm/config file.
+00002520: 204c 6561 7669 6e67 2229 0a20 2020 2020   Leaving").     
+00002530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002540: 2020 2020 2020 2020 2020 2073 7973 2e65             sys.e
+00002550: 7869 7428 3129 0a20 2020 2020 2020 2020  xit(1).         
+00002560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002570: 2020 2069 6620 2769 616d 5f61 7069 5f6b     if 'iam_api_k
+00002580: 6579 2720 696e 2063 6f6e 6663 6f6e 6669  ey' in confconfi
+00002590: 675b 2764 6566 6175 6c74 275d 3a0a 2020  g['default']:.  
+000025a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000025b0: 2020 2020 2020 2020 2020 2020 2020 6961                ia
+000025c0: 6d5f 6170 695f 6b65 7920 3d20 636f 6e66  m_api_key = conf
+000025d0: 636f 6e66 6967 5b27 6465 6661 756c 7427  config['default'
+000025e0: 5d5b 2769 616d 5f61 7069 5f6b 6579 275d  ]['iam_api_key']
+000025f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00002600: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00002610: 2761 6363 6573 735f 6b65 795f 6964 2720  'access_key_id' 
+00002620: 696e 2063 6f6e 6663 6f6e 6669 675b 2764  in confconfig['d
+00002630: 6566 6175 6c74 275d 3a0a 2020 2020 2020  efault']:.      
 00002640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002650: 2020 2020 2020 2020 2069 6620 2761 6363           if 'acc
-00002660: 6573 735f 6b65 795f 6964 2720 696e 2063  ess_key_id' in c
-00002670: 6f6e 6663 6f6e 6669 675b 2764 6566 6175  onfconfig['defau
-00002680: 6c74 275d 3a0a 2020 2020 2020 2020 2020  lt']:.          
+00002650: 2020 2020 2020 2020 2020 636f 735f 6170            cos_ap
+00002660: 695f 6b65 7920 3d20 636f 6e66 636f 6e66  i_key = confconf
+00002670: 6967 5b27 6465 6661 756c 7427 5d5b 2761  ig['default']['a
+00002680: 6363 6573 735f 6b65 795f 6964 275d 0a20  ccess_key_id']. 
 00002690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000026a0: 2020 2020 2020 636f 735f 6170 695f 6b65        cos_api_ke
-000026b0: 7920 3d20 636f 6e66 636f 6e66 6967 5b27  y = confconfig['
-000026c0: 6465 6661 756c 7427 5d5b 2761 6363 6573  default']['acces
-000026d0: 735f 6b65 795f 6964 275d 0a20 2020 2020  s_key_id'].     
+000026a0: 2020 2020 2020 2020 2020 2069 6620 2773             if 's
+000026b0: 6563 7265 745f 6163 6365 7373 5f6b 6579  ecret_access_key
+000026c0: 2720 696e 2063 6f6e 6663 6f6e 6669 675b  ' in confconfig[
+000026d0: 2764 6566 6175 6c74 275d 3a0a 2020 2020  'default']:.    
 000026e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000026f0: 2020 2020 2020 2069 6620 2773 6563 7265         if 'secre
-00002700: 745f 6163 6365 7373 5f6b 6579 2720 696e  t_access_key' in
-00002710: 2063 6f6e 6663 6f6e 6669 675b 2764 6566   confconfig['def
-00002720: 6175 6c74 275d 3a0a 2020 2020 2020 2020  ault']:.        
-00002730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002740: 2020 2020 2020 2020 636f 735f 7265 736f          cos_reso
-00002750: 7572 6365 5f69 6e73 7461 6e63 655f 6964  urce_instance_id
-00002760: 203d 2063 6f6e 6663 6f6e 6669 675b 2764   = confconfig['d
-00002770: 6566 6175 6c74 275d 5b27 7365 6372 6574  efault']['secret
-00002780: 5f61 6363 6573 735f 6b65 7927 5d0a 2020  _access_key'].  
+000026f0: 2020 2020 2020 2020 2020 2020 636f 735f              cos_
+00002700: 7265 736f 7572 6365 5f69 6e73 7461 6e63  resource_instanc
+00002710: 655f 6964 203d 2063 6f6e 6663 6f6e 6669  e_id = confconfi
+00002720: 675b 2764 6566 6175 6c74 275d 5b27 7365  g['default']['se
+00002730: 6372 6574 5f61 6363 6573 735f 6b65 7927  cret_access_key'
+00002740: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+00002750: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00002760: 2027 7265 6769 6f6e 2720 696e 2063 6f6e   'region' in con
+00002770: 6663 6f6e 6669 675b 2764 6566 6175 6c74  fconfig['default
+00002780: 275d 3a0a 2020 2020 2020 2020 2020 2020  ']:.            
 00002790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000027a0: 2020 2020 2020 2020 2020 6966 2027 7265            if 're
-000027b0: 6769 6f6e 2720 696e 2063 6f6e 6663 6f6e  gion' in confcon
-000027c0: 6669 675b 2764 6566 6175 6c74 275d 3a0a  fig['default']:.
+000027a0: 2020 2020 7265 6769 6f6e 203d 2063 6f6e      region = con
+000027b0: 6663 6f6e 6669 675b 2764 6566 6175 6c74  fconfig['default
+000027c0: 275d 5b27 7265 6769 6f6e 275d 0a20 2020  ']['region'].   
 000027d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000027e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000027f0: 7265 6769 6f6e 203d 2063 6f6e 6663 6f6e  region = confcon
-00002800: 6669 675b 2764 6566 6175 6c74 275d 5b27  fig['default']['
-00002810: 7265 6769 6f6e 275d 0a20 2020 2020 2020  region'].       
-00002820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002830: 2020 2020 2069 6620 277a 6f6e 6527 2069       if 'zone' i
-00002840: 6e20 636f 6e66 636f 6e66 6967 5b27 6465  n confconfig['de
-00002850: 6661 756c 7427 5d3a 0a20 2020 2020 2020  fault']:.       
-00002860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002870: 2020 2020 2020 2020 207a 6f6e 6520 3d20           zone = 
-00002880: 636f 6e66 636f 6e66 6967 5b27 6465 6661  confconfig['defa
-00002890: 756c 7427 5d5b 277a 6f6e 6527 5d0a 2020  ult']['zone'].  
+000027e0: 2020 2020 2020 2020 2069 6620 277a 6f6e           if 'zon
+000027f0: 6527 2069 6e20 636f 6e66 636f 6e66 6967  e' in confconfig
+00002800: 5b27 6465 6661 756c 7427 5d3a 0a20 2020  ['default']:.   
+00002810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002820: 2020 2020 2020 2020 2020 2020 207a 6f6e               zon
+00002830: 6520 3d20 636f 6e66 636f 6e66 6967 5b27  e = confconfig['
+00002840: 6465 6661 756c 7427 5d5b 277a 6f6e 6527  default']['zone'
+00002850: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+00002860: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00002870: 2027 7670 6327 2069 6e20 636f 6e66 636f   'vpc' in confco
+00002880: 6e66 6967 5b27 6465 6661 756c 7427 5d3a  nfig['default']:
+00002890: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 000028a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000028b0: 2020 2020 2020 2020 2020 6966 2027 7670            if 'vp
-000028c0: 6327 2069 6e20 636f 6e66 636f 6e66 6967  c' in confconfig
-000028d0: 5b27 6465 6661 756c 7427 5d3a 0a20 2020  ['default']:.   
-000028e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000028f0: 2020 2020 2020 2020 2020 2020 207a 6f6e               zon
-00002900: 6520 3d20 636f 6e66 636f 6e66 6967 5b27  e = confconfig['
-00002910: 6465 6661 756c 7427 5d5b 2776 7063 275d  default']['vpc']
-00002920: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002930: 2020 2020 2020 2020 2065 7863 6570 743a           except:
-00002940: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002950: 2020 2020 2020 2020 2020 2020 2065 7272               err
-00002960: 6f72 2822 436f 7564 6c6e 2774 2070 6172  or("Coudln't par
-00002970: 7365 207e 2f2e 6962 6d2f 636f 6e66 6967  se ~/.ibm/config
-00002980: 2066 696c 652e 204c 6561 7669 6e67 2229   file. Leaving")
-00002990: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000029a0: 2020 2020 2020 2020 2020 2020 2073 7973               sys
-000029b0: 2e65 7869 7428 3129 0a20 2020 2020 2020  .exit(1).       
-000029c0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-000029d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000029e0: 2020 2069 616d 5f61 7069 5f6b 6579 203d     iam_api_key =
-000029f0: 2073 656c 662e 6f70 7469 6f6e 732e 6765   self.options.ge
-00002a00: 7428 2769 616d 5f61 7069 5f6b 6579 2729  t('iam_api_key')
-00002a10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002a20: 2020 2020 2063 6f73 5f61 7069 5f6b 6579       cos_api_key
-00002a30: 203d 2073 656c 662e 6f70 7469 6f6e 732e   = self.options.
-00002a40: 6765 7428 2763 6f73 5f61 7069 5f6b 6579  get('cos_api_key
-00002a50: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
-00002a60: 2020 2020 2020 2063 6f73 5f72 6573 6f75         cos_resou
-00002a70: 7263 655f 696e 7374 616e 6365 5f69 6420  rce_instance_id 
-00002a80: 3d20 7365 6c66 2e6f 7074 696f 6e73 2e67  = self.options.g
-00002a90: 6574 2827 636f 735f 7265 736f 7572 6365  et('cos_resource
-00002aa0: 5f69 6e73 7461 6e63 655f 6964 2729 0a20  _instance_id'). 
-00002ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002ac0: 2020 2063 6973 5f72 6573 6f75 7263 655f     cis_resource_
-00002ad0: 696e 7374 616e 6365 5f69 6420 3d20 7365  instance_id = se
-00002ae0: 6c66 2e6f 7074 696f 6e73 2e67 6574 2827  lf.options.get('
-00002af0: 6369 735f 7265 736f 7572 6365 5f69 6e73  cis_resource_ins
-00002b00: 7461 6e63 655f 6964 2729 0a20 2020 2020  tance_id').     
-00002b10: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00002b20: 6567 696f 6e20 3d20 7365 6c66 2e6f 7074  egion = self.opt
-00002b30: 696f 6e73 2e67 6574 2827 7265 6769 6f6e  ions.get('region
-00002b40: 2729 2069 6620 7265 6769 6f6e 2069 7320  ') if region is 
-00002b50: 4e6f 6e65 2065 6c73 6520 7265 6769 6f6e  None else region
-00002b60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002b70: 2020 2020 207a 6f6e 6520 3d20 7365 6c66       zone = self
-00002b80: 2e6f 7074 696f 6e73 2e67 6574 2827 7a6f  .options.get('zo
-00002b90: 6e65 2729 2069 6620 7a6f 6e65 2069 7320  ne') if zone is 
-00002ba0: 4e6f 6e65 2065 6c73 6520 7a6f 6e65 0a20  None else zone. 
-00002bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002bc0: 2020 2076 7063 203d 2073 656c 662e 6f70     vpc = self.op
-00002bd0: 7469 6f6e 732e 6765 7428 2776 7063 2729  tions.get('vpc')
-00002be0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002bf0: 2069 6620 6961 6d5f 6170 695f 6b65 7920   if iam_api_key 
-00002c00: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-00002c10: 2020 2020 2020 2020 2020 2020 2065 7272               err
-00002c20: 6f72 2822 4d69 7373 696e 6720 6961 6d5f  or("Missing iam_
-00002c30: 6170 695f 6b65 7920 696e 2074 6865 2063  api_key in the c
-00002c40: 6f6e 6669 6775 7261 7469 6f6e 2e20 4c65  onfiguration. Le
-00002c50: 6176 696e 6722 290a 2020 2020 2020 2020  aving").        
-00002c60: 2020 2020 2020 2020 2020 2020 7379 732e              sys.
-00002c70: 6578 6974 2831 290a 2020 2020 2020 2020  exit(1).        
-00002c80: 2020 2020 2020 2020 6966 2072 6567 696f          if regio
-00002c90: 6e20 6973 204e 6f6e 653a 0a20 2020 2020  n is None:.     
-00002ca0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00002cb0: 7272 6f72 2822 4d69 7373 696e 6720 7265  rror("Missing re
-00002cc0: 6769 6f6e 2069 6e20 7468 6520 636f 6e66  gion in the conf
-00002cd0: 6967 7572 6174 696f 6e2e 204c 6561 7669  iguration. Leavi
-00002ce0: 6e67 2229 0a20 2020 2020 2020 2020 2020  ng").           
-00002cf0: 2020 2020 2020 2020 2073 7973 2e65 7869           sys.exi
-00002d00: 7428 3129 0a20 2020 2020 2020 2020 2020  t(1).           
-00002d10: 2020 2020 2066 726f 6d20 6b76 6972 742e       from kvirt.
-00002d20: 7072 6f76 6964 6572 732e 6962 6d20 696d  providers.ibm im
-00002d30: 706f 7274 204b 6962 6d0a 2020 2020 2020  port Kibm.      
-00002d40: 2020 2020 2020 2020 2020 6b20 3d20 4b69            k = Ki
-00002d50: 626d 2869 616d 5f61 7069 5f6b 6579 3d69  bm(iam_api_key=i
-00002d60: 616d 5f61 7069 5f6b 6579 2c20 7265 6769  am_api_key, regi
-00002d70: 6f6e 3d72 6567 696f 6e2c 207a 6f6e 653d  on=region, zone=
-00002d80: 7a6f 6e65 2c20 7670 633d 7670 632c 2064  zone, vpc=vpc, d
-00002d90: 6562 7567 3d64 6562 7567 2c0a 2020 2020  ebug=debug,.    
-00002da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002db0: 2020 2020 2063 6f73 5f61 7069 5f6b 6579       cos_api_key
-00002dc0: 3d63 6f73 5f61 7069 5f6b 6579 2c20 636f  =cos_api_key, co
+000028b0: 207a 6f6e 6520 3d20 636f 6e66 636f 6e66   zone = confconf
+000028c0: 6967 5b27 6465 6661 756c 7427 5d5b 2776  ig['default']['v
+000028d0: 7063 275d 0a20 2020 2020 2020 2020 2020  pc'].           
+000028e0: 2020 2020 2020 2020 2020 2020 2065 7863               exc
+000028f0: 6570 743a 0a20 2020 2020 2020 2020 2020  ept:.           
+00002900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002910: 2065 7272 6f72 2822 436f 7564 6c6e 2774   error("Coudln't
+00002920: 2070 6172 7365 207e 2f2e 6962 6d2f 636f   parse ~/.ibm/co
+00002930: 6e66 6967 2066 696c 652e 204c 6561 7669  nfig file. Leavi
+00002940: 6e67 2229 0a20 2020 2020 2020 2020 2020  ng").           
+00002950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002960: 2073 7973 2e65 7869 7428 3129 0a20 2020   sys.exit(1).   
+00002970: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+00002980: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00002990: 2020 2020 2020 2069 616d 5f61 7069 5f6b         iam_api_k
+000029a0: 6579 203d 2073 656c 662e 6f70 7469 6f6e  ey = self.option
+000029b0: 732e 6765 7428 2769 616d 5f61 7069 5f6b  s.get('iam_api_k
+000029c0: 6579 2729 0a20 2020 2020 2020 2020 2020  ey').           
+000029d0: 2020 2020 2020 2020 2063 6f73 5f61 7069           cos_api
+000029e0: 5f6b 6579 203d 2073 656c 662e 6f70 7469  _key = self.opti
+000029f0: 6f6e 732e 6765 7428 2763 6f73 5f61 7069  ons.get('cos_api
+00002a00: 5f6b 6579 2729 0a20 2020 2020 2020 2020  _key').         
+00002a10: 2020 2020 2020 2020 2020 2063 6f73 5f72             cos_r
+00002a20: 6573 6f75 7263 655f 696e 7374 616e 6365  esource_instance
+00002a30: 5f69 6420 3d20 7365 6c66 2e6f 7074 696f  _id = self.optio
+00002a40: 6e73 2e67 6574 2827 636f 735f 7265 736f  ns.get('cos_reso
+00002a50: 7572 6365 5f69 6e73 7461 6e63 655f 6964  urce_instance_id
+00002a60: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
+00002a70: 2020 2020 2020 2063 6973 5f72 6573 6f75         cis_resou
+00002a80: 7263 655f 696e 7374 616e 6365 5f69 6420  rce_instance_id 
+00002a90: 3d20 7365 6c66 2e6f 7074 696f 6e73 2e67  = self.options.g
+00002aa0: 6574 2827 6369 735f 7265 736f 7572 6365  et('cis_resource
+00002ab0: 5f69 6e73 7461 6e63 655f 6964 2729 0a20  _instance_id'). 
+00002ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002ad0: 2020 2072 6567 696f 6e20 3d20 7365 6c66     region = self
+00002ae0: 2e6f 7074 696f 6e73 2e67 6574 2827 7265  .options.get('re
+00002af0: 6769 6f6e 2729 2069 6620 7265 6769 6f6e  gion') if region
+00002b00: 2069 7320 4e6f 6e65 2065 6c73 6520 7265   is None else re
+00002b10: 6769 6f6e 0a20 2020 2020 2020 2020 2020  gion.           
+00002b20: 2020 2020 2020 2020 207a 6f6e 6520 3d20           zone = 
+00002b30: 7365 6c66 2e6f 7074 696f 6e73 2e67 6574  self.options.get
+00002b40: 2827 7a6f 6e65 2729 2069 6620 7a6f 6e65  ('zone') if zone
+00002b50: 2069 7320 4e6f 6e65 2065 6c73 6520 7a6f   is None else zo
+00002b60: 6e65 0a20 2020 2020 2020 2020 2020 2020  ne.             
+00002b70: 2020 2020 2020 2076 7063 203d 2073 656c         vpc = sel
+00002b80: 662e 6f70 7469 6f6e 732e 6765 7428 2776  f.options.get('v
+00002b90: 7063 2729 0a20 2020 2020 2020 2020 2020  pc').           
+00002ba0: 2020 2020 2069 6620 6961 6d5f 6170 695f       if iam_api_
+00002bb0: 6b65 7920 6973 204e 6f6e 653a 0a20 2020  key is None:.   
+00002bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002bd0: 2065 7272 6f72 2822 4d69 7373 696e 6720   error("Missing 
+00002be0: 6961 6d5f 6170 695f 6b65 7920 696e 2074  iam_api_key in t
+00002bf0: 6865 2063 6f6e 6669 6775 7261 7469 6f6e  he configuration
+00002c00: 2e20 4c65 6176 696e 6722 290a 2020 2020  . Leaving").    
+00002c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002c20: 7379 732e 6578 6974 2831 290a 2020 2020  sys.exit(1).    
+00002c30: 2020 2020 2020 2020 2020 2020 6966 2072              if r
+00002c40: 6567 696f 6e20 6973 204e 6f6e 653a 0a20  egion is None:. 
+00002c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002c60: 2020 2065 7272 6f72 2822 4d69 7373 696e     error("Missin
+00002c70: 6720 7265 6769 6f6e 2069 6e20 7468 6520  g region in the 
+00002c80: 636f 6e66 6967 7572 6174 696f 6e2e 204c  configuration. L
+00002c90: 6561 7669 6e67 2229 0a20 2020 2020 2020  eaving").       
+00002ca0: 2020 2020 2020 2020 2020 2020 2073 7973               sys
+00002cb0: 2e65 7869 7428 3129 0a20 2020 2020 2020  .exit(1).       
+00002cc0: 2020 2020 2020 2020 2066 726f 6d20 6b76           from kv
+00002cd0: 6972 742e 7072 6f76 6964 6572 732e 6962  irt.providers.ib
+00002ce0: 6d20 696d 706f 7274 204b 6962 6d0a 2020  m import Kibm.  
+00002cf0: 2020 2020 2020 2020 2020 2020 2020 6b20                k 
+00002d00: 3d20 4b69 626d 2869 616d 5f61 7069 5f6b  = Kibm(iam_api_k
+00002d10: 6579 3d69 616d 5f61 7069 5f6b 6579 2c20  ey=iam_api_key, 
+00002d20: 7265 6769 6f6e 3d72 6567 696f 6e2c 207a  region=region, z
+00002d30: 6f6e 653d 7a6f 6e65 2c20 7670 633d 7670  one=zone, vpc=vp
+00002d40: 632c 2064 6562 7567 3d64 6562 7567 2c0a  c, debug=debug,.
+00002d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002d60: 2020 2020 2020 2020 2063 6f73 5f61 7069           cos_api
+00002d70: 5f6b 6579 3d63 6f73 5f61 7069 5f6b 6579  _key=cos_api_key
+00002d80: 2c20 636f 735f 7265 736f 7572 6365 5f69  , cos_resource_i
+00002d90: 6e73 7461 6e63 655f 6964 3d63 6f73 5f72  nstance_id=cos_r
+00002da0: 6573 6f75 7263 655f 696e 7374 616e 6365  esource_instance
+00002db0: 5f69 642c 0a20 2020 2020 2020 2020 2020  _id,.           
+00002dc0: 2020 2020 2020 2020 2020 2020 2020 6369                ci
 00002dd0: 735f 7265 736f 7572 6365 5f69 6e73 7461  s_resource_insta
-00002de0: 6e63 655f 6964 3d63 6f73 5f72 6573 6f75  nce_id=cos_resou
-00002df0: 7263 655f 696e 7374 616e 6365 5f69 642c  rce_instance_id,
-00002e00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002e10: 2020 2020 2020 2020 2020 6369 735f 7265            cis_re
-00002e20: 736f 7572 6365 5f69 6e73 7461 6e63 655f  source_instance_
-00002e30: 6964 3d63 6973 5f72 6573 6f75 7263 655f  id=cis_resource_
-00002e40: 696e 7374 616e 6365 5f69 6429 0a20 2020  instance_id).   
-00002e50: 2020 2020 2020 2020 2065 6c69 6620 7365           elif se
-00002e60: 6c66 2e74 7970 6520 3d3d 2027 6f76 6972  lf.type == 'ovir
-00002e70: 7427 3a0a 2020 2020 2020 2020 2020 2020  t':.            
-00002e80: 2020 2020 6461 7461 6365 6e74 6572 203d      datacenter =
-00002e90: 2073 656c 662e 6f70 7469 6f6e 732e 6765   self.options.ge
-00002ea0: 7428 2764 6174 6163 656e 7465 7227 2c20  t('datacenter', 
-00002eb0: 2744 6566 6175 6c74 2729 0a20 2020 2020  'Default').     
-00002ec0: 2020 2020 2020 2020 2020 2063 6c75 7374             clust
-00002ed0: 6572 203d 2073 656c 662e 6f70 7469 6f6e  er = self.option
-00002ee0: 732e 6765 7428 2763 6c75 7374 6572 272c  s.get('cluster',
-00002ef0: 2027 4465 6661 756c 7427 290a 2020 2020   'Default').    
-00002f00: 2020 2020 2020 2020 2020 2020 7573 6572              user
-00002f10: 203d 2073 656c 662e 6f70 7469 6f6e 732e   = self.options.
-00002f20: 6765 7428 2775 7365 7227 2c20 2761 646d  get('user', 'adm
-00002f30: 696e 4069 6e74 6572 6e61 6c27 290a 2020  in@internal').  
-00002f40: 2020 2020 2020 2020 2020 2020 2020 7061                pa
-00002f50: 7373 776f 7264 203d 2073 656c 662e 6f70  ssword = self.op
-00002f60: 7469 6f6e 732e 6765 7428 2770 6173 7377  tions.get('passw
-00002f70: 6f72 6427 290a 2020 2020 2020 2020 2020  ord').          
-00002f80: 2020 2020 2020 6966 2070 6173 7377 6f72        if passwor
-00002f90: 6420 6973 204e 6f6e 653a 0a20 2020 2020  d is None:.     
-00002fa0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00002fb0: 7272 6f72 2822 4d69 7373 696e 6720 7061  rror("Missing pa
-00002fc0: 7373 776f 7264 2069 6e20 7468 6520 636f  ssword in the co
-00002fd0: 6e66 6967 7572 6174 696f 6e2e 204c 6561  nfiguration. Lea
-00002fe0: 7669 6e67 2229 0a20 2020 2020 2020 2020  ving").         
-00002ff0: 2020 2020 2020 2020 2020 2073 7973 2e65             sys.e
-00003000: 7869 7428 3129 0a20 2020 2020 2020 2020  xit(1).         
-00003010: 2020 2020 2020 206f 7267 203d 2073 656c         org = sel
-00003020: 662e 6f70 7469 6f6e 732e 6765 7428 276f  f.options.get('o
-00003030: 7267 2729 0a20 2020 2020 2020 2020 2020  rg').           
-00003040: 2020 2020 2069 6620 6f72 6720 6973 204e       if org is N
-00003050: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00003060: 2020 2020 2020 2020 2065 7272 6f72 2822           error("
-00003070: 4d69 7373 696e 6720 6f72 6720 696e 2074  Missing org in t
-00003080: 6865 2063 6f6e 6669 6775 7261 7469 6f6e  he configuration
-00003090: 2e20 4c65 6176 696e 6722 290a 2020 2020  . Leaving").    
-000030a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000030b0: 7379 732e 6578 6974 2831 290a 2020 2020  sys.exit(1).    
-000030c0: 2020 2020 2020 2020 2020 2020 6361 5f66              ca_f
-000030d0: 696c 6520 3d20 7365 6c66 2e6f 7074 696f  ile = self.optio
-000030e0: 6e73 2e67 6574 2827 6361 5f66 696c 6527  ns.get('ca_file'
-000030f0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00003100: 2020 6966 2063 615f 6669 6c65 2069 7320    if ca_file is 
-00003110: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00003120: 2020 2020 2020 2020 2020 6572 726f 7228            error(
-00003130: 224d 6973 7369 6e67 2063 615f 6669 6c65  "Missing ca_file
-00003140: 2069 6e20 7468 6520 636f 6e66 6967 7572   in the configur
-00003150: 6174 696f 6e2e 204c 6561 7669 6e67 2229  ation. Leaving")
-00003160: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003170: 2020 2020 2073 7973 2e65 7869 7428 3129       sys.exit(1)
-00003180: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003190: 2063 615f 6669 6c65 203d 206f 732e 7061   ca_file = os.pa
-000031a0: 7468 2e65 7870 616e 6475 7365 7228 6361  th.expanduser(ca
-000031b0: 5f66 696c 6529 0a20 2020 2020 2020 2020  _file).         
-000031c0: 2020 2020 2020 2069 6620 6e6f 7420 6f73         if not os
-000031d0: 2e70 6174 682e 6578 6973 7473 2863 615f  .path.exists(ca_
-000031e0: 6669 6c65 293a 0a20 2020 2020 2020 2020  file):.         
-000031f0: 2020 2020 2020 2020 2020 2065 7272 6f72             error
-00003200: 2822 4361 2066 696c 6520 7061 7468 2064  ("Ca file path d
-00003210: 6f65 736e 2774 2065 7869 7374 2e20 4c65  oesn't exist. Le
-00003220: 6176 696e 6722 290a 2020 2020 2020 2020  aving").        
-00003230: 2020 2020 2020 2020 2020 2020 7379 732e              sys.
-00003240: 6578 6974 2831 290a 2020 2020 2020 2020  exit(1).        
-00003250: 2020 2020 2020 2020 6669 6c74 6572 766d          filtervm
-00003260: 7320 3d20 7365 6c66 2e6f 7074 696f 6e73  s = self.options
-00003270: 2e67 6574 2827 6669 6c74 6572 766d 7327  .get('filtervms'
-00003280: 2c20 4661 6c73 6529 0a20 2020 2020 2020  , False).       
-00003290: 2020 2020 2020 2020 2066 696c 7465 7275           filteru
-000032a0: 7365 7220 3d20 7365 6c66 2e6f 7074 696f  ser = self.optio
-000032b0: 6e73 2e67 6574 2827 6669 6c74 6572 7573  ns.get('filterus
-000032c0: 6572 272c 2046 616c 7365 290a 2020 2020  er', False).    
-000032d0: 2020 2020 2020 2020 2020 2020 6669 6c74              filt
-000032e0: 6572 7461 6720 3d20 7365 6c66 2e6f 7074  ertag = self.opt
-000032f0: 696f 6e73 2e67 6574 2827 6669 6c74 6572  ions.get('filter
-00003300: 7461 6727 290a 2020 2020 2020 2020 2020  tag').          
-00003310: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-00003320: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00003330: 726f 6d20 6b76 6972 742e 7072 6f76 6964  rom kvirt.provid
-00003340: 6572 732e 6f76 6972 7420 696d 706f 7274  ers.ovirt import
-00003350: 204b 4f76 6972 740a 2020 2020 2020 2020   KOvirt.        
-00003360: 2020 2020 2020 2020 6578 6365 7074 3a0a          except:.
-00003370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003380: 2020 2020 6465 7065 6e64 656e 6379 5f65      dependency_e
-00003390: 7272 6f72 2827 6f76 6972 7427 290a 2020  rror('ovirt').  
-000033a0: 2020 2020 2020 2020 2020 2020 2020 6b20                k 
-000033b0: 3d20 4b4f 7669 7274 2868 6f73 743d 7365  = KOvirt(host=se
-000033c0: 6c66 2e68 6f73 742c 2070 6f72 743d 7365  lf.host, port=se
-000033d0: 6c66 2e70 6f72 742c 2075 7365 723d 7573  lf.port, user=us
-000033e0: 6572 2c20 7061 7373 776f 7264 3d70 6173  er, password=pas
-000033f0: 7377 6f72 642c 0a20 2020 2020 2020 2020  sword,.         
-00003400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003410: 2020 6465 6275 673d 6465 6275 672c 2064    debug=debug, d
-00003420: 6174 6163 656e 7465 723d 6461 7461 6365  atacenter=datace
-00003430: 6e74 6572 2c20 636c 7573 7465 723d 636c  nter, cluster=cl
-00003440: 7573 7465 722c 2063 615f 6669 6c65 3d63  uster, ca_file=c
-00003450: 615f 6669 6c65 2c20 6f72 673d 6f72 672c  a_file, org=org,
-00003460: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003470: 2020 2020 2020 2020 2020 2020 6669 6c74              filt
-00003480: 6572 766d 733d 6669 6c74 6572 766d 732c  ervms=filtervms,
-00003490: 2066 696c 7465 7275 7365 723d 6669 6c74   filteruser=filt
-000034a0: 6572 7573 6572 2c20 6669 6c74 6572 7461  eruser, filterta
-000034b0: 673d 6669 6c74 6572 7461 6729 0a20 2020  g=filtertag).   
-000034c0: 2020 2020 2020 2020 2065 6c69 6620 7365           elif se
-000034d0: 6c66 2e74 7970 6520 3d3d 2027 6f70 656e  lf.type == 'open
-000034e0: 7374 6163 6b27 3a0a 2020 2020 2020 2020  stack':.        
-000034f0: 2020 2020 2020 2020 7665 7273 696f 6e20          version 
-00003500: 3d20 7365 6c66 2e6f 7074 696f 6e73 2e67  = self.options.g
-00003510: 6574 2827 7665 7273 696f 6e27 2c20 2732  et('version', '2
-00003520: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
-00003530: 2020 2064 6f6d 6169 6e20 3d20 6e65 7874     domain = next
-00003540: 2828 6520 666f 7220 6520 696e 205b 7365  ((e for e in [se
-00003550: 6c66 2e6f 7074 696f 6e73 2e67 6574 2827  lf.options.get('
-00003560: 646f 6d61 696e 2729 2c0a 2020 2020 2020  domain'),.      
-00003570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003590: 2020 2020 206f 732e 656e 7669 726f 6e2e       os.environ.
-000035a0: 6765 7428 224f 535f 5553 4552 5f44 4f4d  get("OS_USER_DOM
-000035b0: 4149 4e5f 4e41 4d45 2229 5d20 6966 2065  AIN_NAME")] if e
-000035c0: 2069 7320 6e6f 7420 4e6f 6e65 292c 2027   is not None), '
-000035d0: 4465 6661 756c 7427 290a 2020 2020 2020  Default').      
-000035e0: 2020 2020 2020 2020 2020 6175 7468 5f75            auth_u
-000035f0: 726c 203d 206e 6578 7428 2865 2066 6f72  rl = next((e for
-00003600: 2065 2069 6e20 5b73 656c 662e 6f70 7469   e in [self.opti
-00003610: 6f6e 732e 6765 7428 2761 7574 685f 7572  ons.get('auth_ur
-00003620: 6c27 292c 0a20 2020 2020 2020 2020 2020  l'),.           
-00003630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002de0: 6e63 655f 6964 3d63 6973 5f72 6573 6f75  nce_id=cis_resou
+00002df0: 7263 655f 696e 7374 616e 6365 5f69 6429  rce_instance_id)
+00002e00: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
+00002e10: 6620 7365 6c66 2e74 7970 6520 3d3d 2027  f self.type == '
+00002e20: 6f76 6972 7427 3a0a 2020 2020 2020 2020  ovirt':.        
+00002e30: 2020 2020 2020 2020 6461 7461 6365 6e74          datacent
+00002e40: 6572 203d 2073 656c 662e 6f70 7469 6f6e  er = self.option
+00002e50: 732e 6765 7428 2764 6174 6163 656e 7465  s.get('datacente
+00002e60: 7227 2c20 2744 6566 6175 6c74 2729 0a20  r', 'Default'). 
+00002e70: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00002e80: 6c75 7374 6572 203d 2073 656c 662e 6f70  luster = self.op
+00002e90: 7469 6f6e 732e 6765 7428 2763 6c75 7374  tions.get('clust
+00002ea0: 6572 272c 2027 4465 6661 756c 7427 290a  er', 'Default').
+00002eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002ec0: 7573 6572 203d 2073 656c 662e 6f70 7469  user = self.opti
+00002ed0: 6f6e 732e 6765 7428 2775 7365 7227 2c20  ons.get('user', 
+00002ee0: 2761 646d 696e 4069 6e74 6572 6e61 6c27  'admin@internal'
+00002ef0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00002f00: 2020 7061 7373 776f 7264 203d 2073 656c    password = sel
+00002f10: 662e 6f70 7469 6f6e 732e 6765 7428 2770  f.options.get('p
+00002f20: 6173 7377 6f72 6427 290a 2020 2020 2020  assword').      
+00002f30: 2020 2020 2020 2020 2020 6966 2070 6173            if pas
+00002f40: 7377 6f72 6420 6973 204e 6f6e 653a 0a20  sword is None:. 
+00002f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002f60: 2020 2065 7272 6f72 2822 4d69 7373 696e     error("Missin
+00002f70: 6720 7061 7373 776f 7264 2069 6e20 7468  g password in th
+00002f80: 6520 636f 6e66 6967 7572 6174 696f 6e2e  e configuration.
+00002f90: 204c 6561 7669 6e67 2229 0a20 2020 2020   Leaving").     
+00002fa0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00002fb0: 7973 2e65 7869 7428 3129 0a20 2020 2020  ys.exit(1).     
+00002fc0: 2020 2020 2020 2020 2020 206f 7267 203d             org =
+00002fd0: 2073 656c 662e 6f70 7469 6f6e 732e 6765   self.options.ge
+00002fe0: 7428 276f 7267 2729 0a20 2020 2020 2020  t('org').       
+00002ff0: 2020 2020 2020 2020 2069 6620 6f72 6720           if org 
+00003000: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+00003010: 2020 2020 2020 2020 2020 2020 2065 7272               err
+00003020: 6f72 2822 4d69 7373 696e 6720 6f72 6720  or("Missing org 
+00003030: 696e 2074 6865 2063 6f6e 6669 6775 7261  in the configura
+00003040: 7469 6f6e 2e20 4c65 6176 696e 6722 290a  tion. Leaving").
+00003050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003060: 2020 2020 7379 732e 6578 6974 2831 290a      sys.exit(1).
+00003070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003080: 6361 5f66 696c 6520 3d20 7365 6c66 2e6f  ca_file = self.o
+00003090: 7074 696f 6e73 2e67 6574 2827 6361 5f66  ptions.get('ca_f
+000030a0: 696c 6527 290a 2020 2020 2020 2020 2020  ile').          
+000030b0: 2020 2020 2020 6966 2063 615f 6669 6c65        if ca_file
+000030c0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+000030d0: 2020 2020 2020 2020 2020 2020 2020 6572                er
+000030e0: 726f 7228 224d 6973 7369 6e67 2063 615f  ror("Missing ca_
+000030f0: 6669 6c65 2069 6e20 7468 6520 636f 6e66  file in the conf
+00003100: 6967 7572 6174 696f 6e2e 204c 6561 7669  iguration. Leavi
+00003110: 6e67 2229 0a20 2020 2020 2020 2020 2020  ng").           
+00003120: 2020 2020 2020 2020 2073 7973 2e65 7869           sys.exi
+00003130: 7428 3129 0a20 2020 2020 2020 2020 2020  t(1).           
+00003140: 2020 2020 2063 615f 6669 6c65 203d 206f       ca_file = o
+00003150: 732e 7061 7468 2e65 7870 616e 6475 7365  s.path.expanduse
+00003160: 7228 6361 5f66 696c 6529 0a20 2020 2020  r(ca_file).     
+00003170: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+00003180: 7420 6f73 2e70 6174 682e 6578 6973 7473  t os.path.exists
+00003190: 2863 615f 6669 6c65 293a 0a20 2020 2020  (ca_file):.     
+000031a0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+000031b0: 7272 6f72 2822 4361 2066 696c 6520 7061  rror("Ca file pa
+000031c0: 7468 2064 6f65 736e 2774 2065 7869 7374  th doesn't exist
+000031d0: 2e20 4c65 6176 696e 6722 290a 2020 2020  . Leaving").    
+000031e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000031f0: 7379 732e 6578 6974 2831 290a 2020 2020  sys.exit(1).    
+00003200: 2020 2020 2020 2020 2020 2020 6669 6c74              filt
+00003210: 6572 766d 7320 3d20 7365 6c66 2e6f 7074  ervms = self.opt
+00003220: 696f 6e73 2e67 6574 2827 6669 6c74 6572  ions.get('filter
+00003230: 766d 7327 2c20 4661 6c73 6529 0a20 2020  vms', False).   
+00003240: 2020 2020 2020 2020 2020 2020 2066 696c               fil
+00003250: 7465 7275 7365 7220 3d20 7365 6c66 2e6f  teruser = self.o
+00003260: 7074 696f 6e73 2e67 6574 2827 6669 6c74  ptions.get('filt
+00003270: 6572 7573 6572 272c 2046 616c 7365 290a  eruser', False).
+00003280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003290: 6669 6c74 6572 7461 6720 3d20 7365 6c66  filtertag = self
+000032a0: 2e6f 7074 696f 6e73 2e67 6574 2827 6669  .options.get('fi
+000032b0: 6c74 6572 7461 6727 290a 2020 2020 2020  ltertag').      
+000032c0: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
+000032d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000032e0: 2020 2066 726f 6d20 6b76 6972 742e 7072     from kvirt.pr
+000032f0: 6f76 6964 6572 732e 6f76 6972 7420 696d  oviders.ovirt im
+00003300: 706f 7274 204b 4f76 6972 740a 2020 2020  port KOvirt.    
+00003310: 2020 2020 2020 2020 2020 2020 6578 6365              exce
+00003320: 7074 3a0a 2020 2020 2020 2020 2020 2020  pt:.            
+00003330: 2020 2020 2020 2020 6465 7065 6e64 656e          dependen
+00003340: 6379 5f65 7272 6f72 2827 6f76 6972 7427  cy_error('ovirt'
+00003350: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00003360: 2020 6b20 3d20 4b4f 7669 7274 2868 6f73    k = KOvirt(hos
+00003370: 743d 7365 6c66 2e68 6f73 742c 2070 6f72  t=self.host, por
+00003380: 743d 7365 6c66 2e70 6f72 742c 2075 7365  t=self.port, use
+00003390: 723d 7573 6572 2c20 7061 7373 776f 7264  r=user, password
+000033a0: 3d70 6173 7377 6f72 642c 0a20 2020 2020  =password,.     
+000033b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000033c0: 2020 2020 2020 6465 6275 673d 6465 6275        debug=debu
+000033d0: 672c 2064 6174 6163 656e 7465 723d 6461  g, datacenter=da
+000033e0: 7461 6365 6e74 6572 2c20 636c 7573 7465  tacenter, cluste
+000033f0: 723d 636c 7573 7465 722c 2063 615f 6669  r=cluster, ca_fi
+00003400: 6c65 3d63 615f 6669 6c65 2c20 6f72 673d  le=ca_file, org=
+00003410: 6f72 672c 0a20 2020 2020 2020 2020 2020  org,.           
+00003420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003430: 6669 6c74 6572 766d 733d 6669 6c74 6572  filtervms=filter
+00003440: 766d 732c 2066 696c 7465 7275 7365 723d  vms, filteruser=
+00003450: 6669 6c74 6572 7573 6572 2c20 6669 6c74  filteruser, filt
+00003460: 6572 7461 673d 6669 6c74 6572 7461 6729  ertag=filtertag)
+00003470: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
+00003480: 6620 7365 6c66 2e74 7970 6520 3d3d 2027  f self.type == '
+00003490: 6f70 656e 7374 6163 6b27 3a0a 2020 2020  openstack':.    
+000034a0: 2020 2020 2020 2020 2020 2020 7665 7273              vers
+000034b0: 696f 6e20 3d20 7365 6c66 2e6f 7074 696f  ion = self.optio
+000034c0: 6e73 2e67 6574 2827 7665 7273 696f 6e27  ns.get('version'
+000034d0: 2c20 2732 2729 0a20 2020 2020 2020 2020  , '2').         
+000034e0: 2020 2020 2020 2064 6f6d 6169 6e20 3d20         domain = 
+000034f0: 6e65 7874 2828 6520 666f 7220 6520 696e  next((e for e in
+00003500: 205b 7365 6c66 2e6f 7074 696f 6e73 2e67   [self.options.g
+00003510: 6574 2827 646f 6d61 696e 2729 2c0a 2020  et('domain'),.  
+00003520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003540: 2020 2020 2020 2020 206f 732e 656e 7669           os.envi
+00003550: 726f 6e2e 6765 7428 224f 535f 5553 4552  ron.get("OS_USER
+00003560: 5f44 4f4d 4149 4e5f 4e41 4d45 2229 5d20  _DOMAIN_NAME")] 
+00003570: 6966 2065 2069 7320 6e6f 7420 4e6f 6e65  if e is not None
+00003580: 292c 2027 4465 6661 756c 7427 290a 2020  ), 'Default').  
+00003590: 2020 2020 2020 2020 2020 2020 2020 6175                au
+000035a0: 7468 5f75 726c 203d 206e 6578 7428 2865  th_url = next((e
+000035b0: 2066 6f72 2065 2069 6e20 5b73 656c 662e   for e in [self.
+000035c0: 6f70 7469 6f6e 732e 6765 7428 2761 7574  options.get('aut
+000035d0: 685f 7572 6c27 292c 0a20 2020 2020 2020  h_url'),.       
+000035e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000035f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003600: 2020 2020 2020 6f73 2e65 6e76 6972 6f6e        os.environ
+00003610: 2e67 6574 2822 4f53 5f41 5554 485f 5552  .get("OS_AUTH_UR
+00003620: 4c22 295d 2069 6620 6520 6973 206e 6f74  L")] if e is not
+00003630: 204e 6f6e 6529 2c0a 2020 2020 2020 2020   None),.        
 00003640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003650: 2020 6f73 2e65 6e76 6972 6f6e 2e67 6574    os.environ.get
-00003660: 2822 4f53 5f41 5554 485f 5552 4c22 295d  ("OS_AUTH_URL")]
-00003670: 2069 6620 6520 6973 206e 6f74 204e 6f6e   if e is not Non
-00003680: 6529 2c0a 2020 2020 2020 2020 2020 2020  e),.            
-00003690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000036a0: 2020 2020 4e6f 6e65 290a 2020 2020 2020      None).      
-000036b0: 2020 2020 2020 2020 2020 6966 2061 7574            if aut
-000036c0: 685f 7572 6c20 6973 204e 6f6e 653a 0a20  h_url is None:. 
+00003650: 2020 2020 2020 2020 4e6f 6e65 290a 2020          None).  
+00003660: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00003670: 2061 7574 685f 7572 6c20 6973 204e 6f6e   auth_url is Non
+00003680: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00003690: 2020 2020 2020 2065 7272 6f72 2822 4d69         error("Mi
+000036a0: 7373 696e 6720 6175 7468 5f75 726c 2069  ssing auth_url i
+000036b0: 6e20 7468 6520 636f 6e66 6967 7572 6174  n the configurat
+000036c0: 696f 6e2e 204c 6561 7669 6e67 2229 0a20  ion. Leaving"). 
 000036d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000036e0: 2020 2065 7272 6f72 2822 4d69 7373 696e     error("Missin
-000036f0: 6720 6175 7468 5f75 726c 2069 6e20 7468  g auth_url in th
-00003700: 6520 636f 6e66 6967 7572 6174 696f 6e2e  e configuration.
-00003710: 204c 6561 7669 6e67 2229 0a20 2020 2020   Leaving").     
-00003720: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00003730: 7973 2e65 7869 7428 3129 0a20 2020 2020  ys.exit(1).     
-00003740: 2020 2020 2020 2020 2020 2075 7365 7220             user 
-00003750: 3d20 6e65 7874 2828 6520 666f 7220 6520  = next((e for e 
-00003760: 696e 205b 7365 6c66 2e6f 7074 696f 6e73  in [self.options
-00003770: 2e67 6574 2827 7573 6572 2729 2c0a 2020  .get('user'),.  
-00003780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000037a0: 2020 2020 2020 206f 732e 656e 7669 726f         os.enviro
-000037b0: 6e2e 6765 7428 224f 535f 5553 4552 4e41  n.get("OS_USERNA
-000037c0: 4d45 2229 5d20 6966 2065 2069 7320 6e6f  ME")] if e is no
-000037d0: 7420 4e6f 6e65 292c 2027 6164 6d69 6e27  t None), 'admin'
-000037e0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000037f0: 2020 7072 6f6a 6563 7420 3d20 6e65 7874    project = next
-00003800: 2828 6520 666f 7220 6520 696e 205b 7365  ((e for e in [se
-00003810: 6c66 2e6f 7074 696f 6e73 2e67 6574 2827  lf.options.get('
-00003820: 7072 6f6a 6563 7427 292c 0a20 2020 2020  project'),.     
-00003830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003850: 2020 2020 2020 206f 732e 656e 7669 726f         os.enviro
-00003860: 6e2e 6765 7428 224f 535f 5052 4f4a 4543  n.get("OS_PROJEC
-00003870: 545f 4e41 4d45 2229 5d20 6966 2065 2069  T_NAME")] if e i
-00003880: 7320 6e6f 7420 4e6f 6e65 292c 2027 6164  s not None), 'ad
-00003890: 6d69 6e27 290a 2020 2020 2020 2020 2020  min').          
-000038a0: 2020 2020 2020 7061 7373 776f 7264 203d        password =
-000038b0: 206e 6578 7428 2865 2066 6f72 2065 2069   next((e for e i
-000038c0: 6e20 5b73 656c 662e 6f70 7469 6f6e 732e  n [self.options.
-000038d0: 6765 7428 2770 6173 7377 6f72 6427 292c  get('password'),
-000038e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000038f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003900: 2020 2020 2020 2020 2020 2020 2020 6f73                os
-00003910: 2e65 6e76 6972 6f6e 2e67 6574 2822 4f53  .environ.get("OS
-00003920: 5f50 4153 5357 4f52 4422 295d 2069 6620  _PASSWORD")] if 
-00003930: 6520 6973 206e 6f74 204e 6f6e 6529 2c20  e is not None), 
-00003940: 4e6f 6e65 290a 2020 2020 2020 2020 2020  None).          
-00003950: 2020 2020 2020 6361 5f66 696c 6520 3d20        ca_file = 
-00003960: 6e65 7874 2828 6520 666f 7220 6520 696e  next((e for e in
-00003970: 205b 7365 6c66 2e6f 7074 696f 6e73 2e67   [self.options.g
-00003980: 6574 2827 6361 5f66 696c 6527 292c 0a20  et('ca_file'),. 
-00003990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000039a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000039b0: 2020 2020 2020 2020 2020 206f 732e 656e             os.en
-000039c0: 7669 726f 6e2e 6765 7428 224f 535f 4341  viron.get("OS_CA
-000039d0: 4345 5254 2229 5d20 6966 2065 2069 7320  CERT")] if e is 
-000039e0: 6e6f 7420 4e6f 6e65 292c 204e 6f6e 6529  not None), None)
-000039f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003a00: 2072 6567 696f 6e5f 6e61 6d65 203d 206e   region_name = n
-00003a10: 6578 7428 2865 2066 6f72 2065 2069 6e20  ext((e for e in 
-00003a20: 5b73 656c 662e 6f70 7469 6f6e 732e 6765  [self.options.ge
-00003a30: 7428 2772 6567 696f 6e5f 6e61 6d65 2729  t('region_name')
-00003a40: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00003a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003a60: 2020 2020 2020 6f73 2e65 6e76 6972 6f6e        os.environ
-00003a70: 2e67 6574 2822 4f53 5f52 4547 494f 4e5f  .get("OS_REGION_
-00003a80: 4e41 4d45 2229 5d20 6966 2065 2069 7320  NAME")] if e is 
-00003a90: 6e6f 7420 4e6f 6e65 292c 204e 6f6e 6529  not None), None)
-00003aa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003ab0: 2065 7874 6572 6e61 6c5f 6e65 7477 6f72   external_networ
-00003ac0: 6b20 3d20 7365 6c66 2e6f 7074 696f 6e73  k = self.options
-00003ad0: 2e67 6574 2827 6578 7465 726e 616c 5f6e  .get('external_n
-00003ae0: 6574 776f 726b 2729 0a20 2020 2020 2020  etwork').       
-00003af0: 2020 2020 2020 2020 2069 6620 6175 7468           if auth
-00003b00: 5f75 726c 2e65 6e64 7377 6974 6828 2776  _url.endswith('v
-00003b10: 322e 3027 293a 0a20 2020 2020 2020 2020  2.0'):.         
-00003b20: 2020 2020 2020 2020 2020 2064 6f6d 6169             domai
-00003b30: 6e20 3d20 4e6f 6e65 0a20 2020 2020 2020  n = None.       
-00003b40: 2020 2020 2020 2020 2069 6620 6361 5f66           if ca_f
-00003b50: 696c 6520 6973 206e 6f74 204e 6f6e 6520  ile is not None 
-00003b60: 616e 6420 6e6f 7420 6f73 2e70 6174 682e  and not os.path.
-00003b70: 6578 6973 7473 286f 732e 7061 7468 2e65  exists(os.path.e
-00003b80: 7870 616e 6475 7365 7228 6361 5f66 696c  xpanduser(ca_fil
-00003b90: 6529 293a 0a20 2020 2020 2020 2020 2020  e)):.           
-00003ba0: 2020 2020 2020 2020 2065 7272 6f72 2866           error(f
-00003bb0: 2249 6e64 6963 6174 6564 2063 615f 6669  "Indicated ca_fi
-00003bc0: 6c65 207b 6361 5f66 696c 657d 206e 6f74  le {ca_file} not
-00003bd0: 2066 6f75 6e64 2e20 4c65 6176 696e 6722   found. Leaving"
-00003be0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00003bf0: 2020 2020 2020 7379 732e 6578 6974 2831        sys.exit(1
-00003c00: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00003c10: 2020 676c 616e 6365 5f64 6973 6b20 3d20    glance_disk = 
-00003c20: 7365 6c66 2e6f 7074 696f 6e73 2e67 6574  self.options.get
-00003c30: 2827 676c 616e 6365 5f64 6973 6b27 2c20  ('glance_disk', 
-00003c40: 4661 6c73 6529 0a20 2020 2020 2020 2020  False).         
-00003c50: 2020 2020 2020 2061 7574 685f 746f 6b65         auth_toke
-00003c60: 6e20 3d20 6e65 7874 2828 6520 666f 7220  n = next((e for 
-00003c70: 6520 696e 205b 7365 6c66 2e6f 7074 696f  e in [self.optio
-00003c80: 6e73 2e67 6574 2827 746f 6b65 6e27 292c  ns.get('token'),
-00003c90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003cc0: 6f73 2e65 6e76 6972 6f6e 2e67 6574 2822  os.environ.get("
-00003cd0: 4f53 5f54 4f4b 454e 2229 5d20 6966 2065  OS_TOKEN")] if e
-00003ce0: 2069 7320 6e6f 7420 4e6f 6e65 292c 204e   is not None), N
-00003cf0: 6f6e 6529 0a20 2020 2020 2020 2020 2020  one).           
-00003d00: 2020 2020 2061 7574 685f 7479 7065 203d       auth_type =
-00003d10: 2027 746f 6b65 6e27 2069 6620 6175 7468   'token' if auth
-00003d20: 5f74 6f6b 656e 2069 7320 6e6f 7420 4e6f  _token is not No
-00003d30: 6e65 2065 6c73 6520 2770 6173 7377 6f72  ne else 'passwor
-00003d40: 6427 0a20 2020 2020 2020 2020 2020 2020  d'.             
-00003d50: 2020 2069 6620 6175 7468 5f74 7970 6520     if auth_type 
-00003d60: 3d3d 2027 7061 7373 776f 7264 2720 616e  == 'password' an
-00003d70: 6420 7061 7373 776f 7264 2069 7320 4e6f  d password is No
-00003d80: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00003d90: 2020 2020 2020 2020 6572 726f 7228 224d          error("M
-00003da0: 6973 7369 6e67 2070 6173 7377 6f72 6420  issing password 
-00003db0: 696e 2074 6865 2063 6f6e 6669 6775 7261  in the configura
-00003dc0: 7469 6f6e 2e20 4c65 6176 696e 6722 290a  tion. Leaving").
+000036e0: 2020 2073 7973 2e65 7869 7428 3129 0a20     sys.exit(1). 
+000036f0: 2020 2020 2020 2020 2020 2020 2020 2075                 u
+00003700: 7365 7220 3d20 6e65 7874 2828 6520 666f  ser = next((e fo
+00003710: 7220 6520 696e 205b 7365 6c66 2e6f 7074  r e in [self.opt
+00003720: 696f 6e73 2e67 6574 2827 7573 6572 2729  ions.get('user')
+00003730: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00003740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003750: 2020 2020 2020 2020 2020 206f 732e 656e             os.en
+00003760: 7669 726f 6e2e 6765 7428 224f 535f 5553  viron.get("OS_US
+00003770: 4552 4e41 4d45 2229 5d20 6966 2065 2069  ERNAME")] if e i
+00003780: 7320 6e6f 7420 4e6f 6e65 292c 2027 6164  s not None), 'ad
+00003790: 6d69 6e27 290a 2020 2020 2020 2020 2020  min').          
+000037a0: 2020 2020 2020 7072 6f6a 6563 7420 3d20        project = 
+000037b0: 6e65 7874 2828 6520 666f 7220 6520 696e  next((e for e in
+000037c0: 205b 7365 6c66 2e6f 7074 696f 6e73 2e67   [self.options.g
+000037d0: 6574 2827 7072 6f6a 6563 7427 292c 0a20  et('project'),. 
+000037e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000037f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003800: 2020 2020 2020 2020 2020 206f 732e 656e             os.en
+00003810: 7669 726f 6e2e 6765 7428 224f 535f 5052  viron.get("OS_PR
+00003820: 4f4a 4543 545f 4e41 4d45 2229 5d20 6966  OJECT_NAME")] if
+00003830: 2065 2069 7320 6e6f 7420 4e6f 6e65 292c   e is not None),
+00003840: 2027 6164 6d69 6e27 290a 2020 2020 2020   'admin').      
+00003850: 2020 2020 2020 2020 2020 7061 7373 776f            passwo
+00003860: 7264 203d 206e 6578 7428 2865 2066 6f72  rd = next((e for
+00003870: 2065 2069 6e20 5b73 656c 662e 6f70 7469   e in [self.opti
+00003880: 6f6e 732e 6765 7428 2770 6173 7377 6f72  ons.get('passwor
+00003890: 6427 292c 0a20 2020 2020 2020 2020 2020  d'),.           
+000038a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000038b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000038c0: 2020 6f73 2e65 6e76 6972 6f6e 2e67 6574    os.environ.get
+000038d0: 2822 4f53 5f50 4153 5357 4f52 4422 295d  ("OS_PASSWORD")]
+000038e0: 2069 6620 6520 6973 206e 6f74 204e 6f6e   if e is not Non
+000038f0: 6529 2c20 4e6f 6e65 290a 2020 2020 2020  e), None).      
+00003900: 2020 2020 2020 2020 2020 6361 5f66 696c            ca_fil
+00003910: 6520 3d20 6e65 7874 2828 6520 666f 7220  e = next((e for 
+00003920: 6520 696e 205b 7365 6c66 2e6f 7074 696f  e in [self.optio
+00003930: 6e73 2e67 6574 2827 6361 5f66 696c 6527  ns.get('ca_file'
+00003940: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+00003950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003960: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+00003970: 732e 656e 7669 726f 6e2e 6765 7428 224f  s.environ.get("O
+00003980: 535f 4341 4345 5254 2229 5d20 6966 2065  S_CACERT")] if e
+00003990: 2069 7320 6e6f 7420 4e6f 6e65 292c 204e   is not None), N
+000039a0: 6f6e 6529 0a20 2020 2020 2020 2020 2020  one).           
+000039b0: 2020 2020 2072 6567 696f 6e5f 6e61 6d65       region_name
+000039c0: 203d 206e 6578 7428 2865 2066 6f72 2065   = next((e for e
+000039d0: 2069 6e20 5b73 656c 662e 6f70 7469 6f6e   in [self.option
+000039e0: 732e 6765 7428 2772 6567 696f 6e5f 6e61  s.get('region_na
+000039f0: 6d65 2729 2c0a 2020 2020 2020 2020 2020  me'),.          
+00003a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003a10: 2020 2020 2020 2020 2020 6f73 2e65 6e76            os.env
+00003a20: 6972 6f6e 2e67 6574 2822 4f53 5f52 4547  iron.get("OS_REG
+00003a30: 494f 4e5f 4e41 4d45 2229 5d20 6966 2065  ION_NAME")] if e
+00003a40: 2069 7320 6e6f 7420 4e6f 6e65 292c 204e   is not None), N
+00003a50: 6f6e 6529 0a20 2020 2020 2020 2020 2020  one).           
+00003a60: 2020 2020 2065 7874 6572 6e61 6c5f 6e65       external_ne
+00003a70: 7477 6f72 6b20 3d20 7365 6c66 2e6f 7074  twork = self.opt
+00003a80: 696f 6e73 2e67 6574 2827 6578 7465 726e  ions.get('extern
+00003a90: 616c 5f6e 6574 776f 726b 2729 0a20 2020  al_network').   
+00003aa0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00003ab0: 6175 7468 5f75 726c 2e65 6e64 7377 6974  auth_url.endswit
+00003ac0: 6828 2776 322e 3027 293a 0a20 2020 2020  h('v2.0'):.     
+00003ad0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00003ae0: 6f6d 6169 6e20 3d20 4e6f 6e65 0a20 2020  omain = None.   
+00003af0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00003b00: 6361 5f66 696c 6520 6973 206e 6f74 204e  ca_file is not N
+00003b10: 6f6e 6520 616e 6420 6e6f 7420 6f73 2e70  one and not os.p
+00003b20: 6174 682e 6578 6973 7473 286f 732e 7061  ath.exists(os.pa
+00003b30: 7468 2e65 7870 616e 6475 7365 7228 6361  th.expanduser(ca
+00003b40: 5f66 696c 6529 293a 0a20 2020 2020 2020  _file)):.       
+00003b50: 2020 2020 2020 2020 2020 2020 2065 7272               err
+00003b60: 6f72 2866 2249 6e64 6963 6174 6564 2063  or(f"Indicated c
+00003b70: 615f 6669 6c65 207b 6361 5f66 696c 657d  a_file {ca_file}
+00003b80: 206e 6f74 2066 6f75 6e64 2e20 4c65 6176   not found. Leav
+00003b90: 696e 6722 290a 2020 2020 2020 2020 2020  ing").          
+00003ba0: 2020 2020 2020 2020 2020 7379 732e 6578            sys.ex
+00003bb0: 6974 2831 290a 2020 2020 2020 2020 2020  it(1).          
+00003bc0: 2020 2020 2020 676c 616e 6365 5f64 6973        glance_dis
+00003bd0: 6b20 3d20 7365 6c66 2e6f 7074 696f 6e73  k = self.options
+00003be0: 2e67 6574 2827 676c 616e 6365 5f64 6973  .get('glance_dis
+00003bf0: 6b27 2c20 4661 6c73 6529 0a20 2020 2020  k', False).     
+00003c00: 2020 2020 2020 2020 2020 2061 7574 685f             auth_
+00003c10: 746f 6b65 6e20 3d20 6e65 7874 2828 6520  token = next((e 
+00003c20: 666f 7220 6520 696e 205b 7365 6c66 2e6f  for e in [self.o
+00003c30: 7074 696f 6e73 2e67 6574 2827 746f 6b65  ptions.get('toke
+00003c40: 6e27 292c 0a20 2020 2020 2020 2020 2020  n'),.           
+00003c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003c70: 2020 2020 6f73 2e65 6e76 6972 6f6e 2e67      os.environ.g
+00003c80: 6574 2822 4f53 5f54 4f4b 454e 2229 5d20  et("OS_TOKEN")] 
+00003c90: 6966 2065 2069 7320 6e6f 7420 4e6f 6e65  if e is not None
+00003ca0: 292c 204e 6f6e 6529 0a20 2020 2020 2020  ), None).       
+00003cb0: 2020 2020 2020 2020 2061 7574 685f 7479           auth_ty
+00003cc0: 7065 203d 2027 746f 6b65 6e27 2069 6620  pe = 'token' if 
+00003cd0: 6175 7468 5f74 6f6b 656e 2069 7320 6e6f  auth_token is no
+00003ce0: 7420 4e6f 6e65 2065 6c73 6520 2770 6173  t None else 'pas
+00003cf0: 7377 6f72 6427 0a20 2020 2020 2020 2020  sword'.         
+00003d00: 2020 2020 2020 2069 6620 6175 7468 5f74         if auth_t
+00003d10: 7970 6520 3d3d 2027 7061 7373 776f 7264  ype == 'password
+00003d20: 2720 616e 6420 7061 7373 776f 7264 2069  ' and password i
+00003d30: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+00003d40: 2020 2020 2020 2020 2020 2020 6572 726f              erro
+00003d50: 7228 224d 6973 7369 6e67 2070 6173 7377  r("Missing passw
+00003d60: 6f72 6420 696e 2074 6865 2063 6f6e 6669  ord in the confi
+00003d70: 6775 7261 7469 6f6e 2e20 4c65 6176 696e  guration. Leavin
+00003d80: 6722 290a 2020 2020 2020 2020 2020 2020  g").            
+00003d90: 2020 2020 2020 2020 7379 732e 6578 6974          sys.exit
+00003da0: 2831 290a 2020 2020 2020 2020 2020 2020  (1).            
+00003db0: 2020 2020 6966 2061 7574 685f 7479 7065      if auth_type
+00003dc0: 203d 3d20 2774 6f6b 656e 273a 0a20 2020   == 'token':.   
 00003dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003de0: 2020 2020 7379 732e 6578 6974 2831 290a      sys.exit(1).
-00003df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003e00: 6966 2061 7574 685f 7479 7065 203d 3d20  if auth_type == 
-00003e10: 2774 6f6b 656e 273a 0a20 2020 2020 2020  'token':.       
-00003e20: 2020 2020 2020 2020 2020 2020 2075 7365               use
-00003e30: 722c 2070 6173 7377 6f72 642c 2064 6f6d  r, password, dom
-00003e40: 6169 6e20 3d20 4e6f 6e65 2c20 4e6f 6e65  ain = None, None
-00003e50: 2c20 4e6f 6e65 0a20 2020 2020 2020 2020  , None.         
-00003e60: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-00003e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003e80: 6672 6f6d 206b 7669 7274 2e70 726f 7669  from kvirt.provi
-00003e90: 6465 7273 2e6f 7065 6e73 7461 636b 2069  ders.openstack i
-00003ea0: 6d70 6f72 7420 4b6f 7065 6e73 7461 636b  mport Kopenstack
-00003eb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003ec0: 2065 7863 6570 743a 0a20 2020 2020 2020   except:.       
-00003ed0: 2020 2020 2020 2020 2020 2020 2064 6570               dep
-00003ee0: 656e 6465 6e63 795f 6572 726f 7228 276f  endency_error('o
-00003ef0: 7065 6e73 7461 636b 2729 0a20 2020 2020  penstack').     
-00003f00: 2020 2020 2020 2020 2020 206b 203d 204b             k = K
-00003f10: 6f70 656e 7374 6163 6b28 686f 7374 3d73  openstack(host=s
-00003f20: 656c 662e 686f 7374 2c20 706f 7274 3d73  elf.host, port=s
-00003f30: 656c 662e 706f 7274 2c20 7573 6572 3d75  elf.port, user=u
-00003f40: 7365 722c 2070 6173 7377 6f72 643d 7061  ser, password=pa
-00003f50: 7373 776f 7264 2c20 7665 7273 696f 6e3d  ssword, version=
-00003f60: 7665 7273 696f 6e2c 0a20 2020 2020 2020  version,.       
-00003f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003f80: 2020 2020 2020 2020 6465 6275 673d 6465          debug=de
-00003f90: 6275 672c 2070 726f 6a65 6374 3d70 726f  bug, project=pro
-00003fa0: 6a65 6374 2c20 646f 6d61 696e 3d64 6f6d  ject, domain=dom
-00003fb0: 6169 6e2c 2061 7574 685f 7572 6c3d 6175  ain, auth_url=au
-00003fc0: 7468 5f75 726c 2c20 6361 5f66 696c 653d  th_url, ca_file=
-00003fd0: 6361 5f66 696c 652c 0a20 2020 2020 2020  ca_file,.       
-00003fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003ff0: 2020 2020 2020 2020 6578 7465 726e 616c          external
-00004000: 5f6e 6574 776f 726b 3d65 7874 6572 6e61  _network=externa
-00004010: 6c5f 6e65 7477 6f72 6b2c 2072 6567 696f  l_network, regio
-00004020: 6e5f 6e61 6d65 3d72 6567 696f 6e5f 6e61  n_name=region_na
-00004030: 6d65 2c20 676c 616e 6365 5f64 6973 6b3d  me, glance_disk=
-00004040: 676c 616e 6365 5f64 6973 6b2c 0a20 2020  glance_disk,.   
-00004050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004060: 2020 2020 2020 2020 2020 2020 6175 7468              auth
-00004070: 5f74 7970 653d 6175 7468 5f74 7970 652c  _type=auth_type,
-00004080: 2061 7574 685f 746f 6b65 6e3d 6175 7468   auth_token=auth
-00004090: 5f74 6f6b 656e 290a 2020 2020 2020 2020  _token).        
-000040a0: 2020 2020 656c 6966 2073 656c 662e 7479      elif self.ty
-000040b0: 7065 203d 3d20 2776 7370 6865 7265 273a  pe == 'vsphere':
-000040c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000040d0: 2075 7365 7220 3d20 7365 6c66 2e6f 7074   user = self.opt
-000040e0: 696f 6e73 2e67 6574 2827 7573 6572 2729  ions.get('user')
-000040f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004100: 2069 6620 7573 6572 2069 7320 4e6f 6e65   if user is None
-00004110: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00004120: 2020 2020 2020 6572 726f 7228 224d 6973        error("Mis
-00004130: 7369 6e67 2075 7365 7220 696e 2074 6865  sing user in the
-00004140: 2063 6f6e 6669 6775 7261 7469 6f6e 2e20   configuration. 
-00004150: 4c65 6176 696e 6722 290a 2020 2020 2020  Leaving").      
-00004160: 2020 2020 2020 2020 2020 2020 2020 7379                sy
-00004170: 732e 6578 6974 2831 290a 2020 2020 2020  s.exit(1).      
-00004180: 2020 2020 2020 2020 2020 7061 7373 776f            passwo
-00004190: 7264 203d 2073 656c 662e 6f70 7469 6f6e  rd = self.option
-000041a0: 732e 6765 7428 2770 6173 7377 6f72 6427  s.get('password'
-000041b0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000041c0: 2020 6966 2070 6173 7377 6f72 6420 6973    if password is
-000041d0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-000041e0: 2020 2020 2020 2020 2020 2065 7272 6f72             error
-000041f0: 2822 4d69 7373 696e 6720 7061 7373 776f  ("Missing passwo
-00004200: 7264 2069 6e20 7468 6520 636f 6e66 6967  rd in the config
-00004210: 7572 6174 696f 6e2e 204c 6561 7669 6e67  uration. Leaving
-00004220: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-00004230: 2020 2020 2020 2073 7973 2e65 7869 7428         sys.exit(
-00004240: 3129 0a20 2020 2020 2020 2020 2020 2020  1).             
-00004250: 2020 2063 6c75 7374 6572 203d 2073 656c     cluster = sel
-00004260: 662e 6f70 7469 6f6e 732e 6765 7428 2763  f.options.get('c
-00004270: 6c75 7374 6572 2729 0a20 2020 2020 2020  luster').       
-00004280: 2020 2020 2020 2020 2069 6620 636c 7573           if clus
-00004290: 7465 7220 6973 204e 6f6e 653a 0a20 2020  ter is None:.   
-000042a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000042b0: 2065 7272 6f72 2822 4d69 7373 696e 6720   error("Missing 
-000042c0: 636c 7573 7465 7220 696e 2074 6865 2063  cluster in the c
-000042d0: 6f6e 6669 6775 7261 7469 6f6e 2e20 4c65  onfiguration. Le
-000042e0: 6176 696e 6722 290a 2020 2020 2020 2020  aving").        
-000042f0: 2020 2020 2020 2020 6461 7461 6365 6e74          datacent
-00004300: 6572 203d 2073 656c 662e 6f70 7469 6f6e  er = self.option
-00004310: 732e 6765 7428 2764 6174 6163 656e 7465  s.get('datacente
-00004320: 7227 290a 2020 2020 2020 2020 2020 2020  r').            
-00004330: 2020 2020 6966 2064 6174 6163 656e 7465      if datacente
-00004340: 7220 6973 204e 6f6e 653a 0a20 2020 2020  r is None:.     
-00004350: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00004360: 7272 6f72 2822 4d69 7373 696e 6720 6461  rror("Missing da
-00004370: 7461 6365 6e74 6572 2069 6e20 7468 6520  tacenter in the 
-00004380: 636f 6e66 6967 7572 6174 696f 6e2e 204c  configuration. L
-00004390: 6561 7669 6e67 2229 0a20 2020 2020 2020  eaving").       
-000043a0: 2020 2020 2020 2020 2069 736f 666f 6c64           isofold
-000043b0: 6572 203d 2073 656c 662e 6f70 7469 6f6e  er = self.option
-000043c0: 732e 6765 7428 2769 736f 666f 6c64 6572  s.get('isofolder
-000043d0: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
-000043e0: 2020 2069 6620 6973 6f66 6f6c 6465 7220     if isofolder 
-000043f0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-00004400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004410: 2069 6620 272f 2720 6e6f 7420 696e 2069   if '/' not in i
-00004420: 736f 666f 6c64 6572 3a0a 2020 2020 2020  sofolder:.      
-00004430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004440: 2020 6973 6f70 6f6f 6c20 3d20 7365 6c66    isopool = self
-00004450: 2e70 6f6f 6c0a 2020 2020 2020 2020 2020  .pool.          
-00004460: 2020 2020 2020 2020 2020 656c 6966 2027            elif '
-00004470: 5b27 206e 6f74 2069 6e20 6973 6f66 6f6c  [' not in isofol
-00004480: 6465 723a 0a20 2020 2020 2020 2020 2020  der:.           
-00004490: 2020 2020 2020 2020 2020 2020 2069 736f               iso
-000044a0: 666f 6c64 6572 203d 2069 736f 666f 6c64  folder = isofold
-000044b0: 6572 2e73 706c 6974 2827 2f27 290a 2020  er.split('/').  
-000044c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000044d0: 2020 2020 2020 6973 6f70 6f6f 6c20 3d20        isopool = 
-000044e0: 6973 6f66 6f6c 6465 725b 305d 0a20 2020  isofolder[0].   
-000044f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004500: 2020 2020 2069 736f 666f 6c64 6572 203d       isofolder =
-00004510: 2069 736f 666f 6c64 6572 5b31 3a5d 0a20   isofolder[1:]. 
-00004520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004530: 2020 2069 736f 666f 6c64 6572 203d 2066     isofolder = f
-00004540: 275b 7b69 736f 706f 6f6c 7d5d 2f7b 6973  '[{isopool}]/{is
-00004550: 6f66 6f6c 6465 727d 270a 2020 2020 2020  ofolder}'.      
-00004560: 2020 2020 2020 2020 2020 6669 6c74 6572            filter
-00004570: 766d 7320 3d20 7365 6c66 2e6f 7074 696f  vms = self.optio
-00004580: 6e73 2e67 6574 2827 6669 6c74 6572 766d  ns.get('filtervm
-00004590: 7327 2c20 4661 6c73 6529 0a20 2020 2020  s', False).     
-000045a0: 2020 2020 2020 2020 2020 2066 696c 7465             filte
-000045b0: 7275 7365 7220 3d20 7365 6c66 2e6f 7074  ruser = self.opt
-000045c0: 696f 6e73 2e67 6574 2827 6669 6c74 6572  ions.get('filter
-000045d0: 7573 6572 272c 2046 616c 7365 290a 2020  user', False).  
-000045e0: 2020 2020 2020 2020 2020 2020 2020 6669                fi
-000045f0: 6c74 6572 7461 6720 3d20 7365 6c66 2e6f  ltertag = self.o
-00004600: 7074 696f 6e73 2e67 6574 2827 6669 6c74  ptions.get('filt
-00004610: 6572 7461 6727 290a 2020 2020 2020 2020  ertag').        
-00004620: 2020 2020 2020 2020 6361 7465 676f 7279          category
-00004630: 203d 2073 656c 662e 6f70 7469 6f6e 732e   = self.options.
-00004640: 6765 7428 2763 6174 6567 6f72 7927 2c20  get('category', 
-00004650: 276b 636c 6927 290a 2020 2020 2020 2020  'kcli').        
-00004660: 2020 2020 2020 2020 6261 7365 666f 6c64          basefold
-00004670: 6572 203d 2073 656c 662e 6f70 7469 6f6e  er = self.option
-00004680: 732e 6765 7428 2762 6173 6566 6f6c 6465  s.get('basefolde
-00004690: 7227 290a 2020 2020 2020 2020 2020 2020  r').            
-000046a0: 2020 2020 6476 7320 3d20 7365 6c66 2e6f      dvs = self.o
-000046b0: 7074 696f 6e73 2e67 6574 2827 6476 7327  ptions.get('dvs'
-000046c0: 2c20 5472 7565 290a 2020 2020 2020 2020  , True).        
-000046d0: 2020 2020 2020 2020 696d 706f 7274 5f6e          import_n
-000046e0: 6574 776f 726b 203d 2073 656c 662e 6f70  etwork = self.op
-000046f0: 7469 6f6e 732e 6765 7428 2769 6d70 6f72  tions.get('impor
-00004700: 745f 6e65 7477 6f72 6b27 2c20 2756 4d20  t_network', 'VM 
-00004710: 4e65 7477 6f72 6b27 290a 2020 2020 2020  Network').      
-00004720: 2020 2020 2020 2020 2020 7469 6d65 6f75            timeou
-00004730: 7420 3d20 7365 6c66 2e6f 7074 696f 6e73  t = self.options
-00004740: 2e67 6574 2827 7469 6d65 6f75 7427 2c20  .get('timeout', 
-00004750: 3237 3030 290a 2020 2020 2020 2020 2020  2700).          
-00004760: 2020 2020 2020 666f 7263 655f 706f 6f6c        force_pool
-00004770: 203d 2073 656c 662e 6f70 7469 6f6e 732e   = self.options.
-00004780: 6765 7428 2766 6f72 6365 5f70 6f6f 6c27  get('force_pool'
-00004790: 2c20 4661 6c73 6529 0a20 2020 2020 2020  , False).       
-000047a0: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
-000047b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000047c0: 2020 6672 6f6d 206b 7669 7274 2e70 726f    from kvirt.pro
-000047d0: 7669 6465 7273 2e76 7370 6865 7265 2069  viders.vsphere i
-000047e0: 6d70 6f72 7420 4b73 7068 6572 650a 2020  mport Ksphere.  
-000047f0: 2020 2020 2020 2020 2020 2020 2020 6578                ex
-00004800: 6365 7074 3a0a 2020 2020 2020 2020 2020  cept:.          
-00004810: 2020 2020 2020 2020 2020 6465 7065 6e64            depend
-00004820: 656e 6379 5f65 7272 6f72 2827 7673 7068  ency_error('vsph
-00004830: 6572 6527 290a 2020 2020 2020 2020 2020  ere').          
-00004840: 2020 2020 2020 6b20 3d20 4b73 7068 6572        k = Kspher
-00004850: 6528 7365 6c66 2e68 6f73 742c 2075 7365  e(self.host, use
-00004860: 722c 2070 6173 7377 6f72 642c 2064 6174  r, password, dat
-00004870: 6163 656e 7465 722c 2063 6c75 7374 6572  acenter, cluster
-00004880: 2c20 6973 6f66 6f6c 6465 723d 6973 6f66  , isofolder=isof
-00004890: 6f6c 6465 722c 2064 6562 7567 3d64 6562  older, debug=deb
-000048a0: 7567 2c0a 2020 2020 2020 2020 2020 2020  ug,.            
-000048b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000048c0: 6669 6c74 6572 766d 733d 6669 6c74 6572  filtervms=filter
-000048d0: 766d 732c 2066 696c 7465 7275 7365 723d  vms, filteruser=
-000048e0: 6669 6c74 6572 7573 6572 2c20 6669 6c74  filteruser, filt
-000048f0: 6572 7461 673d 6669 6c74 6572 7461 672c  ertag=filtertag,
-00004900: 2063 6174 6567 6f72 793d 6361 7465 676f   category=catego
-00004910: 7279 2c0a 2020 2020 2020 2020 2020 2020  ry,.            
-00004920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004930: 6261 7365 666f 6c64 6572 3d62 6173 6566  basefolder=basef
-00004940: 6f6c 6465 722c 2064 7673 3d64 7673 2c20  older, dvs=dvs, 
-00004950: 696d 706f 7274 5f6e 6574 776f 726b 3d69  import_network=i
-00004960: 6d70 6f72 745f 6e65 7477 6f72 6b2c 2074  mport_network, t
-00004970: 696d 656f 7574 3d74 696d 656f 7574 2c0a  imeout=timeout,.
-00004980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004990: 2020 2020 2020 2020 2020 2020 666f 7263              forc
-000049a0: 655f 706f 6f6c 3d66 6f72 6365 5f70 6f6f  e_pool=force_poo
-000049b0: 6c29 0a20 2020 2020 2020 2020 2020 2065  l).            e
-000049c0: 6c69 6620 7365 6c66 2e74 7970 6520 3d3d  lif self.type ==
-000049d0: 2027 7061 636b 6574 273a 0a20 2020 2020   'packet':.     
-000049e0: 2020 2020 2020 2020 2020 2061 7574 685f             auth_
-000049f0: 746f 6b65 6e20 3d20 7365 6c66 2e6f 7074  token = self.opt
-00004a00: 696f 6e73 2e67 6574 2827 6175 7468 5f74  ions.get('auth_t
-00004a10: 6f6b 656e 2729 0a20 2020 2020 2020 2020  oken').         
-00004a20: 2020 2020 2020 2069 6620 6175 7468 5f74         if auth_t
-00004a30: 6f6b 656e 2069 7320 4e6f 6e65 3a0a 2020  oken is None:.  
+00003de0: 2075 7365 722c 2070 6173 7377 6f72 642c   user, password,
+00003df0: 2064 6f6d 6169 6e20 3d20 4e6f 6e65 2c20   domain = None, 
+00003e00: 4e6f 6e65 2c20 4e6f 6e65 0a20 2020 2020  None, None.     
+00003e10: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
+00003e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003e30: 2020 2020 6672 6f6d 206b 7669 7274 2e70      from kvirt.p
+00003e40: 726f 7669 6465 7273 2e6f 7065 6e73 7461  roviders.opensta
+00003e50: 636b 2069 6d70 6f72 7420 4b6f 7065 6e73  ck import Kopens
+00003e60: 7461 636b 0a20 2020 2020 2020 2020 2020  tack.           
+00003e70: 2020 2020 2065 7863 6570 743a 0a20 2020       except:.   
+00003e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003e90: 2064 6570 656e 6465 6e63 795f 6572 726f   dependency_erro
+00003ea0: 7228 276f 7065 6e73 7461 636b 2729 0a20  r('openstack'). 
+00003eb0: 2020 2020 2020 2020 2020 2020 2020 206b                 k
+00003ec0: 203d 204b 6f70 656e 7374 6163 6b28 686f   = Kopenstack(ho
+00003ed0: 7374 3d73 656c 662e 686f 7374 2c20 706f  st=self.host, po
+00003ee0: 7274 3d73 656c 662e 706f 7274 2c20 7573  rt=self.port, us
+00003ef0: 6572 3d75 7365 722c 2070 6173 7377 6f72  er=user, passwor
+00003f00: 643d 7061 7373 776f 7264 2c20 7665 7273  d=password, vers
+00003f10: 696f 6e3d 7665 7273 696f 6e2c 0a20 2020  ion=version,.   
+00003f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003f30: 2020 2020 2020 2020 2020 2020 6465 6275              debu
+00003f40: 673d 6465 6275 672c 2070 726f 6a65 6374  g=debug, project
+00003f50: 3d70 726f 6a65 6374 2c20 646f 6d61 696e  =project, domain
+00003f60: 3d64 6f6d 6169 6e2c 2061 7574 685f 7572  =domain, auth_ur
+00003f70: 6c3d 6175 7468 5f75 726c 2c20 6361 5f66  l=auth_url, ca_f
+00003f80: 696c 653d 6361 5f66 696c 652c 0a20 2020  ile=ca_file,.   
+00003f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003fa0: 2020 2020 2020 2020 2020 2020 6578 7465              exte
+00003fb0: 726e 616c 5f6e 6574 776f 726b 3d65 7874  rnal_network=ext
+00003fc0: 6572 6e61 6c5f 6e65 7477 6f72 6b2c 2072  ernal_network, r
+00003fd0: 6567 696f 6e5f 6e61 6d65 3d72 6567 696f  egion_name=regio
+00003fe0: 6e5f 6e61 6d65 2c20 676c 616e 6365 5f64  n_name, glance_d
+00003ff0: 6973 6b3d 676c 616e 6365 5f64 6973 6b2c  isk=glance_disk,
+00004000: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004020: 6175 7468 5f74 7970 653d 6175 7468 5f74  auth_type=auth_t
+00004030: 7970 652c 2061 7574 685f 746f 6b65 6e3d  ype, auth_token=
+00004040: 6175 7468 5f74 6f6b 656e 290a 2020 2020  auth_token).    
+00004050: 2020 2020 2020 2020 656c 6966 2073 656c          elif sel
+00004060: 662e 7479 7065 203d 3d20 2776 7370 6865  f.type == 'vsphe
+00004070: 7265 273a 0a20 2020 2020 2020 2020 2020  re':.           
+00004080: 2020 2020 2075 7365 7220 3d20 7365 6c66       user = self
+00004090: 2e6f 7074 696f 6e73 2e67 6574 2827 7573  .options.get('us
+000040a0: 6572 2729 0a20 2020 2020 2020 2020 2020  er').           
+000040b0: 2020 2020 2069 6620 7573 6572 2069 7320       if user is 
+000040c0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+000040d0: 2020 2020 2020 2020 2020 6572 726f 7228            error(
+000040e0: 224d 6973 7369 6e67 2075 7365 7220 696e  "Missing user in
+000040f0: 2074 6865 2063 6f6e 6669 6775 7261 7469   the configurati
+00004100: 6f6e 2e20 4c65 6176 696e 6722 290a 2020  on. Leaving").  
+00004110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004120: 2020 7379 732e 6578 6974 2831 290a 2020    sys.exit(1).  
+00004130: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+00004140: 7373 776f 7264 203d 2073 656c 662e 6f70  ssword = self.op
+00004150: 7469 6f6e 732e 6765 7428 2770 6173 7377  tions.get('passw
+00004160: 6f72 6427 290a 2020 2020 2020 2020 2020  ord').          
+00004170: 2020 2020 2020 6966 2070 6173 7377 6f72        if passwor
+00004180: 6420 6973 204e 6f6e 653a 0a20 2020 2020  d is None:.     
+00004190: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+000041a0: 7272 6f72 2822 4d69 7373 696e 6720 7061  rror("Missing pa
+000041b0: 7373 776f 7264 2069 6e20 7468 6520 636f  ssword in the co
+000041c0: 6e66 6967 7572 6174 696f 6e2e 204c 6561  nfiguration. Lea
+000041d0: 7669 6e67 2229 0a20 2020 2020 2020 2020  ving").         
+000041e0: 2020 2020 2020 2020 2020 2073 7973 2e65             sys.e
+000041f0: 7869 7428 3129 0a20 2020 2020 2020 2020  xit(1).         
+00004200: 2020 2020 2020 2063 6c75 7374 6572 203d         cluster =
+00004210: 2073 656c 662e 6f70 7469 6f6e 732e 6765   self.options.ge
+00004220: 7428 2763 6c75 7374 6572 2729 0a20 2020  t('cluster').   
+00004230: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00004240: 636c 7573 7465 7220 6973 204e 6f6e 653a  cluster is None:
+00004250: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004260: 2020 2020 2065 7272 6f72 2822 4d69 7373       error("Miss
+00004270: 696e 6720 636c 7573 7465 7220 696e 2074  ing cluster in t
+00004280: 6865 2063 6f6e 6669 6775 7261 7469 6f6e  he configuration
+00004290: 2e20 4c65 6176 696e 6722 290a 2020 2020  . Leaving").    
+000042a0: 2020 2020 2020 2020 2020 2020 6461 7461              data
+000042b0: 6365 6e74 6572 203d 2073 656c 662e 6f70  center = self.op
+000042c0: 7469 6f6e 732e 6765 7428 2764 6174 6163  tions.get('datac
+000042d0: 656e 7465 7227 290a 2020 2020 2020 2020  enter').        
+000042e0: 2020 2020 2020 2020 6966 2064 6174 6163          if datac
+000042f0: 656e 7465 7220 6973 204e 6f6e 653a 0a20  enter is None:. 
+00004300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004310: 2020 2065 7272 6f72 2822 4d69 7373 696e     error("Missin
+00004320: 6720 6461 7461 6365 6e74 6572 2069 6e20  g datacenter in 
+00004330: 7468 6520 636f 6e66 6967 7572 6174 696f  the configuratio
+00004340: 6e2e 204c 6561 7669 6e67 2229 0a20 2020  n. Leaving").   
+00004350: 2020 2020 2020 2020 2020 2020 2069 736f               iso
+00004360: 666f 6c64 6572 203d 2073 656c 662e 6f70  folder = self.op
+00004370: 7469 6f6e 732e 6765 7428 2769 736f 666f  tions.get('isofo
+00004380: 6c64 6572 2729 0a20 2020 2020 2020 2020  lder').         
+00004390: 2020 2020 2020 2069 6620 6973 6f66 6f6c         if isofol
+000043a0: 6465 7220 6973 206e 6f74 204e 6f6e 653a  der is not None:
+000043b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000043c0: 2020 2020 2069 6620 272f 2720 6e6f 7420       if '/' not 
+000043d0: 696e 2069 736f 666f 6c64 6572 3a0a 2020  in isofolder:.  
+000043e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000043f0: 2020 2020 2020 6973 6f70 6f6f 6c20 3d20        isopool = 
+00004400: 7365 6c66 2e70 6f6f 6c0a 2020 2020 2020  self.pool.      
+00004410: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00004420: 6966 2027 5b27 206e 6f74 2069 6e20 6973  if '[' not in is
+00004430: 6f66 6f6c 6465 723a 0a20 2020 2020 2020  ofolder:.       
+00004440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004450: 2069 736f 666f 6c64 6572 203d 2069 736f   isofolder = iso
+00004460: 666f 6c64 6572 2e73 706c 6974 2827 2f27  folder.split('/'
+00004470: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00004480: 2020 2020 2020 2020 2020 6973 6f70 6f6f            isopoo
+00004490: 6c20 3d20 6973 6f66 6f6c 6465 725b 305d  l = isofolder[0]
+000044a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000044b0: 2020 2020 2020 2020 2069 736f 666f 6c64           isofold
+000044c0: 6572 203d 2069 736f 666f 6c64 6572 5b31  er = isofolder[1
+000044d0: 3a5d 0a20 2020 2020 2020 2020 2020 2020  :].             
+000044e0: 2020 2020 2020 2069 736f 666f 6c64 6572         isofolder
+000044f0: 203d 2066 275b 7b69 736f 706f 6f6c 7d5d   = f'[{isopool}]
+00004500: 2f7b 6973 6f66 6f6c 6465 727d 270a 2020  /{isofolder}'.  
+00004510: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+00004520: 6c74 6572 766d 7320 3d20 7365 6c66 2e6f  ltervms = self.o
+00004530: 7074 696f 6e73 2e67 6574 2827 6669 6c74  ptions.get('filt
+00004540: 6572 766d 7327 2c20 4661 6c73 6529 0a20  ervms', False). 
+00004550: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00004560: 696c 7465 7275 7365 7220 3d20 7365 6c66  ilteruser = self
+00004570: 2e6f 7074 696f 6e73 2e67 6574 2827 6669  .options.get('fi
+00004580: 6c74 6572 7573 6572 272c 2046 616c 7365  lteruser', False
+00004590: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000045a0: 2020 6669 6c74 6572 7461 6720 3d20 7365    filtertag = se
+000045b0: 6c66 2e6f 7074 696f 6e73 2e67 6574 2827  lf.options.get('
+000045c0: 6669 6c74 6572 7461 6727 290a 2020 2020  filtertag').    
+000045d0: 2020 2020 2020 2020 2020 2020 6361 7465              cate
+000045e0: 676f 7279 203d 2073 656c 662e 6f70 7469  gory = self.opti
+000045f0: 6f6e 732e 6765 7428 2763 6174 6567 6f72  ons.get('categor
+00004600: 7927 2c20 276b 636c 6927 290a 2020 2020  y', 'kcli').    
+00004610: 2020 2020 2020 2020 2020 2020 6261 7365              base
+00004620: 666f 6c64 6572 203d 2073 656c 662e 6f70  folder = self.op
+00004630: 7469 6f6e 732e 6765 7428 2762 6173 6566  tions.get('basef
+00004640: 6f6c 6465 7227 290a 2020 2020 2020 2020  older').        
+00004650: 2020 2020 2020 2020 6476 7320 3d20 7365          dvs = se
+00004660: 6c66 2e6f 7074 696f 6e73 2e67 6574 2827  lf.options.get('
+00004670: 6476 7327 2c20 5472 7565 290a 2020 2020  dvs', True).    
+00004680: 2020 2020 2020 2020 2020 2020 696d 706f              impo
+00004690: 7274 5f6e 6574 776f 726b 203d 2073 656c  rt_network = sel
+000046a0: 662e 6f70 7469 6f6e 732e 6765 7428 2769  f.options.get('i
+000046b0: 6d70 6f72 745f 6e65 7477 6f72 6b27 2c20  mport_network', 
+000046c0: 2756 4d20 4e65 7477 6f72 6b27 290a 2020  'VM Network').  
+000046d0: 2020 2020 2020 2020 2020 2020 2020 7469                ti
+000046e0: 6d65 6f75 7420 3d20 7365 6c66 2e6f 7074  meout = self.opt
+000046f0: 696f 6e73 2e67 6574 2827 7469 6d65 6f75  ions.get('timeou
+00004700: 7427 2c20 3237 3030 290a 2020 2020 2020  t', 2700).      
+00004710: 2020 2020 2020 2020 2020 666f 7263 655f            force_
+00004720: 706f 6f6c 203d 2073 656c 662e 6f70 7469  pool = self.opti
+00004730: 6f6e 732e 6765 7428 2766 6f72 6365 5f70  ons.get('force_p
+00004740: 6f6f 6c27 2c20 4661 6c73 6529 0a20 2020  ool', False).   
+00004750: 2020 2020 2020 2020 2020 2020 2074 7279               try
+00004760: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00004770: 2020 2020 2020 6672 6f6d 206b 7669 7274        from kvirt
+00004780: 2e70 726f 7669 6465 7273 2e76 7370 6865  .providers.vsphe
+00004790: 7265 2069 6d70 6f72 7420 4b73 7068 6572  re import Kspher
+000047a0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+000047b0: 2020 6578 6365 7074 3a0a 2020 2020 2020    except:.      
+000047c0: 2020 2020 2020 2020 2020 2020 2020 6465                de
+000047d0: 7065 6e64 656e 6379 5f65 7272 6f72 2827  pendency_error('
+000047e0: 7673 7068 6572 6527 290a 2020 2020 2020  vsphere').      
+000047f0: 2020 2020 2020 2020 2020 6b20 3d20 4b73            k = Ks
+00004800: 7068 6572 6528 7365 6c66 2e68 6f73 742c  phere(self.host,
+00004810: 2075 7365 722c 2070 6173 7377 6f72 642c   user, password,
+00004820: 2064 6174 6163 656e 7465 722c 2063 6c75   datacenter, clu
+00004830: 7374 6572 2c20 6973 6f66 6f6c 6465 723d  ster, isofolder=
+00004840: 6973 6f66 6f6c 6465 722c 2064 6562 7567  isofolder, debug
+00004850: 3d64 6562 7567 2c0a 2020 2020 2020 2020  =debug,.        
+00004860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004870: 2020 2020 6669 6c74 6572 766d 733d 6669      filtervms=fi
+00004880: 6c74 6572 766d 732c 2066 696c 7465 7275  ltervms, filteru
+00004890: 7365 723d 6669 6c74 6572 7573 6572 2c20  ser=filteruser, 
+000048a0: 6669 6c74 6572 7461 673d 6669 6c74 6572  filtertag=filter
+000048b0: 7461 672c 2063 6174 6567 6f72 793d 6361  tag, category=ca
+000048c0: 7465 676f 7279 2c0a 2020 2020 2020 2020  tegory,.        
+000048d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000048e0: 2020 2020 6261 7365 666f 6c64 6572 3d62      basefolder=b
+000048f0: 6173 6566 6f6c 6465 722c 2064 7673 3d64  asefolder, dvs=d
+00004900: 7673 2c20 696d 706f 7274 5f6e 6574 776f  vs, import_netwo
+00004910: 726b 3d69 6d70 6f72 745f 6e65 7477 6f72  rk=import_networ
+00004920: 6b2c 2074 696d 656f 7574 3d74 696d 656f  k, timeout=timeo
+00004930: 7574 2c0a 2020 2020 2020 2020 2020 2020  ut,.            
+00004940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004950: 666f 7263 655f 706f 6f6c 3d66 6f72 6365  force_pool=force
+00004960: 5f70 6f6f 6c29 0a20 2020 2020 2020 2020  _pool).         
+00004970: 2020 2065 6c69 6620 7365 6c66 2e74 7970     elif self.typ
+00004980: 6520 3d3d 2027 7061 636b 6574 273a 0a20  e == 'packet':. 
+00004990: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+000049a0: 7574 685f 746f 6b65 6e20 3d20 7365 6c66  uth_token = self
+000049b0: 2e6f 7074 696f 6e73 2e67 6574 2827 6175  .options.get('au
+000049c0: 7468 5f74 6f6b 656e 2729 0a20 2020 2020  th_token').     
+000049d0: 2020 2020 2020 2020 2020 2069 6620 6175             if au
+000049e0: 7468 5f74 6f6b 656e 2069 7320 4e6f 6e65  th_token is None
+000049f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00004a00: 2020 2020 2020 6572 726f 7228 224d 6973        error("Mis
+00004a10: 7369 6e67 2061 7574 685f 746f 6b65 6e20  sing auth_token 
+00004a20: 696e 2074 6865 2063 6f6e 6669 6775 7261  in the configura
+00004a30: 7469 6f6e 2e20 4c65 6176 696e 6722 290a  tion. Leaving").
 00004a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004a50: 2020 6572 726f 7228 224d 6973 7369 6e67    error("Missing
-00004a60: 2061 7574 685f 746f 6b65 6e20 696e 2074   auth_token in t
-00004a70: 6865 2063 6f6e 6669 6775 7261 7469 6f6e  he configuration
-00004a80: 2e20 4c65 6176 696e 6722 290a 2020 2020  . Leaving").    
-00004a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004aa0: 7379 732e 6578 6974 2831 290a 2020 2020  sys.exit(1).    
-00004ab0: 2020 2020 2020 2020 2020 2020 7072 6f6a              proj
-00004ac0: 6563 7420 3d20 7365 6c66 2e6f 7074 696f  ect = self.optio
-00004ad0: 6e73 2e67 6574 2827 7072 6f6a 6563 7427  ns.get('project'
-00004ae0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00004af0: 2020 6966 2070 726f 6a65 6374 2069 7320    if project is 
-00004b00: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00004b10: 2020 2020 2020 2020 2020 6572 726f 7228            error(
-00004b20: 224d 6973 7369 6e67 2070 726f 6a65 6374  "Missing project
-00004b30: 2069 6e20 7468 6520 636f 6e66 6967 7572   in the configur
-00004b40: 6174 696f 6e2e 204c 6561 7669 6e67 2229  ation. Leaving")
-00004b50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004b60: 2020 2020 2073 7973 2e65 7869 7428 3129       sys.exit(1)
-00004b70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004b80: 2066 6163 696c 6974 7920 3d20 7365 6c66   facility = self
-00004b90: 2e6f 7074 696f 6e73 2e67 6574 2827 6661  .options.get('fa
-00004ba0: 6369 6c69 7479 2729 0a20 2020 2020 2020  cility').       
-00004bb0: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
-00004bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004bd0: 2020 6672 6f6d 206b 7669 7274 2e70 726f    from kvirt.pro
-00004be0: 7669 6465 7273 2e70 6163 6b65 7420 696d  viders.packet im
-00004bf0: 706f 7274 204b 7061 636b 6574 0a20 2020  port Kpacket.   
-00004c00: 2020 2020 2020 2020 2020 2020 2065 7863               exc
-00004c10: 6570 743a 0a20 2020 2020 2020 2020 2020  ept:.           
-00004c20: 2020 2020 2020 2020 2064 6570 656e 6465           depende
-00004c30: 6e63 795f 6572 726f 7228 2770 6163 6b65  ncy_error('packe
-00004c40: 7427 290a 2020 2020 2020 2020 2020 2020  t').            
-00004c50: 2020 2020 6b20 3d20 4b70 6163 6b65 7428      k = Kpacket(
-00004c60: 6175 7468 5f74 6f6b 656e 2c20 7072 6f6a  auth_token, proj
-00004c70: 6563 742c 2066 6163 696c 6974 793d 6661  ect, facility=fa
-00004c80: 6369 6c69 7479 2c20 6465 6275 673d 6465  cility, debug=de
-00004c90: 6275 672c 0a20 2020 2020 2020 2020 2020  bug,.           
-00004ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004cb0: 2074 756e 6e65 6c68 6f73 743d 7365 6c66   tunnelhost=self
-00004cc0: 2e74 756e 6e65 6c68 6f73 742c 2074 756e  .tunnelhost, tun
-00004cd0: 6e65 6c75 7365 723d 7365 6c66 2e74 756e  neluser=self.tun
-00004ce0: 6e65 6c75 7365 722c 2074 756e 6e65 6c70  neluser, tunnelp
-00004cf0: 6f72 743d 7365 6c66 2e74 756e 6e65 6c70  ort=self.tunnelp
-00004d00: 6f72 742c 0a20 2020 2020 2020 2020 2020  ort,.           
-00004d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004d20: 2074 756e 6e65 6c64 6972 3d73 656c 662e   tunneldir=self.
-00004d30: 7475 6e6e 656c 6469 7229 0a20 2020 2020  tunneldir).     
-00004d40: 2020 2020 2020 2065 6c69 6620 7365 6c66         elif self
-00004d50: 2e74 7970 6520 3d3d 2027 7072 6f78 6d6f  .type == 'proxmo
-00004d60: 7827 3a0a 2020 2020 2020 2020 2020 2020  x':.            
-00004d70: 2020 2020 7761 726e 696e 6728 2250 726f      warning("Pro
-00004d80: 786d 6f78 2070 726f 7669 6465 7220 6973  xmox provider is
-00004d90: 2057 6f72 6b20 496e 2050 726f 6772 6573   Work In Progres
-00004da0: 732e 2055 7365 2061 7420 796f 7572 206f  s. Use at your o
-00004db0: 776e 2072 6973 6b21 2229 0a20 2020 2020  wn risk!").     
-00004dc0: 2020 2020 2020 2020 2020 2075 7365 7220             user 
-00004dd0: 3d20 7365 6c66 2e6f 7074 696f 6e73 2e67  = self.options.g
-00004de0: 6574 2827 7573 6572 2729 0a20 2020 2020  et('user').     
-00004df0: 2020 2020 2020 2020 2020 2069 6620 7573             if us
-00004e00: 6572 2069 7320 4e6f 6e65 3a0a 2020 2020  er is None:.    
-00004e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004e20: 6572 726f 7228 224d 6973 7369 6e67 2075  error("Missing u
-00004e30: 7365 7220 696e 2074 6865 2063 6f6e 6669  ser in the confi
-00004e40: 6775 7261 7469 6f6e 2e20 4c65 6176 696e  guration. Leavin
-00004e50: 6722 290a 2020 2020 2020 2020 2020 2020  g").            
-00004e60: 2020 2020 2020 2020 7379 732e 6578 6974          sys.exit
-00004e70: 2831 290a 2020 2020 2020 2020 2020 2020  (1).            
-00004e80: 2020 2020 6175 7468 5f74 6f6b 656e 5f6e      auth_token_n
-00004e90: 616d 6520 3d20 7365 6c66 2e6f 7074 696f  ame = self.optio
-00004ea0: 6e73 2e67 6574 2827 6175 7468 5f74 6f6b  ns.get('auth_tok
-00004eb0: 656e 5f6e 616d 6527 290a 2020 2020 2020  en_name').      
-00004ec0: 2020 2020 2020 2020 2020 7061 7373 776f            passwo
-00004ed0: 7264 203d 2073 656c 662e 6f70 7469 6f6e  rd = self.option
-00004ee0: 732e 6765 7428 2770 6173 7377 6f72 6427  s.get('password'
-00004ef0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00004f00: 2020 6966 206e 6f74 2061 7574 685f 746f    if not auth_to
-00004f10: 6b65 6e5f 6e61 6d65 2061 6e64 206e 6f74  ken_name and not
-00004f20: 2070 6173 7377 6f72 643a 0a20 2020 2020   password:.     
-00004f30: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00004f40: 7272 6f72 2822 4d69 7373 696e 6720 6175  rror("Missing au
-00004f50: 7468 5f74 6f6b 656e 5f6e 616d 6520 6f72  th_token_name or
-00004f60: 2070 6173 7377 6f72 6420 696e 2074 6865   password in the
-00004f70: 2063 6f6e 6669 6775 7261 7469 6f6e 2e20   configuration. 
-00004f80: 4c65 6176 696e 6722 290a 2020 2020 2020  Leaving").      
-00004f90: 2020 2020 2020 2020 2020 2020 2020 7379                sy
-00004fa0: 732e 6578 6974 2831 290a 2020 2020 2020  s.exit(1).      
-00004fb0: 2020 2020 2020 2020 2020 6175 7468 5f74            auth_t
-00004fc0: 6f6b 656e 5f73 6563 7265 7420 3d20 7365  oken_secret = se
-00004fd0: 6c66 2e6f 7074 696f 6e73 2e67 6574 2827  lf.options.get('
-00004fe0: 6175 7468 5f74 6f6b 656e 5f73 6563 7265  auth_token_secre
-00004ff0: 7427 290a 2020 2020 2020 2020 2020 2020  t').            
-00005000: 2020 2020 6966 2061 7574 685f 746f 6b65      if auth_toke
-00005010: 6e5f 6e61 6d65 2061 6e64 2061 7574 685f  n_name and auth_
-00005020: 746f 6b65 6e5f 7365 6372 6574 2069 7320  token_secret is 
-00005030: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00005040: 2020 2020 2020 2020 2020 6572 726f 7228            error(
-00005050: 224d 6973 7369 6e67 2061 7574 685f 746f  "Missing auth_to
-00005060: 6b65 6e5f 7365 6372 6574 2069 6e20 7468  ken_secret in th
-00005070: 6520 636f 6e66 6967 7572 6174 696f 6e2e  e configuration.
-00005080: 204c 6561 7669 6e67 2229 0a20 2020 2020   Leaving").     
-00005090: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000050a0: 7973 2e65 7869 7428 3129 0a20 2020 2020  ys.exit(1).     
-000050b0: 2020 2020 2020 2020 2020 2066 696c 7465             filte
-000050c0: 7274 6167 203d 2073 656c 662e 6f70 7469  rtag = self.opti
-000050d0: 6f6e 732e 6765 7428 2766 696c 7465 7274  ons.get('filtert
-000050e0: 6167 2729 0a20 2020 2020 2020 2020 2020  ag').           
-000050f0: 2020 2020 206e 6f64 6520 3d20 7365 6c66       node = self
-00005100: 2e6f 7074 696f 6e73 2e67 6574 2827 6e6f  .options.get('no
-00005110: 6465 2729 0a20 2020 2020 2020 2020 2020  de').           
-00005120: 2020 2020 2076 6572 6966 795f 7373 6c20       verify_ssl 
-00005130: 3d20 7365 6c66 2e6f 7074 696f 6e73 2e67  = self.options.g
-00005140: 6574 2827 7665 7269 6679 5f73 736c 2729  et('verify_ssl')
-00005150: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005160: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-00005170: 2020 2020 2020 2020 2020 6672 6f6d 206b            from k
-00005180: 7669 7274 2e70 726f 7669 6465 7273 2e70  virt.providers.p
-00005190: 726f 786d 6f78 2069 6d70 6f72 7420 4b70  roxmox import Kp
-000051a0: 726f 786d 6f78 0a20 2020 2020 2020 2020  roxmox.         
-000051b0: 2020 2020 2020 2065 7863 6570 743a 0a20         except:. 
-000051c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000051d0: 2020 2064 6570 656e 6465 6e63 795f 6572     dependency_er
-000051e0: 726f 7228 2770 726f 786d 6f78 2729 0a20  ror('proxmox'). 
-000051f0: 2020 2020 2020 2020 2020 2020 2020 206b                 k
-00005200: 203d 204b 7072 6f78 6d6f 7828 0a20 2020   = Kproxmox(.   
-00005210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005220: 2068 6f73 743d 7365 6c66 2e68 6f73 742c   host=self.host,
-00005230: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005240: 2020 2020 2070 6f72 743d 4e6f 6e65 2c0a       port=None,.
-00005250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005260: 2020 2020 7573 6572 3d75 7365 722c 0a20      user=user,. 
-00005270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005280: 2020 2070 6173 7377 6f72 643d 7061 7373     password=pass
-00005290: 776f 7264 2c0a 2020 2020 2020 2020 2020  word,.          
-000052a0: 2020 2020 2020 2020 2020 746f 6b65 6e5f            token_
-000052b0: 6e61 6d65 3d61 7574 685f 746f 6b65 6e5f  name=auth_token_
-000052c0: 6e61 6d65 2c0a 2020 2020 2020 2020 2020  name,.          
-000052d0: 2020 2020 2020 2020 2020 746f 6b65 6e5f            token_
-000052e0: 7365 6372 6574 3d61 7574 685f 746f 6b65  secret=auth_toke
-000052f0: 6e5f 7365 6372 6574 2c0a 2020 2020 2020  n_secret,.      
-00005300: 2020 2020 2020 2020 2020 2020 2020 6669                fi
-00005310: 6c74 6572 7461 673d 6669 6c74 6572 7461  ltertag=filterta
-00005320: 672c 0a20 2020 2020 2020 2020 2020 2020  g,.             
-00005330: 2020 2020 2020 206e 6f64 653d 6e6f 6465         node=node
-00005340: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00005350: 2020 2020 2020 7665 7269 6679 5f73 736c        verify_ssl
-00005360: 3d76 6572 6966 795f 7373 6c2c 0a20 2020  =verify_ssl,.   
-00005370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005380: 2064 6562 7567 3d46 616c 7365 290a 2020   debug=False).  
-00005390: 2020 2020 2020 2020 2020 656c 6966 2073            elif s
-000053a0: 656c 662e 7479 7065 203d 3d20 2777 6562  elf.type == 'web
-000053b0: 273a 0a20 2020 2020 2020 2020 2020 2020  ':.             
-000053c0: 2020 2070 6f72 7420 3d20 7365 6c66 2e6f     port = self.o
-000053d0: 7074 696f 6e73 2e67 6574 2827 706f 7274  ptions.get('port
-000053e0: 272c 2038 3030 3029 0a20 2020 2020 2020  ', 8000).       
-000053f0: 2020 2020 2020 2020 206c 6f63 616c 6b75           localku
-00005400: 6265 203d 2073 656c 662e 6f70 7469 6f6e  be = self.option
-00005410: 732e 6765 7428 276c 6f63 616c 6b75 6265  s.get('localkube
-00005420: 272c 2054 7275 6529 0a20 2020 2020 2020  ', True).       
-00005430: 2020 2020 2020 2020 2066 726f 6d20 6b76           from kv
-00005440: 6972 742e 7072 6f76 6964 6572 732e 7765  irt.providers.we
-00005450: 6220 696d 706f 7274 204b 7765 6263 6c69  b import Kwebcli
-00005460: 656e 740a 2020 2020 2020 2020 2020 2020  ent.            
-00005470: 2020 2020 6b20 3d20 4b77 6562 636c 6965      k = Kwebclie
-00005480: 6e74 2873 656c 662e 686f 7374 2c20 706f  nt(self.host, po
-00005490: 7274 2c20 6c6f 6361 6c6b 7562 653d 6c6f  rt, localkube=lo
-000054a0: 6361 6c6b 7562 652c 2064 6562 7567 3d64  calkube, debug=d
-000054b0: 6562 7567 290a 2020 2020 2020 2020 2020  ebug).          
-000054c0: 2020 2020 2020 7365 6c66 2e74 7970 6520        self.type 
-000054d0: 3d20 2777 6562 270a 2020 2020 2020 2020  = 'web'.        
-000054e0: 2020 2020 656c 6966 206f 6666 6c69 6e65      elif offline
-000054f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00005500: 2020 6672 6f6d 206b 7669 7274 2e70 726f    from kvirt.pro
-00005510: 7669 6465 7273 2e66 616b 6520 696d 706f  viders.fake impo
-00005520: 7274 204b 6661 6b65 0a20 2020 2020 2020  rt Kfake.       
-00005530: 2020 2020 2020 2020 206b 203d 204b 6661           k = Kfa
-00005540: 6b65 2829 0a20 2020 2020 2020 2020 2020  ke().           
-00005550: 2020 2020 2073 656c 662e 7479 7065 203d       self.type =
-00005560: 2027 6661 6b65 270a 2020 2020 2020 2020   'fake'.        
-00005570: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00005580: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-00005590: 662e 686f 7374 2069 7320 4e6f 6e65 3a0a  f.host is None:.
-000055a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000055b0: 2020 2020 6572 726f 7228 2250 726f 626c      error("Probl
-000055c0: 656d 2070 6172 7369 6e67 2079 6f75 7220  em parsing your 
-000055d0: 636f 6e66 6967 7572 6174 696f 6e20 6669  configuration fi
-000055e0: 6c65 2229 0a20 2020 2020 2020 2020 2020  le").           
-000055f0: 2020 2020 2020 2020 2073 7973 2e65 7869           sys.exi
-00005600: 7428 3129 0a20 2020 2020 2020 2020 2020  t(1).           
-00005610: 2020 2020 2073 6573 7369 6f6e 203d 2073       session = s
-00005620: 656c 662e 6f70 7469 6f6e 732e 6765 7428  elf.options.get(
-00005630: 2773 6573 7369 6f6e 272c 2046 616c 7365  'session', False
-00005640: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00005650: 2020 7265 6d6f 7465 646e 736d 6173 7120    remotednsmasq 
-00005660: 3d20 7365 6c66 2e6f 7074 696f 6e73 2e67  = self.options.g
-00005670: 6574 2827 7265 6d6f 7465 646e 736d 6173  et('remotednsmas
-00005680: 7127 2c20 4661 6c73 6529 0a20 2020 2020  q', False).     
-00005690: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
-000056a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000056b0: 2020 2020 6672 6f6d 206b 7669 7274 2e70      from kvirt.p
-000056c0: 726f 7669 6465 7273 2e6b 766d 2069 6d70  roviders.kvm imp
-000056d0: 6f72 7420 4b76 6972 740a 2020 2020 2020  ort Kvirt.      
-000056e0: 2020 2020 2020 2020 2020 6578 6365 7074            except
-000056f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00005700: 2020 2020 2020 6465 7065 6e64 656e 6379        dependency
-00005710: 5f65 7272 6f72 2827 6c69 6276 6972 7427  _error('libvirt'
-00005720: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00005730: 2020 6b20 3d20 4b76 6972 7428 686f 7374    k = Kvirt(host
-00005740: 3d73 656c 662e 686f 7374 2c20 706f 7274  =self.host, port
-00005750: 3d73 656c 662e 706f 7274 2c20 7573 6572  =self.port, user
-00005760: 3d73 656c 662e 7573 6572 2c20 7072 6f74  =self.user, prot
-00005770: 6f63 6f6c 3d73 656c 662e 7072 6f74 6f63  ocol=self.protoc
-00005780: 6f6c 2c20 7572 6c3d 7365 6c66 2e75 726c  ol, url=self.url
-00005790: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000057a0: 2020 2020 2020 2020 2020 2020 6465 6275              debu
-000057b0: 673d 6465 6275 672c 2069 6e73 6563 7572  g=debug, insecur
-000057c0: 653d 7365 6c66 2e69 6e73 6563 7572 652c  e=self.insecure,
-000057d0: 2073 6573 7369 6f6e 3d73 6573 7369 6f6e   session=session
-000057e0: 2c20 7265 6d6f 7465 646e 736d 6173 713d  , remotednsmasq=
-000057f0: 7265 6d6f 7465 646e 736d 6173 7129 0a20  remotednsmasq). 
-00005800: 2020 2020 2020 2020 2020 2069 6620 6b2e             if k.
-00005810: 636f 6e6e 2069 7320 4e6f 6e65 3a0a 2020  conn is None:.  
-00005820: 2020 2020 2020 2020 2020 2020 2020 6572                er
-00005830: 726f 7228 6622 436f 756c 646e 2774 2063  ror(f"Couldn't c
-00005840: 6f6e 6e65 6374 2074 6f20 636c 6965 6e74  onnect to client
-00005850: 207b 7365 6c66 2e63 6c69 656e 747d 2e20   {self.client}. 
-00005860: 4c65 6176 696e 672e 2e2e 2229 0a20 2020  Leaving...").   
-00005870: 2020 2020 2020 2020 2020 2020 2073 7973               sys
-00005880: 2e65 7869 7428 3129 0a20 2020 2020 2020  .exit(1).       
-00005890: 2020 2020 2066 6f72 2065 7874 7261 636c       for extracl
-000058a0: 6965 6e74 2069 6e20 7365 6c66 2e5f 6578  ient in self._ex
-000058b0: 7472 6163 6c69 656e 7473 3a0a 2020 2020  traclients:.    
-000058c0: 2020 2020 2020 2020 2020 2020 6966 2065              if e
-000058d0: 7874 7261 636c 6965 6e74 206e 6f74 2069  xtraclient not i
-000058e0: 6e20 7365 6c66 2e69 6e69 3a0a 2020 2020  n self.ini:.    
-000058f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005900: 7761 726e 696e 6728 6622 4d69 7373 696e  warning(f"Missin
-00005910: 6720 7365 6374 696f 6e20 666f 7220 636c  g section for cl
-00005920: 6965 6e74 207b 6578 7472 6163 6c69 656e  ient {extraclien
-00005930: 747d 2069 6e20 636f 6e66 6967 2066 696c  t} in config fil
-00005940: 652e 2054 7279 696e 6720 746f 2063 6f6e  e. Trying to con
-00005950: 6e65 6374 2e2e 2e22 290a 2020 2020 2020  nect...").      
-00005960: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00005970: 6c66 2e69 6e69 5b65 7874 7261 636c 6965  lf.ini[extraclie
-00005980: 6e74 5d20 3d20 7b27 686f 7374 273a 2065  nt] = {'host': e
-00005990: 7874 7261 636c 6965 6e74 7d0a 2020 2020  xtraclient}.    
-000059a0: 2020 2020 2020 2020 2020 2020 6320 3d20              c = 
-000059b0: 4b63 6f6e 6669 6728 636c 6965 6e74 3d65  Kconfig(client=e
-000059c0: 7874 7261 636c 6965 6e74 290a 2020 2020  xtraclient).    
-000059d0: 2020 2020 2020 2020 2020 2020 6520 3d20              e = 
-000059e0: 632e 6b0a 2020 2020 2020 2020 2020 2020  c.k.            
-000059f0: 2020 2020 7365 6c66 2e65 7874 7261 636c      self.extracl
-00005a00: 6965 6e74 735b 6578 7472 6163 6c69 656e  ients[extraclien
-00005a10: 745d 203d 2065 0a20 2020 2020 2020 2020  t] = e.         
-00005a20: 2020 2020 2020 2069 6620 652e 636f 6e6e         if e.conn
-00005a30: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-00005a40: 2020 2020 2020 2020 2020 2020 2020 6572                er
-00005a50: 726f 7228 6622 436f 756c 646e 2774 2063  ror(f"Couldn't c
-00005a60: 6f6e 6e65 6374 2074 6f20 7370 6563 6966  onnect to specif
-00005a70: 7920 6879 7065 7276 6973 6f72 207b 6578  y hypervisor {ex
-00005a80: 7472 6163 6c69 656e 747d 2e20 4c65 6176  traclient}. Leav
-00005a90: 696e 672e 2e2e 2229 0a20 2020 2020 2020  ing...").       
-00005aa0: 2020 2020 2020 2020 2020 2020 2073 7973               sys
-00005ab0: 2e65 7869 7428 3129 0a20 2020 2020 2020  .exit(1).       
-00005ac0: 2020 2020 2069 6620 6861 7361 7474 7228       if hasattr(
-00005ad0: 7365 6c66 2c20 2761 6c67 6f72 6974 686d  self, 'algorithm
-00005ae0: 2729 3a0a 2020 2020 2020 2020 2020 2020  '):.            
-00005af0: 2020 2020 6966 2073 656c 662e 616c 676f      if self.algo
-00005b00: 7269 7468 6d20 3d3d 2027 6672 6565 273a  rithm == 'free':
-00005b10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005b20: 2020 2020 2075 7073 7461 7475 7320 3d20       upstatus = 
-00005b30: 5b27 6163 7469 7665 272c 2027 7570 272c  ['active', 'up',
-00005b40: 2027 7275 6e6e 696e 6727 5d0a 2020 2020   'running'].    
-00005b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005b60: 616c 6c63 6c69 7320 3d20 7b73 656c 662e  allclis = {self.
-00005b70: 636c 6965 6e74 3a20 6b7d 0a20 2020 2020  client: k}.     
-00005b80: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-00005b90: 6c6c 636c 6973 2e75 7064 6174 6528 7365  llclis.update(se
-00005ba0: 6c66 2e65 7874 7261 636c 6965 6e74 7329  lf.extraclients)
-00005bb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005bc0: 2020 2020 206d 696e 636c 692c 206d 696e       mincli, min
-00005bd0: 766d 7320 3d20 4e6f 6e65 2c20 4e6f 6e65  vms = None, None
-00005be0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005bf0: 2020 2020 2066 6f72 2063 6c69 2069 6e20       for cli in 
-00005c00: 616c 6c63 6c69 733a 0a20 2020 2020 2020  allclis:.       
-00005c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005c20: 2063 6c69 766d 7320 3d20 6c65 6e28 5b76   clivms = len([v
-00005c30: 6d20 666f 7220 766d 2069 6e20 616c 6c63  m for vm in allc
-00005c40: 6c69 735b 636c 695d 2e6c 6973 7428 2920  lis[cli].list() 
-00005c50: 6966 2076 6d5b 2773 7461 7475 7327 5d2e  if vm['status'].
-00005c60: 6c6f 7765 7228 2920 696e 2075 7073 7461  lower() in upsta
-00005c70: 7475 735d 290a 2020 2020 2020 2020 2020  tus]).          
-00005c80: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00005c90: 206d 696e 766d 7320 6973 204e 6f6e 6520   minvms is None 
-00005ca0: 6f72 2063 6c69 766d 7320 3c20 6d69 6e76  or clivms < minv
-00005cb0: 6d73 3a0a 2020 2020 2020 2020 2020 2020  ms:.            
+00004a50: 2020 2020 7379 732e 6578 6974 2831 290a      sys.exit(1).
+00004a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004a70: 7072 6f6a 6563 7420 3d20 7365 6c66 2e6f  project = self.o
+00004a80: 7074 696f 6e73 2e67 6574 2827 7072 6f6a  ptions.get('proj
+00004a90: 6563 7427 290a 2020 2020 2020 2020 2020  ect').          
+00004aa0: 2020 2020 2020 6966 2070 726f 6a65 6374        if project
+00004ab0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+00004ac0: 2020 2020 2020 2020 2020 2020 2020 6572                er
+00004ad0: 726f 7228 224d 6973 7369 6e67 2070 726f  ror("Missing pro
+00004ae0: 6a65 6374 2069 6e20 7468 6520 636f 6e66  ject in the conf
+00004af0: 6967 7572 6174 696f 6e2e 204c 6561 7669  iguration. Leavi
+00004b00: 6e67 2229 0a20 2020 2020 2020 2020 2020  ng").           
+00004b10: 2020 2020 2020 2020 2073 7973 2e65 7869           sys.exi
+00004b20: 7428 3129 0a20 2020 2020 2020 2020 2020  t(1).           
+00004b30: 2020 2020 2066 6163 696c 6974 7920 3d20       facility = 
+00004b40: 7365 6c66 2e6f 7074 696f 6e73 2e67 6574  self.options.get
+00004b50: 2827 6661 6369 6c69 7479 2729 0a20 2020  ('facility').   
+00004b60: 2020 2020 2020 2020 2020 2020 2074 7279               try
+00004b70: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00004b80: 2020 2020 2020 6672 6f6d 206b 7669 7274        from kvirt
+00004b90: 2e70 726f 7669 6465 7273 2e70 6163 6b65  .providers.packe
+00004ba0: 7420 696d 706f 7274 204b 7061 636b 6574  t import Kpacket
+00004bb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004bc0: 2065 7863 6570 743a 0a20 2020 2020 2020   except:.       
+00004bd0: 2020 2020 2020 2020 2020 2020 2064 6570               dep
+00004be0: 656e 6465 6e63 795f 6572 726f 7228 2770  endency_error('p
+00004bf0: 6163 6b65 7427 290a 2020 2020 2020 2020  acket').        
+00004c00: 2020 2020 2020 2020 6b20 3d20 4b70 6163          k = Kpac
+00004c10: 6b65 7428 6175 7468 5f74 6f6b 656e 2c20  ket(auth_token, 
+00004c20: 7072 6f6a 6563 742c 2066 6163 696c 6974  project, facilit
+00004c30: 793d 6661 6369 6c69 7479 2c20 6465 6275  y=facility, debu
+00004c40: 673d 6465 6275 672c 0a20 2020 2020 2020  g=debug,.       
+00004c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004c60: 2020 2020 2074 756e 6e65 6c68 6f73 743d       tunnelhost=
+00004c70: 7365 6c66 2e74 756e 6e65 6c68 6f73 742c  self.tunnelhost,
+00004c80: 2074 756e 6e65 6c75 7365 723d 7365 6c66   tunneluser=self
+00004c90: 2e74 756e 6e65 6c75 7365 722c 2074 756e  .tunneluser, tun
+00004ca0: 6e65 6c70 6f72 743d 7365 6c66 2e74 756e  nelport=self.tun
+00004cb0: 6e65 6c70 6f72 742c 0a20 2020 2020 2020  nelport,.       
+00004cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004cd0: 2020 2020 2074 756e 6e65 6c64 6972 3d73       tunneldir=s
+00004ce0: 656c 662e 7475 6e6e 656c 6469 7229 0a20  elf.tunneldir). 
+00004cf0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+00004d00: 7365 6c66 2e74 7970 6520 3d3d 2027 7072  self.type == 'pr
+00004d10: 6f78 6d6f 7827 3a0a 2020 2020 2020 2020  oxmox':.        
+00004d20: 2020 2020 2020 2020 7761 726e 696e 6728          warning(
+00004d30: 2250 726f 786d 6f78 2070 726f 7669 6465  "Proxmox provide
+00004d40: 7220 6973 2057 6f72 6b20 496e 2050 726f  r is Work In Pro
+00004d50: 6772 6573 732e 2055 7365 2061 7420 796f  gress. Use at yo
+00004d60: 7572 206f 776e 2072 6973 6b21 2229 0a20  ur own risk!"). 
+00004d70: 2020 2020 2020 2020 2020 2020 2020 2075                 u
+00004d80: 7365 7220 3d20 7365 6c66 2e6f 7074 696f  ser = self.optio
+00004d90: 6e73 2e67 6574 2827 7573 6572 2729 0a20  ns.get('user'). 
+00004da0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00004db0: 6620 7573 6572 2069 7320 4e6f 6e65 3a0a  f user is None:.
+00004dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004dd0: 2020 2020 6572 726f 7228 224d 6973 7369      error("Missi
+00004de0: 6e67 2075 7365 7220 696e 2074 6865 2063  ng user in the c
+00004df0: 6f6e 6669 6775 7261 7469 6f6e 2e20 4c65  onfiguration. Le
+00004e00: 6176 696e 6722 290a 2020 2020 2020 2020  aving").        
+00004e10: 2020 2020 2020 2020 2020 2020 7379 732e              sys.
+00004e20: 6578 6974 2831 290a 2020 2020 2020 2020  exit(1).        
+00004e30: 2020 2020 2020 2020 6175 7468 5f74 6f6b          auth_tok
+00004e40: 656e 5f6e 616d 6520 3d20 7365 6c66 2e6f  en_name = self.o
+00004e50: 7074 696f 6e73 2e67 6574 2827 6175 7468  ptions.get('auth
+00004e60: 5f74 6f6b 656e 5f6e 616d 6527 290a 2020  _token_name').  
+00004e70: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+00004e80: 7373 776f 7264 203d 2073 656c 662e 6f70  ssword = self.op
+00004e90: 7469 6f6e 732e 6765 7428 2770 6173 7377  tions.get('passw
+00004ea0: 6f72 6427 290a 2020 2020 2020 2020 2020  ord').          
+00004eb0: 2020 2020 2020 6966 206e 6f74 2061 7574        if not aut
+00004ec0: 685f 746f 6b65 6e5f 6e61 6d65 2061 6e64  h_token_name and
+00004ed0: 206e 6f74 2070 6173 7377 6f72 643a 0a20   not password:. 
+00004ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004ef0: 2020 2065 7272 6f72 2822 4d69 7373 696e     error("Missin
+00004f00: 6720 6175 7468 5f74 6f6b 656e 5f6e 616d  g auth_token_nam
+00004f10: 6520 6f72 2070 6173 7377 6f72 6420 696e  e or password in
+00004f20: 2074 6865 2063 6f6e 6669 6775 7261 7469   the configurati
+00004f30: 6f6e 2e20 4c65 6176 696e 6722 290a 2020  on. Leaving").  
+00004f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004f50: 2020 7379 732e 6578 6974 2831 290a 2020    sys.exit(1).  
+00004f60: 2020 2020 2020 2020 2020 2020 2020 6175                au
+00004f70: 7468 5f74 6f6b 656e 5f73 6563 7265 7420  th_token_secret 
+00004f80: 3d20 7365 6c66 2e6f 7074 696f 6e73 2e67  = self.options.g
+00004f90: 6574 2827 6175 7468 5f74 6f6b 656e 5f73  et('auth_token_s
+00004fa0: 6563 7265 7427 290a 2020 2020 2020 2020  ecret').        
+00004fb0: 2020 2020 2020 2020 6966 2061 7574 685f          if auth_
+00004fc0: 746f 6b65 6e5f 6e61 6d65 2061 6e64 2061  token_name and a
+00004fd0: 7574 685f 746f 6b65 6e5f 7365 6372 6574  uth_token_secret
+00004fe0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+00004ff0: 2020 2020 2020 2020 2020 2020 2020 6572                er
+00005000: 726f 7228 224d 6973 7369 6e67 2061 7574  ror("Missing aut
+00005010: 685f 746f 6b65 6e5f 7365 6372 6574 2069  h_token_secret i
+00005020: 6e20 7468 6520 636f 6e66 6967 7572 6174  n the configurat
+00005030: 696f 6e2e 204c 6561 7669 6e67 2229 0a20  ion. Leaving"). 
+00005040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005050: 2020 2073 7973 2e65 7869 7428 3129 0a20     sys.exit(1). 
+00005060: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00005070: 696c 7465 7274 6167 203d 2073 656c 662e  iltertag = self.
+00005080: 6f70 7469 6f6e 732e 6765 7428 2766 696c  options.get('fil
+00005090: 7465 7274 6167 2729 0a20 2020 2020 2020  tertag').       
+000050a0: 2020 2020 2020 2020 206e 6f64 6520 3d20           node = 
+000050b0: 7365 6c66 2e6f 7074 696f 6e73 2e67 6574  self.options.get
+000050c0: 2827 6e6f 6465 2729 0a20 2020 2020 2020  ('node').       
+000050d0: 2020 2020 2020 2020 2076 6572 6966 795f           verify_
+000050e0: 7373 6c20 3d20 7365 6c66 2e6f 7074 696f  ssl = self.optio
+000050f0: 6e73 2e67 6574 2827 7665 7269 6679 5f73  ns.get('verify_s
+00005100: 736c 2729 0a20 2020 2020 2020 2020 2020  sl').           
+00005110: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+00005120: 2020 2020 2020 2020 2020 2020 2020 6672                fr
+00005130: 6f6d 206b 7669 7274 2e70 726f 7669 6465  om kvirt.provide
+00005140: 7273 2e70 726f 786d 6f78 2069 6d70 6f72  rs.proxmox impor
+00005150: 7420 4b70 726f 786d 6f78 0a20 2020 2020  t Kproxmox.     
+00005160: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+00005170: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
+00005180: 2020 2020 2020 2064 6570 656e 6465 6e63         dependenc
+00005190: 795f 6572 726f 7228 2770 726f 786d 6f78  y_error('proxmox
+000051a0: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
+000051b0: 2020 206b 203d 204b 7072 6f78 6d6f 7828     k = Kproxmox(
+000051c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000051d0: 2020 2020 2068 6f73 743d 7365 6c66 2e68       host=self.h
+000051e0: 6f73 742c 0a20 2020 2020 2020 2020 2020  ost,.           
+000051f0: 2020 2020 2020 2020 2070 6f72 743d 4e6f           port=No
+00005200: 6e65 2c0a 2020 2020 2020 2020 2020 2020  ne,.            
+00005210: 2020 2020 2020 2020 7573 6572 3d75 7365          user=use
+00005220: 722c 0a20 2020 2020 2020 2020 2020 2020  r,.             
+00005230: 2020 2020 2020 2070 6173 7377 6f72 643d         password=
+00005240: 7061 7373 776f 7264 2c0a 2020 2020 2020  password,.      
+00005250: 2020 2020 2020 2020 2020 2020 2020 746f                to
+00005260: 6b65 6e5f 6e61 6d65 3d61 7574 685f 746f  ken_name=auth_to
+00005270: 6b65 6e5f 6e61 6d65 2c0a 2020 2020 2020  ken_name,.      
+00005280: 2020 2020 2020 2020 2020 2020 2020 746f                to
+00005290: 6b65 6e5f 7365 6372 6574 3d61 7574 685f  ken_secret=auth_
+000052a0: 746f 6b65 6e5f 7365 6372 6574 2c0a 2020  token_secret,.  
+000052b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000052c0: 2020 6669 6c74 6572 7461 673d 6669 6c74    filtertag=filt
+000052d0: 6572 7461 672c 0a20 2020 2020 2020 2020  ertag,.         
+000052e0: 2020 2020 2020 2020 2020 206e 6f64 653d             node=
+000052f0: 6e6f 6465 2c0a 2020 2020 2020 2020 2020  node,.          
+00005300: 2020 2020 2020 2020 2020 7665 7269 6679            verify
+00005310: 5f73 736c 3d76 6572 6966 795f 7373 6c2c  _ssl=verify_ssl,
+00005320: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005330: 2020 2020 2064 6562 7567 3d46 616c 7365       debug=False
+00005340: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
+00005350: 6966 2073 656c 662e 7479 7065 203d 3d20  if self.type == 
+00005360: 2777 6562 273a 0a20 2020 2020 2020 2020  'web':.         
+00005370: 2020 2020 2020 2070 6f72 7420 3d20 7365         port = se
+00005380: 6c66 2e6f 7074 696f 6e73 2e67 6574 2827  lf.options.get('
+00005390: 706f 7274 272c 2038 3030 3029 0a20 2020  port', 8000).   
+000053a0: 2020 2020 2020 2020 2020 2020 206c 6f63               loc
+000053b0: 616c 6b75 6265 203d 2073 656c 662e 6f70  alkube = self.op
+000053c0: 7469 6f6e 732e 6765 7428 276c 6f63 616c  tions.get('local
+000053d0: 6b75 6265 272c 2054 7275 6529 0a20 2020  kube', True).   
+000053e0: 2020 2020 2020 2020 2020 2020 2066 726f               fro
+000053f0: 6d20 6b76 6972 742e 7072 6f76 6964 6572  m kvirt.provider
+00005400: 732e 7765 6220 696d 706f 7274 204b 7765  s.web import Kwe
+00005410: 6263 6c69 656e 740a 2020 2020 2020 2020  bclient.        
+00005420: 2020 2020 2020 2020 6b20 3d20 4b77 6562          k = Kweb
+00005430: 636c 6965 6e74 2873 656c 662e 686f 7374  client(self.host
+00005440: 2c20 706f 7274 2c20 6c6f 6361 6c6b 7562  , port, localkub
+00005450: 653d 6c6f 6361 6c6b 7562 652c 2064 6562  e=localkube, deb
+00005460: 7567 3d64 6562 7567 290a 2020 2020 2020  ug=debug).      
+00005470: 2020 2020 2020 2020 2020 7365 6c66 2e74            self.t
+00005480: 7970 6520 3d20 2777 6562 270a 2020 2020  ype = 'web'.    
+00005490: 2020 2020 2020 2020 656c 6966 206f 6666          elif off
+000054a0: 6c69 6e65 3a0a 2020 2020 2020 2020 2020  line:.          
+000054b0: 2020 2020 2020 6672 6f6d 206b 7669 7274        from kvirt
+000054c0: 2e70 726f 7669 6465 7273 2e66 616b 6520  .providers.fake 
+000054d0: 696d 706f 7274 204b 6661 6b65 0a20 2020  import Kfake.   
+000054e0: 2020 2020 2020 2020 2020 2020 206b 203d               k =
+000054f0: 204b 6661 6b65 2829 0a20 2020 2020 2020   Kfake().       
+00005500: 2020 2020 2020 2020 2073 656c 662e 7479           self.ty
+00005510: 7065 203d 2027 6661 6b65 270a 2020 2020  pe = 'fake'.    
+00005520: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00005530: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00005540: 2073 656c 662e 686f 7374 2069 7320 4e6f   self.host is No
+00005550: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00005560: 2020 2020 2020 2020 6572 726f 7228 2250          error("P
+00005570: 726f 626c 656d 2070 6172 7369 6e67 2079  roblem parsing y
+00005580: 6f75 7220 636f 6e66 6967 7572 6174 696f  our configuratio
+00005590: 6e20 6669 6c65 2229 0a20 2020 2020 2020  n file").       
+000055a0: 2020 2020 2020 2020 2020 2020 2073 7973               sys
+000055b0: 2e65 7869 7428 3129 0a20 2020 2020 2020  .exit(1).       
+000055c0: 2020 2020 2020 2020 2073 6573 7369 6f6e           session
+000055d0: 203d 2073 656c 662e 6f70 7469 6f6e 732e   = self.options.
+000055e0: 6765 7428 2773 6573 7369 6f6e 272c 2046  get('session', F
+000055f0: 616c 7365 290a 2020 2020 2020 2020 2020  alse).          
+00005600: 2020 2020 2020 7265 6d6f 7465 646e 736d        remotednsm
+00005610: 6173 7120 3d20 7365 6c66 2e6f 7074 696f  asq = self.optio
+00005620: 6e73 2e67 6574 2827 7265 6d6f 7465 646e  ns.get('remotedn
+00005630: 736d 6173 7127 2c20 4661 6c73 6529 0a20  smasq', False). 
+00005640: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00005650: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+00005660: 2020 2020 2020 2020 6672 6f6d 206b 7669          from kvi
+00005670: 7274 2e70 726f 7669 6465 7273 2e6b 766d  rt.providers.kvm
+00005680: 2069 6d70 6f72 7420 4b76 6972 740a 2020   import Kvirt.  
+00005690: 2020 2020 2020 2020 2020 2020 2020 6578                ex
+000056a0: 6365 7074 3a0a 2020 2020 2020 2020 2020  cept:.          
+000056b0: 2020 2020 2020 2020 2020 6465 7065 6e64            depend
+000056c0: 656e 6379 5f65 7272 6f72 2827 6c69 6276  ency_error('libv
+000056d0: 6972 7427 290a 2020 2020 2020 2020 2020  irt').          
+000056e0: 2020 2020 2020 6b20 3d20 4b76 6972 7428        k = Kvirt(
+000056f0: 686f 7374 3d73 656c 662e 686f 7374 2c20  host=self.host, 
+00005700: 706f 7274 3d73 656c 662e 706f 7274 2c20  port=self.port, 
+00005710: 7573 6572 3d73 656c 662e 7573 6572 2c20  user=self.user, 
+00005720: 7072 6f74 6f63 6f6c 3d73 656c 662e 7072  protocol=self.pr
+00005730: 6f74 6f63 6f6c 2c20 7572 6c3d 7365 6c66  otocol, url=self
+00005740: 2e75 726c 2c0a 2020 2020 2020 2020 2020  .url,.          
+00005750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005760: 6465 6275 673d 6465 6275 672c 2069 6e73  debug=debug, ins
+00005770: 6563 7572 653d 7365 6c66 2e69 6e73 6563  ecure=self.insec
+00005780: 7572 652c 2073 6573 7369 6f6e 3d73 6573  ure, session=ses
+00005790: 7369 6f6e 2c20 7265 6d6f 7465 646e 736d  sion, remotednsm
+000057a0: 6173 713d 7265 6d6f 7465 646e 736d 6173  asq=remotednsmas
+000057b0: 7129 0a20 2020 2020 2020 2020 2020 2069  q).            i
+000057c0: 6620 6b2e 636f 6e6e 2069 7320 4e6f 6e65  f k.conn is None
+000057d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000057e0: 2020 6572 726f 7228 6622 436f 756c 646e    error(f"Couldn
+000057f0: 2774 2063 6f6e 6e65 6374 2074 6f20 636c  't connect to cl
+00005800: 6965 6e74 207b 7365 6c66 2e63 6c69 656e  ient {self.clien
+00005810: 747d 2e20 4c65 6176 696e 672e 2e2e 2229  t}. Leaving...")
+00005820: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005830: 2073 7973 2e65 7869 7428 3129 0a20 2020   sys.exit(1).   
+00005840: 2020 2020 2020 2020 2066 6f72 2065 7874           for ext
+00005850: 7261 636c 6965 6e74 2069 6e20 7365 6c66  raclient in self
+00005860: 2e5f 6578 7472 6163 6c69 656e 7473 3a0a  ._extraclients:.
+00005870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005880: 6966 2065 7874 7261 636c 6965 6e74 206e  if extraclient n
+00005890: 6f74 2069 6e20 7365 6c66 2e69 6e69 3a0a  ot in self.ini:.
+000058a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000058b0: 2020 2020 7761 726e 696e 6728 6622 4d69      warning(f"Mi
+000058c0: 7373 696e 6720 7365 6374 696f 6e20 666f  ssing section fo
+000058d0: 7220 636c 6965 6e74 207b 6578 7472 6163  r client {extrac
+000058e0: 6c69 656e 747d 2069 6e20 636f 6e66 6967  lient} in config
+000058f0: 2066 696c 652e 2054 7279 696e 6720 746f   file. Trying to
+00005900: 2063 6f6e 6e65 6374 2e2e 2e22 290a 2020   connect...").  
+00005910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005920: 2020 7365 6c66 2e69 6e69 5b65 7874 7261    self.ini[extra
+00005930: 636c 6965 6e74 5d20 3d20 7b27 686f 7374  client] = {'host
+00005940: 273a 2065 7874 7261 636c 6965 6e74 7d0a  ': extraclient}.
+00005950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005960: 6320 3d20 4b63 6f6e 6669 6728 636c 6965  c = Kconfig(clie
+00005970: 6e74 3d65 7874 7261 636c 6965 6e74 290a  nt=extraclient).
+00005980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005990: 6520 3d20 632e 6b0a 2020 2020 2020 2020  e = c.k.        
+000059a0: 2020 2020 2020 2020 7365 6c66 2e65 7874          self.ext
+000059b0: 7261 636c 6965 6e74 735b 6578 7472 6163  raclients[extrac
+000059c0: 6c69 656e 745d 203d 2065 0a20 2020 2020  lient] = e.     
+000059d0: 2020 2020 2020 2020 2020 2069 6620 652e             if e.
+000059e0: 636f 6e6e 2069 7320 4e6f 6e65 3a0a 2020  conn is None:.  
+000059f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005a00: 2020 6572 726f 7228 6622 436f 756c 646e    error(f"Couldn
+00005a10: 2774 2063 6f6e 6e65 6374 2074 6f20 7370  't connect to sp
+00005a20: 6563 6966 7920 6879 7065 7276 6973 6f72  ecify hypervisor
+00005a30: 207b 6578 7472 6163 6c69 656e 747d 2e20   {extraclient}. 
+00005a40: 4c65 6176 696e 672e 2e2e 2229 0a20 2020  Leaving...").   
+00005a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005a60: 2073 7973 2e65 7869 7428 3129 0a20 2020   sys.exit(1).   
+00005a70: 2020 2020 2020 2020 2069 6620 6861 7361           if hasa
+00005a80: 7474 7228 7365 6c66 2c20 2761 6c67 6f72  ttr(self, 'algor
+00005a90: 6974 686d 2729 3a0a 2020 2020 2020 2020  ithm'):.        
+00005aa0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00005ab0: 616c 676f 7269 7468 6d20 3d3d 2027 6672  algorithm == 'fr
+00005ac0: 6565 273a 0a20 2020 2020 2020 2020 2020  ee':.           
+00005ad0: 2020 2020 2020 2020 2075 7073 7461 7475           upstatu
+00005ae0: 7320 3d20 5b27 6163 7469 7665 272c 2027  s = ['active', '
+00005af0: 7570 272c 2027 7275 6e6e 696e 6727 5d0a  up', 'running'].
+00005b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005b10: 2020 2020 616c 6c63 6c69 7320 3d20 7b73      allclis = {s
+00005b20: 656c 662e 636c 6965 6e74 3a20 6b7d 0a20  elf.client: k}. 
+00005b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005b40: 2020 2061 6c6c 636c 6973 2e75 7064 6174     allclis.updat
+00005b50: 6528 7365 6c66 2e65 7874 7261 636c 6965  e(self.extraclie
+00005b60: 6e74 7329 0a20 2020 2020 2020 2020 2020  nts).           
+00005b70: 2020 2020 2020 2020 206d 696e 636c 692c           mincli,
+00005b80: 206d 696e 766d 7320 3d20 4e6f 6e65 2c20   minvms = None, 
+00005b90: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
+00005ba0: 2020 2020 2020 2020 2066 6f72 2063 6c69           for cli
+00005bb0: 2069 6e20 616c 6c63 6c69 733a 0a20 2020   in allclis:.   
+00005bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005bd0: 2020 2020 2063 6c69 766d 7320 3d20 6c65       clivms = le
+00005be0: 6e28 5b76 6d20 666f 7220 766d 2069 6e20  n([vm for vm in 
+00005bf0: 616c 6c63 6c69 735b 636c 695d 2e6c 6973  allclis[cli].lis
+00005c00: 7428 2920 6966 2076 6d5b 2773 7461 7475  t() if vm['statu
+00005c10: 7327 5d2e 6c6f 7765 7228 2920 696e 2075  s'].lower() in u
+00005c20: 7073 7461 7475 735d 290a 2020 2020 2020  pstatus]).      
+00005c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005c40: 2020 6966 206d 696e 766d 7320 6973 204e    if minvms is N
+00005c50: 6f6e 6520 6f72 2063 6c69 766d 7320 3c20  one or clivms < 
+00005c60: 6d69 6e76 6d73 3a0a 2020 2020 2020 2020  minvms:.        
+00005c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005c80: 2020 2020 6d69 6e63 6c69 203d 2063 6c69      mincli = cli
+00005c90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005ca0: 2020 2020 2020 2020 2020 2020 206d 696e               min
+00005cb0: 766d 7320 3d20 636c 6976 6d73 0a20 2020  vms = clivms.   
 00005cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005cd0: 6d69 6e63 6c69 203d 2063 6c69 0a20 2020  mincli = cli.   
-00005ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005cf0: 2020 2020 2020 2020 206d 696e 766d 7320           minvms 
-00005d00: 3d20 636c 6976 6d73 0a20 2020 2020 2020  = clivms.       
-00005d10: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00005d20: 6d69 6e63 6c69 2021 3d20 7365 6c66 2e63  mincli != self.c
-00005d30: 6c69 656e 743a 0a20 2020 2020 2020 2020  lient:.         
-00005d40: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00005d50: 656c 662e 6578 7472 6163 6c69 656e 7473  elf.extraclients
-00005d60: 5b73 656c 662e 636c 6965 6e74 5d20 3d20  [self.client] = 
-00005d70: 6b0a 2020 2020 2020 2020 2020 2020 2020  k.              
-00005d80: 2020 2020 2020 2020 2020 6b20 3d20 7365            k = se
-00005d90: 6c66 2e65 7874 7261 636c 6965 6e74 735b  lf.extraclients[
-00005da0: 6d69 6e63 6c69 5d0a 2020 2020 2020 2020  mincli].        
-00005db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005dc0: 6465 6c20 7365 6c66 2e65 7874 7261 636c  del self.extracl
-00005dd0: 6965 6e74 735b 6d69 6e63 6c69 5d0a 2020  ients[mincli].  
-00005de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005df0: 2020 2020 2020 7365 6c66 2e63 6c69 656e        self.clien
-00005e00: 7420 3d20 6d69 6e63 6c69 0a20 2020 2020  t = mincli.     
-00005e10: 2020 2020 2020 2020 2020 2069 6620 7365             if se
-00005e20: 6c66 2e61 6c67 6f72 6974 686d 203d 3d20  lf.algorithm == 
-00005e30: 2762 616c 616e 6365 273a 0a20 2020 2020  'balance':.     
-00005e40: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-00005e50: 656d 6265 7273 203d 205b 7365 6c66 2e63  embers = [self.c
-00005e60: 6c69 656e 745d 202b 206c 6973 7428 7365  lient] + list(se
-00005e70: 6c66 2e65 7874 7261 636c 6965 6e74 732e  lf.extraclients.
-00005e80: 6b65 7973 2829 290a 2020 2020 2020 2020  keys()).        
-00005e90: 2020 2020 2020 2020 2020 2020 6c61 7374              last
-00005ea0: 766d 203d 2022 2573 2f2e 6b63 6c69 2f76  vm = "%s/.kcli/v
-00005eb0: 6d22 2025 206f 732e 656e 7669 726f 6e2e  m" % os.environ.
-00005ec0: 6765 7428 2748 4f4d 4527 290a 2020 2020  get('HOME').    
+00005cd0: 2069 6620 6d69 6e63 6c69 2021 3d20 7365   if mincli != se
+00005ce0: 6c66 2e63 6c69 656e 743a 0a20 2020 2020  lf.client:.     
+00005cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005d00: 2020 2073 656c 662e 6578 7472 6163 6c69     self.extracli
+00005d10: 656e 7473 5b73 656c 662e 636c 6965 6e74  ents[self.client
+00005d20: 5d20 3d20 6b0a 2020 2020 2020 2020 2020  ] = k.          
+00005d30: 2020 2020 2020 2020 2020 2020 2020 6b20                k 
+00005d40: 3d20 7365 6c66 2e65 7874 7261 636c 6965  = self.extraclie
+00005d50: 6e74 735b 6d69 6e63 6c69 5d0a 2020 2020  nts[mincli].    
+00005d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005d70: 2020 2020 6465 6c20 7365 6c66 2e65 7874      del self.ext
+00005d80: 7261 636c 6965 6e74 735b 6d69 6e63 6c69  raclients[mincli
+00005d90: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+00005da0: 2020 2020 2020 2020 2020 7365 6c66 2e63            self.c
+00005db0: 6c69 656e 7420 3d20 6d69 6e63 6c69 0a20  lient = mincli. 
+00005dc0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00005dd0: 6620 7365 6c66 2e61 6c67 6f72 6974 686d  f self.algorithm
+00005de0: 203d 3d20 2762 616c 616e 6365 273a 0a20   == 'balance':. 
+00005df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005e00: 2020 206d 656d 6265 7273 203d 205b 7365     members = [se
+00005e10: 6c66 2e63 6c69 656e 745d 202b 206c 6973  lf.client] + lis
+00005e20: 7428 7365 6c66 2e65 7874 7261 636c 6965  t(self.extraclie
+00005e30: 6e74 732e 6b65 7973 2829 290a 2020 2020  nts.keys()).    
+00005e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005e50: 6c61 7374 766d 203d 2022 2573 2f2e 6b63  lastvm = "%s/.kc
+00005e60: 6c69 2f76 6d22 2025 206f 732e 656e 7669  li/vm" % os.envi
+00005e70: 726f 6e2e 6765 7428 2748 4f4d 4527 290a  ron.get('HOME').
+00005e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005e90: 2020 2020 6966 206f 732e 7061 7468 2e65      if os.path.e
+00005ea0: 7869 7374 7328 6c61 7374 766d 2920 616e  xists(lastvm) an
+00005eb0: 6420 6f73 2e73 7461 7428 6c61 7374 766d  d os.stat(lastvm
+00005ec0: 292e 7374 5f73 697a 6520 3e20 303a 0a20  ).st_size > 0:. 
 00005ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005ee0: 6966 206f 732e 7061 7468 2e65 7869 7374  if os.path.exist
-00005ef0: 7328 6c61 7374 766d 2920 616e 6420 6f73  s(lastvm) and os
-00005f00: 2e73 7461 7428 6c61 7374 766d 292e 7374  .stat(lastvm).st
-00005f10: 5f73 697a 6520 3e20 303a 0a20 2020 2020  _size > 0:.     
-00005f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005f30: 2020 2066 6f72 206c 696e 6520 696e 206f     for line in o
-00005f40: 7065 6e28 6c61 7374 766d 292e 7265 6164  pen(lastvm).read
-00005f50: 6c69 6e65 7328 293a 0a20 2020 2020 2020  lines():.       
-00005f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005f70: 2020 2020 206c 696e 6520 3d20 6c69 6e65       line = line
-00005f80: 2e73 706c 6974 2827 2027 290a 2020 2020  .split(' ').    
-00005f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005fa0: 2020 2020 2020 2020 6966 206c 656e 286c          if len(l
-00005fb0: 696e 6529 2021 3d20 323a 0a20 2020 2020  ine) != 2:.     
-00005fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005fd0: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
-00005fe0: 6e75 650a 2020 2020 2020 2020 2020 2020  nue.            
-00005ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006000: 636c 6920 3d20 6c69 6e65 5b30 5d2e 7374  cli = line[0].st
-00006010: 7269 7028 290a 2020 2020 2020 2020 2020  rip().          
+00005ee0: 2020 2020 2020 2066 6f72 206c 696e 6520         for line 
+00005ef0: 696e 206f 7065 6e28 6c61 7374 766d 292e  in open(lastvm).
+00005f00: 7265 6164 6c69 6e65 7328 293a 0a20 2020  readlines():.   
+00005f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005f20: 2020 2020 2020 2020 206c 696e 6520 3d20           line = 
+00005f30: 6c69 6e65 2e73 706c 6974 2827 2027 290a  line.split(' ').
+00005f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005f50: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+00005f60: 656e 286c 696e 6529 2021 3d20 323a 0a20  en(line) != 2:. 
+00005f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005f80: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00005f90: 6f6e 7469 6e75 650a 2020 2020 2020 2020  ontinue.        
+00005fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005fb0: 2020 2020 636c 6920 3d20 6c69 6e65 5b30      cli = line[0
+00005fc0: 5d2e 7374 7269 7028 290a 2020 2020 2020  ].strip().      
+00005fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005fe0: 2020 2020 2020 6966 2063 6c69 2069 6e20        if cli in 
+00005ff0: 6d65 6d62 6572 7320 616e 6420 6d65 6d62  members and memb
+00006000: 6572 732e 696e 6465 7828 636c 6929 203c  ers.index(cli) <
+00006010: 206c 656e 286d 656d 6265 7273 293a 0a20   len(members):. 
 00006020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006030: 2020 6966 2063 6c69 2069 6e20 6d65 6d62    if cli in memb
-00006040: 6572 7320 616e 6420 6d65 6d62 6572 732e  ers and members.
-00006050: 696e 6465 7828 636c 6929 203c 206c 656e  index(cli) < len
-00006060: 286d 656d 6265 7273 293a 0a20 2020 2020  (members):.     
-00006070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006080: 2020 2020 2020 2020 2020 2063 6c69 696e             cliin
-00006090: 6465 7820 3d20 6d65 6d62 6572 732e 696e  dex = members.in
-000060a0: 6465 7828 636c 6929 0a20 2020 2020 2020  dex(cli).       
+00006030: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00006040: 6c69 696e 6465 7820 3d20 6d65 6d62 6572  liindex = member
+00006050: 732e 696e 6465 7828 636c 6929 0a20 2020  s.index(cli).   
+00006060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006070: 2020 2020 2020 2020 2020 2020 206e 6577               new
+00006080: 636c 6920 3d20 6d65 6d62 6572 735b 2863  cli = members[(c
+00006090: 6c69 696e 6465 7820 2b20 3129 2025 206c  liindex + 1) % l
+000060a0: 656e 286d 656d 6265 7273 295d 0a20 2020  en(members)].   
 000060b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000060c0: 2020 2020 2020 2020 206e 6577 636c 6920           newcli 
-000060d0: 3d20 6d65 6d62 6572 735b 2863 6c69 696e  = members[(cliin
-000060e0: 6465 7820 2b20 3129 2025 206c 656e 286d  dex + 1) % len(m
-000060f0: 656d 6265 7273 295d 0a20 2020 2020 2020  embers)].       
-00006100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006110: 2020 2020 2020 2020 2069 6620 6e65 7763           if newc
-00006120: 6c69 2021 3d20 7365 6c66 2e63 6c69 656e  li != self.clien
-00006130: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
+000060c0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+000060d0: 6e65 7763 6c69 2021 3d20 7365 6c66 2e63  newcli != self.c
+000060e0: 6c69 656e 743a 0a20 2020 2020 2020 2020  lient:.         
+000060f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006100: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00006110: 6578 7472 6163 6c69 656e 7473 5b73 656c  extraclients[sel
+00006120: 662e 636c 6965 6e74 5d20 3d20 6b0a 2020  f.client] = k.  
+00006130: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00006140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006150: 2020 2020 2020 2073 656c 662e 6578 7472         self.extr
-00006160: 6163 6c69 656e 7473 5b73 656c 662e 636c  aclients[self.cl
-00006170: 6965 6e74 5d20 3d20 6b0a 2020 2020 2020  ient] = k.      
+00006150: 2020 6b20 3d20 7365 6c66 2e65 7874 7261    k = self.extra
+00006160: 636c 6965 6e74 735b 6e65 7763 6c69 5d0a  clients[newcli].
+00006170: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00006180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006190: 2020 2020 2020 2020 2020 2020 2020 6b20                k 
-000061a0: 3d20 7365 6c66 2e65 7874 7261 636c 6965  = self.extraclie
-000061b0: 6e74 735b 6e65 7763 6c69 5d0a 2020 2020  nts[newcli].    
+00006190: 2020 2020 6465 6c20 7365 6c66 2e65 7874      del self.ext
+000061a0: 7261 636c 6965 6e74 735b 6e65 7763 6c69  raclients[newcli
+000061b0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
 000061c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000061d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000061e0: 6465 6c20 7365 6c66 2e65 7874 7261 636c  del self.extracl
-000061f0: 6965 6e74 735b 6e65 7763 6c69 5d0a 2020  ients[newcli].  
-00006200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006220: 2020 7365 6c66 2e63 6c69 656e 7420 3d20    self.client = 
-00006230: 6e65 7763 6c69 0a20 2020 2020 2020 2020  newcli.         
-00006240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006250: 2020 2020 2020 2062 7265 616b 0a0a 2020         break..  
-00006260: 2020 2020 2020 2020 2020 2020 2020 7070                pp
-00006270: 7269 6e74 2866 2253 656c 6563 7469 6e67  rint(f"Selecting
-00006280: 2063 6c69 656e 7420 7b73 656c 662e 636c   client {self.cl
-00006290: 6965 6e74 7d20 6672 6f6d 2067 726f 7570  ient} from group
-000062a0: 207b 7365 6c66 2e67 726f 7570 7d22 290a   {self.group}").
-000062b0: 2020 2020 2020 2020 7365 6c66 2e6b 203d          self.k =
-000062c0: 206b 0a20 2020 2020 2020 2064 6566 6175   k.        defau
-000062d0: 6c74 5f64 6174 6120 3d20 7b27 636f 6e66  lt_data = {'conf
-000062e0: 6967 5f25 7327 2025 206b 3a20 7365 6c66  ig_%s' % k: self
-000062f0: 2e64 6566 6175 6c74 5b6b 5d20 666f 7220  .default[k] for 
-00006300: 6b20 696e 2073 656c 662e 6465 6661 756c  k in self.defaul
-00006310: 747d 0a20 2020 2020 2020 2063 6f6e 6669  t}.        confi
-00006320: 675f 6461 7461 203d 207b 2763 6f6e 6669  g_data = {'confi
-00006330: 675f 2573 2720 2520 6b3a 2073 656c 662e  g_%s' % k: self.
-00006340: 696e 695b 7365 6c66 2e63 6c69 656e 745d  ini[self.client]
-00006350: 5b6b 5d20 666f 7220 6b20 696e 2073 656c  [k] for k in sel
-00006360: 662e 696e 695b 7365 6c66 2e63 6c69 656e  f.ini[self.clien
-00006370: 745d 7d0a 2020 2020 2020 2020 636f 6e66  t]}.        conf
-00006380: 6967 5f64 6174 615b 2763 6f6e 6669 675f  ig_data['config_
-00006390: 7479 7065 275d 203d 2063 6f6e 6669 675f  type'] = config_
-000063a0: 6461 7461 2e67 6574 2827 636f 6e66 6967  data.get('config
-000063b0: 5f74 7970 6527 2c20 276b 766d 2729 0a20  _type', 'kvm'). 
-000063c0: 2020 2020 2020 2063 6f6e 6669 675f 6461         config_da
-000063d0: 7461 5b27 636f 6e66 6967 5f68 6f73 7427  ta['config_host'
-000063e0: 5d20 3d20 636f 6e66 6967 5f64 6174 612e  ] = config_data.
-000063f0: 6765 7428 2763 6f6e 6669 675f 686f 7374  get('config_host
-00006400: 272c 2027 3132 372e 302e 302e 3127 290a  ', '127.0.0.1').
-00006410: 2020 2020 2020 2020 6465 6661 756c 745f          default_
-00006420: 7573 6572 203d 2067 6574 7573 6572 2829  user = getuser()
-00006430: 2069 6620 636f 6e66 6967 5f64 6174 615b   if config_data[
-00006440: 2763 6f6e 6669 675f 7479 7065 275d 203d  'config_type'] =
-00006450: 3d20 276b 766d 275c 0a20 2020 2020 2020  = 'kvm'\.       
-00006460: 2020 2020 2061 6e64 2073 656c 662e 686f       and self.ho
-00006470: 7374 2069 6e20 5b27 6c6f 6361 6c68 6f73  st in ['localhos
-00006480: 7427 2c20 2731 3237 2e30 2e30 2e31 275d  t', '127.0.0.1']
-00006490: 2065 6c73 6520 2772 6f6f 7427 0a20 2020   else 'root'.   
-000064a0: 2020 2020 2063 6f6e 6669 675f 6461 7461       config_data
-000064b0: 5b27 636f 6e66 6967 5f75 7365 7227 5d20  ['config_user'] 
-000064c0: 3d20 636f 6e66 6967 5f64 6174 612e 6765  = config_data.ge
-000064d0: 7428 2763 6f6e 6669 675f 7573 6572 272c  t('config_user',
-000064e0: 2064 6566 6175 6c74 5f75 7365 7229 0a20   default_user). 
-000064f0: 2020 2020 2020 2063 6f6e 6669 675f 6461         config_da
-00006500: 7461 5b27 636f 6e66 6967 5f63 6c69 656e  ta['config_clien
-00006510: 7427 5d20 3d20 7365 6c66 2e63 6c69 656e  t'] = self.clien
-00006520: 740a 2020 2020 2020 2020 7365 6c66 2e6f  t.        self.o
-00006530: 7665 7272 6964 6573 2e75 7064 6174 6528  verrides.update(
-00006540: 6465 6661 756c 745f 6461 7461 290a 2020  default_data).  
-00006550: 2020 2020 2020 7365 6c66 2e6f 7665 7272        self.overr
-00006560: 6964 6573 2e75 7064 6174 6528 636f 6e66  ides.update(conf
-00006570: 6967 5f64 6174 6129 0a0a 2020 2020 6465  ig_data)..    de
-00006580: 6620 6372 6561 7465 5f76 6d28 7365 6c66  f create_vm(self
-00006590: 2c20 6e61 6d65 2c20 7072 6f66 696c 653d  , name, profile=
-000065a0: 4e6f 6e65 2c20 6f76 6572 7269 6465 733d  None, overrides=
-000065b0: 7b7d 2c20 6375 7374 6f6d 7072 6f66 696c  {}, customprofil
-000065c0: 653d 7b7d 2c20 6b3d 4e6f 6e65 2c0a 2020  e={}, k=None,.  
-000065d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000065e0: 706c 616e 3d27 6b76 6972 7427 2c20 6261  plan='kvirt', ba
-000065f0: 7365 6469 723d 272e 272c 2063 6c69 656e  sedir='.', clien
-00006600: 743d 4e6f 6e65 2c20 6f6e 666c 793d 4e6f  t=None, onfly=No
-00006610: 6e65 2c20 6f6e 6c79 6173 7365 7473 3d46  ne, onlyassets=F
-00006620: 616c 7365 293a 0a20 2020 2020 2020 206f  alse):.        o
-00006630: 7665 7272 6964 6573 2e75 7064 6174 6528  verrides.update(
-00006640: 7365 6c66 2e6f 7665 7272 6964 6573 290a  self.overrides).
-00006650: 2020 2020 2020 2020 7772 6f6e 675f 6f76          wrong_ov
-00006660: 6572 7269 6465 7320 3d20 5b79 2066 6f72  errides = [y for
-00006670: 2079 2069 6e20 6f76 6572 7269 6465 7320   y in overrides 
-00006680: 6966 2027 2d27 2069 6e20 795d 0a20 2020  if '-' in y].   
-00006690: 2020 2020 2069 6620 7772 6f6e 675f 6f76       if wrong_ov
-000066a0: 6572 7269 6465 733a 0a20 2020 2020 2020  errides:.       
-000066b0: 2020 2020 2066 6f72 2077 726f 6e67 5f6f       for wrong_o
-000066c0: 7665 7272 6964 6520 696e 2077 726f 6e67  verride in wrong
-000066d0: 5f6f 7665 7272 6964 6573 3a0a 2020 2020  _overrides:.    
-000066e0: 2020 2020 2020 2020 2020 2020 6572 726f              erro
-000066f0: 7228 6622 496e 636f 7272 6563 7420 7061  r(f"Incorrect pa
-00006700: 7261 6d65 7465 7220 7b77 726f 6e67 5f6f  rameter {wrong_o
-00006710: 7665 7272 6964 6573 7d2e 2048 7970 6865  verrides}. Hyphe
-00006720: 6e73 2061 7265 206e 6f74 2061 6c6c 6f77  ns are not allow
-00006730: 6564 2229 0a20 2020 2020 2020 2020 2020  ed").           
-00006740: 2072 6574 7572 6e20 7b27 7265 7375 6c74   return {'result
-00006750: 273a 2027 6661 696c 7572 6527 2c20 2772  ': 'failure', 'r
-00006760: 6561 736f 6e27 3a20 2749 6e63 6f72 7265  eason': 'Incorre
-00006770: 6374 2070 6172 616d 6574 6572 7320 666f  ct parameters fo
-00006780: 756e 6427 7d0a 2020 2020 2020 2020 6f76  und'}.        ov
-00006790: 6572 7269 6465 735b 276e 616d 6527 5d20  errides['name'] 
-000067a0: 3d20 6e61 6d65 0a20 2020 2020 2020 206b  = name.        k
-000067b0: 7562 6520 3d20 6f76 6572 7269 6465 732e  ube = overrides.
-000067c0: 6765 7428 276b 7562 6527 290a 2020 2020  get('kube').    
-000067d0: 2020 2020 6b75 6265 7479 7065 203d 206f      kubetype = o
-000067e0: 7665 7272 6964 6573 2e67 6574 2827 6b75  verrides.get('ku
-000067f0: 6265 7479 7065 2729 0a20 2020 2020 2020  betype').       
-00006800: 206b 203d 2073 656c 662e 6b20 6966 206b   k = self.k if k
-00006810: 2069 7320 4e6f 6e65 2065 6c73 6520 6b0a   is None else k.
-00006820: 2020 2020 2020 2020 6375 7374 6f6d 5f72          custom_r
-00006830: 6567 696f 6e20 3d20 6e65 7874 2828 6520  egion = next((e 
-00006840: 666f 7220 6520 696e 205b 6375 7374 6f6d  for e in [custom
-00006850: 7072 6f66 696c 652e 6765 7428 2772 6567  profile.get('reg
-00006860: 696f 6e27 292c 206f 7665 7272 6964 6573  ion'), overrides
-00006870: 2e67 6574 2827 7265 6769 6f6e 2729 5d20  .get('region')] 
-00006880: 6966 2065 2069 7320 6e6f 7420 4e6f 6e65  if e is not None
-00006890: 292c 204e 6f6e 6529 0a20 2020 2020 2020  ), None).       
-000068a0: 2069 6620 6375 7374 6f6d 5f72 6567 696f   if custom_regio
-000068b0: 6e20 6973 206e 6f74 204e 6f6e 6520 616e  n is not None an
-000068c0: 6420 6861 7361 7474 7228 6b2c 2027 7265  d hasattr(k, 're
-000068d0: 6769 6f6e 2729 3a0a 2020 2020 2020 2020  gion'):.        
-000068e0: 2020 2020 6b2e 7265 6769 6f6e 203d 2063      k.region = c
-000068f0: 7573 746f 6d5f 7265 6769 6f6e 0a20 2020  ustom_region.   
-00006900: 2020 2020 2020 2020 2069 6620 6861 7361           if hasa
-00006910: 7474 7228 6b2c 2027 7a6f 6e65 2729 2061  ttr(k, 'zone') a
-00006920: 6e64 2063 7573 746f 6d5f 7265 6769 6f6e  nd custom_region
-00006930: 206e 6f74 2069 6e20 6b2e 7a6f 6e65 3a0a   not in k.zone:.
-00006940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006950: 6b2e 7a6f 6e65 203d 2066 227b 6375 7374  k.zone = f"{cust
-00006960: 6f6d 5f72 6567 696f 6e7d 2d32 220a 2020  om_region}-2".  
-00006970: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-00006980: 662e 7479 7065 203d 3d20 2769 626d 273a  f.type == 'ibm':
-00006990: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000069a0: 206b 2e63 6f6e 6e2e 7365 745f 7365 7276   k.conn.set_serv
-000069b0: 6963 655f 7572 6c28 6622 6874 7470 733a  ice_url(f"https:
-000069c0: 2f2f 7b63 7573 746f 6d5f 7265 6769 6f6e  //{custom_region
-000069d0: 7d2e 6961 6173 2e63 6c6f 7564 2e69 626d  }.iaas.cloud.ibm
-000069e0: 2e63 6f6d 2f76 3122 290a 2020 2020 2020  .com/v1").      
-000069f0: 2020 6375 7374 6f6d 5f7a 6f6e 6520 3d20    custom_zone = 
-00006a00: 6e65 7874 2828 6520 666f 7220 6520 696e  next((e for e in
-00006a10: 205b 6375 7374 6f6d 7072 6f66 696c 652e   [customprofile.
-00006a20: 6765 7428 277a 6f6e 6527 292c 206f 7665  get('zone'), ove
-00006a30: 7272 6964 6573 2e67 6574 2827 7a6f 6e65  rrides.get('zone
-00006a40: 2729 5d20 6966 2065 2069 7320 6e6f 7420  ')] if e is not 
-00006a50: 4e6f 6e65 292c 204e 6f6e 6529 0a20 2020  None), None).   
-00006a60: 2020 2020 2069 6620 6375 7374 6f6d 5f7a       if custom_z
-00006a70: 6f6e 6520 6973 206e 6f74 204e 6f6e 6520  one is not None 
-00006a80: 616e 6420 6861 7361 7474 7228 6b2c 2027  and hasattr(k, '
-00006a90: 7a6f 6e65 2729 3a0a 2020 2020 2020 2020  zone'):.        
-00006aa0: 2020 2020 6b2e 7a6f 6e65 203d 2063 7573      k.zone = cus
-00006ab0: 746f 6d5f 7a6f 6e65 0a20 2020 2020 2020  tom_zone.       
-00006ac0: 2020 2020 2069 6620 6861 7361 7474 7228       if hasattr(
-00006ad0: 6b2c 2027 7265 6769 6f6e 2729 2061 6e64  k, 'region') and
-00006ae0: 206b 2e72 6567 696f 6e20 6e6f 7420 696e   k.region not in
-00006af0: 206b 2e7a 6f6e 653a 0a20 2020 2020 2020   k.zone:.       
-00006b00: 2020 2020 2020 2020 206b 2e72 6567 696f           k.regio
-00006b10: 6e20 3d20 6375 7374 6f6d 5f7a 6f6e 655b  n = custom_zone[
-00006b20: 3a2d 325d 0a20 2020 2020 2020 2074 756e  :-2].        tun
-00006b30: 6e65 6c20 3d20 7365 6c66 2e74 756e 6e65  nel = self.tunne
-00006b40: 6c0a 2020 2020 2020 2020 7072 6f66 696c  l.        profil
-00006b50: 6520 3d20 7072 6f66 696c 6520 6f72 206f  e = profile or o
-00006b60: 7665 7272 6964 6573 2e67 6574 2827 696d  verrides.get('im
-00006b70: 6167 6527 2c20 276b 7669 7274 2729 0a20  age', 'kvirt'). 
-00006b80: 2020 2020 2020 2066 756c 6c5f 766f 6c75         full_volu
-00006b90: 6d65 7320 3d20 7365 6c66 2e6b 2e76 6f6c  mes = self.k.vol
-00006ba0: 756d 6573 2829 0a20 2020 2020 2020 2076  umes().        v
-00006bb0: 6f6c 756d 6573 203d 205b 6f73 2e70 6174  olumes = [os.pat
-00006bc0: 682e 6261 7365 6e61 6d65 2876 2920 666f  h.basename(v) fo
-00006bd0: 7220 7620 696e 2066 756c 6c5f 766f 6c75  r v in full_volu
-00006be0: 6d65 735d 0a20 2020 2020 2020 2076 6d70  mes].        vmp
-00006bf0: 726f 6669 6c65 7320 3d20 7b6b 3a20 7620  rofiles = {k: v 
-00006c00: 666f 7220 6b2c 2076 2069 6e20 7365 6c66  for k, v in self
-00006c10: 2e70 726f 6669 6c65 732e 6974 656d 7328  .profiles.items(
-00006c20: 2920 6966 2027 7479 7065 2720 6e6f 7420  ) if 'type' not 
-00006c30: 696e 2076 206f 7220 765b 2774 7970 6527  in v or v['type'
-00006c40: 5d20 3d3d 2027 766d 277d 0a20 2020 2020  ] == 'vm'}.     
-00006c50: 2020 2069 6620 6375 7374 6f6d 7072 6f66     if customprof
-00006c60: 696c 653a 0a20 2020 2020 2020 2020 2020  ile:.           
-00006c70: 2076 6d70 726f 6669 6c65 735b 7072 6f66   vmprofiles[prof
-00006c80: 696c 655d 203d 2063 7573 746f 6d70 726f  ile] = custompro
-00006c90: 6669 6c65 0a20 2020 2020 2020 2065 6c69  file.        eli
-00006ca0: 6620 7072 6f66 696c 6520 696e 2076 6d70  f profile in vmp
-00006cb0: 726f 6669 6c65 7320 616e 6420 6e6f 7420  rofiles and not 
-00006cc0: 6f6e 6c79 6173 7365 7473 3a0a 2020 2020  onlyassets:.    
-00006cd0: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
-00006ce0: 2244 6570 6c6f 7969 6e67 2076 6d20 7b6e  "Deploying vm {n
-00006cf0: 616d 657d 2066 726f 6d20 7072 6f66 696c  ame} from profil
-00006d00: 6520 7b70 726f 6669 6c65 7d2e 2e2e 2229  e {profile}...")
-00006d10: 0a20 2020 2020 2020 2065 6c69 6620 286f  .        elif (o
-00006d20: 732e 7061 7468 2e62 6173 656e 616d 6528  s.path.basename(
-00006d30: 7072 6f66 696c 6529 203d 3d20 7072 6f66  profile) == prof
-00006d40: 696c 6520 616e 6420 7072 6f66 696c 6520  ile and profile 
-00006d50: 696e 2076 6f6c 756d 6573 2920 6f72 2070  in volumes) or p
-00006d60: 726f 6669 6c65 2069 6e20 6675 6c6c 5f76  rofile in full_v
-00006d70: 6f6c 756d 6573 3a0a 2020 2020 2020 2020  olumes:.        
-00006d80: 2020 2020 6966 206e 6f74 206f 6e6c 7961      if not onlya
-00006d90: 7373 6574 733a 0a20 2020 2020 2020 2020  ssets:.         
-00006da0: 2020 2020 2020 2070 7072 696e 7428 6622         pprint(f"
-00006db0: 4465 706c 6f79 696e 6720 766d 207b 6e61  Deploying vm {na
-00006dc0: 6d65 7d20 6672 6f6d 2069 6d61 6765 207b  me} from image {
-00006dd0: 7072 6f66 696c 657d 2e2e 2e22 290a 2020  profile}...").  
-00006de0: 2020 2020 2020 2020 2020 6e65 775f 7072            new_pr
-00006df0: 6f66 696c 6520 3d20 6f73 2e70 6174 682e  ofile = os.path.
-00006e00: 6261 7365 6e61 6d65 2870 726f 6669 6c65  basename(profile
-00006e10: 290a 2020 2020 2020 2020 2020 2020 766d  ).            vm
-00006e20: 7072 6f66 696c 6573 5b6e 6577 5f70 726f  profiles[new_pro
-00006e30: 6669 6c65 5d20 3d20 7b27 696d 6167 6527  file] = {'image'
-00006e40: 3a20 7072 6f66 696c 657d 0a20 2020 2020  : profile}.     
-00006e50: 2020 2020 2020 2070 726f 6669 6c65 203d         profile =
-00006e60: 206e 6577 5f70 726f 6669 6c65 0a20 2020   new_profile.   
-00006e70: 2020 2020 2065 6c69 6620 7072 6f66 696c       elif profil
-00006e80: 6520 696e 2049 4d41 4745 5320 6f72 2070  e in IMAGES or p
-00006e90: 726f 6669 6c65 203d 3d20 2772 6863 6f73  rofile == 'rhcos
-00006ea0: 3430 3030 273a 0a20 2020 2020 2020 2020  4000':.         
-00006eb0: 2020 2076 6d70 726f 6669 6c65 735b 7072     vmprofiles[pr
-00006ec0: 6f66 696c 655d 203d 207b 2769 6d61 6765  ofile] = {'image
-00006ed0: 273a 2070 726f 6669 6c65 7d0a 2020 2020  ': profile}.    
-00006ee0: 2020 2020 656c 6966 2070 726f 6669 6c65      elif profile
-00006ef0: 2e73 7461 7274 7377 6974 6828 2772 6863  .startswith('rhc
-00006f00: 6f73 2d34 2729 2061 6e64 2070 726f 6669  os-4') and profi
-00006f10: 6c65 2e65 6e64 7377 6974 6828 2771 636f  le.endswith('qco
-00006f20: 7732 2729 2061 6e64 2073 656c 662e 7479  w2') and self.ty
-00006f30: 7065 206e 6f74 2069 6e20 636c 6f75 6470  pe not in cloudp
-00006f40: 6c61 7466 6f72 6d73 3a0a 2020 2020 2020  latforms:.      
-00006f50: 2020 2020 2020 766d 7072 6f66 696c 6573        vmprofiles
-00006f60: 5b70 726f 6669 6c65 5d20 3d20 7b27 696d  [profile] = {'im
-00006f70: 6167 6527 3a20 7072 6f66 696c 657d 0a20  age': profile}. 
-00006f80: 2020 2020 2020 2065 6c69 6620 7072 6f66         elif prof
-00006f90: 696c 6520 3d3d 2027 6b76 6972 7427 3a0a  ile == 'kvirt':.
-00006fa0: 2020 2020 2020 2020 2020 2020 766d 7072              vmpr
-00006fb0: 6f66 696c 6573 5b70 726f 6669 6c65 5d20  ofiles[profile] 
-00006fc0: 3d20 7b7d 0a20 2020 2020 2020 2065 6c73  = {}.        els
-00006fd0: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-00006fe0: 6574 7572 6e20 7b27 7265 7375 6c74 273a  eturn {'result':
-00006ff0: 2027 6661 696c 7572 6527 2c20 2772 6561   'failure', 'rea
-00007000: 736f 6e27 3a20 6627 496d 6167 6520 7b70  son': f'Image {p
-00007010: 726f 6669 6c65 7d20 6e6f 7420 666f 756e  rofile} not foun
-00007020: 6427 7d0a 2020 2020 2020 2020 7072 6f66  d'}.        prof
-00007030: 696c 656e 616d 6520 3d20 7072 6f66 696c  ilename = profil
-00007040: 650a 2020 2020 2020 2020 7072 6f66 696c  e.        profil
-00007050: 6520 3d20 766d 7072 6f66 696c 6573 5b70  e = vmprofiles[p
-00007060: 726f 6669 6c65 5d0a 2020 2020 2020 2020  rofile].        
-00007070: 7069 6d61 6765 203d 2070 726f 6669 6c65  pimage = profile
-00007080: 2e67 6574 2827 696d 6167 6527 2c20 2758  .get('image', 'X
-00007090: 5858 2729 0a20 2020 2020 2020 2069 6620  XX').        if 
-000070a0: 6e6f 7420 6f6e 6c79 6173 7365 7473 2061  not onlyassets a
-000070b0: 6e64 2073 656c 662e 7479 7065 206e 6f74  nd self.type not
-000070c0: 2069 6e20 636c 6f75 6470 6c61 7466 6f72   in cloudplatfor
-000070d0: 6d73 2061 6e64 2070 696d 6167 6520 696e  ms and pimage in
-000070e0: 2049 4d41 4745 5320 616e 6420 7069 6d61   IMAGES and pima
-000070f0: 6765 206e 6f74 2069 6e20 766f 6c75 6d65  ge not in volume
-00007100: 733a 0a20 2020 2020 2020 2020 2020 2070  s:.            p
-00007110: 7072 696e 7428 6622 496d 6167 6520 7b70  print(f"Image {p
-00007120: 696d 6167 657d 206e 6f74 2066 6f75 6e64  image} not found
-00007130: 2e20 446f 776e 6c6f 6164 696e 6722 290a  . Downloading").
-00007140: 2020 2020 2020 2020 2020 2020 7069 6d61              pima
-00007150: 6765 5f64 6174 6120 3d20 7b27 706f 6f6c  ge_data = {'pool
-00007160: 273a 2073 656c 662e 706f 6f6c 2c20 2769  ': self.pool, 'i
-00007170: 6d61 6765 273a 2070 696d 6167 652c 2027  mage': pimage, '
-00007180: 646f 776e 6c6f 6164 273a 2054 7275 657d  download': True}
-00007190: 0a20 2020 2020 2020 2020 2020 2070 696d  .            pim
-000071a0: 6167 655f 7369 7a65 203d 2070 726f 6669  age_size = profi
-000071b0: 6c65 2e67 6574 2827 6b75 6265 7669 7274  le.get('kubevirt
-000071c0: 5f64 6973 6b5f 7369 7a65 2729 206f 7220  _disk_size') or 
-000071d0: 7072 6f66 696c 652e 6765 7428 2773 697a  profile.get('siz
-000071e0: 6527 290a 2020 2020 2020 2020 2020 2020  e').            
-000071f0: 6966 2070 696d 6167 655f 7369 7a65 2069  if pimage_size i
-00007200: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-00007210: 2020 2020 2020 2020 2020 2020 7069 6d61              pima
-00007220: 6765 5f64 6174 615b 2773 697a 6527 5d20  ge_data['size'] 
-00007230: 3d20 7069 6d61 6765 5f73 697a 650a 2020  = pimage_size.  
-00007240: 2020 2020 2020 2020 2020 6966 2070 726f            if pro
-00007250: 6669 6c65 6e61 6d65 2e73 7461 7274 7377  filename.startsw
-00007260: 6974 6828 2772 6863 6f73 2d34 2729 2061  ith('rhcos-4') a
-00007270: 6e64 2070 726f 6669 6c65 6e61 6d65 2e65  nd profilename.e
-00007280: 6e64 7377 6974 6828 2771 636f 7732 2729  ndswith('qcow2')
-00007290: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000072a0: 2020 7069 6d61 6765 5f64 6174 615b 2769    pimage_data['i
-000072b0: 6d61 6765 275d 203d 2070 726f 6669 6c65  mage'] = profile
-000072c0: 6e61 6d65 2e73 706c 6974 2827 2e27 295b  name.split('.')[
-000072d0: 305d 2e72 6570 6c61 6365 2827 7268 636f  0].replace('rhco
-000072e0: 732d 3427 2c20 2772 6863 6f73 3427 290a  s-4', 'rhcos4').
-000072f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007300: 7069 6d61 6765 5f64 6174 615b 2775 726c  pimage_data['url
-00007310: 275d 203d 2067 6574 5f72 6863 6f73 5f75  '] = get_rhcos_u
-00007320: 726c 5f66 726f 6d5f 6669 6c65 2870 726f  rl_from_file(pro
-00007330: 6669 6c65 6e61 6d65 2c20 5f74 7970 653d  filename, _type=
-00007340: 7365 6c66 2e74 7970 6529 0a20 2020 2020  self.type).     
-00007350: 2020 2020 2020 2073 656c 662e 6861 6e64         self.hand
-00007360: 6c65 5f68 6f73 7428 2a2a 7069 6d61 6765  le_host(**pimage
-00007370: 5f64 6174 6129 0a20 2020 2020 2020 2069  _data).        i
-00007380: 6620 6e6f 7420 6375 7374 6f6d 7072 6f66  f not customprof
-00007390: 696c 653a 0a20 2020 2020 2020 2020 2020  ile:.           
-000073a0: 2070 726f 6669 6c65 2e75 7064 6174 6528   profile.update(
-000073b0: 6f76 6572 7269 6465 7329 0a20 2020 2020  overrides).     
-000073c0: 2020 2069 6620 2762 6173 6527 2069 6e20     if 'base' in 
-000073d0: 7072 6f66 696c 653a 0a20 2020 2020 2020  profile:.       
-000073e0: 2020 2020 2066 6174 6865 7220 3d20 766d       father = vm
-000073f0: 7072 6f66 696c 6573 5b70 726f 6669 6c65  profiles[profile
-00007400: 5b27 6261 7365 275d 5d0a 2020 2020 2020  ['base']].      
-00007410: 2020 2020 2020 6465 6661 756c 745f 6e75        default_nu
-00007420: 6d63 7075 7320 3d20 6661 7468 6572 2e67  mcpus = father.g
-00007430: 6574 2827 6e75 6d63 7075 7327 2c20 7365  et('numcpus', se
-00007440: 6c66 2e6e 756d 6370 7573 290a 2020 2020  lf.numcpus).    
-00007450: 2020 2020 2020 2020 6465 6661 756c 745f          default_
-00007460: 6d65 6d6f 7279 203d 2066 6174 6865 722e  memory = father.
-00007470: 6765 7428 276d 656d 6f72 7927 2c20 7365  get('memory', se
-00007480: 6c66 2e6d 656d 6f72 7929 0a20 2020 2020  lf.memory).     
-00007490: 2020 2020 2020 2064 6566 6175 6c74 5f70         default_p
-000074a0: 6f6f 6c20 3d20 6661 7468 6572 2e67 6574  ool = father.get
-000074b0: 2827 706f 6f6c 272c 2073 656c 662e 706f  ('pool', self.po
-000074c0: 6f6c 290a 2020 2020 2020 2020 2020 2020  ol).            
-000074d0: 6465 6661 756c 745f 6469 736b 7320 3d20  default_disks = 
-000074e0: 6661 7468 6572 2e67 6574 2827 6469 736b  father.get('disk
-000074f0: 7327 2c20 7365 6c66 2e64 6973 6b73 290a  s', self.disks).
-00007500: 2020 2020 2020 2020 2020 2020 6465 6661              defa
-00007510: 756c 745f 6e65 7473 203d 2066 6174 6865  ult_nets = fathe
-00007520: 722e 6765 7428 276e 6574 7327 2c20 7365  r.get('nets', se
-00007530: 6c66 2e6e 6574 7329 0a20 2020 2020 2020  lf.nets).       
-00007540: 2020 2020 2064 6566 6175 6c74 5f69 6d61       default_ima
-00007550: 6765 203d 2066 6174 6865 722e 6765 7428  ge = father.get(
-00007560: 2769 6d61 6765 272c 2073 656c 662e 696d  'image', self.im
-00007570: 6167 6529 0a20 2020 2020 2020 2020 2020  age).           
-00007580: 2064 6566 6175 6c74 5f63 6c6f 7564 696e   default_cloudin
-00007590: 6974 203d 2066 6174 6865 722e 6765 7428  it = father.get(
-000075a0: 2763 6c6f 7564 696e 6974 272c 2073 656c  'cloudinit', sel
-000075b0: 662e 636c 6f75 6469 6e69 7429 0a20 2020  f.cloudinit).   
-000075c0: 2020 2020 2020 2020 2064 6566 6175 6c74           default
-000075d0: 5f6e 6573 7465 6420 3d20 6661 7468 6572  _nested = father
-000075e0: 2e67 6574 2827 6e65 7374 6564 272c 2073  .get('nested', s
-000075f0: 656c 662e 6e65 7374 6564 290a 2020 2020  elf.nested).    
-00007600: 2020 2020 2020 2020 6465 6661 756c 745f          default_
-00007610: 7265 7365 7276 6564 6e73 203d 2066 6174  reservedns = fat
+000061d0: 2020 2020 2020 7365 6c66 2e63 6c69 656e        self.clien
+000061e0: 7420 3d20 6e65 7763 6c69 0a20 2020 2020  t = newcli.     
+000061f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006200: 2020 2020 2020 2020 2020 2062 7265 616b             break
+00006210: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00006220: 2020 7070 7269 6e74 2866 2253 656c 6563    pprint(f"Selec
+00006230: 7469 6e67 2063 6c69 656e 7420 7b73 656c  ting client {sel
+00006240: 662e 636c 6965 6e74 7d20 6672 6f6d 2067  f.client} from g
+00006250: 726f 7570 207b 7365 6c66 2e67 726f 7570  roup {self.group
+00006260: 7d22 290a 2020 2020 2020 2020 7365 6c66  }").        self
+00006270: 2e6b 203d 206b 0a20 2020 2020 2020 2064  .k = k.        d
+00006280: 6566 6175 6c74 5f64 6174 6120 3d20 7b27  efault_data = {'
+00006290: 636f 6e66 6967 5f25 7327 2025 206b 3a20  config_%s' % k: 
+000062a0: 7365 6c66 2e64 6566 6175 6c74 5b6b 5d20  self.default[k] 
+000062b0: 666f 7220 6b20 696e 2073 656c 662e 6465  for k in self.de
+000062c0: 6661 756c 747d 0a20 2020 2020 2020 2063  fault}.        c
+000062d0: 6f6e 6669 675f 6461 7461 203d 207b 2763  onfig_data = {'c
+000062e0: 6f6e 6669 675f 2573 2720 2520 6b3a 2073  onfig_%s' % k: s
+000062f0: 656c 662e 696e 695b 7365 6c66 2e63 6c69  elf.ini[self.cli
+00006300: 656e 745d 5b6b 5d20 666f 7220 6b20 696e  ent][k] for k in
+00006310: 2073 656c 662e 696e 695b 7365 6c66 2e63   self.ini[self.c
+00006320: 6c69 656e 745d 7d0a 2020 2020 2020 2020  lient]}.        
+00006330: 636f 6e66 6967 5f64 6174 615b 2763 6f6e  config_data['con
+00006340: 6669 675f 7479 7065 275d 203d 2063 6f6e  fig_type'] = con
+00006350: 6669 675f 6461 7461 2e67 6574 2827 636f  fig_data.get('co
+00006360: 6e66 6967 5f74 7970 6527 2c20 276b 766d  nfig_type', 'kvm
+00006370: 2729 0a20 2020 2020 2020 2063 6f6e 6669  ').        confi
+00006380: 675f 6461 7461 5b27 636f 6e66 6967 5f68  g_data['config_h
+00006390: 6f73 7427 5d20 3d20 636f 6e66 6967 5f64  ost'] = config_d
+000063a0: 6174 612e 6765 7428 2763 6f6e 6669 675f  ata.get('config_
+000063b0: 686f 7374 272c 2027 3132 372e 302e 302e  host', '127.0.0.
+000063c0: 3127 290a 2020 2020 2020 2020 6465 6661  1').        defa
+000063d0: 756c 745f 7573 6572 203d 2067 6574 7573  ult_user = getus
+000063e0: 6572 2829 2069 6620 636f 6e66 6967 5f64  er() if config_d
+000063f0: 6174 615b 2763 6f6e 6669 675f 7479 7065  ata['config_type
+00006400: 275d 203d 3d20 276b 766d 275c 0a20 2020  '] == 'kvm'\.   
+00006410: 2020 2020 2020 2020 2061 6e64 2073 656c           and sel
+00006420: 662e 686f 7374 2069 6e20 5b27 6c6f 6361  f.host in ['loca
+00006430: 6c68 6f73 7427 2c20 2731 3237 2e30 2e30  lhost', '127.0.0
+00006440: 2e31 275d 2065 6c73 6520 2772 6f6f 7427  .1'] else 'root'
+00006450: 0a20 2020 2020 2020 2063 6f6e 6669 675f  .        config_
+00006460: 6461 7461 5b27 636f 6e66 6967 5f75 7365  data['config_use
+00006470: 7227 5d20 3d20 636f 6e66 6967 5f64 6174  r'] = config_dat
+00006480: 612e 6765 7428 2763 6f6e 6669 675f 7573  a.get('config_us
+00006490: 6572 272c 2064 6566 6175 6c74 5f75 7365  er', default_use
+000064a0: 7229 0a20 2020 2020 2020 2063 6f6e 6669  r).        confi
+000064b0: 675f 6461 7461 5b27 636f 6e66 6967 5f63  g_data['config_c
+000064c0: 6c69 656e 7427 5d20 3d20 7365 6c66 2e63  lient'] = self.c
+000064d0: 6c69 656e 740a 2020 2020 2020 2020 7365  lient.        se
+000064e0: 6c66 2e6f 7665 7272 6964 6573 2e75 7064  lf.overrides.upd
+000064f0: 6174 6528 6465 6661 756c 745f 6461 7461  ate(default_data
+00006500: 290a 2020 2020 2020 2020 7365 6c66 2e6f  ).        self.o
+00006510: 7665 7272 6964 6573 2e75 7064 6174 6528  verrides.update(
+00006520: 636f 6e66 6967 5f64 6174 6129 0a0a 2020  config_data)..  
+00006530: 2020 6465 6620 6372 6561 7465 5f76 6d28    def create_vm(
+00006540: 7365 6c66 2c20 6e61 6d65 2c20 7072 6f66  self, name, prof
+00006550: 696c 653d 4e6f 6e65 2c20 6f76 6572 7269  ile=None, overri
+00006560: 6465 733d 7b7d 2c20 6375 7374 6f6d 7072  des={}, custompr
+00006570: 6f66 696c 653d 7b7d 2c20 6b3d 4e6f 6e65  ofile={}, k=None
+00006580: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00006590: 2020 2020 706c 616e 3d27 6b76 6972 7427      plan='kvirt'
+000065a0: 2c20 6261 7365 6469 723d 272e 272c 2063  , basedir='.', c
+000065b0: 6c69 656e 743d 4e6f 6e65 2c20 6f6e 666c  lient=None, onfl
+000065c0: 793d 4e6f 6e65 2c20 6f6e 6c79 6173 7365  y=None, onlyasse
+000065d0: 7473 3d46 616c 7365 293a 0a20 2020 2020  ts=False):.     
+000065e0: 2020 206f 7665 7272 6964 6573 2e75 7064     overrides.upd
+000065f0: 6174 6528 7365 6c66 2e6f 7665 7272 6964  ate(self.overrid
+00006600: 6573 290a 2020 2020 2020 2020 7772 6f6e  es).        wron
+00006610: 675f 6f76 6572 7269 6465 7320 3d20 5b79  g_overrides = [y
+00006620: 2066 6f72 2079 2069 6e20 6f76 6572 7269   for y in overri
+00006630: 6465 7320 6966 2027 2d27 2069 6e20 795d  des if '-' in y]
+00006640: 0a20 2020 2020 2020 2069 6620 7772 6f6e  .        if wron
+00006650: 675f 6f76 6572 7269 6465 733a 0a20 2020  g_overrides:.   
+00006660: 2020 2020 2020 2020 2066 6f72 2077 726f           for wro
+00006670: 6e67 5f6f 7665 7272 6964 6520 696e 2077  ng_override in w
+00006680: 726f 6e67 5f6f 7665 7272 6964 6573 3a0a  rong_overrides:.
+00006690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000066a0: 6572 726f 7228 6622 496e 636f 7272 6563  error(f"Incorrec
+000066b0: 7420 7061 7261 6d65 7465 7220 7b77 726f  t parameter {wro
+000066c0: 6e67 5f6f 7665 7272 6964 6573 7d2e 2048  ng_overrides}. H
+000066d0: 7970 6865 6e73 2061 7265 206e 6f74 2061  yphens are not a
+000066e0: 6c6c 6f77 6564 2229 0a20 2020 2020 2020  llowed").       
+000066f0: 2020 2020 2072 6574 7572 6e20 7b27 7265       return {'re
+00006700: 7375 6c74 273a 2027 6661 696c 7572 6527  sult': 'failure'
+00006710: 2c20 2772 6561 736f 6e27 3a20 2749 6e63  , 'reason': 'Inc
+00006720: 6f72 7265 6374 2070 6172 616d 6574 6572  orrect parameter
+00006730: 7320 666f 756e 6427 7d0a 2020 2020 2020  s found'}.      
+00006740: 2020 6f76 6572 7269 6465 735b 276e 616d    overrides['nam
+00006750: 6527 5d20 3d20 6e61 6d65 0a20 2020 2020  e'] = name.     
+00006760: 2020 206b 7562 6520 3d20 6f76 6572 7269     kube = overri
+00006770: 6465 732e 6765 7428 276b 7562 6527 290a  des.get('kube').
+00006780: 2020 2020 2020 2020 6b75 6265 7479 7065          kubetype
+00006790: 203d 206f 7665 7272 6964 6573 2e67 6574   = overrides.get
+000067a0: 2827 6b75 6265 7479 7065 2729 0a20 2020  ('kubetype').   
+000067b0: 2020 2020 206b 203d 2073 656c 662e 6b20       k = self.k 
+000067c0: 6966 206b 2069 7320 4e6f 6e65 2065 6c73  if k is None els
+000067d0: 6520 6b0a 2020 2020 2020 2020 6375 7374  e k.        cust
+000067e0: 6f6d 5f72 6567 696f 6e20 3d20 6e65 7874  om_region = next
+000067f0: 2828 6520 666f 7220 6520 696e 205b 6375  ((e for e in [cu
+00006800: 7374 6f6d 7072 6f66 696c 652e 6765 7428  stomprofile.get(
+00006810: 2772 6567 696f 6e27 292c 206f 7665 7272  'region'), overr
+00006820: 6964 6573 2e67 6574 2827 7265 6769 6f6e  ides.get('region
+00006830: 2729 5d20 6966 2065 2069 7320 6e6f 7420  ')] if e is not 
+00006840: 4e6f 6e65 292c 204e 6f6e 6529 0a20 2020  None), None).   
+00006850: 2020 2020 2069 6620 6375 7374 6f6d 5f72       if custom_r
+00006860: 6567 696f 6e20 6973 206e 6f74 204e 6f6e  egion is not Non
+00006870: 6520 616e 6420 6861 7361 7474 7228 6b2c  e and hasattr(k,
+00006880: 2027 7265 6769 6f6e 2729 3a0a 2020 2020   'region'):.    
+00006890: 2020 2020 2020 2020 6b2e 7265 6769 6f6e          k.region
+000068a0: 203d 2063 7573 746f 6d5f 7265 6769 6f6e   = custom_region
+000068b0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000068c0: 6861 7361 7474 7228 6b2c 2027 7a6f 6e65  hasattr(k, 'zone
+000068d0: 2729 2061 6e64 2063 7573 746f 6d5f 7265  ') and custom_re
+000068e0: 6769 6f6e 206e 6f74 2069 6e20 6b2e 7a6f  gion not in k.zo
+000068f0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00006900: 2020 2020 6b2e 7a6f 6e65 203d 2066 227b      k.zone = f"{
+00006910: 6375 7374 6f6d 5f72 6567 696f 6e7d 2d32  custom_region}-2
+00006920: 220a 2020 2020 2020 2020 2020 2020 6966  ".            if
+00006930: 2073 656c 662e 7479 7065 203d 3d20 2769   self.type == 'i
+00006940: 626d 273a 0a20 2020 2020 2020 2020 2020  bm':.           
+00006950: 2020 2020 206b 2e63 6f6e 6e2e 7365 745f       k.conn.set_
+00006960: 7365 7276 6963 655f 7572 6c28 6622 6874  service_url(f"ht
+00006970: 7470 733a 2f2f 7b63 7573 746f 6d5f 7265  tps://{custom_re
+00006980: 6769 6f6e 7d2e 6961 6173 2e63 6c6f 7564  gion}.iaas.cloud
+00006990: 2e69 626d 2e63 6f6d 2f76 3122 290a 2020  .ibm.com/v1").  
+000069a0: 2020 2020 2020 6375 7374 6f6d 5f7a 6f6e        custom_zon
+000069b0: 6520 3d20 6e65 7874 2828 6520 666f 7220  e = next((e for 
+000069c0: 6520 696e 205b 6375 7374 6f6d 7072 6f66  e in [customprof
+000069d0: 696c 652e 6765 7428 277a 6f6e 6527 292c  ile.get('zone'),
+000069e0: 206f 7665 7272 6964 6573 2e67 6574 2827   overrides.get('
+000069f0: 7a6f 6e65 2729 5d20 6966 2065 2069 7320  zone')] if e is 
+00006a00: 6e6f 7420 4e6f 6e65 292c 204e 6f6e 6529  not None), None)
+00006a10: 0a20 2020 2020 2020 2069 6620 6375 7374  .        if cust
+00006a20: 6f6d 5f7a 6f6e 6520 6973 206e 6f74 204e  om_zone is not N
+00006a30: 6f6e 6520 616e 6420 6861 7361 7474 7228  one and hasattr(
+00006a40: 6b2c 2027 7a6f 6e65 2729 3a0a 2020 2020  k, 'zone'):.    
+00006a50: 2020 2020 2020 2020 6b2e 7a6f 6e65 203d          k.zone =
+00006a60: 2063 7573 746f 6d5f 7a6f 6e65 0a20 2020   custom_zone.   
+00006a70: 2020 2020 2020 2020 2069 6620 6861 7361           if hasa
+00006a80: 7474 7228 6b2c 2027 7265 6769 6f6e 2729  ttr(k, 'region')
+00006a90: 2061 6e64 206b 2e72 6567 696f 6e20 6e6f   and k.region no
+00006aa0: 7420 696e 206b 2e7a 6f6e 653a 0a20 2020  t in k.zone:.   
+00006ab0: 2020 2020 2020 2020 2020 2020 206b 2e72               k.r
+00006ac0: 6567 696f 6e20 3d20 6375 7374 6f6d 5f7a  egion = custom_z
+00006ad0: 6f6e 655b 3a2d 325d 0a20 2020 2020 2020  one[:-2].       
+00006ae0: 2074 756e 6e65 6c20 3d20 7365 6c66 2e74   tunnel = self.t
+00006af0: 756e 6e65 6c0a 2020 2020 2020 2020 7072  unnel.        pr
+00006b00: 6f66 696c 6520 3d20 7072 6f66 696c 6520  ofile = profile 
+00006b10: 6f72 206f 7665 7272 6964 6573 2e67 6574  or overrides.get
+00006b20: 2827 696d 6167 6527 2c20 276b 7669 7274  ('image', 'kvirt
+00006b30: 2729 0a20 2020 2020 2020 2066 756c 6c5f  ').        full_
+00006b40: 766f 6c75 6d65 7320 3d20 7365 6c66 2e6b  volumes = self.k
+00006b50: 2e76 6f6c 756d 6573 2829 0a20 2020 2020  .volumes().     
+00006b60: 2020 2076 6f6c 756d 6573 203d 205b 6f73     volumes = [os
+00006b70: 2e70 6174 682e 6261 7365 6e61 6d65 2876  .path.basename(v
+00006b80: 2920 666f 7220 7620 696e 2066 756c 6c5f  ) for v in full_
+00006b90: 766f 6c75 6d65 735d 0a20 2020 2020 2020  volumes].       
+00006ba0: 2076 6d70 726f 6669 6c65 7320 3d20 7b6b   vmprofiles = {k
+00006bb0: 3a20 7620 666f 7220 6b2c 2076 2069 6e20  : v for k, v in 
+00006bc0: 7365 6c66 2e70 726f 6669 6c65 732e 6974  self.profiles.it
+00006bd0: 656d 7328 2920 6966 2027 7479 7065 2720  ems() if 'type' 
+00006be0: 6e6f 7420 696e 2076 206f 7220 765b 2774  not in v or v['t
+00006bf0: 7970 6527 5d20 3d3d 2027 766d 277d 0a20  ype'] == 'vm'}. 
+00006c00: 2020 2020 2020 2069 6620 6375 7374 6f6d         if custom
+00006c10: 7072 6f66 696c 653a 0a20 2020 2020 2020  profile:.       
+00006c20: 2020 2020 2076 6d70 726f 6669 6c65 735b       vmprofiles[
+00006c30: 7072 6f66 696c 655d 203d 2063 7573 746f  profile] = custo
+00006c40: 6d70 726f 6669 6c65 0a20 2020 2020 2020  mprofile.       
+00006c50: 2065 6c69 6620 7072 6f66 696c 6520 696e   elif profile in
+00006c60: 2076 6d70 726f 6669 6c65 7320 616e 6420   vmprofiles and 
+00006c70: 6e6f 7420 6f6e 6c79 6173 7365 7473 3a0a  not onlyassets:.
+00006c80: 2020 2020 2020 2020 2020 2020 7070 7269              ppri
+00006c90: 6e74 2866 2244 6570 6c6f 7969 6e67 2076  nt(f"Deploying v
+00006ca0: 6d20 7b6e 616d 657d 2066 726f 6d20 7072  m {name} from pr
+00006cb0: 6f66 696c 6520 7b70 726f 6669 6c65 7d2e  ofile {profile}.
+00006cc0: 2e2e 2229 0a20 2020 2020 2020 2065 6c69  ..").        eli
+00006cd0: 6620 286f 732e 7061 7468 2e62 6173 656e  f (os.path.basen
+00006ce0: 616d 6528 7072 6f66 696c 6529 203d 3d20  ame(profile) == 
+00006cf0: 7072 6f66 696c 6520 616e 6420 7072 6f66  profile and prof
+00006d00: 696c 6520 696e 2076 6f6c 756d 6573 2920  ile in volumes) 
+00006d10: 6f72 2070 726f 6669 6c65 2069 6e20 6675  or profile in fu
+00006d20: 6c6c 5f76 6f6c 756d 6573 3a0a 2020 2020  ll_volumes:.    
+00006d30: 2020 2020 2020 2020 6966 206e 6f74 206f          if not o
+00006d40: 6e6c 7961 7373 6574 733a 0a20 2020 2020  nlyassets:.     
+00006d50: 2020 2020 2020 2020 2020 2070 7072 696e             pprin
+00006d60: 7428 6622 4465 706c 6f79 696e 6720 766d  t(f"Deploying vm
+00006d70: 207b 6e61 6d65 7d20 6672 6f6d 2069 6d61   {name} from ima
+00006d80: 6765 207b 7072 6f66 696c 657d 2e2e 2e22  ge {profile}..."
+00006d90: 290a 2020 2020 2020 2020 2020 2020 6e65  ).            ne
+00006da0: 775f 7072 6f66 696c 6520 3d20 6f73 2e70  w_profile = os.p
+00006db0: 6174 682e 6261 7365 6e61 6d65 2870 726f  ath.basename(pro
+00006dc0: 6669 6c65 290a 2020 2020 2020 2020 2020  file).          
+00006dd0: 2020 766d 7072 6f66 696c 6573 5b6e 6577    vmprofiles[new
+00006de0: 5f70 726f 6669 6c65 5d20 3d20 7b27 696d  _profile] = {'im
+00006df0: 6167 6527 3a20 7072 6f66 696c 657d 0a20  age': profile}. 
+00006e00: 2020 2020 2020 2020 2020 2070 726f 6669             profi
+00006e10: 6c65 203d 206e 6577 5f70 726f 6669 6c65  le = new_profile
+00006e20: 0a20 2020 2020 2020 2065 6c69 6620 7072  .        elif pr
+00006e30: 6f66 696c 6520 696e 2049 4d41 4745 5320  ofile in IMAGES 
+00006e40: 6f72 2070 726f 6669 6c65 203d 3d20 2772  or profile == 'r
+00006e50: 6863 6f73 3430 3030 273a 0a20 2020 2020  hcos4000':.     
+00006e60: 2020 2020 2020 2076 6d70 726f 6669 6c65         vmprofile
+00006e70: 735b 7072 6f66 696c 655d 203d 207b 2769  s[profile] = {'i
+00006e80: 6d61 6765 273a 2070 726f 6669 6c65 7d0a  mage': profile}.
+00006e90: 2020 2020 2020 2020 656c 6966 2070 726f          elif pro
+00006ea0: 6669 6c65 2e73 7461 7274 7377 6974 6828  file.startswith(
+00006eb0: 2772 6863 6f73 2d34 2729 2061 6e64 2070  'rhcos-4') and p
+00006ec0: 726f 6669 6c65 2e65 6e64 7377 6974 6828  rofile.endswith(
+00006ed0: 2771 636f 7732 2729 2061 6e64 2073 656c  'qcow2') and sel
+00006ee0: 662e 7479 7065 206e 6f74 2069 6e20 636c  f.type not in cl
+00006ef0: 6f75 6470 6c61 7466 6f72 6d73 3a0a 2020  oudplatforms:.  
+00006f00: 2020 2020 2020 2020 2020 766d 7072 6f66            vmprof
+00006f10: 696c 6573 5b70 726f 6669 6c65 5d20 3d20  iles[profile] = 
+00006f20: 7b27 696d 6167 6527 3a20 7072 6f66 696c  {'image': profil
+00006f30: 657d 0a20 2020 2020 2020 2065 6c69 6620  e}.        elif 
+00006f40: 7072 6f66 696c 6520 3d3d 2027 6b76 6972  profile == 'kvir
+00006f50: 7427 3a0a 2020 2020 2020 2020 2020 2020  t':.            
+00006f60: 766d 7072 6f66 696c 6573 5b70 726f 6669  vmprofiles[profi
+00006f70: 6c65 5d20 3d20 7b7d 0a20 2020 2020 2020  le] = {}.       
+00006f80: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00006f90: 2020 2072 6574 7572 6e20 7b27 7265 7375     return {'resu
+00006fa0: 6c74 273a 2027 6661 696c 7572 6527 2c20  lt': 'failure', 
+00006fb0: 2772 6561 736f 6e27 3a20 6627 496d 6167  'reason': f'Imag
+00006fc0: 6520 7b70 726f 6669 6c65 7d20 6e6f 7420  e {profile} not 
+00006fd0: 666f 756e 6427 7d0a 2020 2020 2020 2020  found'}.        
+00006fe0: 7072 6f66 696c 656e 616d 6520 3d20 7072  profilename = pr
+00006ff0: 6f66 696c 650a 2020 2020 2020 2020 7072  ofile.        pr
+00007000: 6f66 696c 6520 3d20 766d 7072 6f66 696c  ofile = vmprofil
+00007010: 6573 5b70 726f 6669 6c65 5d0a 2020 2020  es[profile].    
+00007020: 2020 2020 7069 6d61 6765 203d 2070 726f      pimage = pro
+00007030: 6669 6c65 2e67 6574 2827 696d 6167 6527  file.get('image'
+00007040: 2c20 2758 5858 2729 0a20 2020 2020 2020  , 'XXX').       
+00007050: 2069 6620 6e6f 7420 6f6e 6c79 6173 7365   if not onlyasse
+00007060: 7473 2061 6e64 2073 656c 662e 7479 7065  ts and self.type
+00007070: 206e 6f74 2069 6e20 636c 6f75 6470 6c61   not in cloudpla
+00007080: 7466 6f72 6d73 2061 6e64 2070 696d 6167  tforms and pimag
+00007090: 6520 696e 2049 4d41 4745 5320 616e 6420  e in IMAGES and 
+000070a0: 7069 6d61 6765 206e 6f74 2069 6e20 766f  pimage not in vo
+000070b0: 6c75 6d65 733a 0a20 2020 2020 2020 2020  lumes:.         
+000070c0: 2020 2070 7072 696e 7428 6622 496d 6167     pprint(f"Imag
+000070d0: 6520 7b70 696d 6167 657d 206e 6f74 2066  e {pimage} not f
+000070e0: 6f75 6e64 2e20 446f 776e 6c6f 6164 696e  ound. Downloadin
+000070f0: 6722 290a 2020 2020 2020 2020 2020 2020  g").            
+00007100: 7069 6d61 6765 5f64 6174 6120 3d20 7b27  pimage_data = {'
+00007110: 706f 6f6c 273a 2073 656c 662e 706f 6f6c  pool': self.pool
+00007120: 2c20 2769 6d61 6765 273a 2070 696d 6167  , 'image': pimag
+00007130: 652c 2027 646f 776e 6c6f 6164 273a 2054  e, 'download': T
+00007140: 7275 657d 0a20 2020 2020 2020 2020 2020  rue}.           
+00007150: 2070 696d 6167 655f 7369 7a65 203d 2070   pimage_size = p
+00007160: 726f 6669 6c65 2e67 6574 2827 6b75 6265  rofile.get('kube
+00007170: 7669 7274 5f64 6973 6b5f 7369 7a65 2729  virt_disk_size')
+00007180: 206f 7220 7072 6f66 696c 652e 6765 7428   or profile.get(
+00007190: 2773 697a 6527 290a 2020 2020 2020 2020  'size').        
+000071a0: 2020 2020 6966 2070 696d 6167 655f 7369      if pimage_si
+000071b0: 7a65 2069 7320 6e6f 7420 4e6f 6e65 3a0a  ze is not None:.
+000071c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000071d0: 7069 6d61 6765 5f64 6174 615b 2773 697a  pimage_data['siz
+000071e0: 6527 5d20 3d20 7069 6d61 6765 5f73 697a  e'] = pimage_siz
+000071f0: 650a 2020 2020 2020 2020 2020 2020 6966  e.            if
+00007200: 2070 726f 6669 6c65 6e61 6d65 2e73 7461   profilename.sta
+00007210: 7274 7377 6974 6828 2772 6863 6f73 2d34  rtswith('rhcos-4
+00007220: 2729 2061 6e64 2070 726f 6669 6c65 6e61  ') and profilena
+00007230: 6d65 2e65 6e64 7377 6974 6828 2771 636f  me.endswith('qco
+00007240: 7732 2729 3a0a 2020 2020 2020 2020 2020  w2'):.          
+00007250: 2020 2020 2020 7069 6d61 6765 5f64 6174        pimage_dat
+00007260: 615b 2769 6d61 6765 275d 203d 2070 726f  a['image'] = pro
+00007270: 6669 6c65 6e61 6d65 2e73 706c 6974 2827  filename.split('
+00007280: 2e27 295b 305d 2e72 6570 6c61 6365 2827  .')[0].replace('
+00007290: 7268 636f 732d 3427 2c20 2772 6863 6f73  rhcos-4', 'rhcos
+000072a0: 3427 290a 2020 2020 2020 2020 2020 2020  4').            
+000072b0: 2020 2020 7069 6d61 6765 5f64 6174 615b      pimage_data[
+000072c0: 2775 726c 275d 203d 2067 6574 5f72 6863  'url'] = get_rhc
+000072d0: 6f73 5f75 726c 5f66 726f 6d5f 6669 6c65  os_url_from_file
+000072e0: 2870 726f 6669 6c65 6e61 6d65 2c20 5f74  (profilename, _t
+000072f0: 7970 653d 7365 6c66 2e74 7970 6529 0a20  ype=self.type). 
+00007300: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00007310: 6861 6e64 6c65 5f68 6f73 7428 2a2a 7069  handle_host(**pi
+00007320: 6d61 6765 5f64 6174 6129 0a20 2020 2020  mage_data).     
+00007330: 2020 2069 6620 6e6f 7420 6375 7374 6f6d     if not custom
+00007340: 7072 6f66 696c 653a 0a20 2020 2020 2020  profile:.       
+00007350: 2020 2020 2070 726f 6669 6c65 2e75 7064       profile.upd
+00007360: 6174 6528 6f76 6572 7269 6465 7329 0a20  ate(overrides). 
+00007370: 2020 2020 2020 2069 6620 2762 6173 6527         if 'base'
+00007380: 2069 6e20 7072 6f66 696c 653a 0a20 2020   in profile:.   
+00007390: 2020 2020 2020 2020 2066 6174 6865 7220           father 
+000073a0: 3d20 766d 7072 6f66 696c 6573 5b70 726f  = vmprofiles[pro
+000073b0: 6669 6c65 5b27 6261 7365 275d 5d0a 2020  file['base']].  
+000073c0: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
+000073d0: 745f 6e75 6d63 7075 7320 3d20 6661 7468  t_numcpus = fath
+000073e0: 6572 2e67 6574 2827 6e75 6d63 7075 7327  er.get('numcpus'
+000073f0: 2c20 7365 6c66 2e6e 756d 6370 7573 290a  , self.numcpus).
+00007400: 2020 2020 2020 2020 2020 2020 6465 6661              defa
+00007410: 756c 745f 6d65 6d6f 7279 203d 2066 6174  ult_memory = fat
+00007420: 6865 722e 6765 7428 276d 656d 6f72 7927  her.get('memory'
+00007430: 2c20 7365 6c66 2e6d 656d 6f72 7929 0a20  , self.memory). 
+00007440: 2020 2020 2020 2020 2020 2064 6566 6175             defau
+00007450: 6c74 5f70 6f6f 6c20 3d20 6661 7468 6572  lt_pool = father
+00007460: 2e67 6574 2827 706f 6f6c 272c 2073 656c  .get('pool', sel
+00007470: 662e 706f 6f6c 290a 2020 2020 2020 2020  f.pool).        
+00007480: 2020 2020 6465 6661 756c 745f 6469 736b      default_disk
+00007490: 7320 3d20 6661 7468 6572 2e67 6574 2827  s = father.get('
+000074a0: 6469 736b 7327 2c20 7365 6c66 2e64 6973  disks', self.dis
+000074b0: 6b73 290a 2020 2020 2020 2020 2020 2020  ks).            
+000074c0: 6465 6661 756c 745f 6e65 7473 203d 2066  default_nets = f
+000074d0: 6174 6865 722e 6765 7428 276e 6574 7327  ather.get('nets'
+000074e0: 2c20 7365 6c66 2e6e 6574 7329 0a20 2020  , self.nets).   
+000074f0: 2020 2020 2020 2020 2064 6566 6175 6c74           default
+00007500: 5f69 6d61 6765 203d 2066 6174 6865 722e  _image = father.
+00007510: 6765 7428 2769 6d61 6765 272c 2073 656c  get('image', sel
+00007520: 662e 696d 6167 6529 0a20 2020 2020 2020  f.image).       
+00007530: 2020 2020 2064 6566 6175 6c74 5f63 6c6f       default_clo
+00007540: 7564 696e 6974 203d 2066 6174 6865 722e  udinit = father.
+00007550: 6765 7428 2763 6c6f 7564 696e 6974 272c  get('cloudinit',
+00007560: 2073 656c 662e 636c 6f75 6469 6e69 7429   self.cloudinit)
+00007570: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
+00007580: 6175 6c74 5f6e 6573 7465 6420 3d20 6661  ault_nested = fa
+00007590: 7468 6572 2e67 6574 2827 6e65 7374 6564  ther.get('nested
+000075a0: 272c 2073 656c 662e 6e65 7374 6564 290a  ', self.nested).
+000075b0: 2020 2020 2020 2020 2020 2020 6465 6661              defa
+000075c0: 756c 745f 7265 7365 7276 6564 6e73 203d  ult_reservedns =
+000075d0: 2066 6174 6865 722e 6765 7428 2772 6573   father.get('res
+000075e0: 6572 7665 646e 7327 2c20 7365 6c66 2e72  ervedns', self.r
+000075f0: 6573 6572 7665 646e 7329 0a20 2020 2020  eservedns).     
+00007600: 2020 2020 2020 2064 6566 6175 6c74 5f72         default_r
+00007610: 6573 6572 7665 686f 7374 203d 2066 6174  eservehost = fat
 00007620: 6865 722e 6765 7428 2772 6573 6572 7665  her.get('reserve
-00007630: 646e 7327 2c20 7365 6c66 2e72 6573 6572  dns', self.reser
-00007640: 7665 646e 7329 0a20 2020 2020 2020 2020  vedns).         
-00007650: 2020 2064 6566 6175 6c74 5f72 6573 6572     default_reser
-00007660: 7665 686f 7374 203d 2066 6174 6865 722e  vehost = father.
-00007670: 6765 7428 2772 6573 6572 7665 686f 7374  get('reservehost
-00007680: 272c 2073 656c 662e 7265 7365 7276 6568  ', self.reserveh
-00007690: 6f73 7429 0a20 2020 2020 2020 2020 2020  ost).           
-000076a0: 2064 6566 6175 6c74 5f63 7075 6d6f 6465   default_cpumode
-000076b0: 6c20 3d20 6661 7468 6572 2e67 6574 2827  l = father.get('
-000076c0: 6370 756d 6f64 656c 272c 2073 656c 662e  cpumodel', self.
-000076d0: 6370 756d 6f64 656c 290a 2020 2020 2020  cpumodel).      
-000076e0: 2020 2020 2020 6465 6661 756c 745f 6370        default_cp
-000076f0: 7566 6c61 6773 203d 2066 6174 6865 722e  uflags = father.
-00007700: 6765 7428 2763 7075 666c 6167 7327 2c20  get('cpuflags', 
-00007710: 7365 6c66 2e63 7075 666c 6167 7329 0a20  self.cpuflags). 
-00007720: 2020 2020 2020 2020 2020 2064 6566 6175             defau
-00007730: 6c74 5f63 7075 7069 6e6e 696e 6720 3d20  lt_cpupinning = 
-00007740: 6661 7468 6572 2e67 6574 2827 6370 7570  father.get('cpup
-00007750: 696e 6e69 6e67 272c 2073 656c 662e 6370  inning', self.cp
-00007760: 7570 696e 6e69 6e67 290a 2020 2020 2020  upinning).      
-00007770: 2020 2020 2020 6465 6661 756c 745f 6469        default_di
-00007780: 736b 7369 7a65 203d 2066 6174 6865 722e  sksize = father.
-00007790: 6765 7428 2764 6973 6b73 697a 6527 2c20  get('disksize', 
-000077a0: 7365 6c66 2e64 6973 6b73 697a 6529 0a20  self.disksize). 
-000077b0: 2020 2020 2020 2020 2020 2064 6566 6175             defau
-000077c0: 6c74 5f64 6973 6b69 6e74 6572 6661 6365  lt_diskinterface
-000077d0: 203d 2066 6174 6865 722e 6765 7428 2764   = father.get('d
-000077e0: 6973 6b69 6e74 6572 6661 6365 272c 2073  iskinterface', s
-000077f0: 656c 662e 6469 736b 696e 7465 7266 6163  elf.diskinterfac
-00007800: 6529 0a20 2020 2020 2020 2020 2020 2064  e).            d
-00007810: 6566 6175 6c74 5f64 6973 6b74 6869 6e20  efault_diskthin 
-00007820: 3d20 6661 7468 6572 2e67 6574 2827 6469  = father.get('di
-00007830: 736b 7468 696e 272c 2073 656c 662e 6469  skthin', self.di
-00007840: 736b 7468 696e 290a 2020 2020 2020 2020  skthin).        
-00007850: 2020 2020 6465 6661 756c 745f 6775 6573      default_gues
-00007860: 7469 6420 3d20 6661 7468 6572 2e67 6574  tid = father.get
-00007870: 2827 6775 6573 7469 6427 2c20 7365 6c66  ('guestid', self
-00007880: 2e67 7565 7374 6964 290a 2020 2020 2020  .guestid).      
-00007890: 2020 2020 2020 6465 6661 756c 745f 6973        default_is
-000078a0: 6f20 3d20 6661 7468 6572 2e67 6574 2827  o = father.get('
-000078b0: 6973 6f27 2c20 7365 6c66 2e69 736f 290a  iso', self.iso).
-000078c0: 2020 2020 2020 2020 2020 2020 6465 6661              defa
-000078d0: 756c 745f 766e 6320 3d20 6661 7468 6572  ult_vnc = father
-000078e0: 2e67 6574 2827 766e 6327 2c20 7365 6c66  .get('vnc', self
-000078f0: 2e76 6e63 290a 2020 2020 2020 2020 2020  .vnc).          
-00007900: 2020 6465 6661 756c 745f 7265 7365 7276    default_reserv
-00007910: 6569 7020 3d20 6661 7468 6572 2e67 6574  eip = father.get
-00007920: 2827 7265 7365 7276 6569 7027 2c20 7365  ('reserveip', se
-00007930: 6c66 2e72 6573 6572 7665 6970 290a 2020  lf.reserveip).  
-00007940: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
-00007950: 745f 7374 6172 7420 3d20 6661 7468 6572  t_start = father
-00007960: 2e67 6574 2827 7374 6172 7427 2c20 7365  .get('start', se
-00007970: 6c66 2e73 7461 7274 290a 2020 2020 2020  lf.start).      
-00007980: 2020 2020 2020 6465 6661 756c 745f 6175        default_au
-00007990: 746f 7374 6172 7420 3d20 6661 7468 6572  tostart = father
-000079a0: 2e67 6574 2827 6175 746f 7374 6172 7427  .get('autostart'
-000079b0: 2c20 7365 6c66 2e61 7574 6f73 7461 7274  , self.autostart
-000079c0: 290a 2020 2020 2020 2020 2020 2020 6465  ).            de
-000079d0: 6661 756c 745f 6b65 7973 203d 2066 6174  fault_keys = fat
-000079e0: 6865 722e 6765 7428 276b 6579 7327 2c20  her.get('keys', 
-000079f0: 7365 6c66 2e6b 6579 7329 0a20 2020 2020  self.keys).     
-00007a00: 2020 2020 2020 2064 6566 6175 6c74 5f6e         default_n
-00007a10: 6574 6d61 736b 7320 3d20 6661 7468 6572  etmasks = father
-00007a20: 2e67 6574 2827 6e65 746d 6173 6b73 272c  .get('netmasks',
-00007a30: 2073 656c 662e 6e65 746d 6173 6b73 290a   self.netmasks).
-00007a40: 2020 2020 2020 2020 2020 2020 6465 6661              defa
-00007a50: 756c 745f 6761 7465 7761 7920 3d20 6661  ult_gateway = fa
-00007a60: 7468 6572 2e67 6574 2827 6761 7465 7761  ther.get('gatewa
-00007a70: 7927 2c20 7365 6c66 2e67 6174 6577 6179  y', self.gateway
-00007a80: 290a 2020 2020 2020 2020 2020 2020 6465  ).            de
-00007a90: 6661 756c 745f 646e 7320 3d20 6661 7468  fault_dns = fath
-00007aa0: 6572 2e67 6574 2827 646e 7327 2c20 7365  er.get('dns', se
-00007ab0: 6c66 2e64 6e73 290a 2020 2020 2020 2020  lf.dns).        
-00007ac0: 2020 2020 6465 6661 756c 745f 646f 6d61      default_doma
-00007ad0: 696e 203d 2066 6174 6865 722e 6765 7428  in = father.get(
-00007ae0: 2764 6f6d 6169 6e27 2c20 7365 6c66 2e64  'domain', self.d
-00007af0: 6f6d 6169 6e29 0a20 2020 2020 2020 2020  omain).         
-00007b00: 2020 2064 6566 6175 6c74 5f66 696c 6573     default_files
-00007b10: 203d 2066 6174 6865 722e 6765 7428 2766   = father.get('f
-00007b20: 696c 6573 272c 2073 656c 662e 6669 6c65  iles', self.file
-00007b30: 7329 0a20 2020 2020 2020 2020 2020 2064  s).            d
-00007b40: 6566 6175 6c74 5f65 6e61 626c 6572 6f6f  efault_enableroo
-00007b50: 7420 3d20 6661 7468 6572 2e67 6574 2827  t = father.get('
-00007b60: 656e 6162 6c65 726f 6f74 272c 2073 656c  enableroot', sel
-00007b70: 662e 656e 6162 6c65 726f 6f74 290a 2020  f.enableroot).  
-00007b80: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
-00007b90: 745f 7072 6976 6174 656b 6579 203d 2066  t_privatekey = f
-00007ba0: 6174 6865 722e 6765 7428 2770 7269 7661  ather.get('priva
-00007bb0: 7465 6b65 7927 2c20 7365 6c66 2e70 7269  tekey', self.pri
-00007bc0: 7661 7465 6b65 7929 0a20 2020 2020 2020  vatekey).       
-00007bd0: 2020 2020 2064 6566 6175 6c74 5f6e 6574       default_net
-00007be0: 776f 726b 7761 6974 203d 2066 6174 6865  workwait = fathe
-00007bf0: 722e 6765 7428 276e 6574 776f 726b 7761  r.get('networkwa
-00007c00: 6974 272c 2073 656c 662e 6e65 7477 6f72  it', self.networ
-00007c10: 6b77 6169 7429 0a20 2020 2020 2020 2020  kwait).         
-00007c20: 2020 2064 6566 6175 6c74 5f72 686e 7265     default_rhnre
-00007c30: 6769 7374 6572 203d 2066 6174 6865 722e  gister = father.
-00007c40: 6765 7428 2772 686e 7265 6769 7374 6572  get('rhnregister
-00007c50: 272c 2073 656c 662e 7268 6e72 6567 6973  ', self.rhnregis
-00007c60: 7465 7229 0a20 2020 2020 2020 2020 2020  ter).           
-00007c70: 2064 6566 6175 6c74 5f72 686e 7365 7276   default_rhnserv
-00007c80: 6572 203d 2066 6174 6865 722e 6765 7428  er = father.get(
-00007c90: 2772 686e 7365 7276 6572 272c 2073 656c  'rhnserver', sel
-00007ca0: 662e 7268 6e73 6572 7665 7229 0a20 2020  f.rhnserver).   
-00007cb0: 2020 2020 2020 2020 2064 6566 6175 6c74           default
-00007cc0: 5f72 686e 7573 6572 203d 2066 6174 6865  _rhnuser = fathe
-00007cd0: 722e 6765 7428 2772 686e 7573 6572 272c  r.get('rhnuser',
-00007ce0: 2073 656c 662e 7268 6e75 7365 7229 0a20   self.rhnuser). 
-00007cf0: 2020 2020 2020 2020 2020 2064 6566 6175             defau
-00007d00: 6c74 5f72 686e 7061 7373 776f 7264 203d  lt_rhnpassword =
-00007d10: 2066 6174 6865 722e 6765 7428 2772 686e   father.get('rhn
-00007d20: 7061 7373 776f 7264 272c 2073 656c 662e  password', self.
-00007d30: 7268 6e70 6173 7377 6f72 6429 0a20 2020  rhnpassword).   
-00007d40: 2020 2020 2020 2020 2064 6566 6175 6c74           default
-00007d50: 5f72 686e 616b 203d 2066 6174 6865 722e  _rhnak = father.
-00007d60: 6765 7428 2772 686e 6163 7469 7661 7469  get('rhnactivati
-00007d70: 6f6e 6b65 7927 2c20 7365 6c66 2e72 686e  onkey', self.rhn
-00007d80: 616b 290a 2020 2020 2020 2020 2020 2020  ak).            
-00007d90: 6465 6661 756c 745f 7268 6e6f 7267 203d  default_rhnorg =
-00007da0: 2066 6174 6865 722e 6765 7428 2772 686e   father.get('rhn
-00007db0: 6f72 6727 2c20 7365 6c66 2e72 686e 6f72  org', self.rhnor
-00007dc0: 6729 0a20 2020 2020 2020 2020 2020 2064  g).            d
-00007dd0: 6566 6175 6c74 5f72 686e 706f 6f6c 203d  efault_rhnpool =
-00007de0: 2066 6174 6865 722e 6765 7428 2772 686e   father.get('rhn
-00007df0: 706f 6f6c 272c 2073 656c 662e 7268 6e70  pool', self.rhnp
-00007e00: 6f6f 6c29 0a20 2020 2020 2020 2020 2020  ool).           
-00007e10: 2064 6566 6175 6c74 5f74 6167 7320 3d20   default_tags = 
-00007e20: 6661 7468 6572 2e67 6574 2827 7461 6773  father.get('tags
-00007e30: 272c 2073 656c 662e 7461 6773 290a 2020  ', self.tags).  
-00007e40: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
-00007e50: 745f 666c 6176 6f72 203d 2066 6174 6865  t_flavor = fathe
-00007e60: 722e 6765 7428 2766 6c61 766f 7227 2c20  r.get('flavor', 
-00007e70: 7365 6c66 2e66 6c61 766f 7229 0a20 2020  self.flavor).   
-00007e80: 2020 2020 2020 2020 2064 6566 6175 6c74           default
-00007e90: 5f63 6d64 7320 3d20 636f 6d6d 6f6e 2e72  _cmds = common.r
-00007ea0: 656d 6f76 655f 6475 706c 6963 6174 6573  emove_duplicates
-00007eb0: 2873 656c 662e 636d 6473 202b 2066 6174  (self.cmds + fat
-00007ec0: 6865 722e 6765 7428 2763 6d64 7327 2c20  her.get('cmds', 
-00007ed0: 5b5d 2929 0a20 2020 2020 2020 2020 2020  [])).           
-00007ee0: 2064 6566 6175 6c74 5f73 6372 6970 7473   default_scripts
-00007ef0: 203d 2063 6f6d 6d6f 6e2e 7265 6d6f 7665   = common.remove
-00007f00: 5f64 7570 6c69 6361 7465 7328 7365 6c66  _duplicates(self
-00007f10: 2e73 6372 6970 7473 202b 2066 6174 6865  .scripts + fathe
-00007f20: 722e 6765 7428 2773 6372 6970 7473 272c  r.get('scripts',
-00007f30: 205b 5d29 290a 2020 2020 2020 2020 2020   [])).          
-00007f40: 2020 6465 6661 756c 745f 646e 7363 6c69    default_dnscli
-00007f50: 656e 7420 3d20 6661 7468 6572 2e67 6574  ent = father.get
-00007f60: 2827 646e 7363 6c69 656e 7427 2c20 7365  ('dnsclient', se
-00007f70: 6c66 2e64 6e73 636c 6965 6e74 290a 2020  lf.dnsclient).  
-00007f80: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
-00007f90: 745f 7374 6f72 656d 6574 6164 6174 6120  t_storemetadata 
-00007fa0: 3d20 6661 7468 6572 2e67 6574 2827 7374  = father.get('st
-00007fb0: 6f72 656d 6574 6164 6174 6127 2c20 7365  oremetadata', se
-00007fc0: 6c66 2e73 746f 7265 6d65 7461 6461 7461  lf.storemetadata
-00007fd0: 290a 2020 2020 2020 2020 2020 2020 6465  ).            de
-00007fe0: 6661 756c 745f 6e6f 7469 6679 203d 2066  fault_notify = f
-00007ff0: 6174 6865 722e 6765 7428 276e 6f74 6966  ather.get('notif
-00008000: 7927 2c20 7365 6c66 2e6e 6f74 6966 7929  y', self.notify)
-00008010: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
-00008020: 6175 6c74 5f70 7573 6862 756c 6c65 7474  ault_pushbullett
-00008030: 6f6b 656e 203d 2066 6174 6865 722e 6765  oken = father.ge
-00008040: 7428 2770 7573 6862 756c 6c65 7474 6f6b  t('pushbullettok
-00008050: 656e 272c 2073 656c 662e 7075 7368 6275  en', self.pushbu
-00008060: 6c6c 6574 746f 6b65 6e29 0a20 2020 2020  llettoken).     
-00008070: 2020 2020 2020 2064 6566 6175 6c74 5f6d         default_m
-00008080: 6169 6c73 6572 7665 7220 3d20 6661 7468  ailserver = fath
-00008090: 6572 2e67 6574 2827 6d61 696c 7365 7276  er.get('mailserv
-000080a0: 6572 272c 2073 656c 662e 6d61 696c 7365  er', self.mailse
-000080b0: 7276 6572 290a 2020 2020 2020 2020 2020  rver).          
-000080c0: 2020 6465 6661 756c 745f 6d61 696c 6672    default_mailfr
-000080d0: 6f6d 203d 2066 6174 6865 722e 6765 7428  om = father.get(
-000080e0: 276d 6169 6c66 726f 6d27 2c20 7365 6c66  'mailfrom', self
-000080f0: 2e6d 6169 6c66 726f 6d29 0a20 2020 2020  .mailfrom).     
-00008100: 2020 2020 2020 2064 6566 6175 6c74 5f6d         default_m
-00008110: 6169 6c74 6f20 3d20 6661 7468 6572 2e67  ailto = father.g
-00008120: 6574 2827 6d61 696c 746f 272c 2073 656c  et('mailto', sel
-00008130: 662e 6d61 696c 746f 290a 2020 2020 2020  f.mailto).      
-00008140: 2020 2020 2020 6465 6661 756c 745f 6e6f        default_no
-00008150: 7469 6679 636d 6420 3d20 6661 7468 6572  tifycmd = father
-00008160: 2e67 6574 2827 6e6f 7469 6679 636d 6427  .get('notifycmd'
-00008170: 2c20 7365 6c66 2e6e 6f74 6966 7963 6d64  , self.notifycmd
-00008180: 290a 2020 2020 2020 2020 2020 2020 6465  ).            de
-00008190: 6661 756c 745f 6e6f 7469 6679 7363 7269  fault_notifyscri
-000081a0: 7074 203d 2066 6174 6865 722e 6765 7428  pt = father.get(
-000081b0: 276e 6f74 6966 7973 6372 6970 7427 2c20  'notifyscript', 
-000081c0: 7365 6c66 2e6e 6f74 6966 7973 6372 6970  self.notifyscrip
-000081d0: 7429 0a20 2020 2020 2020 2020 2020 2064  t).            d
-000081e0: 6566 6175 6c74 5f6e 6f74 6966 796d 6574  efault_notifymet
-000081f0: 686f 6473 203d 2066 6174 6865 722e 6765  hods = father.ge
-00008200: 7428 276e 6f74 6966 796d 6574 686f 6473  t('notifymethods
-00008210: 272c 2073 656c 662e 6e6f 7469 6679 6d65  ', self.notifyme
-00008220: 7468 6f64 7329 0a20 2020 2020 2020 2020  thods).         
-00008230: 2020 2064 6566 6175 6c74 5f73 6c61 636b     default_slack
-00008240: 6368 616e 6e65 6c20 3d20 6661 7468 6572  channel = father
-00008250: 2e67 6574 2827 736c 6163 6b63 6861 6e6e  .get('slackchann
-00008260: 656c 272c 2073 656c 662e 736c 6163 6b63  el', self.slackc
-00008270: 6861 6e6e 656c 290a 2020 2020 2020 2020  hannel).        
-00008280: 2020 2020 6465 6661 756c 745f 7075 7368      default_push
-00008290: 6275 6c6c 6574 746f 6b65 6e20 3d20 6661  bullettoken = fa
-000082a0: 7468 6572 2e67 6574 2827 7075 7368 6275  ther.get('pushbu
-000082b0: 6c6c 6574 746f 6b65 6e27 2c20 7365 6c66  llettoken', self
-000082c0: 2e70 7573 6862 756c 6c65 7474 6f6b 656e  .pushbullettoken
-000082d0: 290a 2020 2020 2020 2020 2020 2020 6465  ).            de
-000082e0: 6661 756c 745f 736c 6163 6b74 6f6b 656e  fault_slacktoken
-000082f0: 203d 2066 6174 6865 722e 6765 7428 2773   = father.get('s
-00008300: 6c61 636b 746f 6b65 6e27 2c20 7365 6c66  lacktoken', self
-00008310: 2e73 6c61 636b 746f 6b65 6e29 0a20 2020  .slacktoken).   
-00008320: 2020 2020 2020 2020 2064 6566 6175 6c74           default
-00008330: 5f73 6861 7265 6466 6f6c 6465 7273 203d  _sharedfolders =
-00008340: 2066 6174 6865 722e 6765 7428 2773 6861   father.get('sha
-00008350: 7265 6466 6f6c 6465 7273 272c 2073 656c  redfolders', sel
-00008360: 662e 7368 6172 6564 666f 6c64 6572 7329  f.sharedfolders)
-00008370: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
-00008380: 6175 6c74 5f6b 6572 6e65 6c20 3d20 6661  ault_kernel = fa
-00008390: 7468 6572 2e67 6574 2827 6b65 726e 656c  ther.get('kernel
-000083a0: 272c 2073 656c 662e 6b65 726e 656c 290a  ', self.kernel).
-000083b0: 2020 2020 2020 2020 2020 2020 6465 6661              defa
-000083c0: 756c 745f 696e 6974 7264 203d 2066 6174  ult_initrd = fat
-000083d0: 6865 722e 6765 7428 2769 6e69 7472 6427  her.get('initrd'
-000083e0: 2c20 7365 6c66 2e69 6e69 7472 6429 0a20  , self.initrd). 
-000083f0: 2020 2020 2020 2020 2020 2064 6566 6175             defau
-00008400: 6c74 5f63 6d64 6c69 6e65 203d 2066 6174  lt_cmdline = fat
-00008410: 6865 722e 6765 7428 2763 6d64 6c69 6e65  her.get('cmdline
-00008420: 272c 2073 656c 662e 636d 646c 696e 6529  ', self.cmdline)
-00008430: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
-00008440: 6175 6c74 5f70 6c61 6365 6d65 6e74 203d  ault_placement =
-00008450: 2066 6174 6865 722e 6765 7428 2770 6c61   father.get('pla
-00008460: 6365 6d65 6e74 272c 2073 656c 662e 706c  cement', self.pl
-00008470: 6163 656d 656e 7429 0a20 2020 2020 2020  acement).       
-00008480: 2020 2020 2064 6566 6175 6c74 5f79 616d       default_yam
-00008490: 6c69 6e76 656e 746f 7279 203d 2066 6174  linventory = fat
-000084a0: 6865 722e 6765 7428 2779 616d 6c69 6e76  her.get('yamlinv
-000084b0: 656e 746f 7279 272c 2073 656c 662e 7961  entory', self.ya
-000084c0: 6d6c 696e 7665 6e74 6f72 7929 0a20 2020  mlinventory).   
-000084d0: 2020 2020 2020 2020 2064 6566 6175 6c74           default
-000084e0: 5f63 7075 686f 7470 6c75 6720 3d20 6661  _cpuhotplug = fa
-000084f0: 7468 6572 2e67 6574 2827 6370 7568 6f74  ther.get('cpuhot
-00008500: 706c 7567 272c 2073 656c 662e 6370 7568  plug', self.cpuh
-00008510: 6f74 706c 7567 290a 2020 2020 2020 2020  otplug).        
-00008520: 2020 2020 6465 6661 756c 745f 6d65 6d6f      default_memo
-00008530: 7279 686f 7470 6c75 6720 3d20 6661 7468  ryhotplug = fath
-00008540: 6572 2e67 6574 2827 6d65 6d6f 7279 686f  er.get('memoryho
-00008550: 7470 6c75 6727 2c20 7365 6c66 2e6d 656d  tplug', self.mem
-00008560: 6f72 7968 6f74 706c 7567 290a 2020 2020  oryhotplug).    
-00008570: 2020 2020 2020 2020 6465 6661 756c 745f          default_
-00008580: 6e75 6d61 203d 2066 6174 6865 722e 6765  numa = father.ge
-00008590: 7428 276e 756d 6127 2c20 7365 6c66 2e6e  t('numa', self.n
-000085a0: 756d 6129 0a20 2020 2020 2020 2020 2020  uma).           
-000085b0: 2064 6566 6175 6c74 5f6e 756d 616d 6f64   default_numamod
-000085c0: 6520 3d20 6661 7468 6572 2e67 6574 2827  e = father.get('
-000085d0: 6e75 6d61 6d6f 6465 272c 2073 656c 662e  numamode', self.
-000085e0: 6e75 6d61 6d6f 6465 290a 2020 2020 2020  numamode).      
-000085f0: 2020 2020 2020 6465 6661 756c 745f 7063        default_pc
-00008600: 6964 6576 6963 6573 203d 2066 6174 6865  idevices = fathe
-00008610: 722e 6765 7428 2770 6369 6465 7669 6365  r.get('pcidevice
-00008620: 7327 2c20 7365 6c66 2e70 6369 6465 7669  s', self.pcidevi
-00008630: 6365 7329 0a20 2020 2020 2020 2020 2020  ces).           
-00008640: 2064 6566 6175 6c74 5f74 706d 203d 2066   default_tpm = f
-00008650: 6174 6865 722e 6765 7428 2774 706d 272c  ather.get('tpm',
-00008660: 2073 656c 662e 7470 6d29 0a20 2020 2020   self.tpm).     
-00008670: 2020 2020 2020 2064 6566 6175 6c74 5f72         default_r
-00008680: 6e67 203d 2066 6174 6865 722e 6765 7428  ng = father.get(
-00008690: 2772 6e67 272c 2073 656c 662e 726e 6729  'rng', self.rng)
-000086a0: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
-000086b0: 6175 6c74 5f76 6972 7474 7970 6520 3d20  ault_virttype = 
-000086c0: 6661 7468 6572 2e67 6574 2827 7669 7274  father.get('virt
-000086d0: 7479 7065 272c 2073 656c 662e 7669 7274  type', self.virt
-000086e0: 7479 7065 290a 2020 2020 2020 2020 2020  type).          
-000086f0: 2020 6465 6661 756c 745f 7365 6375 7269    default_securi
-00008700: 7479 6772 6f75 7073 203d 2066 6174 6865  tygroups = fathe
-00008710: 722e 6765 7428 2773 6563 7572 6974 7967  r.get('securityg
-00008720: 726f 7570 7327 2c20 7365 6c66 2e73 6563  roups', self.sec
-00008730: 7572 6974 7967 726f 7570 7329 0a20 2020  uritygroups).   
-00008740: 2020 2020 2020 2020 2064 6566 6175 6c74           default
-00008750: 5f72 6f6f 7470 6173 7377 6f72 6420 3d20  _rootpassword = 
-00008760: 6661 7468 6572 2e67 6574 2827 726f 6f74  father.get('root
-00008770: 7061 7373 776f 7264 272c 2073 656c 662e  password', self.
-00008780: 726f 6f74 7061 7373 776f 7264 290a 2020  rootpassword).  
-00008790: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
-000087a0: 745f 7465 6d70 6b65 7920 3d20 6661 7468  t_tempkey = fath
-000087b0: 6572 2e67 6574 2827 7465 6d70 6b65 7927  er.get('tempkey'
-000087c0: 2c20 7365 6c66 2e74 656d 706b 6579 290a  , self.tempkey).
-000087d0: 2020 2020 2020 2020 2020 2020 6465 6661              defa
-000087e0: 756c 745f 766d 7573 6572 203d 2066 6174  ult_vmuser = fat
-000087f0: 6865 722e 6765 7428 2776 6d75 7365 7227  her.get('vmuser'
-00008800: 2c20 7365 6c66 2e76 6d75 7365 7229 0a20  , self.vmuser). 
-00008810: 2020 2020 2020 2020 2020 2064 6566 6175             defau
-00008820: 6c74 5f77 6169 7420 3d20 6661 7468 6572  lt_wait = father
-00008830: 2e67 6574 2827 7761 6974 272c 2073 656c  .get('wait', sel
-00008840: 662e 7761 6974 290a 2020 2020 2020 2020  f.wait).        
-00008850: 2020 2020 6465 6661 756c 745f 7761 6974      default_wait
-00008860: 636f 6d6d 616e 6420 3d20 6661 7468 6572  command = father
-00008870: 2e67 6574 2827 7761 6974 636f 6d6d 616e  .get('waitcomman
-00008880: 6427 2c20 7365 6c66 2e77 6169 7463 6f6d  d', self.waitcom
-00008890: 6d61 6e64 290a 2020 2020 2020 2020 2020  mand).          
-000088a0: 2020 6465 6661 756c 745f 7761 6974 7469    default_waitti
-000088b0: 6d65 6f75 7420 3d20 6661 7468 6572 2e67  meout = father.g
-000088c0: 6574 2827 7761 6974 7469 6d65 6f75 7427  et('waittimeout'
-000088d0: 2c20 7365 6c66 2e77 6169 7474 696d 656f  , self.waittimeo
-000088e0: 7574 290a 2020 2020 2020 2020 656c 7365  ut).        else
-000088f0: 3a0a 2020 2020 2020 2020 2020 2020 6465  :.            de
-00008900: 6661 756c 745f 6e75 6d63 7075 7320 3d20  fault_numcpus = 
-00008910: 7365 6c66 2e6e 756d 6370 7573 0a20 2020  self.numcpus.   
-00008920: 2020 2020 2020 2020 2064 6566 6175 6c74           default
-00008930: 5f6d 656d 6f72 7920 3d20 7365 6c66 2e6d  _memory = self.m
-00008940: 656d 6f72 790a 2020 2020 2020 2020 2020  emory.          
-00008950: 2020 6465 6661 756c 745f 706f 6f6c 203d    default_pool =
-00008960: 2073 656c 662e 706f 6f6c 0a20 2020 2020   self.pool.     
-00008970: 2020 2020 2020 2064 6566 6175 6c74 5f64         default_d
-00008980: 6973 6b73 203d 2073 656c 662e 6469 736b  isks = self.disk
-00008990: 730a 2020 2020 2020 2020 2020 2020 6465  s.            de
-000089a0: 6661 756c 745f 6e65 7473 203d 2073 656c  fault_nets = sel
-000089b0: 662e 6e65 7473 0a20 2020 2020 2020 2020  f.nets.         
-000089c0: 2020 2064 6566 6175 6c74 5f69 6d61 6765     default_image
-000089d0: 203d 2073 656c 662e 696d 6167 650a 2020   = self.image.  
-000089e0: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
-000089f0: 745f 636c 6f75 6469 6e69 7420 3d20 7365  t_cloudinit = se
-00008a00: 6c66 2e63 6c6f 7564 696e 6974 0a20 2020  lf.cloudinit.   
-00008a10: 2020 2020 2020 2020 2064 6566 6175 6c74           default
-00008a20: 5f6e 6573 7465 6420 3d20 7365 6c66 2e6e  _nested = self.n
-00008a30: 6573 7465 640a 2020 2020 2020 2020 2020  ested.          
-00008a40: 2020 6465 6661 756c 745f 7265 7365 7276    default_reserv
-00008a50: 6564 6e73 203d 2073 656c 662e 7265 7365  edns = self.rese
-00008a60: 7276 6564 6e73 0a20 2020 2020 2020 2020  rvedns.         
-00008a70: 2020 2064 6566 6175 6c74 5f72 6573 6572     default_reser
-00008a80: 7665 686f 7374 203d 2073 656c 662e 7265  vehost = self.re
-00008a90: 7365 7276 6568 6f73 740a 2020 2020 2020  servehost.      
-00008aa0: 2020 2020 2020 6465 6661 756c 745f 6370        default_cp
-00008ab0: 756d 6f64 656c 203d 2073 656c 662e 6370  umodel = self.cp
-00008ac0: 756d 6f64 656c 0a20 2020 2020 2020 2020  umodel.         
-00008ad0: 2020 2064 6566 6175 6c74 5f63 7075 666c     default_cpufl
-00008ae0: 6167 7320 3d20 7365 6c66 2e63 7075 666c  ags = self.cpufl
-00008af0: 6167 730a 2020 2020 2020 2020 2020 2020  ags.            
-00008b00: 6465 6661 756c 745f 6370 7570 696e 6e69  default_cpupinni
-00008b10: 6e67 203d 2073 656c 662e 6370 7570 696e  ng = self.cpupin
-00008b20: 6e69 6e67 0a20 2020 2020 2020 2020 2020  ning.           
-00008b30: 2064 6566 6175 6c74 5f6e 756d 616d 6f64   default_numamod
-00008b40: 6520 3d20 7365 6c66 2e6e 756d 616d 6f64  e = self.numamod
-00008b50: 650a 2020 2020 2020 2020 2020 2020 6465  e.            de
-00008b60: 6661 756c 745f 6e75 6d61 203d 2073 656c  fault_numa = sel
-00008b70: 662e 6e75 6d61 0a20 2020 2020 2020 2020  f.numa.         
-00008b80: 2020 2064 6566 6175 6c74 5f70 6369 6465     default_pcide
-00008b90: 7669 6365 7320 3d20 7365 6c66 2e70 6369  vices = self.pci
-00008ba0: 6465 7669 6365 730a 2020 2020 2020 2020  devices.        
-00008bb0: 2020 2020 6465 6661 756c 745f 7470 6d20      default_tpm 
-00008bc0: 3d20 7365 6c66 2e74 706d 0a20 2020 2020  = self.tpm.     
-00008bd0: 2020 2020 2020 2064 6566 6175 6c74 5f72         default_r
-00008be0: 6e67 203d 2073 656c 662e 726e 670a 2020  ng = self.rng.  
-00008bf0: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
-00008c00: 745f 6469 736b 7369 7a65 203d 2073 656c  t_disksize = sel
-00008c10: 662e 6469 736b 7369 7a65 0a20 2020 2020  f.disksize.     
-00008c20: 2020 2020 2020 2064 6566 6175 6c74 5f64         default_d
-00008c30: 6973 6b69 6e74 6572 6661 6365 203d 2073  iskinterface = s
-00008c40: 656c 662e 6469 736b 696e 7465 7266 6163  elf.diskinterfac
-00008c50: 650a 2020 2020 2020 2020 2020 2020 6465  e.            de
-00008c60: 6661 756c 745f 6469 736b 7468 696e 203d  fault_diskthin =
-00008c70: 2073 656c 662e 6469 736b 7468 696e 0a20   self.diskthin. 
-00008c80: 2020 2020 2020 2020 2020 2064 6566 6175             defau
-00008c90: 6c74 5f67 7565 7374 6964 203d 2073 656c  lt_guestid = sel
-00008ca0: 662e 6775 6573 7469 640a 2020 2020 2020  f.guestid.      
-00008cb0: 2020 2020 2020 6465 6661 756c 745f 6973        default_is
-00008cc0: 6f20 3d20 7365 6c66 2e69 736f 0a20 2020  o = self.iso.   
-00008cd0: 2020 2020 2020 2020 2064 6566 6175 6c74           default
-00008ce0: 5f76 6e63 203d 2073 656c 662e 766e 630a  _vnc = self.vnc.
-00008cf0: 2020 2020 2020 2020 2020 2020 6465 6661              defa
-00008d00: 756c 745f 7265 7365 7276 6569 7020 3d20  ult_reserveip = 
-00008d10: 7365 6c66 2e72 6573 6572 7665 6970 0a20  self.reserveip. 
-00008d20: 2020 2020 2020 2020 2020 2064 6566 6175             defau
-00008d30: 6c74 5f73 7461 7274 203d 2073 656c 662e  lt_start = self.
-00008d40: 7374 6172 740a 2020 2020 2020 2020 2020  start.          
-00008d50: 2020 6465 6661 756c 745f 6175 746f 7374    default_autost
-00008d60: 6172 7420 3d20 7365 6c66 2e61 7574 6f73  art = self.autos
-00008d70: 7461 7274 0a20 2020 2020 2020 2020 2020  tart.           
-00008d80: 2064 6566 6175 6c74 5f6b 6579 7320 3d20   default_keys = 
-00008d90: 7365 6c66 2e6b 6579 730a 2020 2020 2020  self.keys.      
-00008da0: 2020 2020 2020 6465 6661 756c 745f 6e65        default_ne
-00008db0: 746d 6173 6b73 203d 2073 656c 662e 6e65  tmasks = self.ne
-00008dc0: 746d 6173 6b73 0a20 2020 2020 2020 2020  tmasks.         
-00008dd0: 2020 2064 6566 6175 6c74 5f67 6174 6577     default_gatew
-00008de0: 6179 203d 2073 656c 662e 6761 7465 7761  ay = self.gatewa
-00008df0: 790a 2020 2020 2020 2020 2020 2020 6465  y.            de
-00008e00: 6661 756c 745f 646e 7320 3d20 7365 6c66  fault_dns = self
-00008e10: 2e64 6e73 0a20 2020 2020 2020 2020 2020  .dns.           
-00008e20: 2064 6566 6175 6c74 5f64 6f6d 6169 6e20   default_domain 
-00008e30: 3d20 7365 6c66 2e64 6f6d 6169 6e0a 2020  = self.domain.  
-00008e40: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
-00008e50: 745f 6669 6c65 7320 3d20 7365 6c66 2e66  t_files = self.f
-00008e60: 696c 6573 0a20 2020 2020 2020 2020 2020  iles.           
-00008e70: 2064 6566 6175 6c74 5f65 6e61 626c 6572   default_enabler
-00008e80: 6f6f 7420 3d20 7365 6c66 2e65 6e61 626c  oot = self.enabl
-00008e90: 6572 6f6f 740a 2020 2020 2020 2020 2020  eroot.          
-00008ea0: 2020 6465 6661 756c 745f 7461 6773 203d    default_tags =
-00008eb0: 2073 656c 662e 7461 6773 0a20 2020 2020   self.tags.     
-00008ec0: 2020 2020 2020 2064 6566 6175 6c74 5f66         default_f
-00008ed0: 6c61 766f 7220 3d20 7365 6c66 2e66 6c61  lavor = self.fla
-00008ee0: 766f 720a 2020 2020 2020 2020 2020 2020  vor.            
-00008ef0: 6465 6661 756c 745f 7072 6976 6174 656b  default_privatek
-00008f00: 6579 203d 2073 656c 662e 7072 6976 6174  ey = self.privat
-00008f10: 656b 6579 0a20 2020 2020 2020 2020 2020  ekey.           
-00008f20: 2064 6566 6175 6c74 5f6e 6574 776f 726b   default_network
-00008f30: 7761 6974 203d 2073 656c 662e 6e65 7477  wait = self.netw
-00008f40: 6f72 6b77 6169 740a 2020 2020 2020 2020  orkwait.        
-00008f50: 2020 2020 6465 6661 756c 745f 7268 6e72      default_rhnr
-00008f60: 6567 6973 7465 7220 3d20 7365 6c66 2e72  egister = self.r
-00008f70: 686e 7265 6769 7374 6572 0a20 2020 2020  hnregister.     
-00008f80: 2020 2020 2020 2064 6566 6175 6c74 5f72         default_r
-00008f90: 686e 7365 7276 6572 203d 2073 656c 662e  hnserver = self.
-00008fa0: 7268 6e73 6572 7665 720a 2020 2020 2020  rhnserver.      
-00008fb0: 2020 2020 2020 6465 6661 756c 745f 7268        default_rh
-00008fc0: 6e75 7365 7220 3d20 7365 6c66 2e72 686e  nuser = self.rhn
-00008fd0: 7573 6572 0a20 2020 2020 2020 2020 2020  user.           
-00008fe0: 2064 6566 6175 6c74 5f72 686e 7061 7373   default_rhnpass
-00008ff0: 776f 7264 203d 2073 656c 662e 7268 6e70  word = self.rhnp
-00009000: 6173 7377 6f72 640a 2020 2020 2020 2020  assword.        
-00009010: 2020 2020 6465 6661 756c 745f 7268 6e61      default_rhna
-00009020: 6b20 3d20 7365 6c66 2e72 686e 616b 0a20  k = self.rhnak. 
-00009030: 2020 2020 2020 2020 2020 2064 6566 6175             defau
-00009040: 6c74 5f72 686e 6f72 6720 3d20 7365 6c66  lt_rhnorg = self
-00009050: 2e72 686e 6f72 670a 2020 2020 2020 2020  .rhnorg.        
-00009060: 2020 2020 6465 6661 756c 745f 7268 6e70      default_rhnp
-00009070: 6f6f 6c20 3d20 7365 6c66 2e72 686e 706f  ool = self.rhnpo
-00009080: 6f6c 0a20 2020 2020 2020 2020 2020 2064  ol.            d
-00009090: 6566 6175 6c74 5f63 6d64 7320 3d20 7365  efault_cmds = se
-000090a0: 6c66 2e63 6d64 730a 2020 2020 2020 2020  lf.cmds.        
-000090b0: 2020 2020 6465 6661 756c 745f 7363 7269      default_scri
-000090c0: 7074 7320 3d20 7365 6c66 2e73 6372 6970  pts = self.scrip
-000090d0: 7473 0a20 2020 2020 2020 2020 2020 2064  ts.            d
-000090e0: 6566 6175 6c74 5f64 6e73 636c 6965 6e74  efault_dnsclient
-000090f0: 203d 2073 656c 662e 646e 7363 6c69 656e   = self.dnsclien
-00009100: 740a 2020 2020 2020 2020 2020 2020 6465  t.            de
-00009110: 6661 756c 745f 7374 6f72 656d 6574 6164  fault_storemetad
-00009120: 6174 6120 3d20 7365 6c66 2e73 746f 7265  ata = self.store
-00009130: 6d65 7461 6461 7461 0a20 2020 2020 2020  metadata.       
-00009140: 2020 2020 2064 6566 6175 6c74 5f6e 6f74       default_not
-00009150: 6966 7920 3d20 7365 6c66 2e6e 6f74 6966  ify = self.notif
-00009160: 790a 2020 2020 2020 2020 2020 2020 6465  y.            de
-00009170: 6661 756c 745f 7075 7368 6275 6c6c 6574  fault_pushbullet
-00009180: 746f 6b65 6e20 3d20 7365 6c66 2e70 7573  token = self.pus
-00009190: 6862 756c 6c65 7474 6f6b 656e 0a20 2020  hbullettoken.   
-000091a0: 2020 2020 2020 2020 2064 6566 6175 6c74           default
-000091b0: 5f73 6c61 636b 746f 6b65 6e20 3d20 7365  _slacktoken = se
-000091c0: 6c66 2e73 6c61 636b 746f 6b65 6e0a 2020  lf.slacktoken.  
-000091d0: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
-000091e0: 745f 6d61 696c 7365 7276 6572 203d 2073  t_mailserver = s
-000091f0: 656c 662e 6d61 696c 7365 7276 6572 0a20  elf.mailserver. 
-00009200: 2020 2020 2020 2020 2020 2064 6566 6175             defau
-00009210: 6c74 5f6d 6169 6c66 726f 6d20 3d20 7365  lt_mailfrom = se
-00009220: 6c66 2e6d 6169 6c66 726f 6d0a 2020 2020  lf.mailfrom.    
-00009230: 2020 2020 2020 2020 6465 6661 756c 745f          default_
-00009240: 6d61 696c 746f 203d 2073 656c 662e 6d61  mailto = self.ma
-00009250: 696c 746f 0a20 2020 2020 2020 2020 2020  ilto.           
-00009260: 2064 6566 6175 6c74 5f6e 6f74 6966 7963   default_notifyc
-00009270: 6d64 203d 2073 656c 662e 6e6f 7469 6679  md = self.notify
-00009280: 636d 640a 2020 2020 2020 2020 2020 2020  cmd.            
-00009290: 6465 6661 756c 745f 6e6f 7469 6679 7363  default_notifysc
-000092a0: 7269 7074 203d 2073 656c 662e 6e6f 7469  ript = self.noti
-000092b0: 6679 7363 7269 7074 0a20 2020 2020 2020  fyscript.       
-000092c0: 2020 2020 2064 6566 6175 6c74 5f6e 6f74       default_not
-000092d0: 6966 796d 6574 686f 6473 203d 2073 656c  ifymethods = sel
-000092e0: 662e 6e6f 7469 6679 6d65 7468 6f64 730a  f.notifymethods.
-000092f0: 2020 2020 2020 2020 2020 2020 6465 6661              defa
-00009300: 756c 745f 736c 6163 6b63 6861 6e6e 656c  ult_slackchannel
-00009310: 203d 2073 656c 662e 736c 6163 6b63 6861   = self.slackcha
-00009320: 6e6e 656c 0a20 2020 2020 2020 2020 2020  nnel.           
-00009330: 2064 6566 6175 6c74 5f73 6861 7265 6466   default_sharedf
-00009340: 6f6c 6465 7273 203d 2073 656c 662e 7368  olders = self.sh
-00009350: 6172 6564 666f 6c64 6572 730a 2020 2020  aredfolders.    
-00009360: 2020 2020 2020 2020 6465 6661 756c 745f          default_
-00009370: 6b65 726e 656c 203d 2073 656c 662e 6b65  kernel = self.ke
-00009380: 726e 656c 0a20 2020 2020 2020 2020 2020  rnel.           
-00009390: 2064 6566 6175 6c74 5f69 6e69 7472 6420   default_initrd 
-000093a0: 3d20 7365 6c66 2e69 6e69 7472 640a 2020  = self.initrd.  
-000093b0: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
-000093c0: 745f 636d 646c 696e 6520 3d20 7365 6c66  t_cmdline = self
-000093d0: 2e63 6d64 6c69 6e65 0a20 2020 2020 2020  .cmdline.       
-000093e0: 2020 2020 2064 6566 6175 6c74 5f70 6c61       default_pla
-000093f0: 6365 6d65 6e74 203d 2073 656c 662e 706c  cement = self.pl
-00009400: 6163 656d 656e 740a 2020 2020 2020 2020  acement.        
-00009410: 2020 2020 6465 6661 756c 745f 7961 6d6c      default_yaml
-00009420: 696e 7665 6e74 6f72 7920 3d20 7365 6c66  inventory = self
-00009430: 2e79 616d 6c69 6e76 656e 746f 7279 0a20  .yamlinventory. 
-00009440: 2020 2020 2020 2020 2020 2064 6566 6175             defau
-00009450: 6c74 5f63 7075 686f 7470 6c75 6720 3d20  lt_cpuhotplug = 
-00009460: 7365 6c66 2e63 7075 686f 7470 6c75 670a  self.cpuhotplug.
-00009470: 2020 2020 2020 2020 2020 2020 6465 6661              defa
-00009480: 756c 745f 6d65 6d6f 7279 686f 7470 6c75  ult_memoryhotplu
-00009490: 6720 3d20 7365 6c66 2e6d 656d 6f72 7968  g = self.memoryh
-000094a0: 6f74 706c 7567 0a20 2020 2020 2020 2020  otplug.         
-000094b0: 2020 2064 6566 6175 6c74 5f76 6972 7474     default_virtt
-000094c0: 7970 6520 3d20 7365 6c66 2e76 6972 7474  ype = self.virtt
-000094d0: 7970 650a 2020 2020 2020 2020 2020 2020  ype.            
-000094e0: 6465 6661 756c 745f 7365 6375 7269 7479  default_security
-000094f0: 6772 6f75 7073 203d 2073 656c 662e 7365  groups = self.se
-00009500: 6375 7269 7479 6772 6f75 7073 0a20 2020  curitygroups.   
-00009510: 2020 2020 2020 2020 2064 6566 6175 6c74           default
-00009520: 5f72 6f6f 7470 6173 7377 6f72 6420 3d20  _rootpassword = 
-00009530: 7365 6c66 2e72 6f6f 7470 6173 7377 6f72  self.rootpasswor
-00009540: 640a 2020 2020 2020 2020 2020 2020 6465  d.            de
-00009550: 6661 756c 745f 7465 6d70 6b65 7920 3d20  fault_tempkey = 
-00009560: 7365 6c66 2e74 656d 706b 6579 0a20 2020  self.tempkey.   
-00009570: 2020 2020 2020 2020 2064 6566 6175 6c74           default
-00009580: 5f76 6d75 7365 7220 3d20 7365 6c66 2e76  _vmuser = self.v
-00009590: 6d75 7365 720a 2020 2020 2020 2020 2020  muser.          
-000095a0: 2020 6465 6661 756c 745f 7761 6974 203d    default_wait =
-000095b0: 2073 656c 662e 7761 6974 0a20 2020 2020   self.wait.     
-000095c0: 2020 2020 2020 2064 6566 6175 6c74 5f77         default_w
-000095d0: 6169 7463 6f6d 6d61 6e64 203d 2073 656c  aitcommand = sel
-000095e0: 662e 7761 6974 636f 6d6d 616e 640a 2020  f.waitcommand.  
-000095f0: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
-00009600: 745f 7761 6974 7469 6d65 6f75 7420 3d20  t_waittimeout = 
-00009610: 7365 6c66 2e77 6169 7474 696d 656f 7574  self.waittimeout
-00009620: 0a20 2020 2020 2020 2070 6c61 6e20 3d20  .        plan = 
-00009630: 7072 6f66 696c 652e 6765 7428 2770 6c61  profile.get('pla
-00009640: 6e27 2c20 706c 616e 290a 2020 2020 2020  n', plan).      
-00009650: 2020 7465 6d70 6c61 7465 203d 2070 726f    template = pro
-00009660: 6669 6c65 2e67 6574 2827 7465 6d70 6c61  file.get('templa
-00009670: 7465 272c 2064 6566 6175 6c74 5f69 6d61  te', default_ima
-00009680: 6765 290a 2020 2020 2020 2020 696d 6167  ge).        imag
-00009690: 6520 3d20 7072 6f66 696c 652e 6765 7428  e = profile.get(
-000096a0: 2769 6d61 6765 272c 2074 656d 706c 6174  'image', templat
-000096b0: 6529 0a20 2020 2020 2020 206e 6574 7320  e).        nets 
-000096c0: 3d20 7072 6f66 696c 652e 6765 7428 276e  = profile.get('n
-000096d0: 6574 7327 2c20 6465 6661 756c 745f 6e65  ets', default_ne
-000096e0: 7473 290a 2020 2020 2020 2020 6370 756d  ts).        cpum
-000096f0: 6f64 656c 203d 2070 726f 6669 6c65 2e67  odel = profile.g
-00009700: 6574 2827 6370 756d 6f64 656c 272c 2064  et('cpumodel', d
-00009710: 6566 6175 6c74 5f63 7075 6d6f 6465 6c29  efault_cpumodel)
-00009720: 0a20 2020 2020 2020 2063 7075 666c 6167  .        cpuflag
-00009730: 7320 3d20 7072 6f66 696c 652e 6765 7428  s = profile.get(
-00009740: 2763 7075 666c 6167 7327 2c20 6465 6661  'cpuflags', defa
-00009750: 756c 745f 6370 7566 6c61 6773 290a 2020  ult_cpuflags).  
-00009760: 2020 2020 2020 6370 7570 696e 6e69 6e67        cpupinning
-00009770: 203d 2070 726f 6669 6c65 2e67 6574 2827   = profile.get('
-00009780: 6370 7570 696e 6e69 6e67 272c 2064 6566  cpupinning', def
-00009790: 6175 6c74 5f63 7075 7069 6e6e 696e 6729  ault_cpupinning)
-000097a0: 0a20 2020 2020 2020 206e 756d 616d 6f64  .        numamod
-000097b0: 6520 3d20 7072 6f66 696c 652e 6765 7428  e = profile.get(
-000097c0: 276e 756d 616d 6f64 6527 2c20 6465 6661  'numamode', defa
-000097d0: 756c 745f 6e75 6d61 6d6f 6465 290a 2020  ult_numamode).  
-000097e0: 2020 2020 2020 6e75 6d61 203d 2070 726f        numa = pro
-000097f0: 6669 6c65 2e67 6574 2827 6e75 6d61 272c  file.get('numa',
-00009800: 2064 6566 6175 6c74 5f6e 756d 6129 0a20   default_numa). 
-00009810: 2020 2020 2020 2070 6369 6465 7669 6365         pcidevice
-00009820: 7320 3d20 7072 6f66 696c 652e 6765 7428  s = profile.get(
-00009830: 2770 6369 6465 7669 6365 7327 2c20 6465  'pcidevices', de
-00009840: 6661 756c 745f 7063 6964 6576 6963 6573  fault_pcidevices
-00009850: 290a 2020 2020 2020 2020 7470 6d20 3d20  ).        tpm = 
-00009860: 7072 6f66 696c 652e 6765 7428 2774 706d  profile.get('tpm
-00009870: 272c 2064 6566 6175 6c74 5f74 706d 290a  ', default_tpm).
-00009880: 2020 2020 2020 2020 726e 6720 3d20 7072          rng = pr
-00009890: 6f66 696c 652e 6765 7428 2772 6e67 272c  ofile.get('rng',
-000098a0: 2064 6566 6175 6c74 5f72 6e67 290a 2020   default_rng).  
-000098b0: 2020 2020 2020 7365 6375 7269 7479 6772        securitygr
-000098c0: 6f75 7073 203d 2070 726f 6669 6c65 2e67  oups = profile.g
-000098d0: 6574 2827 7365 6375 7269 7479 6772 6f75  et('securitygrou
-000098e0: 7073 272c 2064 6566 6175 6c74 5f73 6563  ps', default_sec
-000098f0: 7572 6974 7967 726f 7570 7329 0a20 2020  uritygroups).   
-00009900: 2020 2020 206e 756d 6370 7573 203d 2070       numcpus = p
-00009910: 726f 6669 6c65 2e67 6574 2827 6e75 6d63  rofile.get('numc
-00009920: 7075 7327 2c20 6465 6661 756c 745f 6e75  pus', default_nu
-00009930: 6d63 7075 7329 0a20 2020 2020 2020 206d  mcpus).        m
-00009940: 656d 6f72 7920 3d20 7072 6f66 696c 652e  emory = profile.
-00009950: 6765 7428 276d 656d 6f72 7927 2c20 6465  get('memory', de
-00009960: 6661 756c 745f 6d65 6d6f 7279 290a 2020  fault_memory).  
-00009970: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-00009980: 6e63 6528 6d65 6d6f 7279 2c20 7374 7229  nce(memory, str)
-00009990: 2061 6e64 2028 6d65 6d6f 7279 2e6c 6f77   and (memory.low
-000099a0: 6572 2829 2e65 6e64 7377 6974 6828 2767  er().endswith('g
-000099b0: 6227 2920 6f72 206d 656d 6f72 792e 6c6f  b') or memory.lo
-000099c0: 7765 7228 292e 656e 6473 7769 7468 2827  wer().endswith('
-000099d0: 6727 2929 3a0a 2020 2020 2020 2020 2020  g')):.          
-000099e0: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-000099f0: 2020 2020 2020 206d 656d 6f72 7920 3d20         memory = 
-00009a00: 696e 7428 6d65 6d6f 7279 2e6c 6f77 6572  int(memory.lower
-00009a10: 2827 6762 272c 2027 2729 2e72 6570 6c61  ('gb', '').repla
-00009a20: 6365 2827 6727 2c20 2727 2929 202a 2031  ce('g', '')) * 1
-00009a30: 3032 340a 2020 2020 2020 2020 2020 2020  024.            
-00009a40: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
-00009a50: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
-00009a60: 2020 2020 2020 2065 7272 6f72 2866 2243         error(f"C
-00009a70: 6f75 6c64 6e74 2063 6f6e 7665 7274 206d  ouldnt convert m
-00009a80: 656d 6f72 792e 2048 6974 207b 657d 2229  emory. Hit {e}")
-00009a90: 0a20 2020 2020 2020 2070 6f6f 6c20 3d20  .        pool = 
-00009aa0: 7072 6f66 696c 652e 6765 7428 2770 6f6f  profile.get('poo
-00009ab0: 6c27 2c20 6465 6661 756c 745f 706f 6f6c  l', default_pool
-00009ac0: 290a 2020 2020 2020 2020 6469 736b 7320  ).        disks 
-00009ad0: 3d20 7072 6f66 696c 652e 6765 7428 2764  = profile.get('d
-00009ae0: 6973 6b73 272c 2064 6566 6175 6c74 5f64  isks', default_d
-00009af0: 6973 6b73 290a 2020 2020 2020 2020 6469  isks).        di
-00009b00: 736b 7369 7a65 203d 2070 726f 6669 6c65  sksize = profile
-00009b10: 2e67 6574 2827 6469 736b 7369 7a65 272c  .get('disksize',
-00009b20: 2064 6566 6175 6c74 5f64 6973 6b73 697a   default_disksiz
-00009b30: 6529 0a20 2020 2020 2020 2064 6973 6b69  e).        diski
-00009b40: 6e74 6572 6661 6365 203d 2070 726f 6669  nterface = profi
-00009b50: 6c65 2e67 6574 2827 6469 736b 696e 7465  le.get('diskinte
-00009b60: 7266 6163 6527 2c20 6465 6661 756c 745f  rface', default_
-00009b70: 6469 736b 696e 7465 7266 6163 6529 0a20  diskinterface). 
-00009b80: 2020 2020 2020 2064 6973 6b74 6869 6e20         diskthin 
-00009b90: 3d20 7072 6f66 696c 652e 6765 7428 2764  = profile.get('d
-00009ba0: 6973 6b74 6869 6e27 2c20 6465 6661 756c  iskthin', defaul
-00009bb0: 745f 6469 736b 7468 696e 290a 2020 2020  t_diskthin).    
-00009bc0: 2020 2020 6966 2064 6973 6b73 2061 6e64      if disks and
-00009bd0: 2069 7369 6e73 7461 6e63 6528 6469 736b   isinstance(disk
-00009be0: 732c 2064 6963 7429 2061 6e64 2027 6465  s, dict) and 'de
-00009bf0: 6661 756c 7427 2069 6e20 6469 736b 735b  fault' in disks[
-00009c00: 305d 3a0a 2020 2020 2020 2020 2020 2020  0]:.            
-00009c10: 6469 736b 7320 3d20 5b7b 2773 697a 6527  disks = [{'size'
-00009c20: 3a20 6469 736b 7369 7a65 2c20 2769 6e74  : disksize, 'int
-00009c30: 6572 6661 6365 273a 2064 6973 6b69 6e74  erface': diskint
-00009c40: 6572 6661 6365 2c20 2774 6869 6e27 3a20  erface, 'thin': 
-00009c50: 6469 736b 7468 696e 7d5d 0a20 2020 2020  diskthin}].     
-00009c60: 2020 2067 7565 7374 6964 203d 2070 726f     guestid = pro
-00009c70: 6669 6c65 2e67 6574 2827 6775 6573 7469  file.get('guesti
-00009c80: 6427 2c20 6465 6661 756c 745f 6775 6573  d', default_gues
-00009c90: 7469 6429 0a20 2020 2020 2020 2069 736f  tid).        iso
-00009ca0: 203d 2070 726f 6669 6c65 2e67 6574 2827   = profile.get('
-00009cb0: 6973 6f27 2c20 6465 6661 756c 745f 6973  iso', default_is
-00009cc0: 6f29 0a20 2020 2020 2020 2076 6e63 203d  o).        vnc =
-00009cd0: 2070 726f 6669 6c65 2e67 6574 2827 766e   profile.get('vn
-00009ce0: 6327 2c20 6465 6661 756c 745f 766e 6329  c', default_vnc)
-00009cf0: 0a20 2020 2020 2020 2063 6c6f 7564 696e  .        cloudin
-00009d00: 6974 203d 2070 726f 6669 6c65 2e67 6574  it = profile.get
-00009d10: 2827 636c 6f75 6469 6e69 7427 2c20 6465  ('cloudinit', de
-00009d20: 6661 756c 745f 636c 6f75 6469 6e69 7429  fault_cloudinit)
-00009d30: 0a20 2020 2020 2020 2069 6620 636c 6f75  .        if clou
-00009d40: 6469 6e69 7420 616e 6420 7365 6c66 2e74  dinit and self.t
-00009d50: 7970 6520 3d3d 2027 6b76 6d27 2061 6e64  ype == 'kvm' and
-00009d60: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
-00009d70: 2020 7768 6963 6828 276d 6b69 736f 6673    which('mkisofs
-00009d80: 2729 2069 7320 4e6f 6e65 2061 6e64 2077  ') is None and w
-00009d90: 6869 6368 2827 6765 6e69 736f 696d 6167  hich('genisoimag
-00009da0: 6527 2920 6973 204e 6f6e 653a 0a20 2020  e') is None:.   
-00009db0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00009dc0: 7b27 7265 7375 6c74 273a 2027 6661 696c  {'result': 'fail
-00009dd0: 7572 6527 2c20 2772 6561 736f 6e27 3a20  ure', 'reason': 
-00009de0: 224d 6973 7369 6e67 206d 6b69 736f 6673  "Missing mkisofs
-00009df0: 2f67 656e 6973 6f69 6d61 6765 206e 6565  /genisoimage nee
-00009e00: 6465 6420 666f 7220 636c 6f75 6469 6e69  ded for cloudini
-00009e10: 7422 7d0a 2020 2020 2020 2020 7265 7365  t"}.        rese
-00009e20: 7276 6569 7020 3d20 7072 6f66 696c 652e  rveip = profile.
-00009e30: 6765 7428 2772 6573 6572 7665 6970 272c  get('reserveip',
-00009e40: 2064 6566 6175 6c74 5f72 6573 6572 7665   default_reserve
-00009e50: 6970 290a 2020 2020 2020 2020 7265 7365  ip).        rese
-00009e60: 7276 6564 6e73 203d 2070 726f 6669 6c65  rvedns = profile
-00009e70: 2e67 6574 2827 7265 7365 7276 6564 6e73  .get('reservedns
-00009e80: 272c 2064 6566 6175 6c74 5f72 6573 6572  ', default_reser
-00009e90: 7665 646e 7329 0a20 2020 2020 2020 2072  vedns).        r
-00009ea0: 6573 6572 7665 686f 7374 203d 2070 726f  eservehost = pro
-00009eb0: 6669 6c65 2e67 6574 2827 7265 7365 7276  file.get('reserv
-00009ec0: 6568 6f73 7427 2c20 6465 6661 756c 745f  ehost', default_
-00009ed0: 7265 7365 7276 6568 6f73 7429 0a20 2020  reservehost).   
-00009ee0: 2020 2020 206e 6573 7465 6420 3d20 7072       nested = pr
-00009ef0: 6f66 696c 652e 6765 7428 276e 6573 7465  ofile.get('neste
-00009f00: 6427 2c20 6465 6661 756c 745f 6e65 7374  d', default_nest
-00009f10: 6564 290a 2020 2020 2020 2020 7374 6172  ed).        star
-00009f20: 7420 3d20 7072 6f66 696c 652e 6765 7428  t = profile.get(
-00009f30: 2773 7461 7274 272c 2064 6566 6175 6c74  'start', default
-00009f40: 5f73 7461 7274 290a 2020 2020 2020 2020  _start).        
-00009f50: 6175 746f 7374 6172 7420 3d20 7072 6f66  autostart = prof
-00009f60: 696c 652e 6765 7428 2761 7574 6f73 7461  ile.get('autosta
-00009f70: 7274 272c 2064 6566 6175 6c74 5f61 7574  rt', default_aut
-00009f80: 6f73 7461 7274 290a 2020 2020 2020 2020  ostart).        
-00009f90: 6b65 7973 203d 2070 726f 6669 6c65 2e67  keys = profile.g
-00009fa0: 6574 2827 6b65 7973 272c 2064 6566 6175  et('keys', defau
-00009fb0: 6c74 5f6b 6579 7329 0a20 2020 2020 2020  lt_keys).       
-00009fc0: 2063 6d64 7320 3d20 636f 6d6d 6f6e 2e72   cmds = common.r
-00009fd0: 656d 6f76 655f 6475 706c 6963 6174 6573  emove_duplicates
-00009fe0: 2864 6566 6175 6c74 5f63 6d64 7320 2b20  (default_cmds + 
-00009ff0: 7072 6f66 696c 652e 6765 7428 2763 6d64  profile.get('cmd
-0000a000: 7327 2c20 5b5d 2929 0a20 2020 2020 2020  s', [])).       
-0000a010: 206e 6574 6d61 736b 7320 3d20 7072 6f66   netmasks = prof
-0000a020: 696c 652e 6765 7428 276e 6574 6d61 736b  ile.get('netmask
-0000a030: 7327 2c20 6465 6661 756c 745f 6e65 746d  s', default_netm
-0000a040: 6173 6b73 290a 2020 2020 2020 2020 6761  asks).        ga
-0000a050: 7465 7761 7920 3d20 7072 6f66 696c 652e  teway = profile.
-0000a060: 6765 7428 2767 6174 6577 6179 272c 2064  get('gateway', d
-0000a070: 6566 6175 6c74 5f67 6174 6577 6179 290a  efault_gateway).
-0000a080: 2020 2020 2020 2020 646e 7320 3d20 7072          dns = pr
-0000a090: 6f66 696c 652e 6765 7428 2764 6e73 272c  ofile.get('dns',
-0000a0a0: 2064 6566 6175 6c74 5f64 6e73 290a 2020   default_dns).  
-0000a0b0: 2020 2020 2020 646f 6d61 696e 203d 2070        domain = p
-0000a0c0: 726f 6669 6c65 2e67 6574 2827 646f 6d61  rofile.get('doma
-0000a0d0: 696e 272c 206f 7665 7272 6964 6573 2e67  in', overrides.g
-0000a0e0: 6574 2827 646f 6d61 696e 272c 2064 6566  et('domain', def
-0000a0f0: 6175 6c74 5f64 6f6d 6169 6e29 290a 2020  ault_domain)).  
-0000a100: 2020 2020 2020 646e 7363 6c69 656e 7420        dnsclient 
-0000a110: 3d20 7072 6f66 696c 652e 6765 7428 2764  = profile.get('d
-0000a120: 6e73 636c 6965 6e74 272c 206f 7665 7272  nsclient', overr
-0000a130: 6964 6573 2e67 6574 2827 646e 7363 6c69  ides.get('dnscli
-0000a140: 656e 7427 2c20 6465 6661 756c 745f 646e  ent', default_dn
-0000a150: 7363 6c69 656e 7429 290a 2020 2020 2020  sclient)).      
-0000a160: 2020 7363 7269 7074 7320 3d20 636f 6d6d    scripts = comm
-0000a170: 6f6e 2e72 656d 6f76 655f 6475 706c 6963  on.remove_duplic
-0000a180: 6174 6573 2864 6566 6175 6c74 5f73 6372  ates(default_scr
-0000a190: 6970 7473 202b 2070 726f 6669 6c65 2e67  ipts + profile.g
-0000a1a0: 6574 2827 7363 7269 7074 7327 2c20 5b5d  et('scripts', []
-0000a1b0: 2929 0a20 2020 2020 2020 2066 696c 6573  )).        files
-0000a1c0: 203d 2070 726f 6669 6c65 2e67 6574 2827   = profile.get('
-0000a1d0: 6669 6c65 7327 2c20 6465 6661 756c 745f  files', default_
-0000a1e0: 6669 6c65 7329 0a20 2020 2020 2020 2065  files).        e
-0000a1f0: 7874 7261 5f66 696c 6573 203d 2070 726f  xtra_files = pro
-0000a200: 6669 6c65 2e67 6574 2827 6578 7472 615f  file.get('extra_
-0000a210: 6669 6c65 7327 2920 6f72 206f 7665 7272  files') or overr
-0000a220: 6964 6573 2e67 6574 2827 6578 7472 615f  ides.get('extra_
-0000a230: 6669 6c65 7327 2920 6f72 205b 5d0a 2020  files') or [].  
-0000a240: 2020 2020 2020 6669 6c65 732e 6578 7465        files.exte
-0000a250: 6e64 2865 7874 7261 5f66 696c 6573 290a  nd(extra_files).
-0000a260: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
-0000a270: 2073 656c 662e 7061 7273 655f 6669 6c65   self.parse_file
-0000a280: 7328 6e61 6d65 2c20 6669 6c65 732c 2062  s(name, files, b
-0000a290: 6173 6564 6972 2c20 6f6e 666c 7929 0a20  asedir, onfly). 
-0000a2a0: 2020 2020 2020 2069 6620 7265 7375 6c74         if result
-0000a2b0: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-0000a2c0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0000a2d0: 2072 6573 756c 740a 2020 2020 2020 2020   result.        
-0000a2e0: 7072 6f66 696c 655f 656e 765f 7061 7261  profile_env_para
-0000a2f0: 6d65 7465 7273 203d 205b 6b65 7920 666f  meters = [key fo
-0000a300: 7220 6b65 7920 696e 2070 726f 6669 6c65  r key in profile
-0000a310: 2069 6620 6b65 792e 6973 7570 7065 7228   if key.isupper(
-0000a320: 295d 0a20 2020 2020 2020 206f 7665 7272  )].        overr
-0000a330: 6964 6573 5f65 6e76 5f70 6172 616d 6574  ides_env_paramet
-0000a340: 6572 7320 3d20 5b6b 6579 2066 6f72 206b  ers = [key for k
-0000a350: 6579 2069 6e20 6f76 6572 7269 6465 7320  ey in overrides 
-0000a360: 6966 206b 6579 2e69 7375 7070 6572 2829  if key.isupper()
-0000a370: 5d0a 2020 2020 2020 2020 656e 765f 7061  ].        env_pa
-0000a380: 7261 6d65 7465 7273 203d 2073 6f72 7465  rameters = sorte
-0000a390: 6428 6c69 7374 2873 6574 2870 726f 6669  d(list(set(profi
-0000a3a0: 6c65 5f65 6e76 5f70 6172 616d 6574 6572  le_env_parameter
-0000a3b0: 7320 2b20 6f76 6572 7269 6465 735f 656e  s + overrides_en
-0000a3c0: 765f 7061 7261 6d65 7465 7273 2929 290a  v_parameters))).
-0000a3d0: 2020 2020 2020 2020 6966 2065 6e76 5f70          if env_p
-0000a3e0: 6172 616d 6574 6572 733a 0a20 2020 2020  arameters:.     
-0000a3f0: 2020 2020 2020 2065 6e76 5f64 6174 6120         env_data 
-0000a400: 3d20 2727 0a20 2020 2020 2020 2020 2020  = ''.           
-0000a410: 2066 6f72 206b 6579 2069 6e20 656e 765f   for key in env_
-0000a420: 7061 7261 6d65 7465 7273 3a0a 2020 2020  parameters:.    
-0000a430: 2020 2020 2020 2020 2020 2020 7661 6c75              valu
-0000a440: 6520 3d20 7072 6f66 696c 652e 6765 7428  e = profile.get(
-0000a450: 6b65 7929 206f 7220 6f76 6572 7269 6465  key) or override
-0000a460: 732e 6765 7428 6b65 7929 0a20 2020 2020  s.get(key).     
-0000a470: 2020 2020 2020 2020 2020 2065 6e76 5f64             env_d
-0000a480: 6174 6120 2b3d 2066 2265 7870 6f72 7420  ata += f"export 
-0000a490: 7b6b 6579 7d3d 7b76 616c 7565 7d5c 6e65  {key}={value}\ne
-0000a4a0: 7870 6f72 7420 7b6b 6579 2e6c 6f77 6572  xport {key.lower
-0000a4b0: 2829 7d3d 7b76 616c 7565 7d5c 6e22 0a20  ()}={value}\n". 
-0000a4c0: 2020 2020 2020 2020 2020 2066 696c 6573             files
-0000a4d0: 2e61 7070 656e 6428 7b27 7061 7468 273a  .append({'path':
-0000a4e0: 2027 2f65 7463 2f70 726f 6669 6c65 2e64   '/etc/profile.d
-0000a4f0: 2f6b 636c 692e 7368 272c 2027 636f 6e74  /kcli.sh', 'cont
-0000a500: 656e 7427 3a20 656e 765f 6461 7461 2c20  ent': env_data, 
-0000a510: 276d 6f64 6527 3a20 3634 347d 290a 2020  'mode': 644}).  
-0000a520: 2020 2020 2020 656e 6162 6c65 726f 6f74        enableroot
-0000a530: 203d 2070 726f 6669 6c65 2e67 6574 2827   = profile.get('
-0000a540: 656e 6162 6c65 726f 6f74 272c 2064 6566  enableroot', def
-0000a550: 6175 6c74 5f65 6e61 626c 6572 6f6f 7429  ault_enableroot)
-0000a560: 0a20 2020 2020 2020 2074 6167 7320 3d20  .        tags = 
-0000a570: 7072 6f66 696c 652e 6765 7428 2774 6167  profile.get('tag
-0000a580: 7327 2c20 5b5d 290a 2020 2020 2020 2020  s', []).        
-0000a590: 6966 2064 6566 6175 6c74 5f74 6167 733a  if default_tags:
-0000a5a0: 0a20 2020 2020 2020 2020 2020 2074 6167  .            tag
-0000a5b0: 7320 3d20 6465 6661 756c 745f 7461 6773  s = default_tags
-0000a5c0: 202b 2074 6167 7320 6966 2074 6167 7320   + tags if tags 
-0000a5d0: 656c 7365 2064 6566 6175 6c74 5f74 6167  else default_tag
-0000a5e0: 730a 2020 2020 2020 2020 7072 6976 6174  s.        privat
-0000a5f0: 656b 6579 203d 2070 726f 6669 6c65 2e67  ekey = profile.g
-0000a600: 6574 2827 7072 6976 6174 656b 6579 272c  et('privatekey',
-0000a610: 2064 6566 6175 6c74 5f70 7269 7661 7465   default_private
-0000a620: 6b65 7929 0a20 2020 2020 2020 206e 6574  key).        net
-0000a630: 776f 726b 7761 6974 203d 2070 726f 6669  workwait = profi
-0000a640: 6c65 2e67 6574 2827 6e65 7477 6f72 6b77  le.get('networkw
-0000a650: 6169 7427 2c20 6465 6661 756c 745f 6e65  ait', default_ne
-0000a660: 7477 6f72 6b77 6169 7429 0a20 2020 2020  tworkwait).     
-0000a670: 2020 2072 686e 7265 6769 7374 6572 203d     rhnregister =
-0000a680: 2070 726f 6669 6c65 2e67 6574 2827 7268   profile.get('rh
-0000a690: 6e72 6567 6973 7465 7227 2c20 6465 6661  nregister', defa
-0000a6a0: 756c 745f 7268 6e72 6567 6973 7465 7229  ult_rhnregister)
-0000a6b0: 0a20 2020 2020 2020 2072 686e 7365 7276  .        rhnserv
-0000a6c0: 6572 203d 2070 726f 6669 6c65 2e67 6574  er = profile.get
-0000a6d0: 2827 7268 6e73 6572 7665 7227 2c20 6465  ('rhnserver', de
-0000a6e0: 6661 756c 745f 7268 6e73 6572 7665 7229  fault_rhnserver)
-0000a6f0: 0a20 2020 2020 2020 2072 686e 7573 6572  .        rhnuser
-0000a700: 203d 2070 726f 6669 6c65 2e67 6574 2827   = profile.get('
-0000a710: 7268 6e75 7365 7227 2c20 6465 6661 756c  rhnuser', defaul
-0000a720: 745f 7268 6e75 7365 7229 0a20 2020 2020  t_rhnuser).     
-0000a730: 2020 2072 686e 7061 7373 776f 7264 203d     rhnpassword =
-0000a740: 2070 726f 6669 6c65 2e67 6574 2827 7268   profile.get('rh
-0000a750: 6e70 6173 7377 6f72 6427 2c20 6465 6661  npassword', defa
-0000a760: 756c 745f 7268 6e70 6173 7377 6f72 6429  ult_rhnpassword)
-0000a770: 0a20 2020 2020 2020 2072 686e 616b 203d  .        rhnak =
-0000a780: 2070 726f 6669 6c65 2e67 6574 2827 7268   profile.get('rh
-0000a790: 6e61 6374 6976 6174 696f 6e6b 6579 272c  nactivationkey',
-0000a7a0: 2064 6566 6175 6c74 5f72 686e 616b 290a   default_rhnak).
-0000a7b0: 2020 2020 2020 2020 7268 6e6f 7267 203d          rhnorg =
-0000a7c0: 2070 726f 6669 6c65 2e67 6574 2827 7268   profile.get('rh
-0000a7d0: 6e6f 7267 272c 2064 6566 6175 6c74 5f72  norg', default_r
-0000a7e0: 686e 6f72 6729 0a20 2020 2020 2020 2072  hnorg).        r
-0000a7f0: 686e 706f 6f6c 203d 2070 726f 6669 6c65  hnpool = profile
-0000a800: 2e67 6574 2827 7268 6e70 6f6f 6c27 2c20  .get('rhnpool', 
-0000a810: 6465 6661 756c 745f 7268 6e70 6f6f 6c29  default_rhnpool)
-0000a820: 0a20 2020 2020 2020 2066 6c61 766f 7220  .        flavor 
-0000a830: 3d20 7072 6f66 696c 652e 6765 7428 2766  = profile.get('f
-0000a840: 6c61 766f 7227 2c20 6465 6661 756c 745f  lavor', default_
-0000a850: 666c 6176 6f72 290a 2020 2020 2020 2020  flavor).        
-0000a860: 7374 6f72 656d 6574 6164 6174 6120 3d20  storemetadata = 
-0000a870: 7072 6f66 696c 652e 6765 7428 2773 746f  profile.get('sto
-0000a880: 7265 6d65 7461 6461 7461 272c 2064 6566  remetadata', def
-0000a890: 6175 6c74 5f73 746f 7265 6d65 7461 6461  ault_storemetada
-0000a8a0: 7461 290a 2020 2020 2020 2020 6e6f 7469  ta).        noti
-0000a8b0: 6679 203d 2070 726f 6669 6c65 2e67 6574  fy = profile.get
-0000a8c0: 2827 6e6f 7469 6679 272c 2064 6566 6175  ('notify', defau
-0000a8d0: 6c74 5f6e 6f74 6966 7929 0a20 2020 2020  lt_notify).     
-0000a8e0: 2020 2070 7573 6862 756c 6c65 7474 6f6b     pushbullettok
-0000a8f0: 656e 203d 2070 726f 6669 6c65 2e67 6574  en = profile.get
-0000a900: 2827 7075 7368 6275 6c6c 6574 746f 6b65  ('pushbullettoke
-0000a910: 6e27 2c20 6465 6661 756c 745f 7075 7368  n', default_push
-0000a920: 6275 6c6c 6574 746f 6b65 6e29 0a20 2020  bullettoken).   
-0000a930: 2020 2020 2073 6c61 636b 746f 6b65 6e20       slacktoken 
-0000a940: 3d20 7072 6f66 696c 652e 6765 7428 2773  = profile.get('s
-0000a950: 6c61 636b 746f 6b65 6e27 2c20 6465 6661  lacktoken', defa
-0000a960: 756c 745f 736c 6163 6b74 6f6b 656e 290a  ult_slacktoken).
-0000a970: 2020 2020 2020 2020 6e6f 7469 6679 636d          notifycm
-0000a980: 6420 3d20 7072 6f66 696c 652e 6765 7428  d = profile.get(
-0000a990: 276e 6f74 6966 7963 6d64 272c 2064 6566  'notifycmd', def
-0000a9a0: 6175 6c74 5f6e 6f74 6966 7963 6d64 290a  ault_notifycmd).
-0000a9b0: 2020 2020 2020 2020 6e6f 7469 6679 7363          notifysc
-0000a9c0: 7269 7074 203d 2070 726f 6669 6c65 2e67  ript = profile.g
-0000a9d0: 6574 2827 6e6f 7469 6679 7363 7269 7074  et('notifyscript
-0000a9e0: 272c 2064 6566 6175 6c74 5f6e 6f74 6966  ', default_notif
-0000a9f0: 7973 6372 6970 7429 0a20 2020 2020 2020  yscript).       
-0000aa00: 206e 6f74 6966 796d 6574 686f 6473 203d   notifymethods =
-0000aa10: 2070 726f 6669 6c65 2e67 6574 2827 6e6f   profile.get('no
-0000aa20: 7469 6679 6d65 7468 6f64 7327 2c20 6465  tifymethods', de
-0000aa30: 6661 756c 745f 6e6f 7469 6679 6d65 7468  fault_notifymeth
-0000aa40: 6f64 7329 0a20 2020 2020 2020 2073 6c61  ods).        sla
-0000aa50: 636b 6368 616e 6e65 6c20 3d20 7072 6f66  ckchannel = prof
-0000aa60: 696c 652e 6765 7428 2773 6c61 636b 6368  ile.get('slackch
-0000aa70: 616e 6e65 6c27 2c20 6465 6661 756c 745f  annel', default_
-0000aa80: 736c 6163 6b63 6861 6e6e 656c 290a 2020  slackchannel).  
-0000aa90: 2020 2020 2020 6d61 696c 7365 7276 6572        mailserver
-0000aaa0: 203d 2070 726f 6669 6c65 2e67 6574 2827   = profile.get('
-0000aab0: 6d61 696c 7365 7276 6572 272c 2064 6566  mailserver', def
-0000aac0: 6175 6c74 5f6d 6169 6c73 6572 7665 7229  ault_mailserver)
-0000aad0: 0a20 2020 2020 2020 206d 6169 6c66 726f  .        mailfro
-0000aae0: 6d20 3d20 7072 6f66 696c 652e 6765 7428  m = profile.get(
-0000aaf0: 276d 6169 6c66 726f 6d27 2c20 6465 6661  'mailfrom', defa
-0000ab00: 756c 745f 6d61 696c 6672 6f6d 290a 2020  ult_mailfrom).  
-0000ab10: 2020 2020 2020 6d61 696c 746f 203d 2070        mailto = p
-0000ab20: 726f 6669 6c65 2e67 6574 2827 6d61 696c  rofile.get('mail
-0000ab30: 746f 272c 2064 6566 6175 6c74 5f6d 6169  to', default_mai
-0000ab40: 6c74 6f29 0a20 2020 2020 2020 2073 6861  lto).        sha
-0000ab50: 7265 6466 6f6c 6465 7273 203d 2070 726f  redfolders = pro
-0000ab60: 6669 6c65 2e67 6574 2827 7368 6172 6564  file.get('shared
-0000ab70: 666f 6c64 6572 7327 2c20 6465 6661 756c  folders', defaul
-0000ab80: 745f 7368 6172 6564 666f 6c64 6572 7329  t_sharedfolders)
-0000ab90: 0a20 2020 2020 2020 206b 6572 6e65 6c20  .        kernel 
-0000aba0: 3d20 7072 6f66 696c 652e 6765 7428 276b  = profile.get('k
-0000abb0: 6572 6e65 6c27 2c20 6465 6661 756c 745f  ernel', default_
-0000abc0: 6b65 726e 656c 290a 2020 2020 2020 2020  kernel).        
-0000abd0: 696e 6974 7264 203d 2070 726f 6669 6c65  initrd = profile
-0000abe0: 2e67 6574 2827 696e 6974 7264 272c 2064  .get('initrd', d
-0000abf0: 6566 6175 6c74 5f69 6e69 7472 6429 0a20  efault_initrd). 
-0000ac00: 2020 2020 2020 2063 6d64 6c69 6e65 203d         cmdline =
-0000ac10: 2070 726f 6669 6c65 2e67 6574 2827 636d   profile.get('cm
-0000ac20: 646c 696e 6527 2c20 6465 6661 756c 745f  dline', default_
-0000ac30: 636d 646c 696e 6529 0a20 2020 2020 2020  cmdline).       
-0000ac40: 2070 6c61 6365 6d65 6e74 203d 2070 726f   placement = pro
-0000ac50: 6669 6c65 2e67 6574 2827 706c 6163 656d  file.get('placem
-0000ac60: 656e 7427 2c20 6465 6661 756c 745f 706c  ent', default_pl
-0000ac70: 6163 656d 656e 7429 0a20 2020 2020 2020  acement).       
-0000ac80: 2079 616d 6c69 6e76 656e 746f 7279 203d   yamlinventory =
-0000ac90: 2070 726f 6669 6c65 2e67 6574 2827 7961   profile.get('ya
-0000aca0: 6d6c 696e 7665 6e74 6f72 7927 2c20 6465  mlinventory', de
-0000acb0: 6661 756c 745f 7961 6d6c 696e 7665 6e74  fault_yamlinvent
-0000acc0: 6f72 7929 0a20 2020 2020 2020 2063 7075  ory).        cpu
-0000acd0: 686f 7470 6c75 6720 3d20 7072 6f66 696c  hotplug = profil
-0000ace0: 652e 6765 7428 2763 7075 686f 7470 6c75  e.get('cpuhotplu
-0000acf0: 6727 2c20 6465 6661 756c 745f 6370 7568  g', default_cpuh
+00007630: 686f 7374 272c 2073 656c 662e 7265 7365  host', self.rese
+00007640: 7276 6568 6f73 7429 0a20 2020 2020 2020  rvehost).       
+00007650: 2020 2020 2064 6566 6175 6c74 5f63 7075       default_cpu
+00007660: 6d6f 6465 6c20 3d20 6661 7468 6572 2e67  model = father.g
+00007670: 6574 2827 6370 756d 6f64 656c 272c 2073  et('cpumodel', s
+00007680: 656c 662e 6370 756d 6f64 656c 290a 2020  elf.cpumodel).  
+00007690: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
+000076a0: 745f 6370 7566 6c61 6773 203d 2066 6174  t_cpuflags = fat
+000076b0: 6865 722e 6765 7428 2763 7075 666c 6167  her.get('cpuflag
+000076c0: 7327 2c20 7365 6c66 2e63 7075 666c 6167  s', self.cpuflag
+000076d0: 7329 0a20 2020 2020 2020 2020 2020 2064  s).            d
+000076e0: 6566 6175 6c74 5f63 7075 7069 6e6e 696e  efault_cpupinnin
+000076f0: 6720 3d20 6661 7468 6572 2e67 6574 2827  g = father.get('
+00007700: 6370 7570 696e 6e69 6e67 272c 2073 656c  cpupinning', sel
+00007710: 662e 6370 7570 696e 6e69 6e67 290a 2020  f.cpupinning).  
+00007720: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
+00007730: 745f 6469 736b 7369 7a65 203d 2066 6174  t_disksize = fat
+00007740: 6865 722e 6765 7428 2764 6973 6b73 697a  her.get('disksiz
+00007750: 6527 2c20 7365 6c66 2e64 6973 6b73 697a  e', self.disksiz
+00007760: 6529 0a20 2020 2020 2020 2020 2020 2064  e).            d
+00007770: 6566 6175 6c74 5f64 6973 6b69 6e74 6572  efault_diskinter
+00007780: 6661 6365 203d 2066 6174 6865 722e 6765  face = father.ge
+00007790: 7428 2764 6973 6b69 6e74 6572 6661 6365  t('diskinterface
+000077a0: 272c 2073 656c 662e 6469 736b 696e 7465  ', self.diskinte
+000077b0: 7266 6163 6529 0a20 2020 2020 2020 2020  rface).         
+000077c0: 2020 2064 6566 6175 6c74 5f64 6973 6b74     default_diskt
+000077d0: 6869 6e20 3d20 6661 7468 6572 2e67 6574  hin = father.get
+000077e0: 2827 6469 736b 7468 696e 272c 2073 656c  ('diskthin', sel
+000077f0: 662e 6469 736b 7468 696e 290a 2020 2020  f.diskthin).    
+00007800: 2020 2020 2020 2020 6465 6661 756c 745f          default_
+00007810: 6775 6573 7469 6420 3d20 6661 7468 6572  guestid = father
+00007820: 2e67 6574 2827 6775 6573 7469 6427 2c20  .get('guestid', 
+00007830: 7365 6c66 2e67 7565 7374 6964 290a 2020  self.guestid).  
+00007840: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
+00007850: 745f 6973 6f20 3d20 6661 7468 6572 2e67  t_iso = father.g
+00007860: 6574 2827 6973 6f27 2c20 7365 6c66 2e69  et('iso', self.i
+00007870: 736f 290a 2020 2020 2020 2020 2020 2020  so).            
+00007880: 6465 6661 756c 745f 766e 6320 3d20 6661  default_vnc = fa
+00007890: 7468 6572 2e67 6574 2827 766e 6327 2c20  ther.get('vnc', 
+000078a0: 7365 6c66 2e76 6e63 290a 2020 2020 2020  self.vnc).      
+000078b0: 2020 2020 2020 6465 6661 756c 745f 7265        default_re
+000078c0: 7365 7276 6569 7020 3d20 6661 7468 6572  serveip = father
+000078d0: 2e67 6574 2827 7265 7365 7276 6569 7027  .get('reserveip'
+000078e0: 2c20 7365 6c66 2e72 6573 6572 7665 6970  , self.reserveip
+000078f0: 290a 2020 2020 2020 2020 2020 2020 6465  ).            de
+00007900: 6661 756c 745f 7374 6172 7420 3d20 6661  fault_start = fa
+00007910: 7468 6572 2e67 6574 2827 7374 6172 7427  ther.get('start'
+00007920: 2c20 7365 6c66 2e73 7461 7274 290a 2020  , self.start).  
+00007930: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
+00007940: 745f 6175 746f 7374 6172 7420 3d20 6661  t_autostart = fa
+00007950: 7468 6572 2e67 6574 2827 6175 746f 7374  ther.get('autost
+00007960: 6172 7427 2c20 7365 6c66 2e61 7574 6f73  art', self.autos
+00007970: 7461 7274 290a 2020 2020 2020 2020 2020  tart).          
+00007980: 2020 6465 6661 756c 745f 6b65 7973 203d    default_keys =
+00007990: 2066 6174 6865 722e 6765 7428 276b 6579   father.get('key
+000079a0: 7327 2c20 7365 6c66 2e6b 6579 7329 0a20  s', self.keys). 
+000079b0: 2020 2020 2020 2020 2020 2064 6566 6175             defau
+000079c0: 6c74 5f6e 6574 6d61 736b 7320 3d20 6661  lt_netmasks = fa
+000079d0: 7468 6572 2e67 6574 2827 6e65 746d 6173  ther.get('netmas
+000079e0: 6b73 272c 2073 656c 662e 6e65 746d 6173  ks', self.netmas
+000079f0: 6b73 290a 2020 2020 2020 2020 2020 2020  ks).            
+00007a00: 6465 6661 756c 745f 6761 7465 7761 7920  default_gateway 
+00007a10: 3d20 6661 7468 6572 2e67 6574 2827 6761  = father.get('ga
+00007a20: 7465 7761 7927 2c20 7365 6c66 2e67 6174  teway', self.gat
+00007a30: 6577 6179 290a 2020 2020 2020 2020 2020  eway).          
+00007a40: 2020 6465 6661 756c 745f 646e 7320 3d20    default_dns = 
+00007a50: 6661 7468 6572 2e67 6574 2827 646e 7327  father.get('dns'
+00007a60: 2c20 7365 6c66 2e64 6e73 290a 2020 2020  , self.dns).    
+00007a70: 2020 2020 2020 2020 6465 6661 756c 745f          default_
+00007a80: 646f 6d61 696e 203d 2066 6174 6865 722e  domain = father.
+00007a90: 6765 7428 2764 6f6d 6169 6e27 2c20 7365  get('domain', se
+00007aa0: 6c66 2e64 6f6d 6169 6e29 0a20 2020 2020  lf.domain).     
+00007ab0: 2020 2020 2020 2064 6566 6175 6c74 5f66         default_f
+00007ac0: 696c 6573 203d 2066 6174 6865 722e 6765  iles = father.ge
+00007ad0: 7428 2766 696c 6573 272c 2073 656c 662e  t('files', self.
+00007ae0: 6669 6c65 7329 0a20 2020 2020 2020 2020  files).         
+00007af0: 2020 2064 6566 6175 6c74 5f65 6e61 626c     default_enabl
+00007b00: 6572 6f6f 7420 3d20 6661 7468 6572 2e67  eroot = father.g
+00007b10: 6574 2827 656e 6162 6c65 726f 6f74 272c  et('enableroot',
+00007b20: 2073 656c 662e 656e 6162 6c65 726f 6f74   self.enableroot
+00007b30: 290a 2020 2020 2020 2020 2020 2020 6465  ).            de
+00007b40: 6661 756c 745f 7072 6976 6174 656b 6579  fault_privatekey
+00007b50: 203d 2066 6174 6865 722e 6765 7428 2770   = father.get('p
+00007b60: 7269 7661 7465 6b65 7927 2c20 7365 6c66  rivatekey', self
+00007b70: 2e70 7269 7661 7465 6b65 7929 0a20 2020  .privatekey).   
+00007b80: 2020 2020 2020 2020 2064 6566 6175 6c74           default
+00007b90: 5f6e 6574 776f 726b 7761 6974 203d 2066  _networkwait = f
+00007ba0: 6174 6865 722e 6765 7428 276e 6574 776f  ather.get('netwo
+00007bb0: 726b 7761 6974 272c 2073 656c 662e 6e65  rkwait', self.ne
+00007bc0: 7477 6f72 6b77 6169 7429 0a20 2020 2020  tworkwait).     
+00007bd0: 2020 2020 2020 2064 6566 6175 6c74 5f72         default_r
+00007be0: 686e 7265 6769 7374 6572 203d 2066 6174  hnregister = fat
+00007bf0: 6865 722e 6765 7428 2772 686e 7265 6769  her.get('rhnregi
+00007c00: 7374 6572 272c 2073 656c 662e 7268 6e72  ster', self.rhnr
+00007c10: 6567 6973 7465 7229 0a20 2020 2020 2020  egister).       
+00007c20: 2020 2020 2064 6566 6175 6c74 5f72 686e       default_rhn
+00007c30: 7365 7276 6572 203d 2066 6174 6865 722e  server = father.
+00007c40: 6765 7428 2772 686e 7365 7276 6572 272c  get('rhnserver',
+00007c50: 2073 656c 662e 7268 6e73 6572 7665 7229   self.rhnserver)
+00007c60: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
+00007c70: 6175 6c74 5f72 686e 7573 6572 203d 2066  ault_rhnuser = f
+00007c80: 6174 6865 722e 6765 7428 2772 686e 7573  ather.get('rhnus
+00007c90: 6572 272c 2073 656c 662e 7268 6e75 7365  er', self.rhnuse
+00007ca0: 7229 0a20 2020 2020 2020 2020 2020 2064  r).            d
+00007cb0: 6566 6175 6c74 5f72 686e 7061 7373 776f  efault_rhnpasswo
+00007cc0: 7264 203d 2066 6174 6865 722e 6765 7428  rd = father.get(
+00007cd0: 2772 686e 7061 7373 776f 7264 272c 2073  'rhnpassword', s
+00007ce0: 656c 662e 7268 6e70 6173 7377 6f72 6429  elf.rhnpassword)
+00007cf0: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
+00007d00: 6175 6c74 5f72 686e 616b 203d 2066 6174  ault_rhnak = fat
+00007d10: 6865 722e 6765 7428 2772 686e 6163 7469  her.get('rhnacti
+00007d20: 7661 7469 6f6e 6b65 7927 2c20 7365 6c66  vationkey', self
+00007d30: 2e72 686e 616b 290a 2020 2020 2020 2020  .rhnak).        
+00007d40: 2020 2020 6465 6661 756c 745f 7268 6e6f      default_rhno
+00007d50: 7267 203d 2066 6174 6865 722e 6765 7428  rg = father.get(
+00007d60: 2772 686e 6f72 6727 2c20 7365 6c66 2e72  'rhnorg', self.r
+00007d70: 686e 6f72 6729 0a20 2020 2020 2020 2020  hnorg).         
+00007d80: 2020 2064 6566 6175 6c74 5f72 686e 706f     default_rhnpo
+00007d90: 6f6c 203d 2066 6174 6865 722e 6765 7428  ol = father.get(
+00007da0: 2772 686e 706f 6f6c 272c 2073 656c 662e  'rhnpool', self.
+00007db0: 7268 6e70 6f6f 6c29 0a20 2020 2020 2020  rhnpool).       
+00007dc0: 2020 2020 2064 6566 6175 6c74 5f74 6167       default_tag
+00007dd0: 7320 3d20 6661 7468 6572 2e67 6574 2827  s = father.get('
+00007de0: 7461 6773 272c 2073 656c 662e 7461 6773  tags', self.tags
+00007df0: 290a 2020 2020 2020 2020 2020 2020 6465  ).            de
+00007e00: 6661 756c 745f 666c 6176 6f72 203d 2066  fault_flavor = f
+00007e10: 6174 6865 722e 6765 7428 2766 6c61 766f  ather.get('flavo
+00007e20: 7227 2c20 7365 6c66 2e66 6c61 766f 7229  r', self.flavor)
+00007e30: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
+00007e40: 6175 6c74 5f63 6d64 7320 3d20 636f 6d6d  ault_cmds = comm
+00007e50: 6f6e 2e72 656d 6f76 655f 6475 706c 6963  on.remove_duplic
+00007e60: 6174 6573 2873 656c 662e 636d 6473 202b  ates(self.cmds +
+00007e70: 2066 6174 6865 722e 6765 7428 2763 6d64   father.get('cmd
+00007e80: 7327 2c20 5b5d 2929 0a20 2020 2020 2020  s', [])).       
+00007e90: 2020 2020 2064 6566 6175 6c74 5f73 6372       default_scr
+00007ea0: 6970 7473 203d 2063 6f6d 6d6f 6e2e 7265  ipts = common.re
+00007eb0: 6d6f 7665 5f64 7570 6c69 6361 7465 7328  move_duplicates(
+00007ec0: 7365 6c66 2e73 6372 6970 7473 202b 2066  self.scripts + f
+00007ed0: 6174 6865 722e 6765 7428 2773 6372 6970  ather.get('scrip
+00007ee0: 7473 272c 205b 5d29 290a 2020 2020 2020  ts', [])).      
+00007ef0: 2020 2020 2020 6465 6661 756c 745f 646e        default_dn
+00007f00: 7363 6c69 656e 7420 3d20 6661 7468 6572  sclient = father
+00007f10: 2e67 6574 2827 646e 7363 6c69 656e 7427  .get('dnsclient'
+00007f20: 2c20 7365 6c66 2e64 6e73 636c 6965 6e74  , self.dnsclient
+00007f30: 290a 2020 2020 2020 2020 2020 2020 6465  ).            de
+00007f40: 6661 756c 745f 7374 6f72 656d 6574 6164  fault_storemetad
+00007f50: 6174 6120 3d20 6661 7468 6572 2e67 6574  ata = father.get
+00007f60: 2827 7374 6f72 656d 6574 6164 6174 6127  ('storemetadata'
+00007f70: 2c20 7365 6c66 2e73 746f 7265 6d65 7461  , self.storemeta
+00007f80: 6461 7461 290a 2020 2020 2020 2020 2020  data).          
+00007f90: 2020 6465 6661 756c 745f 6e6f 7469 6679    default_notify
+00007fa0: 203d 2066 6174 6865 722e 6765 7428 276e   = father.get('n
+00007fb0: 6f74 6966 7927 2c20 7365 6c66 2e6e 6f74  otify', self.not
+00007fc0: 6966 7929 0a20 2020 2020 2020 2020 2020  ify).           
+00007fd0: 2064 6566 6175 6c74 5f70 7573 6862 756c   default_pushbul
+00007fe0: 6c65 7474 6f6b 656e 203d 2066 6174 6865  lettoken = fathe
+00007ff0: 722e 6765 7428 2770 7573 6862 756c 6c65  r.get('pushbulle
+00008000: 7474 6f6b 656e 272c 2073 656c 662e 7075  ttoken', self.pu
+00008010: 7368 6275 6c6c 6574 746f 6b65 6e29 0a20  shbullettoken). 
+00008020: 2020 2020 2020 2020 2020 2064 6566 6175             defau
+00008030: 6c74 5f6d 6169 6c73 6572 7665 7220 3d20  lt_mailserver = 
+00008040: 6661 7468 6572 2e67 6574 2827 6d61 696c  father.get('mail
+00008050: 7365 7276 6572 272c 2073 656c 662e 6d61  server', self.ma
+00008060: 696c 7365 7276 6572 290a 2020 2020 2020  ilserver).      
+00008070: 2020 2020 2020 6465 6661 756c 745f 6d61        default_ma
+00008080: 696c 6672 6f6d 203d 2066 6174 6865 722e  ilfrom = father.
+00008090: 6765 7428 276d 6169 6c66 726f 6d27 2c20  get('mailfrom', 
+000080a0: 7365 6c66 2e6d 6169 6c66 726f 6d29 0a20  self.mailfrom). 
+000080b0: 2020 2020 2020 2020 2020 2064 6566 6175             defau
+000080c0: 6c74 5f6d 6169 6c74 6f20 3d20 6661 7468  lt_mailto = fath
+000080d0: 6572 2e67 6574 2827 6d61 696c 746f 272c  er.get('mailto',
+000080e0: 2073 656c 662e 6d61 696c 746f 290a 2020   self.mailto).  
+000080f0: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
+00008100: 745f 6e6f 7469 6679 636d 6420 3d20 6661  t_notifycmd = fa
+00008110: 7468 6572 2e67 6574 2827 6e6f 7469 6679  ther.get('notify
+00008120: 636d 6427 2c20 7365 6c66 2e6e 6f74 6966  cmd', self.notif
+00008130: 7963 6d64 290a 2020 2020 2020 2020 2020  ycmd).          
+00008140: 2020 6465 6661 756c 745f 6e6f 7469 6679    default_notify
+00008150: 7363 7269 7074 203d 2066 6174 6865 722e  script = father.
+00008160: 6765 7428 276e 6f74 6966 7973 6372 6970  get('notifyscrip
+00008170: 7427 2c20 7365 6c66 2e6e 6f74 6966 7973  t', self.notifys
+00008180: 6372 6970 7429 0a20 2020 2020 2020 2020  cript).         
+00008190: 2020 2064 6566 6175 6c74 5f6e 6f74 6966     default_notif
+000081a0: 796d 6574 686f 6473 203d 2066 6174 6865  ymethods = fathe
+000081b0: 722e 6765 7428 276e 6f74 6966 796d 6574  r.get('notifymet
+000081c0: 686f 6473 272c 2073 656c 662e 6e6f 7469  hods', self.noti
+000081d0: 6679 6d65 7468 6f64 7329 0a20 2020 2020  fymethods).     
+000081e0: 2020 2020 2020 2064 6566 6175 6c74 5f73         default_s
+000081f0: 6c61 636b 6368 616e 6e65 6c20 3d20 6661  lackchannel = fa
+00008200: 7468 6572 2e67 6574 2827 736c 6163 6b63  ther.get('slackc
+00008210: 6861 6e6e 656c 272c 2073 656c 662e 736c  hannel', self.sl
+00008220: 6163 6b63 6861 6e6e 656c 290a 2020 2020  ackchannel).    
+00008230: 2020 2020 2020 2020 6465 6661 756c 745f          default_
+00008240: 7075 7368 6275 6c6c 6574 746f 6b65 6e20  pushbullettoken 
+00008250: 3d20 6661 7468 6572 2e67 6574 2827 7075  = father.get('pu
+00008260: 7368 6275 6c6c 6574 746f 6b65 6e27 2c20  shbullettoken', 
+00008270: 7365 6c66 2e70 7573 6862 756c 6c65 7474  self.pushbullett
+00008280: 6f6b 656e 290a 2020 2020 2020 2020 2020  oken).          
+00008290: 2020 6465 6661 756c 745f 736c 6163 6b74    default_slackt
+000082a0: 6f6b 656e 203d 2066 6174 6865 722e 6765  oken = father.ge
+000082b0: 7428 2773 6c61 636b 746f 6b65 6e27 2c20  t('slacktoken', 
+000082c0: 7365 6c66 2e73 6c61 636b 746f 6b65 6e29  self.slacktoken)
+000082d0: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
+000082e0: 6175 6c74 5f73 6861 7265 6466 6f6c 6465  ault_sharedfolde
+000082f0: 7273 203d 2066 6174 6865 722e 6765 7428  rs = father.get(
+00008300: 2773 6861 7265 6466 6f6c 6465 7273 272c  'sharedfolders',
+00008310: 2073 656c 662e 7368 6172 6564 666f 6c64   self.sharedfold
+00008320: 6572 7329 0a20 2020 2020 2020 2020 2020  ers).           
+00008330: 2064 6566 6175 6c74 5f6b 6572 6e65 6c20   default_kernel 
+00008340: 3d20 6661 7468 6572 2e67 6574 2827 6b65  = father.get('ke
+00008350: 726e 656c 272c 2073 656c 662e 6b65 726e  rnel', self.kern
+00008360: 656c 290a 2020 2020 2020 2020 2020 2020  el).            
+00008370: 6465 6661 756c 745f 696e 6974 7264 203d  default_initrd =
+00008380: 2066 6174 6865 722e 6765 7428 2769 6e69   father.get('ini
+00008390: 7472 6427 2c20 7365 6c66 2e69 6e69 7472  trd', self.initr
+000083a0: 6429 0a20 2020 2020 2020 2020 2020 2064  d).            d
+000083b0: 6566 6175 6c74 5f63 6d64 6c69 6e65 203d  efault_cmdline =
+000083c0: 2066 6174 6865 722e 6765 7428 2763 6d64   father.get('cmd
+000083d0: 6c69 6e65 272c 2073 656c 662e 636d 646c  line', self.cmdl
+000083e0: 696e 6529 0a20 2020 2020 2020 2020 2020  ine).           
+000083f0: 2064 6566 6175 6c74 5f70 6c61 6365 6d65   default_placeme
+00008400: 6e74 203d 2066 6174 6865 722e 6765 7428  nt = father.get(
+00008410: 2770 6c61 6365 6d65 6e74 272c 2073 656c  'placement', sel
+00008420: 662e 706c 6163 656d 656e 7429 0a20 2020  f.placement).   
+00008430: 2020 2020 2020 2020 2064 6566 6175 6c74           default
+00008440: 5f79 616d 6c69 6e76 656e 746f 7279 203d  _yamlinventory =
+00008450: 2066 6174 6865 722e 6765 7428 2779 616d   father.get('yam
+00008460: 6c69 6e76 656e 746f 7279 272c 2073 656c  linventory', sel
+00008470: 662e 7961 6d6c 696e 7665 6e74 6f72 7929  f.yamlinventory)
+00008480: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
+00008490: 6175 6c74 5f63 7075 686f 7470 6c75 6720  ault_cpuhotplug 
+000084a0: 3d20 6661 7468 6572 2e67 6574 2827 6370  = father.get('cp
+000084b0: 7568 6f74 706c 7567 272c 2073 656c 662e  uhotplug', self.
+000084c0: 6370 7568 6f74 706c 7567 290a 2020 2020  cpuhotplug).    
+000084d0: 2020 2020 2020 2020 6465 6661 756c 745f          default_
+000084e0: 6d65 6d6f 7279 686f 7470 6c75 6720 3d20  memoryhotplug = 
+000084f0: 6661 7468 6572 2e67 6574 2827 6d65 6d6f  father.get('memo
+00008500: 7279 686f 7470 6c75 6727 2c20 7365 6c66  ryhotplug', self
+00008510: 2e6d 656d 6f72 7968 6f74 706c 7567 290a  .memoryhotplug).
+00008520: 2020 2020 2020 2020 2020 2020 6465 6661              defa
+00008530: 756c 745f 6e75 6d61 203d 2066 6174 6865  ult_numa = fathe
+00008540: 722e 6765 7428 276e 756d 6127 2c20 7365  r.get('numa', se
+00008550: 6c66 2e6e 756d 6129 0a20 2020 2020 2020  lf.numa).       
+00008560: 2020 2020 2064 6566 6175 6c74 5f6e 756d       default_num
+00008570: 616d 6f64 6520 3d20 6661 7468 6572 2e67  amode = father.g
+00008580: 6574 2827 6e75 6d61 6d6f 6465 272c 2073  et('numamode', s
+00008590: 656c 662e 6e75 6d61 6d6f 6465 290a 2020  elf.numamode).  
+000085a0: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
+000085b0: 745f 7063 6964 6576 6963 6573 203d 2066  t_pcidevices = f
+000085c0: 6174 6865 722e 6765 7428 2770 6369 6465  ather.get('pcide
+000085d0: 7669 6365 7327 2c20 7365 6c66 2e70 6369  vices', self.pci
+000085e0: 6465 7669 6365 7329 0a20 2020 2020 2020  devices).       
+000085f0: 2020 2020 2064 6566 6175 6c74 5f74 706d       default_tpm
+00008600: 203d 2066 6174 6865 722e 6765 7428 2774   = father.get('t
+00008610: 706d 272c 2073 656c 662e 7470 6d29 0a20  pm', self.tpm). 
+00008620: 2020 2020 2020 2020 2020 2064 6566 6175             defau
+00008630: 6c74 5f72 6e67 203d 2066 6174 6865 722e  lt_rng = father.
+00008640: 6765 7428 2772 6e67 272c 2073 656c 662e  get('rng', self.
+00008650: 726e 6729 0a20 2020 2020 2020 2020 2020  rng).           
+00008660: 2064 6566 6175 6c74 5f76 6972 7474 7970   default_virttyp
+00008670: 6520 3d20 6661 7468 6572 2e67 6574 2827  e = father.get('
+00008680: 7669 7274 7479 7065 272c 2073 656c 662e  virttype', self.
+00008690: 7669 7274 7479 7065 290a 2020 2020 2020  virttype).      
+000086a0: 2020 2020 2020 6465 6661 756c 745f 7365        default_se
+000086b0: 6375 7269 7479 6772 6f75 7073 203d 2066  curitygroups = f
+000086c0: 6174 6865 722e 6765 7428 2773 6563 7572  ather.get('secur
+000086d0: 6974 7967 726f 7570 7327 2c20 7365 6c66  itygroups', self
+000086e0: 2e73 6563 7572 6974 7967 726f 7570 7329  .securitygroups)
+000086f0: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
+00008700: 6175 6c74 5f72 6f6f 7470 6173 7377 6f72  ault_rootpasswor
+00008710: 6420 3d20 6661 7468 6572 2e67 6574 2827  d = father.get('
+00008720: 726f 6f74 7061 7373 776f 7264 272c 2073  rootpassword', s
+00008730: 656c 662e 726f 6f74 7061 7373 776f 7264  elf.rootpassword
+00008740: 290a 2020 2020 2020 2020 2020 2020 6465  ).            de
+00008750: 6661 756c 745f 7465 6d70 6b65 7920 3d20  fault_tempkey = 
+00008760: 6661 7468 6572 2e67 6574 2827 7465 6d70  father.get('temp
+00008770: 6b65 7927 2c20 7365 6c66 2e74 656d 706b  key', self.tempk
+00008780: 6579 290a 2020 2020 2020 2020 2020 2020  ey).            
+00008790: 6465 6661 756c 745f 766d 7573 6572 203d  default_vmuser =
+000087a0: 2066 6174 6865 722e 6765 7428 2776 6d75   father.get('vmu
+000087b0: 7365 7227 2c20 7365 6c66 2e76 6d75 7365  ser', self.vmuse
+000087c0: 7229 0a20 2020 2020 2020 2020 2020 2064  r).            d
+000087d0: 6566 6175 6c74 5f77 6169 7420 3d20 6661  efault_wait = fa
+000087e0: 7468 6572 2e67 6574 2827 7761 6974 272c  ther.get('wait',
+000087f0: 2073 656c 662e 7761 6974 290a 2020 2020   self.wait).    
+00008800: 2020 2020 2020 2020 6465 6661 756c 745f          default_
+00008810: 7761 6974 636f 6d6d 616e 6420 3d20 6661  waitcommand = fa
+00008820: 7468 6572 2e67 6574 2827 7761 6974 636f  ther.get('waitco
+00008830: 6d6d 616e 6427 2c20 7365 6c66 2e77 6169  mmand', self.wai
+00008840: 7463 6f6d 6d61 6e64 290a 2020 2020 2020  tcommand).      
+00008850: 2020 2020 2020 6465 6661 756c 745f 7761        default_wa
+00008860: 6974 7469 6d65 6f75 7420 3d20 6661 7468  ittimeout = fath
+00008870: 6572 2e67 6574 2827 7761 6974 7469 6d65  er.get('waittime
+00008880: 6f75 7427 2c20 7365 6c66 2e77 6169 7474  out', self.waitt
+00008890: 696d 656f 7574 290a 2020 2020 2020 2020  imeout).        
+000088a0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+000088b0: 2020 6465 6661 756c 745f 6e75 6d63 7075    default_numcpu
+000088c0: 7320 3d20 7365 6c66 2e6e 756d 6370 7573  s = self.numcpus
+000088d0: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
+000088e0: 6175 6c74 5f6d 656d 6f72 7920 3d20 7365  ault_memory = se
+000088f0: 6c66 2e6d 656d 6f72 790a 2020 2020 2020  lf.memory.      
+00008900: 2020 2020 2020 6465 6661 756c 745f 706f        default_po
+00008910: 6f6c 203d 2073 656c 662e 706f 6f6c 0a20  ol = self.pool. 
+00008920: 2020 2020 2020 2020 2020 2064 6566 6175             defau
+00008930: 6c74 5f64 6973 6b73 203d 2073 656c 662e  lt_disks = self.
+00008940: 6469 736b 730a 2020 2020 2020 2020 2020  disks.          
+00008950: 2020 6465 6661 756c 745f 6e65 7473 203d    default_nets =
+00008960: 2073 656c 662e 6e65 7473 0a20 2020 2020   self.nets.     
+00008970: 2020 2020 2020 2064 6566 6175 6c74 5f69         default_i
+00008980: 6d61 6765 203d 2073 656c 662e 696d 6167  mage = self.imag
+00008990: 650a 2020 2020 2020 2020 2020 2020 6465  e.            de
+000089a0: 6661 756c 745f 636c 6f75 6469 6e69 7420  fault_cloudinit 
+000089b0: 3d20 7365 6c66 2e63 6c6f 7564 696e 6974  = self.cloudinit
+000089c0: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
+000089d0: 6175 6c74 5f6e 6573 7465 6420 3d20 7365  ault_nested = se
+000089e0: 6c66 2e6e 6573 7465 640a 2020 2020 2020  lf.nested.      
+000089f0: 2020 2020 2020 6465 6661 756c 745f 7265        default_re
+00008a00: 7365 7276 6564 6e73 203d 2073 656c 662e  servedns = self.
+00008a10: 7265 7365 7276 6564 6e73 0a20 2020 2020  reservedns.     
+00008a20: 2020 2020 2020 2064 6566 6175 6c74 5f72         default_r
+00008a30: 6573 6572 7665 686f 7374 203d 2073 656c  eservehost = sel
+00008a40: 662e 7265 7365 7276 6568 6f73 740a 2020  f.reservehost.  
+00008a50: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
+00008a60: 745f 6370 756d 6f64 656c 203d 2073 656c  t_cpumodel = sel
+00008a70: 662e 6370 756d 6f64 656c 0a20 2020 2020  f.cpumodel.     
+00008a80: 2020 2020 2020 2064 6566 6175 6c74 5f63         default_c
+00008a90: 7075 666c 6167 7320 3d20 7365 6c66 2e63  puflags = self.c
+00008aa0: 7075 666c 6167 730a 2020 2020 2020 2020  puflags.        
+00008ab0: 2020 2020 6465 6661 756c 745f 6370 7570      default_cpup
+00008ac0: 696e 6e69 6e67 203d 2073 656c 662e 6370  inning = self.cp
+00008ad0: 7570 696e 6e69 6e67 0a20 2020 2020 2020  upinning.       
+00008ae0: 2020 2020 2064 6566 6175 6c74 5f6e 756d       default_num
+00008af0: 616d 6f64 6520 3d20 7365 6c66 2e6e 756d  amode = self.num
+00008b00: 616d 6f64 650a 2020 2020 2020 2020 2020  amode.          
+00008b10: 2020 6465 6661 756c 745f 6e75 6d61 203d    default_numa =
+00008b20: 2073 656c 662e 6e75 6d61 0a20 2020 2020   self.numa.     
+00008b30: 2020 2020 2020 2064 6566 6175 6c74 5f70         default_p
+00008b40: 6369 6465 7669 6365 7320 3d20 7365 6c66  cidevices = self
+00008b50: 2e70 6369 6465 7669 6365 730a 2020 2020  .pcidevices.    
+00008b60: 2020 2020 2020 2020 6465 6661 756c 745f          default_
+00008b70: 7470 6d20 3d20 7365 6c66 2e74 706d 0a20  tpm = self.tpm. 
+00008b80: 2020 2020 2020 2020 2020 2064 6566 6175             defau
+00008b90: 6c74 5f72 6e67 203d 2073 656c 662e 726e  lt_rng = self.rn
+00008ba0: 670a 2020 2020 2020 2020 2020 2020 6465  g.            de
+00008bb0: 6661 756c 745f 6469 736b 7369 7a65 203d  fault_disksize =
+00008bc0: 2073 656c 662e 6469 736b 7369 7a65 0a20   self.disksize. 
+00008bd0: 2020 2020 2020 2020 2020 2064 6566 6175             defau
+00008be0: 6c74 5f64 6973 6b69 6e74 6572 6661 6365  lt_diskinterface
+00008bf0: 203d 2073 656c 662e 6469 736b 696e 7465   = self.diskinte
+00008c00: 7266 6163 650a 2020 2020 2020 2020 2020  rface.          
+00008c10: 2020 6465 6661 756c 745f 6469 736b 7468    default_diskth
+00008c20: 696e 203d 2073 656c 662e 6469 736b 7468  in = self.diskth
+00008c30: 696e 0a20 2020 2020 2020 2020 2020 2064  in.            d
+00008c40: 6566 6175 6c74 5f67 7565 7374 6964 203d  efault_guestid =
+00008c50: 2073 656c 662e 6775 6573 7469 640a 2020   self.guestid.  
+00008c60: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
+00008c70: 745f 6973 6f20 3d20 7365 6c66 2e69 736f  t_iso = self.iso
+00008c80: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
+00008c90: 6175 6c74 5f76 6e63 203d 2073 656c 662e  ault_vnc = self.
+00008ca0: 766e 630a 2020 2020 2020 2020 2020 2020  vnc.            
+00008cb0: 6465 6661 756c 745f 7265 7365 7276 6569  default_reservei
+00008cc0: 7020 3d20 7365 6c66 2e72 6573 6572 7665  p = self.reserve
+00008cd0: 6970 0a20 2020 2020 2020 2020 2020 2064  ip.            d
+00008ce0: 6566 6175 6c74 5f73 7461 7274 203d 2073  efault_start = s
+00008cf0: 656c 662e 7374 6172 740a 2020 2020 2020  elf.start.      
+00008d00: 2020 2020 2020 6465 6661 756c 745f 6175        default_au
+00008d10: 746f 7374 6172 7420 3d20 7365 6c66 2e61  tostart = self.a
+00008d20: 7574 6f73 7461 7274 0a20 2020 2020 2020  utostart.       
+00008d30: 2020 2020 2064 6566 6175 6c74 5f6b 6579       default_key
+00008d40: 7320 3d20 7365 6c66 2e6b 6579 730a 2020  s = self.keys.  
+00008d50: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
+00008d60: 745f 6e65 746d 6173 6b73 203d 2073 656c  t_netmasks = sel
+00008d70: 662e 6e65 746d 6173 6b73 0a20 2020 2020  f.netmasks.     
+00008d80: 2020 2020 2020 2064 6566 6175 6c74 5f67         default_g
+00008d90: 6174 6577 6179 203d 2073 656c 662e 6761  ateway = self.ga
+00008da0: 7465 7761 790a 2020 2020 2020 2020 2020  teway.          
+00008db0: 2020 6465 6661 756c 745f 646e 7320 3d20    default_dns = 
+00008dc0: 7365 6c66 2e64 6e73 0a20 2020 2020 2020  self.dns.       
+00008dd0: 2020 2020 2064 6566 6175 6c74 5f64 6f6d       default_dom
+00008de0: 6169 6e20 3d20 7365 6c66 2e64 6f6d 6169  ain = self.domai
+00008df0: 6e0a 2020 2020 2020 2020 2020 2020 6465  n.            de
+00008e00: 6661 756c 745f 6669 6c65 7320 3d20 7365  fault_files = se
+00008e10: 6c66 2e66 696c 6573 0a20 2020 2020 2020  lf.files.       
+00008e20: 2020 2020 2064 6566 6175 6c74 5f65 6e61       default_ena
+00008e30: 626c 6572 6f6f 7420 3d20 7365 6c66 2e65  bleroot = self.e
+00008e40: 6e61 626c 6572 6f6f 740a 2020 2020 2020  nableroot.      
+00008e50: 2020 2020 2020 6465 6661 756c 745f 7461        default_ta
+00008e60: 6773 203d 2073 656c 662e 7461 6773 0a20  gs = self.tags. 
+00008e70: 2020 2020 2020 2020 2020 2064 6566 6175             defau
+00008e80: 6c74 5f66 6c61 766f 7220 3d20 7365 6c66  lt_flavor = self
+00008e90: 2e66 6c61 766f 720a 2020 2020 2020 2020  .flavor.        
+00008ea0: 2020 2020 6465 6661 756c 745f 7072 6976      default_priv
+00008eb0: 6174 656b 6579 203d 2073 656c 662e 7072  atekey = self.pr
+00008ec0: 6976 6174 656b 6579 0a20 2020 2020 2020  ivatekey.       
+00008ed0: 2020 2020 2064 6566 6175 6c74 5f6e 6574       default_net
+00008ee0: 776f 726b 7761 6974 203d 2073 656c 662e  workwait = self.
+00008ef0: 6e65 7477 6f72 6b77 6169 740a 2020 2020  networkwait.    
+00008f00: 2020 2020 2020 2020 6465 6661 756c 745f          default_
+00008f10: 7268 6e72 6567 6973 7465 7220 3d20 7365  rhnregister = se
+00008f20: 6c66 2e72 686e 7265 6769 7374 6572 0a20  lf.rhnregister. 
+00008f30: 2020 2020 2020 2020 2020 2064 6566 6175             defau
+00008f40: 6c74 5f72 686e 7365 7276 6572 203d 2073  lt_rhnserver = s
+00008f50: 656c 662e 7268 6e73 6572 7665 720a 2020  elf.rhnserver.  
+00008f60: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
+00008f70: 745f 7268 6e75 7365 7220 3d20 7365 6c66  t_rhnuser = self
+00008f80: 2e72 686e 7573 6572 0a20 2020 2020 2020  .rhnuser.       
+00008f90: 2020 2020 2064 6566 6175 6c74 5f72 686e       default_rhn
+00008fa0: 7061 7373 776f 7264 203d 2073 656c 662e  password = self.
+00008fb0: 7268 6e70 6173 7377 6f72 640a 2020 2020  rhnpassword.    
+00008fc0: 2020 2020 2020 2020 6465 6661 756c 745f          default_
+00008fd0: 7268 6e61 6b20 3d20 7365 6c66 2e72 686e  rhnak = self.rhn
+00008fe0: 616b 0a20 2020 2020 2020 2020 2020 2064  ak.            d
+00008ff0: 6566 6175 6c74 5f72 686e 6f72 6720 3d20  efault_rhnorg = 
+00009000: 7365 6c66 2e72 686e 6f72 670a 2020 2020  self.rhnorg.    
+00009010: 2020 2020 2020 2020 6465 6661 756c 745f          default_
+00009020: 7268 6e70 6f6f 6c20 3d20 7365 6c66 2e72  rhnpool = self.r
+00009030: 686e 706f 6f6c 0a20 2020 2020 2020 2020  hnpool.         
+00009040: 2020 2064 6566 6175 6c74 5f63 6d64 7320     default_cmds 
+00009050: 3d20 7365 6c66 2e63 6d64 730a 2020 2020  = self.cmds.    
+00009060: 2020 2020 2020 2020 6465 6661 756c 745f          default_
+00009070: 7363 7269 7074 7320 3d20 7365 6c66 2e73  scripts = self.s
+00009080: 6372 6970 7473 0a20 2020 2020 2020 2020  cripts.         
+00009090: 2020 2064 6566 6175 6c74 5f64 6e73 636c     default_dnscl
+000090a0: 6965 6e74 203d 2073 656c 662e 646e 7363  ient = self.dnsc
+000090b0: 6c69 656e 740a 2020 2020 2020 2020 2020  lient.          
+000090c0: 2020 6465 6661 756c 745f 7374 6f72 656d    default_storem
+000090d0: 6574 6164 6174 6120 3d20 7365 6c66 2e73  etadata = self.s
+000090e0: 746f 7265 6d65 7461 6461 7461 0a20 2020  toremetadata.   
+000090f0: 2020 2020 2020 2020 2064 6566 6175 6c74           default
+00009100: 5f6e 6f74 6966 7920 3d20 7365 6c66 2e6e  _notify = self.n
+00009110: 6f74 6966 790a 2020 2020 2020 2020 2020  otify.          
+00009120: 2020 6465 6661 756c 745f 7075 7368 6275    default_pushbu
+00009130: 6c6c 6574 746f 6b65 6e20 3d20 7365 6c66  llettoken = self
+00009140: 2e70 7573 6862 756c 6c65 7474 6f6b 656e  .pushbullettoken
+00009150: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
+00009160: 6175 6c74 5f73 6c61 636b 746f 6b65 6e20  ault_slacktoken 
+00009170: 3d20 7365 6c66 2e73 6c61 636b 746f 6b65  = self.slacktoke
+00009180: 6e0a 2020 2020 2020 2020 2020 2020 6465  n.            de
+00009190: 6661 756c 745f 6d61 696c 7365 7276 6572  fault_mailserver
+000091a0: 203d 2073 656c 662e 6d61 696c 7365 7276   = self.mailserv
+000091b0: 6572 0a20 2020 2020 2020 2020 2020 2064  er.            d
+000091c0: 6566 6175 6c74 5f6d 6169 6c66 726f 6d20  efault_mailfrom 
+000091d0: 3d20 7365 6c66 2e6d 6169 6c66 726f 6d0a  = self.mailfrom.
+000091e0: 2020 2020 2020 2020 2020 2020 6465 6661              defa
+000091f0: 756c 745f 6d61 696c 746f 203d 2073 656c  ult_mailto = sel
+00009200: 662e 6d61 696c 746f 0a20 2020 2020 2020  f.mailto.       
+00009210: 2020 2020 2064 6566 6175 6c74 5f6e 6f74       default_not
+00009220: 6966 7963 6d64 203d 2073 656c 662e 6e6f  ifycmd = self.no
+00009230: 7469 6679 636d 640a 2020 2020 2020 2020  tifycmd.        
+00009240: 2020 2020 6465 6661 756c 745f 6e6f 7469      default_noti
+00009250: 6679 7363 7269 7074 203d 2073 656c 662e  fyscript = self.
+00009260: 6e6f 7469 6679 7363 7269 7074 0a20 2020  notifyscript.   
+00009270: 2020 2020 2020 2020 2064 6566 6175 6c74           default
+00009280: 5f6e 6f74 6966 796d 6574 686f 6473 203d  _notifymethods =
+00009290: 2073 656c 662e 6e6f 7469 6679 6d65 7468   self.notifymeth
+000092a0: 6f64 730a 2020 2020 2020 2020 2020 2020  ods.            
+000092b0: 6465 6661 756c 745f 736c 6163 6b63 6861  default_slackcha
+000092c0: 6e6e 656c 203d 2073 656c 662e 736c 6163  nnel = self.slac
+000092d0: 6b63 6861 6e6e 656c 0a20 2020 2020 2020  kchannel.       
+000092e0: 2020 2020 2064 6566 6175 6c74 5f73 6861       default_sha
+000092f0: 7265 6466 6f6c 6465 7273 203d 2073 656c  redfolders = sel
+00009300: 662e 7368 6172 6564 666f 6c64 6572 730a  f.sharedfolders.
+00009310: 2020 2020 2020 2020 2020 2020 6465 6661              defa
+00009320: 756c 745f 6b65 726e 656c 203d 2073 656c  ult_kernel = sel
+00009330: 662e 6b65 726e 656c 0a20 2020 2020 2020  f.kernel.       
+00009340: 2020 2020 2064 6566 6175 6c74 5f69 6e69       default_ini
+00009350: 7472 6420 3d20 7365 6c66 2e69 6e69 7472  trd = self.initr
+00009360: 640a 2020 2020 2020 2020 2020 2020 6465  d.            de
+00009370: 6661 756c 745f 636d 646c 696e 6520 3d20  fault_cmdline = 
+00009380: 7365 6c66 2e63 6d64 6c69 6e65 0a20 2020  self.cmdline.   
+00009390: 2020 2020 2020 2020 2064 6566 6175 6c74           default
+000093a0: 5f70 6c61 6365 6d65 6e74 203d 2073 656c  _placement = sel
+000093b0: 662e 706c 6163 656d 656e 740a 2020 2020  f.placement.    
+000093c0: 2020 2020 2020 2020 6465 6661 756c 745f          default_
+000093d0: 7961 6d6c 696e 7665 6e74 6f72 7920 3d20  yamlinventory = 
+000093e0: 7365 6c66 2e79 616d 6c69 6e76 656e 746f  self.yamlinvento
+000093f0: 7279 0a20 2020 2020 2020 2020 2020 2064  ry.            d
+00009400: 6566 6175 6c74 5f63 7075 686f 7470 6c75  efault_cpuhotplu
+00009410: 6720 3d20 7365 6c66 2e63 7075 686f 7470  g = self.cpuhotp
+00009420: 6c75 670a 2020 2020 2020 2020 2020 2020  lug.            
+00009430: 6465 6661 756c 745f 6d65 6d6f 7279 686f  default_memoryho
+00009440: 7470 6c75 6720 3d20 7365 6c66 2e6d 656d  tplug = self.mem
+00009450: 6f72 7968 6f74 706c 7567 0a20 2020 2020  oryhotplug.     
+00009460: 2020 2020 2020 2064 6566 6175 6c74 5f76         default_v
+00009470: 6972 7474 7970 6520 3d20 7365 6c66 2e76  irttype = self.v
+00009480: 6972 7474 7970 650a 2020 2020 2020 2020  irttype.        
+00009490: 2020 2020 6465 6661 756c 745f 7365 6375      default_secu
+000094a0: 7269 7479 6772 6f75 7073 203d 2073 656c  ritygroups = sel
+000094b0: 662e 7365 6375 7269 7479 6772 6f75 7073  f.securitygroups
+000094c0: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
+000094d0: 6175 6c74 5f72 6f6f 7470 6173 7377 6f72  ault_rootpasswor
+000094e0: 6420 3d20 7365 6c66 2e72 6f6f 7470 6173  d = self.rootpas
+000094f0: 7377 6f72 640a 2020 2020 2020 2020 2020  sword.          
+00009500: 2020 6465 6661 756c 745f 7465 6d70 6b65    default_tempke
+00009510: 7920 3d20 7365 6c66 2e74 656d 706b 6579  y = self.tempkey
+00009520: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
+00009530: 6175 6c74 5f76 6d75 7365 7220 3d20 7365  ault_vmuser = se
+00009540: 6c66 2e76 6d75 7365 720a 2020 2020 2020  lf.vmuser.      
+00009550: 2020 2020 2020 6465 6661 756c 745f 7761        default_wa
+00009560: 6974 203d 2073 656c 662e 7761 6974 0a20  it = self.wait. 
+00009570: 2020 2020 2020 2020 2020 2064 6566 6175             defau
+00009580: 6c74 5f77 6169 7463 6f6d 6d61 6e64 203d  lt_waitcommand =
+00009590: 2073 656c 662e 7761 6974 636f 6d6d 616e   self.waitcomman
+000095a0: 640a 2020 2020 2020 2020 2020 2020 6465  d.            de
+000095b0: 6661 756c 745f 7761 6974 7469 6d65 6f75  fault_waittimeou
+000095c0: 7420 3d20 7365 6c66 2e77 6169 7474 696d  t = self.waittim
+000095d0: 656f 7574 0a20 2020 2020 2020 2070 6c61  eout.        pla
+000095e0: 6e20 3d20 7072 6f66 696c 652e 6765 7428  n = profile.get(
+000095f0: 2770 6c61 6e27 2c20 706c 616e 290a 2020  'plan', plan).  
+00009600: 2020 2020 2020 7465 6d70 6c61 7465 203d        template =
+00009610: 2070 726f 6669 6c65 2e67 6574 2827 7465   profile.get('te
+00009620: 6d70 6c61 7465 272c 2064 6566 6175 6c74  mplate', default
+00009630: 5f69 6d61 6765 290a 2020 2020 2020 2020  _image).        
+00009640: 696d 6167 6520 3d20 7072 6f66 696c 652e  image = profile.
+00009650: 6765 7428 2769 6d61 6765 272c 2074 656d  get('image', tem
+00009660: 706c 6174 6529 0a20 2020 2020 2020 206e  plate).        n
+00009670: 6574 7320 3d20 7072 6f66 696c 652e 6765  ets = profile.ge
+00009680: 7428 276e 6574 7327 2c20 6465 6661 756c  t('nets', defaul
+00009690: 745f 6e65 7473 290a 2020 2020 2020 2020  t_nets).        
+000096a0: 6370 756d 6f64 656c 203d 2070 726f 6669  cpumodel = profi
+000096b0: 6c65 2e67 6574 2827 6370 756d 6f64 656c  le.get('cpumodel
+000096c0: 272c 2064 6566 6175 6c74 5f63 7075 6d6f  ', default_cpumo
+000096d0: 6465 6c29 0a20 2020 2020 2020 2063 7075  del).        cpu
+000096e0: 666c 6167 7320 3d20 7072 6f66 696c 652e  flags = profile.
+000096f0: 6765 7428 2763 7075 666c 6167 7327 2c20  get('cpuflags', 
+00009700: 6465 6661 756c 745f 6370 7566 6c61 6773  default_cpuflags
+00009710: 290a 2020 2020 2020 2020 6370 7570 696e  ).        cpupin
+00009720: 6e69 6e67 203d 2070 726f 6669 6c65 2e67  ning = profile.g
+00009730: 6574 2827 6370 7570 696e 6e69 6e67 272c  et('cpupinning',
+00009740: 2064 6566 6175 6c74 5f63 7075 7069 6e6e   default_cpupinn
+00009750: 696e 6729 0a20 2020 2020 2020 206e 756d  ing).        num
+00009760: 616d 6f64 6520 3d20 7072 6f66 696c 652e  amode = profile.
+00009770: 6765 7428 276e 756d 616d 6f64 6527 2c20  get('numamode', 
+00009780: 6465 6661 756c 745f 6e75 6d61 6d6f 6465  default_numamode
+00009790: 290a 2020 2020 2020 2020 6e75 6d61 203d  ).        numa =
+000097a0: 2070 726f 6669 6c65 2e67 6574 2827 6e75   profile.get('nu
+000097b0: 6d61 272c 2064 6566 6175 6c74 5f6e 756d  ma', default_num
+000097c0: 6129 0a20 2020 2020 2020 2070 6369 6465  a).        pcide
+000097d0: 7669 6365 7320 3d20 7072 6f66 696c 652e  vices = profile.
+000097e0: 6765 7428 2770 6369 6465 7669 6365 7327  get('pcidevices'
+000097f0: 2c20 6465 6661 756c 745f 7063 6964 6576  , default_pcidev
+00009800: 6963 6573 290a 2020 2020 2020 2020 7470  ices).        tp
+00009810: 6d20 3d20 7072 6f66 696c 652e 6765 7428  m = profile.get(
+00009820: 2774 706d 272c 2064 6566 6175 6c74 5f74  'tpm', default_t
+00009830: 706d 290a 2020 2020 2020 2020 726e 6720  pm).        rng 
+00009840: 3d20 7072 6f66 696c 652e 6765 7428 2772  = profile.get('r
+00009850: 6e67 272c 2064 6566 6175 6c74 5f72 6e67  ng', default_rng
+00009860: 290a 2020 2020 2020 2020 7365 6375 7269  ).        securi
+00009870: 7479 6772 6f75 7073 203d 2070 726f 6669  tygroups = profi
+00009880: 6c65 2e67 6574 2827 7365 6375 7269 7479  le.get('security
+00009890: 6772 6f75 7073 272c 2064 6566 6175 6c74  groups', default
+000098a0: 5f73 6563 7572 6974 7967 726f 7570 7329  _securitygroups)
+000098b0: 0a20 2020 2020 2020 206e 756d 6370 7573  .        numcpus
+000098c0: 203d 2070 726f 6669 6c65 2e67 6574 2827   = profile.get('
+000098d0: 6e75 6d63 7075 7327 2c20 6465 6661 756c  numcpus', defaul
+000098e0: 745f 6e75 6d63 7075 7329 0a20 2020 2020  t_numcpus).     
+000098f0: 2020 206d 656d 6f72 7920 3d20 7072 6f66     memory = prof
+00009900: 696c 652e 6765 7428 276d 656d 6f72 7927  ile.get('memory'
+00009910: 2c20 6465 6661 756c 745f 6d65 6d6f 7279  , default_memory
+00009920: 290a 2020 2020 2020 2020 6966 2069 7369  ).        if isi
+00009930: 6e73 7461 6e63 6528 6d65 6d6f 7279 2c20  nstance(memory, 
+00009940: 7374 7229 2061 6e64 2028 6d65 6d6f 7279  str) and (memory
+00009950: 2e6c 6f77 6572 2829 2e65 6e64 7377 6974  .lower().endswit
+00009960: 6828 2767 6227 2920 6f72 206d 656d 6f72  h('gb') or memor
+00009970: 792e 6c6f 7765 7228 292e 656e 6473 7769  y.lower().endswi
+00009980: 7468 2827 6727 2929 3a0a 2020 2020 2020  th('g')):.      
+00009990: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+000099a0: 2020 2020 2020 2020 2020 206d 656d 6f72             memor
+000099b0: 7920 3d20 696e 7428 6d65 6d6f 7279 2e6c  y = int(memory.l
+000099c0: 6f77 6572 2827 6762 272c 2027 2729 2e72  ower('gb', '').r
+000099d0: 6570 6c61 6365 2827 6727 2c20 2727 2929  eplace('g', ''))
+000099e0: 202a 2031 3032 340a 2020 2020 2020 2020   * 1024.        
+000099f0: 2020 2020 6578 6365 7074 2045 7863 6570      except Excep
+00009a00: 7469 6f6e 2061 7320 653a 0a20 2020 2020  tion as e:.     
+00009a10: 2020 2020 2020 2020 2020 2065 7272 6f72             error
+00009a20: 2866 2243 6f75 6c64 6e74 2063 6f6e 7665  (f"Couldnt conve
+00009a30: 7274 206d 656d 6f72 792e 2048 6974 207b  rt memory. Hit {
+00009a40: 657d 2229 0a20 2020 2020 2020 2070 6f6f  e}").        poo
+00009a50: 6c20 3d20 7072 6f66 696c 652e 6765 7428  l = profile.get(
+00009a60: 2770 6f6f 6c27 2c20 6465 6661 756c 745f  'pool', default_
+00009a70: 706f 6f6c 290a 2020 2020 2020 2020 6469  pool).        di
+00009a80: 736b 7320 3d20 7072 6f66 696c 652e 6765  sks = profile.ge
+00009a90: 7428 2764 6973 6b73 272c 2064 6566 6175  t('disks', defau
+00009aa0: 6c74 5f64 6973 6b73 290a 2020 2020 2020  lt_disks).      
+00009ab0: 2020 6469 736b 7369 7a65 203d 2070 726f    disksize = pro
+00009ac0: 6669 6c65 2e67 6574 2827 6469 736b 7369  file.get('disksi
+00009ad0: 7a65 272c 2064 6566 6175 6c74 5f64 6973  ze', default_dis
+00009ae0: 6b73 697a 6529 0a20 2020 2020 2020 2064  ksize).        d
+00009af0: 6973 6b69 6e74 6572 6661 6365 203d 2070  iskinterface = p
+00009b00: 726f 6669 6c65 2e67 6574 2827 6469 736b  rofile.get('disk
+00009b10: 696e 7465 7266 6163 6527 2c20 6465 6661  interface', defa
+00009b20: 756c 745f 6469 736b 696e 7465 7266 6163  ult_diskinterfac
+00009b30: 6529 0a20 2020 2020 2020 2064 6973 6b74  e).        diskt
+00009b40: 6869 6e20 3d20 7072 6f66 696c 652e 6765  hin = profile.ge
+00009b50: 7428 2764 6973 6b74 6869 6e27 2c20 6465  t('diskthin', de
+00009b60: 6661 756c 745f 6469 736b 7468 696e 290a  fault_diskthin).
+00009b70: 2020 2020 2020 2020 6966 2064 6973 6b73          if disks
+00009b80: 2061 6e64 2069 7369 6e73 7461 6e63 6528   and isinstance(
+00009b90: 6469 736b 732c 2064 6963 7429 2061 6e64  disks, dict) and
+00009ba0: 2027 6465 6661 756c 7427 2069 6e20 6469   'default' in di
+00009bb0: 736b 735b 305d 3a0a 2020 2020 2020 2020  sks[0]:.        
+00009bc0: 2020 2020 6469 736b 7320 3d20 5b7b 2773      disks = [{'s
+00009bd0: 697a 6527 3a20 6469 736b 7369 7a65 2c20  ize': disksize, 
+00009be0: 2769 6e74 6572 6661 6365 273a 2064 6973  'interface': dis
+00009bf0: 6b69 6e74 6572 6661 6365 2c20 2774 6869  kinterface, 'thi
+00009c00: 6e27 3a20 6469 736b 7468 696e 7d5d 0a20  n': diskthin}]. 
+00009c10: 2020 2020 2020 2067 7565 7374 6964 203d         guestid =
+00009c20: 2070 726f 6669 6c65 2e67 6574 2827 6775   profile.get('gu
+00009c30: 6573 7469 6427 2c20 6465 6661 756c 745f  estid', default_
+00009c40: 6775 6573 7469 6429 0a20 2020 2020 2020  guestid).       
+00009c50: 2069 736f 203d 2070 726f 6669 6c65 2e67   iso = profile.g
+00009c60: 6574 2827 6973 6f27 2c20 6465 6661 756c  et('iso', defaul
+00009c70: 745f 6973 6f29 0a20 2020 2020 2020 2076  t_iso).        v
+00009c80: 6e63 203d 2070 726f 6669 6c65 2e67 6574  nc = profile.get
+00009c90: 2827 766e 6327 2c20 6465 6661 756c 745f  ('vnc', default_
+00009ca0: 766e 6329 0a20 2020 2020 2020 2063 6c6f  vnc).        clo
+00009cb0: 7564 696e 6974 203d 2070 726f 6669 6c65  udinit = profile
+00009cc0: 2e67 6574 2827 636c 6f75 6469 6e69 7427  .get('cloudinit'
+00009cd0: 2c20 6465 6661 756c 745f 636c 6f75 6469  , default_cloudi
+00009ce0: 6e69 7429 0a20 2020 2020 2020 2069 6620  nit).        if 
+00009cf0: 636c 6f75 6469 6e69 7420 616e 6420 7365  cloudinit and se
+00009d00: 6c66 2e74 7970 6520 3d3d 2027 6b76 6d27  lf.type == 'kvm'
+00009d10: 2061 6e64 5c0a 2020 2020 2020 2020 2020   and\.          
+00009d20: 2020 2020 2020 7768 6963 6828 276d 6b69        which('mki
+00009d30: 736f 6673 2729 2069 7320 4e6f 6e65 2061  sofs') is None a
+00009d40: 6e64 2077 6869 6368 2827 6765 6e69 736f  nd which('geniso
+00009d50: 696d 6167 6527 2920 6973 204e 6f6e 653a  image') is None:
+00009d60: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00009d70: 7572 6e20 7b27 7265 7375 6c74 273a 2027  urn {'result': '
+00009d80: 6661 696c 7572 6527 2c20 2772 6561 736f  failure', 'reaso
+00009d90: 6e27 3a20 224d 6973 7369 6e67 206d 6b69  n': "Missing mki
+00009da0: 736f 6673 2f67 656e 6973 6f69 6d61 6765  sofs/genisoimage
+00009db0: 206e 6565 6465 6420 666f 7220 636c 6f75   needed for clou
+00009dc0: 6469 6e69 7422 7d0a 2020 2020 2020 2020  dinit"}.        
+00009dd0: 7265 7365 7276 6569 7020 3d20 7072 6f66  reserveip = prof
+00009de0: 696c 652e 6765 7428 2772 6573 6572 7665  ile.get('reserve
+00009df0: 6970 272c 2064 6566 6175 6c74 5f72 6573  ip', default_res
+00009e00: 6572 7665 6970 290a 2020 2020 2020 2020  erveip).        
+00009e10: 7265 7365 7276 6564 6e73 203d 2070 726f  reservedns = pro
+00009e20: 6669 6c65 2e67 6574 2827 7265 7365 7276  file.get('reserv
+00009e30: 6564 6e73 272c 2064 6566 6175 6c74 5f72  edns', default_r
+00009e40: 6573 6572 7665 646e 7329 0a20 2020 2020  eservedns).     
+00009e50: 2020 2072 6573 6572 7665 686f 7374 203d     reservehost =
+00009e60: 2070 726f 6669 6c65 2e67 6574 2827 7265   profile.get('re
+00009e70: 7365 7276 6568 6f73 7427 2c20 6465 6661  servehost', defa
+00009e80: 756c 745f 7265 7365 7276 6568 6f73 7429  ult_reservehost)
+00009e90: 0a20 2020 2020 2020 206e 6573 7465 6420  .        nested 
+00009ea0: 3d20 7072 6f66 696c 652e 6765 7428 276e  = profile.get('n
+00009eb0: 6573 7465 6427 2c20 6465 6661 756c 745f  ested', default_
+00009ec0: 6e65 7374 6564 290a 2020 2020 2020 2020  nested).        
+00009ed0: 7374 6172 7420 3d20 7072 6f66 696c 652e  start = profile.
+00009ee0: 6765 7428 2773 7461 7274 272c 2064 6566  get('start', def
+00009ef0: 6175 6c74 5f73 7461 7274 290a 2020 2020  ault_start).    
+00009f00: 2020 2020 6175 746f 7374 6172 7420 3d20      autostart = 
+00009f10: 7072 6f66 696c 652e 6765 7428 2761 7574  profile.get('aut
+00009f20: 6f73 7461 7274 272c 2064 6566 6175 6c74  ostart', default
+00009f30: 5f61 7574 6f73 7461 7274 290a 2020 2020  _autostart).    
+00009f40: 2020 2020 6b65 7973 203d 2070 726f 6669      keys = profi
+00009f50: 6c65 2e67 6574 2827 6b65 7973 272c 2064  le.get('keys', d
+00009f60: 6566 6175 6c74 5f6b 6579 7329 0a20 2020  efault_keys).   
+00009f70: 2020 2020 2063 6d64 7320 3d20 636f 6d6d       cmds = comm
+00009f80: 6f6e 2e72 656d 6f76 655f 6475 706c 6963  on.remove_duplic
+00009f90: 6174 6573 2864 6566 6175 6c74 5f63 6d64  ates(default_cmd
+00009fa0: 7320 2b20 7072 6f66 696c 652e 6765 7428  s + profile.get(
+00009fb0: 2763 6d64 7327 2c20 5b5d 2929 0a20 2020  'cmds', [])).   
+00009fc0: 2020 2020 206e 6574 6d61 736b 7320 3d20       netmasks = 
+00009fd0: 7072 6f66 696c 652e 6765 7428 276e 6574  profile.get('net
+00009fe0: 6d61 736b 7327 2c20 6465 6661 756c 745f  masks', default_
+00009ff0: 6e65 746d 6173 6b73 290a 2020 2020 2020  netmasks).      
+0000a000: 2020 6761 7465 7761 7920 3d20 7072 6f66    gateway = prof
+0000a010: 696c 652e 6765 7428 2767 6174 6577 6179  ile.get('gateway
+0000a020: 272c 2064 6566 6175 6c74 5f67 6174 6577  ', default_gatew
+0000a030: 6179 290a 2020 2020 2020 2020 646e 7320  ay).        dns 
+0000a040: 3d20 7072 6f66 696c 652e 6765 7428 2764  = profile.get('d
+0000a050: 6e73 272c 2064 6566 6175 6c74 5f64 6e73  ns', default_dns
+0000a060: 290a 2020 2020 2020 2020 646f 6d61 696e  ).        domain
+0000a070: 203d 2070 726f 6669 6c65 2e67 6574 2827   = profile.get('
+0000a080: 646f 6d61 696e 272c 206f 7665 7272 6964  domain', overrid
+0000a090: 6573 2e67 6574 2827 646f 6d61 696e 272c  es.get('domain',
+0000a0a0: 2064 6566 6175 6c74 5f64 6f6d 6169 6e29   default_domain)
+0000a0b0: 290a 2020 2020 2020 2020 646e 7363 6c69  ).        dnscli
+0000a0c0: 656e 7420 3d20 7072 6f66 696c 652e 6765  ent = profile.ge
+0000a0d0: 7428 2764 6e73 636c 6965 6e74 272c 206f  t('dnsclient', o
+0000a0e0: 7665 7272 6964 6573 2e67 6574 2827 646e  verrides.get('dn
+0000a0f0: 7363 6c69 656e 7427 2c20 6465 6661 756c  sclient', defaul
+0000a100: 745f 646e 7363 6c69 656e 7429 290a 2020  t_dnsclient)).  
+0000a110: 2020 2020 2020 7363 7269 7074 7320 3d20        scripts = 
+0000a120: 636f 6d6d 6f6e 2e72 656d 6f76 655f 6475  common.remove_du
+0000a130: 706c 6963 6174 6573 2864 6566 6175 6c74  plicates(default
+0000a140: 5f73 6372 6970 7473 202b 2070 726f 6669  _scripts + profi
+0000a150: 6c65 2e67 6574 2827 7363 7269 7074 7327  le.get('scripts'
+0000a160: 2c20 5b5d 2929 0a20 2020 2020 2020 2066  , [])).        f
+0000a170: 696c 6573 203d 2070 726f 6669 6c65 2e67  iles = profile.g
+0000a180: 6574 2827 6669 6c65 7327 2c20 6465 6661  et('files', defa
+0000a190: 756c 745f 6669 6c65 7329 0a20 2020 2020  ult_files).     
+0000a1a0: 2020 2065 7874 7261 5f66 696c 6573 203d     extra_files =
+0000a1b0: 2070 726f 6669 6c65 2e67 6574 2827 6578   profile.get('ex
+0000a1c0: 7472 615f 6669 6c65 7327 2920 6f72 206f  tra_files') or o
+0000a1d0: 7665 7272 6964 6573 2e67 6574 2827 6578  verrides.get('ex
+0000a1e0: 7472 615f 6669 6c65 7327 2920 6f72 205b  tra_files') or [
+0000a1f0: 5d0a 2020 2020 2020 2020 6669 6c65 732e  ].        files.
+0000a200: 6578 7465 6e64 2865 7874 7261 5f66 696c  extend(extra_fil
+0000a210: 6573 290a 2020 2020 2020 2020 7265 7375  es).        resu
+0000a220: 6c74 203d 2073 656c 662e 7061 7273 655f  lt = self.parse_
+0000a230: 6669 6c65 7328 6e61 6d65 2c20 6669 6c65  files(name, file
+0000a240: 732c 2062 6173 6564 6972 2c20 6f6e 666c  s, basedir, onfl
+0000a250: 7929 0a20 2020 2020 2020 2069 6620 7265  y).        if re
+0000a260: 7375 6c74 2069 7320 6e6f 7420 4e6f 6e65  sult is not None
+0000a270: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+0000a280: 7475 726e 2072 6573 756c 740a 2020 2020  turn result.    
+0000a290: 2020 2020 7072 6f66 696c 655f 656e 765f      profile_env_
+0000a2a0: 7061 7261 6d65 7465 7273 203d 205b 6b65  parameters = [ke
+0000a2b0: 7920 666f 7220 6b65 7920 696e 2070 726f  y for key in pro
+0000a2c0: 6669 6c65 2069 6620 6b65 792e 6973 7570  file if key.isup
+0000a2d0: 7065 7228 295d 0a20 2020 2020 2020 206f  per()].        o
+0000a2e0: 7665 7272 6964 6573 5f65 6e76 5f70 6172  verrides_env_par
+0000a2f0: 616d 6574 6572 7320 3d20 5b6b 6579 2066  ameters = [key f
+0000a300: 6f72 206b 6579 2069 6e20 6f76 6572 7269  or key in overri
+0000a310: 6465 7320 6966 206b 6579 2e69 7375 7070  des if key.isupp
+0000a320: 6572 2829 5d0a 2020 2020 2020 2020 656e  er()].        en
+0000a330: 765f 7061 7261 6d65 7465 7273 203d 2073  v_parameters = s
+0000a340: 6f72 7465 6428 6c69 7374 2873 6574 2870  orted(list(set(p
+0000a350: 726f 6669 6c65 5f65 6e76 5f70 6172 616d  rofile_env_param
+0000a360: 6574 6572 7320 2b20 6f76 6572 7269 6465  eters + override
+0000a370: 735f 656e 765f 7061 7261 6d65 7465 7273  s_env_parameters
+0000a380: 2929 290a 2020 2020 2020 2020 6966 2065  ))).        if e
+0000a390: 6e76 5f70 6172 616d 6574 6572 733a 0a20  nv_parameters:. 
+0000a3a0: 2020 2020 2020 2020 2020 2065 6e76 5f64             env_d
+0000a3b0: 6174 6120 3d20 2727 0a20 2020 2020 2020  ata = ''.       
+0000a3c0: 2020 2020 2066 6f72 206b 6579 2069 6e20       for key in 
+0000a3d0: 656e 765f 7061 7261 6d65 7465 7273 3a0a  env_parameters:.
+0000a3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a3f0: 7661 6c75 6520 3d20 7072 6f66 696c 652e  value = profile.
+0000a400: 6765 7428 6b65 7929 206f 7220 6f76 6572  get(key) or over
+0000a410: 7269 6465 732e 6765 7428 6b65 7929 0a20  rides.get(key). 
+0000a420: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0000a430: 6e76 5f64 6174 6120 2b3d 2066 2265 7870  nv_data += f"exp
+0000a440: 6f72 7420 7b6b 6579 7d3d 7b76 616c 7565  ort {key}={value
+0000a450: 7d5c 6e65 7870 6f72 7420 7b6b 6579 2e6c  }\nexport {key.l
+0000a460: 6f77 6572 2829 7d3d 7b76 616c 7565 7d5c  ower()}={value}\
+0000a470: 6e22 0a20 2020 2020 2020 2020 2020 2066  n".            f
+0000a480: 696c 6573 2e61 7070 656e 6428 7b27 7061  iles.append({'pa
+0000a490: 7468 273a 2027 2f65 7463 2f70 726f 6669  th': '/etc/profi
+0000a4a0: 6c65 2e64 2f6b 636c 692e 7368 272c 2027  le.d/kcli.sh', '
+0000a4b0: 636f 6e74 656e 7427 3a20 656e 765f 6461  content': env_da
+0000a4c0: 7461 2c20 276d 6f64 6527 3a20 3634 347d  ta, 'mode': 644}
+0000a4d0: 290a 2020 2020 2020 2020 656e 6162 6c65  ).        enable
+0000a4e0: 726f 6f74 203d 2070 726f 6669 6c65 2e67  root = profile.g
+0000a4f0: 6574 2827 656e 6162 6c65 726f 6f74 272c  et('enableroot',
+0000a500: 2064 6566 6175 6c74 5f65 6e61 626c 6572   default_enabler
+0000a510: 6f6f 7429 0a20 2020 2020 2020 2074 6167  oot).        tag
+0000a520: 7320 3d20 7072 6f66 696c 652e 6765 7428  s = profile.get(
+0000a530: 2774 6167 7327 2c20 5b5d 290a 2020 2020  'tags', []).    
+0000a540: 2020 2020 6966 2064 6566 6175 6c74 5f74      if default_t
+0000a550: 6167 733a 0a20 2020 2020 2020 2020 2020  ags:.           
+0000a560: 2074 6167 7320 3d20 6465 6661 756c 745f   tags = default_
+0000a570: 7461 6773 202b 2074 6167 7320 6966 2074  tags + tags if t
+0000a580: 6167 7320 656c 7365 2064 6566 6175 6c74  ags else default
+0000a590: 5f74 6167 730a 2020 2020 2020 2020 7072  _tags.        pr
+0000a5a0: 6976 6174 656b 6579 203d 2070 726f 6669  ivatekey = profi
+0000a5b0: 6c65 2e67 6574 2827 7072 6976 6174 656b  le.get('privatek
+0000a5c0: 6579 272c 2064 6566 6175 6c74 5f70 7269  ey', default_pri
+0000a5d0: 7661 7465 6b65 7929 0a20 2020 2020 2020  vatekey).       
+0000a5e0: 206e 6574 776f 726b 7761 6974 203d 2070   networkwait = p
+0000a5f0: 726f 6669 6c65 2e67 6574 2827 6e65 7477  rofile.get('netw
+0000a600: 6f72 6b77 6169 7427 2c20 6465 6661 756c  orkwait', defaul
+0000a610: 745f 6e65 7477 6f72 6b77 6169 7429 0a20  t_networkwait). 
+0000a620: 2020 2020 2020 2072 686e 7265 6769 7374         rhnregist
+0000a630: 6572 203d 2070 726f 6669 6c65 2e67 6574  er = profile.get
+0000a640: 2827 7268 6e72 6567 6973 7465 7227 2c20  ('rhnregister', 
+0000a650: 6465 6661 756c 745f 7268 6e72 6567 6973  default_rhnregis
+0000a660: 7465 7229 0a20 2020 2020 2020 2072 686e  ter).        rhn
+0000a670: 7365 7276 6572 203d 2070 726f 6669 6c65  server = profile
+0000a680: 2e67 6574 2827 7268 6e73 6572 7665 7227  .get('rhnserver'
+0000a690: 2c20 6465 6661 756c 745f 7268 6e73 6572  , default_rhnser
+0000a6a0: 7665 7229 0a20 2020 2020 2020 2072 686e  ver).        rhn
+0000a6b0: 7573 6572 203d 2070 726f 6669 6c65 2e67  user = profile.g
+0000a6c0: 6574 2827 7268 6e75 7365 7227 2c20 6465  et('rhnuser', de
+0000a6d0: 6661 756c 745f 7268 6e75 7365 7229 0a20  fault_rhnuser). 
+0000a6e0: 2020 2020 2020 2072 686e 7061 7373 776f         rhnpasswo
+0000a6f0: 7264 203d 2070 726f 6669 6c65 2e67 6574  rd = profile.get
+0000a700: 2827 7268 6e70 6173 7377 6f72 6427 2c20  ('rhnpassword', 
+0000a710: 6465 6661 756c 745f 7268 6e70 6173 7377  default_rhnpassw
+0000a720: 6f72 6429 0a20 2020 2020 2020 2072 686e  ord).        rhn
+0000a730: 616b 203d 2070 726f 6669 6c65 2e67 6574  ak = profile.get
+0000a740: 2827 7268 6e61 6374 6976 6174 696f 6e6b  ('rhnactivationk
+0000a750: 6579 272c 2064 6566 6175 6c74 5f72 686e  ey', default_rhn
+0000a760: 616b 290a 2020 2020 2020 2020 7268 6e6f  ak).        rhno
+0000a770: 7267 203d 2070 726f 6669 6c65 2e67 6574  rg = profile.get
+0000a780: 2827 7268 6e6f 7267 272c 2064 6566 6175  ('rhnorg', defau
+0000a790: 6c74 5f72 686e 6f72 6729 0a20 2020 2020  lt_rhnorg).     
+0000a7a0: 2020 2072 686e 706f 6f6c 203d 2070 726f     rhnpool = pro
+0000a7b0: 6669 6c65 2e67 6574 2827 7268 6e70 6f6f  file.get('rhnpoo
+0000a7c0: 6c27 2c20 6465 6661 756c 745f 7268 6e70  l', default_rhnp
+0000a7d0: 6f6f 6c29 0a20 2020 2020 2020 2066 6c61  ool).        fla
+0000a7e0: 766f 7220 3d20 7072 6f66 696c 652e 6765  vor = profile.ge
+0000a7f0: 7428 2766 6c61 766f 7227 2c20 6465 6661  t('flavor', defa
+0000a800: 756c 745f 666c 6176 6f72 290a 2020 2020  ult_flavor).    
+0000a810: 2020 2020 7374 6f72 656d 6574 6164 6174      storemetadat
+0000a820: 6120 3d20 7072 6f66 696c 652e 6765 7428  a = profile.get(
+0000a830: 2773 746f 7265 6d65 7461 6461 7461 272c  'storemetadata',
+0000a840: 2064 6566 6175 6c74 5f73 746f 7265 6d65   default_storeme
+0000a850: 7461 6461 7461 290a 2020 2020 2020 2020  tadata).        
+0000a860: 6e6f 7469 6679 203d 2070 726f 6669 6c65  notify = profile
+0000a870: 2e67 6574 2827 6e6f 7469 6679 272c 2064  .get('notify', d
+0000a880: 6566 6175 6c74 5f6e 6f74 6966 7929 0a20  efault_notify). 
+0000a890: 2020 2020 2020 2070 7573 6862 756c 6c65         pushbulle
+0000a8a0: 7474 6f6b 656e 203d 2070 726f 6669 6c65  ttoken = profile
+0000a8b0: 2e67 6574 2827 7075 7368 6275 6c6c 6574  .get('pushbullet
+0000a8c0: 746f 6b65 6e27 2c20 6465 6661 756c 745f  token', default_
+0000a8d0: 7075 7368 6275 6c6c 6574 746f 6b65 6e29  pushbullettoken)
+0000a8e0: 0a20 2020 2020 2020 2073 6c61 636b 746f  .        slackto
+0000a8f0: 6b65 6e20 3d20 7072 6f66 696c 652e 6765  ken = profile.ge
+0000a900: 7428 2773 6c61 636b 746f 6b65 6e27 2c20  t('slacktoken', 
+0000a910: 6465 6661 756c 745f 736c 6163 6b74 6f6b  default_slacktok
+0000a920: 656e 290a 2020 2020 2020 2020 6e6f 7469  en).        noti
+0000a930: 6679 636d 6420 3d20 7072 6f66 696c 652e  fycmd = profile.
+0000a940: 6765 7428 276e 6f74 6966 7963 6d64 272c  get('notifycmd',
+0000a950: 2064 6566 6175 6c74 5f6e 6f74 6966 7963   default_notifyc
+0000a960: 6d64 290a 2020 2020 2020 2020 6e6f 7469  md).        noti
+0000a970: 6679 7363 7269 7074 203d 2070 726f 6669  fyscript = profi
+0000a980: 6c65 2e67 6574 2827 6e6f 7469 6679 7363  le.get('notifysc
+0000a990: 7269 7074 272c 2064 6566 6175 6c74 5f6e  ript', default_n
+0000a9a0: 6f74 6966 7973 6372 6970 7429 0a20 2020  otifyscript).   
+0000a9b0: 2020 2020 206e 6f74 6966 796d 6574 686f       notifymetho
+0000a9c0: 6473 203d 2070 726f 6669 6c65 2e67 6574  ds = profile.get
+0000a9d0: 2827 6e6f 7469 6679 6d65 7468 6f64 7327  ('notifymethods'
+0000a9e0: 2c20 6465 6661 756c 745f 6e6f 7469 6679  , default_notify
+0000a9f0: 6d65 7468 6f64 7329 0a20 2020 2020 2020  methods).       
+0000aa00: 2073 6c61 636b 6368 616e 6e65 6c20 3d20   slackchannel = 
+0000aa10: 7072 6f66 696c 652e 6765 7428 2773 6c61  profile.get('sla
+0000aa20: 636b 6368 616e 6e65 6c27 2c20 6465 6661  ckchannel', defa
+0000aa30: 756c 745f 736c 6163 6b63 6861 6e6e 656c  ult_slackchannel
+0000aa40: 290a 2020 2020 2020 2020 6d61 696c 7365  ).        mailse
+0000aa50: 7276 6572 203d 2070 726f 6669 6c65 2e67  rver = profile.g
+0000aa60: 6574 2827 6d61 696c 7365 7276 6572 272c  et('mailserver',
+0000aa70: 2064 6566 6175 6c74 5f6d 6169 6c73 6572   default_mailser
+0000aa80: 7665 7229 0a20 2020 2020 2020 206d 6169  ver).        mai
+0000aa90: 6c66 726f 6d20 3d20 7072 6f66 696c 652e  lfrom = profile.
+0000aaa0: 6765 7428 276d 6169 6c66 726f 6d27 2c20  get('mailfrom', 
+0000aab0: 6465 6661 756c 745f 6d61 696c 6672 6f6d  default_mailfrom
+0000aac0: 290a 2020 2020 2020 2020 6d61 696c 746f  ).        mailto
+0000aad0: 203d 2070 726f 6669 6c65 2e67 6574 2827   = profile.get('
+0000aae0: 6d61 696c 746f 272c 2064 6566 6175 6c74  mailto', default
+0000aaf0: 5f6d 6169 6c74 6f29 0a20 2020 2020 2020  _mailto).       
+0000ab00: 2073 6861 7265 6466 6f6c 6465 7273 203d   sharedfolders =
+0000ab10: 2070 726f 6669 6c65 2e67 6574 2827 7368   profile.get('sh
+0000ab20: 6172 6564 666f 6c64 6572 7327 2c20 6465  aredfolders', de
+0000ab30: 6661 756c 745f 7368 6172 6564 666f 6c64  fault_sharedfold
+0000ab40: 6572 7329 0a20 2020 2020 2020 206b 6572  ers).        ker
+0000ab50: 6e65 6c20 3d20 7072 6f66 696c 652e 6765  nel = profile.ge
+0000ab60: 7428 276b 6572 6e65 6c27 2c20 6465 6661  t('kernel', defa
+0000ab70: 756c 745f 6b65 726e 656c 290a 2020 2020  ult_kernel).    
+0000ab80: 2020 2020 696e 6974 7264 203d 2070 726f      initrd = pro
+0000ab90: 6669 6c65 2e67 6574 2827 696e 6974 7264  file.get('initrd
+0000aba0: 272c 2064 6566 6175 6c74 5f69 6e69 7472  ', default_initr
+0000abb0: 6429 0a20 2020 2020 2020 2063 6d64 6c69  d).        cmdli
+0000abc0: 6e65 203d 2070 726f 6669 6c65 2e67 6574  ne = profile.get
+0000abd0: 2827 636d 646c 696e 6527 2c20 6465 6661  ('cmdline', defa
+0000abe0: 756c 745f 636d 646c 696e 6529 0a20 2020  ult_cmdline).   
+0000abf0: 2020 2020 2070 6c61 6365 6d65 6e74 203d       placement =
+0000ac00: 2070 726f 6669 6c65 2e67 6574 2827 706c   profile.get('pl
+0000ac10: 6163 656d 656e 7427 2c20 6465 6661 756c  acement', defaul
+0000ac20: 745f 706c 6163 656d 656e 7429 0a20 2020  t_placement).   
+0000ac30: 2020 2020 2079 616d 6c69 6e76 656e 746f       yamlinvento
+0000ac40: 7279 203d 2070 726f 6669 6c65 2e67 6574  ry = profile.get
+0000ac50: 2827 7961 6d6c 696e 7665 6e74 6f72 7927  ('yamlinventory'
+0000ac60: 2c20 6465 6661 756c 745f 7961 6d6c 696e  , default_yamlin
+0000ac70: 7665 6e74 6f72 7929 0a20 2020 2020 2020  ventory).       
+0000ac80: 2063 7075 686f 7470 6c75 6720 3d20 7072   cpuhotplug = pr
+0000ac90: 6f66 696c 652e 6765 7428 2763 7075 686f  ofile.get('cpuho
+0000aca0: 7470 6c75 6727 2c20 6465 6661 756c 745f  tplug', default_
+0000acb0: 6370 7568 6f74 706c 7567 290a 2020 2020  cpuhotplug).    
+0000acc0: 2020 2020 6d65 6d6f 7279 686f 7470 6c75      memoryhotplu
+0000acd0: 6720 3d20 7072 6f66 696c 652e 6765 7428  g = profile.get(
+0000ace0: 276d 656d 6f72 7968 6f74 706c 7567 272c  'memoryhotplug',
+0000acf0: 2064 6566 6175 6c74 5f6d 656d 6f72 7968   default_memoryh
 0000ad00: 6f74 706c 7567 290a 2020 2020 2020 2020  otplug).        
-0000ad10: 6d65 6d6f 7279 686f 7470 6c75 6720 3d20  memoryhotplug = 
-0000ad20: 7072 6f66 696c 652e 6765 7428 276d 656d  profile.get('mem
-0000ad30: 6f72 7968 6f74 706c 7567 272c 2064 6566  oryhotplug', def
-0000ad40: 6175 6c74 5f6d 656d 6f72 7968 6f74 706c  ault_memoryhotpl
-0000ad50: 7567 290a 2020 2020 2020 2020 726f 6f74  ug).        root
-0000ad60: 7061 7373 776f 7264 203d 2070 726f 6669  password = profi
-0000ad70: 6c65 2e67 6574 2827 726f 6f74 7061 7373  le.get('rootpass
-0000ad80: 776f 7264 272c 2064 6566 6175 6c74 5f72  word', default_r
-0000ad90: 6f6f 7470 6173 7377 6f72 6429 0a20 2020  ootpassword).   
-0000ada0: 2020 2020 2076 6d75 7365 7220 3d20 7072       vmuser = pr
-0000adb0: 6f66 696c 652e 6765 7428 2776 6d75 7365  ofile.get('vmuse
-0000adc0: 7227 2c20 6465 6661 756c 745f 766d 7573  r', default_vmus
-0000add0: 6572 290a 2020 2020 2020 2020 7465 6d70  er).        temp
-0000ade0: 6b65 7920 3d20 7072 6f66 696c 652e 6765  key = profile.ge
-0000adf0: 7428 2774 656d 706b 6579 272c 2064 6566  t('tempkey', def
-0000ae00: 6175 6c74 5f74 656d 706b 6579 290a 2020  ault_tempkey).  
-0000ae10: 2020 2020 2020 7761 6974 203d 2070 726f        wait = pro
-0000ae20: 6669 6c65 2e67 6574 2827 7761 6974 272c  file.get('wait',
-0000ae30: 2064 6566 6175 6c74 5f77 6169 7429 0a20   default_wait). 
-0000ae40: 2020 2020 2020 2077 6169 7463 6f6d 6d61         waitcomma
-0000ae50: 6e64 203d 2070 726f 6669 6c65 2e67 6574  nd = profile.get
-0000ae60: 2827 7761 6974 636f 6d6d 616e 6427 2c20  ('waitcommand', 
-0000ae70: 6465 6661 756c 745f 7761 6974 636f 6d6d  default_waitcomm
-0000ae80: 616e 6429 0a20 2020 2020 2020 2069 6620  and).        if 
-0000ae90: 7761 6974 636f 6d6d 616e 6420 6973 206e  waitcommand is n
-0000aea0: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-0000aeb0: 2020 2020 2077 6169 7420 3d20 5472 7565       wait = True
-0000aec0: 0a20 2020 2020 2020 2077 6169 7474 696d  .        waittim
-0000aed0: 656f 7574 203d 2070 726f 6669 6c65 2e67  eout = profile.g
-0000aee0: 6574 2827 7761 6974 7469 6d65 6f75 7427  et('waittimeout'
-0000aef0: 2c20 6465 6661 756c 745f 7761 6974 7469  , default_waitti
-0000af00: 6d65 6f75 7429 0a20 2020 2020 2020 2076  meout).        v
-0000af10: 6972 7474 7970 6520 3d20 7072 6f66 696c  irttype = profil
-0000af20: 652e 6765 7428 2776 6972 7474 7970 6527  e.get('virttype'
-0000af30: 2c20 6465 6661 756c 745f 7669 7274 7479  , default_virtty
-0000af40: 7065 290a 2020 2020 2020 2020 6f76 6572  pe).        over
-0000af50: 7269 6465 732e 7570 6461 7465 2870 726f  rides.update(pro
-0000af60: 6669 6c65 290a 2020 2020 2020 2020 7363  file).        sc
-0000af70: 7269 7074 636d 6473 203d 205b 5d0a 2020  riptcmds = [].  
-0000af80: 2020 2020 2020 6966 2069 6d61 6765 2069        if image i
-0000af90: 7320 6e6f 7420 4e6f 6e65 2061 6e64 2027  s not None and '
-0000afa0: 7268 656c 2720 696e 2069 6d61 6765 2e6c  rhel' in image.l
-0000afb0: 6f77 6572 2829 3a0a 2020 2020 2020 2020  ower():.        
-0000afc0: 2020 2020 6966 2072 686e 7265 6769 7374      if rhnregist
-0000afd0: 6572 3a0a 2020 2020 2020 2020 2020 2020  er:.            
-0000afe0: 2020 2020 6966 2072 686e 7573 6572 2069      if rhnuser i
-0000aff0: 7320 6e6f 7420 4e6f 6e65 2061 6e64 2072  s not None and r
-0000b000: 686e 7061 7373 776f 7264 2069 7320 6e6f  hnpassword is no
-0000b010: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-0000b020: 2020 2020 2020 2020 2020 2020 6f76 6572              over
-0000b030: 7269 6465 735b 2772 686e 7573 6572 275d  rides['rhnuser']
-0000b040: 203d 2072 686e 7573 6572 0a20 2020 2020   = rhnuser.     
-0000b050: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-0000b060: 7665 7272 6964 6573 5b27 7268 6e70 6173  verrides['rhnpas
-0000b070: 7377 6f72 6427 5d20 3d20 7268 6e70 6173  sword'] = rhnpas
-0000b080: 7377 6f72 640a 2020 2020 2020 2020 2020  sword.          
-0000b090: 2020 2020 2020 656c 6966 2072 686e 616b        elif rhnak
-0000b0a0: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
-0000b0b0: 2072 686e 6f72 6720 6973 206e 6f74 204e   rhnorg is not N
-0000b0c0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-0000b0d0: 2020 2020 2020 2020 206f 7665 7272 6964           overrid
-0000b0e0: 6573 5b27 7268 6e61 6374 6976 6174 696f  es['rhnactivatio
-0000b0f0: 6e6b 6579 275d 203d 2072 686e 616b 0a20  nkey'] = rhnak. 
-0000b100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b110: 2020 206f 7665 7272 6964 6573 5b27 7268     overrides['rh
-0000b120: 6e6f 7267 275d 203d 2072 686e 6f72 670a  norg'] = rhnorg.
-0000b130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b140: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0000b150: 2020 2020 2020 2020 2020 6d73 6720 3d20            msg = 
-0000b160: 2252 686e 2072 6567 6973 7472 6174 696f  "Rhn registratio
-0000b170: 6e20 7265 7175 6972 6564 2062 7574 206d  n required but m
-0000b180: 6973 7369 6e67 2063 7265 6465 6e74 6961  issing credentia
-0000b190: 6c73 2e20 220a 2020 2020 2020 2020 2020  ls. ".          
-0000b1a0: 2020 2020 2020 2020 2020 6d73 6720 2b3d            msg +=
-0000b1b0: 2022 4465 6669 6e65 2072 686e 7573 6572   "Define rhnuser
-0000b1c0: 2f72 686e 7061 7373 776f 7264 206f 7220  /rhnpassword or 
-0000b1d0: 7268 6e61 6374 6976 6174 696f 6e6b 6579  rhnactivationkey
-0000b1e0: 2f72 686e 6f72 6722 0a20 2020 2020 2020  /rhnorg".       
-0000b1f0: 2020 2020 2020 2020 2020 2020 2077 6172               war
-0000b200: 6e69 6e67 286d 7367 290a 2020 2020 2020  ning(msg).      
-0000b210: 2020 2020 2020 2020 2020 2020 2020 7268                rh
-0000b220: 6e72 6567 6973 7465 7220 3d20 4661 6c73  nregister = Fals
-0000b230: 650a 2020 2020 2020 2020 2020 2020 656c  e.            el
-0000b240: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0000b250: 2020 2020 7761 726e 696e 6728 6622 7b6e      warning(f"{n
-0000b260: 616d 657d 2077 696c 6c20 7265 7175 6972  ame} will requir
-0000b270: 6520 6d61 6e75 616c 2073 7562 7363 7269  e manual subscri
-0000b280: 7074 696f 6e20 746f 2052 6564 2048 6174  ption to Red Hat
-0000b290: 204e 6574 776f 726b 2229 0a20 2020 2020   Network").     
-0000b2a0: 2020 2069 6620 696d 6167 6520 6973 206e     if image is n
-0000b2b0: 6f74 204e 6f6e 6520 616e 6420 636c 6f75  ot None and clou
-0000b2c0: 6469 6e69 7420 616e 6420 6973 6f20 6973  dinit and iso is
-0000b2d0: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-0000b2e0: 2020 2020 2020 2077 6172 6e69 6e67 2866         warning(f
-0000b2f0: 2249 676e 6f72 696e 6720 6973 6f20 7b69  "Ignoring iso {i
-0000b300: 736f 7d20 6173 2069 6d61 6765 207b 696d  so} as image {im
-0000b310: 6167 657d 2069 7320 7365 7422 290a 2020  age} is set").  
-0000b320: 2020 2020 2020 6966 2073 6372 6970 7473        if scripts
-0000b330: 3a0a 2020 2020 2020 2020 2020 2020 666f  :.            fo
-0000b340: 7220 7363 7269 7074 2069 6e20 7363 7269  r script in scri
-0000b350: 7074 733a 0a20 2020 2020 2020 2020 2020  pts:.           
-0000b360: 2020 2020 2069 6620 6f6e 666c 7920 6973       if onfly is
-0000b370: 206e 6f74 204e 6f6e 6520 616e 6420 277e   not None and '~
-0000b380: 2720 6e6f 7420 696e 2073 6372 6970 743a  ' not in script:
+0000ad10: 726f 6f74 7061 7373 776f 7264 203d 2070  rootpassword = p
+0000ad20: 726f 6669 6c65 2e67 6574 2827 726f 6f74  rofile.get('root
+0000ad30: 7061 7373 776f 7264 272c 2064 6566 6175  password', defau
+0000ad40: 6c74 5f72 6f6f 7470 6173 7377 6f72 6429  lt_rootpassword)
+0000ad50: 0a20 2020 2020 2020 2076 6d75 7365 7220  .        vmuser 
+0000ad60: 3d20 7072 6f66 696c 652e 6765 7428 2776  = profile.get('v
+0000ad70: 6d75 7365 7227 2c20 6465 6661 756c 745f  muser', default_
+0000ad80: 766d 7573 6572 290a 2020 2020 2020 2020  vmuser).        
+0000ad90: 7465 6d70 6b65 7920 3d20 7072 6f66 696c  tempkey = profil
+0000ada0: 652e 6765 7428 2774 656d 706b 6579 272c  e.get('tempkey',
+0000adb0: 2064 6566 6175 6c74 5f74 656d 706b 6579   default_tempkey
+0000adc0: 290a 2020 2020 2020 2020 7761 6974 203d  ).        wait =
+0000add0: 2070 726f 6669 6c65 2e67 6574 2827 7761   profile.get('wa
+0000ade0: 6974 272c 2064 6566 6175 6c74 5f77 6169  it', default_wai
+0000adf0: 7429 0a20 2020 2020 2020 2077 6169 7463  t).        waitc
+0000ae00: 6f6d 6d61 6e64 203d 2070 726f 6669 6c65  ommand = profile
+0000ae10: 2e67 6574 2827 7761 6974 636f 6d6d 616e  .get('waitcomman
+0000ae20: 6427 2c20 6465 6661 756c 745f 7761 6974  d', default_wait
+0000ae30: 636f 6d6d 616e 6429 0a20 2020 2020 2020  command).       
+0000ae40: 2069 6620 7761 6974 636f 6d6d 616e 6420   if waitcommand 
+0000ae50: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+0000ae60: 2020 2020 2020 2020 2077 6169 7420 3d20           wait = 
+0000ae70: 5472 7565 0a20 2020 2020 2020 2077 6169  True.        wai
+0000ae80: 7474 696d 656f 7574 203d 2070 726f 6669  ttimeout = profi
+0000ae90: 6c65 2e67 6574 2827 7761 6974 7469 6d65  le.get('waittime
+0000aea0: 6f75 7427 2c20 6465 6661 756c 745f 7761  out', default_wa
+0000aeb0: 6974 7469 6d65 6f75 7429 0a20 2020 2020  ittimeout).     
+0000aec0: 2020 2076 6972 7474 7970 6520 3d20 7072     virttype = pr
+0000aed0: 6f66 696c 652e 6765 7428 2776 6972 7474  ofile.get('virtt
+0000aee0: 7970 6527 2c20 6465 6661 756c 745f 7669  ype', default_vi
+0000aef0: 7274 7479 7065 290a 2020 2020 2020 2020  rttype).        
+0000af00: 6f76 6572 7269 6465 732e 7570 6461 7465  overrides.update
+0000af10: 2870 726f 6669 6c65 290a 2020 2020 2020  (profile).      
+0000af20: 2020 7363 7269 7074 636d 6473 203d 205b    scriptcmds = [
+0000af30: 5d0a 2020 2020 2020 2020 6966 2069 6d61  ].        if ima
+0000af40: 6765 2069 7320 6e6f 7420 4e6f 6e65 2061  ge is not None a
+0000af50: 6e64 2027 7268 656c 2720 696e 2069 6d61  nd 'rhel' in ima
+0000af60: 6765 2e6c 6f77 6572 2829 3a0a 2020 2020  ge.lower():.    
+0000af70: 2020 2020 2020 2020 6966 2072 686e 7265          if rhnre
+0000af80: 6769 7374 6572 3a0a 2020 2020 2020 2020  gister:.        
+0000af90: 2020 2020 2020 2020 6966 2072 686e 7573          if rhnus
+0000afa0: 6572 2069 7320 6e6f 7420 4e6f 6e65 2061  er is not None a
+0000afb0: 6e64 2072 686e 7061 7373 776f 7264 2069  nd rhnpassword i
+0000afc0: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+0000afd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000afe0: 6f76 6572 7269 6465 735b 2772 686e 7573  overrides['rhnus
+0000aff0: 6572 275d 203d 2072 686e 7573 6572 0a20  er'] = rhnuser. 
+0000b000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b010: 2020 206f 7665 7272 6964 6573 5b27 7268     overrides['rh
+0000b020: 6e70 6173 7377 6f72 6427 5d20 3d20 7268  npassword'] = rh
+0000b030: 6e70 6173 7377 6f72 640a 2020 2020 2020  npassword.      
+0000b040: 2020 2020 2020 2020 2020 656c 6966 2072            elif r
+0000b050: 686e 616b 2069 7320 6e6f 7420 4e6f 6e65  hnak is not None
+0000b060: 2061 6e64 2072 686e 6f72 6720 6973 206e   and rhnorg is n
+0000b070: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+0000b080: 2020 2020 2020 2020 2020 2020 206f 7665               ove
+0000b090: 7272 6964 6573 5b27 7268 6e61 6374 6976  rrides['rhnactiv
+0000b0a0: 6174 696f 6e6b 6579 275d 203d 2072 686e  ationkey'] = rhn
+0000b0b0: 616b 0a20 2020 2020 2020 2020 2020 2020  ak.             
+0000b0c0: 2020 2020 2020 206f 7665 7272 6964 6573         overrides
+0000b0d0: 5b27 7268 6e6f 7267 275d 203d 2072 686e  ['rhnorg'] = rhn
+0000b0e0: 6f72 670a 2020 2020 2020 2020 2020 2020  org.            
+0000b0f0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0000b100: 2020 2020 2020 2020 2020 2020 2020 6d73                ms
+0000b110: 6720 3d20 2252 686e 2072 6567 6973 7472  g = "Rhn registr
+0000b120: 6174 696f 6e20 7265 7175 6972 6564 2062  ation required b
+0000b130: 7574 206d 6973 7369 6e67 2063 7265 6465  ut missing crede
+0000b140: 6e74 6961 6c73 2e20 220a 2020 2020 2020  ntials. ".      
+0000b150: 2020 2020 2020 2020 2020 2020 2020 6d73                ms
+0000b160: 6720 2b3d 2022 4465 6669 6e65 2072 686e  g += "Define rhn
+0000b170: 7573 6572 2f72 686e 7061 7373 776f 7264  user/rhnpassword
+0000b180: 206f 7220 7268 6e61 6374 6976 6174 696f   or rhnactivatio
+0000b190: 6e6b 6579 2f72 686e 6f72 6722 0a20 2020  nkey/rhnorg".   
+0000b1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b1b0: 2077 6172 6e69 6e67 286d 7367 290a 2020   warning(msg).  
+0000b1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b1d0: 2020 7268 6e72 6567 6973 7465 7220 3d20    rhnregister = 
+0000b1e0: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
+0000b1f0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0000b200: 2020 2020 2020 2020 7761 726e 696e 6728          warning(
+0000b210: 6622 7b6e 616d 657d 2077 696c 6c20 7265  f"{name} will re
+0000b220: 7175 6972 6520 6d61 6e75 616c 2073 7562  quire manual sub
+0000b230: 7363 7269 7074 696f 6e20 746f 2052 6564  scription to Red
+0000b240: 2048 6174 204e 6574 776f 726b 2229 0a20   Hat Network"). 
+0000b250: 2020 2020 2020 2069 6620 696d 6167 6520         if image 
+0000b260: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
+0000b270: 636c 6f75 6469 6e69 7420 616e 6420 6973  cloudinit and is
+0000b280: 6f20 6973 206e 6f74 204e 6f6e 653a 0a20  o is not None:. 
+0000b290: 2020 2020 2020 2020 2020 2077 6172 6e69             warni
+0000b2a0: 6e67 2866 2249 676e 6f72 696e 6720 6973  ng(f"Ignoring is
+0000b2b0: 6f20 7b69 736f 7d20 6173 2069 6d61 6765  o {iso} as image
+0000b2c0: 207b 696d 6167 657d 2069 7320 7365 7422   {image} is set"
+0000b2d0: 290a 2020 2020 2020 2020 6966 2073 6372  ).        if scr
+0000b2e0: 6970 7473 3a0a 2020 2020 2020 2020 2020  ipts:.          
+0000b2f0: 2020 666f 7220 7363 7269 7074 2069 6e20    for script in 
+0000b300: 7363 7269 7074 733a 0a20 2020 2020 2020  scripts:.       
+0000b310: 2020 2020 2020 2020 2069 6620 6f6e 666c           if onfl
+0000b320: 7920 6973 206e 6f74 204e 6f6e 6520 616e  y is not None an
+0000b330: 6420 277e 2720 6e6f 7420 696e 2073 6372  d '~' not in scr
+0000b340: 6970 743a 0a20 2020 2020 2020 2020 2020  ipt:.           
+0000b350: 2020 2020 2020 2020 2064 6573 7464 6972           destdir
+0000b360: 203d 2062 6173 6564 6972 0a20 2020 2020   = basedir.     
+0000b370: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000b380: 6620 272f 2720 696e 2073 6372 6970 743a  f '/' in script:
 0000b390: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b3a0: 2020 2020 2064 6573 7464 6972 203d 2062       destdir = b
-0000b3b0: 6173 6564 6972 0a20 2020 2020 2020 2020  asedir.         
-0000b3c0: 2020 2020 2020 2020 2020 2069 6620 272f             if '/
-0000b3d0: 2720 696e 2073 6372 6970 743a 0a20 2020  ' in script:.   
-0000b3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b3f0: 2020 2020 2064 6573 7464 6972 203d 206f       destdir = o
-0000b400: 732e 7061 7468 2e64 6972 6e61 6d65 2873  s.path.dirname(s
-0000b410: 6372 6970 7429 0a20 2020 2020 2020 2020  cript).         
-0000b420: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-0000b430: 732e 6d61 6b65 6469 7273 2864 6573 7464  s.makedirs(destd
-0000b440: 6972 2c20 6578 6973 745f 6f6b 3d54 7275  ir, exist_ok=Tru
-0000b450: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-0000b460: 2020 2020 2020 2063 6f6d 6d6f 6e2e 6665         common.fe
-0000b470: 7463 6828 6622 7b6f 6e66 6c79 7d2f 7b73  tch(f"{onfly}/{s
-0000b480: 6372 6970 747d 222c 2064 6573 7464 6972  cript}", destdir
-0000b490: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000b4a0: 2020 7363 7269 7074 203d 206f 732e 7061    script = os.pa
-0000b4b0: 7468 2e65 7870 616e 6475 7365 7228 7363  th.expanduser(sc
-0000b4c0: 7269 7074 290a 2020 2020 2020 2020 2020  ript).          
-0000b4d0: 2020 2020 2020 6966 206f 732e 7061 7468        if os.path
-0000b4e0: 2e65 7869 7374 7328 7363 7269 7074 293a  .exists(script):
-0000b4f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b500: 2020 2020 2069 6620 6e6f 7420 6f73 2e70       if not os.p
-0000b510: 6174 682e 6973 6162 7328 7363 7269 7074  ath.isabs(script
-0000b520: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0000b530: 2020 2020 2020 2020 2020 2073 6372 6970             scrip
-0000b540: 7420 3d20 6f73 2e70 6174 682e 6162 7370  t = os.path.absp
-0000b550: 6174 6828 7363 7269 7074 290a 2020 2020  ath(script).    
-0000b560: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-0000b570: 2062 6173 6564 6972 2021 3d20 272e 273a   basedir != '.':
-0000b580: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b590: 2020 2020 2073 6372 6970 7420 3d20 6627       script = f'
-0000b5a0: 7b62 6173 6564 6972 7d2f 7b73 6372 6970  {basedir}/{scrip
-0000b5b0: 747d 270a 2020 2020 2020 2020 2020 2020  t}'.            
-0000b5c0: 2020 2020 6966 206e 6f74 206f 732e 7061      if not os.pa
-0000b5d0: 7468 2e65 7869 7374 7328 7363 7269 7074  th.exists(script
-0000b5e0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0000b5f0: 2020 2020 2020 2065 7272 6f72 2866 2253         error(f"S
-0000b600: 6372 6970 7420 6669 6c65 207b 7363 7269  cript file {scri
-0000b610: 7074 7d20 6e6f 7420 666f 756e 6422 290a  pt} not found").
-0000b620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b630: 2020 2020 7379 732e 6578 6974 2831 290a      sys.exit(1).
-0000b640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b650: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0000b660: 2020 2020 2020 2020 2020 7363 7269 7074            script
-0000b670: 6261 7365 6469 7220 3d20 6f73 2e70 6174  basedir = os.pat
-0000b680: 682e 6469 726e 616d 6528 7363 7269 7074  h.dirname(script
-0000b690: 2920 6966 206f 732e 7061 7468 2e64 6972  ) if os.path.dir
-0000b6a0: 6e61 6d65 2873 6372 6970 7429 2021 3d20  name(script) != 
-0000b6b0: 2727 2065 6c73 6520 272e 270a 2020 2020  '' else '.'.    
-0000b6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b6d0: 656e 7620 3d20 456e 7669 726f 6e6d 656e  env = Environmen
-0000b6e0: 7428 6c6f 6164 6572 3d46 696c 6553 7973  t(loader=FileSys
-0000b6f0: 7465 6d4c 6f61 6465 7228 7363 7269 7074  temLoader(script
-0000b700: 6261 7365 6469 7229 2c20 756e 6465 6669  basedir), undefi
-0000b710: 6e65 643d 756e 6465 6669 6e65 642c 0a20  ned=undefined,. 
-0000b720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b740: 2020 2020 2065 7874 656e 7369 6f6e 733d       extensions=
-0000b750: 5b27 6a69 6e6a 6132 2e65 7874 2e64 6f27  ['jinja2.ext.do'
-0000b760: 5d2c 2074 7269 6d5f 626c 6f63 6b73 3d54  ], trim_blocks=T
-0000b770: 7275 652c 206c 7374 7269 705f 626c 6f63  rue, lstrip_bloc
-0000b780: 6b73 3d54 7275 6529 0a20 2020 2020 2020  ks=True).       
-0000b790: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-0000b7a0: 206a 696e 6a61 6669 6c74 6572 2069 6e20   jinjafilter in 
-0000b7b0: 6a69 6e6a 6166 696c 7465 7273 2e6a 696e  jinjafilters.jin
-0000b7c0: 6a61 6669 6c74 6572 733a 0a20 2020 2020  jafilters:.     
-0000b7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b7e0: 2020 2065 6e76 2e66 696c 7465 7273 5b6a     env.filters[j
-0000b7f0: 696e 6a61 6669 6c74 6572 5d20 3d20 6a69  injafilter] = ji
-0000b800: 6e6a 6166 696c 7465 7273 2e6a 696e 6a61  njafilters.jinja
-0000b810: 6669 6c74 6572 735b 6a69 6e6a 6166 696c  filters[jinjafil
-0000b820: 7465 725d 0a20 2020 2020 2020 2020 2020  ter].           
-0000b830: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
+0000b3a0: 2020 2020 2020 2020 2064 6573 7464 6972           destdir
+0000b3b0: 203d 206f 732e 7061 7468 2e64 6972 6e61   = os.path.dirna
+0000b3c0: 6d65 2873 6372 6970 7429 0a20 2020 2020  me(script).     
+0000b3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b3e0: 2020 206f 732e 6d61 6b65 6469 7273 2864     os.makedirs(d
+0000b3f0: 6573 7464 6972 2c20 6578 6973 745f 6f6b  estdir, exist_ok
+0000b400: 3d54 7275 6529 0a20 2020 2020 2020 2020  =True).         
+0000b410: 2020 2020 2020 2020 2020 2063 6f6d 6d6f             commo
+0000b420: 6e2e 6665 7463 6828 6622 7b6f 6e66 6c79  n.fetch(f"{onfly
+0000b430: 7d2f 7b73 6372 6970 747d 222c 2064 6573  }/{script}", des
+0000b440: 7464 6972 290a 2020 2020 2020 2020 2020  tdir).          
+0000b450: 2020 2020 2020 7363 7269 7074 203d 206f        script = o
+0000b460: 732e 7061 7468 2e65 7870 616e 6475 7365  s.path.expanduse
+0000b470: 7228 7363 7269 7074 290a 2020 2020 2020  r(script).      
+0000b480: 2020 2020 2020 2020 2020 6966 206f 732e            if os.
+0000b490: 7061 7468 2e65 7869 7374 7328 7363 7269  path.exists(scri
+0000b4a0: 7074 293a 0a20 2020 2020 2020 2020 2020  pt):.           
+0000b4b0: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+0000b4c0: 6f73 2e70 6174 682e 6973 6162 7328 7363  os.path.isabs(sc
+0000b4d0: 7269 7074 293a 0a20 2020 2020 2020 2020  ript):.         
+0000b4e0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000b4f0: 6372 6970 7420 3d20 6f73 2e70 6174 682e  cript = os.path.
+0000b500: 6162 7370 6174 6828 7363 7269 7074 290a  abspath(script).
+0000b510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b520: 656c 6966 2062 6173 6564 6972 2021 3d20  elif basedir != 
+0000b530: 272e 273a 0a20 2020 2020 2020 2020 2020  '.':.           
+0000b540: 2020 2020 2020 2020 2073 6372 6970 7420           script 
+0000b550: 3d20 6627 7b62 6173 6564 6972 7d2f 7b73  = f'{basedir}/{s
+0000b560: 6372 6970 747d 270a 2020 2020 2020 2020  cript}'.        
+0000b570: 2020 2020 2020 2020 6966 206e 6f74 206f          if not o
+0000b580: 732e 7061 7468 2e65 7869 7374 7328 7363  s.path.exists(sc
+0000b590: 7269 7074 293a 0a20 2020 2020 2020 2020  ript):.         
+0000b5a0: 2020 2020 2020 2020 2020 2065 7272 6f72             error
+0000b5b0: 2866 2253 6372 6970 7420 6669 6c65 207b  (f"Script file {
+0000b5c0: 7363 7269 7074 7d20 6e6f 7420 666f 756e  script} not foun
+0000b5d0: 6422 290a 2020 2020 2020 2020 2020 2020  d").            
+0000b5e0: 2020 2020 2020 2020 7379 732e 6578 6974          sys.exit
+0000b5f0: 2831 290a 2020 2020 2020 2020 2020 2020  (1).            
+0000b600: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0000b610: 2020 2020 2020 2020 2020 2020 2020 7363                sc
+0000b620: 7269 7074 6261 7365 6469 7220 3d20 6f73  riptbasedir = os
+0000b630: 2e70 6174 682e 6469 726e 616d 6528 7363  .path.dirname(sc
+0000b640: 7269 7074 2920 6966 206f 732e 7061 7468  ript) if os.path
+0000b650: 2e64 6972 6e61 6d65 2873 6372 6970 7429  .dirname(script)
+0000b660: 2021 3d20 2727 2065 6c73 6520 272e 270a   != '' else '.'.
+0000b670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b680: 2020 2020 656e 7620 3d20 456e 7669 726f      env = Enviro
+0000b690: 6e6d 656e 7428 6c6f 6164 6572 3d46 696c  nment(loader=Fil
+0000b6a0: 6553 7973 7465 6d4c 6f61 6465 7228 7363  eSystemLoader(sc
+0000b6b0: 7269 7074 6261 7365 6469 7229 2c20 756e  riptbasedir), un
+0000b6c0: 6465 6669 6e65 643d 756e 6465 6669 6e65  defined=undefine
+0000b6d0: 642c 0a20 2020 2020 2020 2020 2020 2020  d,.             
+0000b6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b6f0: 2020 2020 2020 2020 2065 7874 656e 7369           extensi
+0000b700: 6f6e 733d 5b27 6a69 6e6a 6132 2e65 7874  ons=['jinja2.ext
+0000b710: 2e64 6f27 5d2c 2074 7269 6d5f 626c 6f63  .do'], trim_bloc
+0000b720: 6b73 3d54 7275 652c 206c 7374 7269 705f  ks=True, lstrip_
+0000b730: 626c 6f63 6b73 3d54 7275 6529 0a20 2020  blocks=True).   
+0000b740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b750: 2066 6f72 206a 696e 6a61 6669 6c74 6572   for jinjafilter
+0000b760: 2069 6e20 6a69 6e6a 6166 696c 7465 7273   in jinjafilters
+0000b770: 2e6a 696e 6a61 6669 6c74 6572 733a 0a20  .jinjafilters:. 
+0000b780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b790: 2020 2020 2020 2065 6e76 2e66 696c 7465         env.filte
+0000b7a0: 7273 5b6a 696e 6a61 6669 6c74 6572 5d20  rs[jinjafilter] 
+0000b7b0: 3d20 6a69 6e6a 6166 696c 7465 7273 2e6a  = jinjafilters.j
+0000b7c0: 696e 6a61 6669 6c74 6572 735b 6a69 6e6a  injafilters[jinj
+0000b7d0: 6166 696c 7465 725d 0a20 2020 2020 2020  afilter].       
+0000b7e0: 2020 2020 2020 2020 2020 2020 2074 7279               try
+0000b7f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000b800: 2020 2020 2020 2020 2020 7465 6d70 6c20            templ 
+0000b810: 3d20 656e 762e 6765 745f 7465 6d70 6c61  = env.get_templa
+0000b820: 7465 286f 732e 7061 7468 2e62 6173 656e  te(os.path.basen
+0000b830: 616d 6528 7363 7269 7074 2929 0a20 2020  ame(script)).   
 0000b840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b850: 2020 2020 2020 7465 6d70 6c20 3d20 656e        templ = en
-0000b860: 762e 6765 745f 7465 6d70 6c61 7465 286f  v.get_template(o
-0000b870: 732e 7061 7468 2e62 6173 656e 616d 6528  s.path.basename(
-0000b880: 7363 7269 7074 2929 0a20 2020 2020 2020  script)).       
-0000b890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b8a0: 2073 6372 6970 7465 6e74 7269 6573 203d   scriptentries =
-0000b8b0: 2074 656d 706c 2e72 656e 6465 7228 6f76   templ.render(ov
-0000b8c0: 6572 7269 6465 7329 0a20 2020 2020 2020  errides).       
-0000b8d0: 2020 2020 2020 2020 2020 2020 2065 7863               exc
-0000b8e0: 6570 7420 5465 6d70 6c61 7465 4e6f 7446  ept TemplateNotF
-0000b8f0: 6f75 6e64 3a0a 2020 2020 2020 2020 2020  ound:.          
-0000b900: 2020 2020 2020 2020 2020 2020 2020 6572                er
-0000b910: 726f 7228 6622 5363 7269 7074 2066 696c  ror(f"Script fil
-0000b920: 6520 7b6f 732e 7061 7468 2e62 6173 656e  e {os.path.basen
-0000b930: 616d 6528 7363 7269 7074 297d 206e 6f74  ame(script)} not
-0000b940: 2066 6f75 6e64 2229 0a20 2020 2020 2020   found").       
-0000b950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b960: 2073 7973 2e65 7869 7428 3129 0a20 2020   sys.exit(1).   
-0000b970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b980: 2065 7863 6570 7420 5465 6d70 6c61 7465   except Template
-0000b990: 5379 6e74 6178 4572 726f 7220 6173 2065  SyntaxError as e
-0000b9a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000b9b0: 2020 2020 2020 2020 2020 6d73 6720 3d20            msg = 
-0000b9c0: 6622 4572 726f 7220 7265 6e64 6572 696e  f"Error renderin
-0000b9d0: 6720 6c69 6e65 207b 652e 6c69 6e65 6e6f  g line {e.lineno
-0000b9e0: 7d20 6f66 2073 6372 6970 7420 6669 6c65  } of script file
-0000b9f0: 207b 652e 6669 6c65 6e61 6d65 7d2e 2047   {e.filename}. G
-0000ba00: 6f74 3a20 7b65 2e6d 6573 7361 6765 7d22  ot: {e.message}"
-0000ba10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ba20: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0000ba30: 7b27 7265 7375 6c74 273a 2027 6661 696c  {'result': 'fail
-0000ba40: 7572 6527 2c20 2772 6561 736f 6e27 3a20  ure', 'reason': 
-0000ba50: 6d73 677d 0a20 2020 2020 2020 2020 2020  msg}.           
-0000ba60: 2020 2020 2020 2020 2065 7863 6570 7420           except 
-0000ba70: 5465 6d70 6c61 7465 4572 726f 7220 6173  TemplateError as
-0000ba80: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
-0000ba90: 2020 2020 2020 2020 2020 2020 6d73 6720              msg 
-0000baa0: 3d20 6622 4572 726f 7220 7265 6e64 6572  = f"Error render
-0000bab0: 696e 6720 7363 7269 7074 2066 696c 6520  ing script file 
-0000bac0: 7b73 6372 6970 747d 2e20 476f 743a 207b  {script}. Got: {
-0000bad0: 652e 6d65 7373 6167 657d 220a 2020 2020  e.message}".    
-0000bae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000baf0: 2020 2020 7265 7475 726e 207b 2772 6573      return {'res
-0000bb00: 756c 7427 3a20 2766 6169 6c75 7265 272c  ult': 'failure',
-0000bb10: 2027 7265 6173 6f6e 273a 206d 7367 7d0a   'reason': msg}.
-0000bb20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bb30: 2020 2020 7363 7269 7074 6c69 6e65 7320      scriptlines 
-0000bb40: 3d20 5b6c 696e 652e 7374 7269 7028 2920  = [line.strip() 
-0000bb50: 666f 7220 6c69 6e65 2069 6e20 7363 7269  for line in scri
-0000bb60: 7074 656e 7472 6965 732e 7370 6c69 7428  ptentries.split(
-0000bb70: 275c 6e27 2920 6966 206c 696e 652e 7374  '\n') if line.st
-0000bb80: 7269 7028 2920 213d 2027 275d 0a20 2020  rip() != ''].   
-0000bb90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bba0: 2069 6620 7363 7269 7074 6c69 6e65 733a   if scriptlines:
-0000bbb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000bbc0: 2020 2020 2020 2020 2073 6372 6970 746c           scriptl
-0000bbd0: 696e 6573 2e69 6e73 6572 7428 302c 2066  ines.insert(0, f
-0000bbe0: 2265 6368 6f20 5275 6e6e 696e 6720 7363  "echo Running sc
-0000bbf0: 7269 7074 207b 6f73 2e70 6174 682e 6261  ript {os.path.ba
-0000bc00: 7365 6e61 6d65 2873 6372 6970 7429 7d22  sename(script)}"
-0000bc10: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000bc20: 2020 2020 2020 2020 2020 7363 7269 7074            script
-0000bc30: 636d 6473 2e65 7874 656e 6428 7363 7269  cmds.extend(scri
-0000bc40: 7074 6c69 6e65 7329 0a20 2020 2020 2020  ptlines).       
-0000bc50: 2069 6620 636c 6f75 6469 6e69 7420 616e   if cloudinit an
-0000bc60: 6420 696d 6167 6520 6973 206e 6f74 204e  d image is not N
-0000bc70: 6f6e 6520 616e 6420 2772 6865 6c27 2069  one and 'rhel' i
-0000bc80: 6e20 696d 6167 652e 6c6f 7765 7228 293a  n image.lower():
-0000bc90: 0a20 2020 2020 2020 2020 2020 2072 686e  .            rhn
-0000bca0: 636f 6d6d 616e 6473 203d 205b 5d0a 2020  commands = [].  
-0000bcb0: 2020 2020 2020 2020 2020 6966 2072 686e            if rhn
-0000bcc0: 7365 7276 6572 2021 3d20 2268 7474 7073  server != "https
-0000bcd0: 3a2f 2f73 7562 7363 7269 7074 696f 6e2e  ://subscription.
-0000bce0: 7268 736d 2e72 6564 6861 742e 636f 6d22  rhsm.redhat.com"
-0000bcf0: 2061 6e64 206e 6f74 2076 616c 6964 5f69   and not valid_i
-0000bd00: 7028 7268 6e73 6572 7665 7229 3a0a 2020  p(rhnserver):.  
-0000bd10: 2020 2020 2020 2020 2020 2020 2020 6671                fq
-0000bd20: 646e 203d 206f 732e 7061 7468 2e62 6173  dn = os.path.bas
-0000bd30: 656e 616d 6528 7268 6e73 6572 7665 7229  ename(rhnserver)
-0000bd40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000bd50: 2072 686e 636f 6d6d 616e 6473 2e61 7070   rhncommands.app
-0000bd60: 656e 6428 6627 7270 6d20 2d55 7668 2068  end(f'rpm -Uvh h
-0000bd70: 7474 703a 2f2f 7b66 7164 6e7d 2f70 7562  ttp://{fqdn}/pub
-0000bd80: 2f6b 6174 656c 6c6f 2d63 612d 636f 6e73  /katello-ca-cons
-0000bd90: 756d 6572 2d6c 6174 6573 742e 6e6f 6172  umer-latest.noar
-0000bda0: 6368 2e72 706d 2729 0a20 2020 2020 2020  ch.rpm').       
-0000bdb0: 2020 2020 2069 6620 7268 6e61 6b20 6973       if rhnak is
-0000bdc0: 206e 6f74 204e 6f6e 6520 616e 6420 7268   not None and rh
-0000bdd0: 6e6f 7267 2069 7320 6e6f 7420 4e6f 6e65  norg is not None
-0000bde0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000bdf0: 2020 7268 6e63 6f6d 6d61 6e64 732e 6170    rhncommands.ap
-0000be00: 7065 6e64 2827 7375 6273 6372 6970 7469  pend('subscripti
-0000be10: 6f6e 2d6d 616e 6167 6572 2072 6567 6973  on-manager regis
-0000be20: 7465 7220 2d2d 7365 7276 6572 7572 6c3d  ter --serverurl=
-0000be30: 2573 202d 2d66 6f72 6365 202d 2d61 6374  %s --force --act
-0000be40: 6976 6174 696f 6e6b 6579 3d25 7320 2d2d  ivationkey=%s --
-0000be50: 6f72 673d 2573 270a 2020 2020 2020 2020  org=%s'.        
-0000be60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000be70: 2020 2020 2020 2020 2020 2025 2028 7268             % (rh
-0000be80: 6e73 6572 7665 722c 2072 686e 616b 2c20  nserver, rhnak, 
-0000be90: 7268 6e6f 7267 2929 0a20 2020 2020 2020  rhnorg)).       
-0000bea0: 2020 2020 2020 2020 2069 6620 696d 6167           if imag
-0000beb0: 652e 7374 6172 7473 7769 7468 2827 7268  e.startswith('rh
-0000bec0: 656c 2d38 2729 206f 7220 696d 6167 6520  el-8') or image 
-0000bed0: 3d3d 2027 7268 656c 3827 3a0a 2020 2020  == 'rhel8':.    
-0000bee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bef0: 7268 6e63 6f6d 6d61 6e64 732e 6170 7065  rhncommands.appe
-0000bf00: 6e64 2827 7375 6273 6372 6970 7469 6f6e  nd('subscription
-0000bf10: 2d6d 616e 6167 6572 2072 6570 6f73 202d  -manager repos -
-0000bf20: 2d65 6e61 626c 653d 7268 656c 2d38 2d66  -enable=rhel-8-f
-0000bf30: 6f72 2d78 3836 5f36 342d 6261 7365 6f73  or-x86_64-baseos
-0000bf40: 2d72 706d 7327 290a 2020 2020 2020 2020  -rpms').        
-0000bf50: 2020 2020 2020 2020 656c 6966 2069 6d61          elif ima
-0000bf60: 6765 2e73 7461 7274 7377 6974 6828 2772  ge.startswith('r
-0000bf70: 6865 6c2d 7365 7276 6572 2d37 2729 206f  hel-server-7') o
-0000bf80: 7220 696d 6167 6520 3d3d 2027 7268 656c  r image == 'rhel
-0000bf90: 3727 3a0a 2020 2020 2020 2020 2020 2020  7':.            
-0000bfa0: 2020 2020 2020 2020 7268 6e63 6f6d 6d61          rhncomma
-0000bfb0: 6e64 732e 6170 7065 6e64 2827 7375 6273  nds.append('subs
-0000bfc0: 6372 6970 7469 6f6e 2d6d 616e 6167 6572  cription-manager
-0000bfd0: 2072 6570 6f73 202d 2d65 6e61 626c 653d   repos --enable=
-0000bfe0: 7268 656c 2d37 2d73 6572 7665 722d 7270  rhel-7-server-rp
-0000bff0: 6d73 2729 0a20 2020 2020 2020 2020 2020  ms').           
-0000c000: 2065 6c69 6620 7268 6e75 7365 7220 6973   elif rhnuser is
-0000c010: 206e 6f74 204e 6f6e 6520 616e 6420 7268   not None and rh
-0000c020: 6e70 6173 7377 6f72 6420 6973 206e 6f74  npassword is not
-0000c030: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-0000c040: 2020 2020 2020 2072 686e 636f 6d6d 616e         rhncomman
-0000c050: 6473 2e61 7070 656e 6428 2773 7562 7363  ds.append('subsc
-0000c060: 7269 7074 696f 6e2d 6d61 6e61 6765 7220  ription-manager 
-0000c070: 7265 6769 7374 6572 202d 2d73 6572 7665  register --serve
-0000c080: 7275 726c 3d25 7320 2d2d 666f 7263 6520  rurl=%s --force 
-0000c090: 2d2d 7573 6572 6e61 6d65 3d25 7320 2d2d  --username=%s --
-0000c0a0: 7061 7373 776f 7264 3d25 7327 0a20 2020  password=%s'.   
-0000c0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c0d0: 2520 2872 686e 7365 7276 6572 2c20 7268  % (rhnserver, rh
-0000c0e0: 6e75 7365 722c 2072 686e 7061 7373 776f  nuser, rhnpasswo
-0000c0f0: 7264 2929 0a20 2020 2020 2020 2020 2020  rd)).           
-0000c100: 2020 2020 2069 6620 7268 6e70 6f6f 6c20       if rhnpool 
-0000c110: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-0000c120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c130: 2072 686e 636f 6d6d 616e 6473 2e61 7070   rhncommands.app
-0000c140: 656e 6428 6627 7375 6273 6372 6970 7469  end(f'subscripti
-0000c150: 6f6e 2d6d 616e 6167 6572 2061 7474 6163  on-manager attac
-0000c160: 6820 2d2d 706f 6f6c 3d7b 7268 6e70 6f6f  h --pool={rhnpoo
-0000c170: 6c7d 2729 0a20 2020 2020 2020 2020 2020  l}').           
-0000c180: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0000c190: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0000c1a0: 686e 636f 6d6d 616e 6473 2e61 7070 656e  hncommands.appen
-0000c1b0: 6428 2773 7562 7363 7269 7074 696f 6e2d  d('subscription-
-0000c1c0: 6d61 6e61 6765 7220 6174 7461 6368 202d  manager attach -
-0000c1d0: 2d61 7574 6f27 290a 2020 2020 2020 2020  -auto').        
-0000c1e0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0000c1f0: 2020 7268 6e63 6f6d 6d61 6e64 7320 3d20    rhncommands = 
-0000c200: 5b5d 0a20 2020 2020 2020 2073 6861 7265  [].        share
-0000c210: 6466 6f6c 6465 7263 6d64 7320 3d20 5b5d  dfoldercmds = []
-0000c220: 0a20 2020 2020 2020 2069 6620 7368 6172  .        if shar
-0000c230: 6564 666f 6c64 6572 7320 616e 6420 7365  edfolders and se
-0000c240: 6c66 2e74 7970 6520 3d3d 2027 6b76 6d27  lf.type == 'kvm'
-0000c250: 3a0a 2020 2020 2020 2020 2020 2020 666f  :.            fo
-0000c260: 7220 7368 6172 6564 666f 6c64 6572 2069  r sharedfolder i
-0000c270: 6e20 7368 6172 6564 666f 6c64 6572 733a  n sharedfolders:
-0000c280: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c290: 2062 6173 6566 6f6c 6465 7220 3d20 6f73   basefolder = os
-0000c2a0: 2e70 6174 682e 6261 7365 6e61 6d65 2873  .path.basename(s
-0000c2b0: 6861 7265 6466 6f6c 6465 7229 0a20 2020  haredfolder).   
-0000c2c0: 2020 2020 2020 2020 2020 2020 2063 6d64               cmd
-0000c2d0: 3120 3d20 6622 6d6b 6469 7220 2d70 202f  1 = f"mkdir -p /
-0000c2e0: 6d6e 742f 7b73 6861 7265 6466 6f6c 6465  mnt/{sharedfolde
-0000c2f0: 727d 220a 2020 2020 2020 2020 2020 2020  r}".            
-0000c300: 2020 2020 636d 6432 203d 2066 2265 6368      cmd2 = f"ech
-0000c310: 6f20 7b62 6173 6566 6f6c 6465 727d 202f  o {basefolder} /
-0000c320: 6d6e 742f 7b73 6861 7265 6466 6f6c 6465  mnt/{sharedfolde
-0000c330: 727d 2039 7020 7472 616e 733d 7669 7274  r} 9p trans=virt
-0000c340: 696f 2c76 6572 7369 6f6e 3d39 7032 3030  io,version=9p200
-0000c350: 302e 4c2c 7277 2030 2030 203e 3e20 2f65  0.L,rw 0 0 >> /e
-0000c360: 7463 2f66 7374 6162 220a 2020 2020 2020  tc/fstab".      
-0000c370: 2020 2020 2020 2020 2020 7368 6172 6564            shared
-0000c380: 666f 6c64 6572 636d 6473 2e61 7070 656e  foldercmds.appen
-0000c390: 6428 636d 6431 290a 2020 2020 2020 2020  d(cmd1).        
-0000c3a0: 2020 2020 2020 2020 7368 6172 6564 666f          sharedfo
-0000c3b0: 6c64 6572 636d 6473 2e61 7070 656e 6428  ldercmds.append(
-0000c3c0: 636d 6432 290a 2020 2020 2020 2020 6966  cmd2).        if
-0000c3d0: 2073 6861 7265 6466 6f6c 6465 7263 6d64   sharedfoldercmd
-0000c3e0: 733a 0a20 2020 2020 2020 2020 2020 2073  s:.            s
-0000c3f0: 6861 7265 6466 6f6c 6465 7263 6d64 732e  haredfoldercmds.
-0000c400: 6170 7065 6e64 2822 6d6f 756e 7420 2d61  append("mount -a
-0000c410: 2229 0a20 2020 2020 2020 206e 6574 776f  ").        netwo
-0000c420: 726b 7761 6974 636f 6d6d 616e 6420 3d20  rkwaitcommand = 
-0000c430: 5b66 2773 6c65 6570 207b 6e65 7477 6f72  [f'sleep {networ
-0000c440: 6b77 6169 747d 275d 2069 6620 6e65 7477  kwait}'] if netw
-0000c450: 6f72 6b77 6169 7420 3e20 3020 656c 7365  orkwait > 0 else
-0000c460: 205b 5d0a 2020 2020 2020 2020 726f 6f74   [].        root
-0000c470: 636f 6d6d 616e 6420 3d20 5b66 2765 6368  command = [f'ech
-0000c480: 6f20 726f 6f74 3a7b 726f 6f74 7061 7373  o root:{rootpass
-0000c490: 776f 7264 7d20 7c20 6368 7061 7373 7764  word} | chpasswd
-0000c4a0: 275d 2069 6620 726f 6f74 7061 7373 776f  '] if rootpasswo
-0000c4b0: 7264 2069 7320 6e6f 7420 4e6f 6e65 2065  rd is not None e
-0000c4c0: 6c73 6520 5b5d 0a20 2020 2020 2020 2063  lse [].        c
-0000c4d0: 6d64 7320 3d20 726f 6f74 636f 6d6d 616e  mds = rootcomman
-0000c4e0: 6420 2b20 6e65 7477 6f72 6b77 6169 7463  d + networkwaitc
-0000c4f0: 6f6d 6d61 6e64 202b 2072 686e 636f 6d6d  ommand + rhncomm
-0000c500: 616e 6473 202b 2073 6861 7265 6466 6f6c  ands + sharedfol
-0000c510: 6465 7263 6d64 7320 2b20 636d 6473 202b  dercmds + cmds +
-0000c520: 2073 6372 6970 7463 6d64 730a 2020 2020   scriptcmds.    
-0000c530: 2020 2020 6966 206e 6f74 6966 7920 616e      if notify an
-0000c540: 6420 696d 6167 6520 6973 206e 6f74 204e  d image is not N
-0000c550: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-0000c560: 2069 6620 6e6f 7469 6679 636d 6420 6973   if notifycmd is
-0000c570: 204e 6f6e 6520 616e 6420 6e6f 7469 6679   None and notify
-0000c580: 7363 7269 7074 2069 7320 4e6f 6e65 3a0a  script is None:.
-0000c590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c5a0: 6966 2027 636f 7327 2069 6e20 696d 6167  if 'cos' in imag
-0000c5b0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0000c5c0: 2020 2020 2020 206e 6f74 6966 7963 6d64         notifycmd
-0000c5d0: 203d 2027 6a6f 7572 6e61 6c63 746c 202d   = 'journalctl -
-0000c5e0: 2d69 6465 6e74 6966 6965 723d 6967 6e69  -identifier=igni
-0000c5f0: 7469 6f6e 202d 2d61 6c6c 202d 2d6e 6f2d  tion --all --no-
-0000c600: 7061 6765 7227 0a20 2020 2020 2020 2020  pager'.         
-0000c610: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0000c620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c630: 2063 6c6f 7564 696e 6974 6669 6c65 203d   cloudinitfile =
-0000c640: 2063 6f6d 6d6f 6e2e 6765 745f 636c 6f75   common.get_clou
-0000c650: 6469 6e69 7466 696c 6528 696d 6167 6529  dinitfile(image)
-0000c660: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c670: 2020 2020 206e 6f74 6966 7963 6d64 203d       notifycmd =
-0000c680: 2022 7461 696c 202d 3130 3020 2573 2220   "tail -100 %s" 
-0000c690: 2520 636c 6f75 6469 6e69 7466 696c 650a  % cloudinitfile.
-0000c6a0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-0000c6b0: 6f74 6966 7973 6372 6970 7420 6973 206e  otifyscript is n
-0000c6c0: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-0000c6d0: 2020 2020 2020 2020 206e 6f74 6966 7973           notifys
-0000c6e0: 6372 6970 7420 3d20 6f73 2e70 6174 682e  cript = os.path.
-0000c6f0: 6578 7061 6e64 7573 6572 286e 6f74 6966  expanduser(notif
-0000c700: 7973 6372 6970 7429 0a20 2020 2020 2020  yscript).       
-0000c710: 2020 2020 2020 2020 2069 6620 6261 7365           if base
-0000c720: 6469 7220 213d 2027 2e27 3a0a 2020 2020  dir != '.':.    
-0000c730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c740: 6e6f 7469 6679 7363 7269 7074 203d 2066  notifyscript = f
-0000c750: 277b 6261 7365 6469 727d 2f7b 6e6f 7469  '{basedir}/{noti
-0000c760: 6679 7363 7269 7074 7d27 0a20 2020 2020  fyscript}'.     
-0000c770: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-0000c780: 7420 6f73 2e70 6174 682e 6578 6973 7473  t os.path.exists
-0000c790: 286e 6f74 6966 7973 6372 6970 7429 3a0a  (notifyscript):.
-0000c7a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c7b0: 2020 2020 6e6f 7469 6679 636d 6420 3d20      notifycmd = 
-0000c7c0: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-0000c7d0: 2020 2020 2020 2020 206e 6f74 6966 7973           notifys
-0000c7e0: 6372 6970 7420 3d20 4e6f 6e65 0a20 2020  cript = None.   
-0000c7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c800: 2077 6172 6e69 6e67 2866 224e 6f74 6966   warning(f"Notif
-0000c810: 6963 6174 696f 6e20 7265 7175 6972 6564  ication required
-0000c820: 2066 6f72 207b 6e61 6d65 7d20 6275 7420   for {name} but 
-0000c830: 6d69 7373 696e 6720 6e6f 7469 6679 7363  missing notifysc
-0000c840: 7269 7074 2229 0a20 2020 2020 2020 2020  ript").         
-0000c850: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0000c860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c870: 2066 696c 6573 2e61 7070 656e 6428 7b27   files.append({'
-0000c880: 7061 7468 273a 2027 2f72 6f6f 742f 2e6e  path': '/root/.n
-0000c890: 6f74 6966 792e 7368 272c 2027 6f72 6967  otify.sh', 'orig
-0000c8a0: 696e 273a 206e 6f74 6966 7973 6372 6970  in': notifyscrip
-0000c8b0: 747d 290a 2020 2020 2020 2020 2020 2020  t}).            
-0000c8c0: 2020 2020 2020 2020 6e6f 7469 6679 636d          notifycm
-0000c8d0: 6420 3d20 2262 6173 6820 2f72 6f6f 742f  d = "bash /root/
-0000c8e0: 2e6e 6f74 6966 792e 7368 220a 2020 2020  .notify.sh".    
-0000c8f0: 2020 2020 2020 2020 6e6f 7469 6679 636d          notifycm
-0000c900: 6473 2c20 6d61 696c 636f 6e74 656e 7420  ds, mailcontent 
-0000c910: 3d20 7365 6c66 2e68 616e 646c 655f 6e6f  = self.handle_no
-0000c920: 7469 6669 6361 7469 6f6e 7328 6e61 6d65  tifications(name
-0000c930: 2c20 6e6f 7469 6679 6d65 7468 6f64 733d  , notifymethods=
-0000c940: 6e6f 7469 6679 6d65 7468 6f64 732c 0a20  notifymethods,. 
-0000c950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b850: 2020 2020 2073 6372 6970 7465 6e74 7269       scriptentri
+0000b860: 6573 203d 2074 656d 706c 2e72 656e 6465  es = templ.rende
+0000b870: 7228 6f76 6572 7269 6465 7329 0a20 2020  r(overrides).   
+0000b880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b890: 2065 7863 6570 7420 5465 6d70 6c61 7465   except Template
+0000b8a0: 4e6f 7446 6f75 6e64 3a0a 2020 2020 2020  NotFound:.      
+0000b8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b8c0: 2020 6572 726f 7228 6622 5363 7269 7074    error(f"Script
+0000b8d0: 2066 696c 6520 7b6f 732e 7061 7468 2e62   file {os.path.b
+0000b8e0: 6173 656e 616d 6528 7363 7269 7074 297d  asename(script)}
+0000b8f0: 206e 6f74 2066 6f75 6e64 2229 0a20 2020   not found").   
+0000b900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b910: 2020 2020 2073 7973 2e65 7869 7428 3129       sys.exit(1)
+0000b920: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000b930: 2020 2020 2065 7863 6570 7420 5465 6d70       except Temp
+0000b940: 6c61 7465 5379 6e74 6178 4572 726f 7220  lateSyntaxError 
+0000b950: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
+0000b960: 2020 2020 2020 2020 2020 2020 2020 6d73                ms
+0000b970: 6720 3d20 6622 4572 726f 7220 7265 6e64  g = f"Error rend
+0000b980: 6572 696e 6720 6c69 6e65 207b 652e 6c69  ering line {e.li
+0000b990: 6e65 6e6f 7d20 6f66 2073 6372 6970 7420  neno} of script 
+0000b9a0: 6669 6c65 207b 652e 6669 6c65 6e61 6d65  file {e.filename
+0000b9b0: 7d2e 2047 6f74 3a20 7b65 2e6d 6573 7361  }. Got: {e.messa
+0000b9c0: 6765 7d22 0a20 2020 2020 2020 2020 2020  ge}".           
+0000b9d0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+0000b9e0: 7572 6e20 7b27 7265 7375 6c74 273a 2027  urn {'result': '
+0000b9f0: 6661 696c 7572 6527 2c20 2772 6561 736f  failure', 'reaso
+0000ba00: 6e27 3a20 6d73 677d 0a20 2020 2020 2020  n': msg}.       
+0000ba10: 2020 2020 2020 2020 2020 2020 2065 7863               exc
+0000ba20: 6570 7420 5465 6d70 6c61 7465 4572 726f  ept TemplateErro
+0000ba30: 7220 6173 2065 3a0a 2020 2020 2020 2020  r as e:.        
+0000ba40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ba50: 6d73 6720 3d20 6622 4572 726f 7220 7265  msg = f"Error re
+0000ba60: 6e64 6572 696e 6720 7363 7269 7074 2066  ndering script f
+0000ba70: 696c 6520 7b73 6372 6970 747d 2e20 476f  ile {script}. Go
+0000ba80: 743a 207b 652e 6d65 7373 6167 657d 220a  t: {e.message}".
+0000ba90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000baa0: 2020 2020 2020 2020 7265 7475 726e 207b          return {
+0000bab0: 2772 6573 756c 7427 3a20 2766 6169 6c75  'result': 'failu
+0000bac0: 7265 272c 2027 7265 6173 6f6e 273a 206d  re', 'reason': m
+0000bad0: 7367 7d0a 2020 2020 2020 2020 2020 2020  sg}.            
+0000bae0: 2020 2020 2020 2020 7363 7269 7074 6c69          scriptli
+0000baf0: 6e65 7320 3d20 5b6c 696e 652e 7374 7269  nes = [line.stri
+0000bb00: 7028 2920 666f 7220 6c69 6e65 2069 6e20  p() for line in 
+0000bb10: 7363 7269 7074 656e 7472 6965 732e 7370  scriptentries.sp
+0000bb20: 6c69 7428 275c 6e27 2920 6966 206c 696e  lit('\n') if lin
+0000bb30: 652e 7374 7269 7028 2920 213d 2027 275d  e.strip() != '']
+0000bb40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000bb50: 2020 2020 2069 6620 7363 7269 7074 6c69       if scriptli
+0000bb60: 6e65 733a 0a20 2020 2020 2020 2020 2020  nes:.           
+0000bb70: 2020 2020 2020 2020 2020 2020 2073 6372               scr
+0000bb80: 6970 746c 696e 6573 2e69 6e73 6572 7428  iptlines.insert(
+0000bb90: 302c 2066 2265 6368 6f20 5275 6e6e 696e  0, f"echo Runnin
+0000bba0: 6720 7363 7269 7074 207b 6f73 2e70 6174  g script {os.pat
+0000bbb0: 682e 6261 7365 6e61 6d65 2873 6372 6970  h.basename(scrip
+0000bbc0: 7429 7d22 290a 2020 2020 2020 2020 2020  t)}").          
+0000bbd0: 2020 2020 2020 2020 2020 2020 2020 7363                sc
+0000bbe0: 7269 7074 636d 6473 2e65 7874 656e 6428  riptcmds.extend(
+0000bbf0: 7363 7269 7074 6c69 6e65 7329 0a20 2020  scriptlines).   
+0000bc00: 2020 2020 2069 6620 636c 6f75 6469 6e69       if cloudini
+0000bc10: 7420 616e 6420 696d 6167 6520 6973 206e  t and image is n
+0000bc20: 6f74 204e 6f6e 6520 616e 6420 2772 6865  ot None and 'rhe
+0000bc30: 6c27 2069 6e20 696d 6167 652e 6c6f 7765  l' in image.lowe
+0000bc40: 7228 293a 0a20 2020 2020 2020 2020 2020  r():.           
+0000bc50: 2072 686e 636f 6d6d 616e 6473 203d 205b   rhncommands = [
+0000bc60: 5d0a 2020 2020 2020 2020 2020 2020 6966  ].            if
+0000bc70: 2072 686e 7365 7276 6572 2021 3d20 2268   rhnserver != "h
+0000bc80: 7474 7073 3a2f 2f73 7562 7363 7269 7074  ttps://subscript
+0000bc90: 696f 6e2e 7268 736d 2e72 6564 6861 742e  ion.rhsm.redhat.
+0000bca0: 636f 6d22 2061 6e64 206e 6f74 2076 616c  com" and not val
+0000bcb0: 6964 5f69 7028 7268 6e73 6572 7665 7229  id_ip(rhnserver)
+0000bcc0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000bcd0: 2020 6671 646e 203d 206f 732e 7061 7468    fqdn = os.path
+0000bce0: 2e62 6173 656e 616d 6528 7268 6e73 6572  .basename(rhnser
+0000bcf0: 7665 7229 0a20 2020 2020 2020 2020 2020  ver).           
+0000bd00: 2020 2020 2072 686e 636f 6d6d 616e 6473       rhncommands
+0000bd10: 2e61 7070 656e 6428 6627 7270 6d20 2d55  .append(f'rpm -U
+0000bd20: 7668 2068 7474 703a 2f2f 7b66 7164 6e7d  vh http://{fqdn}
+0000bd30: 2f70 7562 2f6b 6174 656c 6c6f 2d63 612d  /pub/katello-ca-
+0000bd40: 636f 6e73 756d 6572 2d6c 6174 6573 742e  consumer-latest.
+0000bd50: 6e6f 6172 6368 2e72 706d 2729 0a20 2020  noarch.rpm').   
+0000bd60: 2020 2020 2020 2020 2069 6620 7268 6e61           if rhna
+0000bd70: 6b20 6973 206e 6f74 204e 6f6e 6520 616e  k is not None an
+0000bd80: 6420 7268 6e6f 7267 2069 7320 6e6f 7420  d rhnorg is not 
+0000bd90: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+0000bda0: 2020 2020 2020 7268 6e63 6f6d 6d61 6e64        rhncommand
+0000bdb0: 732e 6170 7065 6e64 2827 7375 6273 6372  s.append('subscr
+0000bdc0: 6970 7469 6f6e 2d6d 616e 6167 6572 2072  iption-manager r
+0000bdd0: 6567 6973 7465 7220 2d2d 7365 7276 6572  egister --server
+0000bde0: 7572 6c3d 2573 202d 2d66 6f72 6365 202d  url=%s --force -
+0000bdf0: 2d61 6374 6976 6174 696f 6e6b 6579 3d25  -activationkey=%
+0000be00: 7320 2d2d 6f72 673d 2573 270a 2020 2020  s --org=%s'.    
+0000be10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000be20: 2020 2020 2020 2020 2020 2020 2020 2025                 %
+0000be30: 2028 7268 6e73 6572 7665 722c 2072 686e   (rhnserver, rhn
+0000be40: 616b 2c20 7268 6e6f 7267 2929 0a20 2020  ak, rhnorg)).   
+0000be50: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0000be60: 696d 6167 652e 7374 6172 7473 7769 7468  image.startswith
+0000be70: 2827 7268 656c 2d38 2729 206f 7220 696d  ('rhel-8') or im
+0000be80: 6167 6520 3d3d 2027 7268 656c 3827 3a0a  age == 'rhel8':.
+0000be90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bea0: 2020 2020 7268 6e63 6f6d 6d61 6e64 732e      rhncommands.
+0000beb0: 6170 7065 6e64 2827 7375 6273 6372 6970  append('subscrip
+0000bec0: 7469 6f6e 2d6d 616e 6167 6572 2072 6570  tion-manager rep
+0000bed0: 6f73 202d 2d65 6e61 626c 653d 7268 656c  os --enable=rhel
+0000bee0: 2d38 2d66 6f72 2d78 3836 5f36 342d 6261  -8-for-x86_64-ba
+0000bef0: 7365 6f73 2d72 706d 7327 290a 2020 2020  seos-rpms').    
+0000bf00: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+0000bf10: 2069 6d61 6765 2e73 7461 7274 7377 6974   image.startswit
+0000bf20: 6828 2772 6865 6c2d 7365 7276 6572 2d37  h('rhel-server-7
+0000bf30: 2729 206f 7220 696d 6167 6520 3d3d 2027  ') or image == '
+0000bf40: 7268 656c 3727 3a0a 2020 2020 2020 2020  rhel7':.        
+0000bf50: 2020 2020 2020 2020 2020 2020 7268 6e63              rhnc
+0000bf60: 6f6d 6d61 6e64 732e 6170 7065 6e64 2827  ommands.append('
+0000bf70: 7375 6273 6372 6970 7469 6f6e 2d6d 616e  subscription-man
+0000bf80: 6167 6572 2072 6570 6f73 202d 2d65 6e61  ager repos --ena
+0000bf90: 626c 653d 7268 656c 2d37 2d73 6572 7665  ble=rhel-7-serve
+0000bfa0: 722d 7270 6d73 2729 0a20 2020 2020 2020  r-rpms').       
+0000bfb0: 2020 2020 2065 6c69 6620 7268 6e75 7365       elif rhnuse
+0000bfc0: 7220 6973 206e 6f74 204e 6f6e 6520 616e  r is not None an
+0000bfd0: 6420 7268 6e70 6173 7377 6f72 6420 6973  d rhnpassword is
+0000bfe0: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+0000bff0: 2020 2020 2020 2020 2020 2072 686e 636f             rhnco
+0000c000: 6d6d 616e 6473 2e61 7070 656e 6428 2773  mmands.append('s
+0000c010: 7562 7363 7269 7074 696f 6e2d 6d61 6e61  ubscription-mana
+0000c020: 6765 7220 7265 6769 7374 6572 202d 2d73  ger register --s
+0000c030: 6572 7665 7275 726c 3d25 7320 2d2d 666f  erverurl=%s --fo
+0000c040: 7263 6520 2d2d 7573 6572 6e61 6d65 3d25  rce --username=%
+0000c050: 7320 2d2d 7061 7373 776f 7264 3d25 7327  s --password=%s'
+0000c060: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c080: 2020 2020 2520 2872 686e 7365 7276 6572      % (rhnserver
+0000c090: 2c20 7268 6e75 7365 722c 2072 686e 7061  , rhnuser, rhnpa
+0000c0a0: 7373 776f 7264 2929 0a20 2020 2020 2020  ssword)).       
+0000c0b0: 2020 2020 2020 2020 2069 6620 7268 6e70           if rhnp
+0000c0c0: 6f6f 6c20 6973 206e 6f74 204e 6f6e 653a  ool is not None:
+0000c0d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c0e0: 2020 2020 2072 686e 636f 6d6d 616e 6473       rhncommands
+0000c0f0: 2e61 7070 656e 6428 6627 7375 6273 6372  .append(f'subscr
+0000c100: 6970 7469 6f6e 2d6d 616e 6167 6572 2061  iption-manager a
+0000c110: 7474 6163 6820 2d2d 706f 6f6c 3d7b 7268  ttach --pool={rh
+0000c120: 6e70 6f6f 6c7d 2729 0a20 2020 2020 2020  npool}').       
+0000c130: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+0000c140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c150: 2020 2072 686e 636f 6d6d 616e 6473 2e61     rhncommands.a
+0000c160: 7070 656e 6428 2773 7562 7363 7269 7074  ppend('subscript
+0000c170: 696f 6e2d 6d61 6e61 6765 7220 6174 7461  ion-manager atta
+0000c180: 6368 202d 2d61 7574 6f27 290a 2020 2020  ch --auto').    
+0000c190: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0000c1a0: 2020 2020 2020 7268 6e63 6f6d 6d61 6e64        rhncommand
+0000c1b0: 7320 3d20 5b5d 0a20 2020 2020 2020 2073  s = [].        s
+0000c1c0: 6861 7265 6466 6f6c 6465 7263 6d64 7320  haredfoldercmds 
+0000c1d0: 3d20 5b5d 0a20 2020 2020 2020 2069 6620  = [].        if 
+0000c1e0: 7368 6172 6564 666f 6c64 6572 7320 616e  sharedfolders an
+0000c1f0: 6420 7365 6c66 2e74 7970 6520 3d3d 2027  d self.type == '
+0000c200: 6b76 6d27 3a0a 2020 2020 2020 2020 2020  kvm':.          
+0000c210: 2020 666f 7220 7368 6172 6564 666f 6c64    for sharedfold
+0000c220: 6572 2069 6e20 7368 6172 6564 666f 6c64  er in sharedfold
+0000c230: 6572 733a 0a20 2020 2020 2020 2020 2020  ers:.           
+0000c240: 2020 2020 2062 6173 6566 6f6c 6465 7220       basefolder 
+0000c250: 3d20 6f73 2e70 6174 682e 6261 7365 6e61  = os.path.basena
+0000c260: 6d65 2873 6861 7265 6466 6f6c 6465 7229  me(sharedfolder)
+0000c270: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c280: 2063 6d64 3120 3d20 6622 6d6b 6469 7220   cmd1 = f"mkdir 
+0000c290: 2d70 202f 6d6e 742f 7b73 6861 7265 6466  -p /mnt/{sharedf
+0000c2a0: 6f6c 6465 727d 220a 2020 2020 2020 2020  older}".        
+0000c2b0: 2020 2020 2020 2020 636d 6432 203d 2066          cmd2 = f
+0000c2c0: 2265 6368 6f20 7b62 6173 6566 6f6c 6465  "echo {basefolde
+0000c2d0: 727d 202f 6d6e 742f 7b73 6861 7265 6466  r} /mnt/{sharedf
+0000c2e0: 6f6c 6465 727d 2039 7020 7472 616e 733d  older} 9p trans=
+0000c2f0: 7669 7274 696f 2c76 6572 7369 6f6e 3d39  virtio,version=9
+0000c300: 7032 3030 302e 4c2c 7277 2030 2030 203e  p2000.L,rw 0 0 >
+0000c310: 3e20 2f65 7463 2f66 7374 6162 220a 2020  > /etc/fstab".  
+0000c320: 2020 2020 2020 2020 2020 2020 2020 7368                sh
+0000c330: 6172 6564 666f 6c64 6572 636d 6473 2e61  aredfoldercmds.a
+0000c340: 7070 656e 6428 636d 6431 290a 2020 2020  ppend(cmd1).    
+0000c350: 2020 2020 2020 2020 2020 2020 7368 6172              shar
+0000c360: 6564 666f 6c64 6572 636d 6473 2e61 7070  edfoldercmds.app
+0000c370: 656e 6428 636d 6432 290a 2020 2020 2020  end(cmd2).      
+0000c380: 2020 6966 2073 6861 7265 6466 6f6c 6465    if sharedfolde
+0000c390: 7263 6d64 733a 0a20 2020 2020 2020 2020  rcmds:.         
+0000c3a0: 2020 2073 6861 7265 6466 6f6c 6465 7263     sharedfolderc
+0000c3b0: 6d64 732e 6170 7065 6e64 2822 6d6f 756e  mds.append("moun
+0000c3c0: 7420 2d61 2229 0a20 2020 2020 2020 206e  t -a").        n
+0000c3d0: 6574 776f 726b 7761 6974 636f 6d6d 616e  etworkwaitcomman
+0000c3e0: 6420 3d20 5b66 2773 6c65 6570 207b 6e65  d = [f'sleep {ne
+0000c3f0: 7477 6f72 6b77 6169 747d 275d 2069 6620  tworkwait}'] if 
+0000c400: 6e65 7477 6f72 6b77 6169 7420 3e20 3020  networkwait > 0 
+0000c410: 656c 7365 205b 5d0a 2020 2020 2020 2020  else [].        
+0000c420: 726f 6f74 636f 6d6d 616e 6420 3d20 5b66  rootcommand = [f
+0000c430: 2765 6368 6f20 726f 6f74 3a7b 726f 6f74  'echo root:{root
+0000c440: 7061 7373 776f 7264 7d20 7c20 6368 7061  password} | chpa
+0000c450: 7373 7764 275d 2069 6620 726f 6f74 7061  sswd'] if rootpa
+0000c460: 7373 776f 7264 2069 7320 6e6f 7420 4e6f  ssword is not No
+0000c470: 6e65 2065 6c73 6520 5b5d 0a20 2020 2020  ne else [].     
+0000c480: 2020 2063 6d64 7320 3d20 726f 6f74 636f     cmds = rootco
+0000c490: 6d6d 616e 6420 2b20 6e65 7477 6f72 6b77  mmand + networkw
+0000c4a0: 6169 7463 6f6d 6d61 6e64 202b 2072 686e  aitcommand + rhn
+0000c4b0: 636f 6d6d 616e 6473 202b 2073 6861 7265  commands + share
+0000c4c0: 6466 6f6c 6465 7263 6d64 7320 2b20 636d  dfoldercmds + cm
+0000c4d0: 6473 202b 2073 6372 6970 7463 6d64 730a  ds + scriptcmds.
+0000c4e0: 2020 2020 2020 2020 6966 206e 6f74 6966          if notif
+0000c4f0: 7920 616e 6420 696d 6167 6520 6973 206e  y and image is n
+0000c500: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+0000c510: 2020 2020 2069 6620 6e6f 7469 6679 636d       if notifycm
+0000c520: 6420 6973 204e 6f6e 6520 616e 6420 6e6f  d is None and no
+0000c530: 7469 6679 7363 7269 7074 2069 7320 4e6f  tifyscript is No
+0000c540: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+0000c550: 2020 2020 6966 2027 636f 7327 2069 6e20      if 'cos' in 
+0000c560: 696d 6167 653a 0a20 2020 2020 2020 2020  image:.         
+0000c570: 2020 2020 2020 2020 2020 206e 6f74 6966             notif
+0000c580: 7963 6d64 203d 2027 6a6f 7572 6e61 6c63  ycmd = 'journalc
+0000c590: 746c 202d 2d69 6465 6e74 6966 6965 723d  tl --identifier=
+0000c5a0: 6967 6e69 7469 6f6e 202d 2d61 6c6c 202d  ignition --all -
+0000c5b0: 2d6e 6f2d 7061 6765 7227 0a20 2020 2020  -no-pager'.     
+0000c5c0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0000c5d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c5e0: 2020 2020 2063 6c6f 7564 696e 6974 6669       cloudinitfi
+0000c5f0: 6c65 203d 2063 6f6d 6d6f 6e2e 6765 745f  le = common.get_
+0000c600: 636c 6f75 6469 6e69 7466 696c 6528 696d  cloudinitfile(im
+0000c610: 6167 6529 0a20 2020 2020 2020 2020 2020  age).           
+0000c620: 2020 2020 2020 2020 206e 6f74 6966 7963           notifyc
+0000c630: 6d64 203d 2022 7461 696c 202d 3130 3020  md = "tail -100 
+0000c640: 2573 2220 2520 636c 6f75 6469 6e69 7466  %s" % cloudinitf
+0000c650: 696c 650a 2020 2020 2020 2020 2020 2020  ile.            
+0000c660: 6966 206e 6f74 6966 7973 6372 6970 7420  if notifyscript 
+0000c670: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+0000c680: 2020 2020 2020 2020 2020 2020 206e 6f74               not
+0000c690: 6966 7973 6372 6970 7420 3d20 6f73 2e70  ifyscript = os.p
+0000c6a0: 6174 682e 6578 7061 6e64 7573 6572 286e  ath.expanduser(n
+0000c6b0: 6f74 6966 7973 6372 6970 7429 0a20 2020  otifyscript).   
+0000c6c0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0000c6d0: 6261 7365 6469 7220 213d 2027 2e27 3a0a  basedir != '.':.
+0000c6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c6f0: 2020 2020 6e6f 7469 6679 7363 7269 7074      notifyscript
+0000c700: 203d 2066 277b 6261 7365 6469 727d 2f7b   = f'{basedir}/{
+0000c710: 6e6f 7469 6679 7363 7269 7074 7d27 0a20  notifyscript}'. 
+0000c720: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000c730: 6620 6e6f 7420 6f73 2e70 6174 682e 6578  f not os.path.ex
+0000c740: 6973 7473 286e 6f74 6966 7973 6372 6970  ists(notifyscrip
+0000c750: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
+0000c760: 2020 2020 2020 2020 6e6f 7469 6679 636d          notifycm
+0000c770: 6420 3d20 4e6f 6e65 0a20 2020 2020 2020  d = None.       
+0000c780: 2020 2020 2020 2020 2020 2020 206e 6f74               not
+0000c790: 6966 7973 6372 6970 7420 3d20 4e6f 6e65  ifyscript = None
+0000c7a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c7b0: 2020 2020 2077 6172 6e69 6e67 2866 224e       warning(f"N
+0000c7c0: 6f74 6966 6963 6174 696f 6e20 7265 7175  otification requ
+0000c7d0: 6972 6564 2066 6f72 207b 6e61 6d65 7d20  ired for {name} 
+0000c7e0: 6275 7420 6d69 7373 696e 6720 6e6f 7469  but missing noti
+0000c7f0: 6679 7363 7269 7074 2229 0a20 2020 2020  fyscript").     
+0000c800: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0000c810: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c820: 2020 2020 2066 696c 6573 2e61 7070 656e       files.appen
+0000c830: 6428 7b27 7061 7468 273a 2027 2f72 6f6f  d({'path': '/roo
+0000c840: 742f 2e6e 6f74 6966 792e 7368 272c 2027  t/.notify.sh', '
+0000c850: 6f72 6967 696e 273a 206e 6f74 6966 7973  origin': notifys
+0000c860: 6372 6970 747d 290a 2020 2020 2020 2020  cript}).        
+0000c870: 2020 2020 2020 2020 2020 2020 6e6f 7469              noti
+0000c880: 6679 636d 6420 3d20 2262 6173 6820 2f72  fycmd = "bash /r
+0000c890: 6f6f 742f 2e6e 6f74 6966 792e 7368 220a  oot/.notify.sh".
+0000c8a0: 2020 2020 2020 2020 2020 2020 6e6f 7469              noti
+0000c8b0: 6679 636d 6473 2c20 6d61 696c 636f 6e74  fycmds, mailcont
+0000c8c0: 656e 7420 3d20 7365 6c66 2e68 616e 646c  ent = self.handl
+0000c8d0: 655f 6e6f 7469 6669 6361 7469 6f6e 7328  e_notifications(
+0000c8e0: 6e61 6d65 2c20 6e6f 7469 6679 6d65 7468  name, notifymeth
+0000c8f0: 6f64 733d 6e6f 7469 6679 6d65 7468 6f64  ods=notifymethod
+0000c900: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
+0000c910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c940: 2020 2070 7573 6862 756c 6c65 7474 6f6b     pushbullettok
+0000c950: 656e 3d70 7573 6862 756c 6c65 7474 6f6b  en=pushbullettok
+0000c960: 656e 2c0a 2020 2020 2020 2020 2020 2020  en,.            
 0000c970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c980: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0000c990: 7573 6862 756c 6c65 7474 6f6b 656e 3d70  ushbullettoken=p
-0000c9a0: 7573 6862 756c 6c65 7474 6f6b 656e 2c0a  ushbullettoken,.
-0000c9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c9a0: 2020 2020 6e6f 7469 6679 7363 7269 7074      notifyscript
+0000c9b0: 3d6e 6f74 6966 7973 6372 6970 742c 206e  =notifyscript, n
+0000c9c0: 6f74 6966 7963 6d64 3d6e 6f74 6966 7963  otifycmd=notifyc
+0000c9d0: 6d64 2c0a 2020 2020 2020 2020 2020 2020  md,.            
 0000c9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c9f0: 6e6f 7469 6679 7363 7269 7074 3d6e 6f74  notifyscript=not
-0000ca00: 6966 7973 6372 6970 742c 206e 6f74 6966  ifyscript, notif
-0000ca10: 7963 6d64 3d6e 6f74 6966 7963 6d64 2c0a  ycmd=notifycmd,.
-0000ca20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ca30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ca40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ca00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ca10: 2020 2020 736c 6163 6b63 6861 6e6e 656c      slackchannel
+0000ca20: 3d73 6c61 636b 6368 616e 6e65 6c2c 2073  =slackchannel, s
+0000ca30: 6c61 636b 746f 6b65 6e3d 736c 6163 6b74  lacktoken=slackt
+0000ca40: 6f6b 656e 2c0a 2020 2020 2020 2020 2020  oken,.          
 0000ca50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ca60: 736c 6163 6b63 6861 6e6e 656c 3d73 6c61  slackchannel=sla
-0000ca70: 636b 6368 616e 6e65 6c2c 2073 6c61 636b  ckchannel, slack
-0000ca80: 746f 6b65 6e3d 736c 6163 6b74 6f6b 656e  token=slacktoken
-0000ca90: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000caa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cad0: 2020 6d61 696c 7365 7276 6572 3d6d 6169    mailserver=mai
-0000cae0: 6c73 6572 7665 722c 206d 6169 6c66 726f  lserver, mailfro
-0000caf0: 6d3d 6d61 696c 6672 6f6d 2c20 6d61 696c  m=mailfrom, mail
-0000cb00: 746f 3d6d 6169 6c74 6f29 0a20 2020 2020  to=mailto).     
-0000cb10: 2020 2020 2020 2069 6620 6d61 696c 636f         if mailco
-0000cb20: 6e74 656e 7420 6973 206e 6f74 204e 6f6e  ntent is not Non
-0000cb30: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0000cb40: 2020 2066 696c 6573 2e61 7070 656e 6428     files.append(
-0000cb50: 7b27 7061 7468 273a 2027 2f76 6172 2f74  {'path': '/var/t
-0000cb60: 6d70 2f6d 6169 6c2e 7478 7427 2c20 2763  mp/mail.txt', 'c
-0000cb70: 6f6e 7465 6e74 273a 206d 6169 6c63 6f6e  ontent': mailcon
-0000cb80: 7465 6e74 7d29 0a20 2020 2020 2020 2020  tent}).         
-0000cb90: 2020 2069 6620 6e6f 7469 6679 636d 6473     if notifycmds
-0000cba0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000cbb0: 2020 6966 206e 6f74 2063 6d64 733a 0a20    if not cmds:. 
-0000cbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cbd0: 2020 2063 6d64 7320 3d20 6e6f 7469 6679     cmds = notify
-0000cbe0: 636d 6473 0a20 2020 2020 2020 2020 2020  cmds.           
-0000cbf0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0000cc00: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0000cc10: 6d64 732e 6578 7465 6e64 286e 6f74 6966  mds.extend(notif
-0000cc20: 7963 6d64 7329 0a20 2020 2020 2020 2069  ycmds).        i
-0000cc30: 7073 203d 205b 6f76 6572 7269 6465 735b  ps = [overrides[
-0000cc40: 6b65 795d 2066 6f72 206b 6579 2069 6e20  key] for key in 
-0000cc50: 6f76 6572 7269 6465 7320 6966 2072 652e  overrides if re.
-0000cc60: 6d61 7463 6828 2769 705b 302d 395d 2b27  match('ip[0-9]+'
-0000cc70: 2c20 6b65 7929 5d0a 2020 2020 2020 2020  , key)].        
-0000cc80: 6e65 746d 6173 6b73 203d 205b 6f76 6572  netmasks = [over
-0000cc90: 7269 6465 735b 6b65 795d 2066 6f72 206b  rides[key] for k
-0000cca0: 6579 2069 6e20 6f76 6572 7269 6465 7320  ey in overrides 
-0000ccb0: 6966 2072 652e 6d61 7463 6828 276e 6574  if re.match('net
-0000ccc0: 6d61 736b 5b30 2d39 5d2b 272c 206b 6579  mask[0-9]+', key
-0000ccd0: 295d 0a20 2020 2020 2020 2069 6620 7072  )].        if pr
-0000cce0: 6976 6174 656b 6579 2061 6e64 2073 656c  ivatekey and sel
-0000ccf0: 662e 7479 7065 203d 3d20 276b 766d 273a  f.type == 'kvm':
-0000cd00: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
-0000cd10: 7661 7465 6b65 7966 696c 6520 3d20 4e6f  vatekeyfile = No
-0000cd20: 6e65 0a20 2020 2020 2020 2020 2020 2070  ne.            p
-0000cd30: 7562 6c69 636b 6579 6669 6c65 203d 2063  ublickeyfile = c
-0000cd40: 6f6d 6d6f 6e2e 6765 745f 7373 685f 7075  ommon.get_ssh_pu
-0000cd50: 625f 6b65 7928 290a 2020 2020 2020 2020  b_key().        
-0000cd60: 2020 2020 6966 2070 7562 6c69 636b 6579      if publickey
-0000cd70: 6669 6c65 2069 7320 6e6f 7420 4e6f 6e65  file is not None
-0000cd80: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000cd90: 2020 7072 6976 6174 656b 6579 6669 6c65    privatekeyfile
-0000cda0: 203d 2070 7562 6c69 636b 6579 6669 6c65   = publickeyfile
-0000cdb0: 2e72 6570 6c61 6365 2827 2e70 7562 272c  .replace('.pub',
-0000cdc0: 2027 2729 0a20 2020 2020 2020 2020 2020   '').           
-0000cdd0: 2069 6620 7072 6976 6174 656b 6579 6669   if privatekeyfi
-0000cde0: 6c65 2069 7320 6e6f 7420 4e6f 6e65 2061  le is not None a
-0000cdf0: 6e64 2070 7562 6c69 636b 6579 6669 6c65  nd publickeyfile
-0000ce00: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-0000ce10: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-0000ce20: 6976 6174 656b 6579 203d 206f 7065 6e28  ivatekey = open(
-0000ce30: 7072 6976 6174 656b 6579 6669 6c65 292e  privatekeyfile).
-0000ce40: 7265 6164 2829 2e73 7472 6970 2829 0a20  read().strip(). 
-0000ce50: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0000ce60: 7562 6c69 636b 6579 203d 206f 7065 6e28  ublickey = open(
-0000ce70: 7075 626c 6963 6b65 7966 696c 6529 2e72  publickeyfile).r
-0000ce80: 6561 6428 292e 7374 7269 7028 290a 2020  ead().strip().  
-0000ce90: 2020 2020 2020 2020 2020 2020 2020 7761                wa
-0000cea0: 726e 696e 6728 6622 496e 6a65 6374 696e  rning(f"Injectin
-0000ceb0: 6720 7072 6976 6174 6520 6b65 7920 666f  g private key fo
-0000cec0: 7220 7b6e 616d 657d 2229 0a20 2020 2020  r {name}").     
-0000ced0: 2020 2020 2020 2020 2020 2066 696c 6573             files
-0000cee0: 2e61 7070 656e 6428 7b27 7061 7468 273a  .append({'path':
-0000cef0: 2027 2f72 6f6f 742f 2e73 7368 2f69 645f   '/root/.ssh/id_
-0000cf00: 7273 6127 2c20 2763 6f6e 7465 6e74 273a  rsa', 'content':
-0000cf10: 2070 7269 7661 7465 6b65 797d 290a 2020   privatekey}).  
-0000cf20: 2020 2020 2020 2020 2020 2020 2020 6669                fi
-0000cf30: 6c65 732e 6170 7065 6e64 287b 2770 6174  les.append({'pat
-0000cf40: 6827 3a20 272f 726f 6f74 2f2e 7373 682f  h': '/root/.ssh/
-0000cf50: 6964 5f72 7361 2e70 7562 272c 2027 636f  id_rsa.pub', 'co
-0000cf60: 6e74 656e 7427 3a20 7075 626c 6963 6b65  ntent': publicke
-0000cf70: 797d 290a 2020 2020 2020 2020 2020 2020  y}).            
-0000cf80: 2020 2020 6966 2073 656c 662e 686f 7374      if self.host
-0000cf90: 2069 6e20 5b27 3132 372e 302e 302e 3127   in ['127.0.0.1'
-0000cfa0: 2c20 276c 6f63 616c 686f 7374 275d 3a0a  , 'localhost']:.
-0000cfb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cfc0: 2020 2020 6175 7468 6f72 697a 6564 5f6b      authorized_k
-0000cfd0: 6579 735f 6669 6c65 203d 206f 732e 7061  eys_file = os.pa
-0000cfe0: 7468 2e65 7870 616e 6475 7365 7228 277e  th.expanduser('~
-0000cff0: 2f2e 7373 682f 6175 7468 6f72 697a 6564  /.ssh/authorized
-0000d000: 5f6b 6579 7327 290a 2020 2020 2020 2020  _keys').        
-0000d010: 2020 2020 2020 2020 2020 2020 666f 756e              foun
-0000d020: 6420 3d20 4661 6c73 650a 2020 2020 2020  d = False.      
-0000d030: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0000d040: 206f 732e 7061 7468 2e65 7869 7374 7328   os.path.exists(
-0000d050: 6175 7468 6f72 697a 6564 5f6b 6579 735f  authorized_keys_
-0000d060: 6669 6c65 293a 0a20 2020 2020 2020 2020  file):.         
-0000d070: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0000d080: 6f72 206c 696e 6520 696e 206f 7065 6e28  or line in open(
-0000d090: 6175 7468 6f72 697a 6564 5f6b 6579 735f  authorized_keys_
-0000d0a0: 6669 6c65 292e 7265 6164 6c69 6e65 7328  file).readlines(
-0000d0b0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0000d0c0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0000d0d0: 6620 7075 626c 6963 6b65 7920 696e 206c  f publickey in l
-0000d0e0: 696e 653a 0a20 2020 2020 2020 2020 2020  ine:.           
+0000ca60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ca70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ca80: 2020 2020 2020 6d61 696c 7365 7276 6572        mailserver
+0000ca90: 3d6d 6169 6c73 6572 7665 722c 206d 6169  =mailserver, mai
+0000caa0: 6c66 726f 6d3d 6d61 696c 6672 6f6d 2c20  lfrom=mailfrom, 
+0000cab0: 6d61 696c 746f 3d6d 6169 6c74 6f29 0a20  mailto=mailto). 
+0000cac0: 2020 2020 2020 2020 2020 2069 6620 6d61             if ma
+0000cad0: 696c 636f 6e74 656e 7420 6973 206e 6f74  ilcontent is not
+0000cae0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+0000caf0: 2020 2020 2020 2066 696c 6573 2e61 7070         files.app
+0000cb00: 656e 6428 7b27 7061 7468 273a 2027 2f76  end({'path': '/v
+0000cb10: 6172 2f74 6d70 2f6d 6169 6c2e 7478 7427  ar/tmp/mail.txt'
+0000cb20: 2c20 2763 6f6e 7465 6e74 273a 206d 6169  , 'content': mai
+0000cb30: 6c63 6f6e 7465 6e74 7d29 0a20 2020 2020  lcontent}).     
+0000cb40: 2020 2020 2020 2069 6620 6e6f 7469 6679         if notify
+0000cb50: 636d 6473 3a0a 2020 2020 2020 2020 2020  cmds:.          
+0000cb60: 2020 2020 2020 6966 206e 6f74 2063 6d64        if not cmd
+0000cb70: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+0000cb80: 2020 2020 2020 2063 6d64 7320 3d20 6e6f         cmds = no
+0000cb90: 7469 6679 636d 6473 0a20 2020 2020 2020  tifycmds.       
+0000cba0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+0000cbb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cbc0: 2020 2063 6d64 732e 6578 7465 6e64 286e     cmds.extend(n
+0000cbd0: 6f74 6966 7963 6d64 7329 0a20 2020 2020  otifycmds).     
+0000cbe0: 2020 2069 7073 203d 205b 6f76 6572 7269     ips = [overri
+0000cbf0: 6465 735b 6b65 795d 2066 6f72 206b 6579  des[key] for key
+0000cc00: 2069 6e20 6f76 6572 7269 6465 7320 6966   in overrides if
+0000cc10: 2072 652e 6d61 7463 6828 2769 705b 302d   re.match('ip[0-
+0000cc20: 395d 2b27 2c20 6b65 7929 5d0a 2020 2020  9]+', key)].    
+0000cc30: 2020 2020 6e65 746d 6173 6b73 203d 205b      netmasks = [
+0000cc40: 6f76 6572 7269 6465 735b 6b65 795d 2066  overrides[key] f
+0000cc50: 6f72 206b 6579 2069 6e20 6f76 6572 7269  or key in overri
+0000cc60: 6465 7320 6966 2072 652e 6d61 7463 6828  des if re.match(
+0000cc70: 276e 6574 6d61 736b 5b30 2d39 5d2b 272c  'netmask[0-9]+',
+0000cc80: 206b 6579 295d 0a20 2020 2020 2020 2069   key)].        i
+0000cc90: 6620 7072 6976 6174 656b 6579 2061 6e64  f privatekey and
+0000cca0: 2073 656c 662e 7479 7065 203d 3d20 276b   self.type == 'k
+0000ccb0: 766d 273a 0a20 2020 2020 2020 2020 2020  vm':.           
+0000ccc0: 2070 7269 7661 7465 6b65 7966 696c 6520   privatekeyfile 
+0000ccd0: 3d20 4e6f 6e65 0a20 2020 2020 2020 2020  = None.         
+0000cce0: 2020 2070 7562 6c69 636b 6579 6669 6c65     publickeyfile
+0000ccf0: 203d 2063 6f6d 6d6f 6e2e 6765 745f 7373   = common.get_ss
+0000cd00: 685f 7075 625f 6b65 7928 290a 2020 2020  h_pub_key().    
+0000cd10: 2020 2020 2020 2020 6966 2070 7562 6c69          if publi
+0000cd20: 636b 6579 6669 6c65 2069 7320 6e6f 7420  ckeyfile is not 
+0000cd30: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+0000cd40: 2020 2020 2020 7072 6976 6174 656b 6579        privatekey
+0000cd50: 6669 6c65 203d 2070 7562 6c69 636b 6579  file = publickey
+0000cd60: 6669 6c65 2e72 6570 6c61 6365 2827 2e70  file.replace('.p
+0000cd70: 7562 272c 2027 2729 0a20 2020 2020 2020  ub', '').       
+0000cd80: 2020 2020 2069 6620 7072 6976 6174 656b       if privatek
+0000cd90: 6579 6669 6c65 2069 7320 6e6f 7420 4e6f  eyfile is not No
+0000cda0: 6e65 2061 6e64 2070 7562 6c69 636b 6579  ne and publickey
+0000cdb0: 6669 6c65 2069 7320 6e6f 7420 4e6f 6e65  file is not None
+0000cdc0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000cdd0: 2020 7072 6976 6174 656b 6579 203d 206f    privatekey = o
+0000cde0: 7065 6e28 7072 6976 6174 656b 6579 6669  pen(privatekeyfi
+0000cdf0: 6c65 292e 7265 6164 2829 2e73 7472 6970  le).read().strip
+0000ce00: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
+0000ce10: 2020 2070 7562 6c69 636b 6579 203d 206f     publickey = o
+0000ce20: 7065 6e28 7075 626c 6963 6b65 7966 696c  pen(publickeyfil
+0000ce30: 6529 2e72 6561 6428 292e 7374 7269 7028  e).read().strip(
+0000ce40: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000ce50: 2020 7761 726e 696e 6728 6622 496e 6a65    warning(f"Inje
+0000ce60: 6374 696e 6720 7072 6976 6174 6520 6b65  cting private ke
+0000ce70: 7920 666f 7220 7b6e 616d 657d 2229 0a20  y for {name}"). 
+0000ce80: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0000ce90: 696c 6573 2e61 7070 656e 6428 7b27 7061  iles.append({'pa
+0000cea0: 7468 273a 2027 2f72 6f6f 742f 2e73 7368  th': '/root/.ssh
+0000ceb0: 2f69 645f 7273 6127 2c20 2763 6f6e 7465  /id_rsa', 'conte
+0000cec0: 6e74 273a 2070 7269 7661 7465 6b65 797d  nt': privatekey}
+0000ced0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000cee0: 2020 6669 6c65 732e 6170 7065 6e64 287b    files.append({
+0000cef0: 2770 6174 6827 3a20 272f 726f 6f74 2f2e  'path': '/root/.
+0000cf00: 7373 682f 6964 5f72 7361 2e70 7562 272c  ssh/id_rsa.pub',
+0000cf10: 2027 636f 6e74 656e 7427 3a20 7075 626c   'content': publ
+0000cf20: 6963 6b65 797d 290a 2020 2020 2020 2020  ickey}).        
+0000cf30: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+0000cf40: 686f 7374 2069 6e20 5b27 3132 372e 302e  host in ['127.0.
+0000cf50: 302e 3127 2c20 276c 6f63 616c 686f 7374  0.1', 'localhost
+0000cf60: 275d 3a0a 2020 2020 2020 2020 2020 2020  ']:.            
+0000cf70: 2020 2020 2020 2020 6175 7468 6f72 697a          authoriz
+0000cf80: 6564 5f6b 6579 735f 6669 6c65 203d 206f  ed_keys_file = o
+0000cf90: 732e 7061 7468 2e65 7870 616e 6475 7365  s.path.expanduse
+0000cfa0: 7228 277e 2f2e 7373 682f 6175 7468 6f72  r('~/.ssh/author
+0000cfb0: 697a 6564 5f6b 6579 7327 290a 2020 2020  ized_keys').    
+0000cfc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cfd0: 666f 756e 6420 3d20 4661 6c73 650a 2020  found = False.  
+0000cfe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cff0: 2020 6966 206f 732e 7061 7468 2e65 7869    if os.path.exi
+0000d000: 7374 7328 6175 7468 6f72 697a 6564 5f6b  sts(authorized_k
+0000d010: 6579 735f 6669 6c65 293a 0a20 2020 2020  eys_file):.     
+0000d020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d030: 2020 2066 6f72 206c 696e 6520 696e 206f     for line in o
+0000d040: 7065 6e28 6175 7468 6f72 697a 6564 5f6b  pen(authorized_k
+0000d050: 6579 735f 6669 6c65 292e 7265 6164 6c69  eys_file).readli
+0000d060: 6e65 7328 293a 0a20 2020 2020 2020 2020  nes():.         
+0000d070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d080: 2020 2069 6620 7075 626c 6963 6b65 7920     if publickey 
+0000d090: 696e 206c 696e 653a 0a20 2020 2020 2020  in line:.       
+0000d0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d0b0: 2020 2020 2020 2020 2066 6f75 6e64 203d           found =
+0000d0c0: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
+0000d0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d0e0: 2020 2020 2020 6272 6561 6b0a 2020 2020        break.    
 0000d0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d100: 2020 2020 2066 6f75 6e64 203d 2054 7275       found = Tru
-0000d110: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-0000d120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d130: 2020 6272 6561 6b0a 2020 2020 2020 2020    break.        
-0000d140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d150: 6966 206e 6f74 2066 6f75 6e64 3a0a 2020  if not found:.  
-0000d160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d170: 2020 2020 2020 2020 2020 7761 726e 696e            warnin
-0000d180: 6728 6622 4164 6469 6e67 2070 7562 6c69  g(f"Adding publi
-0000d190: 6320 6b65 7920 746f 2061 7574 686f 7269  c key to authori
-0000d1a0: 7a65 645f 6b65 7973 5f66 696c 6520 666f  zed_keys_file fo
-0000d1b0: 7220 7b6e 616d 657d 2229 0a20 2020 2020  r {name}").     
+0000d100: 2020 2020 6966 206e 6f74 2066 6f75 6e64      if not found
+0000d110: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000d120: 2020 2020 2020 2020 2020 2020 2020 7761                wa
+0000d130: 726e 696e 6728 6622 4164 6469 6e67 2070  rning(f"Adding p
+0000d140: 7562 6c69 6320 6b65 7920 746f 2061 7574  ublic key to aut
+0000d150: 686f 7269 7a65 645f 6b65 7973 5f66 696c  horized_keys_fil
+0000d160: 6520 666f 7220 7b6e 616d 657d 2229 0a20  e for {name}"). 
+0000d170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d180: 2020 2020 2020 2020 2020 2077 6974 6820             with 
+0000d190: 6f70 656e 2861 7574 686f 7269 7a65 645f  open(authorized_
+0000d1a0: 6b65 7973 5f66 696c 652c 2027 6127 2920  keys_file, 'a') 
+0000d1b0: 6173 2066 3a0a 2020 2020 2020 2020 2020  as f:.          
 0000d1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d1d0: 2020 2020 2020 2077 6974 6820 6f70 656e         with open
-0000d1e0: 2861 7574 686f 7269 7a65 645f 6b65 7973  (authorized_keys
-0000d1f0: 5f66 696c 652c 2027 6127 2920 6173 2066  _file, 'a') as f
-0000d200: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000d1d0: 2020 2020 2020 662e 7772 6974 6528 6622        f.write(f"
+0000d1e0: 5c6e 7b70 7562 6c69 636b 6579 7d22 290a  \n{publickey}").
+0000d1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d200: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
 0000d210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d220: 2020 662e 7772 6974 6528 6622 5c6e 7b70    f.write(f"\n{p
-0000d230: 7562 6c69 636b 6579 7d22 290a 2020 2020  ublickey}").    
-0000d240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d250: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0000d260: 2020 2020 2020 2020 2020 2020 2020 7761                wa
-0000d270: 726e 696e 6728 2243 7265 6174 696e 6720  rning("Creating 
-0000d280: 6175 7468 6f72 697a 6564 5f6b 6579 735f  authorized_keys_
-0000d290: 6669 6c65 2229 0a20 2020 2020 2020 2020  file").         
-0000d2a0: 2020 2020 2020 2020 2020 2020 2020 2077                 w
-0000d2b0: 6974 6820 6f70 656e 2861 7574 686f 7269  ith open(authori
-0000d2c0: 7a65 645f 6b65 7973 5f66 696c 652c 2027  zed_keys_file, '
-0000d2d0: 7727 2920 6173 2066 3a0a 2020 2020 2020  w') as f:.      
-0000d2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d2f0: 2020 2020 2020 662e 7772 6974 6528 7075        f.write(pu
-0000d300: 626c 6963 6b65 7929 0a20 2020 2020 2020  blickey).       
-0000d310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d320: 2020 2020 206f 732e 6368 6d6f 6428 7363       os.chmod(sc
-0000d330: 7269 7074 2c20 306f 3630 3029 0a20 2020  ript, 0o600).   
-0000d340: 2020 2020 2069 6620 636d 6473 2061 6e64       if cmds and
-0000d350: 2027 7265 626f 6f74 2720 696e 2063 6d64   'reboot' in cmd
-0000d360: 733a 0a20 2020 2020 2020 2020 2020 2077  s:.            w
-0000d370: 6869 6c65 2027 7265 626f 6f74 2720 696e  hile 'reboot' in
-0000d380: 2063 6d64 733a 0a20 2020 2020 2020 2020   cmds:.         
-0000d390: 2020 2020 2020 2063 6d64 732e 7265 6d6f         cmds.remo
-0000d3a0: 7665 2827 7265 626f 6f74 2729 0a20 2020  ve('reboot').   
-0000d3b0: 2020 2020 2020 2020 2063 6d64 732e 6170           cmds.ap
-0000d3c0: 7065 6e64 2827 7265 626f 6f74 2729 0a20  pend('reboot'). 
-0000d3d0: 2020 2020 2020 2069 6620 696d 6167 6520         if image 
-0000d3e0: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
-0000d3f0: 2827 7268 656c 2d38 2720 696e 2069 6d61  ('rhel-8' in ima
-0000d400: 6765 206f 7220 2772 6863 6f73 2720 696e  ge or 'rhcos' in
-0000d410: 2069 6d61 6765 2920 616e 6420 6469 736b   image) and disk
-0000d420: 7320 616e 6420 6e6f 7420 6f6e 6c79 6173  s and not onlyas
-0000d430: 7365 7473 3a0a 2020 2020 2020 2020 2020  sets:.          
-0000d440: 2020 6669 7273 7464 6973 6b20 3d20 6469    firstdisk = di
-0000d450: 736b 735b 305d 0a20 2020 2020 2020 2020  sks[0].         
-0000d460: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
-0000d470: 2866 6972 7374 6469 736b 2c20 7374 7229  (firstdisk, str)
-0000d480: 2061 6e64 2066 6972 7374 6469 736b 2e69   and firstdisk.i
-0000d490: 7364 6967 6974 2829 3a0a 2020 2020 2020  sdigit():.      
-0000d4a0: 2020 2020 2020 2020 2020 6669 7273 7464            firstd
-0000d4b0: 6973 6b20 3d20 696e 7428 6669 7273 7464  isk = int(firstd
-0000d4c0: 6973 6b29 0a20 2020 2020 2020 2020 2020  isk).           
-0000d4d0: 2069 6620 6973 696e 7374 616e 6365 2866   if isinstance(f
-0000d4e0: 6972 7374 6469 736b 2c20 696e 7429 3a0a  irstdisk, int):.
-0000d4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d500: 6669 7273 7464 6973 6b73 697a 6520 3d20  firstdisksize = 
-0000d510: 6669 7273 7464 6973 6b0a 2020 2020 2020  firstdisk.      
-0000d520: 2020 2020 2020 2020 2020 6966 2066 6972            if fir
-0000d530: 7374 6469 736b 7369 7a65 203c 2032 303a  stdisksize < 20:
-0000d540: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d550: 2020 2020 2070 7072 696e 7428 2252 6f75       pprint("Rou
-0000d560: 6e64 696e 6720 7570 2066 6972 7374 2064  nding up first d
-0000d570: 6973 6b20 746f 2032 3047 6222 290a 2020  isk to 20Gb").  
-0000d580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d590: 2020 6469 736b 735b 305d 203d 2032 300a    disks[0] = 20.
-0000d5a0: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-0000d5b0: 2069 7369 6e73 7461 6e63 6528 6669 7273   isinstance(firs
-0000d5c0: 7464 6973 6b2c 2064 6963 7429 2061 6e64  tdisk, dict) and
-0000d5d0: 2027 7369 7a65 2720 696e 2066 6972 7374   'size' in first
-0000d5e0: 6469 736b 3a0a 2020 2020 2020 2020 2020  disk:.          
-0000d5f0: 2020 2020 2020 6669 7273 7464 6973 6b73        firstdisks
-0000d600: 697a 6520 3d20 6669 7273 7464 6973 6b5b  ize = firstdisk[
-0000d610: 2773 697a 6527 5d0a 2020 2020 2020 2020  'size'].        
-0000d620: 2020 2020 2020 2020 6966 2066 6972 7374          if first
-0000d630: 6469 736b 7369 7a65 203c 2032 303a 0a20  disksize < 20:. 
-0000d640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d650: 2020 2070 7072 696e 7428 2252 6f75 6e64     pprint("Round
-0000d660: 696e 6720 7570 2066 6972 7374 2064 6973  ing up first dis
-0000d670: 6b20 746f 2032 3047 6222 290a 2020 2020  k to 20Gb").    
-0000d680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d690: 6469 736b 735b 305d 5b27 7369 7a65 275d  disks[0]['size']
-0000d6a0: 203d 2032 300a 2020 2020 2020 2020 2020   = 20.          
-0000d6b0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0000d6c0: 2020 2020 2020 2020 6d73 6720 3d20 2249          msg = "I
-0000d6d0: 6e63 6f72 7265 6374 2066 6972 7374 2064  ncorrect first d
-0000d6e0: 6973 6b20 7370 6563 220a 2020 2020 2020  isk spec".      
-0000d6f0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0000d700: 207b 2772 6573 756c 7427 3a20 2766 6169   {'result': 'fai
-0000d710: 6c75 7265 272c 2027 7265 6173 6f6e 273a  lure', 'reason':
-0000d720: 206d 7367 7d0a 2020 2020 2020 2020 2020   msg}.          
-0000d730: 2020 6966 2027 7268 636f 7327 2069 6e20    if 'rhcos' in 
-0000d740: 696d 6167 6520 616e 6420 6d65 6d6f 7279  image and memory
-0000d750: 203c 2031 3032 343a 0a20 2020 2020 2020   < 1024:.       
-0000d760: 2020 2020 2020 2020 2070 7072 696e 7428           pprint(
-0000d770: 2241 646a 7573 7469 6e67 206d 656d 6f72  "Adjusting memor
-0000d780: 7920 746f 2031 3032 344d 6222 290a 2020  y to 1024Mb").  
-0000d790: 2020 2020 2020 2020 2020 2020 2020 6d65                me
-0000d7a0: 6d6f 7279 203d 2031 3032 340a 2020 2020  mory = 1024.    
-0000d7b0: 2020 2020 6d65 7461 6461 7461 203d 207b      metadata = {
-0000d7c0: 2770 6c61 6e27 3a20 706c 616e 2c20 2770  'plan': plan, 'p
-0000d7d0: 726f 6669 6c65 273a 2070 726f 6669 6c65  rofile': profile
-0000d7e0: 6e61 6d65 7d0a 2020 2020 2020 2020 6966  name}.        if
-0000d7f0: 2064 6f6d 6169 6e20 6973 206e 6f74 204e   domain is not N
-0000d800: 6f6e 6520 616e 6420 7265 7365 7276 6564  one and reserved
-0000d810: 6e73 3a0a 2020 2020 2020 2020 2020 2020  ns:.            
-0000d820: 6d65 7461 6461 7461 5b27 646f 6d61 696e  metadata['domain
-0000d830: 275d 203d 2064 6f6d 6169 6e0a 2020 2020  '] = domain.    
-0000d840: 2020 2020 2020 2020 6966 2064 6e73 636c          if dnscl
-0000d850: 6965 6e74 2069 7320 6e6f 7420 4e6f 6e65  ient is not None
-0000d860: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000d870: 2020 6d65 7461 6461 7461 5b27 646e 7363    metadata['dnsc
-0000d880: 6c69 656e 7427 5d20 3d20 646e 7363 6c69  lient'] = dnscli
-0000d890: 656e 740a 2020 2020 2020 2020 2020 2020  ent.            
-0000d8a0: 2020 2020 7265 7365 7276 6564 6e73 203d      reservedns =
-0000d8b0: 2046 616c 7365 0a20 2020 2020 2020 2069   False.        i
-0000d8c0: 6620 696d 6167 6520 6973 206e 6f74 204e  f image is not N
-0000d8d0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-0000d8e0: 206d 6574 6164 6174 615b 2769 6d61 6765   metadata['image
-0000d8f0: 275d 203d 2069 6d61 6765 0a20 2020 2020  '] = image.     
-0000d900: 2020 2065 6c69 6620 5b6e 2066 6f72 206e     elif [n for n
-0000d910: 2069 6e20 6e65 7473 2069 6620 6973 696e   in nets if isin
-0000d920: 7374 616e 6365 286e 2c20 6469 6374 2920  stance(n, dict) 
-0000d930: 616e 6420 276e 6963 2720 696e 206e 5d3a  and 'nic' in n]:
-0000d940: 0a20 2020 2020 2020 2020 2020 2077 6172  .            war
-0000d950: 6e69 6e67 2822 596f 7572 206e 6574 7320  ning("Your nets 
-0000d960: 6465 6669 6e69 7469 6f6e 2063 6f6e 7461  definition conta
-0000d970: 696e 7320 6e69 6320 6b65 7920 7768 6963  ins nic key whic
-0000d980: 6820 776f 6e27 7420 6265 2075 7365 6422  h won't be used"
-0000d990: 290a 2020 2020 2020 2020 6966 2027 6f77  ).        if 'ow
-0000d9a0: 6e65 7227 2069 6e20 7072 6f66 696c 6520  ner' in profile 
-0000d9b0: 6f72 2027 6f77 6e65 7227 2069 6e20 6f76  or 'owner' in ov
-0000d9c0: 6572 7269 6465 733a 0a20 2020 2020 2020  errides:.       
-0000d9d0: 2020 2020 206d 6574 6164 6174 615b 276f       metadata['o
-0000d9e0: 776e 6572 275d 203d 2070 726f 6669 6c65  wner'] = profile
-0000d9f0: 2e67 6574 2827 6f77 6e65 7227 2920 6f72  .get('owner') or
-0000da00: 206f 7665 7272 6964 6573 2e67 6574 2827   overrides.get('
-0000da10: 6f77 6e65 7227 290a 2020 2020 2020 2020  owner').        
-0000da20: 6966 2027 766d 7573 6572 2720 696e 2070  if 'vmuser' in p
-0000da30: 726f 6669 6c65 206f 7220 2776 6d75 7365  rofile or 'vmuse
-0000da40: 7227 2069 6e20 6f76 6572 7269 6465 733a  r' in overrides:
-0000da50: 0a20 2020 2020 2020 2020 2020 206d 6574  .            met
-0000da60: 6164 6174 615b 2775 7365 7227 5d20 3d20  adata['user'] = 
-0000da70: 7072 6f66 696c 652e 6765 7428 2776 6d75  profile.get('vmu
-0000da80: 7365 7227 2920 6f72 206f 7665 7272 6964  ser') or overrid
-0000da90: 6573 2e67 6574 2827 766d 7573 6572 2729  es.get('vmuser')
-0000daa0: 0a20 2020 2020 2020 2065 6c69 6620 2775  .        elif 'u
-0000dab0: 7365 7227 2069 6e20 7072 6f66 696c 6520  ser' in profile 
-0000dac0: 6f72 2027 7573 6572 2720 696e 206f 7665  or 'user' in ove
-0000dad0: 7272 6964 6573 3a0a 2020 2020 2020 2020  rrides:.        
-0000dae0: 2020 2020 6d65 7461 6461 7461 5b27 7573      metadata['us
-0000daf0: 6572 275d 203d 2070 726f 6669 6c65 2e67  er'] = profile.g
-0000db00: 6574 2827 7573 6572 2729 206f 7220 6f76  et('user') or ov
-0000db10: 6572 7269 6465 732e 6765 7428 2775 7365  errides.get('use
-0000db20: 7227 290a 2020 2020 2020 2020 6966 206b  r').        if k
-0000db30: 7562 6520 6973 206e 6f74 204e 6f6e 6520  ube is not None 
-0000db40: 616e 6420 6b75 6265 7479 7065 2069 7320  and kubetype is 
-0000db50: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-0000db60: 2020 2020 2020 6d65 7461 6461 7461 5b27        metadata['
-0000db70: 6b75 6265 7479 7065 275d 203d 206b 7562  kubetype'] = kub
-0000db80: 6574 7970 650a 2020 2020 2020 2020 2020  etype.          
-0000db90: 2020 6d65 7461 6461 7461 5b27 6b75 6265    metadata['kube
-0000dba0: 275d 203d 206b 7562 650a 2020 2020 2020  '] = kube.      
-0000dbb0: 2020 6966 2074 656d 706b 6579 3a0a 2020    if tempkey:.  
-0000dbc0: 2020 2020 2020 2020 2020 6966 206f 7665            if ove
-0000dbd0: 7272 6964 6573 2e67 6574 2827 7465 6d70  rrides.get('temp
-0000dbe0: 6b65 7964 6972 2729 2069 7320 4e6f 6e65  keydir') is None
-0000dbf0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000dc00: 2020 7465 6d70 6b65 7964 6972 203d 2054    tempkeydir = T
-0000dc10: 656d 706f 7261 7279 4469 7265 6374 6f72  emporaryDirector
-0000dc20: 7928 290a 2020 2020 2020 2020 2020 2020  y().            
-0000dc30: 2020 2020 6f76 6572 7269 6465 735b 2774      overrides['t
-0000dc40: 656d 706b 6579 6469 7227 5d20 3d20 7465  empkeydir'] = te
-0000dc50: 6d70 6b65 7964 6972 0a20 2020 2020 2020  mpkeydir.       
-0000dc60: 2023 2063 6f6e 6670 6f6f 6c20 6861 6e64   # confpool hand
-0000dc70: 6c69 6e67 2066 6f72 206e 6574 776f 726b  ling for network
-0000dc80: 0a20 2020 2020 2020 2066 6f72 2069 6e64  .        for ind
-0000dc90: 6578 2c20 6e65 7420 696e 2065 6e75 6d65  ex, net in enume
-0000dca0: 7261 7465 286e 6574 7329 3a0a 2020 2020  rate(nets):.    
-0000dcb0: 2020 2020 2020 2020 636f 6e66 706f 6f6c          confpool
-0000dcc0: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
-0000dcd0: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-0000dce0: 6528 6e65 742c 2064 6963 7429 3a0a 2020  e(net, dict):.  
-0000dcf0: 2020 2020 2020 2020 2020 2020 2020 636f                co
-0000dd00: 6e66 706f 6f6c 203d 206e 6574 2e67 6574  nfpool = net.get
-0000dd10: 2827 6970 706f 6f6c 2729 206f 7220 6e65  ('ippool') or ne
-0000dd20: 742e 6765 7428 2763 6f6e 6670 6f6f 6c27  t.get('confpool'
-0000dd30: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-0000dd40: 2069 6e64 6578 203d 3d20 3020 616e 6420   index == 0 and 
-0000dd50: 636f 6e66 706f 6f6c 2069 7320 4e6f 6e65  confpool is None
-0000dd60: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000dd70: 2020 636f 6e66 706f 6f6c 203d 206f 7665    confpool = ove
-0000dd80: 7272 6964 6573 2e67 6574 2827 6970 706f  rrides.get('ippo
-0000dd90: 6f6c 2729 206f 7220 6f76 6572 7269 6465  ol') or override
-0000dda0: 732e 6765 7428 2763 6f6e 6670 6f6f 6c27  s.get('confpool'
-0000ddb0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000ddc0: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-0000ddd0: 6e65 742c 2073 7472 293a 0a20 2020 2020  net, str):.     
-0000dde0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-0000ddf0: 6574 735b 696e 6465 785d 203d 207b 276e  ets[index] = {'n
-0000de00: 616d 6527 3a20 6e65 747d 0a20 2020 2020  ame': net}.     
-0000de10: 2020 2020 2020 2069 6620 636f 6e66 706f         if confpo
-0000de20: 6f6c 2069 7320 4e6f 6e65 3a0a 2020 2020  ol is None:.    
-0000de30: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
-0000de40: 696e 7565 0a20 2020 2020 2020 2020 2020  inue.           
-0000de50: 2069 6620 636f 6e66 706f 6f6c 206e 6f74   if confpool not
-0000de60: 2069 6e20 7365 6c66 2e63 6f6e 6670 6f6f   in self.confpoo
-0000de70: 6c73 3a0a 2020 2020 2020 2020 2020 2020  ls:.            
-0000de80: 2020 2020 6572 726f 7228 6622 7b63 6f6e      error(f"{con
-0000de90: 6670 6f6f 6c7d 2069 7320 6e6f 7420 6120  fpool} is not a 
-0000dea0: 7661 6c69 6420 636f 6e66 706f 6f6c 2229  valid confpool")
-0000deb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000dec0: 2073 7973 2e65 7869 7428 3129 0a20 2020   sys.exit(1).   
-0000ded0: 2020 2020 2020 2020 2063 7572 7265 6e74           current
-0000dee0: 636f 6e66 706f 6f6c 203d 2073 656c 662e  confpool = self.
-0000def0: 636f 6e66 706f 6f6c 735b 636f 6e66 706f  confpools[confpo
-0000df00: 6f6c 5d0a 2020 2020 2020 2020 2020 2020  ol].            
-0000df10: 6970 5f72 6573 6572 7661 7469 6f6e 7320  ip_reservations 
-0000df20: 3d20 6375 7272 656e 7463 6f6e 6670 6f6f  = currentconfpoo
-0000df30: 6c2e 6765 7428 2769 705f 7265 7365 7276  l.get('ip_reserv
-0000df40: 6174 696f 6e73 272c 207b 7d29 0a20 2020  ations', {}).   
-0000df50: 2020 2020 2020 2020 2072 6573 6572 7665           reserve
-0000df60: 645f 6970 7320 3d20 6c69 7374 2869 705f  d_ips = list(ip_
-0000df70: 7265 7365 7276 6174 696f 6e73 2e76 616c  reservations.val
-0000df80: 7565 7328 2929 0a20 2020 2020 2020 2020  ues()).         
-0000df90: 2020 2069 6620 2769 7073 2720 696e 2063     if 'ips' in c
-0000dfa0: 7572 7265 6e74 636f 6e66 706f 6f6c 3a0a  urrentconfpool:.
+0000d220: 2020 7761 726e 696e 6728 2243 7265 6174    warning("Creat
+0000d230: 696e 6720 6175 7468 6f72 697a 6564 5f6b  ing authorized_k
+0000d240: 6579 735f 6669 6c65 2229 0a20 2020 2020  eys_file").     
+0000d250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d260: 2020 2077 6974 6820 6f70 656e 2861 7574     with open(aut
+0000d270: 686f 7269 7a65 645f 6b65 7973 5f66 696c  horized_keys_fil
+0000d280: 652c 2027 7727 2920 6173 2066 3a0a 2020  e, 'w') as f:.  
+0000d290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d2a0: 2020 2020 2020 2020 2020 662e 7772 6974            f.writ
+0000d2b0: 6528 7075 626c 6963 6b65 7929 0a20 2020  e(publickey).   
+0000d2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d2d0: 2020 2020 2020 2020 206f 732e 6368 6d6f           os.chmo
+0000d2e0: 6428 7363 7269 7074 2c20 306f 3630 3029  d(script, 0o600)
+0000d2f0: 0a20 2020 2020 2020 2069 6620 636d 6473  .        if cmds
+0000d300: 2061 6e64 2027 7265 626f 6f74 2720 696e   and 'reboot' in
+0000d310: 2063 6d64 733a 0a20 2020 2020 2020 2020   cmds:.         
+0000d320: 2020 2077 6869 6c65 2027 7265 626f 6f74     while 'reboot
+0000d330: 2720 696e 2063 6d64 733a 0a20 2020 2020  ' in cmds:.     
+0000d340: 2020 2020 2020 2020 2020 2063 6d64 732e             cmds.
+0000d350: 7265 6d6f 7665 2827 7265 626f 6f74 2729  remove('reboot')
+0000d360: 0a20 2020 2020 2020 2020 2020 2063 6d64  .            cmd
+0000d370: 732e 6170 7065 6e64 2827 7265 626f 6f74  s.append('reboot
+0000d380: 2729 0a20 2020 2020 2020 2069 6620 696d  ').        if im
+0000d390: 6167 6520 6973 206e 6f74 204e 6f6e 6520  age is not None 
+0000d3a0: 616e 6420 2827 7268 656c 2d38 2720 696e  and ('rhel-8' in
+0000d3b0: 2069 6d61 6765 206f 7220 2772 6863 6f73   image or 'rhcos
+0000d3c0: 2720 696e 2069 6d61 6765 2920 616e 6420  ' in image) and 
+0000d3d0: 6469 736b 7320 616e 6420 6e6f 7420 6f6e  disks and not on
+0000d3e0: 6c79 6173 7365 7473 3a0a 2020 2020 2020  lyassets:.      
+0000d3f0: 2020 2020 2020 6669 7273 7464 6973 6b20        firstdisk 
+0000d400: 3d20 6469 736b 735b 305d 0a20 2020 2020  = disks[0].     
+0000d410: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
+0000d420: 616e 6365 2866 6972 7374 6469 736b 2c20  ance(firstdisk, 
+0000d430: 7374 7229 2061 6e64 2066 6972 7374 6469  str) and firstdi
+0000d440: 736b 2e69 7364 6967 6974 2829 3a0a 2020  sk.isdigit():.  
+0000d450: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+0000d460: 7273 7464 6973 6b20 3d20 696e 7428 6669  rstdisk = int(fi
+0000d470: 7273 7464 6973 6b29 0a20 2020 2020 2020  rstdisk).       
+0000d480: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
+0000d490: 6365 2866 6972 7374 6469 736b 2c20 696e  ce(firstdisk, in
+0000d4a0: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
+0000d4b0: 2020 2020 6669 7273 7464 6973 6b73 697a      firstdisksiz
+0000d4c0: 6520 3d20 6669 7273 7464 6973 6b0a 2020  e = firstdisk.  
+0000d4d0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0000d4e0: 2066 6972 7374 6469 736b 7369 7a65 203c   firstdisksize <
+0000d4f0: 2032 303a 0a20 2020 2020 2020 2020 2020   20:.           
+0000d500: 2020 2020 2020 2020 2070 7072 696e 7428           pprint(
+0000d510: 2252 6f75 6e64 696e 6720 7570 2066 6972  "Rounding up fir
+0000d520: 7374 2064 6973 6b20 746f 2032 3047 6222  st disk to 20Gb"
+0000d530: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000d540: 2020 2020 2020 6469 736b 735b 305d 203d        disks[0] =
+0000d550: 2032 300a 2020 2020 2020 2020 2020 2020   20.            
+0000d560: 656c 6966 2069 7369 6e73 7461 6e63 6528  elif isinstance(
+0000d570: 6669 7273 7464 6973 6b2c 2064 6963 7429  firstdisk, dict)
+0000d580: 2061 6e64 2027 7369 7a65 2720 696e 2066   and 'size' in f
+0000d590: 6972 7374 6469 736b 3a0a 2020 2020 2020  irstdisk:.      
+0000d5a0: 2020 2020 2020 2020 2020 6669 7273 7464            firstd
+0000d5b0: 6973 6b73 697a 6520 3d20 6669 7273 7464  isksize = firstd
+0000d5c0: 6973 6b5b 2773 697a 6527 5d0a 2020 2020  isk['size'].    
+0000d5d0: 2020 2020 2020 2020 2020 2020 6966 2066              if f
+0000d5e0: 6972 7374 6469 736b 7369 7a65 203c 2032  irstdisksize < 2
+0000d5f0: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
+0000d600: 2020 2020 2020 2070 7072 696e 7428 2252         pprint("R
+0000d610: 6f75 6e64 696e 6720 7570 2066 6972 7374  ounding up first
+0000d620: 2064 6973 6b20 746f 2032 3047 6222 290a   disk to 20Gb").
+0000d630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d640: 2020 2020 6469 736b 735b 305d 5b27 7369      disks[0]['si
+0000d650: 7a65 275d 203d 2032 300a 2020 2020 2020  ze'] = 20.      
+0000d660: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0000d670: 2020 2020 2020 2020 2020 2020 6d73 6720              msg 
+0000d680: 3d20 2249 6e63 6f72 7265 6374 2066 6972  = "Incorrect fir
+0000d690: 7374 2064 6973 6b20 7370 6563 220a 2020  st disk spec".  
+0000d6a0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0000d6b0: 7475 726e 207b 2772 6573 756c 7427 3a20  turn {'result': 
+0000d6c0: 2766 6169 6c75 7265 272c 2027 7265 6173  'failure', 'reas
+0000d6d0: 6f6e 273a 206d 7367 7d0a 2020 2020 2020  on': msg}.      
+0000d6e0: 2020 2020 2020 6966 2027 7268 636f 7327        if 'rhcos'
+0000d6f0: 2069 6e20 696d 6167 6520 616e 6420 6d65   in image and me
+0000d700: 6d6f 7279 203c 2031 3032 343a 0a20 2020  mory < 1024:.   
+0000d710: 2020 2020 2020 2020 2020 2020 2070 7072               ppr
+0000d720: 696e 7428 2241 646a 7573 7469 6e67 206d  int("Adjusting m
+0000d730: 656d 6f72 7920 746f 2031 3032 344d 6222  emory to 1024Mb"
+0000d740: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000d750: 2020 6d65 6d6f 7279 203d 2031 3032 340a    memory = 1024.
+0000d760: 2020 2020 2020 2020 6d65 7461 6461 7461          metadata
+0000d770: 203d 207b 2770 6c61 6e27 3a20 706c 616e   = {'plan': plan
+0000d780: 2c20 2770 726f 6669 6c65 273a 2070 726f  , 'profile': pro
+0000d790: 6669 6c65 6e61 6d65 7d0a 2020 2020 2020  filename}.      
+0000d7a0: 2020 6966 2064 6f6d 6169 6e20 6973 206e    if domain is n
+0000d7b0: 6f74 204e 6f6e 6520 616e 6420 7265 7365  ot None and rese
+0000d7c0: 7276 6564 6e73 3a0a 2020 2020 2020 2020  rvedns:.        
+0000d7d0: 2020 2020 6d65 7461 6461 7461 5b27 646f      metadata['do
+0000d7e0: 6d61 696e 275d 203d 2064 6f6d 6169 6e0a  main'] = domain.
+0000d7f0: 2020 2020 2020 2020 2020 2020 6966 2064              if d
+0000d800: 6e73 636c 6965 6e74 2069 7320 6e6f 7420  nsclient is not 
+0000d810: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+0000d820: 2020 2020 2020 6d65 7461 6461 7461 5b27        metadata['
+0000d830: 646e 7363 6c69 656e 7427 5d20 3d20 646e  dnsclient'] = dn
+0000d840: 7363 6c69 656e 740a 2020 2020 2020 2020  sclient.        
+0000d850: 2020 2020 2020 2020 7265 7365 7276 6564          reserved
+0000d860: 6e73 203d 2046 616c 7365 0a20 2020 2020  ns = False.     
+0000d870: 2020 2069 6620 696d 6167 6520 6973 206e     if image is n
+0000d880: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+0000d890: 2020 2020 206d 6574 6164 6174 615b 2769       metadata['i
+0000d8a0: 6d61 6765 275d 203d 2069 6d61 6765 0a20  mage'] = image. 
+0000d8b0: 2020 2020 2020 2065 6c69 6620 5b6e 2066         elif [n f
+0000d8c0: 6f72 206e 2069 6e20 6e65 7473 2069 6620  or n in nets if 
+0000d8d0: 6973 696e 7374 616e 6365 286e 2c20 6469  isinstance(n, di
+0000d8e0: 6374 2920 616e 6420 276e 6963 2720 696e  ct) and 'nic' in
+0000d8f0: 206e 5d3a 0a20 2020 2020 2020 2020 2020   n]:.           
+0000d900: 2077 6172 6e69 6e67 2822 596f 7572 206e   warning("Your n
+0000d910: 6574 7320 6465 6669 6e69 7469 6f6e 2063  ets definition c
+0000d920: 6f6e 7461 696e 7320 6e69 6320 6b65 7920  ontains nic key 
+0000d930: 7768 6963 6820 776f 6e27 7420 6265 2075  which won't be u
+0000d940: 7365 6422 290a 2020 2020 2020 2020 6966  sed").        if
+0000d950: 2027 6f77 6e65 7227 2069 6e20 7072 6f66   'owner' in prof
+0000d960: 696c 6520 6f72 2027 6f77 6e65 7227 2069  ile or 'owner' i
+0000d970: 6e20 6f76 6572 7269 6465 733a 0a20 2020  n overrides:.   
+0000d980: 2020 2020 2020 2020 206d 6574 6164 6174           metadat
+0000d990: 615b 276f 776e 6572 275d 203d 2070 726f  a['owner'] = pro
+0000d9a0: 6669 6c65 2e67 6574 2827 6f77 6e65 7227  file.get('owner'
+0000d9b0: 2920 6f72 206f 7665 7272 6964 6573 2e67  ) or overrides.g
+0000d9c0: 6574 2827 6f77 6e65 7227 290a 2020 2020  et('owner').    
+0000d9d0: 2020 2020 6966 2027 766d 7573 6572 2720      if 'vmuser' 
+0000d9e0: 696e 2070 726f 6669 6c65 206f 7220 2776  in profile or 'v
+0000d9f0: 6d75 7365 7227 2069 6e20 6f76 6572 7269  muser' in overri
+0000da00: 6465 733a 0a20 2020 2020 2020 2020 2020  des:.           
+0000da10: 206d 6574 6164 6174 615b 2775 7365 7227   metadata['user'
+0000da20: 5d20 3d20 7072 6f66 696c 652e 6765 7428  ] = profile.get(
+0000da30: 2776 6d75 7365 7227 2920 6f72 206f 7665  'vmuser') or ove
+0000da40: 7272 6964 6573 2e67 6574 2827 766d 7573  rrides.get('vmus
+0000da50: 6572 2729 0a20 2020 2020 2020 2065 6c69  er').        eli
+0000da60: 6620 2775 7365 7227 2069 6e20 7072 6f66  f 'user' in prof
+0000da70: 696c 6520 6f72 2027 7573 6572 2720 696e  ile or 'user' in
+0000da80: 206f 7665 7272 6964 6573 3a0a 2020 2020   overrides:.    
+0000da90: 2020 2020 2020 2020 6d65 7461 6461 7461          metadata
+0000daa0: 5b27 7573 6572 275d 203d 2070 726f 6669  ['user'] = profi
+0000dab0: 6c65 2e67 6574 2827 7573 6572 2729 206f  le.get('user') o
+0000dac0: 7220 6f76 6572 7269 6465 732e 6765 7428  r overrides.get(
+0000dad0: 2775 7365 7227 290a 2020 2020 2020 2020  'user').        
+0000dae0: 6966 206b 7562 6520 6973 206e 6f74 204e  if kube is not N
+0000daf0: 6f6e 6520 616e 6420 6b75 6265 7479 7065  one and kubetype
+0000db00: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+0000db10: 2020 2020 2020 2020 2020 6d65 7461 6461            metada
+0000db20: 7461 5b27 6b75 6265 7479 7065 275d 203d  ta['kubetype'] =
+0000db30: 206b 7562 6574 7970 650a 2020 2020 2020   kubetype.      
+0000db40: 2020 2020 2020 6d65 7461 6461 7461 5b27        metadata['
+0000db50: 6b75 6265 275d 203d 206b 7562 650a 2020  kube'] = kube.  
+0000db60: 2020 2020 2020 6966 2074 656d 706b 6579        if tempkey
+0000db70: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+0000db80: 206f 7665 7272 6964 6573 2e67 6574 2827   overrides.get('
+0000db90: 7465 6d70 6b65 7964 6972 2729 2069 7320  tempkeydir') is 
+0000dba0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+0000dbb0: 2020 2020 2020 7465 6d70 6b65 7964 6972        tempkeydir
+0000dbc0: 203d 2054 656d 706f 7261 7279 4469 7265   = TemporaryDire
+0000dbd0: 6374 6f72 7928 290a 2020 2020 2020 2020  ctory().        
+0000dbe0: 2020 2020 2020 2020 6f76 6572 7269 6465          override
+0000dbf0: 735b 2774 656d 706b 6579 6469 7227 5d20  s['tempkeydir'] 
+0000dc00: 3d20 7465 6d70 6b65 7964 6972 0a20 2020  = tempkeydir.   
+0000dc10: 2020 2020 2023 2063 6f6e 6670 6f6f 6c20       # confpool 
+0000dc20: 6861 6e64 6c69 6e67 2066 6f72 206e 6574  handling for net
+0000dc30: 776f 726b 0a20 2020 2020 2020 2066 6f72  work.        for
+0000dc40: 2069 6e64 6578 2c20 6e65 7420 696e 2065   index, net in e
+0000dc50: 6e75 6d65 7261 7465 286e 6574 7329 3a0a  numerate(nets):.
+0000dc60: 2020 2020 2020 2020 2020 2020 636f 6e66              conf
+0000dc70: 706f 6f6c 203d 204e 6f6e 650a 2020 2020  pool = None.    
+0000dc80: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+0000dc90: 7461 6e63 6528 6e65 742c 2064 6963 7429  tance(net, dict)
+0000dca0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000dcb0: 2020 636f 6e66 706f 6f6c 203d 206e 6574    confpool = net
+0000dcc0: 2e67 6574 2827 6970 706f 6f6c 2729 206f  .get('ippool') o
+0000dcd0: 7220 6e65 742e 6765 7428 2763 6f6e 6670  r net.get('confp
+0000dce0: 6f6f 6c27 290a 2020 2020 2020 2020 2020  ool').          
+0000dcf0: 2020 6966 2069 6e64 6578 203d 3d20 3020    if index == 0 
+0000dd00: 616e 6420 636f 6e66 706f 6f6c 2069 7320  and confpool is 
+0000dd10: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+0000dd20: 2020 2020 2020 636f 6e66 706f 6f6c 203d        confpool =
+0000dd30: 206f 7665 7272 6964 6573 2e67 6574 2827   overrides.get('
+0000dd40: 6970 706f 6f6c 2729 206f 7220 6f76 6572  ippool') or over
+0000dd50: 7269 6465 732e 6765 7428 2763 6f6e 6670  rides.get('confp
+0000dd60: 6f6f 6c27 290a 2020 2020 2020 2020 2020  ool').          
+0000dd70: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+0000dd80: 6e63 6528 6e65 742c 2073 7472 293a 0a20  nce(net, str):. 
+0000dd90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dda0: 2020 206e 6574 735b 696e 6465 785d 203d     nets[index] =
+0000ddb0: 207b 276e 616d 6527 3a20 6e65 747d 0a20   {'name': net}. 
+0000ddc0: 2020 2020 2020 2020 2020 2069 6620 636f             if co
+0000ddd0: 6e66 706f 6f6c 2069 7320 4e6f 6e65 3a0a  nfpool is None:.
+0000dde0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ddf0: 636f 6e74 696e 7565 0a20 2020 2020 2020  continue.       
+0000de00: 2020 2020 2069 6620 636f 6e66 706f 6f6c       if confpool
+0000de10: 206e 6f74 2069 6e20 7365 6c66 2e63 6f6e   not in self.con
+0000de20: 6670 6f6f 6c73 3a0a 2020 2020 2020 2020  fpools:.        
+0000de30: 2020 2020 2020 2020 6572 726f 7228 6622          error(f"
+0000de40: 7b63 6f6e 6670 6f6f 6c7d 2069 7320 6e6f  {confpool} is no
+0000de50: 7420 6120 7661 6c69 6420 636f 6e66 706f  t a valid confpo
+0000de60: 6f6c 2229 0a20 2020 2020 2020 2020 2020  ol").           
+0000de70: 2020 2020 2073 7973 2e65 7869 7428 3129       sys.exit(1)
+0000de80: 0a20 2020 2020 2020 2020 2020 2063 7572  .            cur
+0000de90: 7265 6e74 636f 6e66 706f 6f6c 203d 2073  rentconfpool = s
+0000dea0: 656c 662e 636f 6e66 706f 6f6c 735b 636f  elf.confpools[co
+0000deb0: 6e66 706f 6f6c 5d0a 2020 2020 2020 2020  nfpool].        
+0000dec0: 2020 2020 6970 5f72 6573 6572 7661 7469      ip_reservati
+0000ded0: 6f6e 7320 3d20 6375 7272 656e 7463 6f6e  ons = currentcon
+0000dee0: 6670 6f6f 6c2e 6765 7428 2769 705f 7265  fpool.get('ip_re
+0000def0: 7365 7276 6174 696f 6e73 272c 207b 7d29  servations', {})
+0000df00: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
+0000df10: 6572 7665 645f 6970 7320 3d20 6c69 7374  erved_ips = list
+0000df20: 2869 705f 7265 7365 7276 6174 696f 6e73  (ip_reservations
+0000df30: 2e76 616c 7565 7328 2929 0a20 2020 2020  .values()).     
+0000df40: 2020 2020 2020 2069 6620 2769 7073 2720         if 'ips' 
+0000df50: 696e 2063 7572 7265 6e74 636f 6e66 706f  in currentconfpo
+0000df60: 6f6c 3a0a 2020 2020 2020 2020 2020 2020  ol:.            
+0000df70: 2020 2020 6970 7320 3d20 6375 7272 656e      ips = curren
+0000df80: 7463 6f6e 6670 6f6f 6c5b 2769 7073 275d  tconfpool['ips']
+0000df90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000dfa0: 2069 6620 272f 2720 696e 2069 7073 3a0a   if '/' in ips:.
 0000dfb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dfc0: 6970 7320 3d20 6375 7272 656e 7463 6f6e  ips = currentcon
-0000dfd0: 6670 6f6f 6c5b 2769 7073 275d 0a20 2020  fpool['ips'].   
-0000dfe0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0000dff0: 272f 2720 696e 2069 7073 3a0a 2020 2020  '/' in ips:.    
-0000e000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e010: 6970 7320 3d20 5b73 7472 2869 2920 666f  ips = [str(i) fo
-0000e020: 7220 6920 696e 2069 705f 6e65 7477 6f72  r i in ip_networ
-0000e030: 6b28 6970 7329 5b31 3a2e 315d 5d0a 2020  k(ips)[1:.1]].  
-0000e040: 2020 2020 2020 2020 2020 2020 2020 6672                fr
-0000e050: 6565 5f69 7073 203d 205b 6970 2066 6f72  ee_ips = [ip for
-0000e060: 2069 7020 696e 2069 7073 2069 6620 6970   ip in ips if ip
-0000e070: 206e 6f74 2069 6e20 7265 7365 7276 6564   not in reserved
-0000e080: 5f69 7073 5d0a 2020 2020 2020 2020 2020  _ips].          
-0000e090: 2020 2020 2020 6966 2066 7265 655f 6970        if free_ip
-0000e0a0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-0000e0b0: 2020 2020 2020 2066 7265 655f 6970 203d         free_ip =
-0000e0c0: 2066 7265 655f 6970 735b 305d 0a20 2020   free_ips[0].   
-0000e0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e0e0: 2069 705f 7265 7365 7276 6174 696f 6e73   ip_reservations
-0000e0f0: 5b6e 616d 655d 203d 2066 7265 655f 6970  [name] = free_ip
-0000e100: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e110: 2020 2020 2070 7072 696e 7428 6622 5573       pprint(f"Us
-0000e120: 696e 6720 6970 207b 6672 6565 5f69 707d  ing ip {free_ip}
-0000e130: 2066 726f 6d20 636f 6e66 706f 6f6c 207b   from confpool {
-0000e140: 636f 6e66 706f 6f6c 7d20 696e 206e 6574  confpool} in net
-0000e150: 207b 696e 6465 787d 2229 0a20 2020 2020   {index}").     
-0000e160: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-0000e170: 6577 5f63 6f6e 6620 3d20 6375 7272 656e  ew_conf = curren
-0000e180: 7463 6f6e 6670 6f6f 6c2e 636f 7079 2829  tconfpool.copy()
-0000e190: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e1a0: 2020 2020 206e 6577 5f63 6f6e 665b 2769       new_conf['i
-0000e1b0: 7027 5d20 3d20 6672 6565 5f69 700a 2020  p'] = free_ip.  
-0000e1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e1d0: 2020 6e65 7473 5b69 6e64 6578 5d2e 7570    nets[index].up
-0000e1e0: 6461 7465 2863 7572 7265 6e74 636f 6e66  date(currentconf
-0000e1f0: 706f 6f6c 290a 2020 2020 2020 2020 2020  pool).          
-0000e200: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-0000e210: 206f 6e6c 7961 7373 6574 733a 0a20 2020   onlyassets:.   
-0000e220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e230: 2020 2020 2073 656c 662e 7570 6461 7465       self.update
-0000e240: 5f63 6f6e 6670 6f6f 6c28 636f 6e66 706f  _confpool(confpo
-0000e250: 6f6c 2c20 7b27 6970 5f72 6573 6572 7661  ol, {'ip_reserva
-0000e260: 7469 6f6e 7327 3a20 6970 5f72 6573 6572  tions': ip_reser
-0000e270: 7661 7469 6f6e 737d 290a 2020 2020 2020  vations}).      
-0000e280: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-0000e290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e2a0: 2020 2020 6572 726f 7228 6622 4e6f 2061      error(f"No a
-0000e2b0: 7661 696c 6162 6c65 2069 7020 696e 2063  vailable ip in c
-0000e2c0: 6f6e 6670 6f6f 6c20 7b63 6f6e 6670 6f6f  onfpool {confpoo
-0000e2d0: 6c7d 2229 0a20 2020 2020 2020 2020 2020  l}").           
-0000e2e0: 2020 2020 2020 2020 2073 7973 2e65 7869           sys.exi
-0000e2f0: 7428 3129 0a20 2020 2020 2020 2069 6620  t(1).        if 
-0000e300: 6f6e 6c79 6173 7365 7473 3a0a 2020 2020  onlyassets:.    
-0000e310: 2020 2020 2020 2020 696d 6167 6520 3d20          image = 
-0000e320: 696d 6167 6520 6f72 2070 726f 6669 6c65  image or profile
-0000e330: 6e61 6d65 0a20 2020 2020 2020 2020 2020  name.           
-0000e340: 2072 6573 756c 7420 3d20 7b27 7265 7375   result = {'resu
-0000e350: 6c74 273a 2027 7375 6363 6573 7327 7d0a  lt': 'success'}.
-0000e360: 2020 2020 2020 2020 2020 2020 6966 2063              if c
-0000e370: 6f6d 6d6f 6e2e 6e65 6564 735f 6967 6e69  ommon.needs_igni
-0000e380: 7469 6f6e 2869 6d61 6765 293a 0a20 2020  tion(image):.   
-0000e390: 2020 2020 2020 2020 2020 2020 2076 6572               ver
-0000e3a0: 7369 6f6e 203d 2063 6f6d 6d6f 6e2e 6967  sion = common.ig
-0000e3b0: 6e69 7469 6f6e 5f76 6572 7369 6f6e 2869  nition_version(i
-0000e3c0: 6d61 6765 290a 2020 2020 2020 2020 2020  mage).          
-0000e3d0: 2020 2020 2020 636f 6d70 6163 7420 3d20        compact = 
-0000e3e0: 5472 7565 2069 6620 6f76 6572 7269 6465  True if override
-0000e3f0: 732e 6765 7428 2763 6f6d 7061 6374 2729  s.get('compact')
-0000e400: 2065 6c73 6520 4661 6c73 650a 2020 2020   else False.    
-0000e410: 2020 2020 2020 2020 2020 2020 7573 6572              user
-0000e420: 6461 7461 203d 2063 6f6d 6d6f 6e2e 6967  data = common.ig
-0000e430: 6e69 7469 6f6e 286e 616d 653d 6e61 6d65  nition(name=name
-0000e440: 2c20 6b65 7973 3d6b 6579 732c 2063 6d64  , keys=keys, cmd
-0000e450: 733d 636d 6473 2c20 6e65 7473 3d6e 6574  s=cmds, nets=net
-0000e460: 732c 2067 6174 6577 6179 3d67 6174 6577  s, gateway=gatew
-0000e470: 6179 2c20 646e 733d 646e 732c 0a20 2020  ay, dns=dns,.   
-0000e480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e4a0: 2020 2020 2020 2020 646f 6d61 696e 3d64          domain=d
-0000e4b0: 6f6d 6169 6e2c 2066 696c 6573 3d66 696c  omain, files=fil
-0000e4c0: 6573 2c20 656e 6162 6c65 726f 6f74 3d65  es, enableroot=e
-0000e4d0: 6e61 626c 6572 6f6f 742c 206f 7665 7272  nableroot, overr
-0000e4e0: 6964 6573 3d6f 7665 7272 6964 6573 2c0a  ides=overrides,.
-0000e4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e510: 2020 2020 2020 2020 2020 2076 6572 7369             versi
-0000e520: 6f6e 3d76 6572 7369 6f6e 2c20 706c 616e  on=version, plan
-0000e530: 3d70 6c61 6e2c 2069 6d61 6765 3d69 6d61  =plan, image=ima
-0000e540: 6765 2c20 636f 6d70 6163 743d 636f 6d70  ge, compact=comp
-0000e550: 6163 742c 0a20 2020 2020 2020 2020 2020  act,.           
-0000e560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e580: 766d 7573 6572 3d76 6d75 7365 7229 0a20  vmuser=vmuser). 
-0000e590: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0000e5a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e5b0: 2075 7365 7264 6174 612c 206d 6574 6164   userdata, metad
-0000e5c0: 6174 612c 206e 6574 6461 7461 203d 2063  ata, netdata = c
-0000e5d0: 6f6d 6d6f 6e2e 636c 6f75 6469 6e69 7428  ommon.cloudinit(
-0000e5e0: 6e61 6d65 2c20 6b65 7973 3d6b 6579 732c  name, keys=keys,
-0000e5f0: 2063 6d64 733d 636d 6473 2c20 6e65 7473   cmds=cmds, nets
-0000e600: 3d6e 6574 732c 2067 6174 6577 6179 3d67  =nets, gateway=g
-0000e610: 6174 6577 6179 2c0a 2020 2020 2020 2020  ateway,.        
-0000e620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dfc0: 2020 2020 6970 7320 3d20 5b73 7472 2869      ips = [str(i
+0000dfd0: 2920 666f 7220 6920 696e 2069 705f 6e65  ) for i in ip_ne
+0000dfe0: 7477 6f72 6b28 6970 7329 5b31 3a2e 315d  twork(ips)[1:.1]
+0000dff0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+0000e000: 2020 6672 6565 5f69 7073 203d 205b 6970    free_ips = [ip
+0000e010: 2066 6f72 2069 7020 696e 2069 7073 2069   for ip in ips i
+0000e020: 6620 6970 206e 6f74 2069 6e20 7265 7365  f ip not in rese
+0000e030: 7276 6564 5f69 7073 5d0a 2020 2020 2020  rved_ips].      
+0000e040: 2020 2020 2020 2020 2020 6966 2066 7265            if fre
+0000e050: 655f 6970 733a 0a20 2020 2020 2020 2020  e_ips:.         
+0000e060: 2020 2020 2020 2020 2020 2066 7265 655f             free_
+0000e070: 6970 203d 2066 7265 655f 6970 735b 305d  ip = free_ips[0]
+0000e080: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e090: 2020 2020 2069 705f 7265 7365 7276 6174       ip_reservat
+0000e0a0: 696f 6e73 5b6e 616d 655d 203d 2066 7265  ions[name] = fre
+0000e0b0: 655f 6970 0a20 2020 2020 2020 2020 2020  e_ip.           
+0000e0c0: 2020 2020 2020 2020 2070 7072 696e 7428           pprint(
+0000e0d0: 6622 5573 696e 6720 6970 207b 6672 6565  f"Using ip {free
+0000e0e0: 5f69 707d 2066 726f 6d20 636f 6e66 706f  _ip} from confpo
+0000e0f0: 6f6c 207b 636f 6e66 706f 6f6c 7d20 696e  ol {confpool} in
+0000e100: 206e 6574 207b 696e 6465 787d 2229 0a20   net {index}"). 
+0000e110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e120: 2020 206e 6577 5f63 6f6e 6620 3d20 6375     new_conf = cu
+0000e130: 7272 656e 7463 6f6e 6670 6f6f 6c2e 636f  rrentconfpool.co
+0000e140: 7079 2829 0a20 2020 2020 2020 2020 2020  py().           
+0000e150: 2020 2020 2020 2020 206e 6577 5f63 6f6e           new_con
+0000e160: 665b 2769 7027 5d20 3d20 6672 6565 5f69  f['ip'] = free_i
+0000e170: 700a 2020 2020 2020 2020 2020 2020 2020  p.              
+0000e180: 2020 2020 2020 6e65 7473 5b69 6e64 6578        nets[index
+0000e190: 5d2e 7570 6461 7465 2863 7572 7265 6e74  ].update(current
+0000e1a0: 636f 6e66 706f 6f6c 290a 2020 2020 2020  confpool).      
+0000e1b0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0000e1c0: 206e 6f74 206f 6e6c 7961 7373 6574 733a   not onlyassets:
+0000e1d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e1e0: 2020 2020 2020 2020 2073 656c 662e 7570           self.up
+0000e1f0: 6461 7465 5f63 6f6e 6670 6f6f 6c28 636f  date_confpool(co
+0000e200: 6e66 706f 6f6c 2c20 7b27 6970 5f72 6573  nfpool, {'ip_res
+0000e210: 6572 7661 7469 6f6e 7327 3a20 6970 5f72  ervations': ip_r
+0000e220: 6573 6572 7661 7469 6f6e 737d 290a 2020  eservations}).  
+0000e230: 2020 2020 2020 2020 2020 2020 2020 656c                el
+0000e240: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0000e250: 2020 2020 2020 2020 6572 726f 7228 6622          error(f"
+0000e260: 4e6f 2061 7661 696c 6162 6c65 2069 7020  No available ip 
+0000e270: 696e 2063 6f6e 6670 6f6f 6c20 7b63 6f6e  in confpool {con
+0000e280: 6670 6f6f 6c7d 2229 0a20 2020 2020 2020  fpool}").       
+0000e290: 2020 2020 2020 2020 2020 2020 2073 7973               sys
+0000e2a0: 2e65 7869 7428 3129 0a20 2020 2020 2020  .exit(1).       
+0000e2b0: 2069 6620 6f6e 6c79 6173 7365 7473 3a0a   if onlyassets:.
+0000e2c0: 2020 2020 2020 2020 2020 2020 696d 6167              imag
+0000e2d0: 6520 3d20 696d 6167 6520 6f72 2070 726f  e = image or pro
+0000e2e0: 6669 6c65 6e61 6d65 0a20 2020 2020 2020  filename.       
+0000e2f0: 2020 2020 2072 6573 756c 7420 3d20 7b27       result = {'
+0000e300: 7265 7375 6c74 273a 2027 7375 6363 6573  result': 'succes
+0000e310: 7327 7d0a 2020 2020 2020 2020 2020 2020  s'}.            
+0000e320: 6966 2063 6f6d 6d6f 6e2e 6e65 6564 735f  if common.needs_
+0000e330: 6967 6e69 7469 6f6e 2869 6d61 6765 293a  ignition(image):
+0000e340: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e350: 2076 6572 7369 6f6e 203d 2063 6f6d 6d6f   version = commo
+0000e360: 6e2e 6967 6e69 7469 6f6e 5f76 6572 7369  n.ignition_versi
+0000e370: 6f6e 2869 6d61 6765 290a 2020 2020 2020  on(image).      
+0000e380: 2020 2020 2020 2020 2020 636f 6d70 6163            compac
+0000e390: 7420 3d20 5472 7565 2069 6620 6f76 6572  t = True if over
+0000e3a0: 7269 6465 732e 6765 7428 2763 6f6d 7061  rides.get('compa
+0000e3b0: 6374 2729 2065 6c73 6520 4661 6c73 650a  ct') else False.
+0000e3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e3d0: 7573 6572 6461 7461 203d 2063 6f6d 6d6f  userdata = commo
+0000e3e0: 6e2e 6967 6e69 7469 6f6e 286e 616d 653d  n.ignition(name=
+0000e3f0: 6e61 6d65 2c20 6b65 7973 3d6b 6579 732c  name, keys=keys,
+0000e400: 2063 6d64 733d 636d 6473 2c20 6e65 7473   cmds=cmds, nets
+0000e410: 3d6e 6574 732c 2067 6174 6577 6179 3d67  =nets, gateway=g
+0000e420: 6174 6577 6179 2c20 646e 733d 646e 732c  ateway, dns=dns,
+0000e430: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e450: 2020 2020 2020 2020 2020 2020 646f 6d61              doma
+0000e460: 696e 3d64 6f6d 6169 6e2c 2066 696c 6573  in=domain, files
+0000e470: 3d66 696c 6573 2c20 656e 6162 6c65 726f  =files, enablero
+0000e480: 6f74 3d65 6e61 626c 6572 6f6f 742c 206f  ot=enableroot, o
+0000e490: 7665 7272 6964 6573 3d6f 7665 7272 6964  verrides=overrid
+0000e4a0: 6573 2c0a 2020 2020 2020 2020 2020 2020  es,.            
+0000e4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e4c0: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+0000e4d0: 6572 7369 6f6e 3d76 6572 7369 6f6e 2c20  ersion=version, 
+0000e4e0: 706c 616e 3d70 6c61 6e2c 2069 6d61 6765  plan=plan, image
+0000e4f0: 3d69 6d61 6765 2c20 636f 6d70 6163 743d  =image, compact=
+0000e500: 636f 6d70 6163 742c 0a20 2020 2020 2020  compact,.       
+0000e510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e530: 2020 2020 766d 7573 6572 3d76 6d75 7365      vmuser=vmuse
+0000e540: 7229 0a20 2020 2020 2020 2020 2020 2065  r).            e
+0000e550: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0000e560: 2020 2020 2075 7365 7264 6174 612c 206d       userdata, m
+0000e570: 6574 6164 6174 612c 206e 6574 6461 7461  etadata, netdata
+0000e580: 203d 2063 6f6d 6d6f 6e2e 636c 6f75 6469   = common.cloudi
+0000e590: 6e69 7428 6e61 6d65 2c20 6b65 7973 3d6b  nit(name, keys=k
+0000e5a0: 6579 732c 2063 6d64 733d 636d 6473 2c20  eys, cmds=cmds, 
+0000e5b0: 6e65 7473 3d6e 6574 732c 2067 6174 6577  nets=nets, gatew
+0000e5c0: 6179 3d67 6174 6577 6179 2c0a 2020 2020  ay=gateway,.    
+0000e5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e600: 2020 2020 2020 2020 2020 2064 6e73 3d64             dns=d
+0000e610: 6e73 2c20 646f 6d61 696e 3d64 6f6d 6169  ns, domain=domai
+0000e620: 6e2c 2066 696c 6573 3d66 696c 6573 2c0a  n, files=files,.
 0000e630: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000e640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e650: 2020 2020 2020 2064 6e73 3d64 6e73 2c20         dns=dns, 
-0000e660: 646f 6d61 696e 3d64 6f6d 6169 6e2c 2066  domain=domain, f
-0000e670: 696c 6573 3d66 696c 6573 2c0a 2020 2020  iles=files,.    
-0000e680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e660: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0000e670: 6e61 626c 6572 6f6f 743d 656e 6162 6c65  nableroot=enable
+0000e680: 726f 6f74 2c20 6f76 6572 7269 6465 733d  root, overrides=
+0000e690: 6f76 6572 7269 6465 732c 0a20 2020 2020  overrides,.     
 0000e6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e6b0: 2020 2020 2020 2020 2020 2065 6e61 626c             enabl
-0000e6c0: 6572 6f6f 743d 656e 6162 6c65 726f 6f74  eroot=enableroot
-0000e6d0: 2c20 6f76 6572 7269 6465 733d 6f76 6572  , overrides=over
-0000e6e0: 7269 6465 732c 0a20 2020 2020 2020 2020  rides,.         
-0000e6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e720: 2020 2020 2020 696d 6167 653d 696d 6167        image=imag
-0000e730: 652c 2073 746f 7265 6d65 7461 6461 7461  e, storemetadata
-0000e740: 3d73 746f 7265 6d65 7461 6461 7461 2c20  =storemetadata, 
-0000e750: 766d 7573 6572 3d76 6d75 7365 7229 0a20  vmuser=vmuser). 
-0000e760: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0000e770: 6620 6e65 7464 6174 6120 6973 206e 6f74  f netdata is not
-0000e780: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-0000e790: 2020 2020 2020 2020 2020 2072 6573 756c             resul
-0000e7a0: 745b 276e 6574 6461 7461 275d 203d 206e  t['netdata'] = n
-0000e7b0: 6574 6461 7461 0a20 2020 2020 2020 2020  etdata.         
-0000e7c0: 2020 2072 6573 756c 745b 2775 7365 7264     result['userd
-0000e7d0: 6174 6127 5d20 3d20 7573 6572 6461 7461  ata'] = userdata
-0000e7e0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0000e7f0: 7572 6e20 7265 7375 6c74 0a20 2020 2020  urn result.     
-0000e800: 2020 2072 6573 756c 7420 3d20 6b2e 6372     result = k.cr
-0000e810: 6561 7465 286e 616d 653d 6e61 6d65 2c20  eate(name=name, 
-0000e820: 7669 7274 7479 7065 3d76 6972 7474 7970  virttype=virttyp
-0000e830: 652c 2070 6c61 6e3d 706c 616e 2c20 7072  e, plan=plan, pr
-0000e840: 6f66 696c 653d 7072 6f66 696c 656e 616d  ofile=profilenam
-0000e850: 652c 2066 6c61 766f 723d 666c 6176 6f72  e, flavor=flavor
-0000e860: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000e870: 2020 2020 2020 2020 2020 2020 6370 756d              cpum
-0000e880: 6f64 656c 3d63 7075 6d6f 6465 6c2c 2063  odel=cpumodel, c
-0000e890: 7075 666c 6167 733d 6370 7566 6c61 6773  puflags=cpuflags
-0000e8a0: 2c20 6370 7570 696e 6e69 6e67 3d63 7075  , cpupinning=cpu
-0000e8b0: 7069 6e6e 696e 672c 206e 756d 616d 6f64  pinning, numamod
-0000e8c0: 653d 6e75 6d61 6d6f 6465 2c20 6e75 6d61  e=numamode, numa
-0000e8d0: 3d6e 756d 612c 0a20 2020 2020 2020 2020  =numa,.         
-0000e8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e8f0: 206e 756d 6370 7573 3d69 6e74 286e 756d   numcpus=int(num
-0000e900: 6370 7573 292c 206d 656d 6f72 793d 696e  cpus), memory=in
-0000e910: 7428 6d65 6d6f 7279 292c 2067 7565 7374  t(memory), guest
-0000e920: 6964 3d67 7565 7374 6964 2c20 706f 6f6c  id=guestid, pool
-0000e930: 3d70 6f6f 6c2c 0a20 2020 2020 2020 2020  =pool,.         
-0000e940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e950: 2069 6d61 6765 3d69 6d61 6765 2c20 6469   image=image, di
-0000e960: 736b 733d 6469 736b 732c 2064 6973 6b73  sks=disks, disks
-0000e970: 697a 653d 6469 736b 7369 7a65 2c20 6469  ize=disksize, di
-0000e980: 736b 7468 696e 3d64 6973 6b74 6869 6e2c  skthin=diskthin,
-0000e990: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e9a0: 2020 2020 2020 2020 2020 2064 6973 6b69             diski
-0000e9b0: 6e74 6572 6661 6365 3d64 6973 6b69 6e74  nterface=diskint
-0000e9c0: 6572 6661 6365 2c20 6e65 7473 3d6e 6574  erface, nets=net
-0000e9d0: 732c 2069 736f 3d69 736f 2c20 766e 633d  s, iso=iso, vnc=
-0000e9e0: 626f 6f6c 2876 6e63 292c 2063 6c6f 7564  bool(vnc), cloud
-0000e9f0: 696e 6974 3d62 6f6f 6c28 636c 6f75 6469  init=bool(cloudi
-0000ea00: 6e69 7429 2c0a 2020 2020 2020 2020 2020  nit),.          
-0000ea10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ea20: 7265 7365 7276 6569 703d 626f 6f6c 2872  reserveip=bool(r
-0000ea30: 6573 6572 7665 6970 292c 2072 6573 6572  eserveip), reser
-0000ea40: 7665 646e 733d 626f 6f6c 2872 6573 6572  vedns=bool(reser
-0000ea50: 7665 646e 7329 2c20 7265 7365 7276 6568  vedns), reserveh
-0000ea60: 6f73 743d 626f 6f6c 2872 6573 6572 7665  ost=bool(reserve
-0000ea70: 686f 7374 292c 0a20 2020 2020 2020 2020  host),.         
-0000ea80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ea90: 2073 7461 7274 3d62 6f6f 6c28 7374 6172   start=bool(star
-0000eaa0: 7429 2c20 6b65 7973 3d6b 6579 732c 2063  t), keys=keys, c
-0000eab0: 6d64 733d 636d 6473 2c20 6970 733d 6970  mds=cmds, ips=ip
-0000eac0: 732c 206e 6574 6d61 736b 733d 6e65 746d  s, netmasks=netm
-0000ead0: 6173 6b73 2c20 6761 7465 7761 793d 6761  asks, gateway=ga
-0000eae0: 7465 7761 792c 2064 6e73 3d64 6e73 2c0a  teway, dns=dns,.
-0000eaf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000eb00: 2020 2020 2020 2020 2020 646f 6d61 696e            domain
-0000eb10: 3d64 6f6d 6169 6e2c 206e 6573 7465 643d  =domain, nested=
-0000eb20: 626f 6f6c 286e 6573 7465 6429 2c20 7475  bool(nested), tu
-0000eb30: 6e6e 656c 3d74 756e 6e65 6c2c 2066 696c  nnel=tunnel, fil
-0000eb40: 6573 3d66 696c 6573 2c20 656e 6162 6c65  es=files, enable
-0000eb50: 726f 6f74 3d65 6e61 626c 6572 6f6f 742c  root=enableroot,
-0000eb60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000eb70: 2020 2020 2020 2020 2020 206f 7665 7272             overr
-0000eb80: 6964 6573 3d6f 7665 7272 6964 6573 2c20  ides=overrides, 
-0000eb90: 7461 6773 3d74 6167 732c 2073 746f 7265  tags=tags, store
-0000eba0: 6d65 7461 6461 7461 3d73 746f 7265 6d65  metadata=storeme
-0000ebb0: 7461 6461 7461 2c0a 2020 2020 2020 2020  tadata,.        
-0000ebc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ebd0: 2020 7368 6172 6564 666f 6c64 6572 733d    sharedfolders=
-0000ebe0: 7368 6172 6564 666f 6c64 6572 732c 206b  sharedfolders, k
-0000ebf0: 6572 6e65 6c3d 6b65 726e 656c 2c20 696e  ernel=kernel, in
-0000ec00: 6974 7264 3d69 6e69 7472 642c 2063 6d64  itrd=initrd, cmd
-0000ec10: 6c69 6e65 3d63 6d64 6c69 6e65 2c0a 2020  line=cmdline,.  
-0000ec20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ec30: 2020 2020 2020 2020 706c 6163 656d 656e          placemen
-0000ec40: 743d 706c 6163 656d 656e 742c 2061 7574  t=placement, aut
-0000ec50: 6f73 7461 7274 3d61 7574 6f73 7461 7274  ostart=autostart
-0000ec60: 2c20 6370 7568 6f74 706c 7567 3d63 7075  , cpuhotplug=cpu
-0000ec70: 686f 7470 6c75 672c 206d 656d 6f72 7968  hotplug, memoryh
-0000ec80: 6f74 706c 7567 3d6d 656d 6f72 7968 6f74  otplug=memoryhot
-0000ec90: 706c 7567 2c0a 2020 2020 2020 2020 2020  plug,.          
-0000eca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ecb0: 7063 6964 6576 6963 6573 3d70 6369 6465  pcidevices=pcide
-0000ecc0: 7669 6365 732c 2074 706d 3d74 706d 2c20  vices, tpm=tpm, 
-0000ecd0: 726e 673d 726e 672c 206d 6574 6164 6174  rng=rng, metadat
-0000ece0: 613d 6d65 7461 6461 7461 2c20 7365 6375  a=metadata, secu
-0000ecf0: 7269 7479 6772 6f75 7073 3d73 6563 7572  ritygroups=secur
-0000ed00: 6974 7967 726f 7570 732c 0a20 2020 2020  itygroups,.     
-0000ed10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ed20: 2020 2020 2076 6d75 7365 723d 766d 7573       vmuser=vmus
-0000ed30: 6572 290a 2020 2020 2020 2020 6966 2072  er).        if r
-0000ed40: 6573 756c 745b 2772 6573 756c 7427 5d20  esult['result'] 
-0000ed50: 213d 2027 7375 6363 6573 7327 3a0a 2020  != 'success':.  
-0000ed60: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0000ed70: 2072 6573 756c 740a 2020 2020 2020 2020   result.        
-0000ed80: 6966 2072 6573 6572 7665 646e 7320 616e  if reservedns an
-0000ed90: 6420 646e 7363 6c69 656e 7420 6973 206e  d dnsclient is n
-0000eda0: 6f74 204e 6f6e 6520 616e 6420 646f 6d61  ot None and doma
-0000edb0: 696e 2069 7320 6e6f 7420 4e6f 6e65 3a0a  in is not None:.
-0000edc0: 2020 2020 2020 2020 2020 2020 6966 2064              if d
-0000edd0: 6e73 636c 6965 6e74 2069 6e20 7365 6c66  nsclient in self
-0000ede0: 2e63 6c69 656e 7473 3a0a 2020 2020 2020  .clients:.      
-0000edf0: 2020 2020 2020 2020 2020 7a20 3d20 4b63            z = Kc
-0000ee00: 6f6e 6669 6728 636c 6965 6e74 3d64 6e73  onfig(client=dns
-0000ee10: 636c 6965 6e74 292e 6b0a 2020 2020 2020  client).k.      
-0000ee20: 2020 2020 2020 2020 2020 6970 203d 204e            ip = N
-0000ee30: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-0000ee40: 2020 2020 6966 2069 7020 6973 204e 6f6e      if ip is Non
-0000ee50: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0000ee60: 2020 2020 2020 2063 6f75 6e74 6572 203d         counter =
-0000ee70: 2030 0a20 2020 2020 2020 2020 2020 2020   0.             
-0000ee80: 2020 2020 2020 2077 6869 6c65 2063 6f75         while cou
-0000ee90: 6e74 6572 2021 3d20 3330 303a 0a20 2020  nter != 300:.   
+0000e6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e6d0: 2020 2020 2020 2020 2020 696d 6167 653d            image=
+0000e6e0: 696d 6167 652c 2073 746f 7265 6d65 7461  image, storemeta
+0000e6f0: 6461 7461 3d73 746f 7265 6d65 7461 6461  data=storemetada
+0000e700: 7461 2c20 766d 7573 6572 3d76 6d75 7365  ta, vmuser=vmuse
+0000e710: 7229 0a20 2020 2020 2020 2020 2020 2020  r).             
+0000e720: 2020 2069 6620 6e65 7464 6174 6120 6973     if netdata is
+0000e730: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+0000e740: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0000e750: 6573 756c 745b 276e 6574 6461 7461 275d  esult['netdata']
+0000e760: 203d 206e 6574 6461 7461 0a20 2020 2020   = netdata.     
+0000e770: 2020 2020 2020 2072 6573 756c 745b 2775         result['u
+0000e780: 7365 7264 6174 6127 5d20 3d20 7573 6572  serdata'] = user
+0000e790: 6461 7461 0a20 2020 2020 2020 2020 2020  data.           
+0000e7a0: 2072 6574 7572 6e20 7265 7375 6c74 0a20   return result. 
+0000e7b0: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
+0000e7c0: 6b2e 6372 6561 7465 286e 616d 653d 6e61  k.create(name=na
+0000e7d0: 6d65 2c20 7669 7274 7479 7065 3d76 6972  me, virttype=vir
+0000e7e0: 7474 7970 652c 2070 6c61 6e3d 706c 616e  ttype, plan=plan
+0000e7f0: 2c20 7072 6f66 696c 653d 7072 6f66 696c  , profile=profil
+0000e800: 656e 616d 652c 2066 6c61 766f 723d 666c  ename, flavor=fl
+0000e810: 6176 6f72 2c0a 2020 2020 2020 2020 2020  avor,.          
+0000e820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e830: 6370 756d 6f64 656c 3d63 7075 6d6f 6465  cpumodel=cpumode
+0000e840: 6c2c 2063 7075 666c 6167 733d 6370 7566  l, cpuflags=cpuf
+0000e850: 6c61 6773 2c20 6370 7570 696e 6e69 6e67  lags, cpupinning
+0000e860: 3d63 7075 7069 6e6e 696e 672c 206e 756d  =cpupinning, num
+0000e870: 616d 6f64 653d 6e75 6d61 6d6f 6465 2c20  amode=numamode, 
+0000e880: 6e75 6d61 3d6e 756d 612c 0a20 2020 2020  numa=numa,.     
+0000e890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e8a0: 2020 2020 206e 756d 6370 7573 3d69 6e74       numcpus=int
+0000e8b0: 286e 756d 6370 7573 292c 206d 656d 6f72  (numcpus), memor
+0000e8c0: 793d 696e 7428 6d65 6d6f 7279 292c 2067  y=int(memory), g
+0000e8d0: 7565 7374 6964 3d67 7565 7374 6964 2c20  uestid=guestid, 
+0000e8e0: 706f 6f6c 3d70 6f6f 6c2c 0a20 2020 2020  pool=pool,.     
+0000e8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e900: 2020 2020 2069 6d61 6765 3d69 6d61 6765       image=image
+0000e910: 2c20 6469 736b 733d 6469 736b 732c 2064  , disks=disks, d
+0000e920: 6973 6b73 697a 653d 6469 736b 7369 7a65  isksize=disksize
+0000e930: 2c20 6469 736b 7468 696e 3d64 6973 6b74  , diskthin=diskt
+0000e940: 6869 6e2c 0a20 2020 2020 2020 2020 2020  hin,.           
+0000e950: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+0000e960: 6973 6b69 6e74 6572 6661 6365 3d64 6973  iskinterface=dis
+0000e970: 6b69 6e74 6572 6661 6365 2c20 6e65 7473  kinterface, nets
+0000e980: 3d6e 6574 732c 2069 736f 3d69 736f 2c20  =nets, iso=iso, 
+0000e990: 766e 633d 626f 6f6c 2876 6e63 292c 2063  vnc=bool(vnc), c
+0000e9a0: 6c6f 7564 696e 6974 3d62 6f6f 6c28 636c  loudinit=bool(cl
+0000e9b0: 6f75 6469 6e69 7429 2c0a 2020 2020 2020  oudinit),.      
+0000e9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e9d0: 2020 2020 7265 7365 7276 6569 703d 626f      reserveip=bo
+0000e9e0: 6f6c 2872 6573 6572 7665 6970 292c 2072  ol(reserveip), r
+0000e9f0: 6573 6572 7665 646e 733d 626f 6f6c 2872  eservedns=bool(r
+0000ea00: 6573 6572 7665 646e 7329 2c20 7265 7365  eservedns), rese
+0000ea10: 7276 6568 6f73 743d 626f 6f6c 2872 6573  rvehost=bool(res
+0000ea20: 6572 7665 686f 7374 292c 0a20 2020 2020  ervehost),.     
+0000ea30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ea40: 2020 2020 2073 7461 7274 3d62 6f6f 6c28       start=bool(
+0000ea50: 7374 6172 7429 2c20 6b65 7973 3d6b 6579  start), keys=key
+0000ea60: 732c 2063 6d64 733d 636d 6473 2c20 6970  s, cmds=cmds, ip
+0000ea70: 733d 6970 732c 206e 6574 6d61 736b 733d  s=ips, netmasks=
+0000ea80: 6e65 746d 6173 6b73 2c20 6761 7465 7761  netmasks, gatewa
+0000ea90: 793d 6761 7465 7761 792c 2064 6e73 3d64  y=gateway, dns=d
+0000eaa0: 6e73 2c0a 2020 2020 2020 2020 2020 2020  ns,.            
+0000eab0: 2020 2020 2020 2020 2020 2020 2020 646f                do
+0000eac0: 6d61 696e 3d64 6f6d 6169 6e2c 206e 6573  main=domain, nes
+0000ead0: 7465 643d 626f 6f6c 286e 6573 7465 6429  ted=bool(nested)
+0000eae0: 2c20 7475 6e6e 656c 3d74 756e 6e65 6c2c  , tunnel=tunnel,
+0000eaf0: 2066 696c 6573 3d66 696c 6573 2c20 656e   files=files, en
+0000eb00: 6162 6c65 726f 6f74 3d65 6e61 626c 6572  ableroot=enabler
+0000eb10: 6f6f 742c 0a20 2020 2020 2020 2020 2020  oot,.           
+0000eb20: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+0000eb30: 7665 7272 6964 6573 3d6f 7665 7272 6964  verrides=overrid
+0000eb40: 6573 2c20 7461 6773 3d74 6167 732c 2073  es, tags=tags, s
+0000eb50: 746f 7265 6d65 7461 6461 7461 3d73 746f  toremetadata=sto
+0000eb60: 7265 6d65 7461 6461 7461 2c0a 2020 2020  remetadata,.    
+0000eb70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eb80: 2020 2020 2020 7368 6172 6564 666f 6c64        sharedfold
+0000eb90: 6572 733d 7368 6172 6564 666f 6c64 6572  ers=sharedfolder
+0000eba0: 732c 206b 6572 6e65 6c3d 6b65 726e 656c  s, kernel=kernel
+0000ebb0: 2c20 696e 6974 7264 3d69 6e69 7472 642c  , initrd=initrd,
+0000ebc0: 2063 6d64 6c69 6e65 3d63 6d64 6c69 6e65   cmdline=cmdline
+0000ebd0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000ebe0: 2020 2020 2020 2020 2020 2020 706c 6163              plac
+0000ebf0: 656d 656e 743d 706c 6163 656d 656e 742c  ement=placement,
+0000ec00: 2061 7574 6f73 7461 7274 3d61 7574 6f73   autostart=autos
+0000ec10: 7461 7274 2c20 6370 7568 6f74 706c 7567  tart, cpuhotplug
+0000ec20: 3d63 7075 686f 7470 6c75 672c 206d 656d  =cpuhotplug, mem
+0000ec30: 6f72 7968 6f74 706c 7567 3d6d 656d 6f72  oryhotplug=memor
+0000ec40: 7968 6f74 706c 7567 2c0a 2020 2020 2020  yhotplug,.      
+0000ec50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ec60: 2020 2020 7063 6964 6576 6963 6573 3d70      pcidevices=p
+0000ec70: 6369 6465 7669 6365 732c 2074 706d 3d74  cidevices, tpm=t
+0000ec80: 706d 2c20 726e 673d 726e 672c 206d 6574  pm, rng=rng, met
+0000ec90: 6164 6174 613d 6d65 7461 6461 7461 2c20  adata=metadata, 
+0000eca0: 7365 6375 7269 7479 6772 6f75 7073 3d73  securitygroups=s
+0000ecb0: 6563 7572 6974 7967 726f 7570 732c 0a20  ecuritygroups,. 
+0000ecc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ecd0: 2020 2020 2020 2020 2076 6d75 7365 723d           vmuser=
+0000ece0: 766d 7573 6572 290a 2020 2020 2020 2020  vmuser).        
+0000ecf0: 6966 2072 6573 756c 745b 2772 6573 756c  if result['resul
+0000ed00: 7427 5d20 213d 2027 7375 6363 6573 7327  t'] != 'success'
+0000ed10: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+0000ed20: 7475 726e 2072 6573 756c 740a 2020 2020  turn result.    
+0000ed30: 2020 2020 6966 2072 6573 6572 7665 646e      if reservedn
+0000ed40: 7320 616e 6420 646e 7363 6c69 656e 7420  s and dnsclient 
+0000ed50: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
+0000ed60: 646f 6d61 696e 2069 7320 6e6f 7420 4e6f  domain is not No
+0000ed70: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+0000ed80: 6966 2064 6e73 636c 6965 6e74 2069 6e20  if dnsclient in 
+0000ed90: 7365 6c66 2e63 6c69 656e 7473 3a0a 2020  self.clients:.  
+0000eda0: 2020 2020 2020 2020 2020 2020 2020 7a20                z 
+0000edb0: 3d20 4b63 6f6e 6669 6728 636c 6965 6e74  = Kconfig(client
+0000edc0: 3d64 6e73 636c 6965 6e74 292e 6b0a 2020  =dnsclient).k.  
+0000edd0: 2020 2020 2020 2020 2020 2020 2020 6970                ip
+0000ede0: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
+0000edf0: 2020 2020 2020 2020 6966 2069 7020 6973          if ip is
+0000ee00: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+0000ee10: 2020 2020 2020 2020 2020 2063 6f75 6e74             count
+0000ee20: 6572 203d 2030 0a20 2020 2020 2020 2020  er = 0.         
+0000ee30: 2020 2020 2020 2020 2020 2077 6869 6c65             while
+0000ee40: 2063 6f75 6e74 6572 2021 3d20 3330 303a   counter != 300:
+0000ee50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ee60: 2020 2020 2020 2020 2069 7020 3d20 6b2e           ip = k.
+0000ee70: 6970 286e 616d 6529 0a20 2020 2020 2020  ip(name).       
+0000ee80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ee90: 2069 6620 6970 2069 7320 4e6f 6e65 3a0a   if ip is None:.
 0000eea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000eeb0: 2020 2020 2069 7020 3d20 6b2e 6970 286e       ip = k.ip(n
-0000eec0: 616d 6529 0a20 2020 2020 2020 2020 2020  ame).           
-0000eed0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0000eee0: 6970 2069 7320 4e6f 6e65 3a0a 2020 2020  ip is None:.    
-0000eef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ef00: 2020 2020 2020 2020 736c 6565 7028 3529          sleep(5)
-0000ef10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ef20: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-0000ef30: 6e74 2822 5761 6974 696e 6720 3520 7365  nt("Waiting 5 se
-0000ef40: 636f 6e64 7320 746f 2067 7261 6220 6970  conds to grab ip
-0000ef50: 2061 6e64 2063 7265 6174 6520 444e 5320   and create DNS 
-0000ef60: 7265 636f 7264 2e2e 2e22 290a 2020 2020  record...").    
+0000eeb0: 2020 2020 2020 2020 2020 2020 736c 6565              slee
+0000eec0: 7028 3529 0a20 2020 2020 2020 2020 2020  p(5).           
+0000eed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eee0: 2070 7269 6e74 2822 5761 6974 696e 6720   print("Waiting 
+0000eef0: 3520 7365 636f 6e64 7320 746f 2067 7261  5 seconds to gra
+0000ef00: 6220 6970 2061 6e64 2063 7265 6174 6520  b ip and create 
+0000ef10: 444e 5320 7265 636f 7264 2e2e 2e22 290a  DNS record...").
+0000ef20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ef30: 2020 2020 2020 2020 2020 2020 636f 756e              coun
+0000ef40: 7465 7220 2b3d 2031 300a 2020 2020 2020  ter += 10.      
+0000ef50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ef60: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
 0000ef70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ef80: 2020 2020 2020 2020 636f 756e 7465 7220          counter 
-0000ef90: 2b3d 2031 300a 2020 2020 2020 2020 2020  += 10.          
-0000efa0: 2020 2020 2020 2020 2020 2020 2020 656c                el
-0000efb0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0000efc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000efd0: 6272 6561 6b0a 2020 2020 2020 2020 2020  break.          
-0000efe0: 2020 2020 2020 6966 2069 7020 6973 204e        if ip is N
-0000eff0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-0000f000: 2020 2020 2020 2020 2065 7272 6f72 2822           error("
-0000f010: 436f 756c 646e 2774 2061 7373 6967 6e20  Couldn't assign 
-0000f020: 444e 5322 290a 2020 2020 2020 2020 2020  DNS").          
-0000f030: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0000f040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f050: 7a2e 7265 7365 7276 655f 646e 7328 6e61  z.reserve_dns(na
-0000f060: 6d65 3d6e 616d 652c 206e 6574 733d 5b64  me=name, nets=[d
-0000f070: 6f6d 6169 6e5d 2c20 646f 6d61 696e 3d64  omain], domain=d
-0000f080: 6f6d 6169 6e2c 2069 703d 6970 2c20 666f  omain, ip=ip, fo
-0000f090: 7263 653d 5472 7565 290a 2020 2020 2020  rce=True).      
-0000f0a0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0000f0b0: 2020 2020 2020 2020 2020 2020 7761 726e              warn
-0000f0c0: 696e 6728 6622 436c 6965 6e74 207b 646e  ing(f"Client {dn
-0000f0d0: 7363 6c69 656e 747d 206e 6f74 2066 6f75  sclient} not fou
-0000f0e0: 6e64 2e20 536b 6970 7069 6e67 2229 0a20  nd. Skipping"). 
-0000f0f0: 2020 2020 2020 2069 6620 6f73 2e61 6363         if os.acc
-0000f100: 6573 7328 6f73 2e70 6174 682e 6578 7061  ess(os.path.expa
-0000f110: 6e64 7573 6572 2827 7e2f 2e6b 636c 6927  nduser('~/.kcli'
-0000f120: 292c 206f 732e 575f 4f4b 293a 0a20 2020  ), os.W_OK):.   
-0000f130: 2020 2020 2020 2020 2063 6c69 656e 7420           client 
-0000f140: 3d20 636c 6965 6e74 2069 6620 636c 6965  = client if clie
-0000f150: 6e74 2069 7320 6e6f 7420 4e6f 6e65 2065  nt is not None e
-0000f160: 6c73 6520 7365 6c66 2e63 6c69 656e 740a  lse self.client.
-0000f170: 2020 2020 2020 2020 2020 2020 636f 6d6d              comm
-0000f180: 6f6e 2e73 6574 5f6c 6173 7476 6d28 6e61  on.set_lastvm(na
-0000f190: 6d65 2c20 636c 6965 6e74 290a 2020 2020  me, client).    
-0000f1a0: 2020 2020 616e 7369 626c 6570 726f 6669      ansibleprofi
-0000f1b0: 6c65 203d 2070 726f 6669 6c65 2e67 6574  le = profile.get
-0000f1c0: 2827 616e 7369 626c 6527 290a 2020 2020  ('ansible').    
-0000f1d0: 2020 2020 6966 2061 6e73 6962 6c65 7072      if ansiblepr
-0000f1e0: 6f66 696c 6520 6973 206e 6f74 204e 6f6e  ofile is not Non
-0000f1f0: 653a 0a20 2020 2020 2020 2020 2020 2069  e:.            i
-0000f200: 6620 7768 6963 6828 2761 6e73 6962 6c65  f which('ansible
-0000f210: 2d70 6c61 7962 6f6f 6b27 2920 6973 204e  -playbook') is N
-0000f220: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-0000f230: 2020 2020 2077 6172 6e69 6e67 2822 616e       warning("an
-0000f240: 7369 626c 652d 706c 6179 626f 6f6b 2065  sible-playbook e
-0000f250: 7865 6375 7461 626c 6520 6e6f 7420 666f  xecutable not fo
-0000f260: 756e 642e 2053 6b69 7070 696e 6720 616e  und. Skipping an
-0000f270: 7369 626c 6520 706c 6179 2229 0a20 2020  sible play").   
-0000f280: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-0000f290: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0000f2a0: 6f72 2065 6c65 6d65 6e74 2069 6e20 616e  or element in an
-0000f2b0: 7369 626c 6570 726f 6669 6c65 3a0a 2020  sibleprofile:.  
-0000f2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f2d0: 2020 6966 2027 706c 6179 626f 6f6b 2720    if 'playbook' 
-0000f2e0: 6e6f 7420 696e 2065 6c65 6d65 6e74 3a0a  not in element:.
-0000f2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f300: 2020 2020 2020 2020 636f 6e74 696e 7565          continue
-0000f310: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f320: 2020 2020 2070 6c61 7962 6f6f 6b20 3d20       playbook = 
-0000f330: 656c 656d 656e 745b 2770 6c61 7962 6f6f  element['playboo
-0000f340: 6b27 5d0a 2020 2020 2020 2020 2020 2020  k'].            
-0000f350: 2020 2020 2020 2020 7661 7269 6162 6c65          variable
-0000f360: 7320 3d20 656c 656d 656e 742e 6765 7428  s = element.get(
-0000f370: 2776 6172 6961 626c 6573 272c 207b 7d29  'variables', {})
-0000f380: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f390: 2020 2020 2076 6572 626f 7365 203d 2065       verbose = e
-0000f3a0: 6c65 6d65 6e74 2e67 6574 2827 7665 7262  lement.get('verb
-0000f3b0: 6f73 6527 2c20 4661 6c73 6529 0a20 2020  ose', False).   
-0000f3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f3d0: 2075 7365 7220 3d20 656c 656d 656e 742e   user = element.
-0000f3e0: 6765 7428 2775 7365 7227 290a 2020 2020  get('user').    
-0000f3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f400: 616e 7369 626c 6575 7469 6c73 2e70 6c61  ansibleutils.pla
-0000f410: 7928 6b2c 206e 616d 652c 2070 6c61 7962  y(k, name, playb
-0000f420: 6f6f 6b3d 706c 6179 626f 6f6b 2c20 7661  ook=playbook, va
-0000f430: 7269 6162 6c65 733d 7661 7269 6162 6c65  riables=variable
-0000f440: 732c 2076 6572 626f 7365 3d76 6572 626f  s, verbose=verbo
-0000f450: 7365 2c20 7573 6572 3d75 7365 722c 0a20  se, user=user,. 
-0000f460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f480: 2020 2020 2074 756e 6e65 6c3d 7365 6c66       tunnel=self
-0000f490: 2e74 756e 6e65 6c2c 2074 756e 6e65 6c68  .tunnel, tunnelh
-0000f4a0: 6f73 743d 7365 6c66 2e68 6f73 742c 2074  ost=self.host, t
-0000f4b0: 756e 6e65 6c70 6f72 743d 7365 6c66 2e70  unnelport=self.p
-0000f4c0: 6f72 742c 0a20 2020 2020 2020 2020 2020  ort,.           
-0000f4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f4e0: 2020 2020 2020 2020 2020 2074 756e 6e65             tunne
-0000f4f0: 6c75 7365 723d 7365 6c66 2e75 7365 722c  luser=self.user,
-0000f500: 2079 616d 6c69 6e76 656e 746f 7279 3d79   yamlinventory=y
-0000f510: 616d 6c69 6e76 656e 746f 7279 2c20 696e  amlinventory, in
-0000f520: 7365 6375 7265 3d73 656c 662e 696e 7365  secure=self.inse
-0000f530: 6375 7265 290a 2020 2020 2020 2020 756e  cure).        un
-0000f540: 706c 7567 6364 203d 206f 7665 7272 6964  plugcd = overrid
-0000f550: 6573 2e67 6574 2827 756e 706c 7567 6364  es.get('unplugcd
-0000f560: 272c 2046 616c 7365 290a 2020 2020 2020  ', False).      
-0000f570: 2020 6966 2077 6169 7420 6f72 2075 6e70    if wait or unp
-0000f580: 6c75 6763 643a 0a20 2020 2020 2020 2020  lugcd:.         
-0000f590: 2020 2069 6620 6e6f 7420 636c 6f75 6469     if not cloudi
-0000f5a0: 6e69 7420 6f72 206e 6f74 2073 7461 7274  nit or not start
-0000f5b0: 206f 7220 696d 6167 6520 6973 204e 6f6e   or image is Non
-0000f5c0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0000f5d0: 2020 2070 7072 696e 7428 6622 536b 6970     pprint(f"Skip
-0000f5e0: 7069 6e67 2077 6169 7420 6f6e 207b 6e61  ping wait on {na
-0000f5f0: 6d65 7d22 290a 2020 2020 2020 2020 2020  me}").          
-0000f600: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0000f610: 2020 2020 2020 2020 6964 656e 7469 7479          identity
-0000f620: 6669 6c65 203d 204e 6f6e 650a 2020 2020  file = None.    
-0000f630: 2020 2020 2020 2020 2020 2020 7465 6d70              temp
-0000f640: 6b65 795f 636c 6561 6e20 3d20 4661 6c73  key_clean = Fals
-0000f650: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-0000f660: 2020 6966 206f 7665 7272 6964 6573 2e67    if overrides.g
-0000f670: 6574 2827 7465 6d70 6b65 7964 6972 2729  et('tempkeydir')
-0000f680: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+0000ef80: 2020 2020 6272 6561 6b0a 2020 2020 2020      break.      
+0000ef90: 2020 2020 2020 2020 2020 6966 2069 7020            if ip 
+0000efa0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+0000efb0: 2020 2020 2020 2020 2020 2020 2065 7272               err
+0000efc0: 6f72 2822 436f 756c 646e 2774 2061 7373  or("Couldn't ass
+0000efd0: 6967 6e20 444e 5322 290a 2020 2020 2020  ign DNS").      
+0000efe0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+0000eff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f000: 2020 2020 7a2e 7265 7365 7276 655f 646e      z.reserve_dn
+0000f010: 7328 6e61 6d65 3d6e 616d 652c 206e 6574  s(name=name, net
+0000f020: 733d 5b64 6f6d 6169 6e5d 2c20 646f 6d61  s=[domain], doma
+0000f030: 696e 3d64 6f6d 6169 6e2c 2069 703d 6970  in=domain, ip=ip
+0000f040: 2c20 666f 7263 653d 5472 7565 290a 2020  , force=True).  
+0000f050: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+0000f060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f070: 7761 726e 696e 6728 6622 436c 6965 6e74  warning(f"Client
+0000f080: 207b 646e 7363 6c69 656e 747d 206e 6f74   {dnsclient} not
+0000f090: 2066 6f75 6e64 2e20 536b 6970 7069 6e67   found. Skipping
+0000f0a0: 2229 0a20 2020 2020 2020 2069 6620 6f73  ").        if os
+0000f0b0: 2e61 6363 6573 7328 6f73 2e70 6174 682e  .access(os.path.
+0000f0c0: 6578 7061 6e64 7573 6572 2827 7e2f 2e6b  expanduser('~/.k
+0000f0d0: 636c 6927 292c 206f 732e 575f 4f4b 293a  cli'), os.W_OK):
+0000f0e0: 0a20 2020 2020 2020 2020 2020 2063 6c69  .            cli
+0000f0f0: 656e 7420 3d20 636c 6965 6e74 2069 6620  ent = client if 
+0000f100: 636c 6965 6e74 2069 7320 6e6f 7420 4e6f  client is not No
+0000f110: 6e65 2065 6c73 6520 7365 6c66 2e63 6c69  ne else self.cli
+0000f120: 656e 740a 2020 2020 2020 2020 2020 2020  ent.            
+0000f130: 636f 6d6d 6f6e 2e73 6574 5f6c 6173 7476  common.set_lastv
+0000f140: 6d28 6e61 6d65 2c20 636c 6965 6e74 290a  m(name, client).
+0000f150: 2020 2020 2020 2020 616e 7369 626c 6570          ansiblep
+0000f160: 726f 6669 6c65 203d 2070 726f 6669 6c65  rofile = profile
+0000f170: 2e67 6574 2827 616e 7369 626c 6527 290a  .get('ansible').
+0000f180: 2020 2020 2020 2020 6966 2061 6e73 6962          if ansib
+0000f190: 6c65 7072 6f66 696c 6520 6973 206e 6f74  leprofile is not
+0000f1a0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+0000f1b0: 2020 2069 6620 7768 6963 6828 2761 6e73     if which('ans
+0000f1c0: 6962 6c65 2d70 6c61 7962 6f6f 6b27 2920  ible-playbook') 
+0000f1d0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+0000f1e0: 2020 2020 2020 2020 2077 6172 6e69 6e67           warning
+0000f1f0: 2822 616e 7369 626c 652d 706c 6179 626f  ("ansible-playbo
+0000f200: 6f6b 2065 7865 6375 7461 626c 6520 6e6f  ok executable no
+0000f210: 7420 666f 756e 642e 2053 6b69 7070 696e  t found. Skippin
+0000f220: 6720 616e 7369 626c 6520 706c 6179 2229  g ansible play")
+0000f230: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+0000f240: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0000f250: 2020 2066 6f72 2065 6c65 6d65 6e74 2069     for element i
+0000f260: 6e20 616e 7369 626c 6570 726f 6669 6c65  n ansibleprofile
+0000f270: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000f280: 2020 2020 2020 6966 2027 706c 6179 626f        if 'playbo
+0000f290: 6f6b 2720 6e6f 7420 696e 2065 6c65 6d65  ok' not in eleme
+0000f2a0: 6e74 3a0a 2020 2020 2020 2020 2020 2020  nt:.            
+0000f2b0: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+0000f2c0: 696e 7565 0a20 2020 2020 2020 2020 2020  inue.           
+0000f2d0: 2020 2020 2020 2020 2070 6c61 7962 6f6f           playboo
+0000f2e0: 6b20 3d20 656c 656d 656e 745b 2770 6c61  k = element['pla
+0000f2f0: 7962 6f6f 6b27 5d0a 2020 2020 2020 2020  ybook'].        
+0000f300: 2020 2020 2020 2020 2020 2020 7661 7269              vari
+0000f310: 6162 6c65 7320 3d20 656c 656d 656e 742e  ables = element.
+0000f320: 6765 7428 2776 6172 6961 626c 6573 272c  get('variables',
+0000f330: 207b 7d29 0a20 2020 2020 2020 2020 2020   {}).           
+0000f340: 2020 2020 2020 2020 2076 6572 626f 7365           verbose
+0000f350: 203d 2065 6c65 6d65 6e74 2e67 6574 2827   = element.get('
+0000f360: 7665 7262 6f73 6527 2c20 4661 6c73 6529  verbose', False)
+0000f370: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f380: 2020 2020 2075 7365 7220 3d20 656c 656d       user = elem
+0000f390: 656e 742e 6765 7428 2775 7365 7227 290a  ent.get('user').
+0000f3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f3b0: 2020 2020 616e 7369 626c 6575 7469 6c73      ansibleutils
+0000f3c0: 2e70 6c61 7928 6b2c 206e 616d 652c 2070  .play(k, name, p
+0000f3d0: 6c61 7962 6f6f 6b3d 706c 6179 626f 6f6b  laybook=playbook
+0000f3e0: 2c20 7661 7269 6162 6c65 733d 7661 7269  , variables=vari
+0000f3f0: 6162 6c65 732c 2076 6572 626f 7365 3d76  ables, verbose=v
+0000f400: 6572 626f 7365 2c20 7573 6572 3d75 7365  erbose, user=use
+0000f410: 722c 0a20 2020 2020 2020 2020 2020 2020  r,.             
+0000f420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f430: 2020 2020 2020 2020 2074 756e 6e65 6c3d           tunnel=
+0000f440: 7365 6c66 2e74 756e 6e65 6c2c 2074 756e  self.tunnel, tun
+0000f450: 6e65 6c68 6f73 743d 7365 6c66 2e68 6f73  nelhost=self.hos
+0000f460: 742c 2074 756e 6e65 6c70 6f72 743d 7365  t, tunnelport=se
+0000f470: 6c66 2e70 6f72 742c 0a20 2020 2020 2020  lf.port,.       
+0000f480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f490: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0000f4a0: 756e 6e65 6c75 7365 723d 7365 6c66 2e75  unneluser=self.u
+0000f4b0: 7365 722c 2079 616d 6c69 6e76 656e 746f  ser, yamlinvento
+0000f4c0: 7279 3d79 616d 6c69 6e76 656e 746f 7279  ry=yamlinventory
+0000f4d0: 2c20 696e 7365 6375 7265 3d73 656c 662e  , insecure=self.
+0000f4e0: 696e 7365 6375 7265 290a 2020 2020 2020  insecure).      
+0000f4f0: 2020 756e 706c 7567 6364 203d 206f 7665    unplugcd = ove
+0000f500: 7272 6964 6573 2e67 6574 2827 756e 706c  rrides.get('unpl
+0000f510: 7567 6364 272c 2046 616c 7365 290a 2020  ugcd', False).  
+0000f520: 2020 2020 2020 6966 2077 6169 7420 6f72        if wait or
+0000f530: 2075 6e70 6c75 6763 643a 0a20 2020 2020   unplugcd:.     
+0000f540: 2020 2020 2020 2069 6620 6e6f 7420 636c         if not cl
+0000f550: 6f75 6469 6e69 7420 6f72 206e 6f74 2073  oudinit or not s
+0000f560: 7461 7274 206f 7220 696d 6167 6520 6973  tart or image is
+0000f570: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+0000f580: 2020 2020 2020 2070 7072 696e 7428 6622         pprint(f"
+0000f590: 536b 6970 7069 6e67 2077 6169 7420 6f6e  Skipping wait on
+0000f5a0: 207b 6e61 6d65 7d22 290a 2020 2020 2020   {name}").      
+0000f5b0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0000f5c0: 2020 2020 2020 2020 2020 2020 6964 656e              iden
+0000f5d0: 7469 7479 6669 6c65 203d 204e 6f6e 650a  tityfile = None.
+0000f5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f5f0: 7465 6d70 6b65 795f 636c 6561 6e20 3d20  tempkey_clean = 
+0000f600: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
+0000f610: 2020 2020 2020 6966 206f 7665 7272 6964        if overrid
+0000f620: 6573 2e67 6574 2827 7465 6d70 6b65 7964  es.get('tempkeyd
+0000f630: 6972 2729 2069 7320 6e6f 7420 4e6f 6e65  ir') is not None
+0000f640: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000f650: 2020 2020 2020 6964 656e 7469 7479 6669        identityfi
+0000f660: 6c65 203d 2066 227b 6f76 6572 7269 6465  le = f"{override
+0000f670: 735b 2774 656d 706b 6579 6469 7227 5d2e  s['tempkeydir'].
+0000f680: 6e61 6d65 7d2f 6964 5f72 7361 220a 2020  name}/id_rsa".  
 0000f690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f6a0: 2020 6964 656e 7469 7479 6669 6c65 203d    identityfile =
-0000f6b0: 2066 227b 6f76 6572 7269 6465 735b 2774   f"{overrides['t
-0000f6c0: 656d 706b 6579 6469 7227 5d2e 6e61 6d65  empkeydir'].name
-0000f6d0: 7d2f 6964 5f72 7361 220a 2020 2020 2020  }/id_rsa".      
-0000f6e0: 2020 2020 2020 2020 2020 2020 2020 7465                te
-0000f6f0: 6d70 6b65 795f 636c 6561 6e20 3d20 5472  mpkey_clean = Tr
-0000f700: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
-0000f710: 2020 2073 656c 662e 7761 6974 5f66 696e     self.wait_fin
-0000f720: 6973 6828 6e61 6d65 2c20 696d 6167 653d  ish(name, image=
-0000f730: 696d 6167 652c 2077 6169 7463 6f6d 6d61  image, waitcomma
-0000f740: 6e64 3d77 6169 7463 6f6d 6d61 6e64 2c20  nd=waitcommand, 
-0000f750: 7761 6974 7469 6d65 6f75 743d 7761 6974  waittimeout=wait
-0000f760: 7469 6d65 6f75 742c 0a20 2020 2020 2020  timeout,.       
-0000f770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f780: 2020 2020 2020 2020 2020 6964 656e 7469            identi
-0000f790: 7479 6669 6c65 3d69 6465 6e74 6974 7966  tyfile=identityf
-0000f7a0: 696c 652c 2076 6d63 6c69 656e 743d 636c  ile, vmclient=cl
-0000f7b0: 6965 6e74 290a 2020 2020 2020 2020 2020  ient).          
-0000f7c0: 2020 2020 2020 6669 6e69 7368 6669 6c65        finishfile
-0000f7d0: 7320 3d20 7072 6f66 696c 652e 6765 7428  s = profile.get(
-0000f7e0: 2766 696e 6973 6866 696c 6573 272c 205b  'finishfiles', [
-0000f7f0: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
-0000f800: 2020 2069 6620 6669 6e69 7368 6669 6c65     if finishfile
-0000f810: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-0000f820: 2020 2020 2020 2073 656c 662e 6861 6e64         self.hand
-0000f830: 6c65 5f66 696e 6973 6866 696c 6573 286e  le_finishfiles(n
-0000f840: 616d 652c 2066 696e 6973 6866 696c 6573  ame, finishfiles
-0000f850: 2c20 6964 656e 7469 7479 6669 6c65 3d69  , identityfile=i
-0000f860: 6465 6e74 6974 7966 696c 652c 2076 6d63  dentityfile, vmc
-0000f870: 6c69 656e 743d 636c 6965 6e74 290a 2020  lient=client).  
-0000f880: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0000f890: 2074 656d 706b 6579 5f63 6c65 616e 3a0a   tempkey_clean:.
-0000f8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f8b0: 2020 2020 7365 6c66 2e63 6c65 616e 5f74      self.clean_t
-0000f8c0: 656d 706b 6579 286e 616d 652c 2069 6465  empkey(name, ide
-0000f8d0: 6e74 6974 7966 696c 653d 6964 656e 7469  ntityfile=identi
-0000f8e0: 7479 6669 6c65 290a 2020 2020 2020 2020  tyfile).        
-0000f8f0: 2020 2020 6966 2075 6e70 6c75 6763 643a      if unplugcd:
-0000f900: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f910: 2073 656c 662e 6b2e 7570 6461 7465 5f69   self.k.update_i
-0000f920: 736f 286e 616d 652c 204e 6f6e 6529 0a20  so(name, None). 
-0000f930: 2020 2020 2020 2069 6620 6f76 6572 7269         if overri
-0000f940: 6465 732e 6765 7428 2774 656d 706b 6579  des.get('tempkey
-0000f950: 6469 7227 2920 6973 206e 6f74 204e 6f6e  dir') is not Non
-0000f960: 6520 616e 6420 6e6f 7420 6f76 6572 7269  e and not overri
-0000f970: 6465 732e 6765 7428 2774 656d 706b 6579  des.get('tempkey
-0000f980: 6469 726b 6565 7027 2c20 4661 6c73 6529  dirkeep', False)
-0000f990: 3a0a 2020 2020 2020 2020 2020 2020 6f76  :.            ov
-0000f9a0: 6572 7269 6465 732e 6765 7428 2774 656d  errides.get('tem
-0000f9b0: 706b 6579 6469 7227 292e 636c 6561 6e75  pkeydir').cleanu
-0000f9c0: 7028 290a 2020 2020 2020 2020 7265 7475  p().        retu
-0000f9d0: 726e 207b 2772 6573 756c 7427 3a20 2773  rn {'result': 's
-0000f9e0: 7563 6365 7373 272c 2027 766d 273a 206e  uccess', 'vm': n
-0000f9f0: 616d 657d 0a0a 2020 2020 6465 6620 7570  ame}..    def up
-0000fa00: 6461 7465 5f76 6d28 7365 6c66 2c20 6e61  date_vm(self, na
-0000fa10: 6d65 2c20 6f76 6572 7269 6465 7329 3a0a  me, overrides):.
-0000fa20: 2020 2020 2020 2020 6b20 3d20 7365 6c66          k = self
-0000fa30: 2e6b 0a20 2020 2020 2020 2069 7020 3d20  .k.        ip = 
-0000fa40: 6f76 6572 7269 6465 732e 6765 7428 2769  overrides.get('i
-0000fa50: 7027 290a 2020 2020 2020 2020 666c 6176  p').        flav
-0000fa60: 6f72 203d 206f 7665 7272 6964 6573 2e67  or = overrides.g
-0000fa70: 6574 2827 666c 6176 6f72 2729 0a20 2020  et('flavor').   
-0000fa80: 2020 2020 206e 756d 6370 7573 203d 206f       numcpus = o
-0000fa90: 7665 7272 6964 6573 2e67 6574 2827 6e75  verrides.get('nu
-0000faa0: 6d63 7075 7327 290a 2020 2020 2020 2020  mcpus').        
-0000fab0: 6d65 6d6f 7279 203d 206f 7665 7272 6964  memory = overrid
-0000fac0: 6573 2e67 6574 2827 6d65 6d6f 7279 2729  es.get('memory')
-0000fad0: 0a20 2020 2020 2020 2061 7574 6f73 7461  .        autosta
-0000fae0: 7274 203d 206f 7665 7272 6964 6573 2e67  rt = overrides.g
-0000faf0: 6574 2827 6175 746f 7374 6172 7427 290a  et('autostart').
-0000fb00: 2020 2020 2020 2020 646e 7320 3d20 6f76          dns = ov
-0000fb10: 6572 7269 6465 732e 6765 7428 2764 6e73  errides.get('dns
-0000fb20: 2729 0a20 2020 2020 2020 2068 6f73 7420  ').        host 
-0000fb30: 3d20 6f76 6572 7269 6465 732e 6765 7428  = overrides.get(
-0000fb40: 2768 6f73 7427 290a 2020 2020 2020 2020  'host').        
-0000fb50: 646f 6d61 696e 203d 206f 7665 7272 6964  domain = overrid
-0000fb60: 6573 2e67 6574 2827 646f 6d61 696e 2729  es.get('domain')
-0000fb70: 0a20 2020 2020 2020 2063 6c6f 7564 696e  .        cloudin
-0000fb80: 6974 203d 206f 7665 7272 6964 6573 2e67  it = overrides.g
-0000fb90: 6574 2827 636c 6f75 6469 6e69 7427 290a  et('cloudinit').
-0000fba0: 2020 2020 2020 2020 696d 6167 6520 3d20          image = 
-0000fbb0: 6f76 6572 7269 6465 732e 6765 7428 2769  overrides.get('i
-0000fbc0: 6d61 6765 2729 0a20 2020 2020 2020 206e  mage').        n
-0000fbd0: 6574 7320 3d20 6f76 6572 7269 6465 732e  ets = overrides.
-0000fbe0: 6765 7428 276e 6574 7327 290a 2020 2020  get('nets').    
-0000fbf0: 2020 2020 6469 736b 7320 3d20 6f76 6572      disks = over
-0000fc00: 7269 6465 732e 6765 7428 2764 6973 6b73  rides.get('disks
-0000fc10: 2729 0a20 2020 2020 2020 2069 6e66 6f72  ').        infor
-0000fc20: 6d61 7469 6f6e 203d 206f 7665 7272 6964  mation = overrid
-0000fc30: 6573 2e67 6574 2827 696e 666f 726d 6174  es.get('informat
-0000fc40: 696f 6e27 290a 2020 2020 2020 2020 6370  ion').        cp
-0000fc50: 7566 6c61 6773 203d 206f 7665 7272 6964  uflags = overrid
-0000fc60: 6573 2e67 6574 2827 6370 7566 6c61 6773  es.get('cpuflags
-0000fc70: 272c 205b 5d29 0a20 2020 2020 2020 2064  ', []).        d
-0000fc80: 6973 6162 6c65 203d 206f 7665 7272 6964  isable = overrid
-0000fc90: 6573 2e67 6574 2827 6469 7361 626c 6527  es.get('disable'
-0000fca0: 2c20 4661 6c73 6529 0a20 2020 2020 2020  , False).       
-0000fcb0: 206f 7665 7272 6964 6573 2e70 6f70 2827   overrides.pop('
-0000fcc0: 6469 7361 626c 6527 2c20 4e6f 6e65 290a  disable', None).
-0000fcd0: 2020 2020 2020 2020 6578 7472 615f 6d65          extra_me
-0000fce0: 7461 6461 7461 203d 207b 6b3a 206f 7665  tadata = {k: ove
-0000fcf0: 7272 6964 6573 5b6b 5d20 666f 7220 6b20  rrides[k] for k 
-0000fd00: 696e 206f 7665 7272 6964 6573 2069 6620  in overrides if 
-0000fd10: 6b20 6e6f 7420 696e 2073 656c 662e 6c69  k not in self.li
-0000fd20: 7374 5f6b 6579 776f 7264 7328 297d 0a20  st_keywords()}. 
-0000fd30: 2020 2020 2020 2074 656d 706c 6174 6520         template 
-0000fd40: 3d20 6f76 6572 7269 6465 732e 6765 7428  = overrides.get(
-0000fd50: 2774 656d 706c 6174 6527 290a 2020 2020  'template').    
-0000fd60: 2020 2020 6966 2074 656d 706c 6174 6520      if template 
-0000fd70: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-0000fd80: 2020 2020 2020 2020 2064 656c 2065 7874           del ext
-0000fd90: 7261 5f6d 6574 6164 6174 615b 2774 656d  ra_metadata['tem
-0000fda0: 706c 6174 6527 5d0a 2020 2020 2020 2020  plate'].        
-0000fdb0: 6966 2064 6e73 3a0a 2020 2020 2020 2020  if dns:.        
-0000fdc0: 2020 2020 7070 7269 6e74 2866 2243 7265      pprint(f"Cre
-0000fdd0: 6174 696e 6720 446e 7320 656e 7472 7920  ating Dns entry 
-0000fde0: 666f 7220 7b6e 616d 657d 2e2e 2e22 290a  for {name}...").
-0000fdf0: 2020 2020 2020 2020 2020 2020 6e65 7477              netw
-0000fe00: 6f72 6b73 203d 206b 2e76 6d5f 706f 7274  orks = k.vm_port
-0000fe10: 7328 6e61 6d65 290a 2020 2020 2020 2020  s(name).        
-0000fe20: 2020 2020 6966 206e 6574 776f 726b 7320      if networks 
-0000fe30: 616e 6420 646f 6d61 696e 2069 7320 4e6f  and domain is No
-0000fe40: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-0000fe50: 2020 2020 646f 6d61 696e 203d 206e 6574      domain = net
-0000fe60: 776f 726b 735b 305d 0a20 2020 2020 2020  works[0].       
-0000fe70: 2020 2020 2069 6620 6e6f 7420 6e65 7473       if not nets
-0000fe80: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000fe90: 2020 7265 7475 726e 0a20 2020 2020 2020    return.       
-0000fea0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0000feb0: 2020 2020 2020 2020 2020 206b 2e72 6573             k.res
-0000fec0: 6572 7665 5f64 6e73 286e 616d 653d 6e61  erve_dns(name=na
-0000fed0: 6d65 2c20 6e65 7473 3d6e 6574 776f 726b  me, nets=network
-0000fee0: 732c 2064 6f6d 6169 6e3d 646f 6d61 696e  s, domain=domain
-0000fef0: 2c20 6970 3d69 7029 0a20 2020 2020 2020  , ip=ip).       
-0000ff00: 2069 6620 6970 2069 7320 6e6f 7420 4e6f   if ip is not No
-0000ff10: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-0000ff20: 7070 7269 6e74 2866 2255 7064 6174 696e  pprint(f"Updatin
-0000ff30: 6720 6970 206f 6620 766d 207b 6e61 6d65  g ip of vm {name
-0000ff40: 7d20 746f 207b 6970 7d2e 2e2e 2229 0a20  } to {ip}..."). 
-0000ff50: 2020 2020 2020 2020 2020 206b 2e75 7064             k.upd
-0000ff60: 6174 655f 6d65 7461 6461 7461 286e 616d  ate_metadata(nam
-0000ff70: 652c 2027 6970 272c 2069 7029 0a20 2020  e, 'ip', ip).   
-0000ff80: 2020 2020 2069 6620 636c 6f75 6469 6e69       if cloudini
-0000ff90: 743a 0a20 2020 2020 2020 2020 2020 2070  t:.            p
-0000ffa0: 7072 696e 7428 6622 5265 6d6f 7669 6e67  print(f"Removing
-0000ffb0: 2063 6c6f 7564 696e 6974 2069 6e66 6f72   cloudinit infor
-0000ffc0: 6d61 7469 6f6e 206f 6620 766d 207b 6e61  mation of vm {na
-0000ffd0: 6d65 7d22 290a 2020 2020 2020 2020 2020  me}").          
-0000ffe0: 2020 6b2e 7265 6d6f 7665 5f63 6c6f 7564    k.remove_cloud
-0000fff0: 696e 6974 286e 616d 6529 0a20 2020 2020  init(name).     
-00010000: 2020 2069 6620 696d 6167 6520 6973 206e     if image is n
-00010010: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-00010020: 2020 2020 2070 7072 696e 7428 6622 5570       pprint(f"Up
-00010030: 6461 7469 6e67 2069 6d61 6765 206f 6620  dating image of 
-00010040: 766d 207b 6e61 6d65 7d20 746f 207b 696d  vm {name} to {im
-00010050: 6167 657d 2e2e 2e22 290a 2020 2020 2020  age}...").      
-00010060: 2020 2020 2020 6b2e 7570 6461 7465 5f6d        k.update_m
-00010070: 6574 6164 6174 6128 6e61 6d65 2c20 2769  etadata(name, 'i
-00010080: 6d61 6765 272c 2069 6d61 6765 290a 2020  mage', image).  
-00010090: 2020 2020 2020 6966 206d 656d 6f72 7920        if memory 
-000100a0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-000100b0: 2020 2020 2020 2020 2070 7072 696e 7428           pprint(
-000100c0: 6622 5570 6461 7469 6e67 206d 656d 6f72  f"Updating memor
-000100d0: 7920 6f66 2076 6d20 7b6e 616d 657d 2074  y of vm {name} t
-000100e0: 6f20 7b6d 656d 6f72 797d 2e2e 2e22 290a  o {memory}...").
-000100f0: 2020 2020 2020 2020 2020 2020 6b2e 7570              k.up
-00010100: 6461 7465 5f6d 656d 6f72 7928 6e61 6d65  date_memory(name
-00010110: 2c20 6d65 6d6f 7279 290a 2020 2020 2020  , memory).      
-00010120: 2020 6966 206e 756d 6370 7573 2069 7320    if numcpus is 
-00010130: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-00010140: 2020 2020 2020 7070 7269 6e74 2866 2255        pprint(f"U
-00010150: 7064 6174 696e 6720 6e75 6d63 7075 7320  pdating numcpus 
-00010160: 6f66 2076 6d20 7b6e 616d 657d 2074 6f20  of vm {name} to 
-00010170: 7b6e 756d 6370 7573 7d2e 2e2e 2229 0a20  {numcpus}..."). 
-00010180: 2020 2020 2020 2020 2020 206b 2e75 7064             k.upd
-00010190: 6174 655f 6370 7573 286e 616d 652c 206e  ate_cpus(name, n
-000101a0: 756d 6370 7573 290a 2020 2020 2020 2020  umcpus).        
-000101b0: 6966 2061 7574 6f73 7461 7274 2069 7320  if autostart is 
-000101c0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-000101d0: 2020 2020 2020 7070 7269 6e74 2866 2253        pprint(f"S
-000101e0: 6574 7469 6e67 2061 7574 6f73 7461 7274  etting autostart
-000101f0: 2074 6f20 7b61 7574 6f73 7461 7274 7d20   to {autostart} 
-00010200: 666f 7220 766d 207b 6e61 6d65 7d2e 2e2e  for vm {name}...
-00010210: 2229 0a20 2020 2020 2020 2020 2020 206b  ").            k
-00010220: 2e75 7064 6174 655f 7374 6172 7428 6e61  .update_start(na
-00010230: 6d65 2c20 7374 6172 743d 6175 746f 7374  me, start=autost
-00010240: 6172 7429 0a20 2020 2020 2020 2069 6620  art).        if 
-00010250: 696e 666f 726d 6174 696f 6e3a 0a20 2020  information:.   
-00010260: 2020 2020 2020 2020 2070 7072 696e 7428           pprint(
-00010270: 6622 5365 7474 696e 6720 696e 666f 726d  f"Setting inform
-00010280: 6174 696f 6e20 666f 7220 766d 207b 6e61  ation for vm {na
-00010290: 6d65 7d2e 2e2e 2229 0a20 2020 2020 2020  me}...").       
-000102a0: 2020 2020 206b 2e75 7064 6174 655f 696e       k.update_in
-000102b0: 666f 726d 6174 696f 6e28 6e61 6d65 2c20  formation(name, 
-000102c0: 696e 666f 726d 6174 696f 6e29 0a20 2020  information).   
-000102d0: 2020 2020 2069 6620 2769 736f 2720 696e       if 'iso' in
-000102e0: 206f 7665 7272 6964 6573 3a0a 2020 2020   overrides:.    
-000102f0: 2020 2020 2020 2020 6973 6f20 3d20 6f76          iso = ov
-00010300: 6572 7269 6465 735b 2769 736f 275d 0a20  errides['iso']. 
-00010310: 2020 2020 2020 2020 2020 2070 7072 696e             pprin
-00010320: 7428 6622 5377 6974 6368 696e 6720 6973  t(f"Switching is
-00010330: 6f20 666f 7220 766d 207b 6e61 6d65 7d20  o for vm {name} 
-00010340: 746f 207b 6973 6f7d 2e2e 2e22 290a 2020  to {iso}...").  
-00010350: 2020 2020 2020 2020 2020 6966 2069 736f            if iso
-00010360: 203d 3d20 274e 6f6e 6527 206f 7220 6973   == 'None' or is
-00010370: 6f20 3d3d 2027 273a 0a20 2020 2020 2020  o == '':.       
-00010380: 2020 2020 2020 2020 2069 736f 203d 204e           iso = N
-00010390: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-000103a0: 6b2e 7570 6461 7465 5f69 736f 286e 616d  k.update_iso(nam
-000103b0: 652c 2069 736f 290a 2020 2020 2020 2020  e, iso).        
-000103c0: 6966 2066 6c61 766f 7220 6973 206e 6f74  if flavor is not
-000103d0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-000103e0: 2020 2070 7072 696e 7428 6622 5570 6461     pprint(f"Upda
-000103f0: 7469 6e67 2066 6c61 766f 7220 6f66 2076  ting flavor of v
-00010400: 6d20 7b6e 616d 657d 2074 6f20 7b66 6c61  m {name} to {fla
-00010410: 766f 727d 2e2e 2e22 290a 2020 2020 2020  vor}...").      
-00010420: 2020 2020 2020 6b2e 7570 6461 7465 5f66        k.update_f
-00010430: 6c61 766f 7228 6e61 6d65 2c20 666c 6176  lavor(name, flav
-00010440: 6f72 290a 2020 2020 2020 2020 6966 2068  or).        if h
-00010450: 6f73 743a 0a20 2020 2020 2020 2020 2020  ost:.           
-00010460: 2070 7072 696e 7428 6622 4372 6561 7469   pprint(f"Creati
-00010470: 6e67 2048 6f73 7420 656e 7472 7920 666f  ng Host entry fo
-00010480: 7220 766d 207b 6e61 6d65 7d2e 2e2e 2229  r vm {name}...")
-00010490: 0a20 2020 2020 2020 2020 2020 206e 6574  .            net
-000104a0: 776f 726b 7320 3d20 6b2e 766d 5f70 6f72  works = k.vm_por
-000104b0: 7473 286e 616d 6529 0a20 2020 2020 2020  ts(name).       
-000104c0: 2020 2020 2069 6620 6e65 7477 6f72 6b73       if networks
-000104d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000104e0: 2020 6966 2064 6f6d 6169 6e20 6973 204e    if domain is N
-000104f0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00010500: 2020 2020 2020 2020 2064 6f6d 6169 6e20           domain 
-00010510: 3d20 6e65 7477 6f72 6b73 5b30 5d0a 2020  = networks[0].  
-00010520: 2020 2020 2020 2020 2020 2020 2020 6b2e                k.
-00010530: 7265 7365 7276 655f 686f 7374 286e 616d  reserve_host(nam
-00010540: 652c 206e 6574 776f 726b 732c 2064 6f6d  e, networks, dom
-00010550: 6169 6e29 0a20 2020 2020 2020 2063 7572  ain).        cur
-00010560: 7265 6e74 766d 203d 206b 2e69 6e66 6f28  rentvm = k.info(
-00010570: 6e61 6d65 290a 2020 2020 2020 2020 6375  name).        cu
-00010580: 7272 656e 746e 6574 7320 3d20 6375 7272  rrentnets = curr
-00010590: 656e 7476 6d2e 6765 7428 276e 6574 7327  entvm.get('nets'
-000105a0: 2c20 5b5d 290a 2020 2020 2020 2020 6375  , []).        cu
-000105b0: 7272 656e 7464 6973 6b73 203d 2063 7572  rrentdisks = cur
-000105c0: 7265 6e74 766d 2e67 6574 2827 6469 736b  rentvm.get('disk
-000105d0: 7327 2c20 5b5d 290a 2020 2020 2020 2020  s', []).        
-000105e0: 6966 2064 6973 6b73 3a0a 2020 2020 2020  if disks:.      
-000105f0: 2020 2020 2020 7070 7269 6e74 2866 2255        pprint(f"U
-00010600: 7064 6174 696e 6720 6469 736b 7320 6f66  pdating disks of
-00010610: 2076 6d20 7b6e 616d 657d 2229 0a20 2020   vm {name}").   
-00010620: 2020 2020 2020 2020 2066 6f72 2069 6e64           for ind
-00010630: 6578 2c20 6375 7272 656e 7464 6973 6b20  ex, currentdisk 
-00010640: 696e 2065 6e75 6d65 7261 7465 2863 7572  in enumerate(cur
-00010650: 7265 6e74 6469 736b 7329 3a0a 2020 2020  rentdisks):.    
-00010660: 2020 2020 2020 2020 2020 2020 6966 2069              if i
-00010670: 6e64 6578 203c 206c 656e 2864 6973 6b73  ndex < len(disks
-00010680: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00010690: 2020 2020 2020 2064 6973 6b20 3d20 6469         disk = di
-000106a0: 736b 735b 696e 6465 785d 0a20 2020 2020  sks[index].     
-000106b0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-000106c0: 7572 7265 6e74 6469 736b 7369 7a65 203d  urrentdisksize =
-000106d0: 2063 7572 7265 6e74 6469 736b 5b27 7369   currentdisk['si
-000106e0: 7a65 275d 0a20 2020 2020 2020 2020 2020  ze'].           
-000106f0: 2020 2020 2020 2020 2064 6973 6b73 697a           disksiz
-00010700: 6520 3d20 6469 736b 2e67 6574 2827 7369  e = disk.get('si
-00010710: 7a65 272c 2031 3029 2069 6620 6973 696e  ze', 10) if isin
-00010720: 7374 616e 6365 2864 6973 6b2c 2064 6963  stance(disk, dic
-00010730: 7429 2065 6c73 6520 696e 7428 6469 736b  t) else int(disk
-00010740: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00010750: 2020 2020 2020 6966 2064 6973 6b73 697a        if disksiz
-00010760: 6520 3e20 6375 7272 656e 7464 6973 6b73  e > currentdisks
-00010770: 697a 653a 0a20 2020 2020 2020 2020 2020  ize:.           
-00010780: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00010790: 6375 7272 656e 7476 6d2e 6765 7428 2773  currentvm.get('s
-000107a0: 7461 7475 7327 2920 213d 2027 646f 776e  tatus') != 'down
-000107b0: 273a 0a20 2020 2020 2020 2020 2020 2020  ':.             
-000107c0: 2020 2020 2020 2020 2020 2020 2020 2077                 w
-000107d0: 6172 6e69 6e67 2866 2243 616e 7420 7265  arning(f"Cant re
-000107e0: 7369 7a65 2044 6973 6b20 7b69 6e64 6578  size Disk {index
-000107f0: 7d20 696e 207b 6e61 6d65 7d20 7768 696c  } in {name} whil
-00010800: 6520 564d 2069 7320 7570 2229 0a20 2020  e VM is up").   
-00010810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010820: 2020 2020 2020 2020 2062 7265 616b 0a20           break. 
-00010830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010840: 2020 2020 2020 2070 7072 696e 7428 6622         pprint(f"
-00010850: 5265 7369 7a69 6e67 2044 6973 6b20 7b69  Resizing Disk {i
-00010860: 6e64 6578 7d20 696e 207b 6e61 6d65 7d22  ndex} in {name}"
-00010870: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00010880: 2020 2020 2020 2020 2020 6469 736b 7061            diskpa
-00010890: 7468 203d 2063 7572 7265 6e74 6469 736b  th = currentdisk
-000108a0: 5b27 7061 7468 275d 0a20 2020 2020 2020  ['path'].       
-000108b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000108c0: 206b 2e72 6573 697a 655f 6469 736b 2864   k.resize_disk(d
-000108d0: 6973 6b70 6174 682c 2064 6973 6b73 697a  iskpath, disksiz
-000108e0: 6529 0a20 2020 2020 2020 2020 2020 2069  e).            i
-000108f0: 6620 6c65 6e28 6375 7272 656e 7464 6973  f len(currentdis
-00010900: 6b73 2920 3c20 6c65 6e28 6469 736b 7329  ks) < len(disks)
-00010910: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00010920: 2020 7070 7269 6e74 2866 2241 6464 696e    pprint(f"Addin
-00010930: 6720 4469 736b 7320 746f 207b 6e61 6d65  g Disks to {name
-00010940: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
-00010950: 2020 2020 666f 7220 6469 736b 2069 6e20      for disk in 
-00010960: 6469 736b 735b 6c65 6e28 6375 7272 656e  disks[len(curren
-00010970: 7464 6973 6b73 293a 5d3a 0a20 2020 2020  tdisks):]:.     
-00010980: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00010990: 6e74 6572 6661 6365 203d 204e 6f6e 650a  nterface = None.
-000109a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000109b0: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-000109c0: 6528 6469 736b 2c20 696e 7429 3a0a 2020  e(disk, int):.  
+0000f6a0: 2020 7465 6d70 6b65 795f 636c 6561 6e20    tempkey_clean 
+0000f6b0: 3d20 5472 7565 0a20 2020 2020 2020 2020  = True.         
+0000f6c0: 2020 2020 2020 2073 656c 662e 7761 6974         self.wait
+0000f6d0: 5f66 696e 6973 6828 6e61 6d65 2c20 696d  _finish(name, im
+0000f6e0: 6167 653d 696d 6167 652c 2077 6169 7463  age=image, waitc
+0000f6f0: 6f6d 6d61 6e64 3d77 6169 7463 6f6d 6d61  ommand=waitcomma
+0000f700: 6e64 2c20 7761 6974 7469 6d65 6f75 743d  nd, waittimeout=
+0000f710: 7761 6974 7469 6d65 6f75 742c 0a20 2020  waittimeout,.   
+0000f720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f730: 2020 2020 2020 2020 2020 2020 2020 6964                id
+0000f740: 656e 7469 7479 6669 6c65 3d69 6465 6e74  entityfile=ident
+0000f750: 6974 7966 696c 652c 2076 6d63 6c69 656e  ityfile, vmclien
+0000f760: 743d 636c 6965 6e74 290a 2020 2020 2020  t=client).      
+0000f770: 2020 2020 2020 2020 2020 6669 6e69 7368            finish
+0000f780: 6669 6c65 7320 3d20 7072 6f66 696c 652e  files = profile.
+0000f790: 6765 7428 2766 696e 6973 6866 696c 6573  get('finishfiles
+0000f7a0: 272c 205b 5d29 0a20 2020 2020 2020 2020  ', []).         
+0000f7b0: 2020 2020 2020 2069 6620 6669 6e69 7368         if finish
+0000f7c0: 6669 6c65 733a 0a20 2020 2020 2020 2020  files:.         
+0000f7d0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000f7e0: 6861 6e64 6c65 5f66 696e 6973 6866 696c  handle_finishfil
+0000f7f0: 6573 286e 616d 652c 2066 696e 6973 6866  es(name, finishf
+0000f800: 696c 6573 2c20 6964 656e 7469 7479 6669  iles, identityfi
+0000f810: 6c65 3d69 6465 6e74 6974 7966 696c 652c  le=identityfile,
+0000f820: 2076 6d63 6c69 656e 743d 636c 6965 6e74   vmclient=client
+0000f830: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000f840: 2020 6966 2074 656d 706b 6579 5f63 6c65    if tempkey_cle
+0000f850: 616e 3a0a 2020 2020 2020 2020 2020 2020  an:.            
+0000f860: 2020 2020 2020 2020 7365 6c66 2e63 6c65          self.cle
+0000f870: 616e 5f74 656d 706b 6579 286e 616d 652c  an_tempkey(name,
+0000f880: 2069 6465 6e74 6974 7966 696c 653d 6964   identityfile=id
+0000f890: 656e 7469 7479 6669 6c65 290a 2020 2020  entityfile).    
+0000f8a0: 2020 2020 2020 2020 6966 2075 6e70 6c75          if unplu
+0000f8b0: 6763 643a 0a20 2020 2020 2020 2020 2020  gcd:.           
+0000f8c0: 2020 2020 2073 656c 662e 6b2e 7570 6461       self.k.upda
+0000f8d0: 7465 5f69 736f 286e 616d 652c 204e 6f6e  te_iso(name, Non
+0000f8e0: 6529 0a20 2020 2020 2020 2069 6620 6f76  e).        if ov
+0000f8f0: 6572 7269 6465 732e 6765 7428 2774 656d  errides.get('tem
+0000f900: 706b 6579 6469 7227 2920 6973 206e 6f74  pkeydir') is not
+0000f910: 204e 6f6e 6520 616e 6420 6e6f 7420 6f76   None and not ov
+0000f920: 6572 7269 6465 732e 6765 7428 2774 656d  errides.get('tem
+0000f930: 706b 6579 6469 726b 6565 7027 2c20 4661  pkeydirkeep', Fa
+0000f940: 6c73 6529 3a0a 2020 2020 2020 2020 2020  lse):.          
+0000f950: 2020 6f76 6572 7269 6465 732e 6765 7428    overrides.get(
+0000f960: 2774 656d 706b 6579 6469 7227 292e 636c  'tempkeydir').cl
+0000f970: 6561 6e75 7028 290a 2020 2020 2020 2020  eanup().        
+0000f980: 7265 7475 726e 207b 2772 6573 756c 7427  return {'result'
+0000f990: 3a20 2773 7563 6365 7373 272c 2027 766d  : 'success', 'vm
+0000f9a0: 273a 206e 616d 657d 0a0a 2020 2020 6465  ': name}..    de
+0000f9b0: 6620 7570 6461 7465 5f76 6d28 7365 6c66  f update_vm(self
+0000f9c0: 2c20 6e61 6d65 2c20 6f76 6572 7269 6465  , name, override
+0000f9d0: 7329 3a0a 2020 2020 2020 2020 6b20 3d20  s):.        k = 
+0000f9e0: 7365 6c66 2e6b 0a20 2020 2020 2020 2069  self.k.        i
+0000f9f0: 7020 3d20 6f76 6572 7269 6465 732e 6765  p = overrides.ge
+0000fa00: 7428 2769 7027 290a 2020 2020 2020 2020  t('ip').        
+0000fa10: 666c 6176 6f72 203d 206f 7665 7272 6964  flavor = overrid
+0000fa20: 6573 2e67 6574 2827 666c 6176 6f72 2729  es.get('flavor')
+0000fa30: 0a20 2020 2020 2020 206e 756d 6370 7573  .        numcpus
+0000fa40: 203d 206f 7665 7272 6964 6573 2e67 6574   = overrides.get
+0000fa50: 2827 6e75 6d63 7075 7327 290a 2020 2020  ('numcpus').    
+0000fa60: 2020 2020 6d65 6d6f 7279 203d 206f 7665      memory = ove
+0000fa70: 7272 6964 6573 2e67 6574 2827 6d65 6d6f  rrides.get('memo
+0000fa80: 7279 2729 0a20 2020 2020 2020 2061 7574  ry').        aut
+0000fa90: 6f73 7461 7274 203d 206f 7665 7272 6964  ostart = overrid
+0000faa0: 6573 2e67 6574 2827 6175 746f 7374 6172  es.get('autostar
+0000fab0: 7427 290a 2020 2020 2020 2020 646e 7320  t').        dns 
+0000fac0: 3d20 6f76 6572 7269 6465 732e 6765 7428  = overrides.get(
+0000fad0: 2764 6e73 2729 0a20 2020 2020 2020 2068  'dns').        h
+0000fae0: 6f73 7420 3d20 6f76 6572 7269 6465 732e  ost = overrides.
+0000faf0: 6765 7428 2768 6f73 7427 290a 2020 2020  get('host').    
+0000fb00: 2020 2020 646f 6d61 696e 203d 206f 7665      domain = ove
+0000fb10: 7272 6964 6573 2e67 6574 2827 646f 6d61  rrides.get('doma
+0000fb20: 696e 2729 0a20 2020 2020 2020 2063 6c6f  in').        clo
+0000fb30: 7564 696e 6974 203d 206f 7665 7272 6964  udinit = overrid
+0000fb40: 6573 2e67 6574 2827 636c 6f75 6469 6e69  es.get('cloudini
+0000fb50: 7427 290a 2020 2020 2020 2020 696d 6167  t').        imag
+0000fb60: 6520 3d20 6f76 6572 7269 6465 732e 6765  e = overrides.ge
+0000fb70: 7428 2769 6d61 6765 2729 0a20 2020 2020  t('image').     
+0000fb80: 2020 206e 6574 7320 3d20 6f76 6572 7269     nets = overri
+0000fb90: 6465 732e 6765 7428 276e 6574 7327 290a  des.get('nets').
+0000fba0: 2020 2020 2020 2020 6469 736b 7320 3d20          disks = 
+0000fbb0: 6f76 6572 7269 6465 732e 6765 7428 2764  overrides.get('d
+0000fbc0: 6973 6b73 2729 0a20 2020 2020 2020 2069  isks').        i
+0000fbd0: 6e66 6f72 6d61 7469 6f6e 203d 206f 7665  nformation = ove
+0000fbe0: 7272 6964 6573 2e67 6574 2827 696e 666f  rrides.get('info
+0000fbf0: 726d 6174 696f 6e27 290a 2020 2020 2020  rmation').      
+0000fc00: 2020 6370 7566 6c61 6773 203d 206f 7665    cpuflags = ove
+0000fc10: 7272 6964 6573 2e67 6574 2827 6370 7566  rrides.get('cpuf
+0000fc20: 6c61 6773 272c 205b 5d29 0a20 2020 2020  lags', []).     
+0000fc30: 2020 2064 6973 6162 6c65 203d 206f 7665     disable = ove
+0000fc40: 7272 6964 6573 2e67 6574 2827 6469 7361  rrides.get('disa
+0000fc50: 626c 6527 2c20 4661 6c73 6529 0a20 2020  ble', False).   
+0000fc60: 2020 2020 206f 7665 7272 6964 6573 2e70       overrides.p
+0000fc70: 6f70 2827 6469 7361 626c 6527 2c20 4e6f  op('disable', No
+0000fc80: 6e65 290a 2020 2020 2020 2020 6578 7472  ne).        extr
+0000fc90: 615f 6d65 7461 6461 7461 203d 207b 6b3a  a_metadata = {k:
+0000fca0: 206f 7665 7272 6964 6573 5b6b 5d20 666f   overrides[k] fo
+0000fcb0: 7220 6b20 696e 206f 7665 7272 6964 6573  r k in overrides
+0000fcc0: 2069 6620 6b20 6e6f 7420 696e 2073 656c   if k not in sel
+0000fcd0: 662e 6c69 7374 5f6b 6579 776f 7264 7328  f.list_keywords(
+0000fce0: 297d 0a20 2020 2020 2020 2074 656d 706c  )}.        templ
+0000fcf0: 6174 6520 3d20 6f76 6572 7269 6465 732e  ate = overrides.
+0000fd00: 6765 7428 2774 656d 706c 6174 6527 290a  get('template').
+0000fd10: 2020 2020 2020 2020 6966 2074 656d 706c          if templ
+0000fd20: 6174 6520 6973 206e 6f74 204e 6f6e 653a  ate is not None:
+0000fd30: 0a20 2020 2020 2020 2020 2020 2064 656c  .            del
+0000fd40: 2065 7874 7261 5f6d 6574 6164 6174 615b   extra_metadata[
+0000fd50: 2774 656d 706c 6174 6527 5d0a 2020 2020  'template'].    
+0000fd60: 2020 2020 6966 2064 6e73 3a0a 2020 2020      if dns:.    
+0000fd70: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
+0000fd80: 2243 7265 6174 696e 6720 446e 7320 656e  "Creating Dns en
+0000fd90: 7472 7920 666f 7220 7b6e 616d 657d 2e2e  try for {name}..
+0000fda0: 2e22 290a 2020 2020 2020 2020 2020 2020  .").            
+0000fdb0: 6e65 7477 6f72 6b73 203d 206b 2e76 6d5f  networks = k.vm_
+0000fdc0: 706f 7274 7328 6e61 6d65 290a 2020 2020  ports(name).    
+0000fdd0: 2020 2020 2020 2020 6966 206e 6574 776f          if netwo
+0000fde0: 726b 7320 616e 6420 646f 6d61 696e 2069  rks and domain i
+0000fdf0: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+0000fe00: 2020 2020 2020 2020 646f 6d61 696e 203d          domain =
+0000fe10: 206e 6574 776f 726b 735b 305d 0a20 2020   networks[0].   
+0000fe20: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+0000fe30: 6e65 7473 3a0a 2020 2020 2020 2020 2020  nets:.          
+0000fe40: 2020 2020 2020 7265 7475 726e 0a20 2020        return.   
+0000fe50: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+0000fe60: 2020 2020 2020 2020 2020 2020 2020 206b                 k
+0000fe70: 2e72 6573 6572 7665 5f64 6e73 286e 616d  .reserve_dns(nam
+0000fe80: 653d 6e61 6d65 2c20 6e65 7473 3d6e 6574  e=name, nets=net
+0000fe90: 776f 726b 732c 2064 6f6d 6169 6e3d 646f  works, domain=do
+0000fea0: 6d61 696e 2c20 6970 3d69 7029 0a20 2020  main, ip=ip).   
+0000feb0: 2020 2020 2069 6620 6970 2069 7320 6e6f       if ip is no
+0000fec0: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+0000fed0: 2020 2020 7070 7269 6e74 2866 2255 7064      pprint(f"Upd
+0000fee0: 6174 696e 6720 6970 206f 6620 766d 207b  ating ip of vm {
+0000fef0: 6e61 6d65 7d20 746f 207b 6970 7d2e 2e2e  name} to {ip}...
+0000ff00: 2229 0a20 2020 2020 2020 2020 2020 206b  ").            k
+0000ff10: 2e75 7064 6174 655f 6d65 7461 6461 7461  .update_metadata
+0000ff20: 286e 616d 652c 2027 6970 272c 2069 7029  (name, 'ip', ip)
+0000ff30: 0a20 2020 2020 2020 2069 6620 636c 6f75  .        if clou
+0000ff40: 6469 6e69 743a 0a20 2020 2020 2020 2020  dinit:.         
+0000ff50: 2020 2070 7072 696e 7428 6622 5265 6d6f     pprint(f"Remo
+0000ff60: 7669 6e67 2063 6c6f 7564 696e 6974 2069  ving cloudinit i
+0000ff70: 6e66 6f72 6d61 7469 6f6e 206f 6620 766d  nformation of vm
+0000ff80: 207b 6e61 6d65 7d22 290a 2020 2020 2020   {name}").      
+0000ff90: 2020 2020 2020 6b2e 7265 6d6f 7665 5f63        k.remove_c
+0000ffa0: 6c6f 7564 696e 6974 286e 616d 6529 0a20  loudinit(name). 
+0000ffb0: 2020 2020 2020 2069 6620 696d 6167 6520         if image 
+0000ffc0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+0000ffd0: 2020 2020 2020 2020 2070 7072 696e 7428           pprint(
+0000ffe0: 6622 5570 6461 7469 6e67 2069 6d61 6765  f"Updating image
+0000fff0: 206f 6620 766d 207b 6e61 6d65 7d20 746f   of vm {name} to
+00010000: 207b 696d 6167 657d 2e2e 2e22 290a 2020   {image}...").  
+00010010: 2020 2020 2020 2020 2020 6b2e 7570 6461            k.upda
+00010020: 7465 5f6d 6574 6164 6174 6128 6e61 6d65  te_metadata(name
+00010030: 2c20 2769 6d61 6765 272c 2069 6d61 6765  , 'image', image
+00010040: 290a 2020 2020 2020 2020 6966 206d 656d  ).        if mem
+00010050: 6f72 7920 6973 206e 6f74 204e 6f6e 653a  ory is not None:
+00010060: 0a20 2020 2020 2020 2020 2020 2070 7072  .            ppr
+00010070: 696e 7428 6622 5570 6461 7469 6e67 206d  int(f"Updating m
+00010080: 656d 6f72 7920 6f66 2076 6d20 7b6e 616d  emory of vm {nam
+00010090: 657d 2074 6f20 7b6d 656d 6f72 797d 2e2e  e} to {memory}..
+000100a0: 2e22 290a 2020 2020 2020 2020 2020 2020  .").            
+000100b0: 6b2e 7570 6461 7465 5f6d 656d 6f72 7928  k.update_memory(
+000100c0: 6e61 6d65 2c20 6d65 6d6f 7279 290a 2020  name, memory).  
+000100d0: 2020 2020 2020 6966 206e 756d 6370 7573        if numcpus
+000100e0: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+000100f0: 2020 2020 2020 2020 2020 7070 7269 6e74            pprint
+00010100: 2866 2255 7064 6174 696e 6720 6e75 6d63  (f"Updating numc
+00010110: 7075 7320 6f66 2076 6d20 7b6e 616d 657d  pus of vm {name}
+00010120: 2074 6f20 7b6e 756d 6370 7573 7d2e 2e2e   to {numcpus}...
+00010130: 2229 0a20 2020 2020 2020 2020 2020 206b  ").            k
+00010140: 2e75 7064 6174 655f 6370 7573 286e 616d  .update_cpus(nam
+00010150: 652c 206e 756d 6370 7573 290a 2020 2020  e, numcpus).    
+00010160: 2020 2020 6966 2061 7574 6f73 7461 7274      if autostart
+00010170: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+00010180: 2020 2020 2020 2020 2020 7070 7269 6e74            pprint
+00010190: 2866 2253 6574 7469 6e67 2061 7574 6f73  (f"Setting autos
+000101a0: 7461 7274 2074 6f20 7b61 7574 6f73 7461  tart to {autosta
+000101b0: 7274 7d20 666f 7220 766d 207b 6e61 6d65  rt} for vm {name
+000101c0: 7d2e 2e2e 2229 0a20 2020 2020 2020 2020  }...").         
+000101d0: 2020 206b 2e75 7064 6174 655f 7374 6172     k.update_star
+000101e0: 7428 6e61 6d65 2c20 7374 6172 743d 6175  t(name, start=au
+000101f0: 746f 7374 6172 7429 0a20 2020 2020 2020  tostart).       
+00010200: 2069 6620 696e 666f 726d 6174 696f 6e3a   if information:
+00010210: 0a20 2020 2020 2020 2020 2020 2070 7072  .            ppr
+00010220: 696e 7428 6622 5365 7474 696e 6720 696e  int(f"Setting in
+00010230: 666f 726d 6174 696f 6e20 666f 7220 766d  formation for vm
+00010240: 207b 6e61 6d65 7d2e 2e2e 2229 0a20 2020   {name}...").   
+00010250: 2020 2020 2020 2020 206b 2e75 7064 6174           k.updat
+00010260: 655f 696e 666f 726d 6174 696f 6e28 6e61  e_information(na
+00010270: 6d65 2c20 696e 666f 726d 6174 696f 6e29  me, information)
+00010280: 0a20 2020 2020 2020 2069 6620 2769 736f  .        if 'iso
+00010290: 2720 696e 206f 7665 7272 6964 6573 3a0a  ' in overrides:.
+000102a0: 2020 2020 2020 2020 2020 2020 6973 6f20              iso 
+000102b0: 3d20 6f76 6572 7269 6465 735b 2769 736f  = overrides['iso
+000102c0: 275d 0a20 2020 2020 2020 2020 2020 2070  '].            p
+000102d0: 7072 696e 7428 6622 5377 6974 6368 696e  print(f"Switchin
+000102e0: 6720 6973 6f20 666f 7220 766d 207b 6e61  g iso for vm {na
+000102f0: 6d65 7d20 746f 207b 6973 6f7d 2e2e 2e22  me} to {iso}..."
+00010300: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+00010310: 2069 736f 203d 3d20 274e 6f6e 6527 206f   iso == 'None' o
+00010320: 7220 6973 6f20 3d3d 2027 273a 0a20 2020  r iso == '':.   
+00010330: 2020 2020 2020 2020 2020 2020 2069 736f               iso
+00010340: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
+00010350: 2020 2020 6b2e 7570 6461 7465 5f69 736f      k.update_iso
+00010360: 286e 616d 652c 2069 736f 290a 2020 2020  (name, iso).    
+00010370: 2020 2020 6966 2066 6c61 766f 7220 6973      if flavor is
+00010380: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+00010390: 2020 2020 2020 2070 7072 696e 7428 6622         pprint(f"
+000103a0: 5570 6461 7469 6e67 2066 6c61 766f 7220  Updating flavor 
+000103b0: 6f66 2076 6d20 7b6e 616d 657d 2074 6f20  of vm {name} to 
+000103c0: 7b66 6c61 766f 727d 2e2e 2e22 290a 2020  {flavor}...").  
+000103d0: 2020 2020 2020 2020 2020 6b2e 7570 6461            k.upda
+000103e0: 7465 5f66 6c61 766f 7228 6e61 6d65 2c20  te_flavor(name, 
+000103f0: 666c 6176 6f72 290a 2020 2020 2020 2020  flavor).        
+00010400: 6966 2068 6f73 743a 0a20 2020 2020 2020  if host:.       
+00010410: 2020 2020 2070 7072 696e 7428 6622 4372       pprint(f"Cr
+00010420: 6561 7469 6e67 2048 6f73 7420 656e 7472  eating Host entr
+00010430: 7920 666f 7220 766d 207b 6e61 6d65 7d2e  y for vm {name}.
+00010440: 2e2e 2229 0a20 2020 2020 2020 2020 2020  ..").           
+00010450: 206e 6574 776f 726b 7320 3d20 6b2e 766d   networks = k.vm
+00010460: 5f70 6f72 7473 286e 616d 6529 0a20 2020  _ports(name).   
+00010470: 2020 2020 2020 2020 2069 6620 6e65 7477           if netw
+00010480: 6f72 6b73 3a0a 2020 2020 2020 2020 2020  orks:.          
+00010490: 2020 2020 2020 6966 2064 6f6d 6169 6e20        if domain 
+000104a0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+000104b0: 2020 2020 2020 2020 2020 2020 2064 6f6d               dom
+000104c0: 6169 6e20 3d20 6e65 7477 6f72 6b73 5b30  ain = networks[0
+000104d0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+000104e0: 2020 6b2e 7265 7365 7276 655f 686f 7374    k.reserve_host
+000104f0: 286e 616d 652c 206e 6574 776f 726b 732c  (name, networks,
+00010500: 2064 6f6d 6169 6e29 0a20 2020 2020 2020   domain).       
+00010510: 2063 7572 7265 6e74 766d 203d 206b 2e69   currentvm = k.i
+00010520: 6e66 6f28 6e61 6d65 290a 2020 2020 2020  nfo(name).      
+00010530: 2020 6375 7272 656e 746e 6574 7320 3d20    currentnets = 
+00010540: 6375 7272 656e 7476 6d2e 6765 7428 276e  currentvm.get('n
+00010550: 6574 7327 2c20 5b5d 290a 2020 2020 2020  ets', []).      
+00010560: 2020 6375 7272 656e 7464 6973 6b73 203d    currentdisks =
+00010570: 2063 7572 7265 6e74 766d 2e67 6574 2827   currentvm.get('
+00010580: 6469 736b 7327 2c20 5b5d 290a 2020 2020  disks', []).    
+00010590: 2020 2020 6966 2064 6973 6b73 3a0a 2020      if disks:.  
+000105a0: 2020 2020 2020 2020 2020 7070 7269 6e74            pprint
+000105b0: 2866 2255 7064 6174 696e 6720 6469 736b  (f"Updating disk
+000105c0: 7320 6f66 2076 6d20 7b6e 616d 657d 2229  s of vm {name}")
+000105d0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+000105e0: 2069 6e64 6578 2c20 6375 7272 656e 7464   index, currentd
+000105f0: 6973 6b20 696e 2065 6e75 6d65 7261 7465  isk in enumerate
+00010600: 2863 7572 7265 6e74 6469 736b 7329 3a0a  (currentdisks):.
+00010610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010620: 6966 2069 6e64 6578 203c 206c 656e 2864  if index < len(d
+00010630: 6973 6b73 293a 0a20 2020 2020 2020 2020  isks):.         
+00010640: 2020 2020 2020 2020 2020 2064 6973 6b20             disk 
+00010650: 3d20 6469 736b 735b 696e 6465 785d 0a20  = disks[index]. 
+00010660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010670: 2020 2063 7572 7265 6e74 6469 736b 7369     currentdisksi
+00010680: 7a65 203d 2063 7572 7265 6e74 6469 736b  ze = currentdisk
+00010690: 5b27 7369 7a65 275d 0a20 2020 2020 2020  ['size'].       
+000106a0: 2020 2020 2020 2020 2020 2020 2064 6973               dis
+000106b0: 6b73 697a 6520 3d20 6469 736b 2e67 6574  ksize = disk.get
+000106c0: 2827 7369 7a65 272c 2031 3029 2069 6620  ('size', 10) if 
+000106d0: 6973 696e 7374 616e 6365 2864 6973 6b2c  isinstance(disk,
+000106e0: 2064 6963 7429 2065 6c73 6520 696e 7428   dict) else int(
+000106f0: 6469 736b 290a 2020 2020 2020 2020 2020  disk).          
+00010700: 2020 2020 2020 2020 2020 6966 2064 6973            if dis
+00010710: 6b73 697a 6520 3e20 6375 7272 656e 7464  ksize > currentd
+00010720: 6973 6b73 697a 653a 0a20 2020 2020 2020  isksize:.       
+00010730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010740: 2069 6620 6375 7272 656e 7476 6d2e 6765   if currentvm.ge
+00010750: 7428 2773 7461 7475 7327 2920 213d 2027  t('status') != '
+00010760: 646f 776e 273a 0a20 2020 2020 2020 2020  down':.         
+00010770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010780: 2020 2077 6172 6e69 6e67 2866 2243 616e     warning(f"Can
+00010790: 7420 7265 7369 7a65 2044 6973 6b20 7b69  t resize Disk {i
+000107a0: 6e64 6578 7d20 696e 207b 6e61 6d65 7d20  ndex} in {name} 
+000107b0: 7768 696c 6520 564d 2069 7320 7570 2229  while VM is up")
+000107c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000107d0: 2020 2020 2020 2020 2020 2020 2062 7265               bre
+000107e0: 616b 0a20 2020 2020 2020 2020 2020 2020  ak.             
+000107f0: 2020 2020 2020 2020 2020 2070 7072 696e             pprin
+00010800: 7428 6622 5265 7369 7a69 6e67 2044 6973  t(f"Resizing Dis
+00010810: 6b20 7b69 6e64 6578 7d20 696e 207b 6e61  k {index} in {na
+00010820: 6d65 7d22 290a 2020 2020 2020 2020 2020  me}").          
+00010830: 2020 2020 2020 2020 2020 2020 2020 6469                di
+00010840: 736b 7061 7468 203d 2063 7572 7265 6e74  skpath = current
+00010850: 6469 736b 5b27 7061 7468 275d 0a20 2020  disk['path'].   
+00010860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010870: 2020 2020 206b 2e72 6573 697a 655f 6469       k.resize_di
+00010880: 736b 2864 6973 6b70 6174 682c 2064 6973  sk(diskpath, dis
+00010890: 6b73 697a 6529 0a20 2020 2020 2020 2020  ksize).         
+000108a0: 2020 2069 6620 6c65 6e28 6375 7272 656e     if len(curren
+000108b0: 7464 6973 6b73 2920 3c20 6c65 6e28 6469  tdisks) < len(di
+000108c0: 736b 7329 3a0a 2020 2020 2020 2020 2020  sks):.          
+000108d0: 2020 2020 2020 7070 7269 6e74 2866 2241        pprint(f"A
+000108e0: 6464 696e 6720 4469 736b 7320 746f 207b  dding Disks to {
+000108f0: 6e61 6d65 7d22 290a 2020 2020 2020 2020  name}").        
+00010900: 2020 2020 2020 2020 666f 7220 6469 736b          for disk
+00010910: 2069 6e20 6469 736b 735b 6c65 6e28 6375   in disks[len(cu
+00010920: 7272 656e 7464 6973 6b73 293a 5d3a 0a20  rrentdisks):]:. 
+00010930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010940: 2020 2069 6e74 6572 6661 6365 203d 204e     interface = N
+00010950: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+00010960: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+00010970: 7461 6e63 6528 6469 736b 2c20 696e 7429  tance(disk, int)
+00010980: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00010990: 2020 2020 2020 2020 2020 7369 7a65 203d            size =
+000109a0: 2064 6973 6b0a 2020 2020 2020 2020 2020   disk.          
+000109b0: 2020 2020 2020 2020 2020 2020 2020 706f                po
+000109c0: 6f6c 203d 2073 656c 662e 706f 6f6c 0a20  ol = self.pool. 
 000109d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000109e0: 2020 2020 2020 7369 7a65 203d 2064 6973        size = dis
-000109f0: 6b0a 2020 2020 2020 2020 2020 2020 2020  k.              
-00010a00: 2020 2020 2020 2020 2020 706f 6f6c 203d            pool =
-00010a10: 2073 656c 662e 706f 6f6c 0a20 2020 2020   self.pool.     
-00010a20: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00010a30: 6c69 6620 6973 696e 7374 616e 6365 2864  lif isinstance(d
-00010a40: 6973 6b2c 2073 7472 2920 616e 6420 6469  isk, str) and di
-00010a50: 736b 2e69 7364 6967 6974 2829 3a0a 2020  sk.isdigit():.  
-00010a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010a70: 2020 2020 2020 7369 7a65 203d 2069 6e74        size = int
-00010a80: 2864 6973 6b29 0a20 2020 2020 2020 2020  (disk).         
-00010a90: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00010aa0: 6f6f 6c20 3d20 7365 6c66 2e70 6f6f 6c0a  ool = self.pool.
-00010ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010ac0: 2020 2020 656c 6966 2069 7369 6e73 7461      elif isinsta
-00010ad0: 6e63 6528 6469 736b 2c20 6469 6374 293a  nce(disk, dict):
-00010ae0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010af0: 2020 2020 2020 2020 2073 697a 6520 3d20           size = 
-00010b00: 6469 736b 2e67 6574 2827 7369 7a65 272c  disk.get('size',
-00010b10: 2073 656c 662e 6469 736b 7369 7a65 290a   self.disksize).
-00010b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010b30: 2020 2020 2020 2020 706f 6f6c 203d 2064          pool = d
-00010b40: 6973 6b2e 6765 7428 2770 6f6f 6c27 2c20  isk.get('pool', 
-00010b50: 7365 6c66 2e70 6f6f 6c29 0a20 2020 2020  self.pool).     
-00010b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010b70: 2020 2069 6e74 6572 6661 6365 203d 2064     interface = d
-00010b80: 6973 6b2e 6765 7428 2769 6e74 6572 6661  isk.get('interfa
-00010b90: 6365 2729 206f 7220 6f76 6572 7269 6465  ce') or override
-00010ba0: 732e 6765 7428 2764 6973 6b69 6e74 6572  s.get('diskinter
-00010bb0: 6661 6365 2729 0a20 2020 2020 2020 2020  face').         
-00010bc0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00010bd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010be0: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
-00010bf0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-00010c00: 2020 2020 2020 6b2e 6164 645f 6469 736b        k.add_disk
-00010c10: 286e 616d 653d 6e61 6d65 2c20 7369 7a65  (name=name, size
-00010c20: 3d73 697a 652c 2070 6f6f 6c3d 706f 6f6c  =size, pool=pool
-00010c30: 2c20 696e 7465 7266 6163 653d 696e 7465  , interface=inte
-00010c40: 7266 6163 6529 0a20 2020 2020 2020 2020  rface).         
-00010c50: 2020 2069 6620 6c65 6e28 6375 7272 656e     if len(curren
-00010c60: 7464 6973 6b73 2920 3e20 6c65 6e28 6469  tdisks) > len(di
-00010c70: 736b 7329 3a0a 2020 2020 2020 2020 2020  sks):.          
-00010c80: 2020 2020 2020 7070 7269 6e74 2866 2252        pprint(f"R
-00010c90: 656d 6f76 696e 6720 4469 736b 7320 6f66  emoving Disks of
-00010ca0: 207b 6e61 6d65 7d22 290a 2020 2020 2020   {name}").      
-00010cb0: 2020 2020 2020 2020 2020 666f 7220 6469            for di
-00010cc0: 736b 2069 6e20 6375 7272 656e 7464 6973  sk in currentdis
-00010cd0: 6b73 5b6c 656e 2863 7572 7265 6e74 6469  ks[len(currentdi
-00010ce0: 736b 7329 202d 206c 656e 2864 6973 6b73  sks) - len(disks
-00010cf0: 293a 5d3a 0a20 2020 2020 2020 2020 2020  ):]:.           
-00010d00: 2020 2020 2020 2020 2064 6973 6b6e 616d           disknam
-00010d10: 6520 3d20 6f73 2e70 6174 682e 6261 7365  e = os.path.base
-00010d20: 6e61 6d65 2864 6973 6b5b 2770 6174 6827  name(disk['path'
-00010d30: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
-00010d40: 2020 2020 2020 2064 6973 6b70 6f6f 6c20         diskpool 
-00010d50: 3d20 6f73 2e70 6174 682e 6469 726e 616d  = os.path.dirnam
-00010d60: 6528 6469 736b 5b27 7061 7468 275d 290a  e(disk['path']).
-00010d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010d80: 2020 2020 6b2e 6465 6c65 7465 5f64 6973      k.delete_dis
-00010d90: 6b28 6e61 6d65 3d6e 616d 652c 2064 6973  k(name=name, dis
-00010da0: 6b6e 616d 653d 6469 736b 6e61 6d65 2c20  kname=diskname, 
-00010db0: 706f 6f6c 3d64 6973 6b70 6f6f 6c2c 2069  pool=diskpool, i
-00010dc0: 6e74 6572 6661 6365 3d69 6e74 6572 6661  nterface=interfa
-00010dd0: 6365 290a 2020 2020 2020 2020 6966 206e  ce).        if n
-00010de0: 6574 733a 0a20 2020 2020 2020 2020 2020  ets:.           
-00010df0: 2070 7072 696e 7428 6622 5570 6461 7469   pprint(f"Updati
-00010e00: 6e67 206e 6574 7320 6f66 2076 6d20 7b6e  ng nets of vm {n
-00010e10: 616d 657d 2229 0a20 2020 2020 2020 2020  ame}").         
-00010e20: 2020 2069 6620 6c65 6e28 6375 7272 656e     if len(curren
-00010e30: 746e 6574 7329 203c 206c 656e 286e 6574  tnets) < len(net
-00010e40: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
-00010e50: 2020 2020 7070 7269 6e74 2866 2241 6464      pprint(f"Add
-00010e60: 696e 6720 4e69 6373 2074 6f20 7b6e 616d  ing Nics to {nam
-00010e70: 657d 2229 0a20 2020 2020 2020 2020 2020  e}").           
-00010e80: 2020 2020 2066 6f72 206e 6574 2069 6e20       for net in 
-00010e90: 6e65 7473 5b6c 656e 2863 7572 7265 6e74  nets[len(current
-00010ea0: 6e65 7473 293a 5d3a 0a20 2020 2020 2020  nets):]:.       
-00010eb0: 2020 2020 2020 2020 2020 2020 206d 6f64               mod
-00010ec0: 656c 203d 2027 7669 7274 696f 270a 2020  el = 'virtio'.  
-00010ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010ee0: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-00010ef0: 6e65 742c 2073 7472 293a 0a20 2020 2020  net, str):.     
-00010f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010f10: 2020 206e 6574 776f 726b 203d 206e 6574     network = net
-00010f20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010f30: 2020 2020 2065 6c69 6620 6973 696e 7374       elif isinst
-00010f40: 616e 6365 286e 6574 2c20 6469 6374 2920  ance(net, dict) 
-00010f50: 616e 6420 276e 616d 6527 2069 6e20 6e65  and 'name' in ne
-00010f60: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
-00010f70: 2020 2020 2020 2020 2020 206e 6574 776f             netwo
-00010f80: 726b 203d 206e 6574 5b27 6e61 6d65 275d  rk = net['name']
-00010f90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010fa0: 2020 2020 2020 2020 206d 6f64 656c 203d           model =
-00010fb0: 206e 6574 2e67 6574 2827 6d6f 6465 6c27   net.get('model'
-00010fc0: 2c20 2776 6972 7469 6f27 290a 2020 2020  , 'virtio').    
-00010fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010fe0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00010ff0: 2020 2020 2020 2020 2020 2020 2020 6572                er
-00011000: 726f 7228 6622 536b 6970 7069 6e67 2077  ror(f"Skipping w
-00011010: 726f 6e67 206e 6963 2073 7065 6320 666f  rong nic spec fo
-00011020: 7220 7b6e 616d 657d 2229 0a20 2020 2020  r {name}").     
-00011030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011040: 2020 2063 6f6e 7469 6e75 650a 2020 2020     continue.    
-00011050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011060: 6b2e 6164 645f 6e69 6328 6e61 6d65 2c20  k.add_nic(name, 
-00011070: 6e65 7477 6f72 6b2c 206d 6f64 656c 3d6d  network, model=m
-00011080: 6f64 656c 290a 2020 2020 2020 2020 2020  odel).          
-00011090: 2020 6966 206c 656e 2863 7572 7265 6e74    if len(current
-000110a0: 6e65 7473 2920 3e20 6c65 6e28 6e65 7473  nets) > len(nets
-000110b0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-000110c0: 2020 2070 7072 696e 7428 6622 5265 6d6f     pprint(f"Remo
-000110d0: 7669 6e67 204e 6963 7320 6f66 207b 6e61  ving Nics of {na
-000110e0: 6d65 7d22 290a 2020 2020 2020 2020 2020  me}").          
-000110f0: 2020 2020 2020 666f 7220 6e65 7420 696e        for net in
-00011100: 2072 616e 6765 286c 656e 2863 7572 7265   range(len(curre
-00011110: 6e74 6e65 7473 292c 206c 656e 286e 6574  ntnets), len(net
-00011120: 7329 2c20 2d31 293a 0a20 2020 2020 2020  s), -1):.       
-00011130: 2020 2020 2020 2020 2020 2020 2069 6e74               int
-00011140: 6572 6661 6365 203d 2022 6574 6825 7322  erface = "eth%s"
-00011150: 2025 2028 6e65 7420 2d20 3129 0a20 2020   % (net - 1).   
-00011160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011170: 206b 2e64 656c 6574 655f 6e69 6328 6e61   k.delete_nic(na
-00011180: 6d65 2c20 696e 7465 7266 6163 6529 0a20  me, interface). 
-00011190: 2020 2020 2020 2020 2020 2066 6f72 2069             for i
-000111a0: 6e64 6578 2c20 6375 7272 656e 746e 6574  ndex, currentnet
-000111b0: 2069 6e20 656e 756d 6572 6174 6528 6375   in enumerate(cu
-000111c0: 7272 656e 746e 6574 7329 3a0a 2020 2020  rrentnets):.    
-000111d0: 2020 2020 2020 2020 2020 2020 6966 2069              if i
-000111e0: 6e64 6578 203e 206c 656e 286e 6574 7329  ndex > len(nets)
-000111f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00011200: 2020 2020 2020 6272 6561 6b0a 2020 2020        break.    
-00011210: 2020 2020 2020 2020 2020 2020 6e65 746e              netn
-00011220: 616d 6520 3d20 6375 7272 656e 746e 6574  ame = currentnet
-00011230: 5b27 6e65 7427 5d0a 2020 2020 2020 2020  ['net'].        
-00011240: 2020 2020 2020 2020 7461 7267 6574 6e65          targetne
-00011250: 746e 616d 6520 3d20 6e65 7473 5b69 6e64  tname = nets[ind
-00011260: 6578 5d5b 276e 616d 6527 5d20 6966 2069  ex]['name'] if i
-00011270: 7369 6e73 7461 6e63 6528 6e65 7473 5b69  sinstance(nets[i
-00011280: 6e64 6578 5d2c 2064 6963 7429 2065 6c73  ndex], dict) els
-00011290: 6520 6e65 7473 5b69 6e64 6578 5d0a 2020  e nets[index].  
-000112a0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-000112b0: 2074 6172 6765 746e 6574 6e61 6d65 2021   targetnetname !
-000112c0: 3d20 6e65 746e 616d 653a 0a20 2020 2020  = netname:.     
-000112d0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-000112e0: 7072 696e 7428 6622 5570 6461 7469 6e67  print(f"Updating
-000112f0: 206e 6963 207b 696e 6465 787d 2074 6f20   nic {index} to 
-00011300: 6e65 7477 6f72 6b20 7b74 6172 6765 746e  network {targetn
-00011310: 6574 6e61 6d65 7d22 290a 2020 2020 2020  etname}").      
-00011320: 2020 2020 2020 2020 2020 2020 2020 6b2e                k.
-00011330: 7570 6461 7465 5f6e 6963 286e 616d 652c  update_nic(name,
-00011340: 2069 6e64 6578 2c20 7461 7267 6574 6e65   index, targetne
-00011350: 746e 616d 6529 0a20 2020 2020 2020 2069  tname).        i
-00011360: 6620 6578 7472 615f 6d65 7461 6461 7461  f extra_metadata
-00011370: 3a0a 2020 2020 2020 2020 2020 2020 666f  :.            fo
-00011380: 7220 6b65 7920 696e 2065 7874 7261 5f6d  r key in extra_m
-00011390: 6574 6164 6174 613a 0a20 2020 2020 2020  etadata:.       
-000113a0: 2020 2020 2020 2020 2076 616c 7565 203d           value =
-000113b0: 2065 7874 7261 5f6d 6574 6164 6174 615b   extra_metadata[
-000113c0: 6b65 795d 0a20 2020 2020 2020 2020 2020  key].           
-000113d0: 2020 2020 2070 7072 696e 7428 6622 5570       pprint(f"Up
-000113e0: 6461 7469 6e67 207b 6b65 797d 206f 6620  dating {key} of 
-000113f0: 766d 207b 6e61 6d65 7d20 746f 207b 7661  vm {name} to {va
-00011400: 6c75 657d 2e2e 2e22 290a 2020 2020 2020  lue}...").      
-00011410: 2020 2020 2020 2020 2020 6b2e 7570 6461            k.upda
-00011420: 7465 5f6d 6574 6164 6174 6128 6e61 6d65  te_metadata(name
-00011430: 2c20 6b65 792c 2076 616c 7565 290a 2020  , key, value).  
-00011440: 2020 2020 2020 6966 206f 7665 7272 6964        if overrid
-00011450: 6573 2e67 6574 2827 6669 6c65 7327 2c20  es.get('files', 
-00011460: 5b5d 293a 0a20 2020 2020 2020 2020 2020  []):.           
-00011470: 2069 6620 6f76 6572 7269 6465 732e 6765   if overrides.ge
-00011480: 7428 2773 6b69 705f 6669 6c65 735f 7265  t('skip_files_re
-00011490: 6d65 6469 6174 696f 6e27 2c20 4661 6c73  mediation', Fals
-000114a0: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
-000114b0: 2020 2020 7070 7269 6e74 2866 2253 6b69      pprint(f"Ski
-000114c0: 7070 696e 6720 5265 6d65 6469 6174 696f  pping Remediatio
-000114d0: 6e20 6669 6c65 7320 6f66 207b 6e61 6d65  n files of {name
-000114e0: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
-000114f0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00011500: 2020 2020 2020 6e65 7766 696c 6573 203d        newfiles =
-00011510: 206f 7665 7272 6964 6573 5b27 6669 6c65   overrides['file
-00011520: 7327 5d0a 2020 2020 2020 2020 2020 2020  s'].            
-00011530: 2020 2020 7070 7269 6e74 2866 2252 656d      pprint(f"Rem
-00011540: 6564 6961 7469 6e67 2066 696c 6573 206f  ediating files o
-00011550: 6620 7b6e 616d 657d 2229 0a20 2020 2020  f {name}").     
-00011560: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00011570: 7265 6d65 6469 6174 655f 6669 6c65 7328  remediate_files(
-00011580: 6e61 6d65 2c20 6e65 7766 696c 6573 2c20  name, newfiles, 
-00011590: 6f76 6572 7269 6465 7329 0a20 2020 2020  overrides).     
-000115a0: 2020 2069 6620 7365 6c66 2e74 7970 6520     if self.type 
-000115b0: 3d3d 2027 6b76 6d27 3a0a 2020 2020 2020  == 'kvm':.      
-000115c0: 2020 2020 2020 706f 6f6c 203d 206f 7665        pool = ove
-000115d0: 7272 6964 6573 2e67 6574 2827 706f 6f6c  rrides.get('pool
-000115e0: 2729 0a20 2020 2020 2020 2020 2020 2069  ').            i
-000115f0: 6620 706f 6f6c 2069 7320 6e6f 7420 4e6f  f pool is not No
-00011600: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00011610: 2020 2020 6b2e 7570 6461 7465 5f70 6f6f      k.update_poo
-00011620: 6c28 6e61 6d65 2c20 706f 6f6c 290a 2020  l(name, pool).  
-00011630: 2020 2020 2020 2020 2020 6966 2063 7075            if cpu
-00011640: 666c 6167 733a 0a20 2020 2020 2020 2020  flags:.         
-00011650: 2020 2020 2020 2070 7072 696e 7428 6622         pprint(f"
-00011660: 5570 6461 7469 6e67 2063 7075 666c 6167  Updating cpuflag
-00011670: 7320 6f66 2076 6d20 7b6e 616d 657d 2229  s of vm {name}")
-00011680: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011690: 206b 2e75 7064 6174 655f 6370 7566 6c61   k.update_cpufla
-000116a0: 6773 286e 616d 652c 2063 7075 666c 6167  gs(name, cpuflag
-000116b0: 732c 2064 6973 6162 6c65 290a 2020 2020  s, disable).    
-000116c0: 2020 2020 6966 2073 656c 662e 7479 7065      if self.type
-000116d0: 203d 3d20 2776 7370 6865 7265 2720 616e   == 'vsphere' an
-000116e0: 6420 7465 6d70 6c61 7465 2069 7320 6e6f  d template is no
-000116f0: 7420 4e6f 6e65 2061 6e64 2069 7369 6e73  t None and isins
-00011700: 7461 6e63 6528 7465 6d70 6c61 7465 2c20  tance(template, 
-00011710: 626f 6f6c 293a 0a20 2020 2020 2020 2020  bool):.         
-00011720: 2020 2074 6172 6765 7420 3d20 2774 656d     target = 'tem
-00011730: 706c 6174 6527 2069 6620 7465 6d70 6c61  plate' if templa
-00011740: 7465 2065 6c73 6520 2776 6d27 0a20 2020  te else 'vm'.   
-00011750: 2020 2020 2020 2020 2070 7072 696e 7428           pprint(
-00011760: 6622 5570 6461 7469 6e67 2076 6d20 7b6e  f"Updating vm {n
-00011770: 616d 657d 2074 6f20 7b74 6172 6765 747d  ame} to {target}
-00011780: 2e2e 2e22 290a 2020 2020 2020 2020 2020  ...").          
-00011790: 2020 6966 2074 656d 706c 6174 653a 0a20    if template:. 
-000117a0: 2020 2020 2020 2020 2020 2020 2020 206b                 k
-000117b0: 2e63 6f6e 7665 7274 5f74 6f5f 7465 6d70  .convert_to_temp
-000117c0: 6c61 7465 286e 616d 6529 0a20 2020 2020  late(name).     
-000117d0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-000117e0: 2020 2020 2020 2020 2020 2020 206b 2e63               k.c
-000117f0: 6f6e 7665 7274 5f74 6f5f 766d 286e 616d  onvert_to_vm(nam
-00011800: 6529 0a20 2020 2020 2020 2072 6574 7572  e).        retur
-00011810: 6e20 7b27 7265 7375 6c74 273a 2027 7375  n {'result': 'su
-00011820: 6363 6573 7327 7d0a 0a20 2020 2064 6566  ccess'}..    def
-00011830: 206c 6973 745f 706c 616e 7328 7365 6c66   list_plans(self
-00011840: 293a 0a20 2020 2020 2020 206b 203d 2073  ):.        k = s
-00011850: 656c 662e 6b0a 2020 2020 2020 2020 7265  elf.k.        re
-00011860: 7375 6c74 7320 3d20 5b5d 0a20 2020 2020  sults = [].     
-00011870: 2020 2070 6c61 6e73 203d 207b 7d0a 2020     plans = {}.  
-00011880: 2020 2020 2020 666f 7220 766d 2069 6e20        for vm in 
-00011890: 6b2e 6c69 7374 2829 3a0a 2020 2020 2020  k.list():.      
-000118a0: 2020 2020 2020 766d 6e61 6d65 203d 2076        vmname = v
-000118b0: 6d5b 276e 616d 6527 5d0a 2020 2020 2020  m['name'].      
-000118c0: 2020 2020 2020 706c 616e 203d 2076 6d2e        plan = vm.
-000118d0: 6765 7428 2770 6c61 6e27 290a 2020 2020  get('plan').    
-000118e0: 2020 2020 2020 2020 6966 2070 6c61 6e20          if plan 
-000118f0: 6973 204e 6f6e 6520 6f72 2070 6c61 6e20  is None or plan 
-00011900: 3d3d 2027 6b76 6972 7427 206f 7220 706c  == 'kvirt' or pl
-00011910: 616e 203d 3d20 2727 3a0a 2020 2020 2020  an == '':.      
-00011920: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
-00011930: 7565 0a20 2020 2020 2020 2020 2020 2065  ue.            e
-00011940: 6c69 6620 706c 616e 206e 6f74 2069 6e20  lif plan not in 
-00011950: 706c 616e 733a 0a20 2020 2020 2020 2020  plans:.         
-00011960: 2020 2020 2020 2070 6c61 6e73 5b70 6c61         plans[pla
-00011970: 6e5d 203d 205b 766d 6e61 6d65 5d0a 2020  n] = [vmname].  
-00011980: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-00011990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000119a0: 706c 616e 735b 706c 616e 5d2e 6170 7065  plans[plan].appe
-000119b0: 6e64 2876 6d6e 616d 6529 0a20 2020 2020  nd(vmname).     
-000119c0: 2020 2066 6f72 2070 6c61 6e20 696e 2070     for plan in p
-000119d0: 6c61 6e73 3a0a 2020 2020 2020 2020 2020  lans:.          
-000119e0: 2020 7265 7375 6c74 732e 6170 7065 6e64    results.append
-000119f0: 285b 706c 616e 2c20 272c 272e 6a6f 696e  ([plan, ','.join
-00011a00: 2870 6c61 6e73 5b70 6c61 6e5d 295d 290a  (plans[plan])]).
-00011a10: 2020 2020 2020 2020 7265 7475 726e 2072          return r
-00011a20: 6573 756c 7473 0a0a 2020 2020 6465 6620  esults..    def 
-00011a30: 6c69 7374 5f6b 7562 6573 2873 656c 6629  list_kubes(self)
-00011a40: 3a0a 2020 2020 2020 2020 6b20 3d20 7365  :.        k = se
-00011a50: 6c66 2e6b 0a20 2020 2020 2020 2069 6620  lf.k.        if 
-00011a60: 7365 6c66 2e74 7970 6520 3d3d 2027 7765  self.type == 'we
-00011a70: 6227 2061 6e64 2073 656c 662e 6b2e 6c6f  b' and self.k.lo
-00011a80: 6361 6c6b 7562 653a 0a20 2020 2020 2020  calkube:.       
-00011a90: 2020 2020 2072 6574 7572 6e20 6b2e 6c69       return k.li
-00011aa0: 7374 5f6b 7562 6573 2829 0a20 2020 2020  st_kubes().     
-00011ab0: 2020 206b 7562 6573 203d 207b 7d0a 2020     kubes = {}.  
-00011ac0: 2020 2020 2020 666f 7220 766d 2069 6e20        for vm in 
-00011ad0: 6b2e 6c69 7374 2829 3a0a 2020 2020 2020  k.list():.      
-00011ae0: 2020 2020 2020 6966 2027 6b75 6265 2720        if 'kube' 
-00011af0: 696e 2076 6d20 616e 6420 276b 7562 6574  in vm and 'kubet
-00011b00: 7970 6527 2069 6e20 766d 3a0a 2020 2020  ype' in vm:.    
-00011b10: 2020 2020 2020 2020 2020 2020 766d 6e61              vmna
-00011b20: 6d65 203d 2076 6d5b 276e 616d 6527 5d0a  me = vm['name'].
-00011b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011b40: 6b75 6265 203d 2076 6d5b 276b 7562 6527  kube = vm['kube'
-00011b50: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-00011b60: 2020 5f74 7970 6520 3d20 766d 5b27 6b75    _type = vm['ku
-00011b70: 6265 7479 7065 275d 0a20 2020 2020 2020  betype'].       
-00011b80: 2020 2020 2020 2020 2070 6c61 6e20 3d20           plan = 
-00011b90: 766d 5b27 706c 616e 275d 0a20 2020 2020  vm['plan'].     
-00011ba0: 2020 2020 2020 2020 2020 2069 6620 6b75             if ku
-00011bb0: 6265 206e 6f74 2069 6e20 6b75 6265 733a  be not in kubes:
-00011bc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011bd0: 2020 2020 206b 7562 6573 5b6b 7562 655d       kubes[kube]
-00011be0: 203d 207b 2774 7970 6527 3a20 5f74 7970   = {'type': _typ
-00011bf0: 652c 2027 706c 616e 273a 2070 6c61 6e2c  e, 'plan': plan,
-00011c00: 2027 766d 7327 3a20 5b76 6d6e 616d 655d   'vms': [vmname]
-00011c10: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
-00011c20: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00011c30: 2020 2020 2020 2020 2020 2020 6b75 6265              kube
-00011c40: 735b 6b75 6265 5d5b 2776 6d73 275d 2e61  s[kube]['vms'].a
-00011c50: 7070 656e 6428 766d 6e61 6d65 290a 2020  ppend(vmname).  
-00011c60: 2020 2020 2020 666f 7220 6b75 6265 2069        for kube i
-00011c70: 6e20 6b75 6265 733a 0a20 2020 2020 2020  n kubes:.       
-00011c80: 2020 2020 206b 7562 6573 5b6b 7562 655d       kubes[kube]
-00011c90: 5b27 766d 7327 5d20 3d20 272c 272e 6a6f  ['vms'] = ','.jo
-00011ca0: 696e 286b 7562 6573 5b6b 7562 655d 5b27  in(kubes[kube]['
-00011cb0: 766d 7327 5d29 0a20 2020 2020 2020 2063  vms']).        c
-00011cc0: 6c75 7374 6572 7364 6972 203d 206f 732e  lustersdir = os.
-00011cd0: 7061 7468 2e65 7870 616e 6475 7365 7228  path.expanduser(
-00011ce0: 277e 2f2e 6b63 6c69 2f63 6c75 7374 6572  '~/.kcli/cluster
-00011cf0: 7327 290a 2020 2020 2020 2020 6966 206f  s').        if o
-00011d00: 732e 7061 7468 2e65 7869 7374 7328 636c  s.path.exists(cl
-00011d10: 7573 7465 7273 6469 7229 3a0a 2020 2020  ustersdir):.    
-00011d20: 2020 2020 2020 2020 666f 7220 6b75 6265          for kube
-00011d30: 2069 6e20 6e65 7874 286f 732e 7761 6c6b   in next(os.walk
-00011d40: 2863 6c75 7374 6572 7364 6972 2929 5b31  (clustersdir))[1
-00011d50: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
-00011d60: 2020 2069 6620 6b75 6265 2069 6e20 6b75     if kube in ku
-00011d70: 6265 733a 0a20 2020 2020 2020 2020 2020  bes:.           
-00011d80: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
-00011d90: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-00011da0: 2020 636c 7573 7465 7264 6972 203d 2066    clusterdir = f
-00011db0: 277b 636c 7573 7465 7273 6469 727d 2f7b  '{clustersdir}/{
-00011dc0: 6b75 6265 7d27 0a20 2020 2020 2020 2020  kube}'.         
-00011dd0: 2020 2020 2020 205f 7479 7065 2c20 706c         _type, pl
-00011de0: 616e 203d 2027 6765 6e65 7269 6327 2c20  an = 'generic', 
-00011df0: 6b75 6265 0a20 2020 2020 2020 2020 2020  kube.           
-00011e00: 2020 2020 2069 6620 6f73 2e70 6174 682e       if os.path.
-00011e10: 6578 6973 7473 2866 277b 636c 7573 7465  exists(f'{cluste
-00011e20: 7264 6972 7d2f 6b63 6c69 5f70 6172 616d  rdir}/kcli_param
-00011e30: 6574 6572 732e 796d 6c27 293a 0a20 2020  eters.yml'):.   
-00011e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011e50: 2077 6974 6820 6f70 656e 2866 227b 636c   with open(f"{cl
-00011e60: 7573 7465 7264 6972 7d2f 6b63 6c69 5f70  usterdir}/kcli_p
-00011e70: 6172 616d 6574 6572 732e 796d 6c22 2c20  arameters.yml", 
-00011e80: 2772 2729 2061 7320 696e 7374 616c 6c3a  'r') as install:
-00011e90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011ea0: 2020 2020 2020 2020 2069 6e73 7461 6c6c           install
-00011eb0: 7061 7261 6d20 3d20 7961 6d6c 2e73 6166  param = yaml.saf
-00011ec0: 655f 6c6f 6164 2869 6e73 7461 6c6c 290a  e_load(install).
+000109e0: 2020 2065 6c69 6620 6973 696e 7374 616e     elif isinstan
+000109f0: 6365 2864 6973 6b2c 2073 7472 2920 616e  ce(disk, str) an
+00010a00: 6420 6469 736b 2e69 7364 6967 6974 2829  d disk.isdigit()
+00010a10: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00010a20: 2020 2020 2020 2020 2020 7369 7a65 203d            size =
+00010a30: 2069 6e74 2864 6973 6b29 0a20 2020 2020   int(disk).     
+00010a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010a50: 2020 2070 6f6f 6c20 3d20 7365 6c66 2e70     pool = self.p
+00010a60: 6f6f 6c0a 2020 2020 2020 2020 2020 2020  ool.            
+00010a70: 2020 2020 2020 2020 656c 6966 2069 7369          elif isi
+00010a80: 6e73 7461 6e63 6528 6469 736b 2c20 6469  nstance(disk, di
+00010a90: 6374 293a 0a20 2020 2020 2020 2020 2020  ct):.           
+00010aa0: 2020 2020 2020 2020 2020 2020 2073 697a               siz
+00010ab0: 6520 3d20 6469 736b 2e67 6574 2827 7369  e = disk.get('si
+00010ac0: 7a65 272c 2073 656c 662e 6469 736b 7369  ze', self.disksi
+00010ad0: 7a65 290a 2020 2020 2020 2020 2020 2020  ze).            
+00010ae0: 2020 2020 2020 2020 2020 2020 706f 6f6c              pool
+00010af0: 203d 2064 6973 6b2e 6765 7428 2770 6f6f   = disk.get('poo
+00010b00: 6c27 2c20 7365 6c66 2e70 6f6f 6c29 0a20  l', self.pool). 
+00010b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010b20: 2020 2020 2020 2069 6e74 6572 6661 6365         interface
+00010b30: 203d 2064 6973 6b2e 6765 7428 2769 6e74   = disk.get('int
+00010b40: 6572 6661 6365 2729 206f 7220 6f76 6572  erface') or over
+00010b50: 7269 6465 732e 6765 7428 2764 6973 6b69  rides.get('diski
+00010b60: 6e74 6572 6661 6365 2729 0a20 2020 2020  nterface').     
+00010b70: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00010b80: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00010b90: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+00010ba0: 7469 6e75 650a 2020 2020 2020 2020 2020  tinue.          
+00010bb0: 2020 2020 2020 2020 2020 6b2e 6164 645f            k.add_
+00010bc0: 6469 736b 286e 616d 653d 6e61 6d65 2c20  disk(name=name, 
+00010bd0: 7369 7a65 3d73 697a 652c 2070 6f6f 6c3d  size=size, pool=
+00010be0: 706f 6f6c 2c20 696e 7465 7266 6163 653d  pool, interface=
+00010bf0: 696e 7465 7266 6163 6529 0a20 2020 2020  interface).     
+00010c00: 2020 2020 2020 2069 6620 6c65 6e28 6375         if len(cu
+00010c10: 7272 656e 7464 6973 6b73 2920 3e20 6c65  rrentdisks) > le
+00010c20: 6e28 6469 736b 7329 3a0a 2020 2020 2020  n(disks):.      
+00010c30: 2020 2020 2020 2020 2020 7070 7269 6e74            pprint
+00010c40: 2866 2252 656d 6f76 696e 6720 4469 736b  (f"Removing Disk
+00010c50: 7320 6f66 207b 6e61 6d65 7d22 290a 2020  s of {name}").  
+00010c60: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+00010c70: 7220 6469 736b 2069 6e20 6375 7272 656e  r disk in curren
+00010c80: 7464 6973 6b73 5b6c 656e 2863 7572 7265  tdisks[len(curre
+00010c90: 6e74 6469 736b 7329 202d 206c 656e 2864  ntdisks) - len(d
+00010ca0: 6973 6b73 293a 5d3a 0a20 2020 2020 2020  isks):]:.       
+00010cb0: 2020 2020 2020 2020 2020 2020 2064 6973               dis
+00010cc0: 6b6e 616d 6520 3d20 6f73 2e70 6174 682e  kname = os.path.
+00010cd0: 6261 7365 6e61 6d65 2864 6973 6b5b 2770  basename(disk['p
+00010ce0: 6174 6827 5d29 0a20 2020 2020 2020 2020  ath']).         
+00010cf0: 2020 2020 2020 2020 2020 2064 6973 6b70             diskp
+00010d00: 6f6f 6c20 3d20 6f73 2e70 6174 682e 6469  ool = os.path.di
+00010d10: 726e 616d 6528 6469 736b 5b27 7061 7468  rname(disk['path
+00010d20: 275d 290a 2020 2020 2020 2020 2020 2020  ']).            
+00010d30: 2020 2020 2020 2020 6b2e 6465 6c65 7465          k.delete
+00010d40: 5f64 6973 6b28 6e61 6d65 3d6e 616d 652c  _disk(name=name,
+00010d50: 2064 6973 6b6e 616d 653d 6469 736b 6e61   diskname=diskna
+00010d60: 6d65 2c20 706f 6f6c 3d64 6973 6b70 6f6f  me, pool=diskpoo
+00010d70: 6c2c 2069 6e74 6572 6661 6365 3d69 6e74  l, interface=int
+00010d80: 6572 6661 6365 290a 2020 2020 2020 2020  erface).        
+00010d90: 6966 206e 6574 733a 0a20 2020 2020 2020  if nets:.       
+00010da0: 2020 2020 2070 7072 696e 7428 6622 5570       pprint(f"Up
+00010db0: 6461 7469 6e67 206e 6574 7320 6f66 2076  dating nets of v
+00010dc0: 6d20 7b6e 616d 657d 2229 0a20 2020 2020  m {name}").     
+00010dd0: 2020 2020 2020 2069 6620 6c65 6e28 6375         if len(cu
+00010de0: 7272 656e 746e 6574 7329 203c 206c 656e  rrentnets) < len
+00010df0: 286e 6574 7329 3a0a 2020 2020 2020 2020  (nets):.        
+00010e00: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
+00010e10: 2241 6464 696e 6720 4e69 6373 2074 6f20  "Adding Nics to 
+00010e20: 7b6e 616d 657d 2229 0a20 2020 2020 2020  {name}").       
+00010e30: 2020 2020 2020 2020 2066 6f72 206e 6574           for net
+00010e40: 2069 6e20 6e65 7473 5b6c 656e 2863 7572   in nets[len(cur
+00010e50: 7265 6e74 6e65 7473 293a 5d3a 0a20 2020  rentnets):]:.   
+00010e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010e70: 206d 6f64 656c 203d 2027 7669 7274 696f   model = 'virtio
+00010e80: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
+00010e90: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+00010ea0: 6e63 6528 6e65 742c 2073 7472 293a 0a20  nce(net, str):. 
+00010eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010ec0: 2020 2020 2020 206e 6574 776f 726b 203d         network =
+00010ed0: 206e 6574 0a20 2020 2020 2020 2020 2020   net.           
+00010ee0: 2020 2020 2020 2020 2065 6c69 6620 6973           elif is
+00010ef0: 696e 7374 616e 6365 286e 6574 2c20 6469  instance(net, di
+00010f00: 6374 2920 616e 6420 276e 616d 6527 2069  ct) and 'name' i
+00010f10: 6e20 6e65 743a 0a20 2020 2020 2020 2020  n net:.         
+00010f20: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00010f30: 6574 776f 726b 203d 206e 6574 5b27 6e61  etwork = net['na
+00010f40: 6d65 275d 0a20 2020 2020 2020 2020 2020  me'].           
+00010f50: 2020 2020 2020 2020 2020 2020 206d 6f64               mod
+00010f60: 656c 203d 206e 6574 2e67 6574 2827 6d6f  el = net.get('mo
+00010f70: 6465 6c27 2c20 2776 6972 7469 6f27 290a  del', 'virtio').
+00010f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010f90: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00010fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010fb0: 2020 6572 726f 7228 6622 536b 6970 7069    error(f"Skippi
+00010fc0: 6e67 2077 726f 6e67 206e 6963 2073 7065  ng wrong nic spe
+00010fd0: 6320 666f 7220 7b6e 616d 657d 2229 0a20  c for {name}"). 
+00010fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010ff0: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
+00011000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011010: 2020 2020 6b2e 6164 645f 6e69 6328 6e61      k.add_nic(na
+00011020: 6d65 2c20 6e65 7477 6f72 6b2c 206d 6f64  me, network, mod
+00011030: 656c 3d6d 6f64 656c 290a 2020 2020 2020  el=model).      
+00011040: 2020 2020 2020 6966 206c 656e 2863 7572        if len(cur
+00011050: 7265 6e74 6e65 7473 2920 3e20 6c65 6e28  rentnets) > len(
+00011060: 6e65 7473 293a 0a20 2020 2020 2020 2020  nets):.         
+00011070: 2020 2020 2020 2070 7072 696e 7428 6622         pprint(f"
+00011080: 5265 6d6f 7669 6e67 204e 6963 7320 6f66  Removing Nics of
+00011090: 207b 6e61 6d65 7d22 290a 2020 2020 2020   {name}").      
+000110a0: 2020 2020 2020 2020 2020 666f 7220 6e65            for ne
+000110b0: 7420 696e 2072 616e 6765 286c 656e 2863  t in range(len(c
+000110c0: 7572 7265 6e74 6e65 7473 292c 206c 656e  urrentnets), len
+000110d0: 286e 6574 7329 2c20 2d31 293a 0a20 2020  (nets), -1):.   
+000110e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000110f0: 2069 6e74 6572 6661 6365 203d 2022 6574   interface = "et
+00011100: 6825 7322 2025 2028 6e65 7420 2d20 3129  h%s" % (net - 1)
+00011110: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011120: 2020 2020 206b 2e64 656c 6574 655f 6e69       k.delete_ni
+00011130: 6328 6e61 6d65 2c20 696e 7465 7266 6163  c(name, interfac
+00011140: 6529 0a20 2020 2020 2020 2020 2020 2066  e).            f
+00011150: 6f72 2069 6e64 6578 2c20 6375 7272 656e  or index, curren
+00011160: 746e 6574 2069 6e20 656e 756d 6572 6174  tnet in enumerat
+00011170: 6528 6375 7272 656e 746e 6574 7329 3a0a  e(currentnets):.
+00011180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011190: 6966 2069 6e64 6578 203e 206c 656e 286e  if index > len(n
+000111a0: 6574 7329 3a0a 2020 2020 2020 2020 2020  ets):.          
+000111b0: 2020 2020 2020 2020 2020 6272 6561 6b0a            break.
+000111c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000111d0: 6e65 746e 616d 6520 3d20 6375 7272 656e  netname = curren
+000111e0: 746e 6574 5b27 6e65 7427 5d0a 2020 2020  tnet['net'].    
+000111f0: 2020 2020 2020 2020 2020 2020 7461 7267              targ
+00011200: 6574 6e65 746e 616d 6520 3d20 6e65 7473  etnetname = nets
+00011210: 5b69 6e64 6578 5d5b 276e 616d 6527 5d20  [index]['name'] 
+00011220: 6966 2069 7369 6e73 7461 6e63 6528 6e65  if isinstance(ne
+00011230: 7473 5b69 6e64 6578 5d2c 2064 6963 7429  ts[index], dict)
+00011240: 2065 6c73 6520 6e65 7473 5b69 6e64 6578   else nets[index
+00011250: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+00011260: 2020 6966 2074 6172 6765 746e 6574 6e61    if targetnetna
+00011270: 6d65 2021 3d20 6e65 746e 616d 653a 0a20  me != netname:. 
+00011280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011290: 2020 2070 7072 696e 7428 6622 5570 6461     pprint(f"Upda
+000112a0: 7469 6e67 206e 6963 207b 696e 6465 787d  ting nic {index}
+000112b0: 2074 6f20 6e65 7477 6f72 6b20 7b74 6172   to network {tar
+000112c0: 6765 746e 6574 6e61 6d65 7d22 290a 2020  getnetname}").  
+000112d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000112e0: 2020 6b2e 7570 6461 7465 5f6e 6963 286e    k.update_nic(n
+000112f0: 616d 652c 2069 6e64 6578 2c20 7461 7267  ame, index, targ
+00011300: 6574 6e65 746e 616d 6529 0a20 2020 2020  etnetname).     
+00011310: 2020 2069 6620 6578 7472 615f 6d65 7461     if extra_meta
+00011320: 6461 7461 3a0a 2020 2020 2020 2020 2020  data:.          
+00011330: 2020 666f 7220 6b65 7920 696e 2065 7874    for key in ext
+00011340: 7261 5f6d 6574 6164 6174 613a 0a20 2020  ra_metadata:.   
+00011350: 2020 2020 2020 2020 2020 2020 2076 616c               val
+00011360: 7565 203d 2065 7874 7261 5f6d 6574 6164  ue = extra_metad
+00011370: 6174 615b 6b65 795d 0a20 2020 2020 2020  ata[key].       
+00011380: 2020 2020 2020 2020 2070 7072 696e 7428           pprint(
+00011390: 6622 5570 6461 7469 6e67 207b 6b65 797d  f"Updating {key}
+000113a0: 206f 6620 766d 207b 6e61 6d65 7d20 746f   of vm {name} to
+000113b0: 207b 7661 6c75 657d 2e2e 2e22 290a 2020   {value}...").  
+000113c0: 2020 2020 2020 2020 2020 2020 2020 6b2e                k.
+000113d0: 7570 6461 7465 5f6d 6574 6164 6174 6128  update_metadata(
+000113e0: 6e61 6d65 2c20 6b65 792c 2076 616c 7565  name, key, value
+000113f0: 290a 2020 2020 2020 2020 6966 206f 7665  ).        if ove
+00011400: 7272 6964 6573 2e67 6574 2827 6669 6c65  rrides.get('file
+00011410: 7327 2c20 5b5d 293a 0a20 2020 2020 2020  s', []):.       
+00011420: 2020 2020 2069 6620 6f76 6572 7269 6465       if override
+00011430: 732e 6765 7428 2773 6b69 705f 6669 6c65  s.get('skip_file
+00011440: 735f 7265 6d65 6469 6174 696f 6e27 2c20  s_remediation', 
+00011450: 4661 6c73 6529 3a0a 2020 2020 2020 2020  False):.        
+00011460: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
+00011470: 2253 6b69 7070 696e 6720 5265 6d65 6469  "Skipping Remedi
+00011480: 6174 696f 6e20 6669 6c65 7320 6f66 207b  ation files of {
+00011490: 6e61 6d65 7d22 290a 2020 2020 2020 2020  name}").        
+000114a0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+000114b0: 2020 2020 2020 2020 2020 6e65 7766 696c            newfil
+000114c0: 6573 203d 206f 7665 7272 6964 6573 5b27  es = overrides['
+000114d0: 6669 6c65 7327 5d0a 2020 2020 2020 2020  files'].        
+000114e0: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
+000114f0: 2252 656d 6564 6961 7469 6e67 2066 696c  "Remediating fil
+00011500: 6573 206f 6620 7b6e 616d 657d 2229 0a20  es of {name}"). 
+00011510: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00011520: 656c 662e 7265 6d65 6469 6174 655f 6669  elf.remediate_fi
+00011530: 6c65 7328 6e61 6d65 2c20 6e65 7766 696c  les(name, newfil
+00011540: 6573 2c20 6f76 6572 7269 6465 7329 0a20  es, overrides). 
+00011550: 2020 2020 2020 2069 6620 7365 6c66 2e74         if self.t
+00011560: 7970 6520 3d3d 2027 6b76 6d27 3a0a 2020  ype == 'kvm':.  
+00011570: 2020 2020 2020 2020 2020 706f 6f6c 203d            pool =
+00011580: 206f 7665 7272 6964 6573 2e67 6574 2827   overrides.get('
+00011590: 706f 6f6c 2729 0a20 2020 2020 2020 2020  pool').         
+000115a0: 2020 2069 6620 706f 6f6c 2069 7320 6e6f     if pool is no
+000115b0: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+000115c0: 2020 2020 2020 2020 6b2e 7570 6461 7465          k.update
+000115d0: 5f70 6f6f 6c28 6e61 6d65 2c20 706f 6f6c  _pool(name, pool
+000115e0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+000115f0: 2063 7075 666c 6167 733a 0a20 2020 2020   cpuflags:.     
+00011600: 2020 2020 2020 2020 2020 2070 7072 696e             pprin
+00011610: 7428 6622 5570 6461 7469 6e67 2063 7075  t(f"Updating cpu
+00011620: 666c 6167 7320 6f66 2076 6d20 7b6e 616d  flags of vm {nam
+00011630: 657d 2229 0a20 2020 2020 2020 2020 2020  e}").           
+00011640: 2020 2020 206b 2e75 7064 6174 655f 6370       k.update_cp
+00011650: 7566 6c61 6773 286e 616d 652c 2063 7075  uflags(name, cpu
+00011660: 666c 6167 732c 2064 6973 6162 6c65 290a  flags, disable).
+00011670: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00011680: 7479 7065 203d 3d20 2776 7370 6865 7265  type == 'vsphere
+00011690: 2720 616e 6420 7465 6d70 6c61 7465 2069  ' and template i
+000116a0: 7320 6e6f 7420 4e6f 6e65 2061 6e64 2069  s not None and i
+000116b0: 7369 6e73 7461 6e63 6528 7465 6d70 6c61  sinstance(templa
+000116c0: 7465 2c20 626f 6f6c 293a 0a20 2020 2020  te, bool):.     
+000116d0: 2020 2020 2020 2074 6172 6765 7420 3d20         target = 
+000116e0: 2774 656d 706c 6174 6527 2069 6620 7465  'template' if te
+000116f0: 6d70 6c61 7465 2065 6c73 6520 2776 6d27  mplate else 'vm'
+00011700: 0a20 2020 2020 2020 2020 2020 2070 7072  .            ppr
+00011710: 696e 7428 6622 5570 6461 7469 6e67 2076  int(f"Updating v
+00011720: 6d20 7b6e 616d 657d 2074 6f20 7b74 6172  m {name} to {tar
+00011730: 6765 747d 2e2e 2e22 290a 2020 2020 2020  get}...").      
+00011740: 2020 2020 2020 6966 2074 656d 706c 6174        if templat
+00011750: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00011760: 2020 206b 2e63 6f6e 7665 7274 5f74 6f5f     k.convert_to_
+00011770: 7465 6d70 6c61 7465 286e 616d 6529 0a20  template(name). 
+00011780: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00011790: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000117a0: 206b 2e63 6f6e 7665 7274 5f74 6f5f 766d   k.convert_to_vm
+000117b0: 286e 616d 6529 0a20 2020 2020 2020 2072  (name).        r
+000117c0: 6574 7572 6e20 7b27 7265 7375 6c74 273a  eturn {'result':
+000117d0: 2027 7375 6363 6573 7327 7d0a 0a20 2020   'success'}..   
+000117e0: 2064 6566 206c 6973 745f 706c 616e 7328   def list_plans(
+000117f0: 7365 6c66 293a 0a20 2020 2020 2020 206b  self):.        k
+00011800: 203d 2073 656c 662e 6b0a 2020 2020 2020   = self.k.      
+00011810: 2020 7265 7375 6c74 7320 3d20 5b5d 0a20    results = []. 
+00011820: 2020 2020 2020 2070 6c61 6e73 203d 207b         plans = {
+00011830: 7d0a 2020 2020 2020 2020 666f 7220 766d  }.        for vm
+00011840: 2069 6e20 6b2e 6c69 7374 2829 3a0a 2020   in k.list():.  
+00011850: 2020 2020 2020 2020 2020 766d 6e61 6d65            vmname
+00011860: 203d 2076 6d5b 276e 616d 6527 5d0a 2020   = vm['name'].  
+00011870: 2020 2020 2020 2020 2020 706c 616e 203d            plan =
+00011880: 2076 6d2e 6765 7428 2770 6c61 6e27 290a   vm.get('plan').
+00011890: 2020 2020 2020 2020 2020 2020 6966 2070              if p
+000118a0: 6c61 6e20 6973 204e 6f6e 6520 6f72 2070  lan is None or p
+000118b0: 6c61 6e20 3d3d 2027 6b76 6972 7427 206f  lan == 'kvirt' o
+000118c0: 7220 706c 616e 203d 3d20 2727 3a0a 2020  r plan == '':.  
+000118d0: 2020 2020 2020 2020 2020 2020 2020 636f                co
+000118e0: 6e74 696e 7565 0a20 2020 2020 2020 2020  ntinue.         
+000118f0: 2020 2065 6c69 6620 706c 616e 206e 6f74     elif plan not
+00011900: 2069 6e20 706c 616e 733a 0a20 2020 2020   in plans:.     
+00011910: 2020 2020 2020 2020 2020 2070 6c61 6e73             plans
+00011920: 5b70 6c61 6e5d 203d 205b 766d 6e61 6d65  [plan] = [vmname
+00011930: 5d0a 2020 2020 2020 2020 2020 2020 656c  ].            el
+00011940: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00011950: 2020 2020 706c 616e 735b 706c 616e 5d2e      plans[plan].
+00011960: 6170 7065 6e64 2876 6d6e 616d 6529 0a20  append(vmname). 
+00011970: 2020 2020 2020 2066 6f72 2070 6c61 6e20         for plan 
+00011980: 696e 2070 6c61 6e73 3a0a 2020 2020 2020  in plans:.      
+00011990: 2020 2020 2020 7265 7375 6c74 732e 6170        results.ap
+000119a0: 7065 6e64 285b 706c 616e 2c20 272c 272e  pend([plan, ','.
+000119b0: 6a6f 696e 2870 6c61 6e73 5b70 6c61 6e5d  join(plans[plan]
+000119c0: 295d 290a 2020 2020 2020 2020 7265 7475  )]).        retu
+000119d0: 726e 2072 6573 756c 7473 0a0a 2020 2020  rn results..    
+000119e0: 6465 6620 6c69 7374 5f6b 7562 6573 2873  def list_kubes(s
+000119f0: 656c 6629 3a0a 2020 2020 2020 2020 6b20  elf):.        k 
+00011a00: 3d20 7365 6c66 2e6b 0a20 2020 2020 2020  = self.k.       
+00011a10: 2069 6620 7365 6c66 2e74 7970 6520 3d3d   if self.type ==
+00011a20: 2027 7765 6227 2061 6e64 2073 656c 662e   'web' and self.
+00011a30: 6b2e 6c6f 6361 6c6b 7562 653a 0a20 2020  k.localkube:.   
+00011a40: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00011a50: 6b2e 6c69 7374 5f6b 7562 6573 2829 0a20  k.list_kubes(). 
+00011a60: 2020 2020 2020 206b 7562 6573 203d 207b         kubes = {
+00011a70: 7d0a 2020 2020 2020 2020 666f 7220 766d  }.        for vm
+00011a80: 2069 6e20 6b2e 6c69 7374 2829 3a0a 2020   in k.list():.  
+00011a90: 2020 2020 2020 2020 2020 6966 2027 6b75            if 'ku
+00011aa0: 6265 2720 696e 2076 6d20 616e 6420 276b  be' in vm and 'k
+00011ab0: 7562 6574 7970 6527 2069 6e20 766d 3a0a  ubetype' in vm:.
+00011ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011ad0: 766d 6e61 6d65 203d 2076 6d5b 276e 616d  vmname = vm['nam
+00011ae0: 6527 5d0a 2020 2020 2020 2020 2020 2020  e'].            
+00011af0: 2020 2020 6b75 6265 203d 2076 6d5b 276b      kube = vm['k
+00011b00: 7562 6527 5d0a 2020 2020 2020 2020 2020  ube'].          
+00011b10: 2020 2020 2020 5f74 7970 6520 3d20 766d        _type = vm
+00011b20: 5b27 6b75 6265 7479 7065 275d 0a20 2020  ['kubetype'].   
+00011b30: 2020 2020 2020 2020 2020 2020 2070 6c61               pla
+00011b40: 6e20 3d20 766d 5b27 706c 616e 275d 0a20  n = vm['plan']. 
+00011b50: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00011b60: 6620 6b75 6265 206e 6f74 2069 6e20 6b75  f kube not in ku
+00011b70: 6265 733a 0a20 2020 2020 2020 2020 2020  bes:.           
+00011b80: 2020 2020 2020 2020 206b 7562 6573 5b6b           kubes[k
+00011b90: 7562 655d 203d 207b 2774 7970 6527 3a20  ube] = {'type': 
+00011ba0: 5f74 7970 652c 2027 706c 616e 273a 2070  _type, 'plan': p
+00011bb0: 6c61 6e2c 2027 766d 7327 3a20 5b76 6d6e  lan, 'vms': [vmn
+00011bc0: 616d 655d 7d0a 2020 2020 2020 2020 2020  ame]}.          
+00011bd0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00011be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011bf0: 6b75 6265 735b 6b75 6265 5d5b 2776 6d73  kubes[kube]['vms
+00011c00: 275d 2e61 7070 656e 6428 766d 6e61 6d65  '].append(vmname
+00011c10: 290a 2020 2020 2020 2020 666f 7220 6b75  ).        for ku
+00011c20: 6265 2069 6e20 6b75 6265 733a 0a20 2020  be in kubes:.   
+00011c30: 2020 2020 2020 2020 206b 7562 6573 5b6b           kubes[k
+00011c40: 7562 655d 5b27 766d 7327 5d20 3d20 272c  ube]['vms'] = ',
+00011c50: 272e 6a6f 696e 286b 7562 6573 5b6b 7562  '.join(kubes[kub
+00011c60: 655d 5b27 766d 7327 5d29 0a20 2020 2020  e]['vms']).     
+00011c70: 2020 2063 6c75 7374 6572 7364 6972 203d     clustersdir =
+00011c80: 206f 732e 7061 7468 2e65 7870 616e 6475   os.path.expandu
+00011c90: 7365 7228 277e 2f2e 6b63 6c69 2f63 6c75  ser('~/.kcli/clu
+00011ca0: 7374 6572 7327 290a 2020 2020 2020 2020  sters').        
+00011cb0: 6966 206f 732e 7061 7468 2e65 7869 7374  if os.path.exist
+00011cc0: 7328 636c 7573 7465 7273 6469 7229 3a0a  s(clustersdir):.
+00011cd0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00011ce0: 6b75 6265 2069 6e20 6e65 7874 286f 732e  kube in next(os.
+00011cf0: 7761 6c6b 2863 6c75 7374 6572 7364 6972  walk(clustersdir
+00011d00: 2929 5b31 5d3a 0a20 2020 2020 2020 2020  ))[1]:.         
+00011d10: 2020 2020 2020 2069 6620 6b75 6265 2069         if kube i
+00011d20: 6e20 6b75 6265 733a 0a20 2020 2020 2020  n kubes:.       
+00011d30: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+00011d40: 7469 6e75 650a 2020 2020 2020 2020 2020  tinue.          
+00011d50: 2020 2020 2020 636c 7573 7465 7264 6972        clusterdir
+00011d60: 203d 2066 277b 636c 7573 7465 7273 6469   = f'{clustersdi
+00011d70: 727d 2f7b 6b75 6265 7d27 0a20 2020 2020  r}/{kube}'.     
+00011d80: 2020 2020 2020 2020 2020 205f 7479 7065             _type
+00011d90: 2c20 706c 616e 203d 2027 6765 6e65 7269  , plan = 'generi
+00011da0: 6327 2c20 6b75 6265 0a20 2020 2020 2020  c', kube.       
+00011db0: 2020 2020 2020 2020 2069 6620 6f73 2e70           if os.p
+00011dc0: 6174 682e 6578 6973 7473 2866 277b 636c  ath.exists(f'{cl
+00011dd0: 7573 7465 7264 6972 7d2f 6b63 6c69 5f70  usterdir}/kcli_p
+00011de0: 6172 616d 6574 6572 732e 796d 6c27 293a  arameters.yml'):
+00011df0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011e00: 2020 2020 2077 6974 6820 6f70 656e 2866       with open(f
+00011e10: 227b 636c 7573 7465 7264 6972 7d2f 6b63  "{clusterdir}/kc
+00011e20: 6c69 5f70 6172 616d 6574 6572 732e 796d  li_parameters.ym
+00011e30: 6c22 2c20 2772 2729 2061 7320 696e 7374  l", 'r') as inst
+00011e40: 616c 6c3a 0a20 2020 2020 2020 2020 2020  all:.           
+00011e50: 2020 2020 2020 2020 2020 2020 2069 6e73               ins
+00011e60: 7461 6c6c 7061 7261 6d20 3d20 7961 6d6c  tallparam = yaml
+00011e70: 2e73 6166 655f 6c6f 6164 2869 6e73 7461  .safe_load(insta
+00011e80: 6c6c 290a 2020 2020 2020 2020 2020 2020  ll).            
+00011e90: 2020 2020 2020 2020 2020 2020 5f74 7970              _typ
+00011ea0: 6520 3d20 696e 7374 616c 6c70 6172 616d  e = installparam
+00011eb0: 2e67 6574 2827 6b75 6265 7479 7065 272c  .get('kubetype',
+00011ec0: 205f 7479 7065 290a 2020 2020 2020 2020   _type).        
 00011ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011ee0: 2020 2020 2020 2020 5f74 7970 6520 3d20          _type = 
-00011ef0: 696e 7374 616c 6c70 6172 616d 2e67 6574  installparam.get
-00011f00: 2827 6b75 6265 7479 7065 272c 205f 7479  ('kubetype', _ty
-00011f10: 7065 290a 2020 2020 2020 2020 2020 2020  pe).            
-00011f20: 2020 2020 2020 2020 2020 2020 706c 616e              plan
-00011f30: 203d 2069 6e73 7461 6c6c 7061 7261 6d2e   = installparam.
-00011f40: 6765 7428 2770 6c61 6e27 2c20 706c 616e  get('plan', plan
-00011f50: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00011f60: 2020 6b75 6265 735b 6b75 6265 5d20 3d20    kubes[kube] = 
-00011f70: 7b27 7479 7065 273a 205f 7479 7065 2c20  {'type': _type, 
-00011f80: 2770 6c61 6e27 3a20 706c 616e 2c20 2776  'plan': plan, 'v
-00011f90: 6d73 273a 205b 5d7d 0a20 2020 2020 2020  ms': []}.       
-00011fa0: 2069 6620 7365 6c66 2e74 7970 6520 3d3d   if self.type ==
-00011fb0: 2027 6763 7027 3a0a 2020 2020 2020 2020   'gcp':.        
-00011fc0: 2020 2020 6672 6f6d 206b 7669 7274 2e63      from kvirt.c
-00011fd0: 6c75 7374 6572 2069 6d70 6f72 7420 676b  luster import gk
-00011fe0: 650a 2020 2020 2020 2020 2020 2020 6b75  e.            ku
-00011ff0: 6265 732e 7570 6461 7465 2867 6b65 2e6c  bes.update(gke.l
-00012000: 6973 7428 7365 6c66 2929 0a20 2020 2020  ist(self)).     
-00012010: 2020 2065 6c69 6620 7365 6c66 2e74 7970     elif self.typ
-00012020: 6520 3d3d 2027 6177 7327 3a0a 2020 2020  e == 'aws':.    
-00012030: 2020 2020 2020 2020 6672 6f6d 206b 7669          from kvi
-00012040: 7274 2e63 6c75 7374 6572 2069 6d70 6f72  rt.cluster impor
-00012050: 7420 656b 730a 2020 2020 2020 2020 2020  t eks.          
-00012060: 2020 6b75 6265 732e 7570 6461 7465 2865    kubes.update(e
-00012070: 6b73 2e6c 6973 7428 7365 6c66 2929 0a20  ks.list(self)). 
-00012080: 2020 2020 2020 2072 6574 7572 6e20 6b75         return ku
-00012090: 6265 730a 0a20 2020 2064 6566 2063 7265  bes..    def cre
-000120a0: 6174 655f 7072 6f64 7563 7428 7365 6c66  ate_product(self
-000120b0: 2c20 6e61 6d65 2c20 7265 706f 3d4e 6f6e  , name, repo=Non
-000120c0: 652c 2067 726f 7570 3d4e 6f6e 652c 2070  e, group=None, p
-000120d0: 6c61 6e3d 4e6f 6e65 2c20 6c61 7465 7374  lan=None, latest
-000120e0: 3d46 616c 7365 2c20 6f76 6572 7269 6465  =False, override
-000120f0: 733d 7b7d 293a 0a20 2020 2020 2020 2022  s={}):.        "
-00012100: 2222 4372 6561 7465 2070 726f 6475 6374  ""Create product
-00012110: 2222 220a 2020 2020 2020 2020 6966 2072  """.        if r
-00012120: 6570 6f20 6973 206e 6f74 204e 6f6e 6520  epo is not None 
-00012130: 616e 6420 6772 6f75 7020 6973 206e 6f74  and group is not
-00012140: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00012150: 2020 2070 726f 6475 6374 7320 3d20 5b70     products = [p
-00012160: 726f 6475 6374 2066 6f72 2070 726f 6475  roduct for produ
-00012170: 6374 2069 6e20 7365 6c66 2e6c 6973 745f  ct in self.list_
-00012180: 7072 6f64 7563 7473 2829 0a20 2020 2020  products().     
-00012190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000121a0: 2020 2069 6620 7072 6f64 7563 745b 276e     if product['n
-000121b0: 616d 6527 5d20 3d3d 206e 616d 6520 616e  ame'] == name an
-000121c0: 6420 7072 6f64 7563 745b 2772 6570 6f27  d product['repo'
-000121d0: 5d20 3d3d 2072 6570 6f20 616e 6420 7072  ] == repo and pr
-000121e0: 6f64 7563 745b 2767 726f 7570 275d 203d  oduct['group'] =
-000121f0: 3d20 6772 6f75 705d 0a20 2020 2020 2020  = group].       
-00012200: 2065 6c69 6620 7265 706f 2069 7320 6e6f   elif repo is no
-00012210: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-00012220: 2020 2020 7072 6f64 7563 7473 203d 205b      products = [
-00012230: 7072 6f64 7563 7420 666f 7220 7072 6f64  product for prod
-00012240: 7563 7420 696e 2073 656c 662e 6c69 7374  uct in self.list
-00012250: 5f70 726f 6475 6374 7328 290a 2020 2020  _products().    
-00012260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012270: 2020 2020 6966 2070 726f 6475 6374 5b27      if product['
-00012280: 6e61 6d65 275d 203d 3d20 6e61 6d65 2061  name'] == name a
-00012290: 6e64 2070 726f 6475 6374 5b27 7265 706f  nd product['repo
-000122a0: 275d 203d 3d20 7265 706f 5d0a 2020 2020  '] == repo].    
-000122b0: 2020 2020 6966 2067 726f 7570 2069 7320      if group is 
-000122c0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-000122d0: 2020 2020 2020 7072 6f64 7563 7473 203d        products =
-000122e0: 205b 7072 6f64 7563 7420 666f 7220 7072   [product for pr
-000122f0: 6f64 7563 7420 696e 2073 656c 662e 6c69  oduct in self.li
-00012300: 7374 5f70 726f 6475 6374 7328 290a 2020  st_products().  
-00012310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012320: 2020 2020 2020 6966 2070 726f 6475 6374        if product
-00012330: 5b27 6e61 6d65 275d 203d 3d20 6e61 6d65  ['name'] == name
-00012340: 2061 6e64 2070 726f 6475 6374 5b27 6772   and product['gr
-00012350: 6f75 7027 5d20 3d3d 2067 726f 7570 5d0a  oup'] == group].
-00012360: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00012370: 2020 2020 2020 2020 2020 7072 6f64 7563            produc
-00012380: 7473 203d 205b 7072 6f64 7563 7420 666f  ts = [product fo
-00012390: 7220 7072 6f64 7563 7420 696e 2073 656c  r product in sel
-000123a0: 662e 6c69 7374 5f70 726f 6475 6374 7328  f.list_products(
-000123b0: 2920 6966 2070 726f 6475 6374 5b27 6e61  ) if product['na
-000123c0: 6d65 275d 203d 3d20 6e61 6d65 5d0a 2020  me'] == name].  
-000123d0: 2020 2020 2020 6966 206c 656e 2870 726f        if len(pro
-000123e0: 6475 6374 7329 203d 3d20 303a 0a20 2020  ducts) == 0:.   
-000123f0: 2020 2020 2020 2020 2065 7272 6f72 2822           error("
-00012400: 5072 6f64 7563 7420 6e6f 7420 666f 756e  Product not foun
-00012410: 642e 204c 6561 7669 6e67 2e2e 2e22 290a  d. Leaving...").
-00012420: 2020 2020 2020 2020 2020 2020 7379 732e              sys.
-00012430: 6578 6974 2831 290a 2020 2020 2020 2020  exit(1).        
-00012440: 656c 6966 206c 656e 2870 726f 6475 6374  elif len(product
-00012450: 7329 203e 2031 3a0a 2020 2020 2020 2020  s) > 1:.        
-00012460: 2020 2020 6572 726f 7228 2250 726f 6475      error("Produ
-00012470: 6374 2066 6f75 6e64 2069 6e20 7365 7665  ct found in seve
-00012480: 7261 6c20 7265 706f 7320 6f72 2067 726f  ral repos or gro
-00012490: 7570 732e 2053 7065 6369 6679 206f 6e65  ups. Specify one
-000124a0: 2e2e 2e22 290a 2020 2020 2020 2020 2020  ...").          
-000124b0: 2020 666f 7220 7072 6f64 7563 7420 696e    for product in
-000124c0: 2070 726f 6475 6374 733a 0a20 2020 2020   products:.     
-000124d0: 2020 2020 2020 2020 2020 2067 726f 7570             group
-000124e0: 203d 2070 726f 6475 6374 5b27 6772 6f75   = product['grou
-000124f0: 7027 5d0a 2020 2020 2020 2020 2020 2020  p'].            
-00012500: 2020 2020 7265 706f 203d 2070 726f 6475      repo = produ
-00012510: 6374 5b27 7265 706f 275d 0a20 2020 2020  ct['repo'].     
-00012520: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-00012530: 2866 2272 6570 6f3a 7b72 6570 6f7d 5c74  (f"repo:{repo}\t
-00012540: 6772 6f75 703a 7b67 726f 7570 7d22 290a  group:{group}").
-00012550: 2020 2020 2020 2020 2020 2020 7379 732e              sys.
-00012560: 6578 6974 2831 290a 2020 2020 2020 2020  exit(1).        
-00012570: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00012580: 2020 7072 6f64 7563 7420 3d20 7072 6f64    product = prod
-00012590: 7563 7473 5b30 5d0a 2020 2020 2020 2020  ucts[0].        
-000125a0: 2020 2020 706c 616e 203d 206e 616d 6575      plan = nameu
-000125b0: 7469 6c73 2e67 6574 5f72 616e 646f 6d5f  tils.get_random_
-000125c0: 6e61 6d65 2829 2069 6620 706c 616e 2069  name() if plan i
-000125d0: 7320 4e6f 6e65 2065 6c73 6520 706c 616e  s None else plan
-000125e0: 0a20 2020 2020 2020 2020 2020 2072 6570  .            rep
-000125f0: 6f20 3d20 7072 6f64 7563 745b 2772 6570  o = product['rep
-00012600: 6f27 5d0a 2020 2020 2020 2020 2020 2020  o'].            
-00012610: 6966 2027 7265 616c 6469 7227 2069 6e20  if 'realdir' in 
-00012620: 7072 6f64 7563 743a 0a20 2020 2020 2020  product:.       
-00012630: 2020 2020 2020 2020 2072 6570 6f64 6972           repodir
-00012640: 203d 2022 2573 2f2e 6b63 6c69 2f70 6c61   = "%s/.kcli/pla
-00012650: 6e73 2f25 732f 2573 2220 2520 286f 732e  ns/%s/%s" % (os.
-00012660: 656e 7669 726f 6e2e 6765 7428 2748 4f4d  environ.get('HOM
-00012670: 4527 292c 2072 6570 6f2c 2070 726f 6475  E'), repo, produ
-00012680: 6374 5b27 7265 616c 6469 7227 5d29 0a20  ct['realdir']). 
-00012690: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-000126a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000126b0: 2072 6570 6f64 6972 203d 2022 2573 2f2e   repodir = "%s/.
-000126c0: 6b63 6c69 2f70 6c61 6e73 2f25 7322 2025  kcli/plans/%s" %
-000126d0: 2028 6f73 2e65 6e76 6972 6f6e 2e67 6574   (os.environ.get
-000126e0: 2827 484f 4d45 2729 2c20 7265 706f 290a  ('HOME'), repo).
-000126f0: 2020 2020 2020 2020 2020 2020 6966 2027              if '
-00012700: 2f27 2069 6e20 7072 6f64 7563 745b 2766  /' in product['f
-00012710: 696c 6527 5d3a 0a20 2020 2020 2020 2020  ile']:.         
-00012720: 2020 2020 2020 2069 6e70 7574 6669 6c65         inputfile
-00012730: 203d 206f 732e 7061 7468 2e62 6173 656e   = os.path.basen
-00012740: 616d 6528 7072 6f64 7563 745b 2766 696c  ame(product['fil
-00012750: 6527 5d29 0a20 2020 2020 2020 2020 2020  e']).           
-00012760: 2020 2020 2072 6570 6f64 6972 202b 3d20       repodir += 
-00012770: 222f 2573 2220 2520 6f73 2e70 6174 682e  "/%s" % os.path.
-00012780: 6469 726e 616d 6528 7072 6f64 7563 745b  dirname(product[
-00012790: 2766 696c 6527 5d29 0a20 2020 2020 2020  'file']).       
-000127a0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-000127b0: 2020 2020 2020 2020 2020 2069 6e70 7574             input
-000127c0: 6669 6c65 203d 2070 726f 6475 6374 5b27  file = product['
-000127d0: 6669 6c65 275d 0a20 2020 2020 2020 2020  file'].         
-000127e0: 2020 2069 6d61 6765 203d 2070 726f 6475     image = produ
-000127f0: 6374 2e67 6574 2827 696d 6167 6527 290a  ct.get('image').
-00012800: 2020 2020 2020 2020 2020 2020 7061 7261              para
-00012810: 6d65 7465 7273 203d 2070 726f 6475 6374  meters = product
-00012820: 2e67 6574 2827 7061 7261 6d65 7465 7273  .get('parameters
-00012830: 2729 0a20 2020 2020 2020 2020 2020 2069  ').            i
-00012840: 6620 696d 6167 6520 6973 206e 6f74 204e  f image is not N
-00012850: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00012860: 2020 2020 2070 7269 6e74 2866 224e 6f74       print(f"Not
-00012870: 6520 7468 6174 2074 6869 7320 7072 6f64  e that this prod
-00012880: 7563 7420 7573 6573 2069 6d61 6765 3a20  uct uses image: 
-00012890: 7b69 6d61 6765 7d22 290a 2020 2020 2020  {image}").      
-000128a0: 2020 2020 2020 6966 2070 6172 616d 6574        if paramet
-000128b0: 6572 7320 6973 206e 6f74 204e 6f6e 653a  ers is not None:
-000128c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000128d0: 2066 6f72 2070 6172 616d 6574 6572 2069   for parameter i
-000128e0: 6e20 7061 7261 6d65 7465 7273 3a0a 2020  n parameters:.  
-000128f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012900: 2020 6170 706c 6965 645f 7061 7261 6d65    applied_parame
-00012910: 7465 7220 3d20 6f76 6572 7269 6465 735b  ter = overrides[
-00012920: 7061 7261 6d65 7465 725d 2069 6620 7061  parameter] if pa
-00012930: 7261 6d65 7465 7220 696e 206f 7665 7272  rameter in overr
-00012940: 6964 6573 2065 6c73 6520 7061 7261 6d65  ides else parame
-00012950: 7465 7273 5b70 6172 616d 6574 6572 5d0a  ters[parameter].
-00012960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012970: 2020 2020 7072 696e 7428 6622 5573 696e      print(f"Usin
-00012980: 6720 7061 7261 6d65 7465 7220 7b70 6172  g parameter {par
-00012990: 616d 6574 6572 7d3a 207b 6170 706c 6965  ameter}: {applie
-000129a0: 645f 7061 7261 6d65 7465 727d 2229 0a20  d_parameter}"). 
-000129b0: 2020 2020 2020 2020 2020 2065 7874 7261             extra
-000129c0: 7061 7261 6d65 7465 7273 203d 206c 6973  parameters = lis
-000129d0: 7428 7365 7428 6f76 6572 7269 6465 7329  t(set(overrides)
-000129e0: 202d 2073 6574 2870 6172 616d 6574 6572   - set(parameter
-000129f0: 7329 2920 6966 2070 6172 616d 6574 6572  s)) if parameter
-00012a00: 7320 6973 206e 6f74 204e 6f6e 6520 656c  s is not None el
-00012a10: 7365 206f 7665 7272 6964 6573 0a20 2020  se overrides.   
-00012a20: 2020 2020 2020 2020 2066 6f72 2070 6172           for par
-00012a30: 616d 6574 6572 2069 6e20 6578 7472 6170  ameter in extrap
-00012a40: 6172 616d 6574 6572 733a 0a20 2020 2020  arameters:.     
-00012a50: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-00012a60: 2822 5573 696e 6720 7061 7261 6d65 7465  ("Using paramete
-00012a70: 7220 2573 3a20 2573 2220 2520 2870 6172  r %s: %s" % (par
-00012a80: 616d 6574 6572 2c20 6f76 6572 7269 6465  ameter, override
-00012a90: 735b 7061 7261 6d65 7465 725d 2929 0a20  s[parameter])). 
-00012aa0: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-00012ab0: 7420 6c61 7465 7374 3a0a 2020 2020 2020  t latest:.      
-00012ac0: 2020 2020 2020 2020 2020 7070 7269 6e74            pprint
-00012ad0: 2866 2255 7369 6e67 2064 6972 6563 746f  (f"Using directo
-00012ae0: 7279 207b 7265 706f 6469 727d 2229 0a20  ry {repodir}"). 
-00012af0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00012b00: 656c 662e 706c 616e 2870 6c61 6e2c 2070  elf.plan(plan, p
-00012b10: 6174 683d 7265 706f 6469 722c 2069 6e70  ath=repodir, inp
-00012b20: 7574 6669 6c65 3d69 6e70 7574 6669 6c65  utfile=inputfile
-00012b30: 2c20 6f76 6572 7269 6465 733d 6f76 6572  , overrides=over
-00012b40: 7269 6465 7329 0a20 2020 2020 2020 2020  rides).         
-00012b50: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00012b60: 2020 2020 2020 2020 2073 656c 662e 7570           self.up
-00012b70: 6461 7465 5f72 6570 6f28 7265 706f 290a  date_repo(repo).
-00012b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012b90: 7365 6c66 2e70 6c61 6e28 706c 616e 2c20  self.plan(plan, 
-00012ba0: 7061 7468 3d72 6570 6f64 6972 2c20 696e  path=repodir, in
-00012bb0: 7075 7466 696c 653d 696e 7075 7466 696c  putfile=inputfil
-00012bc0: 652c 206f 7665 7272 6964 6573 3d6f 7665  e, overrides=ove
-00012bd0: 7272 6964 6573 290a 2020 2020 2020 2020  rrides).        
-00012be0: 2020 2020 7070 7269 6e74 2866 2250 726f      pprint(f"Pro
-00012bf0: 6475 6374 2063 616e 2062 6520 6465 6c65  duct can be dele
-00012c00: 7465 6420 7769 7468 3a20 6b63 6c69 2064  ted with: kcli d
-00012c10: 656c 6574 6520 706c 616e 202d 2d79 6573  elete plan --yes
-00012c20: 207b 706c 616e 7d22 290a 2020 2020 2020   {plan}").      
-00012c30: 2020 7265 7475 726e 207b 2772 6573 756c    return {'resul
-00012c40: 7427 3a20 2773 7563 6365 7373 272c 2027  t': 'success', '
-00012c50: 706c 616e 273a 2070 6c61 6e7d 0a0a 2020  plan': plan}..  
-00012c60: 2020 6465 6620 7374 6172 745f 706c 616e    def start_plan
-00012c70: 2873 656c 662c 2070 6c61 6e2c 2063 6f6e  (self, plan, con
-00012c80: 7461 696e 6572 3d46 616c 7365 293a 0a20  tainer=False):. 
-00012c90: 2020 2020 2020 206b 203d 2073 656c 662e         k = self.
-00012ca0: 6b0a 2020 2020 2020 2020 7374 6172 7466  k.        startf
-00012cb0: 6f75 6e64 203d 2046 616c 7365 0a20 2020  ound = False.   
-00012cc0: 2020 2020 2070 7072 696e 7428 6622 5374       pprint(f"St
-00012cd0: 6172 7469 6e67 2076 6d73 2066 726f 6d20  arting vms from 
-00012ce0: 706c 616e 207b 706c 616e 7d22 290a 2020  plan {plan}").  
-00012cf0: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
-00012d00: 662e 6578 7472 6163 6c69 656e 7473 3a0a  f.extraclients:.
-00012d10: 2020 2020 2020 2020 2020 2020 7374 6172              star
-00012d20: 7463 6c69 656e 7473 203d 207b 7365 6c66  tclients = {self
-00012d30: 2e63 6c69 656e 743a 206b 7d0a 2020 2020  .client: k}.    
-00012d40: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00012d50: 2020 2020 2020 7374 6172 7463 6c69 656e        startclien
-00012d60: 7473 203d 2073 656c 662e 6578 7472 6163  ts = self.extrac
-00012d70: 6c69 656e 7473 0a20 2020 2020 2020 2020  lients.         
-00012d80: 2020 2073 7461 7274 636c 6965 6e74 732e     startclients.
-00012d90: 7570 6461 7465 287b 7365 6c66 2e63 6c69  update({self.cli
-00012da0: 656e 743a 206b 7d29 0a20 2020 2020 2020  ent: k}).       
-00012db0: 2066 6f72 2068 7970 6572 7669 736f 7220   for hypervisor 
-00012dc0: 696e 2073 7461 7274 636c 6965 6e74 733a  in startclients:
-00012dd0: 0a20 2020 2020 2020 2020 2020 2063 203d  .            c =
-00012de0: 2073 7461 7274 636c 6965 6e74 735b 6879   startclients[hy
-00012df0: 7065 7276 6973 6f72 5d0a 2020 2020 2020  pervisor].      
-00012e00: 2020 2020 2020 666f 7220 766d 2069 6e20        for vm in 
-00012e10: 736f 7274 6564 2863 2e6c 6973 7428 292c  sorted(c.list(),
-00012e20: 206b 6579 3d6c 616d 6264 6120 783a 2078   key=lambda x: x
-00012e30: 5b27 6e61 6d65 275d 293a 0a20 2020 2020  ['name']):.     
-00012e40: 2020 2020 2020 2020 2020 206e 616d 6520             name 
-00012e50: 3d20 766d 5b27 6e61 6d65 275d 0a20 2020  = vm['name'].   
-00012e60: 2020 2020 2020 2020 2020 2020 2064 6573               des
-00012e70: 6372 6970 7469 6f6e 203d 2076 6d2e 6765  cription = vm.ge
-00012e80: 7428 2770 6c61 6e27 290a 2020 2020 2020  t('plan').      
-00012e90: 2020 2020 2020 2020 2020 6966 2064 6573            if des
-00012ea0: 6372 6970 7469 6f6e 203d 3d20 706c 616e  cription == plan
-00012eb0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00012ec0: 2020 2020 2020 7374 6172 7466 6f75 6e64        startfound
-00012ed0: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
-00012ee0: 2020 2020 2020 2020 2020 2020 632e 7374              c.st
-00012ef0: 6172 7428 6e61 6d65 290a 2020 2020 2020  art(name).      
-00012f00: 2020 2020 2020 2020 2020 2020 2020 7375                su
-00012f10: 6363 6573 7328 6622 7b6e 616d 657d 2073  ccess(f"{name} s
-00012f20: 7461 7274 6564 206f 6e20 7b68 7970 6572  tarted on {hyper
-00012f30: 7669 736f 727d 2122 290a 2020 2020 2020  visor}!").      
-00012f40: 2020 6966 2063 6f6e 7461 696e 6572 3a0a    if container:.
-00012f50: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
-00012f60: 203d 204b 636f 6e74 6169 6e65 7263 6f6e   = Kcontainercon
-00012f70: 6669 6728 7365 6c66 2c20 636c 6965 6e74  fig(self, client
-00012f80: 3d73 656c 662e 636f 6e74 6169 6e65 7263  =self.containerc
-00012f90: 6c69 656e 7429 2e63 6f6e 740a 2020 2020  lient).cont.    
-00012fa0: 2020 2020 2020 2020 666f 7220 636f 6e74          for cont
-00012fb0: 6120 696e 2073 6f72 7465 6428 636f 6e74  a in sorted(cont
-00012fc0: 2e6c 6973 745f 636f 6e74 6169 6e65 7273  .list_containers
-00012fd0: 286b 2929 3a0a 2020 2020 2020 2020 2020  (k)):.          
-00012fe0: 2020 2020 2020 6e61 6d65 203d 2063 6f6e        name = con
-00012ff0: 7461 5b30 5d0a 2020 2020 2020 2020 2020  ta[0].          
-00013000: 2020 2020 2020 636f 6e74 6169 6e65 7270        containerp
-00013010: 6c61 6e20 3d20 636f 6e74 615b 335d 0a20  lan = conta[3]. 
-00013020: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00013030: 6620 636f 6e74 6169 6e65 7270 6c61 6e20  f containerplan 
-00013040: 3d3d 2070 6c61 6e3a 0a20 2020 2020 2020  == plan:.       
-00013050: 2020 2020 2020 2020 2020 2020 2073 7461               sta
-00013060: 7274 666f 756e 6420 3d20 5472 7565 0a20  rtfound = True. 
-00013070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013080: 2020 2063 6f6e 742e 7374 6172 745f 636f     cont.start_co
-00013090: 6e74 6169 6e65 7228 6e61 6d65 290a 2020  ntainer(name).  
-000130a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000130b0: 2020 7375 6363 6573 7328 6622 436f 6e74    success(f"Cont
-000130c0: 6169 6e65 7220 7b6e 616d 657d 2073 7461  ainer {name} sta
-000130d0: 7274 6564 2122 290a 2020 2020 2020 2020  rted!").        
-000130e0: 6966 2073 7461 7274 666f 756e 643a 0a20  if startfound:. 
-000130f0: 2020 2020 2020 2020 2020 2073 7563 6365             succe
-00013100: 7373 2866 2250 6c61 6e20 7b70 6c61 6e7d  ss(f"Plan {plan}
-00013110: 2073 7461 7274 6564 2122 290a 2020 2020   started!").    
-00013120: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00013130: 2020 2020 2020 7761 726e 696e 6728 224e        warning("N
-00013140: 6f20 6d61 7463 6869 6e67 206f 626a 6563  o matching objec
-00013150: 7473 2066 6f75 6e64 2229 0a20 2020 2020  ts found").     
-00013160: 2020 2072 6574 7572 6e20 7b27 7265 7375     return {'resu
-00013170: 6c74 273a 2027 7375 6363 6573 7327 7d0a  lt': 'success'}.
-00013180: 0a20 2020 2064 6566 2073 746f 705f 706c  .    def stop_pl
-00013190: 616e 2873 656c 662c 2070 6c61 6e2c 2073  an(self, plan, s
-000131a0: 6f66 743d 4661 6c73 652c 2063 6f6e 7461  oft=False, conta
-000131b0: 696e 6572 3d46 616c 7365 293a 0a20 2020  iner=False):.   
-000131c0: 2020 2020 206b 203d 2073 656c 662e 6b0a       k = self.k.
-000131d0: 2020 2020 2020 2020 7374 6f70 666f 756e          stopfoun
-000131e0: 6420 3d20 5472 7565 0a20 2020 2020 2020  d = True.       
-000131f0: 2070 7072 696e 7428 6622 5374 6f70 7069   pprint(f"Stoppi
-00013200: 6e67 2076 6d73 2066 726f 6d20 706c 616e  ng vms from plan
-00013210: 207b 706c 616e 7d22 290a 2020 2020 2020   {plan}").      
-00013220: 2020 6966 206e 6f74 2073 656c 662e 6578    if not self.ex
-00013230: 7472 6163 6c69 656e 7473 3a0a 2020 2020  traclients:.    
-00013240: 2020 2020 2020 2020 7374 6f70 636c 6965          stopclie
-00013250: 6e74 7320 3d20 7b73 656c 662e 636c 6965  nts = {self.clie
-00013260: 6e74 3a20 6b7d 0a20 2020 2020 2020 2065  nt: k}.        e
-00013270: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00013280: 2073 746f 7063 6c69 656e 7473 203d 2073   stopclients = s
-00013290: 656c 662e 6578 7472 6163 6c69 656e 7473  elf.extraclients
-000132a0: 0a20 2020 2020 2020 2020 2020 2073 746f  .            sto
-000132b0: 7063 6c69 656e 7473 2e75 7064 6174 6528  pclients.update(
-000132c0: 7b73 656c 662e 636c 6965 6e74 3a20 6b7d  {self.client: k}
-000132d0: 290a 2020 2020 2020 2020 666f 7220 6879  ).        for hy
-000132e0: 7065 7276 6973 6f72 2069 6e20 7374 6f70  pervisor in stop
-000132f0: 636c 6965 6e74 733a 0a20 2020 2020 2020  clients:.       
-00013300: 2020 2020 2063 203d 2073 746f 7063 6c69       c = stopcli
-00013310: 656e 7473 5b68 7970 6572 7669 736f 725d  ents[hypervisor]
-00013320: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-00013330: 2076 6d20 696e 2073 6f72 7465 6428 632e   vm in sorted(c.
-00013340: 6c69 7374 2829 2c20 6b65 793d 6c61 6d62  list(), key=lamb
-00013350: 6461 2078 3a20 785b 276e 616d 6527 5d29  da x: x['name'])
-00013360: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00013370: 2020 6e61 6d65 203d 2076 6d5b 276e 616d    name = vm['nam
-00013380: 6527 5d0a 2020 2020 2020 2020 2020 2020  e'].            
-00013390: 2020 2020 6465 7363 7269 7074 696f 6e20      description 
-000133a0: 3d20 766d 2e67 6574 2827 706c 616e 2729  = vm.get('plan')
-000133b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000133c0: 2069 6620 6465 7363 7269 7074 696f 6e20   if description 
-000133d0: 3d3d 2070 6c61 6e3a 0a20 2020 2020 2020  == plan:.       
-000133e0: 2020 2020 2020 2020 2020 2020 2073 746f               sto
-000133f0: 7066 6f75 6e64 203d 2054 7275 650a 2020  pfound = True.  
-00013400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013410: 2020 632e 7374 6f70 286e 616d 652c 2073    c.stop(name, s
-00013420: 6f66 743d 736f 6674 290a 2020 2020 2020  oft=soft).      
-00013430: 2020 2020 2020 2020 2020 2020 2020 7375                su
-00013440: 6363 6573 7328 6622 7b6e 616d 657d 2073  ccess(f"{name} s
-00013450: 746f 7070 6564 206f 6e20 7b68 7970 6572  topped on {hyper
-00013460: 7669 736f 727d 2122 290a 2020 2020 2020  visor}!").      
-00013470: 2020 6966 2063 6f6e 7461 696e 6572 3a0a    if container:.
-00013480: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
-00013490: 203d 204b 636f 6e74 6169 6e65 7263 6f6e   = Kcontainercon
-000134a0: 6669 6728 7365 6c66 2c20 636c 6965 6e74  fig(self, client
-000134b0: 3d73 656c 662e 636f 6e74 6169 6e65 7263  =self.containerc
-000134c0: 6c69 656e 7429 2e63 6f6e 740a 2020 2020  lient).cont.    
-000134d0: 2020 2020 2020 2020 666f 7220 636f 6e74          for cont
-000134e0: 6120 696e 2073 6f72 7465 6428 636f 6e74  a in sorted(cont
-000134f0: 2e6c 6973 745f 636f 6e74 6169 6e65 7273  .list_containers
-00013500: 2829 293a 0a20 2020 2020 2020 2020 2020  ()):.           
-00013510: 2020 2020 206e 616d 6520 3d20 636f 6e74       name = cont
-00013520: 615b 305d 0a20 2020 2020 2020 2020 2020  a[0].           
-00013530: 2020 2020 2063 6f6e 7461 696e 6572 706c       containerpl
-00013540: 616e 203d 2063 6f6e 7461 5b33 5d0a 2020  an = conta[3].  
-00013550: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00013560: 2063 6f6e 7461 696e 6572 706c 616e 203d   containerplan =
-00013570: 3d20 706c 616e 3a0a 2020 2020 2020 2020  = plan:.        
-00013580: 2020 2020 2020 2020 2020 2020 7374 6f70              stop
-00013590: 666f 756e 6420 3d20 5472 7565 0a20 2020  found = True.   
-000135a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000135b0: 2063 6f6e 742e 7374 6f70 5f63 6f6e 7461   cont.stop_conta
-000135c0: 696e 6572 286e 616d 6529 0a20 2020 2020  iner(name).     
-000135d0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000135e0: 7563 6365 7373 2866 2243 6f6e 7461 696e  uccess(f"Contain
-000135f0: 6572 207b 6e61 6d65 7d20 7374 6f70 7065  er {name} stoppe
-00013600: 6421 2229 0a20 2020 2020 2020 2069 6620  d!").        if 
-00013610: 7374 6f70 666f 756e 643a 0a20 2020 2020  stopfound:.     
-00013620: 2020 2020 2020 2073 7563 6365 7373 2866         success(f
-00013630: 2250 6c61 6e20 7b70 6c61 6e7d 2073 746f  "Plan {plan} sto
-00013640: 7070 6564 2122 290a 2020 2020 2020 2020  pped!").        
-00013650: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00013660: 2020 7761 726e 696e 6728 224e 6f20 6d61    warning("No ma
-00013670: 7463 6869 6e67 206f 626a 6563 7473 2066  tching objects f
-00013680: 6f75 6e64 2229 0a20 2020 2020 2020 2072  ound").        r
-00013690: 6574 7572 6e20 7b27 7265 7375 6c74 273a  eturn {'result':
-000136a0: 2027 7375 6363 6573 7327 7d0a 0a20 2020   'success'}..   
-000136b0: 2064 6566 2061 7574 6f73 7461 7274 5f70   def autostart_p
-000136c0: 6c61 6e28 7365 6c66 2c20 706c 616e 293a  lan(self, plan):
-000136d0: 0a20 2020 2020 2020 206b 203d 2073 656c  .        k = sel
-000136e0: 662e 6b0a 2020 2020 2020 2020 7070 7269  f.k.        ppri
-000136f0: 6e74 2866 2253 6574 2076 6d73 2066 726f  nt(f"Set vms fro
-00013700: 6d20 706c 616e 207b 706c 616e 7d20 746f  m plan {plan} to
-00013710: 2061 7574 6f73 7461 7274 2229 0a20 2020   autostart").   
-00013720: 2020 2020 2066 6f72 2076 6d20 696e 2073       for vm in s
-00013730: 6f72 7465 6428 6b2e 6c69 7374 2829 2c20  orted(k.list(), 
-00013740: 6b65 793d 6c61 6d62 6461 2078 3a20 785b  key=lambda x: x[
-00013750: 276e 616d 6527 5d29 3a0a 2020 2020 2020  'name']):.      
-00013760: 2020 2020 2020 6e61 6d65 203d 2076 6d5b        name = vm[
-00013770: 276e 616d 6527 5d0a 2020 2020 2020 2020  'name'].        
-00013780: 2020 2020 6465 7363 7269 7074 696f 6e20      description 
-00013790: 3d20 766d 5b27 706c 616e 275d 0a20 2020  = vm['plan'].   
-000137a0: 2020 2020 2020 2020 2069 6620 6465 7363           if desc
-000137b0: 7269 7074 696f 6e20 3d3d 2070 6c61 6e3a  ription == plan:
-000137c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000137d0: 206b 2e75 7064 6174 655f 7374 6172 7428   k.update_start(
-000137e0: 6e61 6d65 2c20 7374 6172 743d 5472 7565  name, start=True
-000137f0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00013800: 2020 7375 6363 6573 7328 6622 7b6e 616d    success(f"{nam
-00013810: 657d 2073 6574 2074 6f20 6175 746f 7374  e} set to autost
-00013820: 6172 7421 2229 0a20 2020 2020 2020 2072  art!").        r
-00013830: 6574 7572 6e20 7b27 7265 7375 6c74 273a  eturn {'result':
-00013840: 2027 7375 6363 6573 7327 7d0a 0a20 2020   'success'}..   
-00013850: 2064 6566 206e 6f61 7574 6f73 7461 7274   def noautostart
-00013860: 5f70 6c61 6e28 7365 6c66 2c20 706c 616e  _plan(self, plan
-00013870: 293a 0a20 2020 2020 2020 206b 203d 2073  ):.        k = s
-00013880: 656c 662e 6b0a 2020 2020 2020 2020 7070  elf.k.        pp
-00013890: 7269 6e74 2866 2250 7265 7665 6e74 696e  rint(f"Preventin
-000138a0: 6720 766d 7320 6672 6f6d 2070 6c61 6e20  g vms from plan 
-000138b0: 7b70 6c61 6e7d 2074 6f20 6175 746f 7374  {plan} to autost
-000138c0: 6172 7422 290a 2020 2020 2020 2020 666f  art").        fo
-000138d0: 7220 766d 2069 6e20 736f 7274 6564 286b  r vm in sorted(k
-000138e0: 2e6c 6973 7428 292c 206b 6579 3d6c 616d  .list(), key=lam
-000138f0: 6264 6120 783a 2078 5b27 6e61 6d65 275d  bda x: x['name']
-00013900: 293a 0a20 2020 2020 2020 2020 2020 206e  ):.            n
-00013910: 616d 6520 3d20 766d 5b27 6e61 6d65 275d  ame = vm['name']
-00013920: 0a20 2020 2020 2020 2020 2020 2064 6573  .            des
-00013930: 6372 6970 7469 6f6e 203d 2076 6d5b 2770  cription = vm['p
-00013940: 6c61 6e27 5d0a 2020 2020 2020 2020 2020  lan'].          
-00013950: 2020 6966 2064 6573 6372 6970 7469 6f6e    if description
-00013960: 203d 3d20 706c 616e 3a0a 2020 2020 2020   == plan:.      
-00013970: 2020 2020 2020 2020 2020 6b2e 7570 6461            k.upda
-00013980: 7465 5f73 7461 7274 286e 616d 652c 2073  te_start(name, s
-00013990: 7461 7274 3d46 616c 7365 290a 2020 2020  tart=False).    
-000139a0: 2020 2020 2020 2020 2020 2020 7375 6363              succ
-000139b0: 6573 7328 6622 7b6e 616d 657d 2070 7265  ess(f"{name} pre
-000139c0: 7665 6e74 6564 2074 6f20 6175 746f 7374  vented to autost
-000139d0: 6172 7421 2229 0a20 2020 2020 2020 2072  art!").        r
-000139e0: 6574 7572 6e20 7b27 7265 7375 6c74 273a  eturn {'result':
-000139f0: 2027 7375 6363 6573 7327 7d0a 0a20 2020   'success'}..   
-00013a00: 2064 6566 2064 656c 6574 655f 706c 616e   def delete_plan
-00013a10: 2873 656c 662c 2070 6c61 6e2c 2063 6f6e  (self, plan, con
-00013a20: 7461 696e 6572 3d46 616c 7365 2c20 756e  tainer=False, un
-00013a30: 7265 6769 7374 6572 3d46 616c 7365 293a  register=False):
-00013a40: 0a20 2020 2020 2020 206b 203d 2073 656c  .        k = sel
-00013a50: 662e 6b0a 2020 2020 2020 2020 6465 6c65  f.k.        dele
-00013a60: 7465 6476 6d73 203d 205b 5d0a 2020 2020  tedvms = [].    
-00013a70: 2020 2020 6465 6c65 7465 646c 6273 203d      deletedlbs =
-00013a80: 205b 5d0a 2020 2020 2020 2020 646e 7363   [].        dnsc
-00013a90: 6c69 656e 7473 203d 205b 5d0a 2020 2020  lients = [].    
-00013aa0: 2020 2020 6e65 7477 6f72 6b73 203d 205b      networks = [
-00013ab0: 5d0a 2020 2020 2020 2020 6966 2070 6c61  ].        if pla
-00013ac0: 6e20 3d3d 2027 273a 0a20 2020 2020 2020  n == '':.       
-00013ad0: 2020 2020 2065 7272 6f72 2822 5468 6174       error("That
-00013ae0: 2077 6f75 6c64 2064 656c 6574 6520 6576   would delete ev
-00013af0: 6572 7920 766d 2e2e 2e4e 6f74 2064 6f69  ery vm...Not doi
-00013b00: 6e67 2074 6861 7422 290a 2020 2020 2020  ng that").      
-00013b10: 2020 2020 2020 7379 732e 6578 6974 2831        sys.exit(1
-00013b20: 290a 2020 2020 2020 2020 666f 756e 6420  ).        found 
-00013b30: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
-00013b40: 6465 6c65 7465 636c 6965 6e74 7320 3d20  deleteclients = 
-00013b50: 7b73 656c 662e 636c 6965 6e74 3a20 6b7d  {self.client: k}
-00013b60: 0a20 2020 2020 2020 2076 6d63 6c69 656e  .        vmclien
-00013b70: 7473 203d 205b 5d0a 2020 2020 2020 2020  ts = [].        
-00013b80: 766d 636c 6965 6e74 735f 6669 6c65 203d  vmclients_file =
-00013b90: 206f 732e 7061 7468 2e65 7870 616e 6475   os.path.expandu
-00013ba0: 7365 7228 6627 7e2f 2e6b 636c 692f 766d  ser(f'~/.kcli/vm
-00013bb0: 636c 6965 6e74 735f 7b70 6c61 6e7d 2729  clients_{plan}')
-00013bc0: 0a20 2020 2020 2020 2069 6620 6f73 2e70  .        if os.p
-00013bd0: 6174 682e 6578 6973 7473 2876 6d63 6c69  ath.exists(vmcli
-00013be0: 656e 7473 5f66 696c 6529 3a0a 2020 2020  ents_file):.    
-00013bf0: 2020 2020 2020 2020 766d 636c 6965 6e74          vmclient
-00013c00: 7320 3d20 7961 6d6c 2e73 6166 655f 6c6f  s = yaml.safe_lo
-00013c10: 6164 286f 7065 6e28 766d 636c 6965 6e74  ad(open(vmclient
-00013c20: 735f 6669 6c65 2929 0a20 2020 2020 2020  s_file)).       
-00013c30: 2020 2020 206f 732e 7265 6d6f 7665 2876       os.remove(v
-00013c40: 6d63 6c69 656e 7473 5f66 696c 6529 0a20  mclients_file). 
-00013c50: 2020 2020 2020 2069 6620 7365 6c66 2e65         if self.e
-00013c60: 7874 7261 636c 6965 6e74 733a 0a20 2020  xtraclients:.   
+00011ee0: 706c 616e 203d 2069 6e73 7461 6c6c 7061  plan = installpa
+00011ef0: 7261 6d2e 6765 7428 2770 6c61 6e27 2c20  ram.get('plan', 
+00011f00: 706c 616e 290a 2020 2020 2020 2020 2020  plan).          
+00011f10: 2020 2020 2020 6b75 6265 735b 6b75 6265        kubes[kube
+00011f20: 5d20 3d20 7b27 7479 7065 273a 205f 7479  ] = {'type': _ty
+00011f30: 7065 2c20 2770 6c61 6e27 3a20 706c 616e  pe, 'plan': plan
+00011f40: 2c20 2776 6d73 273a 205b 5d7d 0a20 2020  , 'vms': []}.   
+00011f50: 2020 2020 2069 6620 7365 6c66 2e74 7970       if self.typ
+00011f60: 6520 3d3d 2027 6763 7027 3a0a 2020 2020  e == 'gcp':.    
+00011f70: 2020 2020 2020 2020 6672 6f6d 206b 7669          from kvi
+00011f80: 7274 2e63 6c75 7374 6572 2069 6d70 6f72  rt.cluster impor
+00011f90: 7420 676b 650a 2020 2020 2020 2020 2020  t gke.          
+00011fa0: 2020 6b75 6265 732e 7570 6461 7465 2867    kubes.update(g
+00011fb0: 6b65 2e6c 6973 7428 7365 6c66 2929 0a20  ke.list(self)). 
+00011fc0: 2020 2020 2020 2065 6c69 6620 7365 6c66         elif self
+00011fd0: 2e74 7970 6520 3d3d 2027 6177 7327 3a0a  .type == 'aws':.
+00011fe0: 2020 2020 2020 2020 2020 2020 6672 6f6d              from
+00011ff0: 206b 7669 7274 2e63 6c75 7374 6572 2069   kvirt.cluster i
+00012000: 6d70 6f72 7420 656b 730a 2020 2020 2020  mport eks.      
+00012010: 2020 2020 2020 6b75 6265 732e 7570 6461        kubes.upda
+00012020: 7465 2865 6b73 2e6c 6973 7428 7365 6c66  te(eks.list(self
+00012030: 2929 0a20 2020 2020 2020 2072 6574 7572  )).        retur
+00012040: 6e20 6b75 6265 730a 0a20 2020 2064 6566  n kubes..    def
+00012050: 2063 7265 6174 655f 7072 6f64 7563 7428   create_product(
+00012060: 7365 6c66 2c20 6e61 6d65 2c20 7265 706f  self, name, repo
+00012070: 3d4e 6f6e 652c 2067 726f 7570 3d4e 6f6e  =None, group=Non
+00012080: 652c 2070 6c61 6e3d 4e6f 6e65 2c20 6c61  e, plan=None, la
+00012090: 7465 7374 3d46 616c 7365 2c20 6f76 6572  test=False, over
+000120a0: 7269 6465 733d 7b7d 293a 0a20 2020 2020  rides={}):.     
+000120b0: 2020 2022 2222 4372 6561 7465 2070 726f     """Create pro
+000120c0: 6475 6374 2222 220a 2020 2020 2020 2020  duct""".        
+000120d0: 6966 2072 6570 6f20 6973 206e 6f74 204e  if repo is not N
+000120e0: 6f6e 6520 616e 6420 6772 6f75 7020 6973  one and group is
+000120f0: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+00012100: 2020 2020 2020 2070 726f 6475 6374 7320         products 
+00012110: 3d20 5b70 726f 6475 6374 2066 6f72 2070  = [product for p
+00012120: 726f 6475 6374 2069 6e20 7365 6c66 2e6c  roduct in self.l
+00012130: 6973 745f 7072 6f64 7563 7473 2829 0a20  ist_products(). 
+00012140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012150: 2020 2020 2020 2069 6620 7072 6f64 7563         if produc
+00012160: 745b 276e 616d 6527 5d20 3d3d 206e 616d  t['name'] == nam
+00012170: 6520 616e 6420 7072 6f64 7563 745b 2772  e and product['r
+00012180: 6570 6f27 5d20 3d3d 2072 6570 6f20 616e  epo'] == repo an
+00012190: 6420 7072 6f64 7563 745b 2767 726f 7570  d product['group
+000121a0: 275d 203d 3d20 6772 6f75 705d 0a20 2020  '] == group].   
+000121b0: 2020 2020 2065 6c69 6620 7265 706f 2069       elif repo i
+000121c0: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+000121d0: 2020 2020 2020 2020 7072 6f64 7563 7473          products
+000121e0: 203d 205b 7072 6f64 7563 7420 666f 7220   = [product for 
+000121f0: 7072 6f64 7563 7420 696e 2073 656c 662e  product in self.
+00012200: 6c69 7374 5f70 726f 6475 6374 7328 290a  list_products().
+00012210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012220: 2020 2020 2020 2020 6966 2070 726f 6475          if produ
+00012230: 6374 5b27 6e61 6d65 275d 203d 3d20 6e61  ct['name'] == na
+00012240: 6d65 2061 6e64 2070 726f 6475 6374 5b27  me and product['
+00012250: 7265 706f 275d 203d 3d20 7265 706f 5d0a  repo'] == repo].
+00012260: 2020 2020 2020 2020 6966 2067 726f 7570          if group
+00012270: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+00012280: 2020 2020 2020 2020 2020 7072 6f64 7563            produc
+00012290: 7473 203d 205b 7072 6f64 7563 7420 666f  ts = [product fo
+000122a0: 7220 7072 6f64 7563 7420 696e 2073 656c  r product in sel
+000122b0: 662e 6c69 7374 5f70 726f 6475 6374 7328  f.list_products(
+000122c0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000122d0: 2020 2020 2020 2020 2020 6966 2070 726f            if pro
+000122e0: 6475 6374 5b27 6e61 6d65 275d 203d 3d20  duct['name'] == 
+000122f0: 6e61 6d65 2061 6e64 2070 726f 6475 6374  name and product
+00012300: 5b27 6772 6f75 7027 5d20 3d3d 2067 726f  ['group'] == gro
+00012310: 7570 5d0a 2020 2020 2020 2020 656c 7365  up].        else
+00012320: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
+00012330: 6f64 7563 7473 203d 205b 7072 6f64 7563  oducts = [produc
+00012340: 7420 666f 7220 7072 6f64 7563 7420 696e  t for product in
+00012350: 2073 656c 662e 6c69 7374 5f70 726f 6475   self.list_produ
+00012360: 6374 7328 2920 6966 2070 726f 6475 6374  cts() if product
+00012370: 5b27 6e61 6d65 275d 203d 3d20 6e61 6d65  ['name'] == name
+00012380: 5d0a 2020 2020 2020 2020 6966 206c 656e  ].        if len
+00012390: 2870 726f 6475 6374 7329 203d 3d20 303a  (products) == 0:
+000123a0: 0a20 2020 2020 2020 2020 2020 2065 7272  .            err
+000123b0: 6f72 2822 5072 6f64 7563 7420 6e6f 7420  or("Product not 
+000123c0: 666f 756e 642e 204c 6561 7669 6e67 2e2e  found. Leaving..
+000123d0: 2e22 290a 2020 2020 2020 2020 2020 2020  .").            
+000123e0: 7379 732e 6578 6974 2831 290a 2020 2020  sys.exit(1).    
+000123f0: 2020 2020 656c 6966 206c 656e 2870 726f      elif len(pro
+00012400: 6475 6374 7329 203e 2031 3a0a 2020 2020  ducts) > 1:.    
+00012410: 2020 2020 2020 2020 6572 726f 7228 2250          error("P
+00012420: 726f 6475 6374 2066 6f75 6e64 2069 6e20  roduct found in 
+00012430: 7365 7665 7261 6c20 7265 706f 7320 6f72  several repos or
+00012440: 2067 726f 7570 732e 2053 7065 6369 6679   groups. Specify
+00012450: 206f 6e65 2e2e 2e22 290a 2020 2020 2020   one...").      
+00012460: 2020 2020 2020 666f 7220 7072 6f64 7563        for produc
+00012470: 7420 696e 2070 726f 6475 6374 733a 0a20  t in products:. 
+00012480: 2020 2020 2020 2020 2020 2020 2020 2067                 g
+00012490: 726f 7570 203d 2070 726f 6475 6374 5b27  roup = product['
+000124a0: 6772 6f75 7027 5d0a 2020 2020 2020 2020  group'].        
+000124b0: 2020 2020 2020 2020 7265 706f 203d 2070          repo = p
+000124c0: 726f 6475 6374 5b27 7265 706f 275d 0a20  roduct['repo']. 
+000124d0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+000124e0: 7269 6e74 2866 2272 6570 6f3a 7b72 6570  rint(f"repo:{rep
+000124f0: 6f7d 5c74 6772 6f75 703a 7b67 726f 7570  o}\tgroup:{group
+00012500: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
+00012510: 7379 732e 6578 6974 2831 290a 2020 2020  sys.exit(1).    
+00012520: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00012530: 2020 2020 2020 7072 6f64 7563 7420 3d20        product = 
+00012540: 7072 6f64 7563 7473 5b30 5d0a 2020 2020  products[0].    
+00012550: 2020 2020 2020 2020 706c 616e 203d 206e          plan = n
+00012560: 616d 6575 7469 6c73 2e67 6574 5f72 616e  ameutils.get_ran
+00012570: 646f 6d5f 6e61 6d65 2829 2069 6620 706c  dom_name() if pl
+00012580: 616e 2069 7320 4e6f 6e65 2065 6c73 6520  an is None else 
+00012590: 706c 616e 0a20 2020 2020 2020 2020 2020  plan.           
+000125a0: 2072 6570 6f20 3d20 7072 6f64 7563 745b   repo = product[
+000125b0: 2772 6570 6f27 5d0a 2020 2020 2020 2020  'repo'].        
+000125c0: 2020 2020 6966 2027 7265 616c 6469 7227      if 'realdir'
+000125d0: 2069 6e20 7072 6f64 7563 743a 0a20 2020   in product:.   
+000125e0: 2020 2020 2020 2020 2020 2020 2072 6570               rep
+000125f0: 6f64 6972 203d 2022 2573 2f2e 6b63 6c69  odir = "%s/.kcli
+00012600: 2f70 6c61 6e73 2f25 732f 2573 2220 2520  /plans/%s/%s" % 
+00012610: 286f 732e 656e 7669 726f 6e2e 6765 7428  (os.environ.get(
+00012620: 2748 4f4d 4527 292c 2072 6570 6f2c 2070  'HOME'), repo, p
+00012630: 726f 6475 6374 5b27 7265 616c 6469 7227  roduct['realdir'
+00012640: 5d29 0a20 2020 2020 2020 2020 2020 2065  ]).            e
+00012650: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00012660: 2020 2020 2072 6570 6f64 6972 203d 2022       repodir = "
+00012670: 2573 2f2e 6b63 6c69 2f70 6c61 6e73 2f25  %s/.kcli/plans/%
+00012680: 7322 2025 2028 6f73 2e65 6e76 6972 6f6e  s" % (os.environ
+00012690: 2e67 6574 2827 484f 4d45 2729 2c20 7265  .get('HOME'), re
+000126a0: 706f 290a 2020 2020 2020 2020 2020 2020  po).            
+000126b0: 6966 2027 2f27 2069 6e20 7072 6f64 7563  if '/' in produc
+000126c0: 745b 2766 696c 6527 5d3a 0a20 2020 2020  t['file']:.     
+000126d0: 2020 2020 2020 2020 2020 2069 6e70 7574             input
+000126e0: 6669 6c65 203d 206f 732e 7061 7468 2e62  file = os.path.b
+000126f0: 6173 656e 616d 6528 7072 6f64 7563 745b  asename(product[
+00012700: 2766 696c 6527 5d29 0a20 2020 2020 2020  'file']).       
+00012710: 2020 2020 2020 2020 2072 6570 6f64 6972           repodir
+00012720: 202b 3d20 222f 2573 2220 2520 6f73 2e70   += "/%s" % os.p
+00012730: 6174 682e 6469 726e 616d 6528 7072 6f64  ath.dirname(prod
+00012740: 7563 745b 2766 696c 6527 5d29 0a20 2020  uct['file']).   
+00012750: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00012760: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00012770: 6e70 7574 6669 6c65 203d 2070 726f 6475  nputfile = produ
+00012780: 6374 5b27 6669 6c65 275d 0a20 2020 2020  ct['file'].     
+00012790: 2020 2020 2020 2069 6d61 6765 203d 2070         image = p
+000127a0: 726f 6475 6374 2e67 6574 2827 696d 6167  roduct.get('imag
+000127b0: 6527 290a 2020 2020 2020 2020 2020 2020  e').            
+000127c0: 7061 7261 6d65 7465 7273 203d 2070 726f  parameters = pro
+000127d0: 6475 6374 2e67 6574 2827 7061 7261 6d65  duct.get('parame
+000127e0: 7465 7273 2729 0a20 2020 2020 2020 2020  ters').         
+000127f0: 2020 2069 6620 696d 6167 6520 6973 206e     if image is n
+00012800: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+00012810: 2020 2020 2020 2020 2070 7269 6e74 2866           print(f
+00012820: 224e 6f74 6520 7468 6174 2074 6869 7320  "Note that this 
+00012830: 7072 6f64 7563 7420 7573 6573 2069 6d61  product uses ima
+00012840: 6765 3a20 7b69 6d61 6765 7d22 290a 2020  ge: {image}").  
+00012850: 2020 2020 2020 2020 2020 6966 2070 6172            if par
+00012860: 616d 6574 6572 7320 6973 206e 6f74 204e  ameters is not N
+00012870: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00012880: 2020 2020 2066 6f72 2070 6172 616d 6574       for paramet
+00012890: 6572 2069 6e20 7061 7261 6d65 7465 7273  er in parameters
+000128a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000128b0: 2020 2020 2020 6170 706c 6965 645f 7061        applied_pa
+000128c0: 7261 6d65 7465 7220 3d20 6f76 6572 7269  rameter = overri
+000128d0: 6465 735b 7061 7261 6d65 7465 725d 2069  des[parameter] i
+000128e0: 6620 7061 7261 6d65 7465 7220 696e 206f  f parameter in o
+000128f0: 7665 7272 6964 6573 2065 6c73 6520 7061  verrides else pa
+00012900: 7261 6d65 7465 7273 5b70 6172 616d 6574  rameters[paramet
+00012910: 6572 5d0a 2020 2020 2020 2020 2020 2020  er].            
+00012920: 2020 2020 2020 2020 7072 696e 7428 6622          print(f"
+00012930: 5573 696e 6720 7061 7261 6d65 7465 7220  Using parameter 
+00012940: 7b70 6172 616d 6574 6572 7d3a 207b 6170  {parameter}: {ap
+00012950: 706c 6965 645f 7061 7261 6d65 7465 727d  plied_parameter}
+00012960: 2229 0a20 2020 2020 2020 2020 2020 2065  ").            e
+00012970: 7874 7261 7061 7261 6d65 7465 7273 203d  xtraparameters =
+00012980: 206c 6973 7428 7365 7428 6f76 6572 7269   list(set(overri
+00012990: 6465 7329 202d 2073 6574 2870 6172 616d  des) - set(param
+000129a0: 6574 6572 7329 2920 6966 2070 6172 616d  eters)) if param
+000129b0: 6574 6572 7320 6973 206e 6f74 204e 6f6e  eters is not Non
+000129c0: 6520 656c 7365 206f 7665 7272 6964 6573  e else overrides
+000129d0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+000129e0: 2070 6172 616d 6574 6572 2069 6e20 6578   parameter in ex
+000129f0: 7472 6170 6172 616d 6574 6572 733a 0a20  traparameters:. 
+00012a00: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00012a10: 7269 6e74 2822 5573 696e 6720 7061 7261  rint("Using para
+00012a20: 6d65 7465 7220 2573 3a20 2573 2220 2520  meter %s: %s" % 
+00012a30: 2870 6172 616d 6574 6572 2c20 6f76 6572  (parameter, over
+00012a40: 7269 6465 735b 7061 7261 6d65 7465 725d  rides[parameter]
+00012a50: 2929 0a20 2020 2020 2020 2020 2020 2069  )).            i
+00012a60: 6620 6e6f 7420 6c61 7465 7374 3a0a 2020  f not latest:.  
+00012a70: 2020 2020 2020 2020 2020 2020 2020 7070                pp
+00012a80: 7269 6e74 2866 2255 7369 6e67 2064 6972  rint(f"Using dir
+00012a90: 6563 746f 7279 207b 7265 706f 6469 727d  ectory {repodir}
+00012aa0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+00012ab0: 2020 2073 656c 662e 706c 616e 2870 6c61     self.plan(pla
+00012ac0: 6e2c 2070 6174 683d 7265 706f 6469 722c  n, path=repodir,
+00012ad0: 2069 6e70 7574 6669 6c65 3d69 6e70 7574   inputfile=input
+00012ae0: 6669 6c65 2c20 6f76 6572 7269 6465 733d  file, overrides=
+00012af0: 6f76 6572 7269 6465 7329 0a20 2020 2020  overrides).     
+00012b00: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00012b10: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00012b20: 662e 7570 6461 7465 5f72 6570 6f28 7265  f.update_repo(re
+00012b30: 706f 290a 2020 2020 2020 2020 2020 2020  po).            
+00012b40: 2020 2020 7365 6c66 2e70 6c61 6e28 706c      self.plan(pl
+00012b50: 616e 2c20 7061 7468 3d72 6570 6f64 6972  an, path=repodir
+00012b60: 2c20 696e 7075 7466 696c 653d 696e 7075  , inputfile=inpu
+00012b70: 7466 696c 652c 206f 7665 7272 6964 6573  tfile, overrides
+00012b80: 3d6f 7665 7272 6964 6573 290a 2020 2020  =overrides).    
+00012b90: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
+00012ba0: 2250 726f 6475 6374 2063 616e 2062 6520  "Product can be 
+00012bb0: 6465 6c65 7465 6420 7769 7468 3a20 6b63  deleted with: kc
+00012bc0: 6c69 2064 656c 6574 6520 706c 616e 202d  li delete plan -
+00012bd0: 2d79 6573 207b 706c 616e 7d22 290a 2020  -yes {plan}").  
+00012be0: 2020 2020 2020 7265 7475 726e 207b 2772        return {'r
+00012bf0: 6573 756c 7427 3a20 2773 7563 6365 7373  esult': 'success
+00012c00: 272c 2027 706c 616e 273a 2070 6c61 6e7d  ', 'plan': plan}
+00012c10: 0a0a 2020 2020 6465 6620 7374 6172 745f  ..    def start_
+00012c20: 706c 616e 2873 656c 662c 2070 6c61 6e2c  plan(self, plan,
+00012c30: 2063 6f6e 7461 696e 6572 3d46 616c 7365   container=False
+00012c40: 293a 0a20 2020 2020 2020 206b 203d 2073  ):.        k = s
+00012c50: 656c 662e 6b0a 2020 2020 2020 2020 7374  elf.k.        st
+00012c60: 6172 7466 6f75 6e64 203d 2046 616c 7365  artfound = False
+00012c70: 0a20 2020 2020 2020 2070 7072 696e 7428  .        pprint(
+00012c80: 6622 5374 6172 7469 6e67 2076 6d73 2066  f"Starting vms f
+00012c90: 726f 6d20 706c 616e 207b 706c 616e 7d22  rom plan {plan}"
+00012ca0: 290a 2020 2020 2020 2020 6966 206e 6f74  ).        if not
+00012cb0: 2073 656c 662e 6578 7472 6163 6c69 656e   self.extraclien
+00012cc0: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
+00012cd0: 7374 6172 7463 6c69 656e 7473 203d 207b  startclients = {
+00012ce0: 7365 6c66 2e63 6c69 656e 743a 206b 7d0a  self.client: k}.
+00012cf0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00012d00: 2020 2020 2020 2020 2020 7374 6172 7463            startc
+00012d10: 6c69 656e 7473 203d 2073 656c 662e 6578  lients = self.ex
+00012d20: 7472 6163 6c69 656e 7473 0a20 2020 2020  traclients.     
+00012d30: 2020 2020 2020 2073 7461 7274 636c 6965         startclie
+00012d40: 6e74 732e 7570 6461 7465 287b 7365 6c66  nts.update({self
+00012d50: 2e63 6c69 656e 743a 206b 7d29 0a20 2020  .client: k}).   
+00012d60: 2020 2020 2066 6f72 2068 7970 6572 7669       for hypervi
+00012d70: 736f 7220 696e 2073 7461 7274 636c 6965  sor in startclie
+00012d80: 6e74 733a 0a20 2020 2020 2020 2020 2020  nts:.           
+00012d90: 2063 203d 2073 7461 7274 636c 6965 6e74   c = startclient
+00012da0: 735b 6879 7065 7276 6973 6f72 5d0a 2020  s[hypervisor].  
+00012db0: 2020 2020 2020 2020 2020 666f 7220 766d            for vm
+00012dc0: 2069 6e20 736f 7274 6564 2863 2e6c 6973   in sorted(c.lis
+00012dd0: 7428 292c 206b 6579 3d6c 616d 6264 6120  t(), key=lambda 
+00012de0: 783a 2078 5b27 6e61 6d65 275d 293a 0a20  x: x['name']):. 
+00012df0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00012e00: 616d 6520 3d20 766d 5b27 6e61 6d65 275d  ame = vm['name']
+00012e10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012e20: 2064 6573 6372 6970 7469 6f6e 203d 2076   description = v
+00012e30: 6d2e 6765 7428 2770 6c61 6e27 290a 2020  m.get('plan').  
+00012e40: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00012e50: 2064 6573 6372 6970 7469 6f6e 203d 3d20   description == 
+00012e60: 706c 616e 3a0a 2020 2020 2020 2020 2020  plan:.          
+00012e70: 2020 2020 2020 2020 2020 7374 6172 7466            startf
+00012e80: 6f75 6e64 203d 2054 7275 650a 2020 2020  ound = True.    
+00012e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012ea0: 632e 7374 6172 7428 6e61 6d65 290a 2020  c.start(name).  
+00012eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012ec0: 2020 7375 6363 6573 7328 6622 7b6e 616d    success(f"{nam
+00012ed0: 657d 2073 7461 7274 6564 206f 6e20 7b68  e} started on {h
+00012ee0: 7970 6572 7669 736f 727d 2122 290a 2020  ypervisor}!").  
+00012ef0: 2020 2020 2020 6966 2063 6f6e 7461 696e        if contain
+00012f00: 6572 3a0a 2020 2020 2020 2020 2020 2020  er:.            
+00012f10: 636f 6e74 203d 204b 636f 6e74 6169 6e65  cont = Kcontaine
+00012f20: 7263 6f6e 6669 6728 7365 6c66 2c20 636c  rconfig(self, cl
+00012f30: 6965 6e74 3d73 656c 662e 636f 6e74 6169  ient=self.contai
+00012f40: 6e65 7263 6c69 656e 7429 2e63 6f6e 740a  nerclient).cont.
+00012f50: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00012f60: 636f 6e74 6120 696e 2073 6f72 7465 6428  conta in sorted(
+00012f70: 636f 6e74 2e6c 6973 745f 636f 6e74 6169  cont.list_contai
+00012f80: 6e65 7273 286b 2929 3a0a 2020 2020 2020  ners(k)):.      
+00012f90: 2020 2020 2020 2020 2020 6e61 6d65 203d            name =
+00012fa0: 2063 6f6e 7461 5b30 5d0a 2020 2020 2020   conta[0].      
+00012fb0: 2020 2020 2020 2020 2020 636f 6e74 6169            contai
+00012fc0: 6e65 7270 6c61 6e20 3d20 636f 6e74 615b  nerplan = conta[
+00012fd0: 335d 0a20 2020 2020 2020 2020 2020 2020  3].             
+00012fe0: 2020 2069 6620 636f 6e74 6169 6e65 7270     if containerp
+00012ff0: 6c61 6e20 3d3d 2070 6c61 6e3a 0a20 2020  lan == plan:.   
+00013000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013010: 2073 7461 7274 666f 756e 6420 3d20 5472   startfound = Tr
+00013020: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
+00013030: 2020 2020 2020 2063 6f6e 742e 7374 6172         cont.star
+00013040: 745f 636f 6e74 6169 6e65 7228 6e61 6d65  t_container(name
+00013050: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00013060: 2020 2020 2020 7375 6363 6573 7328 6622        success(f"
+00013070: 436f 6e74 6169 6e65 7220 7b6e 616d 657d  Container {name}
+00013080: 2073 7461 7274 6564 2122 290a 2020 2020   started!").    
+00013090: 2020 2020 6966 2073 7461 7274 666f 756e      if startfoun
+000130a0: 643a 0a20 2020 2020 2020 2020 2020 2073  d:.            s
+000130b0: 7563 6365 7373 2866 2250 6c61 6e20 7b70  uccess(f"Plan {p
+000130c0: 6c61 6e7d 2073 7461 7274 6564 2122 290a  lan} started!").
+000130d0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+000130e0: 2020 2020 2020 2020 2020 7761 726e 696e            warnin
+000130f0: 6728 224e 6f20 6d61 7463 6869 6e67 206f  g("No matching o
+00013100: 626a 6563 7473 2066 6f75 6e64 2229 0a20  bjects found"). 
+00013110: 2020 2020 2020 2072 6574 7572 6e20 7b27         return {'
+00013120: 7265 7375 6c74 273a 2027 7375 6363 6573  result': 'succes
+00013130: 7327 7d0a 0a20 2020 2064 6566 2073 746f  s'}..    def sto
+00013140: 705f 706c 616e 2873 656c 662c 2070 6c61  p_plan(self, pla
+00013150: 6e2c 2073 6f66 743d 4661 6c73 652c 2063  n, soft=False, c
+00013160: 6f6e 7461 696e 6572 3d46 616c 7365 293a  ontainer=False):
+00013170: 0a20 2020 2020 2020 206b 203d 2073 656c  .        k = sel
+00013180: 662e 6b0a 2020 2020 2020 2020 7374 6f70  f.k.        stop
+00013190: 666f 756e 6420 3d20 5472 7565 0a20 2020  found = True.   
+000131a0: 2020 2020 2070 7072 696e 7428 6622 5374       pprint(f"St
+000131b0: 6f70 7069 6e67 2076 6d73 2066 726f 6d20  opping vms from 
+000131c0: 706c 616e 207b 706c 616e 7d22 290a 2020  plan {plan}").  
+000131d0: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
+000131e0: 662e 6578 7472 6163 6c69 656e 7473 3a0a  f.extraclients:.
+000131f0: 2020 2020 2020 2020 2020 2020 7374 6f70              stop
+00013200: 636c 6965 6e74 7320 3d20 7b73 656c 662e  clients = {self.
+00013210: 636c 6965 6e74 3a20 6b7d 0a20 2020 2020  client: k}.     
+00013220: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00013230: 2020 2020 2073 746f 7063 6c69 656e 7473       stopclients
+00013240: 203d 2073 656c 662e 6578 7472 6163 6c69   = self.extracli
+00013250: 656e 7473 0a20 2020 2020 2020 2020 2020  ents.           
+00013260: 2073 746f 7063 6c69 656e 7473 2e75 7064   stopclients.upd
+00013270: 6174 6528 7b73 656c 662e 636c 6965 6e74  ate({self.client
+00013280: 3a20 6b7d 290a 2020 2020 2020 2020 666f  : k}).        fo
+00013290: 7220 6879 7065 7276 6973 6f72 2069 6e20  r hypervisor in 
+000132a0: 7374 6f70 636c 6965 6e74 733a 0a20 2020  stopclients:.   
+000132b0: 2020 2020 2020 2020 2063 203d 2073 746f           c = sto
+000132c0: 7063 6c69 656e 7473 5b68 7970 6572 7669  pclients[hypervi
+000132d0: 736f 725d 0a20 2020 2020 2020 2020 2020  sor].           
+000132e0: 2066 6f72 2076 6d20 696e 2073 6f72 7465   for vm in sorte
+000132f0: 6428 632e 6c69 7374 2829 2c20 6b65 793d  d(c.list(), key=
+00013300: 6c61 6d62 6461 2078 3a20 785b 276e 616d  lambda x: x['nam
+00013310: 6527 5d29 3a0a 2020 2020 2020 2020 2020  e']):.          
+00013320: 2020 2020 2020 6e61 6d65 203d 2076 6d5b        name = vm[
+00013330: 276e 616d 6527 5d0a 2020 2020 2020 2020  'name'].        
+00013340: 2020 2020 2020 2020 6465 7363 7269 7074          descript
+00013350: 696f 6e20 3d20 766d 2e67 6574 2827 706c  ion = vm.get('pl
+00013360: 616e 2729 0a20 2020 2020 2020 2020 2020  an').           
+00013370: 2020 2020 2069 6620 6465 7363 7269 7074       if descript
+00013380: 696f 6e20 3d3d 2070 6c61 6e3a 0a20 2020  ion == plan:.   
+00013390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000133a0: 2073 746f 7066 6f75 6e64 203d 2054 7275   stopfound = Tru
+000133b0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+000133c0: 2020 2020 2020 632e 7374 6f70 286e 616d        c.stop(nam
+000133d0: 652c 2073 6f66 743d 736f 6674 290a 2020  e, soft=soft).  
+000133e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000133f0: 2020 7375 6363 6573 7328 6622 7b6e 616d    success(f"{nam
+00013400: 657d 2073 746f 7070 6564 206f 6e20 7b68  e} stopped on {h
+00013410: 7970 6572 7669 736f 727d 2122 290a 2020  ypervisor}!").  
+00013420: 2020 2020 2020 6966 2063 6f6e 7461 696e        if contain
+00013430: 6572 3a0a 2020 2020 2020 2020 2020 2020  er:.            
+00013440: 636f 6e74 203d 204b 636f 6e74 6169 6e65  cont = Kcontaine
+00013450: 7263 6f6e 6669 6728 7365 6c66 2c20 636c  rconfig(self, cl
+00013460: 6965 6e74 3d73 656c 662e 636f 6e74 6169  ient=self.contai
+00013470: 6e65 7263 6c69 656e 7429 2e63 6f6e 740a  nerclient).cont.
+00013480: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00013490: 636f 6e74 6120 696e 2073 6f72 7465 6428  conta in sorted(
+000134a0: 636f 6e74 2e6c 6973 745f 636f 6e74 6169  cont.list_contai
+000134b0: 6e65 7273 2829 293a 0a20 2020 2020 2020  ners()):.       
+000134c0: 2020 2020 2020 2020 206e 616d 6520 3d20           name = 
+000134d0: 636f 6e74 615b 305d 0a20 2020 2020 2020  conta[0].       
+000134e0: 2020 2020 2020 2020 2063 6f6e 7461 696e           contain
+000134f0: 6572 706c 616e 203d 2063 6f6e 7461 5b33  erplan = conta[3
+00013500: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+00013510: 2020 6966 2063 6f6e 7461 696e 6572 706c    if containerpl
+00013520: 616e 203d 3d20 706c 616e 3a0a 2020 2020  an == plan:.    
+00013530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013540: 7374 6f70 666f 756e 6420 3d20 5472 7565  stopfound = True
+00013550: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013560: 2020 2020 2063 6f6e 742e 7374 6f70 5f63       cont.stop_c
+00013570: 6f6e 7461 696e 6572 286e 616d 6529 0a20  ontainer(name). 
+00013580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013590: 2020 2073 7563 6365 7373 2866 2243 6f6e     success(f"Con
+000135a0: 7461 696e 6572 207b 6e61 6d65 7d20 7374  tainer {name} st
+000135b0: 6f70 7065 6421 2229 0a20 2020 2020 2020  opped!").       
+000135c0: 2069 6620 7374 6f70 666f 756e 643a 0a20   if stopfound:. 
+000135d0: 2020 2020 2020 2020 2020 2073 7563 6365             succe
+000135e0: 7373 2866 2250 6c61 6e20 7b70 6c61 6e7d  ss(f"Plan {plan}
+000135f0: 2073 746f 7070 6564 2122 290a 2020 2020   stopped!").    
+00013600: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00013610: 2020 2020 2020 7761 726e 696e 6728 224e        warning("N
+00013620: 6f20 6d61 7463 6869 6e67 206f 626a 6563  o matching objec
+00013630: 7473 2066 6f75 6e64 2229 0a20 2020 2020  ts found").     
+00013640: 2020 2072 6574 7572 6e20 7b27 7265 7375     return {'resu
+00013650: 6c74 273a 2027 7375 6363 6573 7327 7d0a  lt': 'success'}.
+00013660: 0a20 2020 2064 6566 2061 7574 6f73 7461  .    def autosta
+00013670: 7274 5f70 6c61 6e28 7365 6c66 2c20 706c  rt_plan(self, pl
+00013680: 616e 293a 0a20 2020 2020 2020 206b 203d  an):.        k =
+00013690: 2073 656c 662e 6b0a 2020 2020 2020 2020   self.k.        
+000136a0: 7070 7269 6e74 2866 2253 6574 2076 6d73  pprint(f"Set vms
+000136b0: 2066 726f 6d20 706c 616e 207b 706c 616e   from plan {plan
+000136c0: 7d20 746f 2061 7574 6f73 7461 7274 2229  } to autostart")
+000136d0: 0a20 2020 2020 2020 2066 6f72 2076 6d20  .        for vm 
+000136e0: 696e 2073 6f72 7465 6428 6b2e 6c69 7374  in sorted(k.list
+000136f0: 2829 2c20 6b65 793d 6c61 6d62 6461 2078  (), key=lambda x
+00013700: 3a20 785b 276e 616d 6527 5d29 3a0a 2020  : x['name']):.  
+00013710: 2020 2020 2020 2020 2020 6e61 6d65 203d            name =
+00013720: 2076 6d5b 276e 616d 6527 5d0a 2020 2020   vm['name'].    
+00013730: 2020 2020 2020 2020 6465 7363 7269 7074          descript
+00013740: 696f 6e20 3d20 766d 5b27 706c 616e 275d  ion = vm['plan']
+00013750: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00013760: 6465 7363 7269 7074 696f 6e20 3d3d 2070  description == p
+00013770: 6c61 6e3a 0a20 2020 2020 2020 2020 2020  lan:.           
+00013780: 2020 2020 206b 2e75 7064 6174 655f 7374       k.update_st
+00013790: 6172 7428 6e61 6d65 2c20 7374 6172 743d  art(name, start=
+000137a0: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
+000137b0: 2020 2020 2020 7375 6363 6573 7328 6622        success(f"
+000137c0: 7b6e 616d 657d 2073 6574 2074 6f20 6175  {name} set to au
+000137d0: 746f 7374 6172 7421 2229 0a20 2020 2020  tostart!").     
+000137e0: 2020 2072 6574 7572 6e20 7b27 7265 7375     return {'resu
+000137f0: 6c74 273a 2027 7375 6363 6573 7327 7d0a  lt': 'success'}.
+00013800: 0a20 2020 2064 6566 206e 6f61 7574 6f73  .    def noautos
+00013810: 7461 7274 5f70 6c61 6e28 7365 6c66 2c20  tart_plan(self, 
+00013820: 706c 616e 293a 0a20 2020 2020 2020 206b  plan):.        k
+00013830: 203d 2073 656c 662e 6b0a 2020 2020 2020   = self.k.      
+00013840: 2020 7070 7269 6e74 2866 2250 7265 7665    pprint(f"Preve
+00013850: 6e74 696e 6720 766d 7320 6672 6f6d 2070  nting vms from p
+00013860: 6c61 6e20 7b70 6c61 6e7d 2074 6f20 6175  lan {plan} to au
+00013870: 746f 7374 6172 7422 290a 2020 2020 2020  tostart").      
+00013880: 2020 666f 7220 766d 2069 6e20 736f 7274    for vm in sort
+00013890: 6564 286b 2e6c 6973 7428 292c 206b 6579  ed(k.list(), key
+000138a0: 3d6c 616d 6264 6120 783a 2078 5b27 6e61  =lambda x: x['na
+000138b0: 6d65 275d 293a 0a20 2020 2020 2020 2020  me']):.         
+000138c0: 2020 206e 616d 6520 3d20 766d 5b27 6e61     name = vm['na
+000138d0: 6d65 275d 0a20 2020 2020 2020 2020 2020  me'].           
+000138e0: 2064 6573 6372 6970 7469 6f6e 203d 2076   description = v
+000138f0: 6d5b 2770 6c61 6e27 5d0a 2020 2020 2020  m['plan'].      
+00013900: 2020 2020 2020 6966 2064 6573 6372 6970        if descrip
+00013910: 7469 6f6e 203d 3d20 706c 616e 3a0a 2020  tion == plan:.  
+00013920: 2020 2020 2020 2020 2020 2020 2020 6b2e                k.
+00013930: 7570 6461 7465 5f73 7461 7274 286e 616d  update_start(nam
+00013940: 652c 2073 7461 7274 3d46 616c 7365 290a  e, start=False).
+00013950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013960: 7375 6363 6573 7328 6622 7b6e 616d 657d  success(f"{name}
+00013970: 2070 7265 7665 6e74 6564 2074 6f20 6175   prevented to au
+00013980: 746f 7374 6172 7421 2229 0a20 2020 2020  tostart!").     
+00013990: 2020 2072 6574 7572 6e20 7b27 7265 7375     return {'resu
+000139a0: 6c74 273a 2027 7375 6363 6573 7327 7d0a  lt': 'success'}.
+000139b0: 0a20 2020 2064 6566 2064 656c 6574 655f  .    def delete_
+000139c0: 706c 616e 2873 656c 662c 2070 6c61 6e2c  plan(self, plan,
+000139d0: 2063 6f6e 7461 696e 6572 3d46 616c 7365   container=False
+000139e0: 2c20 756e 7265 6769 7374 6572 3d46 616c  , unregister=Fal
+000139f0: 7365 293a 0a20 2020 2020 2020 206b 203d  se):.        k =
+00013a00: 2073 656c 662e 6b0a 2020 2020 2020 2020   self.k.        
+00013a10: 6465 6c65 7465 6476 6d73 203d 205b 5d0a  deletedvms = [].
+00013a20: 2020 2020 2020 2020 6465 6c65 7465 646c          deletedl
+00013a30: 6273 203d 205b 5d0a 2020 2020 2020 2020  bs = [].        
+00013a40: 646e 7363 6c69 656e 7473 203d 205b 5d0a  dnsclients = [].
+00013a50: 2020 2020 2020 2020 6e65 7477 6f72 6b73          networks
+00013a60: 203d 205b 5d0a 2020 2020 2020 2020 6966   = [].        if
+00013a70: 2070 6c61 6e20 3d3d 2027 273a 0a20 2020   plan == '':.   
+00013a80: 2020 2020 2020 2020 2065 7272 6f72 2822           error("
+00013a90: 5468 6174 2077 6f75 6c64 2064 656c 6574  That would delet
+00013aa0: 6520 6576 6572 7920 766d 2e2e 2e4e 6f74  e every vm...Not
+00013ab0: 2064 6f69 6e67 2074 6861 7422 290a 2020   doing that").  
+00013ac0: 2020 2020 2020 2020 2020 7379 732e 6578            sys.ex
+00013ad0: 6974 2831 290a 2020 2020 2020 2020 666f  it(1).        fo
+00013ae0: 756e 6420 3d20 4661 6c73 650a 2020 2020  und = False.    
+00013af0: 2020 2020 6465 6c65 7465 636c 6965 6e74      deleteclient
+00013b00: 7320 3d20 7b73 656c 662e 636c 6965 6e74  s = {self.client
+00013b10: 3a20 6b7d 0a20 2020 2020 2020 2076 6d63  : k}.        vmc
+00013b20: 6c69 656e 7473 203d 205b 5d0a 2020 2020  lients = [].    
+00013b30: 2020 2020 766d 636c 6965 6e74 735f 6669      vmclients_fi
+00013b40: 6c65 203d 206f 732e 7061 7468 2e65 7870  le = os.path.exp
+00013b50: 616e 6475 7365 7228 6627 7e2f 2e6b 636c  anduser(f'~/.kcl
+00013b60: 692f 766d 636c 6965 6e74 735f 7b70 6c61  i/vmclients_{pla
+00013b70: 6e7d 2729 0a20 2020 2020 2020 2069 6620  n}').        if 
+00013b80: 6f73 2e70 6174 682e 6578 6973 7473 2876  os.path.exists(v
+00013b90: 6d63 6c69 656e 7473 5f66 696c 6529 3a0a  mclients_file):.
+00013ba0: 2020 2020 2020 2020 2020 2020 766d 636c              vmcl
+00013bb0: 6965 6e74 7320 3d20 7961 6d6c 2e73 6166  ients = yaml.saf
+00013bc0: 655f 6c6f 6164 286f 7065 6e28 766d 636c  e_load(open(vmcl
+00013bd0: 6965 6e74 735f 6669 6c65 2929 0a20 2020  ients_file)).   
+00013be0: 2020 2020 2020 2020 206f 732e 7265 6d6f           os.remo
+00013bf0: 7665 2876 6d63 6c69 656e 7473 5f66 696c  ve(vmclients_fil
+00013c00: 6529 0a20 2020 2020 2020 2069 6620 7365  e).        if se
+00013c10: 6c66 2e65 7874 7261 636c 6965 6e74 733a  lf.extraclients:
+00013c20: 0a20 2020 2020 2020 2020 2020 2064 656c  .            del
+00013c30: 6574 6563 6c69 656e 7473 2e75 7064 6174  eteclients.updat
+00013c40: 6528 7365 6c66 2e65 7874 7261 636c 6965  e(self.extraclie
+00013c50: 6e74 7329 0a20 2020 2020 2020 2065 6c69  nts).        eli
+00013c60: 6620 766d 636c 6965 6e74 733a 0a20 2020  f vmclients:.   
 00013c70: 2020 2020 2020 2020 2064 656c 6574 6563           deletec
-00013c80: 6c69 656e 7473 2e75 7064 6174 6528 7365  lients.update(se
-00013c90: 6c66 2e65 7874 7261 636c 6965 6e74 7329  lf.extraclients)
-00013ca0: 0a20 2020 2020 2020 2065 6c69 6620 766d  .        elif vm
-00013cb0: 636c 6965 6e74 733a 0a20 2020 2020 2020  clients:.       
-00013cc0: 2020 2020 2064 656c 6574 6563 6c69 656e       deleteclien
-00013cd0: 7473 2e75 7064 6174 6528 7b63 6c69 3a20  ts.update({cli: 
-00013ce0: 4b63 6f6e 6669 6728 636c 6965 6e74 3d63  Kconfig(client=c
-00013cf0: 6c69 292e 6b20 666f 7220 636c 6920 696e  li).k for cli in
-00013d00: 2076 6d63 6c69 656e 7473 2069 6620 636c   vmclients if cl
-00013d10: 6920 213d 2073 656c 662e 636c 6965 6e74  i != self.client
-00013d20: 7d29 0a20 2020 2020 2020 2068 7970 6572  }).        hyper
-00013d30: 7368 6966 7420 3d20 4661 6c73 650a 2020  shift = False.  
-00013d40: 2020 2020 2020 6173 7369 7374 6564 203d        assisted =
-00013d50: 2046 616c 7365 0a20 2020 2020 2020 2065   False.        e
-00013d60: 6b73 203d 2046 616c 7365 0a20 2020 2020  ks = False.     
-00013d70: 2020 2067 6b65 203d 2046 616c 7365 0a20     gke = False. 
-00013d80: 2020 2020 2020 2063 6c75 7374 6572 6469         clusterdi
-00013d90: 7220 3d20 222f 6661 6b65 2f78 7878 220a  r = "/fake/xxx".
-00013da0: 2020 2020 2020 2020 666f 7220 6879 7065          for hype
-00013db0: 7276 6973 6f72 2069 6e20 6465 6c65 7465  rvisor in delete
-00013dc0: 636c 6965 6e74 733a 0a20 2020 2020 2020  clients:.       
-00013dd0: 2020 2020 2063 203d 2064 656c 6574 6563       c = deletec
-00013de0: 6c69 656e 7473 5b68 7970 6572 7669 736f  lients[hyperviso
-00013df0: 725d 0a20 2020 2020 2020 2020 2020 2066  r].            f
-00013e00: 6f72 2076 6d20 696e 2073 6f72 7465 6428  or vm in sorted(
-00013e10: 632e 6c69 7374 2829 2c20 6b65 793d 6c61  c.list(), key=la
-00013e20: 6d62 6461 2078 3a20 785b 276e 616d 6527  mbda x: x['name'
-00013e30: 5d29 3a0a 2020 2020 2020 2020 2020 2020  ]):.            
-00013e40: 2020 2020 6e61 6d65 203d 2076 6d5b 276e      name = vm['n
-00013e50: 616d 6527 5d0a 2020 2020 2020 2020 2020  ame'].          
-00013e60: 2020 2020 2020 6465 7363 7269 7074 696f        descriptio
-00013e70: 6e20 3d20 766d 2e67 6574 2827 706c 616e  n = vm.get('plan
-00013e80: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
-00013e90: 2020 2069 6620 6465 7363 7269 7074 696f     if descriptio
-00013ea0: 6e20 3d3d 2070 6c61 6e3a 0a20 2020 2020  n == plan:.     
-00013eb0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00013ec0: 6620 766d 2e67 6574 2827 6b75 6265 7479  f vm.get('kubety
-00013ed0: 7065 272c 2027 6765 6e65 7269 6327 2920  pe', 'generic') 
-00013ee0: 696e 205b 2765 6b73 272c 2027 676b 6527  in ['eks', 'gke'
-00013ef0: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
-00013f00: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
-00013f10: 6e75 650a 2020 2020 2020 2020 2020 2020  nue.            
-00013f20: 2020 2020 2020 2020 6966 2027 6c6f 6164          if 'load
-00013f30: 6261 6c61 6e63 6572 2720 696e 2076 6d3a  balancer' in vm:
-00013f40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013f50: 2020 2020 2020 2020 206c 6273 203d 2076           lbs = v
-00013f60: 6d5b 276c 6f61 6462 616c 616e 6365 7227  m['loadbalancer'
-00013f70: 5d2e 7370 6c69 7428 272c 2729 0a20 2020  ].split(',').   
-00013f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013f90: 2020 2020 2066 6f72 206c 6220 696e 206c       for lb in l
-00013fa0: 6273 3a0a 2020 2020 2020 2020 2020 2020  bs:.            
-00013fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013fc0: 6966 206c 6220 6e6f 7420 696e 2064 656c  if lb not in del
-00013fd0: 6574 6564 6c62 733a 0a20 2020 2020 2020  etedlbs:.       
-00013fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013ff0: 2020 2020 2020 2020 2064 656c 6574 6564           deleted
-00014000: 6c62 732e 6170 7065 6e64 286c 6229 0a20  lbs.append(lb). 
-00014010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014020: 2020 2076 6d6e 6574 776f 726b 7320 3d20     vmnetworks = 
-00014030: 632e 766d 5f70 6f72 7473 286e 616d 6529  c.vm_ports(name)
-00014040: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014050: 2020 2020 2066 6f72 206e 6574 776f 726b       for network
-00014060: 2069 6e20 766d 6e65 7477 6f72 6b73 3a0a   in vmnetworks:.
-00014070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014080: 2020 2020 2020 2020 6966 206e 6574 776f          if netwo
-00014090: 726b 2021 3d20 2764 6566 6175 6c74 2720  rk != 'default' 
-000140a0: 616e 6420 6e65 7477 6f72 6b20 6e6f 7420  and network not 
-000140b0: 696e 206e 6574 776f 726b 733a 0a20 2020  in networks:.   
-000140c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000140d0: 2020 2020 2020 2020 206e 6574 776f 726b           network
-000140e0: 732e 6170 7065 6e64 286e 6574 776f 726b  s.append(network
-000140f0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00014100: 2020 2020 2020 646e 7363 6c69 656e 742c        dnsclient,
-00014110: 2064 6f6d 6169 6e20 3d20 632e 646e 7369   domain = c.dnsi
-00014120: 6e66 6f28 6e61 6d65 290a 2020 2020 2020  nfo(name).      
-00014130: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00014140: 2075 6e72 6567 6973 7465 723a 0a20 2020   unregister:.   
-00014150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014160: 2020 2020 2069 6d61 6765 203d 206b 2e69       image = k.i
-00014170: 6e66 6f28 6e61 6d65 292e 6765 7428 2769  nfo(name).get('i
-00014180: 6d61 6765 2729 0a20 2020 2020 2020 2020  mage').         
-00014190: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000141a0: 6620 2772 6865 6c27 2069 6e20 696d 6167  f 'rhel' in imag
-000141b0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-000141c0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-000141d0: 7072 696e 7428 6622 5265 6d6f 7669 6e67  print(f"Removing
-000141e0: 2072 6865 6c20 7375 6273 6372 6970 7469   rhel subscripti
-000141f0: 6f6e 2066 6f72 207b 6e61 6d65 7d22 290a  on for {name}").
+00013c80: 6c69 656e 7473 2e75 7064 6174 6528 7b63  lients.update({c
+00013c90: 6c69 3a20 4b63 6f6e 6669 6728 636c 6965  li: Kconfig(clie
+00013ca0: 6e74 3d63 6c69 292e 6b20 666f 7220 636c  nt=cli).k for cl
+00013cb0: 6920 696e 2076 6d63 6c69 656e 7473 2069  i in vmclients i
+00013cc0: 6620 636c 6920 213d 2073 656c 662e 636c  f cli != self.cl
+00013cd0: 6965 6e74 7d29 0a20 2020 2020 2020 2068  ient}).        h
+00013ce0: 7970 6572 7368 6966 7420 3d20 4661 6c73  ypershift = Fals
+00013cf0: 650a 2020 2020 2020 2020 6173 7369 7374  e.        assist
+00013d00: 6564 203d 2046 616c 7365 0a20 2020 2020  ed = False.     
+00013d10: 2020 2065 6b73 203d 2046 616c 7365 0a20     eks = False. 
+00013d20: 2020 2020 2020 2067 6b65 203d 2046 616c         gke = Fal
+00013d30: 7365 0a20 2020 2020 2020 2063 6c75 7374  se.        clust
+00013d40: 6572 6469 7220 3d20 222f 6661 6b65 2f78  erdir = "/fake/x
+00013d50: 7878 220a 2020 2020 2020 2020 666f 7220  xx".        for 
+00013d60: 6879 7065 7276 6973 6f72 2069 6e20 6465  hypervisor in de
+00013d70: 6c65 7465 636c 6965 6e74 733a 0a20 2020  leteclients:.   
+00013d80: 2020 2020 2020 2020 2063 203d 2064 656c           c = del
+00013d90: 6574 6563 6c69 656e 7473 5b68 7970 6572  eteclients[hyper
+00013da0: 7669 736f 725d 0a20 2020 2020 2020 2020  visor].         
+00013db0: 2020 2066 6f72 2076 6d20 696e 2073 6f72     for vm in sor
+00013dc0: 7465 6428 632e 6c69 7374 2829 2c20 6b65  ted(c.list(), ke
+00013dd0: 793d 6c61 6d62 6461 2078 3a20 785b 276e  y=lambda x: x['n
+00013de0: 616d 6527 5d29 3a0a 2020 2020 2020 2020  ame']):.        
+00013df0: 2020 2020 2020 2020 6e61 6d65 203d 2076          name = v
+00013e00: 6d5b 276e 616d 6527 5d0a 2020 2020 2020  m['name'].      
+00013e10: 2020 2020 2020 2020 2020 6465 7363 7269            descri
+00013e20: 7074 696f 6e20 3d20 766d 2e67 6574 2827  ption = vm.get('
+00013e30: 706c 616e 2729 0a20 2020 2020 2020 2020  plan').         
+00013e40: 2020 2020 2020 2069 6620 6465 7363 7269         if descri
+00013e50: 7074 696f 6e20 3d3d 2070 6c61 6e3a 0a20  ption == plan:. 
+00013e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013e70: 2020 2069 6620 766d 2e67 6574 2827 6b75     if vm.get('ku
+00013e80: 6265 7479 7065 272c 2027 6765 6e65 7269  betype', 'generi
+00013e90: 6327 2920 696e 205b 2765 6b73 272c 2027  c') in ['eks', '
+00013ea0: 676b 6527 5d3a 0a20 2020 2020 2020 2020  gke']:.         
+00013eb0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00013ec0: 6f6e 7469 6e75 650a 2020 2020 2020 2020  ontinue.        
+00013ed0: 2020 2020 2020 2020 2020 2020 6966 2027              if '
+00013ee0: 6c6f 6164 6261 6c61 6e63 6572 2720 696e  loadbalancer' in
+00013ef0: 2076 6d3a 0a20 2020 2020 2020 2020 2020   vm:.           
+00013f00: 2020 2020 2020 2020 2020 2020 206c 6273               lbs
+00013f10: 203d 2076 6d5b 276c 6f61 6462 616c 616e   = vm['loadbalan
+00013f20: 6365 7227 5d2e 7370 6c69 7428 272c 2729  cer'].split(',')
+00013f30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013f40: 2020 2020 2020 2020 2066 6f72 206c 6220           for lb 
+00013f50: 696e 206c 6273 3a0a 2020 2020 2020 2020  in lbs:.        
+00013f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013f70: 2020 2020 6966 206c 6220 6e6f 7420 696e      if lb not in
+00013f80: 2064 656c 6574 6564 6c62 733a 0a20 2020   deletedlbs:.   
+00013f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013fa0: 2020 2020 2020 2020 2020 2020 2064 656c               del
+00013fb0: 6574 6564 6c62 732e 6170 7065 6e64 286c  etedlbs.append(l
+00013fc0: 6229 0a20 2020 2020 2020 2020 2020 2020  b).             
+00013fd0: 2020 2020 2020 2076 6d6e 6574 776f 726b         vmnetwork
+00013fe0: 7320 3d20 632e 766d 5f70 6f72 7473 286e  s = c.vm_ports(n
+00013ff0: 616d 6529 0a20 2020 2020 2020 2020 2020  ame).           
+00014000: 2020 2020 2020 2020 2066 6f72 206e 6574           for net
+00014010: 776f 726b 2069 6e20 766d 6e65 7477 6f72  work in vmnetwor
+00014020: 6b73 3a0a 2020 2020 2020 2020 2020 2020  ks:.            
+00014030: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+00014040: 6574 776f 726b 2021 3d20 2764 6566 6175  etwork != 'defau
+00014050: 6c74 2720 616e 6420 6e65 7477 6f72 6b20  lt' and network 
+00014060: 6e6f 7420 696e 206e 6574 776f 726b 733a  not in networks:
+00014070: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014080: 2020 2020 2020 2020 2020 2020 206e 6574               net
+00014090: 776f 726b 732e 6170 7065 6e64 286e 6574  works.append(net
+000140a0: 776f 726b 290a 2020 2020 2020 2020 2020  work).          
+000140b0: 2020 2020 2020 2020 2020 646e 7363 6c69            dnscli
+000140c0: 656e 742c 2064 6f6d 6169 6e20 3d20 632e  ent, domain = c.
+000140d0: 646e 7369 6e66 6f28 6e61 6d65 290a 2020  dnsinfo(name).  
+000140e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000140f0: 2020 6966 2075 6e72 6567 6973 7465 723a    if unregister:
+00014100: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014110: 2020 2020 2020 2020 2069 6d61 6765 203d           image =
+00014120: 206b 2e69 6e66 6f28 6e61 6d65 292e 6765   k.info(name).ge
+00014130: 7428 2769 6d61 6765 2729 0a20 2020 2020  t('image').     
+00014140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014150: 2020 2069 6620 2772 6865 6c27 2069 6e20     if 'rhel' in 
+00014160: 696d 6167 653a 0a20 2020 2020 2020 2020  image:.         
+00014170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014180: 2020 2070 7072 696e 7428 6622 5265 6d6f     pprint(f"Remo
+00014190: 7669 6e67 2072 6865 6c20 7375 6273 6372  ving rhel subscr
+000141a0: 6970 7469 6f6e 2066 6f72 207b 6e61 6d65  iption for {name
+000141b0: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
+000141c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000141d0: 6970 2c20 766d 706f 7274 203d 205f 7373  ip, vmport = _ss
+000141e0: 685f 6372 6564 656e 7469 616c 7328 6b2c  h_credentials(k,
+000141f0: 206e 616d 6529 5b31 3a5d 0a20 2020 2020   name)[1:].     
 00014200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014210: 2020 2020 2020 2020 2020 2020 6970 2c20              ip, 
-00014220: 766d 706f 7274 203d 205f 7373 685f 6372  vmport = _ssh_cr
-00014230: 6564 656e 7469 616c 7328 6b2c 206e 616d  edentials(k, nam
-00014240: 6529 5b31 3a5d 0a20 2020 2020 2020 2020  e)[1:].         
-00014250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014260: 2020 2063 6d64 203d 2022 7375 6273 6372     cmd = "subscr
-00014270: 6970 7469 6f6e 2d6d 616e 6167 6572 2075  iption-manager u
-00014280: 6e72 6567 6973 7465 7222 0a20 2020 2020  nregister".     
-00014290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000142a0: 2020 2020 2020 2073 7368 636d 6420 3d20         sshcmd = 
-000142b0: 7373 6828 6e61 6d65 2c20 6970 3d69 702c  ssh(name, ip=ip,
-000142c0: 2075 7365 723d 2772 6f6f 7427 2c20 7475   user='root', tu
-000142d0: 6e6e 656c 3d73 656c 662e 7475 6e6e 656c  nnel=self.tunnel
-000142e0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000142f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014300: 2020 2020 2020 2020 2020 2074 756e 6e65             tunne
-00014310: 6c68 6f73 743d 7365 6c66 2e74 756e 6e65  lhost=self.tunne
-00014320: 6c68 6f73 742c 2074 756e 6e65 6c70 6f72  lhost, tunnelpor
-00014330: 743d 7365 6c66 2e74 756e 6e65 6c70 6f72  t=self.tunnelpor
-00014340: 742c 0a20 2020 2020 2020 2020 2020 2020  t,.             
-00014350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014360: 2020 2020 2020 2020 2020 2020 7475 6e6e              tunn
-00014370: 656c 7573 6572 3d73 656c 662e 7475 6e6e  eluser=self.tunn
-00014380: 656c 7573 6572 2c20 696e 7365 6375 7265  eluser, insecure
-00014390: 3d54 7275 652c 2063 6d64 3d63 6d64 2c20  =True, cmd=cmd, 
-000143a0: 766d 706f 7274 3d76 6d70 6f72 7429 0a20  vmport=vmport). 
-000143b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000143c0: 2020 2020 2020 2020 2020 206f 732e 7379             os.sy
-000143d0: 7374 656d 2873 7368 636d 6429 0a20 2020  stem(sshcmd).   
-000143e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000143f0: 2063 2e64 656c 6574 6528 6e61 6d65 2c20   c.delete(name, 
-00014400: 736e 6170 7368 6f74 733d 5472 7565 290a  snapshots=True).
-00014410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014420: 2020 2020 6966 2064 6e73 636c 6965 6e74      if dnsclient
-00014430: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
-00014440: 2064 6f6d 6169 6e20 6973 206e 6f74 204e   domain is not N
-00014450: 6f6e 6520 616e 6420 646e 7363 6c69 656e  one and dnsclien
-00014460: 7420 696e 2073 656c 662e 636c 6965 6e74  t in self.client
-00014470: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-00014480: 2020 2020 2020 2020 2020 2069 6620 646e             if dn
-00014490: 7363 6c69 656e 7420 696e 2064 6e73 636c  sclient in dnscl
-000144a0: 6965 6e74 733a 0a20 2020 2020 2020 2020  ients:.         
-000144b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000144c0: 2020 207a 203d 2064 6e73 636c 6965 6e74     z = dnsclient
-000144d0: 735b 646e 7363 6c69 656e 745d 0a20 2020  s[dnsclient].   
-000144e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000144f0: 2020 2020 2065 6c69 6620 646e 7363 6c69       elif dnscli
-00014500: 656e 7420 696e 2073 656c 662e 636c 6965  ent in self.clie
-00014510: 6e74 733a 0a20 2020 2020 2020 2020 2020  nts:.           
-00014520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014530: 207a 203d 204b 636f 6e66 6967 2863 6c69   z = Kconfig(cli
-00014540: 656e 743d 646e 7363 6c69 656e 7429 2e6b  ent=dnsclient).k
-00014550: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014560: 2020 2020 2020 2020 2020 2020 2064 6e73               dns
-00014570: 636c 6965 6e74 735b 646e 7363 6c69 656e  clients[dnsclien
-00014580: 745d 203d 207a 0a20 2020 2020 2020 2020  t] = z.         
-00014590: 2020 2020 2020 2020 2020 2020 2020 207a                 z
-000145a0: 2e64 656c 6574 655f 646e 7328 646e 7363  .delete_dns(dnsc
-000145b0: 6c69 656e 742c 2064 6f6d 6169 6e29 0a20  lient, domain). 
-000145c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000145d0: 2020 2063 6f6d 6d6f 6e2e 6465 6c65 7465     common.delete
-000145e0: 5f6c 6173 7476 6d28 6e61 6d65 2c20 7365  _lastvm(name, se
-000145f0: 6c66 2e63 6c69 656e 7429 0a20 2020 2020  lf.client).     
-00014600: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00014610: 7563 6365 7373 2866 227b 6e61 6d65 7d20  uccess(f"{name} 
-00014620: 6465 6c65 7465 6420 6f6e 207b 6879 7065  deleted on {hype
-00014630: 7276 6973 6f72 7d21 2229 0a20 2020 2020  rvisor}!").     
-00014640: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00014650: 656c 6574 6564 766d 732e 6170 7065 6e64  eletedvms.append
-00014660: 286e 616d 6529 0a20 2020 2020 2020 2020  (name).         
-00014670: 2020 2020 2020 2020 2020 2066 6f75 6e64             found
-00014680: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
-00014690: 2020 2020 2020 2020 2020 2020 636c 7573              clus
-000146a0: 7465 7220 3d20 766d 2e67 6574 2827 6b75  ter = vm.get('ku
-000146b0: 6265 2729 0a20 2020 2020 2020 2020 2020  be').           
-000146c0: 2020 2020 2020 2020 2069 6620 636c 7573           if clus
-000146d0: 7465 7220 6973 206e 6f74 204e 6f6e 6520  ter is not None 
-000146e0: 616e 6420 636c 7573 7465 7220 213d 2027  and cluster != '
-000146f0: 273a 0a20 2020 2020 2020 2020 2020 2020  ':.             
-00014700: 2020 2020 2020 2020 2020 2063 6c75 7374             clust
-00014710: 6572 6469 7220 3d20 6f73 2e70 6174 682e  erdir = os.path.
-00014720: 6578 7061 6e64 7573 6572 2866 227e 2f2e  expanduser(f"~/.
-00014730: 6b63 6c69 2f63 6c75 7374 6572 732f 7b63  kcli/clusters/{c
-00014740: 6c75 7374 6572 7d22 290a 2020 2020 2020  luster}").      
-00014750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014760: 2020 6966 206f 732e 7061 7468 2e65 7869    if os.path.exi
-00014770: 7374 7328 636c 7573 7465 7264 6972 293a  sts(clusterdir):
-00014780: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014790: 2020 2020 2020 2020 2020 2020 2070 6172               par
-000147a0: 616d 6574 6572 7366 696c 6520 3d20 6622  ametersfile = f"
-000147b0: 7b63 6c75 7374 6572 6469 727d 2f6b 636c  {clusterdir}/kcl
-000147c0: 695f 7061 7261 6d65 7465 7273 2e79 6d6c  i_parameters.yml
-000147d0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-000147e0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-000147f0: 206f 732e 7061 7468 2e65 7869 7374 7328   os.path.exists(
-00014800: 7061 7261 6d65 7465 7273 6669 6c65 293a  parametersfile):
-00014810: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014830: 2077 6974 6820 6f70 656e 2870 6172 616d   with open(param
-00014840: 6574 6572 7366 696c 6529 2061 7320 663a  etersfile) as f:
-00014850: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014870: 2020 2020 2063 6c75 7374 6572 6461 7461       clusterdata
-00014880: 203d 2079 616d 6c2e 7361 6665 5f6c 6f61   = yaml.safe_loa
-00014890: 6428 6629 0a20 2020 2020 2020 2020 2020  d(f).           
+00014210: 2020 2020 2020 2063 6d64 203d 2022 7375         cmd = "su
+00014220: 6273 6372 6970 7469 6f6e 2d6d 616e 6167  bscription-manag
+00014230: 6572 2075 6e72 6567 6973 7465 7222 0a20  er unregister". 
+00014240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014250: 2020 2020 2020 2020 2020 2073 7368 636d             sshcm
+00014260: 6420 3d20 7373 6828 6e61 6d65 2c20 6970  d = ssh(name, ip
+00014270: 3d69 702c 2075 7365 723d 2772 6f6f 7427  =ip, user='root'
+00014280: 2c20 7475 6e6e 656c 3d73 656c 662e 7475  , tunnel=self.tu
+00014290: 6e6e 656c 2c0a 2020 2020 2020 2020 2020  nnel,.          
+000142a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000142b0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+000142c0: 756e 6e65 6c68 6f73 743d 7365 6c66 2e74  unnelhost=self.t
+000142d0: 756e 6e65 6c68 6f73 742c 2074 756e 6e65  unnelhost, tunne
+000142e0: 6c70 6f72 743d 7365 6c66 2e74 756e 6e65  lport=self.tunne
+000142f0: 6c70 6f72 742c 0a20 2020 2020 2020 2020  lport,.         
+00014300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014320: 7475 6e6e 656c 7573 6572 3d73 656c 662e  tunneluser=self.
+00014330: 7475 6e6e 656c 7573 6572 2c20 696e 7365  tunneluser, inse
+00014340: 6375 7265 3d54 7275 652c 2063 6d64 3d63  cure=True, cmd=c
+00014350: 6d64 2c20 766d 706f 7274 3d76 6d70 6f72  md, vmport=vmpor
+00014360: 7429 0a20 2020 2020 2020 2020 2020 2020  t).             
+00014370: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+00014380: 732e 7379 7374 656d 2873 7368 636d 6429  s.system(sshcmd)
+00014390: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000143a0: 2020 2020 2063 2e64 656c 6574 6528 6e61       c.delete(na
+000143b0: 6d65 2c20 736e 6170 7368 6f74 733d 5472  me, snapshots=Tr
+000143c0: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
+000143d0: 2020 2020 2020 2020 6966 2064 6e73 636c          if dnscl
+000143e0: 6965 6e74 2069 7320 6e6f 7420 4e6f 6e65  ient is not None
+000143f0: 2061 6e64 2064 6f6d 6169 6e20 6973 206e   and domain is n
+00014400: 6f74 204e 6f6e 6520 616e 6420 646e 7363  ot None and dnsc
+00014410: 6c69 656e 7420 696e 2073 656c 662e 636c  lient in self.cl
+00014420: 6965 6e74 733a 0a20 2020 2020 2020 2020  ients:.         
+00014430: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00014440: 6620 646e 7363 6c69 656e 7420 696e 2064  f dnsclient in d
+00014450: 6e73 636c 6965 6e74 733a 0a20 2020 2020  nsclients:.     
+00014460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014470: 2020 2020 2020 207a 203d 2064 6e73 636c         z = dnscl
+00014480: 6965 6e74 735b 646e 7363 6c69 656e 745d  ients[dnsclient]
+00014490: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000144a0: 2020 2020 2020 2020 2065 6c69 6620 646e           elif dn
+000144b0: 7363 6c69 656e 7420 696e 2073 656c 662e  sclient in self.
+000144c0: 636c 6965 6e74 733a 0a20 2020 2020 2020  clients:.       
+000144d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000144e0: 2020 2020 207a 203d 204b 636f 6e66 6967       z = Kconfig
+000144f0: 2863 6c69 656e 743d 646e 7363 6c69 656e  (client=dnsclien
+00014500: 7429 2e6b 0a20 2020 2020 2020 2020 2020  t).k.           
+00014510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014520: 2064 6e73 636c 6965 6e74 735b 646e 7363   dnsclients[dnsc
+00014530: 6c69 656e 745d 203d 207a 0a20 2020 2020  lient] = z.     
+00014540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014550: 2020 207a 2e64 656c 6574 655f 646e 7328     z.delete_dns(
+00014560: 646e 7363 6c69 656e 742c 2064 6f6d 6169  dnsclient, domai
+00014570: 6e29 0a20 2020 2020 2020 2020 2020 2020  n).             
+00014580: 2020 2020 2020 2063 6f6d 6d6f 6e2e 6465         common.de
+00014590: 6c65 7465 5f6c 6173 7476 6d28 6e61 6d65  lete_lastvm(name
+000145a0: 2c20 7365 6c66 2e63 6c69 656e 7429 0a20  , self.client). 
+000145b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000145c0: 2020 2073 7563 6365 7373 2866 227b 6e61     success(f"{na
+000145d0: 6d65 7d20 6465 6c65 7465 6420 6f6e 207b  me} deleted on {
+000145e0: 6879 7065 7276 6973 6f72 7d21 2229 0a20  hypervisor}!"). 
+000145f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014600: 2020 2064 656c 6574 6564 766d 732e 6170     deletedvms.ap
+00014610: 7065 6e64 286e 616d 6529 0a20 2020 2020  pend(name).     
+00014620: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00014630: 6f75 6e64 203d 2054 7275 650a 2020 2020  ound = True.    
+00014640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014650: 636c 7573 7465 7220 3d20 766d 2e67 6574  cluster = vm.get
+00014660: 2827 6b75 6265 2729 0a20 2020 2020 2020  ('kube').       
+00014670: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00014680: 636c 7573 7465 7220 6973 206e 6f74 204e  cluster is not N
+00014690: 6f6e 6520 616e 6420 636c 7573 7465 7220  one and cluster 
+000146a0: 213d 2027 273a 0a20 2020 2020 2020 2020  != '':.         
+000146b0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+000146c0: 6c75 7374 6572 6469 7220 3d20 6f73 2e70  lusterdir = os.p
+000146d0: 6174 682e 6578 7061 6e64 7573 6572 2866  ath.expanduser(f
+000146e0: 227e 2f2e 6b63 6c69 2f63 6c75 7374 6572  "~/.kcli/cluster
+000146f0: 732f 7b63 6c75 7374 6572 7d22 290a 2020  s/{cluster}").  
+00014700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014710: 2020 2020 2020 6966 206f 732e 7061 7468        if os.path
+00014720: 2e65 7869 7374 7328 636c 7573 7465 7264  .exists(clusterd
+00014730: 6972 293a 0a20 2020 2020 2020 2020 2020  ir):.           
+00014740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014750: 2070 6172 616d 6574 6572 7366 696c 6520   parametersfile 
+00014760: 3d20 6622 7b63 6c75 7374 6572 6469 727d  = f"{clusterdir}
+00014770: 2f6b 636c 695f 7061 7261 6d65 7465 7273  /kcli_parameters
+00014780: 2e79 6d6c 220a 2020 2020 2020 2020 2020  .yml".          
+00014790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000147a0: 2020 6966 206f 732e 7061 7468 2e65 7869    if os.path.exi
+000147b0: 7374 7328 7061 7261 6d65 7465 7273 6669  sts(parametersfi
+000147c0: 6c65 293a 0a20 2020 2020 2020 2020 2020  le):.           
+000147d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000147e0: 2020 2020 2077 6974 6820 6f70 656e 2870       with open(p
+000147f0: 6172 616d 6574 6572 7366 696c 6529 2061  arametersfile) a
+00014800: 7320 663a 0a20 2020 2020 2020 2020 2020  s f:.           
+00014810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014820: 2020 2020 2020 2020 2063 6c75 7374 6572           cluster
+00014830: 6461 7461 203d 2079 616d 6c2e 7361 6665  data = yaml.safe
+00014840: 5f6c 6f61 6428 6629 0a20 2020 2020 2020  _load(f).       
+00014850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014860: 2020 2020 2020 2020 2020 2020 206b 7562               kub
+00014870: 6574 7970 6520 3d20 636c 7573 7465 7264  etype = clusterd
+00014880: 6174 612e 6765 7428 276b 7562 6574 7970  ata.get('kubetyp
+00014890: 6527 2c20 2767 656e 6572 6963 2729 0a20  e', 'generic'). 
 000148a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000148b0: 2020 2020 2020 2020 206b 7562 6574 7970           kubetyp
-000148c0: 6520 3d20 636c 7573 7465 7264 6174 612e  e = clusterdata.
-000148d0: 6765 7428 276b 7562 6574 7970 6527 2c20  get('kubetype', 
-000148e0: 2767 656e 6572 6963 2729 0a20 2020 2020  'generic').     
+000148b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000148c0: 2020 2069 6620 6b75 6265 7479 7065 203d     if kubetype =
+000148d0: 3d20 2768 7970 6572 7368 6966 7427 3a0a  = 'hypershift':.
+000148e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000148f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014900: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00014910: 6620 6b75 6265 7479 7065 203d 3d20 2768  f kubetype == 'h
-00014920: 7970 6572 7368 6966 7427 3a0a 2020 2020  ypershift':.    
+00014900: 2020 2020 2020 2020 6879 7065 7273 6869          hypershi
+00014910: 6674 203d 2054 7275 650a 2020 2020 2020  ft = True.      
+00014920: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00014930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014950: 2020 2020 6879 7065 7273 6869 6674 203d      hypershift =
-00014960: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
+00014940: 2020 6173 7369 7374 6564 203d 2063 6c75    assisted = clu
+00014950: 7374 6572 6461 7461 2e67 6574 2861 7373  sterdata.get(ass
+00014960: 6973 7465 642c 2046 616c 7365 290a 2020  isted, False).  
 00014970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014980: 2020 2020 2020 2020 2020 2020 2020 6173                as
-00014990: 7369 7374 6564 203d 2063 6c75 7374 6572  sisted = cluster
-000149a0: 6461 7461 2e67 6574 2861 7373 6973 7465  data.get(assiste
-000149b0: 642c 2046 616c 7365 290a 2020 2020 2020  d, False).      
+00014980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014990: 2020 646f 6d61 696e 203d 2063 6c75 7374    domain = clust
+000149a0: 6572 6461 7461 2e67 6574 2827 646f 6d61  erdata.get('doma
+000149b0: 696e 272c 2064 6f6d 6169 6e29 0a20 2020  in', domain).   
 000149c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000149d0: 2020 2020 2020 2020 2020 2020 2020 646f                do
-000149e0: 6d61 696e 203d 2063 6c75 7374 6572 6461  main = clusterda
-000149f0: 7461 2e67 6574 2827 646f 6d61 696e 272c  ta.get('domain',
-00014a00: 2064 6f6d 6169 6e29 0a20 2020 2020 2020   domain).       
+000149d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000149e0: 2064 6e73 636c 6965 6e74 203d 2063 6c75   dnsclient = clu
+000149f0: 7374 6572 6461 7461 2e67 6574 2827 646e  sterdata.get('dn
+00014a00: 7363 6c69 656e 7427 290a 2020 2020 2020  sclient').      
 00014a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014a20: 2020 2020 2020 2020 2020 2020 2064 6e73               dns
-00014a30: 636c 6965 6e74 203d 2063 6c75 7374 6572  client = cluster
-00014a40: 6461 7461 2e67 6574 2827 646e 7363 6c69  data.get('dnscli
-00014a50: 656e 7427 290a 2020 2020 2020 2020 2020  ent').          
-00014a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014a70: 2020 2020 2020 2020 2020 676b 6520 3d20            gke = 
-00014a80: 6b75 6265 7479 7065 203d 3d20 2767 6b65  kubetype == 'gke
-00014a90: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
-00014aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014ab0: 2020 2020 2020 656b 7320 3d20 6b75 6265        eks = kube
-00014ac0: 7479 7065 203d 3d20 2765 6b73 270a 2020  type == 'eks'.  
-00014ad0: 2020 2020 2020 6966 2068 7970 6572 7368        if hypersh
-00014ae0: 6966 743a 0a20 2020 2020 2020 2020 2020  ift:.           
-00014af0: 206b 7562 6563 6f6e 6669 676d 676d 7420   kubeconfigmgmt 
-00014b00: 3d20 6622 7b63 6c75 7374 6572 6469 727d  = f"{clusterdir}
-00014b10: 2f6b 7562 6563 6f6e 6669 672e 6d67 6d74  /kubeconfig.mgmt
-00014b20: 220a 2020 2020 2020 2020 2020 2020 6361  ".            ca
-00014b30: 6c6c 2866 274b 5542 4543 4f4e 4649 473d  ll(f'KUBECONFIG=
-00014b40: 7b6b 7562 6563 6f6e 6669 676d 676d 747d  {kubeconfigmgmt}
-00014b50: 206f 6320 6465 6c65 7465 202d 6620 7b63   oc delete -f {c
-00014b60: 6c75 7374 6572 6469 727d 2f61 7574 6f61  lusterdir}/autoa
-00014b70: 7070 726f 7665 7263 726f 6e2e 796d 6c27  pprovercron.yml'
-00014b80: 2c20 7368 656c 6c3d 5472 7565 290a 2020  , shell=True).  
-00014b90: 2020 2020 2020 2020 2020 6361 6c6c 2866            call(f
-00014ba0: 274b 5542 4543 4f4e 4649 473d 7b6b 7562  'KUBECONFIG={kub
-00014bb0: 6563 6f6e 6669 676d 676d 747d 206f 6320  econfigmgmt} oc 
-00014bc0: 6465 6c65 7465 202d 6620 7b63 6c75 7374  delete -f {clust
-00014bd0: 6572 6469 727d 2f6e 6f64 6570 6f6f 6c2e  erdir}/nodepool.
-00014be0: 7961 6d6c 272c 2073 6865 6c6c 3d54 7275  yaml', shell=Tru
-00014bf0: 6529 0a20 2020 2020 2020 2020 2020 2063  e).            c
-00014c00: 616c 6c28 6627 4b55 4245 434f 4e46 4947  all(f'KUBECONFIG
-00014c10: 3d7b 6b75 6265 636f 6e66 6967 6d67 6d74  ={kubeconfigmgmt
-00014c20: 7d20 6f63 2064 656c 6574 6520 2d66 207b  } oc delete -f {
-00014c30: 636c 7573 7465 7264 6972 7d2f 686f 7374  clusterdir}/host
-00014c40: 6564 636c 7573 7465 722e 7961 6d6c 272c  edcluster.yaml',
-00014c50: 2073 6865 6c6c 3d54 7275 6529 0a20 2020   shell=True).   
-00014c60: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-00014c70: 6173 7369 7374 6564 2061 6e64 2028 2762  assisted and ('b
-00014c80: 6172 656d 6574 616c 5f69 736f 2720 696e  aremetal_iso' in
-00014c90: 2063 6c75 7374 6572 6461 7461 206f 7220   clusterdata or 
-00014ca0: 2762 6172 656d 6574 616c 5f68 6f73 7473  'baremetal_hosts
-00014cb0: 2720 696e 2063 6c75 7374 6572 6461 7461  ' in clusterdata
-00014cc0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00014cd0: 2020 2063 616c 6c28 274b 5542 4543 4f4e     call('KUBECON
-00014ce0: 4649 473d 7b6b 7562 6563 6f6e 6669 676d  FIG={kubeconfigm
-00014cf0: 676d 747d 206f 6320 2d6e 2064 6566 6175  gmt} oc -n defau
-00014d00: 6c74 2064 656c 6574 6520 616c 6c20 2d6c  lt delete all -l
-00014d10: 2061 7070 3d68 7474 7064 2d6b 636c 6927   app=httpd-kcli'
-00014d20: 2c20 7368 656c 6c3d 5472 7565 290a 2020  , shell=True).  
-00014d30: 2020 2020 2020 2020 2020 2020 2020 6361                ca
-00014d40: 6c6c 2827 4b55 4245 434f 4e46 4947 3d7b  ll('KUBECONFIG={
-00014d50: 6b75 6265 636f 6e66 6967 6d67 6d74 7d20  kubeconfigmgmt} 
-00014d60: 6f63 202d 6e20 6465 6661 756c 7420 6465  oc -n default de
-00014d70: 6c65 7465 2073 7663 2068 7474 7064 2d6b  lete svc httpd-k
-00014d80: 636c 692d 7376 6327 2c20 7368 656c 6c3d  cli-svc', shell=
-00014d90: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
-00014da0: 2020 2020 2020 6361 6c6c 2827 4b55 4245        call('KUBE
-00014db0: 434f 4e46 4947 3d7b 6b75 6265 636f 6e66  CONFIG={kubeconf
-00014dc0: 6967 6d67 6d74 7d20 6f63 202d 6e20 6465  igmgmt} oc -n de
-00014dd0: 6661 756c 7420 6465 6c65 7465 2070 7663  fault delete pvc
-00014de0: 2068 7474 7064 2d6b 636c 692d 7076 6327   httpd-kcli-pvc'
-00014df0: 2c20 7368 656c 6c3d 5472 7565 290a 2020  , shell=True).  
-00014e00: 2020 2020 2020 6966 2067 6b65 3a0a 2020        if gke:.  
-00014e10: 2020 2020 2020 2020 2020 6763 7063 6c69            gcpcli
-00014e20: 656e 7420 3d20 4e6f 6e65 0a20 2020 2020  ent = None.     
-00014e30: 2020 2020 2020 2069 6620 2763 6c69 656e         if 'clien
-00014e40: 7427 2069 6e20 636c 7573 7465 7264 6174  t' in clusterdat
-00014e50: 613a 0a20 2020 2020 2020 2020 2020 2020  a:.             
-00014e60: 2020 2067 6370 636c 6965 6e74 203d 2063     gcpclient = c
-00014e70: 6c75 7374 6572 6461 7461 5b27 636c 6965  lusterdata['clie
-00014e80: 6e74 275d 0a20 2020 2020 2020 2020 2020  nt'].           
-00014e90: 2065 6c69 6620 7365 6c66 2e74 7970 6520   elif self.type 
-00014ea0: 3d3d 2027 676b 6527 3a0a 2020 2020 2020  == 'gke':.      
-00014eb0: 2020 2020 2020 2020 2020 6763 7063 6c69            gcpcli
-00014ec0: 656e 7420 3d20 7365 6c66 2e63 6c69 656e  ent = self.clien
-00014ed0: 740a 2020 2020 2020 2020 2020 2020 656c  t.            el
-00014ee0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00014ef0: 2020 2020 7265 7475 726e 207b 2772 6573      return {'res
-00014f00: 756c 7427 3a20 2766 6169 6c75 7265 272c  ult': 'failure',
-00014f10: 2027 7265 6173 6f6e 273a 2022 4465 6c65   'reason': "Dele
-00014f20: 7469 6e67 2067 6b65 2063 6c75 7374 6572  ting gke cluster
-00014f30: 2072 6571 7569 7265 7320 746f 2069 6e73   requires to ins
-00014f40: 7461 6e74 6961 7465 2067 6370 2070 726f  tantiate gcp pro
-00014f50: 7669 6465 7222 7d0a 2020 2020 2020 2020  vider"}.        
-00014f60: 2020 2020 6672 6f6d 206b 7669 7274 2e63      from kvirt.c
-00014f70: 6c75 7374 6572 2069 6d70 6f72 7420 676b  luster import gk
-00014f80: 650a 2020 2020 2020 2020 2020 2020 6375  e.            cu
-00014f90: 7272 656e 7463 6f6e 6669 6720 3d20 4b63  rrentconfig = Kc
-00014fa0: 6f6e 6669 6728 636c 6965 6e74 3d67 6370  onfig(client=gcp
-00014fb0: 636c 6965 6e74 292e 6b20 6966 2067 6370  client).k if gcp
-00014fc0: 636c 6965 6e74 2021 3d20 7365 6c66 2e63  client != self.c
-00014fd0: 6c69 656e 7420 656c 7365 2073 656c 660a  lient else self.
-00014fe0: 2020 2020 2020 2020 2020 2020 7a6f 6e61              zona
-00014ff0: 6c20 3d20 636c 7573 7465 7264 6174 612e  l = clusterdata.
-00015000: 6765 7428 277a 6f6e 616c 272c 2054 7275  get('zonal', Tru
-00015010: 6529 0a20 2020 2020 2020 2020 2020 2067  e).            g
-00015020: 6b65 2e64 656c 6574 6528 6375 7272 656e  ke.delete(curren
-00015030: 7463 6f6e 6669 672c 2063 6c75 7374 6572  tconfig, cluster
-00015040: 2c20 7a6f 6e61 6c29 0a20 2020 2020 2020  , zonal).       
-00015050: 2065 6c69 6620 656b 733a 0a20 2020 2020   elif eks:.     
-00015060: 2020 2020 2020 2065 6b73 636c 6965 6e74         eksclient
-00015070: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
-00015080: 2020 2020 6966 2027 636c 6965 6e74 2720      if 'client' 
-00015090: 696e 2063 6c75 7374 6572 6461 7461 3a0a  in clusterdata:.
-000150a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000150b0: 656b 7363 6c69 656e 7420 3d20 636c 7573  eksclient = clus
-000150c0: 7465 7264 6174 615b 2763 6c69 656e 7427  terdata['client'
-000150d0: 5d0a 2020 2020 2020 2020 2020 2020 656c  ].            el
-000150e0: 6966 2073 656c 662e 7479 7065 203d 3d20  if self.type == 
-000150f0: 2761 7773 273a 0a20 2020 2020 2020 2020  'aws':.         
-00015100: 2020 2020 2020 2065 6b73 636c 6965 6e74         eksclient
-00015110: 203d 2073 656c 662e 636c 6965 6e74 0a20   = self.client. 
-00015120: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00015130: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015140: 2072 6574 7572 6e20 7b27 7265 7375 6c74   return {'result
-00015150: 273a 2027 6661 696c 7572 6527 2c20 2772  ': 'failure', 'r
-00015160: 6561 736f 6e27 3a20 2244 656c 6574 696e  eason': "Deletin
-00015170: 6720 656b 7320 636c 7573 7465 7220 7265  g eks cluster re
-00015180: 7175 6972 6573 2074 6f20 696e 7374 616e  quires to instan
-00015190: 7469 6174 6520 6763 7020 7072 6f76 6964  tiate gcp provid
-000151a0: 6572 227d 0a20 2020 2020 2020 2020 2020  er"}.           
-000151b0: 2066 726f 6d20 6b76 6972 742e 636c 7573   from kvirt.clus
-000151c0: 7465 7220 696d 706f 7274 2065 6b73 0a20  ter import eks. 
-000151d0: 2020 2020 2020 2020 2020 2063 7572 7265             curre
-000151e0: 6e74 636f 6e66 6967 203d 204b 636f 6e66  ntconfig = Kconf
-000151f0: 6967 2863 6c69 656e 743d 656b 7363 6c69  ig(client=ekscli
-00015200: 656e 7429 2e6b 2069 6620 656b 7363 6c69  ent).k if ekscli
-00015210: 656e 7420 213d 2073 656c 662e 636c 6965  ent != self.clie
-00015220: 6e74 2065 6c73 6520 7365 6c66 0a20 2020  nt else self.   
-00015230: 2020 2020 2020 2020 2065 6b73 2e64 656c           eks.del
-00015240: 6574 6528 6375 7272 656e 7463 6f6e 6669  ete(currentconfi
-00015250: 672c 2063 6c75 7374 6572 290a 2020 2020  g, cluster).    
-00015260: 2020 2020 6966 206f 732e 7061 7468 2e65      if os.path.e
-00015270: 7869 7374 7328 636c 7573 7465 7264 6972  xists(clusterdir
-00015280: 293a 0a20 2020 2020 2020 2020 2020 2070  ):.            p
-00015290: 7072 696e 7428 6622 4465 6c65 7469 6e67  print(f"Deleting
-000152a0: 2064 6972 6563 746f 7279 207b 636c 7573   directory {clus
-000152b0: 7465 7264 6972 7d22 290a 2020 2020 2020  terdir}").      
-000152c0: 2020 2020 2020 726d 7472 6565 2863 6c75        rmtree(clu
-000152d0: 7374 6572 6469 722c 2069 676e 6f72 655f  sterdir, ignore_
-000152e0: 6572 726f 7273 3d54 7275 6529 0a20 2020  errors=True).   
-000152f0: 2020 2020 2069 6620 636f 6e74 6169 6e65       if containe
-00015300: 723a 0a20 2020 2020 2020 2020 2020 2063  r:.            c
-00015310: 6f6e 7420 3d20 4b63 6f6e 7461 696e 6572  ont = Kcontainer
-00015320: 636f 6e66 6967 2873 656c 662c 2063 6c69  config(self, cli
-00015330: 656e 743d 7365 6c66 2e63 6f6e 7461 696e  ent=self.contain
-00015340: 6572 636c 6965 6e74 292e 636f 6e74 0a20  erclient).cont. 
-00015350: 2020 2020 2020 2020 2020 2066 6f72 2063             for c
-00015360: 6f6e 7461 2069 6e20 736f 7274 6564 2863  onta in sorted(c
-00015370: 6f6e 742e 6c69 7374 5f63 6f6e 7461 696e  ont.list_contain
-00015380: 6572 7328 6b29 293a 0a20 2020 2020 2020  ers(k)):.       
-00015390: 2020 2020 2020 2020 206e 616d 6520 3d20           name = 
-000153a0: 636f 6e74 615b 305d 0a20 2020 2020 2020  conta[0].       
-000153b0: 2020 2020 2020 2020 2063 6f6e 7461 696e           contain
-000153c0: 6572 5f70 6c61 6e20 3d20 636f 6e74 615b  er_plan = conta[
-000153d0: 335d 0a20 2020 2020 2020 2020 2020 2020  3].             
-000153e0: 2020 2069 6620 636f 6e74 6169 6e65 725f     if container_
-000153f0: 706c 616e 203d 3d20 706c 616e 3a0a 2020  plan == plan:.  
-00015400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015410: 2020 636f 6e74 2e64 656c 6574 655f 636f    cont.delete_co
-00015420: 6e74 6169 6e65 7228 6e61 6d65 290a 2020  ntainer(name).  
-00015430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015440: 2020 7375 6363 6573 7328 6622 436f 6e74    success(f"Cont
-00015450: 6169 6e65 7220 7b6e 616d 657d 2064 656c  ainer {name} del
-00015460: 6574 6564 2122 290a 2020 2020 2020 2020  eted!").        
-00015470: 2020 2020 2020 2020 2020 2020 666f 756e              foun
-00015480: 6420 3d20 5472 7565 0a20 2020 2020 2020  d = True.       
-00015490: 2069 6620 6e6f 7420 7365 6c66 2e6b 6565   if not self.kee
-000154a0: 705f 6e65 7477 6f72 6b73 3a0a 2020 2020  p_networks:.    
-000154b0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-000154c0: 7479 7065 203d 3d20 276b 766d 273a 0a20  type == 'kvm':. 
-000154d0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-000154e0: 6574 776f 726b 7320 3d20 6b2e 6c69 7374  etworks = k.list
-000154f0: 5f6e 6574 776f 726b 7328 290a 2020 2020  _networks().    
-00015500: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00015510: 6e65 7477 6f72 6b20 696e 206b 2e6c 6973  network in k.lis
-00015520: 745f 6e65 7477 6f72 6b73 2829 3a0a 2020  t_networks():.  
-00015530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015540: 2020 6966 2027 706c 616e 2720 696e 206e    if 'plan' in n
-00015550: 6574 776f 726b 735b 6e65 7477 6f72 6b5d  etworks[network]
-00015560: 2061 6e64 206e 6574 776f 726b 735b 6e65   and networks[ne
-00015570: 7477 6f72 6b5d 5b27 706c 616e 275d 203d  twork]['plan'] =
-00015580: 3d20 706c 616e 3a0a 2020 2020 2020 2020  = plan:.        
-00015590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000155a0: 6e65 7477 6f72 6b72 6573 756c 7420 3d20  networkresult = 
-000155b0: 6b2e 6465 6c65 7465 5f6e 6574 776f 726b  k.delete_network
-000155c0: 286e 6574 776f 726b 290a 2020 2020 2020  (network).      
-000155d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000155e0: 2020 6966 206e 6574 776f 726b 7265 7375    if networkresu
-000155f0: 6c74 5b27 7265 7375 6c74 275d 203d 3d20  lt['result'] == 
-00015600: 2773 7563 6365 7373 273a 0a20 2020 2020  'success':.     
-00015610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015620: 2020 2020 2020 2073 7563 6365 7373 2866         success(f
-00015630: 226e 6574 776f 726b 207b 6e65 7477 6f72  "network {networ
-00015640: 6b7d 2064 656c 6574 6564 2122 290a 2020  k} deleted!").  
-00015650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015660: 2020 2020 2020 2020 2020 666f 756e 6420            found 
-00015670: 3d20 5472 7565 0a20 2020 2020 2020 2020  = True.         
-00015680: 2020 2065 6c69 6620 6e65 7477 6f72 6b73     elif networks
-00015690: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000156a0: 2020 666f 756e 6420 3d20 5472 7565 0a20    found = True. 
-000156b0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-000156c0: 6f72 206e 6574 776f 726b 2069 6e20 6e65  or network in ne
-000156d0: 7477 6f72 6b73 3a0a 2020 2020 2020 2020  tworks:.        
-000156e0: 2020 2020 2020 2020 2020 2020 6e65 7477              netw
-000156f0: 6f72 6b72 6573 756c 7420 3d20 6b2e 6465  orkresult = k.de
-00015700: 6c65 7465 5f6e 6574 776f 726b 286e 6574  lete_network(net
-00015710: 776f 726b 290a 2020 2020 2020 2020 2020  work).          
-00015720: 2020 2020 2020 2020 2020 6966 206e 6574            if net
-00015730: 776f 726b 7265 7375 6c74 5b27 7265 7375  workresult['resu
-00015740: 6c74 275d 203d 3d20 2773 7563 6365 7373  lt'] == 'success
-00015750: 273a 0a20 2020 2020 2020 2020 2020 2020  ':.             
-00015760: 2020 2020 2020 2020 2020 2073 7563 6365             succe
-00015770: 7373 2866 2255 6e75 7365 6420 6e65 7477  ss(f"Unused netw
-00015780: 6f72 6b20 7b6e 6574 776f 726b 7d20 6465  ork {network} de
-00015790: 6c65 7465 6421 2229 0a20 2020 2020 2020  leted!").       
-000157a0: 2066 6f72 206b 6579 6669 6c65 2069 6e20   for keyfile in 
-000157b0: 676c 6f62 2e67 6c6f 6228 2225 732e 6b65  glob.glob("%s.ke
-000157c0: 792a 2220 2520 706c 616e 293a 0a20 2020  y*" % plan):.   
-000157d0: 2020 2020 2020 2020 2073 7563 6365 7373           success
-000157e0: 2866 2266 696c 6520 7b6b 6579 6669 6c65  (f"file {keyfile
-000157f0: 7d20 6672 6f6d 207b 706c 616e 7d20 6465  } from {plan} de
-00015800: 6c65 7465 6421 2229 0a20 2020 2020 2020  leted!").       
-00015810: 2020 2020 206f 732e 7265 6d6f 7665 286b       os.remove(k
-00015820: 6579 6669 6c65 290a 2020 2020 2020 2020  eyfile).        
-00015830: 666f 7220 616e 7369 626c 6566 696c 6520  for ansiblefile 
-00015840: 696e 2067 6c6f 622e 676c 6f62 2822 2f74  in glob.glob("/t
-00015850: 6d70 2f25 732a 696e 762a 2220 2520 706c  mp/%s*inv*" % pl
-00015860: 616e 293a 0a20 2020 2020 2020 2020 2020  an):.           
-00015870: 2073 7563 6365 7373 2866 2266 696c 6520   success(f"file 
-00015880: 7b61 6e73 6962 6c65 6669 6c65 7d20 6672  {ansiblefile} fr
-00015890: 6f6d 207b 706c 616e 7d20 6465 6c65 7465  om {plan} delete
-000158a0: 6421 2229 0a20 2020 2020 2020 2020 2020  d!").           
-000158b0: 206f 732e 7265 6d6f 7665 2861 6e73 6962   os.remove(ansib
-000158c0: 6c65 6669 6c65 290a 2020 2020 2020 2020  lefile).        
-000158d0: 6966 2064 656c 6574 6564 6c62 7320 616e  if deletedlbs an
-000158e0: 6420 7365 6c66 2e74 7970 6520 696e 205b  d self.type in [
-000158f0: 2761 7773 272c 2027 6763 7027 5d3a 0a20  'aws', 'gcp']:. 
-00015900: 2020 2020 2020 2020 2020 2066 6f72 206c             for l
-00015910: 6220 696e 2064 656c 6574 6564 6c62 733a  b in deletedlbs:
-00015920: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015930: 2073 656c 662e 6465 6c65 7465 5f6c 6f61   self.delete_loa
-00015940: 6462 616c 616e 6365 7228 6c62 290a 2020  dbalancer(lb).  
-00015950: 2020 2020 2020 6966 2066 6f75 6e64 3a0a        if found:.
-00015960: 2020 2020 2020 2020 2020 2020 7375 6363              succ
-00015970: 6573 7328 6622 506c 616e 207b 706c 616e  ess(f"Plan {plan
-00015980: 7d20 6465 6c65 7465 6421 2229 0a20 2020  } deleted!").   
-00015990: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-000159a0: 7b27 7265 7375 6c74 273a 2027 7375 6363  {'result': 'succ
-000159b0: 6573 7327 2c20 2764 656c 6574 6564 766d  ess', 'deletedvm
-000159c0: 273a 2064 656c 6574 6564 766d 737d 0a20  ': deletedvms}. 
-000159d0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-000159e0: 2020 2020 2020 2020 2065 7272 6f72 2866           error(f
-000159f0: 224e 6f20 6f62 6a65 6374 7320 666f 756e  "No objects foun
-00015a00: 6420 6475 7269 6e67 2064 656c 6574 696f  d during deletio
-00015a10: 6e20 6f66 2070 6c61 6e20 7b70 6c61 6e7d  n of plan {plan}
-00015a20: 2229 0a20 2020 2020 2020 2020 2020 2072  ").            r
-00015a30: 6574 7572 6e20 7b27 7265 7375 6c74 273a  eturn {'result':
-00015a40: 2027 6661 696c 7572 6527 7d0a 0a20 2020   'failure'}..   
-00015a50: 2064 6566 2073 6e61 7073 686f 745f 706c   def snapshot_pl
-00015a60: 616e 2873 656c 662c 2070 6c61 6e2c 2073  an(self, plan, s
-00015a70: 6e61 7073 686f 746e 616d 653d 4e6f 6e65  napshotname=None
-00015a80: 293a 0a20 2020 2020 2020 206b 203d 2073  ):.        k = s
-00015a90: 656c 662e 6b0a 2020 2020 2020 2020 736e  elf.k.        sn
-00015aa0: 6170 7368 6f74 666f 756e 6420 3d20 4661  apshotfound = Fa
-00015ab0: 6c73 650a 2020 2020 2020 2020 7070 7269  lse.        ppri
-00015ac0: 6e74 2866 2253 6e61 7073 686f 7474 696e  nt(f"Snapshottin
-00015ad0: 6720 766d 7320 6672 6f6d 2070 6c61 6e20  g vms from plan 
-00015ae0: 7b70 6c61 6e7d 2229 0a20 2020 2020 2020  {plan}").       
-00015af0: 2069 6620 736e 6170 7368 6f74 6e61 6d65   if snapshotname
-00015b00: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-00015b10: 2020 2020 2020 7761 726e 696e 6728 6622        warning(f"
-00015b20: 5573 696e 6720 7b70 6c61 6e7d 2061 7320  Using {plan} as 
-00015b30: 736e 6170 7368 6f74 206e 616d 6520 6173  snapshot name as
-00015b40: 204e 6f6e 6520 7761 7320 7072 6f76 6964   None was provid
-00015b50: 6564 2229 0a20 2020 2020 2020 2020 2020  ed").           
-00015b60: 2073 6e61 7073 686f 746e 616d 6520 3d20   snapshotname = 
-00015b70: 706c 616e 0a20 2020 2020 2020 2066 6f72  plan.        for
-00015b80: 2076 6d20 696e 2073 6f72 7465 6428 6b2e   vm in sorted(k.
-00015b90: 6c69 7374 2829 2c20 6b65 793d 6c61 6d62  list(), key=lamb
-00015ba0: 6461 2078 3a20 785b 276e 616d 6527 5d29  da x: x['name'])
-00015bb0: 3a0a 2020 2020 2020 2020 2020 2020 6e61  :.            na
-00015bc0: 6d65 203d 2076 6d5b 276e 616d 6527 5d0a  me = vm['name'].
-00015bd0: 2020 2020 2020 2020 2020 2020 6465 7363              desc
-00015be0: 7269 7074 696f 6e20 3d20 766d 5b27 706c  ription = vm['pl
-00015bf0: 616e 275d 0a20 2020 2020 2020 2020 2020  an'].           
-00015c00: 2069 6620 6465 7363 7269 7074 696f 6e20   if description 
-00015c10: 3d3d 2070 6c61 6e3a 0a20 2020 2020 2020  == plan:.       
-00015c20: 2020 2020 2020 2020 2073 6e61 7073 686f           snapsho
-00015c30: 7466 6f75 6e64 203d 2054 7275 650a 2020  tfound = True.  
-00015c40: 2020 2020 2020 2020 2020 2020 2020 6b2e                k.
-00015c50: 6372 6561 7465 5f73 6e61 7073 686f 7428  create_snapshot(
-00015c60: 736e 6170 7368 6f74 6e61 6d65 2c20 6e61  snapshotname, na
-00015c70: 6d65 290a 2020 2020 2020 2020 2020 2020  me).            
-00015c80: 2020 2020 7375 6363 6573 7328 6622 7b6e      success(f"{n
-00015c90: 616d 657d 2073 6e61 7073 686f 7474 6564  ame} snapshotted
-00015ca0: 2122 290a 2020 2020 2020 2020 6966 2073  !").        if s
-00015cb0: 6e61 7073 686f 7466 6f75 6e64 3a0a 2020  napshotfound:.  
-00015cc0: 2020 2020 2020 2020 2020 7375 6363 6573            succes
-00015cd0: 7328 6622 506c 616e 207b 706c 616e 7d20  s(f"Plan {plan} 
-00015ce0: 736e 6170 7368 6f74 7465 6421 2229 0a20  snapshotted!"). 
-00015cf0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00015d00: 2020 2020 2020 2020 2077 6172 6e69 6e67           warning
-00015d10: 2822 4e6f 206d 6174 6368 696e 6720 766d  ("No matching vm
-00015d20: 7320 666f 756e 6422 290a 2020 2020 2020  s found").      
-00015d30: 2020 7265 7475 726e 207b 2772 6573 756c    return {'resul
-00015d40: 7427 3a20 2773 7563 6365 7373 277d 0a0a  t': 'success'}..
-00015d50: 2020 2020 6465 6620 7265 7665 7274 5f70      def revert_p
-00015d60: 6c61 6e28 7365 6c66 2c20 706c 616e 2c20  lan(self, plan, 
-00015d70: 736e 6170 7368 6f74 6e61 6d65 3d4e 6f6e  snapshotname=Non
-00015d80: 6529 3a0a 2020 2020 2020 2020 6b20 3d20  e):.        k = 
-00015d90: 7365 6c66 2e6b 0a20 2020 2020 2020 2072  self.k.        r
-00015da0: 6576 6572 7466 6f75 6e64 203d 2046 616c  evertfound = Fal
-00015db0: 7365 0a20 2020 2020 2020 2070 7072 696e  se.        pprin
-00015dc0: 7428 6622 5265 7665 7274 696e 6720 736e  t(f"Reverting sn
-00015dd0: 6170 7368 6f74 7320 6f66 2076 6d73 2066  apshots of vms f
-00015de0: 726f 6d20 706c 616e 207b 706c 616e 7d22  rom plan {plan}"
-00015df0: 290a 2020 2020 2020 2020 6966 2073 6e61  ).        if sna
-00015e00: 7073 686f 746e 616d 6520 6973 204e 6f6e  pshotname is Non
-00015e10: 653a 0a20 2020 2020 2020 2020 2020 2077  e:.            w
-00015e20: 6172 6e69 6e67 2866 2255 7369 6e67 207b  arning(f"Using {
-00015e30: 706c 616e 7dc2 a061 7320 736e 6170 7368  plan}..as snapsh
-00015e40: 6f74 206e 616d 6520 6173 204e 6f6e 6520  ot name as None 
-00015e50: 7761 7320 7072 6f76 6964 6564 2229 0a20  was provided"). 
-00015e60: 2020 2020 2020 2020 2020 2073 6e61 7073             snaps
-00015e70: 686f 746e 616d 6520 3d20 706c 616e 0a20  hotname = plan. 
-00015e80: 2020 2020 2020 2066 6f72 2076 6d20 696e         for vm in
-00015e90: 2073 6f72 7465 6428 6b2e 6c69 7374 2829   sorted(k.list()
-00015ea0: 2c20 6b65 793d 6c61 6d62 6461 2078 3a20  , key=lambda x: 
-00015eb0: 785b 276e 616d 6527 5d29 3a0a 2020 2020  x['name']):.    
-00015ec0: 2020 2020 2020 2020 6e61 6d65 203d 2076          name = v
-00015ed0: 6d5b 276e 616d 6527 5d0a 2020 2020 2020  m['name'].      
-00015ee0: 2020 2020 2020 6465 7363 7269 7074 696f        descriptio
-00015ef0: 6e20 3d20 766d 5b27 706c 616e 275d 0a20  n = vm['plan']. 
-00015f00: 2020 2020 2020 2020 2020 2069 6620 6465             if de
-00015f10: 7363 7269 7074 696f 6e20 3d3d 2070 6c61  scription == pla
-00015f20: 6e3a 0a20 2020 2020 2020 2020 2020 2020  n:.             
-00015f30: 2020 2072 6576 6572 7466 6f75 6e64 203d     revertfound =
-00015f40: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
-00015f50: 2020 2020 2020 6b2e 7265 7665 7274 5f73        k.revert_s
-00015f60: 6e61 7073 686f 7428 736e 6170 7368 6f74  napshot(snapshot
-00015f70: 6e61 6d65 2c20 6e61 6d65 290a 2020 2020  name, name).    
-00015f80: 2020 2020 2020 2020 2020 2020 7375 6363              succ
-00015f90: 6573 7328 6622 736e 6170 7368 6f74 206f  ess(f"snapshot o
-00015fa0: 6620 7b6e 616d 657d 2072 6576 6572 7465  f {name} reverte
-00015fb0: 6421 2229 0a20 2020 2020 2020 2069 6620  d!").        if 
-00015fc0: 7265 7665 7274 666f 756e 643a 0a20 2020  revertfound:.   
-00015fd0: 2020 2020 2020 2020 2073 7563 6365 7373           success
-00015fe0: 2866 2250 6c61 6e20 7b70 6c61 6e7d 2072  (f"Plan {plan} r
-00015ff0: 6576 6572 7465 6420 7769 7468 2073 6e61  everted with sna
-00016000: 7073 686f 7420 7b73 6e61 7073 686f 746e  pshot {snapshotn
-00016010: 616d 657d 2122 290a 2020 2020 2020 2020  ame}!").        
-00016020: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00016030: 2020 7761 726e 696e 6728 224e 6f20 6d61    warning("No ma
-00016040: 7463 6869 6e67 2076 6d73 2066 6f75 6e64  tching vms found
-00016050: 2229 0a20 2020 2020 2020 2072 6574 7572  ").        retur
-00016060: 6e20 7b27 7265 7375 6c74 273a 2027 7375  n {'result': 'su
-00016070: 6363 6573 7327 7d0a 0a20 2020 2064 6566  ccess'}..    def
-00016080: 2070 6c61 6e28 7365 6c66 2c20 706c 616e   plan(self, plan
-00016090: 2c20 616e 7369 626c 653d 4661 6c73 652c  , ansible=False,
-000160a0: 2075 726c 3d4e 6f6e 652c 2070 6174 683d   url=None, path=
-000160b0: 4e6f 6e65 2c20 636f 6e74 6169 6e65 723d  None, container=
-000160c0: 4661 6c73 652c 2069 6e70 7574 6669 6c65  False, inputfile
-000160d0: 3d4e 6f6e 652c 2069 6e70 7574 7374 7269  =None, inputstri
-000160e0: 6e67 3d4e 6f6e 652c 0a20 2020 2020 2020  ng=None,.       
-000160f0: 2020 2020 2020 6f76 6572 7269 6465 733d        overrides=
-00016100: 7b7d 2c20 696e 666f 3d46 616c 7365 2c20  {}, info=False, 
-00016110: 7570 6461 7465 3d46 616c 7365 2c20 656d  update=False, em
-00016120: 6265 6464 6564 3d46 616c 7365 2c20 646f  bedded=False, do
-00016130: 776e 6c6f 6164 3d46 616c 7365 2c20 7175  wnload=False, qu
-00016140: 6965 743d 4661 6c73 652c 2064 6f63 3d46  iet=False, doc=F
-00016150: 616c 7365 2c0a 2020 2020 2020 2020 2020  alse,.          
-00016160: 2020 206f 6e6c 7961 7373 6574 733d 4661     onlyassets=Fa
-00016170: 6c73 652c 2070 7265 3d54 7275 652c 2070  lse, pre=True, p
-00016180: 6f73 743d 5472 7565 2c20 6578 636c 7564  ost=True, exclud
-00016190: 6576 6d73 3d5b 5d2c 2062 6173 656d 6f64  evms=[], basemod
-000161a0: 653d 4661 6c73 652c 2074 6872 6561 6465  e=False, threade
-000161b0: 643d 4661 6c73 6529 3a0a 2020 2020 2020  d=False):.      
-000161c0: 2020 2222 224d 616e 6167 6520 706c 616e    """Manage plan
-000161d0: 2066 696c 6522 2222 0a20 2020 2020 2020   file""".       
-000161e0: 206b 203d 2073 656c 662e 6b0a 2020 2020   k = self.k.    
-000161f0: 2020 2020 6e6f 5f6f 7665 7272 6964 6573      no_overrides
-00016200: 203d 206e 6f74 206f 7665 7272 6964 6573   = not overrides
-00016210: 0a20 2020 2020 2020 2074 6872 6561 6473  .        threads
-00016220: 203d 205b 5d0a 2020 2020 2020 2020 6e65   = [].        ne
-00016230: 7776 6d73 203d 205b 5d0a 2020 2020 2020  wvms = [].      
-00016240: 2020 6e65 7761 7373 6574 7320 3d20 5b5d    newassets = []
-00016250: 0a20 2020 2020 2020 2066 6169 6c65 6476  .        failedv
-00016260: 6d73 203d 205b 5d0a 2020 2020 2020 2020  ms = [].        
-00016270: 6578 6973 7469 6e67 766d 7320 3d20 5b5d  existingvms = []
-00016280: 0a20 2020 2020 2020 2061 7379 6e63 7761  .        asyncwa
-00016290: 6974 766d 7320 3d20 5b5d 0a20 2020 2020  itvms = [].     
-000162a0: 2020 206f 6e66 6c79 203d 204e 6f6e 650a     onfly = None.
-000162b0: 2020 2020 2020 2020 746f 636c 6561 6e20          toclean 
-000162c0: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
-000162d0: 6765 7462 6163 6b20 3d20 4661 6c73 650a  getback = False.
-000162e0: 2020 2020 2020 2020 766d 7072 6f66 696c          vmprofil
-000162f0: 6573 203d 207b 6b65 793a 2076 616c 7565  es = {key: value
-00016300: 2066 6f72 206b 6579 2c20 7661 6c75 6520   for key, value 
-00016310: 696e 2073 656c 662e 7072 6f66 696c 6573  in self.profiles
-00016320: 2e69 7465 6d73 2829 0a20 2020 2020 2020  .items().       
-00016330: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00016340: 6620 2774 7970 6527 206e 6f74 2069 6e20  f 'type' not in 
-00016350: 7661 6c75 6520 6f72 2076 616c 7565 5b27  value or value['
-00016360: 7479 7065 275d 203d 3d20 2776 6d27 7d0a  type'] == 'vm'}.
-00016370: 2020 2020 2020 2020 636f 6e74 6169 6e65          containe
-00016380: 7270 726f 6669 6c65 7320 3d20 7b6b 6579  rprofiles = {key
-00016390: 3a20 7661 6c75 6520 666f 7220 6b65 792c  : value for key,
-000163a0: 2076 616c 7565 2069 6e20 7365 6c66 2e70   value in self.p
-000163b0: 726f 6669 6c65 732e 6974 656d 7328 290a  rofiles.items().
-000163c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000163d0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-000163e0: 2774 7970 6527 2069 6e20 7661 6c75 6520  'type' in value 
-000163f0: 616e 6420 7661 6c75 655b 2774 7970 6527  and value['type'
-00016400: 5d20 3d3d 2027 636f 6e74 6169 6e65 7227  ] == 'container'
-00016410: 7d0a 2020 2020 2020 2020 6966 2070 6c61  }.        if pla
-00016420: 6e20 6973 204e 6f6e 653a 0a20 2020 2020  n is None:.     
-00016430: 2020 2020 2020 2070 6c61 6e20 3d20 6e61         plan = na
-00016440: 6d65 7574 696c 732e 6765 745f 7261 6e64  meutils.get_rand
-00016450: 6f6d 5f6e 616d 6528 290a 2020 2020 2020  om_name().      
-00016460: 2020 6966 2075 726c 2069 7320 6e6f 7420    if url is not 
-00016470: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00016480: 2020 6966 2075 726c 2e73 7461 7274 7377    if url.startsw
-00016490: 6974 6828 272f 2729 3a0a 2020 2020 2020  ith('/'):.      
-000164a0: 2020 2020 2020 2020 2020 7572 6c20 3d20            url = 
-000164b0: 6622 6669 6c65 3a2f 2f7b 7572 6c7d 220a  f"file://{url}".
-000164c0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-000164d0: 6f74 2075 726c 2e65 6e64 7377 6974 6828  ot url.endswith(
-000164e0: 272e 796d 6c27 293a 0a20 2020 2020 2020  '.yml'):.       
-000164f0: 2020 2020 2020 2020 2075 726c 203d 2066           url = f
-00016500: 227b 7572 6c7d 2f6b 636c 695f 706c 616e  "{url}/kcli_plan
-00016510: 2e79 6d6c 220a 2020 2020 2020 2020 2020  .yml".          
-00016520: 2020 2020 2020 7070 7269 6e74 2866 2254        pprint(f"T
-00016530: 7279 696e 6720 746f 2072 6574 7269 6576  rying to retriev
-00016540: 6520 7b75 726c 7d22 290a 2020 2020 2020  e {url}").      
-00016550: 2020 2020 2020 696e 7075 7466 696c 6520        inputfile 
-00016560: 3d20 6f73 2e70 6174 682e 6261 7365 6e61  = os.path.basena
-00016570: 6d65 2875 726c 290a 2020 2020 2020 2020  me(url).        
-00016580: 2020 2020 6f6e 666c 7920 3d20 6f73 2e70      onfly = os.p
-00016590: 6174 682e 6469 726e 616d 6528 7572 6c29  ath.dirname(url)
-000165a0: 0a20 2020 2020 2020 2020 2020 2070 6174  .            pat
-000165b0: 6820 3d20 706c 616e 2069 6620 7061 7468  h = plan if path
-000165c0: 2069 7320 4e6f 6e65 2065 6c73 6520 7061   is None else pa
-000165d0: 7468 0a20 2020 2020 2020 2020 2020 2069  th.            i
-000165e0: 6620 6e6f 7420 7175 6965 743a 0a20 2020  f not quiet:.   
-000165f0: 2020 2020 2020 2020 2020 2020 2070 7072               ppr
-00016600: 696e 7428 6622 5265 7472 6965 7669 6e67  int(f"Retrieving
-00016610: 2073 7065 6369 6669 6564 2070 6c61 6e20   specified plan 
-00016620: 6672 6f6d 207b 7572 6c7d 2074 6f20 7b70  from {url} to {p
-00016630: 6174 687d 2229 0a20 2020 2020 2020 2020  ath}").         
-00016640: 2020 2069 6620 636f 6e74 6169 6e65 725f     if container_
-00016650: 6d6f 6465 2829 3a0a 2020 2020 2020 2020  mode():.        
-00016660: 2020 2020 2020 2020 7061 7468 203d 2066          path = f
-00016670: 222f 776f 726b 6469 722f 7b70 6174 687d  "/workdir/{path}
-00016680: 220a 2020 2020 2020 2020 2020 2020 6966  ".            if
-00016690: 206e 6f74 206f 732e 7061 7468 2e65 7869   not os.path.exi
-000166a0: 7374 7328 7061 7468 293a 0a20 2020 2020  sts(path):.     
-000166b0: 2020 2020 2020 2020 2020 2074 6f63 6c65             tocle
-000166c0: 616e 203d 2054 7275 650a 2020 2020 2020  an = True.      
-000166d0: 2020 2020 2020 2020 2020 636f 6d6d 6f6e            common
-000166e0: 2e66 6574 6368 2875 726c 2c20 7061 7468  .fetch(url, path
-000166f0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00016700: 2020 666f 7220 6465 6661 756c 745f 7061    for default_pa
-00016710: 7261 6d65 7465 725f 6669 6c65 2069 6e20  rameter_file in 
-00016720: 5b27 2f6b 636c 695f 6465 6661 756c 742e  ['/kcli_default.
-00016730: 796d 6c27 2c20 6627 2f7b 706c 616e 7d5f  yml', f'/{plan}_
-00016740: 6465 6661 756c 742e 796d 6c27 2c0a 2020  default.yml',.  
-00016750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016770: 2020 2020 2020 2020 2020 2020 2022 2f25               "/%
-00016780: 735f 6465 6661 756c 7425 7322 2025 206f  s_default%s" % o
-00016790: 732e 7061 7468 2e73 706c 6974 6578 7428  s.path.splitext(
-000167a0: 6f73 2e70 6174 682e 6261 7365 6e61 6d65  os.path.basename
-000167b0: 2875 726c 2929 5d3a 0a20 2020 2020 2020  (url))]:.       
-000167c0: 2020 2020 2020 2020 2020 2020 2074 7279               try
-000167d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000167e0: 2020 2020 2020 2020 2020 636f 6d6d 6f6e            common
-000167f0: 2e66 6574 6368 286f 732e 7061 7468 2e64  .fetch(os.path.d
-00016800: 6972 6e61 6d65 2875 726c 2920 2b20 6465  irname(url) + de
-00016810: 6661 756c 745f 7061 7261 6d65 7465 725f  fault_parameter_
-00016820: 6669 6c65 2c20 7061 7468 290a 2020 2020  file, path).    
-00016830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016840: 6578 6365 7074 3a0a 2020 2020 2020 2020  except:.        
-00016850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016860: 7061 7373 0a20 2020 2020 2020 2020 2020  pass.           
-00016870: 2065 6c69 6620 646f 776e 6c6f 6164 3a0a   elif download:.
-00016880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016890: 6d73 6720 3d20 6622 7461 7267 6574 2064  msg = f"target d
-000168a0: 6972 6563 746f 7279 207b 7061 7468 7d20  irectory {path} 
-000168b0: 616c 7265 6164 7920 7468 6572 6522 0a20  already there". 
-000168c0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-000168d0: 7272 6f72 286d 7367 290a 2020 2020 2020  rror(msg).      
-000168e0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-000168f0: 207b 2772 6573 756c 7427 3a20 2766 6169   {'result': 'fai
-00016900: 6c75 7265 272c 2027 7265 6173 6f6e 273a  lure', 'reason':
-00016910: 206d 7367 7d0a 2020 2020 2020 2020 2020   msg}.          
-00016920: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00016930: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
-00016940: 2255 7369 6e67 2065 7869 7374 696e 6720  "Using existing 
-00016950: 6469 7265 6374 6f72 7920 7b70 6174 687d  directory {path}
-00016960: 2229 0a20 2020 2020 2020 2020 2020 2069  ").            i
-00016970: 6620 646f 776e 6c6f 6164 3a0a 2020 2020  f download:.    
-00016980: 2020 2020 2020 2020 2020 2020 696e 7075              inpu
-00016990: 7466 696c 6520 3d20 6622 7b70 6174 687d  tfile = f"{path}
-000169a0: 2f7b 696e 7075 7466 696c 657d 220a 2020  /{inputfile}".  
-000169b0: 2020 2020 2020 2020 2020 2020 2020 656e                en
-000169c0: 7472 6965 732c 206f 7665 7272 6964 6573  tries, overrides
-000169d0: 2c20 6261 7365 6669 6c65 2c20 6261 7365  , basefile, base
-000169e0: 6469 7220 3d20 7365 6c66 2e70 726f 6365  dir = self.proce
-000169f0: 7373 5f69 6e70 7574 6669 6c65 2870 6c61  ss_inputfile(pla
-00016a00: 6e2c 2069 6e70 7574 6669 6c65 2c20 6f76  n, inputfile, ov
-00016a10: 6572 7269 6465 733d 6f76 6572 7269 6465  errides=override
-00016a20: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
-00016a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014a20: 2020 2020 2020 2020 2020 2020 2020 676b                gk
+00014a30: 6520 3d20 6b75 6265 7479 7065 203d 3d20  e = kubetype == 
+00014a40: 2767 6b65 270a 2020 2020 2020 2020 2020  'gke'.          
+00014a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014a60: 2020 2020 2020 2020 2020 656b 7320 3d20            eks = 
+00014a70: 6b75 6265 7479 7065 203d 3d20 2765 6b73  kubetype == 'eks
+00014a80: 270a 2020 2020 2020 2020 6966 2068 7970  '.        if hyp
+00014a90: 6572 7368 6966 743a 0a20 2020 2020 2020  ershift:.       
+00014aa0: 2020 2020 206b 7562 6563 6f6e 6669 676d       kubeconfigm
+00014ab0: 676d 7420 3d20 6622 7b63 6c75 7374 6572  gmt = f"{cluster
+00014ac0: 6469 727d 2f6b 7562 6563 6f6e 6669 672e  dir}/kubeconfig.
+00014ad0: 6d67 6d74 220a 2020 2020 2020 2020 2020  mgmt".          
+00014ae0: 2020 6361 6c6c 2866 274b 5542 4543 4f4e    call(f'KUBECON
+00014af0: 4649 473d 7b6b 7562 6563 6f6e 6669 676d  FIG={kubeconfigm
+00014b00: 676d 747d 206f 6320 6465 6c65 7465 202d  gmt} oc delete -
+00014b10: 6620 7b63 6c75 7374 6572 6469 727d 2f61  f {clusterdir}/a
+00014b20: 7574 6f61 7070 726f 7665 7263 726f 6e2e  utoapprovercron.
+00014b30: 796d 6c27 2c20 7368 656c 6c3d 5472 7565  yml', shell=True
+00014b40: 290a 2020 2020 2020 2020 2020 2020 6361  ).            ca
+00014b50: 6c6c 2866 274b 5542 4543 4f4e 4649 473d  ll(f'KUBECONFIG=
+00014b60: 7b6b 7562 6563 6f6e 6669 676d 676d 747d  {kubeconfigmgmt}
+00014b70: 206f 6320 6465 6c65 7465 202d 6620 7b63   oc delete -f {c
+00014b80: 6c75 7374 6572 6469 727d 2f6e 6f64 6570  lusterdir}/nodep
+00014b90: 6f6f 6c2e 7961 6d6c 272c 2073 6865 6c6c  ool.yaml', shell
+00014ba0: 3d54 7275 6529 0a20 2020 2020 2020 2020  =True).         
+00014bb0: 2020 2063 616c 6c28 6627 4b55 4245 434f     call(f'KUBECO
+00014bc0: 4e46 4947 3d7b 6b75 6265 636f 6e66 6967  NFIG={kubeconfig
+00014bd0: 6d67 6d74 7d20 6f63 2064 656c 6574 6520  mgmt} oc delete 
+00014be0: 2d66 207b 636c 7573 7465 7264 6972 7d2f  -f {clusterdir}/
+00014bf0: 686f 7374 6564 636c 7573 7465 722e 7961  hostedcluster.ya
+00014c00: 6d6c 272c 2073 6865 6c6c 3d54 7275 6529  ml', shell=True)
+00014c10: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00014c20: 6e6f 7420 6173 7369 7374 6564 2061 6e64  not assisted and
+00014c30: 2028 2762 6172 656d 6574 616c 5f69 736f   ('baremetal_iso
+00014c40: 2720 696e 2063 6c75 7374 6572 6461 7461  ' in clusterdata
+00014c50: 206f 7220 2762 6172 656d 6574 616c 5f68   or 'baremetal_h
+00014c60: 6f73 7473 2720 696e 2063 6c75 7374 6572  osts' in cluster
+00014c70: 6461 7461 293a 0a20 2020 2020 2020 2020  data):.         
+00014c80: 2020 2020 2020 2063 616c 6c28 274b 5542         call('KUB
+00014c90: 4543 4f4e 4649 473d 7b6b 7562 6563 6f6e  ECONFIG={kubecon
+00014ca0: 6669 676d 676d 747d 206f 6320 2d6e 2064  figmgmt} oc -n d
+00014cb0: 6566 6175 6c74 2064 656c 6574 6520 616c  efault delete al
+00014cc0: 6c20 2d6c 2061 7070 3d68 7474 7064 2d6b  l -l app=httpd-k
+00014cd0: 636c 6927 2c20 7368 656c 6c3d 5472 7565  cli', shell=True
+00014ce0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00014cf0: 2020 6361 6c6c 2827 4b55 4245 434f 4e46    call('KUBECONF
+00014d00: 4947 3d7b 6b75 6265 636f 6e66 6967 6d67  IG={kubeconfigmg
+00014d10: 6d74 7d20 6f63 202d 6e20 6465 6661 756c  mt} oc -n defaul
+00014d20: 7420 6465 6c65 7465 2073 7663 2068 7474  t delete svc htt
+00014d30: 7064 2d6b 636c 692d 7376 6327 2c20 7368  pd-kcli-svc', sh
+00014d40: 656c 6c3d 5472 7565 290a 2020 2020 2020  ell=True).      
+00014d50: 2020 2020 2020 2020 2020 6361 6c6c 2827            call('
+00014d60: 4b55 4245 434f 4e46 4947 3d7b 6b75 6265  KUBECONFIG={kube
+00014d70: 636f 6e66 6967 6d67 6d74 7d20 6f63 202d  configmgmt} oc -
+00014d80: 6e20 6465 6661 756c 7420 6465 6c65 7465  n default delete
+00014d90: 2070 7663 2068 7474 7064 2d6b 636c 692d   pvc httpd-kcli-
+00014da0: 7076 6327 2c20 7368 656c 6c3d 5472 7565  pvc', shell=True
+00014db0: 290a 2020 2020 2020 2020 6966 2067 6b65  ).        if gke
+00014dc0: 3a0a 2020 2020 2020 2020 2020 2020 6763  :.            gc
+00014dd0: 7063 6c69 656e 7420 3d20 4e6f 6e65 0a20  pclient = None. 
+00014de0: 2020 2020 2020 2020 2020 2069 6620 2763             if 'c
+00014df0: 6c69 656e 7427 2069 6e20 636c 7573 7465  lient' in cluste
+00014e00: 7264 6174 613a 0a20 2020 2020 2020 2020  rdata:.         
+00014e10: 2020 2020 2020 2067 6370 636c 6965 6e74         gcpclient
+00014e20: 203d 2063 6c75 7374 6572 6461 7461 5b27   = clusterdata['
+00014e30: 636c 6965 6e74 275d 0a20 2020 2020 2020  client'].       
+00014e40: 2020 2020 2065 6c69 6620 7365 6c66 2e74       elif self.t
+00014e50: 7970 6520 3d3d 2027 676b 6527 3a0a 2020  ype == 'gke':.  
+00014e60: 2020 2020 2020 2020 2020 2020 2020 6763                gc
+00014e70: 7063 6c69 656e 7420 3d20 7365 6c66 2e63  pclient = self.c
+00014e80: 6c69 656e 740a 2020 2020 2020 2020 2020  lient.          
+00014e90: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00014ea0: 2020 2020 2020 2020 7265 7475 726e 207b          return {
+00014eb0: 2772 6573 756c 7427 3a20 2766 6169 6c75  'result': 'failu
+00014ec0: 7265 272c 2027 7265 6173 6f6e 273a 2022  re', 'reason': "
+00014ed0: 4465 6c65 7469 6e67 2067 6b65 2063 6c75  Deleting gke clu
+00014ee0: 7374 6572 2072 6571 7569 7265 7320 746f  ster requires to
+00014ef0: 2069 6e73 7461 6e74 6961 7465 2067 6370   instantiate gcp
+00014f00: 2070 726f 7669 6465 7222 7d0a 2020 2020   provider"}.    
+00014f10: 2020 2020 2020 2020 6672 6f6d 206b 7669          from kvi
+00014f20: 7274 2e63 6c75 7374 6572 2069 6d70 6f72  rt.cluster impor
+00014f30: 7420 676b 650a 2020 2020 2020 2020 2020  t gke.          
+00014f40: 2020 6375 7272 656e 7463 6f6e 6669 6720    currentconfig 
+00014f50: 3d20 4b63 6f6e 6669 6728 636c 6965 6e74  = Kconfig(client
+00014f60: 3d67 6370 636c 6965 6e74 292e 6b20 6966  =gcpclient).k if
+00014f70: 2067 6370 636c 6965 6e74 2021 3d20 7365   gcpclient != se
+00014f80: 6c66 2e63 6c69 656e 7420 656c 7365 2073  lf.client else s
+00014f90: 656c 660a 2020 2020 2020 2020 2020 2020  elf.            
+00014fa0: 7a6f 6e61 6c20 3d20 636c 7573 7465 7264  zonal = clusterd
+00014fb0: 6174 612e 6765 7428 277a 6f6e 616c 272c  ata.get('zonal',
+00014fc0: 2054 7275 6529 0a20 2020 2020 2020 2020   True).         
+00014fd0: 2020 2067 6b65 2e64 656c 6574 6528 6375     gke.delete(cu
+00014fe0: 7272 656e 7463 6f6e 6669 672c 2063 6c75  rrentconfig, clu
+00014ff0: 7374 6572 2c20 7a6f 6e61 6c29 0a20 2020  ster, zonal).   
+00015000: 2020 2020 2065 6c69 6620 656b 733a 0a20       elif eks:. 
+00015010: 2020 2020 2020 2020 2020 2065 6b73 636c             ekscl
+00015020: 6965 6e74 203d 204e 6f6e 650a 2020 2020  ient = None.    
+00015030: 2020 2020 2020 2020 6966 2027 636c 6965          if 'clie
+00015040: 6e74 2720 696e 2063 6c75 7374 6572 6461  nt' in clusterda
+00015050: 7461 3a0a 2020 2020 2020 2020 2020 2020  ta:.            
+00015060: 2020 2020 656b 7363 6c69 656e 7420 3d20      eksclient = 
+00015070: 636c 7573 7465 7264 6174 615b 2763 6c69  clusterdata['cli
+00015080: 656e 7427 5d0a 2020 2020 2020 2020 2020  ent'].          
+00015090: 2020 656c 6966 2073 656c 662e 7479 7065    elif self.type
+000150a0: 203d 3d20 2761 7773 273a 0a20 2020 2020   == 'aws':.     
+000150b0: 2020 2020 2020 2020 2020 2065 6b73 636c             ekscl
+000150c0: 6965 6e74 203d 2073 656c 662e 636c 6965  ient = self.clie
+000150d0: 6e74 0a20 2020 2020 2020 2020 2020 2065  nt.            e
+000150e0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+000150f0: 2020 2020 2072 6574 7572 6e20 7b27 7265       return {'re
+00015100: 7375 6c74 273a 2027 6661 696c 7572 6527  sult': 'failure'
+00015110: 2c20 2772 6561 736f 6e27 3a20 2244 656c  , 'reason': "Del
+00015120: 6574 696e 6720 656b 7320 636c 7573 7465  eting eks cluste
+00015130: 7220 7265 7175 6972 6573 2074 6f20 696e  r requires to in
+00015140: 7374 616e 7469 6174 6520 6763 7020 7072  stantiate gcp pr
+00015150: 6f76 6964 6572 227d 0a20 2020 2020 2020  ovider"}.       
+00015160: 2020 2020 2066 726f 6d20 6b76 6972 742e       from kvirt.
+00015170: 636c 7573 7465 7220 696d 706f 7274 2065  cluster import e
+00015180: 6b73 0a20 2020 2020 2020 2020 2020 2063  ks.            c
+00015190: 7572 7265 6e74 636f 6e66 6967 203d 204b  urrentconfig = K
+000151a0: 636f 6e66 6967 2863 6c69 656e 743d 656b  config(client=ek
+000151b0: 7363 6c69 656e 7429 2e6b 2069 6620 656b  sclient).k if ek
+000151c0: 7363 6c69 656e 7420 213d 2073 656c 662e  sclient != self.
+000151d0: 636c 6965 6e74 2065 6c73 6520 7365 6c66  client else self
+000151e0: 0a20 2020 2020 2020 2020 2020 2065 6b73  .            eks
+000151f0: 2e64 656c 6574 6528 6375 7272 656e 7463  .delete(currentc
+00015200: 6f6e 6669 672c 2063 6c75 7374 6572 290a  onfig, cluster).
+00015210: 2020 2020 2020 2020 6966 206f 732e 7061          if os.pa
+00015220: 7468 2e65 7869 7374 7328 636c 7573 7465  th.exists(cluste
+00015230: 7264 6972 293a 0a20 2020 2020 2020 2020  rdir):.         
+00015240: 2020 2070 7072 696e 7428 6622 4465 6c65     pprint(f"Dele
+00015250: 7469 6e67 2064 6972 6563 746f 7279 207b  ting directory {
+00015260: 636c 7573 7465 7264 6972 7d22 290a 2020  clusterdir}").  
+00015270: 2020 2020 2020 2020 2020 726d 7472 6565            rmtree
+00015280: 2863 6c75 7374 6572 6469 722c 2069 676e  (clusterdir, ign
+00015290: 6f72 655f 6572 726f 7273 3d54 7275 6529  ore_errors=True)
+000152a0: 0a20 2020 2020 2020 2069 6620 636f 6e74  .        if cont
+000152b0: 6169 6e65 723a 0a20 2020 2020 2020 2020  ainer:.         
+000152c0: 2020 2063 6f6e 7420 3d20 4b63 6f6e 7461     cont = Kconta
+000152d0: 696e 6572 636f 6e66 6967 2873 656c 662c  inerconfig(self,
+000152e0: 2063 6c69 656e 743d 7365 6c66 2e63 6f6e   client=self.con
+000152f0: 7461 696e 6572 636c 6965 6e74 292e 636f  tainerclient).co
+00015300: 6e74 0a20 2020 2020 2020 2020 2020 2066  nt.            f
+00015310: 6f72 2063 6f6e 7461 2069 6e20 736f 7274  or conta in sort
+00015320: 6564 2863 6f6e 742e 6c69 7374 5f63 6f6e  ed(cont.list_con
+00015330: 7461 696e 6572 7328 6b29 293a 0a20 2020  tainers(k)):.   
+00015340: 2020 2020 2020 2020 2020 2020 206e 616d               nam
+00015350: 6520 3d20 636f 6e74 615b 305d 0a20 2020  e = conta[0].   
+00015360: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+00015370: 7461 696e 6572 5f70 6c61 6e20 3d20 636f  tainer_plan = co
+00015380: 6e74 615b 335d 0a20 2020 2020 2020 2020  nta[3].         
+00015390: 2020 2020 2020 2069 6620 636f 6e74 6169         if contai
+000153a0: 6e65 725f 706c 616e 203d 3d20 706c 616e  ner_plan == plan
+000153b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000153c0: 2020 2020 2020 636f 6e74 2e64 656c 6574        cont.delet
+000153d0: 655f 636f 6e74 6169 6e65 7228 6e61 6d65  e_container(name
+000153e0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000153f0: 2020 2020 2020 7375 6363 6573 7328 6622        success(f"
+00015400: 436f 6e74 6169 6e65 7220 7b6e 616d 657d  Container {name}
+00015410: 2064 656c 6574 6564 2122 290a 2020 2020   deleted!").    
+00015420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015430: 666f 756e 6420 3d20 5472 7565 0a20 2020  found = True.   
+00015440: 2020 2020 2069 6620 6e6f 7420 7365 6c66       if not self
+00015450: 2e6b 6565 705f 6e65 7477 6f72 6b73 3a0a  .keep_networks:.
+00015460: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+00015470: 656c 662e 7479 7065 203d 3d20 276b 766d  elf.type == 'kvm
+00015480: 273a 0a20 2020 2020 2020 2020 2020 2020  ':.             
+00015490: 2020 206e 6574 776f 726b 7320 3d20 6b2e     networks = k.
+000154a0: 6c69 7374 5f6e 6574 776f 726b 7328 290a  list_networks().
+000154b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000154c0: 666f 7220 6e65 7477 6f72 6b20 696e 206b  for network in k
+000154d0: 2e6c 6973 745f 6e65 7477 6f72 6b73 2829  .list_networks()
+000154e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000154f0: 2020 2020 2020 6966 2027 706c 616e 2720        if 'plan' 
+00015500: 696e 206e 6574 776f 726b 735b 6e65 7477  in networks[netw
+00015510: 6f72 6b5d 2061 6e64 206e 6574 776f 726b  ork] and network
+00015520: 735b 6e65 7477 6f72 6b5d 5b27 706c 616e  s[network]['plan
+00015530: 275d 203d 3d20 706c 616e 3a0a 2020 2020  '] == plan:.    
+00015540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015550: 2020 2020 6e65 7477 6f72 6b72 6573 756c      networkresul
+00015560: 7420 3d20 6b2e 6465 6c65 7465 5f6e 6574  t = k.delete_net
+00015570: 776f 726b 286e 6574 776f 726b 290a 2020  work(network).  
+00015580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015590: 2020 2020 2020 6966 206e 6574 776f 726b        if network
+000155a0: 7265 7375 6c74 5b27 7265 7375 6c74 275d  result['result']
+000155b0: 203d 3d20 2773 7563 6365 7373 273a 0a20   == 'success':. 
+000155c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000155d0: 2020 2020 2020 2020 2020 2073 7563 6365             succe
+000155e0: 7373 2866 226e 6574 776f 726b 207b 6e65  ss(f"network {ne
+000155f0: 7477 6f72 6b7d 2064 656c 6574 6564 2122  twork} deleted!"
+00015600: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00015610: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+00015620: 756e 6420 3d20 5472 7565 0a20 2020 2020  und = True.     
+00015630: 2020 2020 2020 2065 6c69 6620 6e65 7477         elif netw
+00015640: 6f72 6b73 3a0a 2020 2020 2020 2020 2020  orks:.          
+00015650: 2020 2020 2020 666f 756e 6420 3d20 5472        found = Tr
+00015660: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
+00015670: 2020 2066 6f72 206e 6574 776f 726b 2069     for network i
+00015680: 6e20 6e65 7477 6f72 6b73 3a0a 2020 2020  n networks:.    
+00015690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000156a0: 6e65 7477 6f72 6b72 6573 756c 7420 3d20  networkresult = 
+000156b0: 6b2e 6465 6c65 7465 5f6e 6574 776f 726b  k.delete_network
+000156c0: 286e 6574 776f 726b 290a 2020 2020 2020  (network).      
+000156d0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+000156e0: 206e 6574 776f 726b 7265 7375 6c74 5b27   networkresult['
+000156f0: 7265 7375 6c74 275d 203d 3d20 2773 7563  result'] == 'suc
+00015700: 6365 7373 273a 0a20 2020 2020 2020 2020  cess':.         
+00015710: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00015720: 7563 6365 7373 2866 2255 6e75 7365 6420  uccess(f"Unused 
+00015730: 6e65 7477 6f72 6b20 7b6e 6574 776f 726b  network {network
+00015740: 7d20 6465 6c65 7465 6421 2229 0a20 2020  } deleted!").   
+00015750: 2020 2020 2066 6f72 206b 6579 6669 6c65       for keyfile
+00015760: 2069 6e20 676c 6f62 2e67 6c6f 6228 2225   in glob.glob("%
+00015770: 732e 6b65 792a 2220 2520 706c 616e 293a  s.key*" % plan):
+00015780: 0a20 2020 2020 2020 2020 2020 2073 7563  .            suc
+00015790: 6365 7373 2866 2266 696c 6520 7b6b 6579  cess(f"file {key
+000157a0: 6669 6c65 7d20 6672 6f6d 207b 706c 616e  file} from {plan
+000157b0: 7d20 6465 6c65 7465 6421 2229 0a20 2020  } deleted!").   
+000157c0: 2020 2020 2020 2020 206f 732e 7265 6d6f           os.remo
+000157d0: 7665 286b 6579 6669 6c65 290a 2020 2020  ve(keyfile).    
+000157e0: 2020 2020 666f 7220 616e 7369 626c 6566      for ansiblef
+000157f0: 696c 6520 696e 2067 6c6f 622e 676c 6f62  ile in glob.glob
+00015800: 2822 2f74 6d70 2f25 732a 696e 762a 2220  ("/tmp/%s*inv*" 
+00015810: 2520 706c 616e 293a 0a20 2020 2020 2020  % plan):.       
+00015820: 2020 2020 2073 7563 6365 7373 2866 2266       success(f"f
+00015830: 696c 6520 7b61 6e73 6962 6c65 6669 6c65  ile {ansiblefile
+00015840: 7d20 6672 6f6d 207b 706c 616e 7d20 6465  } from {plan} de
+00015850: 6c65 7465 6421 2229 0a20 2020 2020 2020  leted!").       
+00015860: 2020 2020 206f 732e 7265 6d6f 7665 2861       os.remove(a
+00015870: 6e73 6962 6c65 6669 6c65 290a 2020 2020  nsiblefile).    
+00015880: 2020 2020 6966 2064 656c 6574 6564 6c62      if deletedlb
+00015890: 7320 616e 6420 7365 6c66 2e74 7970 6520  s and self.type 
+000158a0: 696e 205b 2761 7773 272c 2027 6763 7027  in ['aws', 'gcp'
+000158b0: 5d3a 0a20 2020 2020 2020 2020 2020 2066  ]:.            f
+000158c0: 6f72 206c 6220 696e 2064 656c 6574 6564  or lb in deleted
+000158d0: 6c62 733a 0a20 2020 2020 2020 2020 2020  lbs:.           
+000158e0: 2020 2020 2073 656c 662e 6465 6c65 7465       self.delete
+000158f0: 5f6c 6f61 6462 616c 616e 6365 7228 6c62  _loadbalancer(lb
+00015900: 290a 2020 2020 2020 2020 6966 2066 6f75  ).        if fou
+00015910: 6e64 3a0a 2020 2020 2020 2020 2020 2020  nd:.            
+00015920: 7375 6363 6573 7328 6622 506c 616e 207b  success(f"Plan {
+00015930: 706c 616e 7d20 6465 6c65 7465 6421 2229  plan} deleted!")
+00015940: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00015950: 7572 6e20 7b27 7265 7375 6c74 273a 2027  urn {'result': '
+00015960: 7375 6363 6573 7327 2c20 2764 656c 6574  success', 'delet
+00015970: 6564 766d 273a 2064 656c 6574 6564 766d  edvm': deletedvm
+00015980: 737d 0a20 2020 2020 2020 2065 6c73 653a  s}.        else:
+00015990: 0a20 2020 2020 2020 2020 2020 2065 7272  .            err
+000159a0: 6f72 2866 224e 6f20 6f62 6a65 6374 7320  or(f"No objects 
+000159b0: 666f 756e 6420 6475 7269 6e67 2064 656c  found during del
+000159c0: 6574 696f 6e20 6f66 2070 6c61 6e20 7b70  etion of plan {p
+000159d0: 6c61 6e7d 2229 0a20 2020 2020 2020 2020  lan}").         
+000159e0: 2020 2072 6574 7572 6e20 7b27 7265 7375     return {'resu
+000159f0: 6c74 273a 2027 6661 696c 7572 6527 7d0a  lt': 'failure'}.
+00015a00: 0a20 2020 2064 6566 2073 6e61 7073 686f  .    def snapsho
+00015a10: 745f 706c 616e 2873 656c 662c 2070 6c61  t_plan(self, pla
+00015a20: 6e2c 2073 6e61 7073 686f 746e 616d 653d  n, snapshotname=
+00015a30: 4e6f 6e65 293a 0a20 2020 2020 2020 206b  None):.        k
+00015a40: 203d 2073 656c 662e 6b0a 2020 2020 2020   = self.k.      
+00015a50: 2020 736e 6170 7368 6f74 666f 756e 6420    snapshotfound 
+00015a60: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
+00015a70: 7070 7269 6e74 2866 2253 6e61 7073 686f  pprint(f"Snapsho
+00015a80: 7474 696e 6720 766d 7320 6672 6f6d 2070  tting vms from p
+00015a90: 6c61 6e20 7b70 6c61 6e7d 2229 0a20 2020  lan {plan}").   
+00015aa0: 2020 2020 2069 6620 736e 6170 7368 6f74       if snapshot
+00015ab0: 6e61 6d65 2069 7320 4e6f 6e65 3a0a 2020  name is None:.  
+00015ac0: 2020 2020 2020 2020 2020 7761 726e 696e            warnin
+00015ad0: 6728 6622 5573 696e 6720 7b70 6c61 6e7d  g(f"Using {plan}
+00015ae0: 2061 7320 736e 6170 7368 6f74 206e 616d   as snapshot nam
+00015af0: 6520 6173 204e 6f6e 6520 7761 7320 7072  e as None was pr
+00015b00: 6f76 6964 6564 2229 0a20 2020 2020 2020  ovided").       
+00015b10: 2020 2020 2073 6e61 7073 686f 746e 616d       snapshotnam
+00015b20: 6520 3d20 706c 616e 0a20 2020 2020 2020  e = plan.       
+00015b30: 2066 6f72 2076 6d20 696e 2073 6f72 7465   for vm in sorte
+00015b40: 6428 6b2e 6c69 7374 2829 2c20 6b65 793d  d(k.list(), key=
+00015b50: 6c61 6d62 6461 2078 3a20 785b 276e 616d  lambda x: x['nam
+00015b60: 6527 5d29 3a0a 2020 2020 2020 2020 2020  e']):.          
+00015b70: 2020 6e61 6d65 203d 2076 6d5b 276e 616d    name = vm['nam
+00015b80: 6527 5d0a 2020 2020 2020 2020 2020 2020  e'].            
+00015b90: 6465 7363 7269 7074 696f 6e20 3d20 766d  description = vm
+00015ba0: 5b27 706c 616e 275d 0a20 2020 2020 2020  ['plan'].       
+00015bb0: 2020 2020 2069 6620 6465 7363 7269 7074       if descript
+00015bc0: 696f 6e20 3d3d 2070 6c61 6e3a 0a20 2020  ion == plan:.   
+00015bd0: 2020 2020 2020 2020 2020 2020 2073 6e61               sna
+00015be0: 7073 686f 7466 6f75 6e64 203d 2054 7275  pshotfound = Tru
+00015bf0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00015c00: 2020 6b2e 6372 6561 7465 5f73 6e61 7073    k.create_snaps
+00015c10: 686f 7428 736e 6170 7368 6f74 6e61 6d65  hot(snapshotname
+00015c20: 2c20 6e61 6d65 290a 2020 2020 2020 2020  , name).        
+00015c30: 2020 2020 2020 2020 7375 6363 6573 7328          success(
+00015c40: 6622 7b6e 616d 657d 2073 6e61 7073 686f  f"{name} snapsho
+00015c50: 7474 6564 2122 290a 2020 2020 2020 2020  tted!").        
+00015c60: 6966 2073 6e61 7073 686f 7466 6f75 6e64  if snapshotfound
+00015c70: 3a0a 2020 2020 2020 2020 2020 2020 7375  :.            su
+00015c80: 6363 6573 7328 6622 506c 616e 207b 706c  ccess(f"Plan {pl
+00015c90: 616e 7d20 736e 6170 7368 6f74 7465 6421  an} snapshotted!
+00015ca0: 2229 0a20 2020 2020 2020 2065 6c73 653a  ").        else:
+00015cb0: 0a20 2020 2020 2020 2020 2020 2077 6172  .            war
+00015cc0: 6e69 6e67 2822 4e6f 206d 6174 6368 696e  ning("No matchin
+00015cd0: 6720 766d 7320 666f 756e 6422 290a 2020  g vms found").  
+00015ce0: 2020 2020 2020 7265 7475 726e 207b 2772        return {'r
+00015cf0: 6573 756c 7427 3a20 2773 7563 6365 7373  esult': 'success
+00015d00: 277d 0a0a 2020 2020 6465 6620 7265 7665  '}..    def reve
+00015d10: 7274 5f70 6c61 6e28 7365 6c66 2c20 706c  rt_plan(self, pl
+00015d20: 616e 2c20 736e 6170 7368 6f74 6e61 6d65  an, snapshotname
+00015d30: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
+00015d40: 6b20 3d20 7365 6c66 2e6b 0a20 2020 2020  k = self.k.     
+00015d50: 2020 2072 6576 6572 7466 6f75 6e64 203d     revertfound =
+00015d60: 2046 616c 7365 0a20 2020 2020 2020 2070   False.        p
+00015d70: 7072 696e 7428 6622 5265 7665 7274 696e  print(f"Revertin
+00015d80: 6720 736e 6170 7368 6f74 7320 6f66 2076  g snapshots of v
+00015d90: 6d73 2066 726f 6d20 706c 616e 207b 706c  ms from plan {pl
+00015da0: 616e 7d22 290a 2020 2020 2020 2020 6966  an}").        if
+00015db0: 2073 6e61 7073 686f 746e 616d 6520 6973   snapshotname is
+00015dc0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00015dd0: 2020 2077 6172 6e69 6e67 2866 2255 7369     warning(f"Usi
+00015de0: 6e67 207b 706c 616e 7dc2 a061 7320 736e  ng {plan}..as sn
+00015df0: 6170 7368 6f74 206e 616d 6520 6173 204e  apshot name as N
+00015e00: 6f6e 6520 7761 7320 7072 6f76 6964 6564  one was provided
+00015e10: 2229 0a20 2020 2020 2020 2020 2020 2073  ").            s
+00015e20: 6e61 7073 686f 746e 616d 6520 3d20 706c  napshotname = pl
+00015e30: 616e 0a20 2020 2020 2020 2066 6f72 2076  an.        for v
+00015e40: 6d20 696e 2073 6f72 7465 6428 6b2e 6c69  m in sorted(k.li
+00015e50: 7374 2829 2c20 6b65 793d 6c61 6d62 6461  st(), key=lambda
+00015e60: 2078 3a20 785b 276e 616d 6527 5d29 3a0a   x: x['name']):.
+00015e70: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
+00015e80: 203d 2076 6d5b 276e 616d 6527 5d0a 2020   = vm['name'].  
+00015e90: 2020 2020 2020 2020 2020 6465 7363 7269            descri
+00015ea0: 7074 696f 6e20 3d20 766d 5b27 706c 616e  ption = vm['plan
+00015eb0: 275d 0a20 2020 2020 2020 2020 2020 2069  '].            i
+00015ec0: 6620 6465 7363 7269 7074 696f 6e20 3d3d  f description ==
+00015ed0: 2070 6c61 6e3a 0a20 2020 2020 2020 2020   plan:.         
+00015ee0: 2020 2020 2020 2072 6576 6572 7466 6f75         revertfou
+00015ef0: 6e64 203d 2054 7275 650a 2020 2020 2020  nd = True.      
+00015f00: 2020 2020 2020 2020 2020 6b2e 7265 7665            k.reve
+00015f10: 7274 5f73 6e61 7073 686f 7428 736e 6170  rt_snapshot(snap
+00015f20: 7368 6f74 6e61 6d65 2c20 6e61 6d65 290a  shotname, name).
+00015f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015f40: 7375 6363 6573 7328 6622 736e 6170 7368  success(f"snapsh
+00015f50: 6f74 206f 6620 7b6e 616d 657d 2072 6576  ot of {name} rev
+00015f60: 6572 7465 6421 2229 0a20 2020 2020 2020  erted!").       
+00015f70: 2069 6620 7265 7665 7274 666f 756e 643a   if revertfound:
+00015f80: 0a20 2020 2020 2020 2020 2020 2073 7563  .            suc
+00015f90: 6365 7373 2866 2250 6c61 6e20 7b70 6c61  cess(f"Plan {pla
+00015fa0: 6e7d 2072 6576 6572 7465 6420 7769 7468  n} reverted with
+00015fb0: 2073 6e61 7073 686f 7420 7b73 6e61 7073   snapshot {snaps
+00015fc0: 686f 746e 616d 657d 2122 290a 2020 2020  hotname}!").    
+00015fd0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00015fe0: 2020 2020 2020 7761 726e 696e 6728 224e        warning("N
+00015ff0: 6f20 6d61 7463 6869 6e67 2076 6d73 2066  o matching vms f
+00016000: 6f75 6e64 2229 0a20 2020 2020 2020 2072  ound").        r
+00016010: 6574 7572 6e20 7b27 7265 7375 6c74 273a  eturn {'result':
+00016020: 2027 7375 6363 6573 7327 7d0a 0a20 2020   'success'}..   
+00016030: 2064 6566 2070 6c61 6e28 7365 6c66 2c20   def plan(self, 
+00016040: 706c 616e 2c20 616e 7369 626c 653d 4661  plan, ansible=Fa
+00016050: 6c73 652c 2075 726c 3d4e 6f6e 652c 2070  lse, url=None, p
+00016060: 6174 683d 4e6f 6e65 2c20 636f 6e74 6169  ath=None, contai
+00016070: 6e65 723d 4661 6c73 652c 2069 6e70 7574  ner=False, input
+00016080: 6669 6c65 3d4e 6f6e 652c 2069 6e70 7574  file=None, input
+00016090: 7374 7269 6e67 3d4e 6f6e 652c 0a20 2020  string=None,.   
+000160a0: 2020 2020 2020 2020 2020 6f76 6572 7269            overri
+000160b0: 6465 733d 7b7d 2c20 696e 666f 3d46 616c  des={}, info=Fal
+000160c0: 7365 2c20 7570 6461 7465 3d46 616c 7365  se, update=False
+000160d0: 2c20 656d 6265 6464 6564 3d46 616c 7365  , embedded=False
+000160e0: 2c20 646f 776e 6c6f 6164 3d46 616c 7365  , download=False
+000160f0: 2c20 7175 6965 743d 4661 6c73 652c 2064  , quiet=False, d
+00016100: 6f63 3d46 616c 7365 2c0a 2020 2020 2020  oc=False,.      
+00016110: 2020 2020 2020 206f 6e6c 7961 7373 6574         onlyasset
+00016120: 733d 4661 6c73 652c 2070 7265 3d54 7275  s=False, pre=Tru
+00016130: 652c 2070 6f73 743d 5472 7565 2c20 6578  e, post=True, ex
+00016140: 636c 7564 6576 6d73 3d5b 5d2c 2062 6173  cludevms=[], bas
+00016150: 656d 6f64 653d 4661 6c73 652c 2074 6872  emode=False, thr
+00016160: 6561 6465 643d 4661 6c73 6529 3a0a 2020  eaded=False):.  
+00016170: 2020 2020 2020 2222 224d 616e 6167 6520        """Manage 
+00016180: 706c 616e 2066 696c 6522 2222 0a20 2020  plan file""".   
+00016190: 2020 2020 206b 203d 2073 656c 662e 6b0a       k = self.k.
+000161a0: 2020 2020 2020 2020 6e6f 5f6f 7665 7272          no_overr
+000161b0: 6964 6573 203d 206e 6f74 206f 7665 7272  ides = not overr
+000161c0: 6964 6573 0a20 2020 2020 2020 2074 6872  ides.        thr
+000161d0: 6561 6473 203d 205b 5d0a 2020 2020 2020  eads = [].      
+000161e0: 2020 6e65 7776 6d73 203d 205b 5d0a 2020    newvms = [].  
+000161f0: 2020 2020 2020 6e65 7761 7373 6574 7320        newassets 
+00016200: 3d20 5b5d 0a20 2020 2020 2020 2066 6169  = [].        fai
+00016210: 6c65 6476 6d73 203d 205b 5d0a 2020 2020  ledvms = [].    
+00016220: 2020 2020 6578 6973 7469 6e67 766d 7320      existingvms 
+00016230: 3d20 5b5d 0a20 2020 2020 2020 2061 7379  = [].        asy
+00016240: 6e63 7761 6974 766d 7320 3d20 5b5d 0a20  ncwaitvms = []. 
+00016250: 2020 2020 2020 206f 6e66 6c79 203d 204e         onfly = N
+00016260: 6f6e 650a 2020 2020 2020 2020 746f 636c  one.        tocl
+00016270: 6561 6e20 3d20 4661 6c73 650a 2020 2020  ean = False.    
+00016280: 2020 2020 6765 7462 6163 6b20 3d20 4661      getback = Fa
+00016290: 6c73 650a 2020 2020 2020 2020 766d 7072  lse.        vmpr
+000162a0: 6f66 696c 6573 203d 207b 6b65 793a 2076  ofiles = {key: v
+000162b0: 616c 7565 2066 6f72 206b 6579 2c20 7661  alue for key, va
+000162c0: 6c75 6520 696e 2073 656c 662e 7072 6f66  lue in self.prof
+000162d0: 696c 6573 2e69 7465 6d73 2829 0a20 2020  iles.items().   
+000162e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000162f0: 2020 2069 6620 2774 7970 6527 206e 6f74     if 'type' not
+00016300: 2069 6e20 7661 6c75 6520 6f72 2076 616c   in value or val
+00016310: 7565 5b27 7479 7065 275d 203d 3d20 2776  ue['type'] == 'v
+00016320: 6d27 7d0a 2020 2020 2020 2020 636f 6e74  m'}.        cont
+00016330: 6169 6e65 7270 726f 6669 6c65 7320 3d20  ainerprofiles = 
+00016340: 7b6b 6579 3a20 7661 6c75 6520 666f 7220  {key: value for 
+00016350: 6b65 792c 2076 616c 7565 2069 6e20 7365  key, value in se
+00016360: 6c66 2e70 726f 6669 6c65 732e 6974 656d  lf.profiles.item
+00016370: 7328 290a 2020 2020 2020 2020 2020 2020  s().            
+00016380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016390: 2069 6620 2774 7970 6527 2069 6e20 7661   if 'type' in va
+000163a0: 6c75 6520 616e 6420 7661 6c75 655b 2774  lue and value['t
+000163b0: 7970 6527 5d20 3d3d 2027 636f 6e74 6169  ype'] == 'contai
+000163c0: 6e65 7227 7d0a 2020 2020 2020 2020 6966  ner'}.        if
+000163d0: 2070 6c61 6e20 6973 204e 6f6e 653a 0a20   plan is None:. 
+000163e0: 2020 2020 2020 2020 2020 2070 6c61 6e20             plan 
+000163f0: 3d20 6e61 6d65 7574 696c 732e 6765 745f  = nameutils.get_
+00016400: 7261 6e64 6f6d 5f6e 616d 6528 290a 2020  random_name().  
+00016410: 2020 2020 2020 6966 2075 726c 2069 7320        if url is 
+00016420: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+00016430: 2020 2020 2020 6966 2075 726c 2e73 7461        if url.sta
+00016440: 7274 7377 6974 6828 272f 2729 3a0a 2020  rtswith('/'):.  
+00016450: 2020 2020 2020 2020 2020 2020 2020 7572                ur
+00016460: 6c20 3d20 6622 6669 6c65 3a2f 2f7b 7572  l = f"file://{ur
+00016470: 6c7d 220a 2020 2020 2020 2020 2020 2020  l}".            
+00016480: 6966 206e 6f74 2075 726c 2e65 6e64 7377  if not url.endsw
+00016490: 6974 6828 272e 796d 6c27 293a 0a20 2020  ith('.yml'):.   
+000164a0: 2020 2020 2020 2020 2020 2020 2075 726c               url
+000164b0: 203d 2066 227b 7572 6c7d 2f6b 636c 695f   = f"{url}/kcli_
+000164c0: 706c 616e 2e79 6d6c 220a 2020 2020 2020  plan.yml".      
+000164d0: 2020 2020 2020 2020 2020 7070 7269 6e74            pprint
+000164e0: 2866 2254 7279 696e 6720 746f 2072 6574  (f"Trying to ret
+000164f0: 7269 6576 6520 7b75 726c 7d22 290a 2020  rieve {url}").  
+00016500: 2020 2020 2020 2020 2020 696e 7075 7466            inputf
+00016510: 696c 6520 3d20 6f73 2e70 6174 682e 6261  ile = os.path.ba
+00016520: 7365 6e61 6d65 2875 726c 290a 2020 2020  sename(url).    
+00016530: 2020 2020 2020 2020 6f6e 666c 7920 3d20          onfly = 
+00016540: 6f73 2e70 6174 682e 6469 726e 616d 6528  os.path.dirname(
+00016550: 7572 6c29 0a20 2020 2020 2020 2020 2020  url).           
+00016560: 2070 6174 6820 3d20 706c 616e 2069 6620   path = plan if 
+00016570: 7061 7468 2069 7320 4e6f 6e65 2065 6c73  path is None els
+00016580: 6520 7061 7468 0a20 2020 2020 2020 2020  e path.         
+00016590: 2020 2069 6620 6e6f 7420 7175 6965 743a     if not quiet:
+000165a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000165b0: 2070 7072 696e 7428 6622 5265 7472 6965   pprint(f"Retrie
+000165c0: 7669 6e67 2073 7065 6369 6669 6564 2070  ving specified p
+000165d0: 6c61 6e20 6672 6f6d 207b 7572 6c7d 2074  lan from {url} t
+000165e0: 6f20 7b70 6174 687d 2229 0a20 2020 2020  o {path}").     
+000165f0: 2020 2020 2020 2069 6620 636f 6e74 6169         if contai
+00016600: 6e65 725f 6d6f 6465 2829 3a0a 2020 2020  ner_mode():.    
+00016610: 2020 2020 2020 2020 2020 2020 7061 7468              path
+00016620: 203d 2066 222f 776f 726b 6469 722f 7b70   = f"/workdir/{p
+00016630: 6174 687d 220a 2020 2020 2020 2020 2020  ath}".          
+00016640: 2020 6966 206e 6f74 206f 732e 7061 7468    if not os.path
+00016650: 2e65 7869 7374 7328 7061 7468 293a 0a20  .exists(path):. 
+00016660: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00016670: 6f63 6c65 616e 203d 2054 7275 650a 2020  oclean = True.  
+00016680: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00016690: 6d6d 6f6e 2e66 6574 6368 2875 726c 2c20  mmon.fetch(url, 
+000166a0: 7061 7468 290a 2020 2020 2020 2020 2020  path).          
+000166b0: 2020 2020 2020 666f 7220 6465 6661 756c        for defaul
+000166c0: 745f 7061 7261 6d65 7465 725f 6669 6c65  t_parameter_file
+000166d0: 2069 6e20 5b27 2f6b 636c 695f 6465 6661   in ['/kcli_defa
+000166e0: 756c 742e 796d 6c27 2c20 6627 2f7b 706c  ult.yml', f'/{pl
+000166f0: 616e 7d5f 6465 6661 756c 742e 796d 6c27  an}_default.yml'
+00016700: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00016710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016730: 2022 2f25 735f 6465 6661 756c 7425 7322   "/%s_default%s"
+00016740: 2025 206f 732e 7061 7468 2e73 706c 6974   % os.path.split
+00016750: 6578 7428 6f73 2e70 6174 682e 6261 7365  ext(os.path.base
+00016760: 6e61 6d65 2875 726c 2929 5d3a 0a20 2020  name(url))]:.   
+00016770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016780: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
+00016790: 2020 2020 2020 2020 2020 2020 2020 636f                co
+000167a0: 6d6d 6f6e 2e66 6574 6368 286f 732e 7061  mmon.fetch(os.pa
+000167b0: 7468 2e64 6972 6e61 6d65 2875 726c 2920  th.dirname(url) 
+000167c0: 2b20 6465 6661 756c 745f 7061 7261 6d65  + default_parame
+000167d0: 7465 725f 6669 6c65 2c20 7061 7468 290a  ter_file, path).
+000167e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000167f0: 2020 2020 6578 6365 7074 3a0a 2020 2020      except:.    
+00016800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016810: 2020 2020 7061 7373 0a20 2020 2020 2020      pass.       
+00016820: 2020 2020 2065 6c69 6620 646f 776e 6c6f       elif downlo
+00016830: 6164 3a0a 2020 2020 2020 2020 2020 2020  ad:.            
+00016840: 2020 2020 6d73 6720 3d20 6622 7461 7267      msg = f"targ
+00016850: 6574 2064 6972 6563 746f 7279 207b 7061  et directory {pa
+00016860: 7468 7d20 616c 7265 6164 7920 7468 6572  th} already ther
+00016870: 6522 0a20 2020 2020 2020 2020 2020 2020  e".             
+00016880: 2020 2065 7272 6f72 286d 7367 290a 2020     error(msg).  
+00016890: 2020 2020 2020 2020 2020 2020 2020 7265                re
+000168a0: 7475 726e 207b 2772 6573 756c 7427 3a20  turn {'result': 
+000168b0: 2766 6169 6c75 7265 272c 2027 7265 6173  'failure', 'reas
+000168c0: 6f6e 273a 206d 7367 7d0a 2020 2020 2020  on': msg}.      
+000168d0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+000168e0: 2020 2020 2020 2020 2020 2020 7070 7269              ppri
+000168f0: 6e74 2866 2255 7369 6e67 2065 7869 7374  nt(f"Using exist
+00016900: 696e 6720 6469 7265 6374 6f72 7920 7b70  ing directory {p
+00016910: 6174 687d 2229 0a20 2020 2020 2020 2020  ath}").         
+00016920: 2020 2069 6620 646f 776e 6c6f 6164 3a0a     if download:.
+00016930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016940: 696e 7075 7466 696c 6520 3d20 6622 7b70  inputfile = f"{p
+00016950: 6174 687d 2f7b 696e 7075 7466 696c 657d  ath}/{inputfile}
+00016960: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00016970: 2020 656e 7472 6965 732c 206f 7665 7272    entries, overr
+00016980: 6964 6573 2c20 6261 7365 6669 6c65 2c20  ides, basefile, 
+00016990: 6261 7365 6469 7220 3d20 7365 6c66 2e70  basedir = self.p
+000169a0: 726f 6365 7373 5f69 6e70 7574 6669 6c65  rocess_inputfile
+000169b0: 2870 6c61 6e2c 2069 6e70 7574 6669 6c65  (plan, inputfile
+000169c0: 2c20 6f76 6572 7269 6465 733d 6f76 6572  , overrides=over
+000169d0: 7269 6465 732c 0a20 2020 2020 2020 2020  rides,.         
+000169e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000169f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016a20: 2020 2020 2020 6f6e 666c 793d 6f6e 666c        onfly=onfl
+00016a30: 792c 2066 756c 6c3d 5472 7565 2c0a 2020  y, full=True,.  
 00016a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00016a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00016a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016a70: 2020 6f6e 666c 793d 6f6e 666c 792c 2066    onfly=onfly, f
-00016a80: 756c 6c3d 5472 7565 2c0a 2020 2020 2020  ull=True,.      
-00016a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016a80: 2020 2020 2020 2020 2020 2020 2064 6f77               dow
+00016a90: 6e6c 6f61 645f 6d6f 6465 3d54 7275 6529  nload_mode=True)
+00016aa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016ab0: 206f 732e 6368 6469 7228 7061 7468 290a   os.chdir(path).
 00016ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016ad0: 2020 2020 2020 2020 2064 6f77 6e6c 6f61           downloa
-00016ae0: 645f 6d6f 6465 3d54 7275 6529 0a20 2020  d_mode=True).   
-00016af0: 2020 2020 2020 2020 2020 2020 206f 732e               os.
-00016b00: 6368 6469 7228 7061 7468 290a 2020 2020  chdir(path).    
-00016b10: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00016b20: 656e 7472 7920 696e 2065 6e74 7269 6573  entry in entries
-00016b30: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00016b40: 2020 2020 2020 6966 2027 7479 7065 2720        if 'type' 
-00016b50: 696e 2065 6e74 7269 6573 5b65 6e74 7279  in entries[entry
-00016b60: 5d20 616e 6420 656e 7472 6965 735b 656e  ] and entries[en
-00016b70: 7472 795d 5b27 7479 7065 275d 2021 3d20  try]['type'] != 
-00016b80: 2776 6d27 3a0a 2020 2020 2020 2020 2020  'vm':.          
-00016b90: 2020 2020 2020 2020 2020 2020 2020 636f                co
-00016ba0: 6e74 696e 7565 0a20 2020 2020 2020 2020  ntinue.         
-00016bb0: 2020 2020 2020 2020 2020 2076 6d65 6e74             vment
-00016bc0: 7279 203d 2065 6e74 7269 6573 5b65 6e74  ry = entries[ent
-00016bd0: 7279 5d0a 2020 2020 2020 2020 2020 2020  ry].            
-00016be0: 2020 2020 2020 2020 766d 6669 6c65 7320          vmfiles 
-00016bf0: 3d20 766d 656e 7472 792e 6765 7428 2766  = vmentry.get('f
-00016c00: 696c 6573 272c 205b 5d29 0a20 2020 2020  iles', []).     
-00016c10: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00016c20: 6372 6970 7466 696c 6573 203d 2076 6d65  criptfiles = vme
-00016c30: 6e74 7279 2e67 6574 2827 7363 7269 7074  ntry.get('script
-00016c40: 7327 2c20 5b5d 290a 2020 2020 2020 2020  s', []).        
-00016c50: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00016c60: 6669 6c20 696e 2076 6d66 696c 6573 3a0a  fil in vmfiles:.
-00016c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016c80: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-00016c90: 7461 6e63 6528 6669 6c2c 2073 7472 293a  tance(fil, str):
-00016ca0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016cb0: 2020 2020 2020 2020 2020 2020 206f 7269               ori
-00016cc0: 6769 6e20 3d20 6669 6c0a 2020 2020 2020  gin = fil.      
-00016cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016ce0: 2020 656c 6966 2069 7369 6e73 7461 6e63    elif isinstanc
-00016cf0: 6528 6669 6c2c 2064 6963 7429 3a0a 2020  e(fil, dict):.  
-00016d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016d10: 2020 2020 2020 2020 2020 6f72 6967 696e            origin
-00016d20: 203d 2066 696c 2e67 6574 2827 6f72 6967   = fil.get('orig
-00016d30: 696e 2729 0a20 2020 2020 2020 2020 2020  in').           
-00016d40: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-00016d50: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00016d60: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00016d70: 6574 7572 6e20 7b27 7265 7375 6c74 273a  eturn {'result':
-00016d80: 2027 6661 696c 7572 6527 2c20 2772 6561   'failure', 'rea
-00016d90: 736f 6e27 3a20 2249 6e63 6f72 7265 6374  son': "Incorrect
-00016da0: 2066 696c 6520 656e 7472 7922 7d0a 2020   file entry"}.  
-00016db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016dc0: 2020 2020 2020 6966 2027 7e27 206e 6f74        if '~' not
-00016dd0: 2069 6e20 6f72 6967 696e 3a0a 2020 2020   in origin:.    
-00016de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016df0: 2020 2020 2020 2020 6465 7374 6469 7220          destdir 
-00016e00: 3d20 222e 220a 2020 2020 2020 2020 2020  = ".".          
-00016e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016e20: 2020 6966 2027 2f27 2069 6e20 6f72 6967    if '/' in orig
-00016e30: 696e 3a0a 2020 2020 2020 2020 2020 2020  in:.            
-00016e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016e50: 2020 2020 6465 7374 6469 7220 3d20 6f73      destdir = os
-00016e60: 2e70 6174 682e 6469 726e 616d 6528 6f72  .path.dirname(or
-00016e70: 6967 696e 290a 2020 2020 2020 2020 2020  igin).          
-00016e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016e90: 2020 2020 2020 6f73 2e6d 616b 6564 6972        os.makedir
-00016ea0: 7328 6465 7374 6469 722c 2065 7869 7374  s(destdir, exist
-00016eb0: 5f6f 6b3d 5472 7565 290a 2020 2020 2020  _ok=True).      
+00016ad0: 666f 7220 656e 7472 7920 696e 2065 6e74  for entry in ent
+00016ae0: 7269 6573 3a0a 2020 2020 2020 2020 2020  ries:.          
+00016af0: 2020 2020 2020 2020 2020 6966 2027 7479            if 'ty
+00016b00: 7065 2720 696e 2065 6e74 7269 6573 5b65  pe' in entries[e
+00016b10: 6e74 7279 5d20 616e 6420 656e 7472 6965  ntry] and entrie
+00016b20: 735b 656e 7472 795d 5b27 7479 7065 275d  s[entry]['type']
+00016b30: 2021 3d20 2776 6d27 3a0a 2020 2020 2020   != 'vm':.      
+00016b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016b50: 2020 636f 6e74 696e 7565 0a20 2020 2020    continue.     
+00016b60: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+00016b70: 6d65 6e74 7279 203d 2065 6e74 7269 6573  mentry = entries
+00016b80: 5b65 6e74 7279 5d0a 2020 2020 2020 2020  [entry].        
+00016b90: 2020 2020 2020 2020 2020 2020 766d 6669              vmfi
+00016ba0: 6c65 7320 3d20 766d 656e 7472 792e 6765  les = vmentry.ge
+00016bb0: 7428 2766 696c 6573 272c 205b 5d29 0a20  t('files', []). 
+00016bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016bd0: 2020 2073 6372 6970 7466 696c 6573 203d     scriptfiles =
+00016be0: 2076 6d65 6e74 7279 2e67 6574 2827 7363   vmentry.get('sc
+00016bf0: 7269 7074 7327 2c20 5b5d 290a 2020 2020  ripts', []).    
+00016c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016c10: 666f 7220 6669 6c20 696e 2076 6d66 696c  for fil in vmfil
+00016c20: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
+00016c30: 2020 2020 2020 2020 2020 2020 6966 2069              if i
+00016c40: 7369 6e73 7461 6e63 6528 6669 6c2c 2073  sinstance(fil, s
+00016c50: 7472 293a 0a20 2020 2020 2020 2020 2020  tr):.           
+00016c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016c70: 206f 7269 6769 6e20 3d20 6669 6c0a 2020   origin = fil.  
+00016c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016c90: 2020 2020 2020 656c 6966 2069 7369 6e73        elif isins
+00016ca0: 7461 6e63 6528 6669 6c2c 2064 6963 7429  tance(fil, dict)
+00016cb0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00016cc0: 2020 2020 2020 2020 2020 2020 2020 6f72                or
+00016cd0: 6967 696e 203d 2066 696c 2e67 6574 2827  igin = fil.get('
+00016ce0: 6f72 6967 696e 2729 0a20 2020 2020 2020  origin').       
+00016cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016d00: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00016d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016d20: 2020 2072 6574 7572 6e20 7b27 7265 7375     return {'resu
+00016d30: 6c74 273a 2027 6661 696c 7572 6527 2c20  lt': 'failure', 
+00016d40: 2772 6561 736f 6e27 3a20 2249 6e63 6f72  'reason': "Incor
+00016d50: 7265 6374 2066 696c 6520 656e 7472 7922  rect file entry"
+00016d60: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
+00016d70: 2020 2020 2020 2020 2020 6966 2027 7e27            if '~'
+00016d80: 206e 6f74 2069 6e20 6f72 6967 696e 3a0a   not in origin:.
+00016d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016da0: 2020 2020 2020 2020 2020 2020 6465 7374              dest
+00016db0: 6469 7220 3d20 222e 220a 2020 2020 2020  dir = ".".      
+00016dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016dd0: 2020 2020 2020 6966 2027 2f27 2069 6e20        if '/' in 
+00016de0: 6f72 6967 696e 3a0a 2020 2020 2020 2020  origin:.        
+00016df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016e00: 2020 2020 2020 2020 6465 7374 6469 7220          destdir 
+00016e10: 3d20 6f73 2e70 6174 682e 6469 726e 616d  = os.path.dirnam
+00016e20: 6528 6f72 6967 696e 290a 2020 2020 2020  e(origin).      
+00016e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016e40: 2020 2020 2020 2020 2020 6f73 2e6d 616b            os.mak
+00016e50: 6564 6972 7328 6465 7374 6469 722c 2065  edirs(destdir, e
+00016e60: 7869 7374 5f6f 6b3d 5472 7565 290a 2020  xist_ok=True).  
+00016e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016e80: 2020 2020 2020 2020 2020 7070 7269 6e74            pprint
+00016e90: 2866 2252 6574 7269 6576 696e 6720 6669  (f"Retrieving fi
+00016ea0: 6c65 207b 6f6e 666c 797d 2f7b 6f72 6967  le {onfly}/{orig
+00016eb0: 696e 7d22 290a 2020 2020 2020 2020 2020  in}").          
 00016ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016ed0: 2020 2020 2020 7070 7269 6e74 2866 2252        pprint(f"R
-00016ee0: 6574 7269 6576 696e 6720 6669 6c65 207b  etrieving file {
-00016ef0: 6f6e 666c 797d 2f7b 6f72 6967 696e 7d22  onfly}/{origin}"
-00016f00: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00016f10: 2020 2020 2020 2020 2020 2020 2020 7472                tr
-00016f20: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
-00016f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016f40: 2020 2063 6f6d 6d6f 6e2e 6665 7463 6828     common.fetch(
-00016f50: 6622 7b6f 6e66 6c79 7d2f 7b6f 7269 6769  f"{onfly}/{origi
-00016f60: 6e7d 222c 2064 6573 7464 6972 290a 2020  n}", destdir).  
-00016f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016f80: 2020 2020 2020 2020 2020 6578 6365 7074            except
-00016f90: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00016ed0: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+00016ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016ef0: 2020 2020 2020 2063 6f6d 6d6f 6e2e 6665         common.fe
+00016f00: 7463 6828 6622 7b6f 6e66 6c79 7d2f 7b6f  tch(f"{onfly}/{o
+00016f10: 7269 6769 6e7d 222c 2064 6573 7464 6972  rigin}", destdir
+00016f20: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00016f30: 2020 2020 2020 2020 2020 2020 2020 6578                ex
+00016f40: 6365 7074 3a0a 2020 2020 2020 2020 2020  cept:.          
+00016f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016f60: 2020 2020 2020 6966 2063 6f6d 6d6f 6e2e        if common.
+00016f70: 7572 6c5f 6578 6973 7473 2866 227b 6f6e  url_exists(f"{on
+00016f80: 666c 797d 2f7b 6f72 6967 696e 7d2f 5245  fly}/{origin}/RE
+00016f90: 4144 4d45 2e6d 6422 293a 0a20 2020 2020  ADME.md"):.     
 00016fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016fb0: 2020 6966 2063 6f6d 6d6f 6e2e 7572 6c5f    if common.url_
-00016fc0: 6578 6973 7473 2866 227b 6f6e 666c 797d  exists(f"{onfly}
-00016fd0: 2f7b 6f72 6967 696e 7d2f 5245 4144 4d45  /{origin}/README
-00016fe0: 2e6d 6422 293a 0a20 2020 2020 2020 2020  .md"):.         
+00016fb0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+00016fc0: 732e 6d61 6b65 6469 7273 286f 7269 6769  s.makedirs(origi
+00016fd0: 6e2c 2065 7869 7374 5f6f 6b3d 5472 7565  n, exist_ok=True
+00016fe0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
 00016ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017000: 2020 2020 2020 2020 2020 206f 732e 6d61             os.ma
-00017010: 6b65 6469 7273 286f 7269 6769 6e2c 2065  kedirs(origin, e
-00017020: 7869 7374 5f6f 6b3d 5472 7565 290a 2020  xist_ok=True).  
-00017030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017040: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00017050: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00017060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017070: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
-00017080: 2266 696c 6520 7b6f 6e66 6c79 7d2f 7b6f  "file {onfly}/{o
-00017090: 7269 6769 6e7d 2073 6b69 7070 6564 2229  rigin} skipped")
-000170a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000170b0: 2020 2020 2066 6f72 2073 6372 6970 7420       for script 
-000170c0: 696e 2073 6372 6970 7466 696c 6573 3a0a  in scriptfiles:.
-000170d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000170e0: 2020 2020 2020 2020 6966 2027 7e27 206e          if '~' n
-000170f0: 6f74 2069 6e20 7363 7269 7074 3a0a 2020  ot in script:.  
-00017100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017110: 2020 2020 2020 2020 2020 6465 7374 6469            destdi
-00017120: 7220 3d20 222e 220a 2020 2020 2020 2020  r = ".".        
-00017130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017140: 2020 2020 6966 2027 2f27 2069 6e20 7363      if '/' in sc
-00017150: 7269 7074 3a0a 2020 2020 2020 2020 2020  ript:.          
-00017160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017170: 2020 2020 2020 6465 7374 6469 7220 3d20        destdir = 
-00017180: 6f73 2e70 6174 682e 6469 726e 616d 6528  os.path.dirname(
-00017190: 7363 7269 7074 290a 2020 2020 2020 2020  script).        
-000171a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000171b0: 2020 2020 2020 2020 6f73 2e6d 616b 6564          os.maked
-000171c0: 6972 7328 6465 7374 6469 722c 2065 7869  irs(destdir, exi
-000171d0: 7374 5f6f 6b3d 5472 7565 290a 2020 2020  st_ok=True).    
+00017000: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00017010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017020: 2020 2020 2020 2020 2020 2020 7070 7269              ppri
+00017030: 6e74 2866 2266 696c 6520 7b6f 6e66 6c79  nt(f"file {onfly
+00017040: 7d2f 7b6f 7269 6769 6e7d 2073 6b69 7070  }/{origin} skipp
+00017050: 6564 2229 0a20 2020 2020 2020 2020 2020  ed").           
+00017060: 2020 2020 2020 2020 2066 6f72 2073 6372           for scr
+00017070: 6970 7420 696e 2073 6372 6970 7466 696c  ipt in scriptfil
+00017080: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
+00017090: 2020 2020 2020 2020 2020 2020 6966 2027              if '
+000170a0: 7e27 206e 6f74 2069 6e20 7363 7269 7074  ~' not in script
+000170b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000170c0: 2020 2020 2020 2020 2020 2020 2020 6465                de
+000170d0: 7374 6469 7220 3d20 222e 220a 2020 2020  stdir = ".".    
+000170e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000170f0: 2020 2020 2020 2020 6966 2027 2f27 2069          if '/' i
+00017100: 6e20 7363 7269 7074 3a0a 2020 2020 2020  n script:.      
+00017110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017120: 2020 2020 2020 2020 2020 6465 7374 6469            destdi
+00017130: 7220 3d20 6f73 2e70 6174 682e 6469 726e  r = os.path.dirn
+00017140: 616d 6528 7363 7269 7074 290a 2020 2020  ame(script).    
+00017150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017160: 2020 2020 2020 2020 2020 2020 6f73 2e6d              os.m
+00017170: 616b 6564 6972 7328 6465 7374 6469 722c  akedirs(destdir,
+00017180: 2065 7869 7374 5f6f 6b3d 5472 7565 290a   exist_ok=True).
+00017190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000171a0: 2020 2020 2020 2020 2020 2020 7070 7269              ppri
+000171b0: 6e74 2866 2252 6574 7269 6576 696e 6720  nt(f"Retrieving 
+000171c0: 7363 7269 7074 207b 6f6e 666c 797d 2f7b  script {onfly}/{
+000171d0: 7363 7269 7074 7d22 290a 2020 2020 2020  script}").      
 000171e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000171f0: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
-00017200: 2252 6574 7269 6576 696e 6720 7363 7269  "Retrieving scri
-00017210: 7074 207b 6f6e 666c 797d 2f7b 7363 7269  pt {onfly}/{scri
-00017220: 7074 7d22 290a 2020 2020 2020 2020 2020  pt}").          
-00017230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017240: 2020 636f 6d6d 6f6e 2e66 6574 6368 2866    common.fetch(f
-00017250: 227b 6f6e 666c 797d 2f7b 7363 7269 7074  "{onfly}/{script
-00017260: 7d22 2c20 6465 7374 6469 7229 0a20 2020  }", destdir).   
-00017270: 2020 2020 2020 2020 2020 2020 206f 732e               os.
-00017280: 6368 6469 7228 272e 2e27 290a 2020 2020  chdir('..').    
-00017290: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-000172a0: 726e 207b 2772 6573 756c 7427 3a20 2773  rn {'result': 's
-000172b0: 7563 6365 7373 277d 0a20 2020 2020 2020  uccess'}.       
-000172c0: 2069 6620 696e 7075 7473 7472 696e 6720   if inputstring 
-000172d0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-000172e0: 2020 2020 2020 2020 2069 6e70 7574 6669           inputfi
-000172f0: 6c65 203d 2066 2274 656d 705f 706c 616e  le = f"temp_plan
-00017300: 5f7b 706c 616e 7d2e 796d 6c22 0a20 2020  _{plan}.yml".   
-00017310: 2020 2020 2020 2020 2077 6974 6820 6f70           with op
-00017320: 656e 2869 6e70 7574 6669 6c65 2c20 2277  en(inputfile, "w
-00017330: 2229 2061 7320 663a 0a20 2020 2020 2020  ") as f:.       
-00017340: 2020 2020 2020 2020 2066 2e77 7269 7465           f.write
-00017350: 2869 6e70 7574 7374 7269 6e67 290a 2020  (inputstring).  
-00017360: 2020 2020 2020 6966 2069 6e70 7574 6669        if inputfi
-00017370: 6c65 2069 7320 4e6f 6e65 3a0a 2020 2020  le is None:.    
-00017380: 2020 2020 2020 2020 696e 7075 7466 696c          inputfil
-00017390: 6520 3d20 276b 636c 695f 706c 616e 2e79  e = 'kcli_plan.y
-000173a0: 6d6c 270a 2020 2020 2020 2020 2020 2020  ml'.            
-000173b0: 7070 7269 6e74 2822 7573 696e 6720 6465  pprint("using de
-000173c0: 6661 756c 7420 696e 7075 7420 6669 6c65  fault input file
-000173d0: 206b 636c 695f 706c 616e 2e79 6d6c 2229   kcli_plan.yml")
-000173e0: 0a20 2020 2020 2020 2069 6620 7061 7468  .        if path
-000173f0: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-00017400: 2020 2020 2020 2020 2020 6f73 2e63 6864            os.chd
-00017410: 6972 2870 6174 6829 0a20 2020 2020 2020  ir(path).       
-00017420: 2020 2020 2067 6574 6261 636b 203d 2054       getback = T
-00017430: 7275 650a 2020 2020 2020 2020 696e 7075  rue.        inpu
-00017440: 7466 696c 6520 3d20 6f73 2e70 6174 682e  tfile = os.path.
-00017450: 6578 7061 6e64 7573 6572 2869 6e70 7574  expanduser(input
-00017460: 6669 6c65 290a 2020 2020 2020 2020 6966  file).        if
-00017470: 206e 6f74 206f 732e 7061 7468 2e65 7869   not os.path.exi
-00017480: 7374 7328 696e 7075 7466 696c 6529 3a0a  sts(inputfile):.
-00017490: 2020 2020 2020 2020 2020 2020 6572 726f              erro
-000174a0: 7228 6622 496e 7075 7420 6669 6c65 207b  r(f"Input file {
-000174b0: 696e 7075 7466 696c 657d 206e 6f74 2066  inputfile} not f
-000174c0: 6f75 6e64 2e4c 6561 7669 6e67 2e2e 2e2e  ound.Leaving....
-000174d0: 2229 0a20 2020 2020 2020 2020 2020 2073  ").            s
-000174e0: 7973 2e65 7869 7428 3129 0a20 2020 2020  ys.exit(1).     
-000174f0: 2020 2065 6c69 6620 6f73 2e70 6174 682e     elif os.path.
-00017500: 6973 6469 7228 696e 7075 7466 696c 6529  isdir(inputfile)
-00017510: 3a0a 2020 2020 2020 2020 2020 2020 696e  :.            in
-00017520: 7075 7466 696c 6520 3d20 6622 7b69 6e70  putfile = f"{inp
-00017530: 7574 6669 6c65 7d2f 6b63 6c69 5f70 6c61  utfile}/kcli_pla
-00017540: 6e2e 796d 6c22 0a20 2020 2020 2020 2069  n.yml".        i
-00017550: 6620 696e 666f 3a0a 2020 2020 2020 2020  f info:.        
-00017560: 2020 2020 7365 6c66 2e69 6e66 6f5f 706c      self.info_pl
-00017570: 616e 2869 6e70 7574 6669 6c65 2c20 6f6e  an(inputfile, on
-00017580: 666c 793d 6f6e 666c 792c 2071 7569 6574  fly=onfly, quiet
-00017590: 3d71 7569 6574 2c20 646f 633d 646f 6329  =quiet, doc=doc)
-000175a0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-000175b0: 746f 636c 6561 6e3a 0a20 2020 2020 2020  toclean:.       
-000175c0: 2020 2020 2020 2020 206f 732e 6368 6469           os.chdi
-000175d0: 7228 272e 2e27 290a 2020 2020 2020 2020  r('..').        
-000175e0: 2020 2020 2020 2020 726d 7472 6565 2870          rmtree(p
-000175f0: 6174 6829 0a20 2020 2020 2020 2020 2020  ath).           
-00017600: 2072 6574 7572 6e20 7b27 7265 7375 6c74   return {'result
-00017610: 273a 2027 7375 6363 6573 7327 7d0a 2020  ': 'success'}.  
-00017620: 2020 2020 2020 6261 7365 656e 7472 6965        baseentrie
-00017630: 7320 3d20 7b7d 0a20 2020 2020 2020 2065  s = {}.        e
-00017640: 6e74 7269 6573 2c20 6f76 6572 7269 6465  ntries, override
-00017650: 732c 2062 6173 6566 696c 652c 2062 6173  s, basefile, bas
-00017660: 6564 6972 203d 2073 656c 662e 7072 6f63  edir = self.proc
-00017670: 6573 735f 696e 7075 7466 696c 6528 706c  ess_inputfile(pl
-00017680: 616e 2c20 696e 7075 7466 696c 652c 206f  an, inputfile, o
-00017690: 7665 7272 6964 6573 3d6f 7665 7272 6964  verrides=overrid
-000176a0: 6573 2c0a 2020 2020 2020 2020 2020 2020  es,.            
-000176b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000176c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000176d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000176e0: 2020 2020 2020 2020 2020 206f 6e66 6c79             onfly
-000176f0: 3d6f 6e66 6c79 2c20 6675 6c6c 3d54 7275  =onfly, full=Tru
-00017700: 6529 0a20 2020 2020 2020 2069 6620 6261  e).        if ba
-00017710: 7365 6669 6c65 2069 7320 6e6f 7420 4e6f  sefile is not No
-00017720: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00017730: 6261 7365 696e 666f 203d 2073 656c 662e  baseinfo = self.
-00017740: 7072 6f63 6573 735f 696e 7075 7466 696c  process_inputfil
-00017750: 6528 706c 616e 2c20 6622 7b62 6173 6564  e(plan, f"{based
-00017760: 6972 7d2f 7b62 6173 6566 696c 657d 222c  ir}/{basefile}",
-00017770: 206f 7665 7272 6964 6573 3d6f 7665 7272   overrides=overr
-00017780: 6964 6573 2c20 6675 6c6c 3d54 7275 6529  ides, full=True)
-00017790: 0a20 2020 2020 2020 2020 2020 2062 6173  .            bas
-000177a0: 6565 6e74 7269 6573 2c20 6261 7365 6f76  eentries, baseov
-000177b0: 6572 7269 6465 7320 3d20 6261 7365 696e  errides = basein
-000177c0: 666f 5b30 5d2c 2062 6173 6569 6e66 6f5b  fo[0], baseinfo[
-000177d0: 315d 0a20 2020 2020 2020 2020 2020 2069  1].            i
-000177e0: 6620 6261 7365 6f76 6572 7269 6465 733a  f baseoverrides:
-000177f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017800: 206f 7665 7272 6964 6573 2e75 7064 6174   overrides.updat
-00017810: 6528 7b6b 6579 3a20 6261 7365 6f76 6572  e({key: baseover
-00017820: 7269 6465 735b 6b65 795d 2066 6f72 206b  rides[key] for k
-00017830: 6579 2069 6e20 6261 7365 6f76 6572 7269  ey in baseoverri
-00017840: 6465 7320 6966 206b 6579 206e 6f74 2069  des if key not i
-00017850: 6e20 6f76 6572 7269 6465 737d 290a 2020  n overrides}).  
-00017860: 2020 2020 2020 6966 2065 6e74 7269 6573        if entries
-00017870: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-00017880: 2020 2020 2020 656e 7472 6965 7320 3d20        entries = 
-00017890: 7b7d 0a20 2020 2020 2020 2069 6620 7365  {}.        if se
-000178a0: 6c66 2e64 6562 7567 3a0a 2020 2020 2020  lf.debug:.      
-000178b0: 2020 2020 2020 7072 696e 7428 7961 6d6c        print(yaml
-000178c0: 2e64 756d 7028 656e 7472 6965 7329 290a  .dump(entries)).
-000178d0: 2020 2020 2020 2020 7061 7261 6d65 7465          paramete
-000178e0: 7273 203d 2065 6e74 7269 6573 2e67 6574  rs = entries.get
-000178f0: 2827 7061 7261 6d65 7465 7273 2729 0a20  ('parameters'). 
-00017900: 2020 2020 2020 2069 6620 7061 7261 6d65         if parame
-00017910: 7465 7273 2069 7320 6e6f 7420 4e6f 6e65  ters is not None
-00017920: 3a0a 2020 2020 2020 2020 2020 2020 6465  :.            de
-00017930: 6c20 656e 7472 6965 735b 2770 6172 616d  l entries['param
-00017940: 6574 6572 7327 5d0a 2020 2020 2020 2020  eters'].        
-00017950: 6469 6374 5f74 7970 6573 203d 205b 656e  dict_types = [en
-00017960: 7472 7920 666f 7220 656e 7472 7920 696e  try for entry in
-00017970: 2065 6e74 7269 6573 2069 6620 6973 696e   entries if isin
-00017980: 7374 616e 6365 2865 6e74 7269 6573 5b65  stance(entries[e
-00017990: 6e74 7279 5d2c 2064 6963 7429 5d0a 2020  ntry], dict)].  
-000179a0: 2020 2020 2020 6966 206e 6f74 2064 6963        if not dic
-000179b0: 745f 7479 7065 733a 0a20 2020 2020 2020  t_types:.       
-000179c0: 2020 2020 2069 6620 6261 7365 6d6f 6465       if basemode
-000179d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000179e0: 2020 7761 726e 696e 6728 6622 7b69 6e70    warning(f"{inp
-000179f0: 7574 6669 6c65 7d20 646f 6573 6e27 7420  utfile} doesn't 
-00017a00: 6c6f 6f6b 206c 696b 6520 6120 7661 6c69  look like a vali
-00017a10: 6420 706c 616e 2e53 6b69 7070 696e 672e  d plan.Skipping.
-00017a20: 2e2e 2e22 290a 2020 2020 2020 2020 2020  ...").          
-00017a30: 2020 2020 2020 7265 7475 726e 207b 2272        return {"r
-00017a40: 6573 756c 7422 3a20 2273 7563 6365 7373  esult": "success
-00017a50: 227d 0a20 2020 2020 2020 2020 2020 2065  "}.            e
-00017a60: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00017a70: 2020 2020 206d 7367 203d 2066 227b 696e       msg = f"{in
-00017a80: 7075 7466 696c 657d 2064 6f65 736e 2774  putfile} doesn't
-00017a90: 206c 6f6f 6b20 6c69 6b65 2061 2076 616c   look like a val
-00017aa0: 6964 2070 6c61 6e20 6669 6c65 2e20 4d61  id plan file. Ma
-00017ab0: 7962 6520 796f 7520 7072 6f76 6964 6564  ybe you provided
-00017ac0: 2061 2070 6172 616d 6574 6572 2066 696c   a parameter fil
-00017ad0: 6520 3f22 0a20 2020 2020 2020 2020 2020  e ?".           
-00017ae0: 2020 2020 2072 6574 7572 6e20 7b27 7265       return {'re
-00017af0: 7375 6c74 273a 2027 6661 696c 7572 6527  sult': 'failure'
-00017b00: 2c20 2772 6561 736f 6e27 3a20 6d73 677d  , 'reason': msg}
-00017b10: 0a20 2020 2020 2020 2069 6e70 7574 6469  .        inputdi
-00017b20: 7220 3d20 6f73 2e70 6174 682e 6469 726e  r = os.path.dirn
-00017b30: 616d 6528 696e 7075 7466 696c 6529 2069  ame(inputfile) i
-00017b40: 6620 6f73 2e70 6174 682e 6469 726e 616d  f os.path.dirnam
-00017b50: 6528 696e 7075 7466 696c 6529 2021 3d20  e(inputfile) != 
-00017b60: 2727 2061 6e64 206f 732e 7061 7468 2e69  '' and os.path.i
-00017b70: 7361 6273 2869 6e70 7574 6669 6c65 2920  sabs(inputfile) 
-00017b80: 656c 7365 2027 2e27 0a20 2020 2020 2020  else '.'.       
-00017b90: 2070 7265 5f62 6173 6520 3d20 6f73 2e70   pre_base = os.p
-00017ba0: 6174 682e 7370 6c69 7465 7874 286f 732e  ath.splitext(os.
-00017bb0: 7061 7468 2e62 6173 656e 616d 6528 696e  path.basename(in
-00017bc0: 7075 7466 696c 6529 295b 305d 0a20 2020  putfile))[0].   
-00017bd0: 2020 2020 2070 7265 5f73 6372 6970 7420       pre_script 
-00017be0: 3d20 6627 7b69 6e70 7574 6469 727d 2f6b  = f'{inputdir}/k
-00017bf0: 636c 695f 7072 652e 7368 2720 6966 2070  cli_pre.sh' if p
-00017c00: 7265 5f62 6173 6520 3d3d 2027 6b63 6c69  re_base == 'kcli
-00017c10: 5f70 6c61 6e27 2065 6c73 6520 6622 7b69  _plan' else f"{i
-00017c20: 6e70 7574 6469 727d 2f7b 7072 655f 6261  nputdir}/{pre_ba
-00017c30: 7365 7d5f 7072 652e 7368 220a 2020 2020  se}_pre.sh".    
-00017c40: 2020 2020 6966 206f 732e 7061 7468 2e65      if os.path.e
-00017c50: 7869 7374 7328 7072 655f 7363 7269 7074  xists(pre_script
-00017c60: 293a 0a20 2020 2020 2020 2020 2020 2070  ):.            p
-00017c70: 7265 5f73 6372 6970 745f 7368 6f72 7420  re_script_short 
-00017c80: 3d20 6f73 2e70 6174 682e 6261 7365 6e61  = os.path.basena
-00017c90: 6d65 2870 7265 5f73 6372 6970 7429 0a20  me(pre_script). 
-00017ca0: 2020 2020 2020 2020 2020 2069 6620 7072             if pr
-00017cb0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00017cc0: 2020 2070 7072 696e 7428 6622 5275 6e6e     pprint(f"Runn
-00017cd0: 696e 6720 7b70 7265 5f73 6372 6970 745f  ing {pre_script_
-00017ce0: 7368 6f72 747d 2229 0a20 2020 2020 2020  short}").       
-00017cf0: 2020 2020 2020 2020 2077 6974 6820 5465           with Te
-00017d00: 6d70 6f72 6172 7944 6972 6563 746f 7279  mporaryDirectory
-00017d10: 2829 2061 7320 746d 7064 6972 3a0a 2020  () as tmpdir:.  
-00017d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017d30: 2020 7072 655f 7363 7269 7074 203d 2073    pre_script = s
-00017d40: 656c 662e 7072 6f63 6573 735f 696e 7075  elf.process_inpu
-00017d50: 7466 696c 6528 2778 7878 272c 2070 7265  tfile('xxx', pre
-00017d60: 5f73 6372 6970 742c 206f 7665 7272 6964  _script, overrid
-00017d70: 6573 3d6f 7665 7272 6964 6573 290a 2020  es=overrides).  
-00017d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017d90: 2020 7769 7468 206f 7065 6e28 6622 7b74    with open(f"{t
-00017da0: 6d70 6469 727d 2f70 7265 2e73 6822 2c20  mpdir}/pre.sh", 
-00017db0: 2777 2729 2061 7320 663a 0a20 2020 2020  'w') as f:.     
-00017dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017dd0: 2020 2066 2e77 7269 7465 2870 7265 5f73     f.write(pre_s
-00017de0: 6372 6970 7429 0a20 2020 2020 2020 2020  cript).         
-00017df0: 2020 2020 2020 2020 2020 2070 7265 5f72             pre_r
-00017e00: 756e 203d 2072 756e 2866 2762 6173 6820  un = run(f'bash 
-00017e10: 7b74 6d70 6469 727d 2f70 7265 2e73 6827  {tmpdir}/pre.sh'
-00017e20: 2c20 7368 656c 6c3d 5472 7565 2c20 7374  , shell=True, st
-00017e30: 646f 7574 3d50 4950 452c 2073 7464 6572  dout=PIPE, stder
-00017e40: 723d 5354 444f 5554 2c0a 2020 2020 2020  r=STDOUT,.      
-00017e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017e60: 2020 2020 2020 2020 2020 2020 756e 6976              univ
-00017e70: 6572 7361 6c5f 6e65 776c 696e 6573 3d54  ersal_newlines=T
-00017e80: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
-00017e90: 2020 2020 2020 2020 2069 6620 7072 655f           if pre_
-00017ea0: 7275 6e2e 7265 7475 726e 636f 6465 2021  run.returncode !
-00017eb0: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
-00017ec0: 2020 2020 2020 2020 2020 2020 206d 7367               msg
-00017ed0: 203d 2066 2249 7373 7565 2077 6865 6e20   = f"Issue when 
-00017ee0: 7275 6e6e 696e 6720 7b70 7265 5f73 6372  running {pre_scr
-00017ef0: 6970 745f 7368 6f72 747d 203a 5c6e 7b70  ipt_short} :\n{p
-00017f00: 7265 5f72 756e 2e73 7464 6f75 747d 220a  re_run.stdout}".
-00017f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017f20: 2020 2020 2020 2020 6572 726f 7228 6d73          error(ms
-00017f30: 6729 0a20 2020 2020 2020 2020 2020 2020  g).             
-00017f40: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00017f50: 6e20 7b27 7265 7375 6c74 273a 2027 6661  n {'result': 'fa
-00017f60: 696c 7572 6527 2c20 2772 6561 736f 6e27  ilure', 'reason'
-00017f70: 3a20 6d73 677d 0a20 2020 2020 2020 2020  : msg}.         
-00017f80: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00017f90: 2020 2020 2020 2020 2077 6172 6e69 6e67           warning
-00017fa0: 2866 2253 6b69 7070 696e 6720 7b70 7265  (f"Skipping {pre
-00017fb0: 5f73 6372 6970 745f 7368 6f72 747d 2061  _script_short} a
-00017fc0: 7320 7265 7175 6573 7465 6422 290a 2020  s requested").  
-00017fd0: 2020 2020 2020 6b65 7977 6f72 6473 203d        keywords =
-00017fe0: 2073 656c 662e 6c69 7374 5f6b 6579 776f   self.list_keywo
-00017ff0: 7264 7328 290a 2020 2020 2020 2020 666f  rds().        fo
-00018000: 7220 6b65 7920 696e 2073 6f72 7465 6428  r key in sorted(
-00018010: 6f76 6572 7269 6465 7329 3a0a 2020 2020  overrides):.    
-00018020: 2020 2020 2020 2020 6966 206b 6579 2069          if key i
-00018030: 6e20 6b65 7977 6f72 6473 3a0a 2020 2020  n keywords:.    
-00018040: 2020 2020 2020 2020 2020 2020 6b65 795f              key_
-00018050: 7661 6c75 6520 3d20 6765 7461 7474 7228  value = getattr(
-00018060: 7365 6c66 2c20 6b65 7929 0a20 2020 2020  self, key).     
-00018070: 2020 2020 2020 2020 2020 206b 6579 5f74             key_t
-00018080: 7970 6520 3d20 7479 7065 286b 6579 5f76  ype = type(key_v
-00018090: 616c 7565 290a 2020 2020 2020 2020 2020  alue).          
-000180a0: 2020 2020 2020 6f76 6572 7269 6465 5f6b        override_k
-000180b0: 6579 5f74 7970 6520 3d20 7479 7065 286f  ey_type = type(o
-000180c0: 7665 7272 6964 6573 5b6b 6579 5d29 0a20  verrides[key]). 
-000180d0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000180e0: 6620 6b65 795f 7661 6c75 6520 6973 206e  f key_value is n
-000180f0: 6f74 204e 6f6e 6520 616e 6420 6f76 6572  ot None and over
-00018100: 7269 6465 735b 6b65 795d 2069 7320 6e6f  rides[key] is no
-00018110: 7420 4e6f 6e65 2061 6e64 206b 6579 5f74  t None and key_t
-00018120: 7970 6520 213d 206f 7665 7272 6964 655f  ype != override_
-00018130: 6b65 795f 7479 7065 3a0a 2020 2020 2020  key_type:.      
-00018140: 2020 2020 2020 2020 2020 2020 2020 6572                er
-00018150: 726f 7228 6622 5468 6520 7072 6f76 6964  ror(f"The provid
-00018160: 6564 2070 6172 616d 6574 6572 207b 6b65  ed parameter {ke
-00018170: 797d 2068 6173 2061 2077 726f 6e67 2074  y} has a wrong t
-00018180: 7970 6520 7b6f 7665 7272 6964 655f 6b65  ype {override_ke
-00018190: 795f 7479 7065 7d2c 2069 7420 7368 6f75  y_type}, it shou
-000181a0: 6c64 2062 6520 7b6b 6579 5f74 7970 657d  ld be {key_type}
-000181b0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-000181c0: 2020 2020 2020 2073 7973 2e65 7869 7428         sys.exit(
-000181d0: 3129 0a20 2020 2020 2020 2020 2020 2020  1).             
-000181e0: 2020 2065 6c69 6620 6f76 6572 7269 6465     elif override
-000181f0: 735b 6b65 795d 2069 7320 6e6f 7420 4e6f  s[key] is not No
-00018200: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00018210: 2020 2020 2020 2020 7365 7461 7474 7228          setattr(
-00018220: 7365 6c66 2c20 6b65 792c 206f 7665 7272  self, key, overr
-00018230: 6964 6573 5b6b 6579 5d29 0a20 2020 2020  ides[key]).     
-00018240: 2020 2076 6d65 6e74 7269 6573 203d 205b     vmentries = [
-00018250: 656e 7472 7920 666f 7220 656e 7472 7920  entry for entry 
-00018260: 696e 2065 6e74 7269 6573 2069 6620 2774  in entries if 't
-00018270: 7970 6527 206e 6f74 2069 6e20 656e 7472  ype' not in entr
-00018280: 6965 735b 656e 7472 795d 206f 7220 656e  ies[entry] or en
-00018290: 7472 6965 735b 656e 7472 795d 5b27 7479  tries[entry]['ty
-000182a0: 7065 275d 203d 3d20 2776 6d27 5d0a 2020  pe'] == 'vm'].  
-000182b0: 2020 2020 2020 6469 736b 656e 7472 6965        diskentrie
-000182c0: 7320 3d20 5b65 6e74 7279 2066 6f72 2065  s = [entry for e
-000182d0: 6e74 7279 2069 6e20 656e 7472 6965 7320  ntry in entries 
-000182e0: 6966 2027 7479 7065 2720 696e 2065 6e74  if 'type' in ent
-000182f0: 7269 6573 5b65 6e74 7279 5d20 616e 6420  ries[entry] and 
-00018300: 656e 7472 6965 735b 656e 7472 795d 5b27  entries[entry]['
-00018310: 7479 7065 275d 203d 3d20 2764 6973 6b27  type'] == 'disk'
-00018320: 5d0a 2020 2020 2020 2020 6e65 7477 6f72  ].        networ
-00018330: 6b65 6e74 7269 6573 203d 205b 656e 7472  kentries = [entr
-00018340: 7920 666f 7220 656e 7472 7920 696e 2065  y for entry in e
-00018350: 6e74 7269 6573 0a20 2020 2020 2020 2020  ntries.         
-00018360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018370: 2069 6620 2774 7970 6527 2069 6e20 656e   if 'type' in en
-00018380: 7472 6965 735b 656e 7472 795d 2061 6e64  tries[entry] and
-00018390: 2065 6e74 7269 6573 5b65 6e74 7279 5d5b   entries[entry][
-000183a0: 2774 7970 6527 5d20 3d3d 2027 6e65 7477  'type'] == 'netw
-000183b0: 6f72 6b27 5d0a 2020 2020 2020 2020 636f  ork'].        co
-000183c0: 6e74 6169 6e65 7265 6e74 7269 6573 203d  ntainerentries =
-000183d0: 205b 656e 7472 7920 666f 7220 656e 7472   [entry for entr
-000183e0: 7920 696e 2065 6e74 7269 6573 0a20 2020  y in entries.   
-000183f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018400: 2020 2020 2020 2020 2069 6620 2774 7970           if 'typ
-00018410: 6527 2069 6e20 656e 7472 6965 735b 656e  e' in entries[en
-00018420: 7472 795d 2061 6e64 2065 6e74 7269 6573  try] and entries
-00018430: 5b65 6e74 7279 5d5b 2774 7970 6527 5d20  [entry]['type'] 
-00018440: 3d3d 2027 636f 6e74 6169 6e65 7227 5d0a  == 'container'].
-00018450: 2020 2020 2020 2020 616e 7369 626c 6565          ansiblee
-00018460: 6e74 7269 6573 203d 205b 656e 7472 7920  ntries = [entry 
-00018470: 666f 7220 656e 7472 7920 696e 2065 6e74  for entry in ent
-00018480: 7269 6573 0a20 2020 2020 2020 2020 2020  ries.           
-00018490: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000184a0: 6620 2774 7970 6527 2069 6e20 656e 7472  f 'type' in entr
-000184b0: 6965 735b 656e 7472 795d 2061 6e64 2065  ies[entry] and e
-000184c0: 6e74 7269 6573 5b65 6e74 7279 5d5b 2774  ntries[entry]['t
-000184d0: 7970 6527 5d20 3d3d 2027 616e 7369 626c  ype'] == 'ansibl
-000184e0: 6527 5d0a 2020 2020 2020 2020 7072 6f66  e'].        prof
-000184f0: 696c 6565 6e74 7269 6573 203d 205b 656e  ileentries = [en
-00018500: 7472 7920 666f 7220 656e 7472 7920 696e  try for entry in
-00018510: 2065 6e74 7269 6573 0a20 2020 2020 2020   entries.       
-00018520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018530: 2020 2069 6620 2774 7970 6527 2069 6e20     if 'type' in 
-00018540: 656e 7472 6965 735b 656e 7472 795d 2061  entries[entry] a
-00018550: 6e64 2065 6e74 7269 6573 5b65 6e74 7279  nd entries[entry
-00018560: 5d5b 2774 7970 6527 5d20 3d3d 2027 7072  ]['type'] == 'pr
-00018570: 6f66 696c 6527 5d0a 2020 2020 2020 2020  ofile'].        
-00018580: 696d 6167 6565 6e74 7269 6573 203d 205b  imageentries = [
-00018590: 656e 7472 7920 666f 7220 656e 7472 7920  entry for entry 
-000185a0: 696e 2065 6e74 7269 6573 2069 6620 2774  in entries if 't
-000185b0: 7970 6527 2069 6e0a 2020 2020 2020 2020  ype' in.        
-000185c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000185d0: 656e 7472 6965 735b 656e 7472 795d 2061  entries[entry] a
-000185e0: 6e64 2028 656e 7472 6965 735b 656e 7472  nd (entries[entr
-000185f0: 795d 5b27 7479 7065 275d 203d 3d20 2769  y]['type'] == 'i
-00018600: 6d61 6765 2720 6f72 2065 6e74 7269 6573  mage' or entries
-00018610: 5b65 6e74 7279 5d5b 2774 7970 6527 5d20  [entry]['type'] 
-00018620: 3d3d 2027 7465 6d70 6c61 7465 2729 5d0a  == 'template')].
-00018630: 2020 2020 2020 2020 706f 6f6c 656e 7472          poolentr
-00018640: 6965 7320 3d20 5b65 6e74 7279 2066 6f72  ies = [entry for
-00018650: 2065 6e74 7279 2069 6e20 656e 7472 6965   entry in entrie
-00018660: 7320 6966 2027 7479 7065 2720 696e 2065  s if 'type' in e
-00018670: 6e74 7269 6573 5b65 6e74 7279 5d20 616e  ntries[entry] an
-00018680: 6420 656e 7472 6965 735b 656e 7472 795d  d entries[entry]
-00018690: 5b27 7479 7065 275d 203d 3d20 2770 6f6f  ['type'] == 'poo
-000186a0: 6c27 5d0a 2020 2020 2020 2020 706c 616e  l'].        plan
-000186b0: 656e 7472 6965 7320 3d20 5b65 6e74 7279  entries = [entry
-000186c0: 2066 6f72 2065 6e74 7279 2069 6e20 656e   for entry in en
-000186d0: 7472 6965 7320 6966 2027 7479 7065 2720  tries if 'type' 
-000186e0: 696e 2065 6e74 7269 6573 5b65 6e74 7279  in entries[entry
-000186f0: 5d20 616e 6420 656e 7472 6965 735b 656e  ] and entries[en
-00018700: 7472 795d 5b27 7479 7065 275d 203d 3d20  try]['type'] == 
-00018710: 2770 6c61 6e27 5d0a 2020 2020 2020 2020  'plan'].        
-00018720: 646e 7365 6e74 7269 6573 203d 205b 656e  dnsentries = [en
-00018730: 7472 7920 666f 7220 656e 7472 7920 696e  try for entry in
-00018740: 2065 6e74 7269 6573 2069 6620 2774 7970   entries if 'typ
-00018750: 6527 2069 6e20 656e 7472 6965 735b 656e  e' in entries[en
-00018760: 7472 795d 2061 6e64 2065 6e74 7269 6573  try] and entries
-00018770: 5b65 6e74 7279 5d5b 2774 7970 6527 5d20  [entry]['type'] 
-00018780: 3d3d 2027 646e 7327 5d0a 2020 2020 2020  == 'dns'].      
-00018790: 2020 6b75 6265 7320 3d20 5b27 6b75 6265    kubes = ['kube
-000187a0: 272c 2027 636c 7573 7465 7227 5d0a 2020  ', 'cluster'].  
-000187b0: 2020 2020 2020 6b75 6265 656e 7472 6965        kubeentrie
-000187c0: 7320 3d20 5b65 6e74 7279 2066 6f72 2065  s = [entry for e
-000187d0: 6e74 7279 2069 6e20 656e 7472 6965 7320  ntry in entries 
-000187e0: 6966 2027 7479 7065 2720 696e 2065 6e74  if 'type' in ent
-000187f0: 7269 6573 5b65 6e74 7279 5d20 616e 6420  ries[entry] and 
-00018800: 656e 7472 6965 735b 656e 7472 795d 5b27  entries[entry]['
-00018810: 7479 7065 275d 2069 6e20 6b75 6265 735d  type'] in kubes]
-00018820: 0a20 2020 2020 2020 206c 6273 203d 205b  .        lbs = [
-00018830: 656e 7472 7920 666f 7220 656e 7472 7920  entry for entry 
-00018840: 696e 2065 6e74 7269 6573 2069 6620 2774  in entries if 't
-00018850: 7970 6527 2069 6e20 656e 7472 6965 735b  ype' in entries[
-00018860: 656e 7472 795d 2061 6e64 2065 6e74 7269  entry] and entri
-00018870: 6573 5b65 6e74 7279 5d5b 2774 7970 6527  es[entry]['type'
-00018880: 5d20 3d3d 2027 6c6f 6164 6261 6c61 6e63  ] == 'loadbalanc
-00018890: 6572 275d 0a20 2020 2020 2020 2073 6773  er'].        sgs
-000188a0: 203d 205b 656e 7472 7920 666f 7220 656e   = [entry for en
-000188b0: 7472 7920 696e 2065 6e74 7269 6573 2069  try in entries i
-000188c0: 6620 2774 7970 6527 2069 6e20 656e 7472  f 'type' in entr
-000188d0: 6965 735b 656e 7472 795d 2061 6e64 2065  ies[entry] and e
-000188e0: 6e74 7269 6573 5b65 6e74 7279 5d5b 2774  ntries[entry]['t
-000188f0: 7970 6527 5d20 3d3d 2027 7365 6375 7269  ype'] == 'securi
-00018900: 7479 6772 6f75 7027 5d0a 2020 2020 2020  tygroup'].      
-00018910: 2020 6275 636b 6574 656e 7472 6965 7320    bucketentries 
-00018920: 3d20 5b65 6e74 7279 2066 6f72 2065 6e74  = [entry for ent
-00018930: 7279 2069 6e20 656e 7472 6965 7320 6966  ry in entries if
-00018940: 2027 7479 7065 2720 696e 2065 6e74 7269   'type' in entri
-00018950: 6573 5b65 6e74 7279 5d20 616e 6420 656e  es[entry] and en
-00018960: 7472 6965 735b 656e 7472 795d 5b27 7479  tries[entry]['ty
-00018970: 7065 275d 203d 3d20 2762 7563 6b65 7427  pe'] == 'bucket'
-00018980: 5d0a 2020 2020 2020 2020 776f 726b 666c  ].        workfl
-00018990: 6f77 656e 7472 6965 7320 3d20 5b65 6e74  owentries = [ent
-000189a0: 7279 2066 6f72 2065 6e74 7279 2069 6e20  ry for entry in 
-000189b0: 656e 7472 6965 730a 2020 2020 2020 2020  entries.        
-000189c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000189d0: 2020 2069 6620 2774 7970 6527 2069 6e20     if 'type' in 
-000189e0: 656e 7472 6965 735b 656e 7472 795d 2061  entries[entry] a
-000189f0: 6e64 2065 6e74 7269 6573 5b65 6e74 7279  nd entries[entry
-00018a00: 5d5b 2774 7970 6527 5d20 3d3d 2027 776f  ]['type'] == 'wo
-00018a10: 726b 666c 6f77 275d 0a20 2020 2020 2020  rkflow'].       
-00018a20: 2066 6f72 2070 2069 6e20 7072 6f66 696c   for p in profil
-00018a30: 6565 6e74 7269 6573 3a0a 2020 2020 2020  eentries:.      
-00018a40: 2020 2020 2020 766d 7072 6f66 696c 6573        vmprofiles
-00018a50: 5b70 5d20 3d20 656e 7472 6965 735b 705d  [p] = entries[p]
-00018a60: 0a20 2020 2020 2020 2069 6620 6e65 7477  .        if netw
-00018a70: 6f72 6b65 6e74 7269 6573 2061 6e64 206e  orkentries and n
-00018a80: 6f74 206f 6e6c 7961 7373 6574 733a 0a20  ot onlyassets:. 
-00018a90: 2020 2020 2020 2020 2020 2070 7072 696e             pprin
-00018aa0: 7428 2244 6570 6c6f 7969 6e67 204e 6574  t("Deploying Net
-00018ab0: 776f 726b 732e 2e2e 2229 0a20 2020 2020  works...").     
-00018ac0: 2020 2020 2020 2066 6f72 206e 6574 2069         for net i
-00018ad0: 6e20 6e65 7477 6f72 6b65 6e74 7269 6573  n networkentries
-00018ae0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00018af0: 2020 6e65 7470 726f 6669 6c65 203d 2065    netprofile = e
-00018b00: 6e74 7269 6573 5b6e 6574 5d0a 2020 2020  ntries[net].    
-00018b10: 2020 2020 2020 2020 2020 2020 6966 206b              if k
-00018b20: 2e6e 6574 5f65 7869 7374 7328 6e65 7429  .net_exists(net)
-00018b30: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00018b40: 2020 2020 2020 7070 7269 6e74 2866 224e        pprint(f"N
-00018b50: 6574 776f 726b 207b 6e65 747d 2073 6b69  etwork {net} ski
-00018b60: 7070 6564 2122 290a 2020 2020 2020 2020  pped!").        
-00018b70: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
-00018b80: 696e 7565 0a20 2020 2020 2020 2020 2020  inue.           
-00018b90: 2020 2020 2063 6964 7220 3d20 6e65 7470       cidr = netp
-00018ba0: 726f 6669 6c65 2e67 6574 2827 6369 6472  rofile.get('cidr
-00018bb0: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
-00018bc0: 2020 206e 6174 203d 2062 6f6f 6c28 6e65     nat = bool(ne
-00018bd0: 7470 726f 6669 6c65 2e67 6574 2827 6e61  tprofile.get('na
-00018be0: 7427 2c20 5472 7565 2929 0a20 2020 2020  t', True)).     
-00018bf0: 2020 2020 2020 2020 2020 2069 6620 6369             if ci
-00018c00: 6472 2069 7320 4e6f 6e65 3a0a 2020 2020  dr is None:.    
-00018c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018c20: 7761 726e 696e 6728 6622 4d69 7373 696e  warning(f"Missin
-00018c30: 6720 4369 6472 2066 6f72 206e 6574 776f  g Cidr for netwo
-00018c40: 726b 207b 6e65 747d 2e20 4e6f 7420 6372  rk {net}. Not cr
-00018c50: 6561 7469 6e67 2069 742e 2e2e 2229 0a20  eating it..."). 
-00018c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018c70: 2020 2063 6f6e 7469 6e75 650a 2020 2020     continue.    
-00018c80: 2020 2020 2020 2020 2020 2020 6468 6370              dhcp
-00018c90: 203d 206e 6574 7072 6f66 696c 652e 6765   = netprofile.ge
-00018ca0: 7428 2764 6863 7027 2c20 5472 7565 290a  t('dhcp', True).
-00018cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018cc0: 646f 6d61 696e 203d 206e 6574 7072 6f66  domain = netprof
-00018cd0: 696c 652e 6765 7428 2764 6f6d 6169 6e27  ile.get('domain'
-00018ce0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00018cf0: 2020 7265 7375 6c74 203d 206b 2e63 7265    result = k.cre
-00018d00: 6174 655f 6e65 7477 6f72 6b28 6e61 6d65  ate_network(name
-00018d10: 3d6e 6574 2c20 6369 6472 3d63 6964 722c  =net, cidr=cidr,
-00018d20: 2064 6863 703d 6468 6370 2c20 6e61 743d   dhcp=dhcp, nat=
-00018d30: 6e61 742c 2064 6f6d 6169 6e3d 646f 6d61  nat, domain=doma
-00018d40: 696e 2c20 706c 616e 3d70 6c61 6e2c 0a20  in, plan=plan,. 
-00018d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018d70: 2020 2020 2020 2020 206f 7665 7272 6964           overrid
-00018d80: 6573 3d6e 6574 7072 6f66 696c 6529 0a20  es=netprofile). 
-00018d90: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00018da0: 6f6d 6d6f 6e2e 6861 6e64 6c65 5f72 6573  ommon.handle_res
-00018db0: 706f 6e73 6528 7265 7375 6c74 2c20 6e65  ponse(result, ne
-00018dc0: 742c 2065 6c65 6d65 6e74 3d27 4e65 7477  t, element='Netw
-00018dd0: 6f72 6b20 2729 0a20 2020 2020 2020 2069  ork ').        i
-00018de0: 6620 706f 6f6c 656e 7472 6965 7320 616e  f poolentries an
-00018df0: 6420 6e6f 7420 6f6e 6c79 6173 7365 7473  d not onlyassets
-00018e00: 3a0a 2020 2020 2020 2020 2020 2020 7070  :.            pp
-00018e10: 7269 6e74 2822 4465 706c 6f79 696e 6720  rint("Deploying 
-00018e20: 506f 6f6c 732e 2e2e 2229 0a20 2020 2020  Pools...").     
-00018e30: 2020 2020 2020 2070 6f6f 6c73 203d 206b         pools = k
-00018e40: 2e6c 6973 745f 706f 6f6c 7328 290a 2020  .list_pools().  
-00018e50: 2020 2020 2020 2020 2020 666f 7220 706f            for po
-00018e60: 6f6c 2069 6e20 706f 6f6c 656e 7472 6965  ol in poolentrie
-00018e70: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-00018e80: 2020 2069 6620 706f 6f6c 2069 6e20 706f     if pool in po
-00018e90: 6f6c 733a 0a20 2020 2020 2020 2020 2020  ols:.           
-00018ea0: 2020 2020 2020 2020 2070 7072 696e 7428           pprint(
-00018eb0: 6622 506f 6f6c 207b 706f 6f6c 7d20 736b  f"Pool {pool} sk
-00018ec0: 6970 7065 6421 2229 0a20 2020 2020 2020  ipped!").       
-00018ed0: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-00018ee0: 7469 6e75 650a 2020 2020 2020 2020 2020  tinue.          
-00018ef0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00018f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018f10: 706f 6f6c 7072 6f66 696c 6520 3d20 656e  poolprofile = en
-00018f20: 7472 6965 735b 706f 6f6c 5d0a 2020 2020  tries[pool].    
-00018f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018f40: 706f 6f6c 7061 7468 203d 2070 6f6f 6c70  poolpath = poolp
-00018f50: 726f 6669 6c65 2e67 6574 2827 7061 7468  rofile.get('path
-00018f60: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
-00018f70: 2020 2020 2020 2069 6620 706f 6f6c 7061         if poolpa
-00018f80: 7468 2069 7320 4e6f 6e65 3a0a 2020 2020  th is None:.    
+000171f0: 2020 2020 2020 636f 6d6d 6f6e 2e66 6574        common.fet
+00017200: 6368 2866 227b 6f6e 666c 797d 2f7b 7363  ch(f"{onfly}/{sc
+00017210: 7269 7074 7d22 2c20 6465 7374 6469 7229  ript}", destdir)
+00017220: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017230: 206f 732e 6368 6469 7228 272e 2e27 290a   os.chdir('..').
+00017240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017250: 7265 7475 726e 207b 2772 6573 756c 7427  return {'result'
+00017260: 3a20 2773 7563 6365 7373 277d 0a20 2020  : 'success'}.   
+00017270: 2020 2020 2069 6620 696e 7075 7473 7472       if inputstr
+00017280: 696e 6720 6973 206e 6f74 204e 6f6e 653a  ing is not None:
+00017290: 0a20 2020 2020 2020 2020 2020 2069 6e70  .            inp
+000172a0: 7574 6669 6c65 203d 2066 2274 656d 705f  utfile = f"temp_
+000172b0: 706c 616e 5f7b 706c 616e 7d2e 796d 6c22  plan_{plan}.yml"
+000172c0: 0a20 2020 2020 2020 2020 2020 2077 6974  .            wit
+000172d0: 6820 6f70 656e 2869 6e70 7574 6669 6c65  h open(inputfile
+000172e0: 2c20 2277 2229 2061 7320 663a 0a20 2020  , "w") as f:.   
+000172f0: 2020 2020 2020 2020 2020 2020 2066 2e77               f.w
+00017300: 7269 7465 2869 6e70 7574 7374 7269 6e67  rite(inputstring
+00017310: 290a 2020 2020 2020 2020 6966 2069 6e70  ).        if inp
+00017320: 7574 6669 6c65 2069 7320 4e6f 6e65 3a0a  utfile is None:.
+00017330: 2020 2020 2020 2020 2020 2020 696e 7075              inpu
+00017340: 7466 696c 6520 3d20 276b 636c 695f 706c  tfile = 'kcli_pl
+00017350: 616e 2e79 6d6c 270a 2020 2020 2020 2020  an.yml'.        
+00017360: 2020 2020 7070 7269 6e74 2822 7573 696e      pprint("usin
+00017370: 6720 6465 6661 756c 7420 696e 7075 7420  g default input 
+00017380: 6669 6c65 206b 636c 695f 706c 616e 2e79  file kcli_plan.y
+00017390: 6d6c 2229 0a20 2020 2020 2020 2069 6620  ml").        if 
+000173a0: 7061 7468 2069 7320 6e6f 7420 4e6f 6e65  path is not None
+000173b0: 3a0a 2020 2020 2020 2020 2020 2020 6f73  :.            os
+000173c0: 2e63 6864 6972 2870 6174 6829 0a20 2020  .chdir(path).   
+000173d0: 2020 2020 2020 2020 2067 6574 6261 636b           getback
+000173e0: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
+000173f0: 696e 7075 7466 696c 6520 3d20 6f73 2e70  inputfile = os.p
+00017400: 6174 682e 6578 7061 6e64 7573 6572 2869  ath.expanduser(i
+00017410: 6e70 7574 6669 6c65 290a 2020 2020 2020  nputfile).      
+00017420: 2020 6966 206e 6f74 206f 732e 7061 7468    if not os.path
+00017430: 2e65 7869 7374 7328 696e 7075 7466 696c  .exists(inputfil
+00017440: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
+00017450: 6572 726f 7228 6622 496e 7075 7420 6669  error(f"Input fi
+00017460: 6c65 207b 696e 7075 7466 696c 657d 206e  le {inputfile} n
+00017470: 6f74 2066 6f75 6e64 2e4c 6561 7669 6e67  ot found.Leaving
+00017480: 2e2e 2e2e 2229 0a20 2020 2020 2020 2020  ....").         
+00017490: 2020 2073 7973 2e65 7869 7428 3129 0a20     sys.exit(1). 
+000174a0: 2020 2020 2020 2065 6c69 6620 6f73 2e70         elif os.p
+000174b0: 6174 682e 6973 6469 7228 696e 7075 7466  ath.isdir(inputf
+000174c0: 696c 6529 3a0a 2020 2020 2020 2020 2020  ile):.          
+000174d0: 2020 696e 7075 7466 696c 6520 3d20 6622    inputfile = f"
+000174e0: 7b69 6e70 7574 6669 6c65 7d2f 6b63 6c69  {inputfile}/kcli
+000174f0: 5f70 6c61 6e2e 796d 6c22 0a20 2020 2020  _plan.yml".     
+00017500: 2020 2069 6620 696e 666f 3a0a 2020 2020     if info:.    
+00017510: 2020 2020 2020 2020 7365 6c66 2e69 6e66          self.inf
+00017520: 6f5f 706c 616e 2869 6e70 7574 6669 6c65  o_plan(inputfile
+00017530: 2c20 6f6e 666c 793d 6f6e 666c 792c 2071  , onfly=onfly, q
+00017540: 7569 6574 3d71 7569 6574 2c20 646f 633d  uiet=quiet, doc=
+00017550: 646f 6329 0a20 2020 2020 2020 2020 2020  doc).           
+00017560: 2069 6620 746f 636c 6561 6e3a 0a20 2020   if toclean:.   
+00017570: 2020 2020 2020 2020 2020 2020 206f 732e               os.
+00017580: 6368 6469 7228 272e 2e27 290a 2020 2020  chdir('..').    
+00017590: 2020 2020 2020 2020 2020 2020 726d 7472              rmtr
+000175a0: 6565 2870 6174 6829 0a20 2020 2020 2020  ee(path).       
+000175b0: 2020 2020 2072 6574 7572 6e20 7b27 7265       return {'re
+000175c0: 7375 6c74 273a 2027 7375 6363 6573 7327  sult': 'success'
+000175d0: 7d0a 2020 2020 2020 2020 6261 7365 656e  }.        baseen
+000175e0: 7472 6965 7320 3d20 7b7d 0a20 2020 2020  tries = {}.     
+000175f0: 2020 2065 6e74 7269 6573 2c20 6f76 6572     entries, over
+00017600: 7269 6465 732c 2062 6173 6566 696c 652c  rides, basefile,
+00017610: 2062 6173 6564 6972 203d 2073 656c 662e   basedir = self.
+00017620: 7072 6f63 6573 735f 696e 7075 7466 696c  process_inputfil
+00017630: 6528 706c 616e 2c20 696e 7075 7466 696c  e(plan, inputfil
+00017640: 652c 206f 7665 7272 6964 6573 3d6f 7665  e, overrides=ove
+00017650: 7272 6964 6573 2c0a 2020 2020 2020 2020  rrides,.        
+00017660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017690: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+000176a0: 6e66 6c79 3d6f 6e66 6c79 2c20 6675 6c6c  nfly=onfly, full
+000176b0: 3d54 7275 6529 0a20 2020 2020 2020 2069  =True).        i
+000176c0: 6620 6261 7365 6669 6c65 2069 7320 6e6f  f basefile is no
+000176d0: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+000176e0: 2020 2020 6261 7365 696e 666f 203d 2073      baseinfo = s
+000176f0: 656c 662e 7072 6f63 6573 735f 696e 7075  elf.process_inpu
+00017700: 7466 696c 6528 706c 616e 2c20 6622 7b62  tfile(plan, f"{b
+00017710: 6173 6564 6972 7d2f 7b62 6173 6566 696c  asedir}/{basefil
+00017720: 657d 222c 206f 7665 7272 6964 6573 3d6f  e}", overrides=o
+00017730: 7665 7272 6964 6573 2c20 6675 6c6c 3d54  verrides, full=T
+00017740: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
+00017750: 2062 6173 6565 6e74 7269 6573 2c20 6261   baseentries, ba
+00017760: 7365 6f76 6572 7269 6465 7320 3d20 6261  seoverrides = ba
+00017770: 7365 696e 666f 5b30 5d2c 2062 6173 6569  seinfo[0], basei
+00017780: 6e66 6f5b 315d 0a20 2020 2020 2020 2020  nfo[1].         
+00017790: 2020 2069 6620 6261 7365 6f76 6572 7269     if baseoverri
+000177a0: 6465 733a 0a20 2020 2020 2020 2020 2020  des:.           
+000177b0: 2020 2020 206f 7665 7272 6964 6573 2e75       overrides.u
+000177c0: 7064 6174 6528 7b6b 6579 3a20 6261 7365  pdate({key: base
+000177d0: 6f76 6572 7269 6465 735b 6b65 795d 2066  overrides[key] f
+000177e0: 6f72 206b 6579 2069 6e20 6261 7365 6f76  or key in baseov
+000177f0: 6572 7269 6465 7320 6966 206b 6579 206e  errides if key n
+00017800: 6f74 2069 6e20 6f76 6572 7269 6465 737d  ot in overrides}
+00017810: 290a 2020 2020 2020 2020 6966 2065 6e74  ).        if ent
+00017820: 7269 6573 2069 7320 4e6f 6e65 3a0a 2020  ries is None:.  
+00017830: 2020 2020 2020 2020 2020 656e 7472 6965            entrie
+00017840: 7320 3d20 7b7d 0a20 2020 2020 2020 2069  s = {}.        i
+00017850: 6620 7365 6c66 2e64 6562 7567 3a0a 2020  f self.debug:.  
+00017860: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+00017870: 7961 6d6c 2e64 756d 7028 656e 7472 6965  yaml.dump(entrie
+00017880: 7329 290a 2020 2020 2020 2020 7061 7261  s)).        para
+00017890: 6d65 7465 7273 203d 2065 6e74 7269 6573  meters = entries
+000178a0: 2e67 6574 2827 7061 7261 6d65 7465 7273  .get('parameters
+000178b0: 2729 0a20 2020 2020 2020 2069 6620 7061  ').        if pa
+000178c0: 7261 6d65 7465 7273 2069 7320 6e6f 7420  rameters is not 
+000178d0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+000178e0: 2020 6465 6c20 656e 7472 6965 735b 2770    del entries['p
+000178f0: 6172 616d 6574 6572 7327 5d0a 2020 2020  arameters'].    
+00017900: 2020 2020 6469 6374 5f74 7970 6573 203d      dict_types =
+00017910: 205b 656e 7472 7920 666f 7220 656e 7472   [entry for entr
+00017920: 7920 696e 2065 6e74 7269 6573 2069 6620  y in entries if 
+00017930: 6973 696e 7374 616e 6365 2865 6e74 7269  isinstance(entri
+00017940: 6573 5b65 6e74 7279 5d2c 2064 6963 7429  es[entry], dict)
+00017950: 5d0a 2020 2020 2020 2020 6966 206e 6f74  ].        if not
+00017960: 2064 6963 745f 7479 7065 733a 0a20 2020   dict_types:.   
+00017970: 2020 2020 2020 2020 2069 6620 6261 7365           if base
+00017980: 6d6f 6465 3a0a 2020 2020 2020 2020 2020  mode:.          
+00017990: 2020 2020 2020 7761 726e 696e 6728 6622        warning(f"
+000179a0: 7b69 6e70 7574 6669 6c65 7d20 646f 6573  {inputfile} does
+000179b0: 6e27 7420 6c6f 6f6b 206c 696b 6520 6120  n't look like a 
+000179c0: 7661 6c69 6420 706c 616e 2e53 6b69 7070  valid plan.Skipp
+000179d0: 696e 672e 2e2e 2e22 290a 2020 2020 2020  ing....").      
+000179e0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+000179f0: 207b 2272 6573 756c 7422 3a20 2273 7563   {"result": "suc
+00017a00: 6365 7373 227d 0a20 2020 2020 2020 2020  cess"}.         
+00017a10: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00017a20: 2020 2020 2020 2020 206d 7367 203d 2066           msg = f
+00017a30: 227b 696e 7075 7466 696c 657d 2064 6f65  "{inputfile} doe
+00017a40: 736e 2774 206c 6f6f 6b20 6c69 6b65 2061  sn't look like a
+00017a50: 2076 616c 6964 2070 6c61 6e20 6669 6c65   valid plan file
+00017a60: 2e20 4d61 7962 6520 796f 7520 7072 6f76  . Maybe you prov
+00017a70: 6964 6564 2061 2070 6172 616d 6574 6572  ided a parameter
+00017a80: 2066 696c 6520 3f22 0a20 2020 2020 2020   file ?".       
+00017a90: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00017aa0: 7b27 7265 7375 6c74 273a 2027 6661 696c  {'result': 'fail
+00017ab0: 7572 6527 2c20 2772 6561 736f 6e27 3a20  ure', 'reason': 
+00017ac0: 6d73 677d 0a20 2020 2020 2020 2069 6e70  msg}.        inp
+00017ad0: 7574 6469 7220 3d20 6f73 2e70 6174 682e  utdir = os.path.
+00017ae0: 6469 726e 616d 6528 696e 7075 7466 696c  dirname(inputfil
+00017af0: 6529 2069 6620 6f73 2e70 6174 682e 6469  e) if os.path.di
+00017b00: 726e 616d 6528 696e 7075 7466 696c 6529  rname(inputfile)
+00017b10: 2021 3d20 2727 2061 6e64 206f 732e 7061   != '' and os.pa
+00017b20: 7468 2e69 7361 6273 2869 6e70 7574 6669  th.isabs(inputfi
+00017b30: 6c65 2920 656c 7365 2027 2e27 0a20 2020  le) else '.'.   
+00017b40: 2020 2020 2070 7265 5f62 6173 6520 3d20       pre_base = 
+00017b50: 6f73 2e70 6174 682e 7370 6c69 7465 7874  os.path.splitext
+00017b60: 286f 732e 7061 7468 2e62 6173 656e 616d  (os.path.basenam
+00017b70: 6528 696e 7075 7466 696c 6529 295b 305d  e(inputfile))[0]
+00017b80: 0a20 2020 2020 2020 2070 7265 5f73 6372  .        pre_scr
+00017b90: 6970 7420 3d20 6627 7b69 6e70 7574 6469  ipt = f'{inputdi
+00017ba0: 727d 2f6b 636c 695f 7072 652e 7368 2720  r}/kcli_pre.sh' 
+00017bb0: 6966 2070 7265 5f62 6173 6520 3d3d 2027  if pre_base == '
+00017bc0: 6b63 6c69 5f70 6c61 6e27 2065 6c73 6520  kcli_plan' else 
+00017bd0: 6622 7b69 6e70 7574 6469 727d 2f7b 7072  f"{inputdir}/{pr
+00017be0: 655f 6261 7365 7d5f 7072 652e 7368 220a  e_base}_pre.sh".
+00017bf0: 2020 2020 2020 2020 6966 206f 732e 7061          if os.pa
+00017c00: 7468 2e65 7869 7374 7328 7072 655f 7363  th.exists(pre_sc
+00017c10: 7269 7074 293a 0a20 2020 2020 2020 2020  ript):.         
+00017c20: 2020 2070 7265 5f73 6372 6970 745f 7368     pre_script_sh
+00017c30: 6f72 7420 3d20 6f73 2e70 6174 682e 6261  ort = os.path.ba
+00017c40: 7365 6e61 6d65 2870 7265 5f73 6372 6970  sename(pre_scrip
+00017c50: 7429 0a20 2020 2020 2020 2020 2020 2069  t).            i
+00017c60: 6620 7072 653a 0a20 2020 2020 2020 2020  f pre:.         
+00017c70: 2020 2020 2020 2070 7072 696e 7428 6622         pprint(f"
+00017c80: 5275 6e6e 696e 6720 7b70 7265 5f73 6372  Running {pre_scr
+00017c90: 6970 745f 7368 6f72 747d 2229 0a20 2020  ipt_short}").   
+00017ca0: 2020 2020 2020 2020 2020 2020 2077 6974               wit
+00017cb0: 6820 5465 6d70 6f72 6172 7944 6972 6563  h TemporaryDirec
+00017cc0: 746f 7279 2829 2061 7320 746d 7064 6972  tory() as tmpdir
+00017cd0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00017ce0: 2020 2020 2020 7072 655f 7363 7269 7074        pre_script
+00017cf0: 203d 2073 656c 662e 7072 6f63 6573 735f   = self.process_
+00017d00: 696e 7075 7466 696c 6528 2778 7878 272c  inputfile('xxx',
+00017d10: 2070 7265 5f73 6372 6970 742c 206f 7665   pre_script, ove
+00017d20: 7272 6964 6573 3d6f 7665 7272 6964 6573  rrides=overrides
+00017d30: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00017d40: 2020 2020 2020 7769 7468 206f 7065 6e28        with open(
+00017d50: 6622 7b74 6d70 6469 727d 2f70 7265 2e73  f"{tmpdir}/pre.s
+00017d60: 6822 2c20 2777 2729 2061 7320 663a 0a20  h", 'w') as f:. 
+00017d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017d80: 2020 2020 2020 2066 2e77 7269 7465 2870         f.write(p
+00017d90: 7265 5f73 6372 6970 7429 0a20 2020 2020  re_script).     
+00017da0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00017db0: 7265 5f72 756e 203d 2072 756e 2866 2762  re_run = run(f'b
+00017dc0: 6173 6820 7b74 6d70 6469 727d 2f70 7265  ash {tmpdir}/pre
+00017dd0: 2e73 6827 2c20 7368 656c 6c3d 5472 7565  .sh', shell=True
+00017de0: 2c20 7374 646f 7574 3d50 4950 452c 2073  , stdout=PIPE, s
+00017df0: 7464 6572 723d 5354 444f 5554 2c0a 2020  tderr=STDOUT,.  
+00017e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017e20: 756e 6976 6572 7361 6c5f 6e65 776c 696e  universal_newlin
+00017e30: 6573 3d54 7275 6529 0a20 2020 2020 2020  es=True).       
+00017e40: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00017e50: 7072 655f 7275 6e2e 7265 7475 726e 636f  pre_run.returnco
+00017e60: 6465 2021 3d20 303a 0a20 2020 2020 2020  de != 0:.       
+00017e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017e80: 206d 7367 203d 2066 2249 7373 7565 2077   msg = f"Issue w
+00017e90: 6865 6e20 7275 6e6e 696e 6720 7b70 7265  hen running {pre
+00017ea0: 5f73 6372 6970 745f 7368 6f72 747d 203a  _script_short} :
+00017eb0: 5c6e 7b70 7265 5f72 756e 2e73 7464 6f75  \n{pre_run.stdou
+00017ec0: 747d 220a 2020 2020 2020 2020 2020 2020  t}".            
+00017ed0: 2020 2020 2020 2020 2020 2020 6572 726f              erro
+00017ee0: 7228 6d73 6729 0a20 2020 2020 2020 2020  r(msg).         
+00017ef0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00017f00: 6574 7572 6e20 7b27 7265 7375 6c74 273a  eturn {'result':
+00017f10: 2027 6661 696c 7572 6527 2c20 2772 6561   'failure', 'rea
+00017f20: 736f 6e27 3a20 6d73 677d 0a20 2020 2020  son': msg}.     
+00017f30: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00017f40: 2020 2020 2020 2020 2020 2020 2077 6172               war
+00017f50: 6e69 6e67 2866 2253 6b69 7070 696e 6720  ning(f"Skipping 
+00017f60: 7b70 7265 5f73 6372 6970 745f 7368 6f72  {pre_script_shor
+00017f70: 747d 2061 7320 7265 7175 6573 7465 6422  t} as requested"
+00017f80: 290a 2020 2020 2020 2020 6b65 7977 6f72  ).        keywor
+00017f90: 6473 203d 2073 656c 662e 6c69 7374 5f6b  ds = self.list_k
+00017fa0: 6579 776f 7264 7328 290a 2020 2020 2020  eywords().      
+00017fb0: 2020 666f 7220 6b65 7920 696e 2073 6f72    for key in sor
+00017fc0: 7465 6428 6f76 6572 7269 6465 7329 3a0a  ted(overrides):.
+00017fd0: 2020 2020 2020 2020 2020 2020 6966 206b              if k
+00017fe0: 6579 2069 6e20 6b65 7977 6f72 6473 3a0a  ey in keywords:.
+00017ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018000: 6b65 795f 7661 6c75 6520 3d20 6765 7461  key_value = geta
+00018010: 7474 7228 7365 6c66 2c20 6b65 7929 0a20  ttr(self, key). 
+00018020: 2020 2020 2020 2020 2020 2020 2020 206b                 k
+00018030: 6579 5f74 7970 6520 3d20 7479 7065 286b  ey_type = type(k
+00018040: 6579 5f76 616c 7565 290a 2020 2020 2020  ey_value).      
+00018050: 2020 2020 2020 2020 2020 6f76 6572 7269            overri
+00018060: 6465 5f6b 6579 5f74 7970 6520 3d20 7479  de_key_type = ty
+00018070: 7065 286f 7665 7272 6964 6573 5b6b 6579  pe(overrides[key
+00018080: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
+00018090: 2020 2069 6620 6b65 795f 7661 6c75 6520     if key_value 
+000180a0: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
+000180b0: 6f76 6572 7269 6465 735b 6b65 795d 2069  overrides[key] i
+000180c0: 7320 6e6f 7420 4e6f 6e65 2061 6e64 206b  s not None and k
+000180d0: 6579 5f74 7970 6520 213d 206f 7665 7272  ey_type != overr
+000180e0: 6964 655f 6b65 795f 7479 7065 3a0a 2020  ide_key_type:.  
+000180f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018100: 2020 6572 726f 7228 6622 5468 6520 7072    error(f"The pr
+00018110: 6f76 6964 6564 2070 6172 616d 6574 6572  ovided parameter
+00018120: 207b 6b65 797d 2068 6173 2061 2077 726f   {key} has a wro
+00018130: 6e67 2074 7970 6520 7b6f 7665 7272 6964  ng type {overrid
+00018140: 655f 6b65 795f 7479 7065 7d2c 2069 7420  e_key_type}, it 
+00018150: 7368 6f75 6c64 2062 6520 7b6b 6579 5f74  should be {key_t
+00018160: 7970 657d 2229 0a20 2020 2020 2020 2020  ype}").         
+00018170: 2020 2020 2020 2020 2020 2073 7973 2e65             sys.e
+00018180: 7869 7428 3129 0a20 2020 2020 2020 2020  xit(1).         
+00018190: 2020 2020 2020 2065 6c69 6620 6f76 6572         elif over
+000181a0: 7269 6465 735b 6b65 795d 2069 7320 6e6f  rides[key] is no
+000181b0: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+000181c0: 2020 2020 2020 2020 2020 2020 7365 7461              seta
+000181d0: 7474 7228 7365 6c66 2c20 6b65 792c 206f  ttr(self, key, o
+000181e0: 7665 7272 6964 6573 5b6b 6579 5d29 0a20  verrides[key]). 
+000181f0: 2020 2020 2020 2076 6d65 6e74 7269 6573         vmentries
+00018200: 203d 205b 656e 7472 7920 666f 7220 656e   = [entry for en
+00018210: 7472 7920 696e 2065 6e74 7269 6573 2069  try in entries i
+00018220: 6620 2774 7970 6527 206e 6f74 2069 6e20  f 'type' not in 
+00018230: 656e 7472 6965 735b 656e 7472 795d 206f  entries[entry] o
+00018240: 7220 656e 7472 6965 735b 656e 7472 795d  r entries[entry]
+00018250: 5b27 7479 7065 275d 203d 3d20 2776 6d27  ['type'] == 'vm'
+00018260: 5d0a 2020 2020 2020 2020 6469 736b 656e  ].        disken
+00018270: 7472 6965 7320 3d20 5b65 6e74 7279 2066  tries = [entry f
+00018280: 6f72 2065 6e74 7279 2069 6e20 656e 7472  or entry in entr
+00018290: 6965 7320 6966 2027 7479 7065 2720 696e  ies if 'type' in
+000182a0: 2065 6e74 7269 6573 5b65 6e74 7279 5d20   entries[entry] 
+000182b0: 616e 6420 656e 7472 6965 735b 656e 7472  and entries[entr
+000182c0: 795d 5b27 7479 7065 275d 203d 3d20 2764  y]['type'] == 'd
+000182d0: 6973 6b27 5d0a 2020 2020 2020 2020 6e65  isk'].        ne
+000182e0: 7477 6f72 6b65 6e74 7269 6573 203d 205b  tworkentries = [
+000182f0: 656e 7472 7920 666f 7220 656e 7472 7920  entry for entry 
+00018300: 696e 2065 6e74 7269 6573 0a20 2020 2020  in entries.     
+00018310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018320: 2020 2020 2069 6620 2774 7970 6527 2069       if 'type' i
+00018330: 6e20 656e 7472 6965 735b 656e 7472 795d  n entries[entry]
+00018340: 2061 6e64 2065 6e74 7269 6573 5b65 6e74   and entries[ent
+00018350: 7279 5d5b 2774 7970 6527 5d20 3d3d 2027  ry]['type'] == '
+00018360: 6e65 7477 6f72 6b27 5d0a 2020 2020 2020  network'].      
+00018370: 2020 636f 6e74 6169 6e65 7265 6e74 7269    containerentri
+00018380: 6573 203d 205b 656e 7472 7920 666f 7220  es = [entry for 
+00018390: 656e 7472 7920 696e 2065 6e74 7269 6573  entry in entries
+000183a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000183b0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+000183c0: 2774 7970 6527 2069 6e20 656e 7472 6965  'type' in entrie
+000183d0: 735b 656e 7472 795d 2061 6e64 2065 6e74  s[entry] and ent
+000183e0: 7269 6573 5b65 6e74 7279 5d5b 2774 7970  ries[entry]['typ
+000183f0: 6527 5d20 3d3d 2027 636f 6e74 6169 6e65  e'] == 'containe
+00018400: 7227 5d0a 2020 2020 2020 2020 616e 7369  r'].        ansi
+00018410: 626c 6565 6e74 7269 6573 203d 205b 656e  bleentries = [en
+00018420: 7472 7920 666f 7220 656e 7472 7920 696e  try for entry in
+00018430: 2065 6e74 7269 6573 0a20 2020 2020 2020   entries.       
+00018440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018450: 2020 2069 6620 2774 7970 6527 2069 6e20     if 'type' in 
+00018460: 656e 7472 6965 735b 656e 7472 795d 2061  entries[entry] a
+00018470: 6e64 2065 6e74 7269 6573 5b65 6e74 7279  nd entries[entry
+00018480: 5d5b 2774 7970 6527 5d20 3d3d 2027 616e  ]['type'] == 'an
+00018490: 7369 626c 6527 5d0a 2020 2020 2020 2020  sible'].        
+000184a0: 7072 6f66 696c 6565 6e74 7269 6573 203d  profileentries =
+000184b0: 205b 656e 7472 7920 666f 7220 656e 7472   [entry for entr
+000184c0: 7920 696e 2065 6e74 7269 6573 0a20 2020  y in entries.   
+000184d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000184e0: 2020 2020 2020 2069 6620 2774 7970 6527         if 'type'
+000184f0: 2069 6e20 656e 7472 6965 735b 656e 7472   in entries[entr
+00018500: 795d 2061 6e64 2065 6e74 7269 6573 5b65  y] and entries[e
+00018510: 6e74 7279 5d5b 2774 7970 6527 5d20 3d3d  ntry]['type'] ==
+00018520: 2027 7072 6f66 696c 6527 5d0a 2020 2020   'profile'].    
+00018530: 2020 2020 696d 6167 6565 6e74 7269 6573      imageentries
+00018540: 203d 205b 656e 7472 7920 666f 7220 656e   = [entry for en
+00018550: 7472 7920 696e 2065 6e74 7269 6573 2069  try in entries i
+00018560: 6620 2774 7970 6527 2069 6e0a 2020 2020  f 'type' in.    
+00018570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018580: 2020 2020 656e 7472 6965 735b 656e 7472      entries[entr
+00018590: 795d 2061 6e64 2028 656e 7472 6965 735b  y] and (entries[
+000185a0: 656e 7472 795d 5b27 7479 7065 275d 203d  entry]['type'] =
+000185b0: 3d20 2769 6d61 6765 2720 6f72 2065 6e74  = 'image' or ent
+000185c0: 7269 6573 5b65 6e74 7279 5d5b 2774 7970  ries[entry]['typ
+000185d0: 6527 5d20 3d3d 2027 7465 6d70 6c61 7465  e'] == 'template
+000185e0: 2729 5d0a 2020 2020 2020 2020 706f 6f6c  ')].        pool
+000185f0: 656e 7472 6965 7320 3d20 5b65 6e74 7279  entries = [entry
+00018600: 2066 6f72 2065 6e74 7279 2069 6e20 656e   for entry in en
+00018610: 7472 6965 7320 6966 2027 7479 7065 2720  tries if 'type' 
+00018620: 696e 2065 6e74 7269 6573 5b65 6e74 7279  in entries[entry
+00018630: 5d20 616e 6420 656e 7472 6965 735b 656e  ] and entries[en
+00018640: 7472 795d 5b27 7479 7065 275d 203d 3d20  try]['type'] == 
+00018650: 2770 6f6f 6c27 5d0a 2020 2020 2020 2020  'pool'].        
+00018660: 706c 616e 656e 7472 6965 7320 3d20 5b65  planentries = [e
+00018670: 6e74 7279 2066 6f72 2065 6e74 7279 2069  ntry for entry i
+00018680: 6e20 656e 7472 6965 7320 6966 2027 7479  n entries if 'ty
+00018690: 7065 2720 696e 2065 6e74 7269 6573 5b65  pe' in entries[e
+000186a0: 6e74 7279 5d20 616e 6420 656e 7472 6965  ntry] and entrie
+000186b0: 735b 656e 7472 795d 5b27 7479 7065 275d  s[entry]['type']
+000186c0: 203d 3d20 2770 6c61 6e27 5d0a 2020 2020   == 'plan'].    
+000186d0: 2020 2020 646e 7365 6e74 7269 6573 203d      dnsentries =
+000186e0: 205b 656e 7472 7920 666f 7220 656e 7472   [entry for entr
+000186f0: 7920 696e 2065 6e74 7269 6573 2069 6620  y in entries if 
+00018700: 2774 7970 6527 2069 6e20 656e 7472 6965  'type' in entrie
+00018710: 735b 656e 7472 795d 2061 6e64 2065 6e74  s[entry] and ent
+00018720: 7269 6573 5b65 6e74 7279 5d5b 2774 7970  ries[entry]['typ
+00018730: 6527 5d20 3d3d 2027 646e 7327 5d0a 2020  e'] == 'dns'].  
+00018740: 2020 2020 2020 6b75 6265 7320 3d20 5b27        kubes = ['
+00018750: 6b75 6265 272c 2027 636c 7573 7465 7227  kube', 'cluster'
+00018760: 5d0a 2020 2020 2020 2020 6b75 6265 656e  ].        kubeen
+00018770: 7472 6965 7320 3d20 5b65 6e74 7279 2066  tries = [entry f
+00018780: 6f72 2065 6e74 7279 2069 6e20 656e 7472  or entry in entr
+00018790: 6965 7320 6966 2027 7479 7065 2720 696e  ies if 'type' in
+000187a0: 2065 6e74 7269 6573 5b65 6e74 7279 5d20   entries[entry] 
+000187b0: 616e 6420 656e 7472 6965 735b 656e 7472  and entries[entr
+000187c0: 795d 5b27 7479 7065 275d 2069 6e20 6b75  y]['type'] in ku
+000187d0: 6265 735d 0a20 2020 2020 2020 206c 6273  bes].        lbs
+000187e0: 203d 205b 656e 7472 7920 666f 7220 656e   = [entry for en
+000187f0: 7472 7920 696e 2065 6e74 7269 6573 2069  try in entries i
+00018800: 6620 2774 7970 6527 2069 6e20 656e 7472  f 'type' in entr
+00018810: 6965 735b 656e 7472 795d 2061 6e64 2065  ies[entry] and e
+00018820: 6e74 7269 6573 5b65 6e74 7279 5d5b 2774  ntries[entry]['t
+00018830: 7970 6527 5d20 3d3d 2027 6c6f 6164 6261  ype'] == 'loadba
+00018840: 6c61 6e63 6572 275d 0a20 2020 2020 2020  lancer'].       
+00018850: 2073 6773 203d 205b 656e 7472 7920 666f   sgs = [entry fo
+00018860: 7220 656e 7472 7920 696e 2065 6e74 7269  r entry in entri
+00018870: 6573 2069 6620 2774 7970 6527 2069 6e20  es if 'type' in 
+00018880: 656e 7472 6965 735b 656e 7472 795d 2061  entries[entry] a
+00018890: 6e64 2065 6e74 7269 6573 5b65 6e74 7279  nd entries[entry
+000188a0: 5d5b 2774 7970 6527 5d20 3d3d 2027 7365  ]['type'] == 'se
+000188b0: 6375 7269 7479 6772 6f75 7027 5d0a 2020  curitygroup'].  
+000188c0: 2020 2020 2020 6275 636b 6574 656e 7472        bucketentr
+000188d0: 6965 7320 3d20 5b65 6e74 7279 2066 6f72  ies = [entry for
+000188e0: 2065 6e74 7279 2069 6e20 656e 7472 6965   entry in entrie
+000188f0: 7320 6966 2027 7479 7065 2720 696e 2065  s if 'type' in e
+00018900: 6e74 7269 6573 5b65 6e74 7279 5d20 616e  ntries[entry] an
+00018910: 6420 656e 7472 6965 735b 656e 7472 795d  d entries[entry]
+00018920: 5b27 7479 7065 275d 203d 3d20 2762 7563  ['type'] == 'buc
+00018930: 6b65 7427 5d0a 2020 2020 2020 2020 776f  ket'].        wo
+00018940: 726b 666c 6f77 656e 7472 6965 7320 3d20  rkflowentries = 
+00018950: 5b65 6e74 7279 2066 6f72 2065 6e74 7279  [entry for entry
+00018960: 2069 6e20 656e 7472 6965 730a 2020 2020   in entries.    
+00018970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018980: 2020 2020 2020 2069 6620 2774 7970 6527         if 'type'
+00018990: 2069 6e20 656e 7472 6965 735b 656e 7472   in entries[entr
+000189a0: 795d 2061 6e64 2065 6e74 7269 6573 5b65  y] and entries[e
+000189b0: 6e74 7279 5d5b 2774 7970 6527 5d20 3d3d  ntry]['type'] ==
+000189c0: 2027 776f 726b 666c 6f77 275d 0a20 2020   'workflow'].   
+000189d0: 2020 2020 2066 6f72 2070 2069 6e20 7072       for p in pr
+000189e0: 6f66 696c 6565 6e74 7269 6573 3a0a 2020  ofileentries:.  
+000189f0: 2020 2020 2020 2020 2020 766d 7072 6f66            vmprof
+00018a00: 696c 6573 5b70 5d20 3d20 656e 7472 6965  iles[p] = entrie
+00018a10: 735b 705d 0a20 2020 2020 2020 2069 6620  s[p].        if 
+00018a20: 6e65 7477 6f72 6b65 6e74 7269 6573 2061  networkentries a
+00018a30: 6e64 206e 6f74 206f 6e6c 7961 7373 6574  nd not onlyasset
+00018a40: 733a 0a20 2020 2020 2020 2020 2020 2070  s:.            p
+00018a50: 7072 696e 7428 2244 6570 6c6f 7969 6e67  print("Deploying
+00018a60: 204e 6574 776f 726b 732e 2e2e 2229 0a20   Networks..."). 
+00018a70: 2020 2020 2020 2020 2020 2066 6f72 206e             for n
+00018a80: 6574 2069 6e20 6e65 7477 6f72 6b65 6e74  et in networkent
+00018a90: 7269 6573 3a0a 2020 2020 2020 2020 2020  ries:.          
+00018aa0: 2020 2020 2020 6e65 7470 726f 6669 6c65        netprofile
+00018ab0: 203d 2065 6e74 7269 6573 5b6e 6574 5d0a   = entries[net].
+00018ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018ad0: 6966 206b 2e6e 6574 5f65 7869 7374 7328  if k.net_exists(
+00018ae0: 6e65 7429 3a0a 2020 2020 2020 2020 2020  net):.          
+00018af0: 2020 2020 2020 2020 2020 7070 7269 6e74            pprint
+00018b00: 2866 224e 6574 776f 726b 207b 6e65 747d  (f"Network {net}
+00018b10: 2073 6b69 7070 6564 2122 290a 2020 2020   skipped!").    
+00018b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018b30: 636f 6e74 696e 7565 0a20 2020 2020 2020  continue.       
+00018b40: 2020 2020 2020 2020 2063 6964 7220 3d20           cidr = 
+00018b50: 6e65 7470 726f 6669 6c65 2e67 6574 2827  netprofile.get('
+00018b60: 6369 6472 2729 0a20 2020 2020 2020 2020  cidr').         
+00018b70: 2020 2020 2020 206e 6174 203d 2062 6f6f         nat = boo
+00018b80: 6c28 6e65 7470 726f 6669 6c65 2e67 6574  l(netprofile.get
+00018b90: 2827 6e61 7427 2c20 5472 7565 2929 0a20  ('nat', True)). 
+00018ba0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00018bb0: 6620 6369 6472 2069 7320 4e6f 6e65 3a0a  f cidr is None:.
+00018bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018bd0: 2020 2020 7761 726e 696e 6728 6622 4d69      warning(f"Mi
+00018be0: 7373 696e 6720 4369 6472 2066 6f72 206e  ssing Cidr for n
+00018bf0: 6574 776f 726b 207b 6e65 747d 2e20 4e6f  etwork {net}. No
+00018c00: 7420 6372 6561 7469 6e67 2069 742e 2e2e  t creating it...
+00018c10: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+00018c20: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
+00018c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018c40: 6468 6370 203d 206e 6574 7072 6f66 696c  dhcp = netprofil
+00018c50: 652e 6765 7428 2764 6863 7027 2c20 5472  e.get('dhcp', Tr
+00018c60: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
+00018c70: 2020 2020 646f 6d61 696e 203d 206e 6574      domain = net
+00018c80: 7072 6f66 696c 652e 6765 7428 2764 6f6d  profile.get('dom
+00018c90: 6169 6e27 290a 2020 2020 2020 2020 2020  ain').          
+00018ca0: 2020 2020 2020 7265 7375 6c74 203d 206b        result = k
+00018cb0: 2e63 7265 6174 655f 6e65 7477 6f72 6b28  .create_network(
+00018cc0: 6e61 6d65 3d6e 6574 2c20 6369 6472 3d63  name=net, cidr=c
+00018cd0: 6964 722c 2064 6863 703d 6468 6370 2c20  idr, dhcp=dhcp, 
+00018ce0: 6e61 743d 6e61 742c 2064 6f6d 6169 6e3d  nat=nat, domain=
+00018cf0: 646f 6d61 696e 2c20 706c 616e 3d70 6c61  domain, plan=pla
+00018d00: 6e2c 0a20 2020 2020 2020 2020 2020 2020  n,.             
+00018d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018d20: 2020 2020 2020 2020 2020 2020 206f 7665               ove
+00018d30: 7272 6964 6573 3d6e 6574 7072 6f66 696c  rrides=netprofil
+00018d40: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
+00018d50: 2020 2063 6f6d 6d6f 6e2e 6861 6e64 6c65     common.handle
+00018d60: 5f72 6573 706f 6e73 6528 7265 7375 6c74  _response(result
+00018d70: 2c20 6e65 742c 2065 6c65 6d65 6e74 3d27  , net, element='
+00018d80: 4e65 7477 6f72 6b20 2729 0a20 2020 2020  Network ').     
+00018d90: 2020 2069 6620 706f 6f6c 656e 7472 6965     if poolentrie
+00018da0: 7320 616e 6420 6e6f 7420 6f6e 6c79 6173  s and not onlyas
+00018db0: 7365 7473 3a0a 2020 2020 2020 2020 2020  sets:.          
+00018dc0: 2020 7070 7269 6e74 2822 4465 706c 6f79    pprint("Deploy
+00018dd0: 696e 6720 506f 6f6c 732e 2e2e 2229 0a20  ing Pools..."). 
+00018de0: 2020 2020 2020 2020 2020 2070 6f6f 6c73             pools
+00018df0: 203d 206b 2e6c 6973 745f 706f 6f6c 7328   = k.list_pools(
+00018e00: 290a 2020 2020 2020 2020 2020 2020 666f  ).            fo
+00018e10: 7220 706f 6f6c 2069 6e20 706f 6f6c 656e  r pool in poolen
+00018e20: 7472 6965 733a 0a20 2020 2020 2020 2020  tries:.         
+00018e30: 2020 2020 2020 2069 6620 706f 6f6c 2069         if pool i
+00018e40: 6e20 706f 6f6c 733a 0a20 2020 2020 2020  n pools:.       
+00018e50: 2020 2020 2020 2020 2020 2020 2070 7072               ppr
+00018e60: 696e 7428 6622 506f 6f6c 207b 706f 6f6c  int(f"Pool {pool
+00018e70: 7d20 736b 6970 7065 6421 2229 0a20 2020  } skipped!").   
+00018e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018e90: 2063 6f6e 7469 6e75 650a 2020 2020 2020   continue.      
+00018ea0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00018eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018ec0: 2020 2020 706f 6f6c 7072 6f66 696c 6520      poolprofile 
+00018ed0: 3d20 656e 7472 6965 735b 706f 6f6c 5d0a  = entries[pool].
+00018ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018ef0: 2020 2020 706f 6f6c 7061 7468 203d 2070      poolpath = p
+00018f00: 6f6f 6c70 726f 6669 6c65 2e67 6574 2827  oolprofile.get('
+00018f10: 7061 7468 2729 0a20 2020 2020 2020 2020  path').         
+00018f20: 2020 2020 2020 2020 2020 2069 6620 706f             if po
+00018f30: 6f6c 7061 7468 2069 7320 4e6f 6e65 3a0a  olpath is None:.
+00018f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018f50: 2020 2020 2020 2020 7761 726e 696e 6728          warning(
+00018f60: 6622 506f 6f6c 207b 706f 6f6c 7d20 736b  f"Pool {pool} sk
+00018f70: 6970 7065 6420 6173 2070 6174 6820 6973  ipped as path is
+00018f80: 206d 6973 7369 6e67 2122 290a 2020 2020   missing!").    
 00018f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018fa0: 2020 2020 7761 726e 696e 6728 6622 506f      warning(f"Po
-00018fb0: 6f6c 207b 706f 6f6c 7d20 736b 6970 7065  ol {pool} skippe
-00018fc0: 6420 6173 2070 6174 6820 6973 206d 6973  d as path is mis
-00018fd0: 7369 6e67 2122 290a 2020 2020 2020 2020  sing!").        
-00018fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018ff0: 636f 6e74 696e 7565 0a20 2020 2020 2020  continue.       
-00019000: 2020 2020 2020 2020 2020 2020 206b 2e63               k.c
-00019010: 7265 6174 655f 706f 6f6c 2870 6f6f 6c2c  reate_pool(pool,
-00019020: 2070 6f6f 6c70 6174 6829 0a20 2020 2020   poolpath).     
-00019030: 2020 2069 6620 696d 6167 6565 6e74 7269     if imageentri
-00019040: 6573 2061 6e64 206e 6f74 206f 6e6c 7961  es and not onlya
-00019050: 7373 6574 733a 0a20 2020 2020 2020 2020  ssets:.         
-00019060: 2020 2070 7072 696e 7428 2244 6570 6c6f     pprint("Deplo
-00019070: 7969 6e67 2049 6d61 6765 732e 2e2e 2229  ying Images...")
-00019080: 0a20 2020 2020 2020 2020 2020 2069 6d61  .            ima
-00019090: 6765 7320 3d20 5b6f 732e 7061 7468 2e62  ges = [os.path.b
-000190a0: 6173 656e 616d 6528 7429 2066 6f72 2074  asename(t) for t
-000190b0: 2069 6e20 6b2e 766f 6c75 6d65 7328 295d   in k.volumes()]
-000190c0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-000190d0: 2069 6d61 6765 2069 6e20 696d 6167 6565   image in imagee
-000190e0: 6e74 7269 6573 3a0a 2020 2020 2020 2020  ntries:.        
-000190f0: 2020 2020 2020 2020 696d 6167 6570 726f          imagepro
-00019100: 6669 6c65 203d 2065 6e74 7269 6573 5b69  file = entries[i
-00019110: 6d61 6765 5d0a 2020 2020 2020 2020 2020  mage].          
-00019120: 2020 2020 2020 706f 6f6c 203d 2069 6d61        pool = ima
-00019130: 6765 7072 6f66 696c 652e 6765 7428 2770  geprofile.get('p
-00019140: 6f6f 6c27 2c20 7365 6c66 2e70 6f6f 6c29  ool', self.pool)
-00019150: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00019160: 2069 6d61 6765 7369 7a65 203d 2069 6d61   imagesize = ima
-00019170: 6765 7072 6f66 696c 652e 6765 7428 2773  geprofile.get('s
-00019180: 697a 6527 290a 2020 2020 2020 2020 2020  ize').          
-00019190: 2020 2020 2020 696d 6167 6575 726c 203d        imageurl =
-000191a0: 2069 6d61 6765 7072 6f66 696c 652e 6765   imageprofile.ge
-000191b0: 7428 2775 726c 2729 0a20 2020 2020 2020  t('url').       
-000191c0: 2020 2020 2020 2020 2069 6620 696d 6167           if imag
-000191d0: 6520 696e 2069 6d61 6765 733a 0a20 2020  e in images:.   
-000191e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000191f0: 2070 7072 696e 7428 6622 496d 6167 6520   pprint(f"Image 
-00019200: 7b69 6d61 6765 7d20 736b 6970 7065 6421  {image} skipped!
-00019210: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-00019220: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
-00019230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019240: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00019250: 2020 2020 2020 2020 2020 6966 2069 7369            if isi
-00019260: 6e73 7461 6e63 6528 696d 6167 6575 726c  nstance(imageurl
-00019270: 2c20 7374 7229 2061 6e64 2069 6d61 6765  , str) and image
-00019280: 7572 6c20 3d3d 2022 4e6f 6e65 223a 0a20  url == "None":. 
-00019290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000192a0: 2020 2020 2020 2069 6d61 6765 7572 6c20         imageurl 
-000192b0: 3d20 4e6f 6e65 0a20 2020 2020 2020 2020  = None.         
-000192c0: 2020 2020 2020 2020 2020 2063 6d64 203d             cmd =
-000192d0: 2069 6d61 6765 7072 6f66 696c 652e 6765   imageprofile.ge
-000192e0: 7428 2763 6d64 2729 0a20 2020 2020 2020  t('cmd').       
-000192f0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00019300: 662e 6861 6e64 6c65 5f68 6f73 7428 706f  f.handle_host(po
-00019310: 6f6c 3d70 6f6f 6c2c 2069 6d61 6765 3d69  ol=pool, image=i
-00019320: 6d61 6765 2c20 646f 776e 6c6f 6164 3d54  mage, download=T
-00019330: 7275 652c 2063 6d64 3d63 6d64 2c20 7572  rue, cmd=cmd, ur
-00019340: 6c3d 696d 6167 6575 726c 2c20 7369 7a65  l=imageurl, size
-00019350: 3d69 6d61 6765 7369 7a65 290a 2020 2020  =imagesize).    
-00019360: 2020 2020 6966 2062 7563 6b65 7465 6e74      if bucketent
-00019370: 7269 6573 2061 6e64 206e 6f74 206f 6e6c  ries and not onl
-00019380: 7961 7373 6574 7320 616e 6420 7365 6c66  yassets and self
-00019390: 2e74 7970 6520 696e 205b 2761 7773 272c  .type in ['aws',
-000193a0: 2027 6763 7027 2c20 276f 7065 6e73 7461   'gcp', 'opensta
-000193b0: 636b 275d 3a0a 2020 2020 2020 2020 2020  ck']:.          
-000193c0: 2020 7070 7269 6e74 2822 4465 706c 6f79    pprint("Deploy
-000193d0: 696e 6720 4275 636b 6574 2045 6e74 7269  ing Bucket Entri
-000193e0: 6573 2e2e 2e22 290a 2020 2020 2020 2020  es...").        
-000193f0: 2020 2020 666f 7220 6275 636b 6574 656e      for bucketen
-00019400: 7472 7920 696e 2062 7563 6b65 7465 6e74  try in bucketent
-00019410: 7269 6573 3a0a 2020 2020 2020 2020 2020  ries:.          
-00019420: 2020 2020 2020 6275 636b 6574 7072 6f66        bucketprof
-00019430: 696c 6520 3d20 656e 7472 6965 735b 6275  ile = entries[bu
-00019440: 636b 6574 656e 7472 795d 0a20 2020 2020  cketentry].     
-00019450: 2020 2020 2020 2020 2020 205f 6669 6c65             _file
-00019460: 7320 3d20 6275 636b 6574 7072 6f66 696c  s = bucketprofil
-00019470: 652e 6765 7428 2766 696c 6573 272c 205b  e.get('files', [
-00019480: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
-00019490: 2020 2073 656c 662e 6b2e 6372 6561 7465     self.k.create
-000194a0: 5f62 7563 6b65 7428 6275 636b 6574 656e  _bucket(bucketen
-000194b0: 7472 7929 0a20 2020 2020 2020 2020 2020  try).           
-000194c0: 2020 2020 2066 6f72 205f 6669 6c20 696e       for _fil in
-000194d0: 205f 6669 6c65 733a 0a20 2020 2020 2020   _files:.       
-000194e0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-000194f0: 662e 6b2e 7570 6c6f 6164 5f74 6f5f 6275  f.k.upload_to_bu
-00019500: 636b 6574 2862 7563 6b65 7465 6e74 7279  cket(bucketentry
-00019510: 2c20 5f66 696c 290a 2020 2020 2020 2020  , _fil).        
-00019520: 7465 6d70 6b65 7920 3d20 6f76 6572 7269  tempkey = overri
-00019530: 6465 732e 6765 7428 2774 656d 706b 6579  des.get('tempkey
-00019540: 272c 2046 616c 7365 2920 6f72 2073 656c  ', False) or sel
-00019550: 662e 7465 6d70 6b65 790a 2020 2020 2020  f.tempkey.      
-00019560: 2020 6966 2074 656d 706b 6579 3a0a 2020    if tempkey:.  
-00019570: 2020 2020 2020 2020 2020 7465 6d70 6b65            tempke
-00019580: 7964 6972 203d 2054 656d 706f 7261 7279  ydir = Temporary
-00019590: 4469 7265 6374 6f72 7928 290a 2020 2020  Directory().    
-000195a0: 2020 2020 2020 2020 6f76 6572 7269 6465          override
-000195b0: 735b 2774 656d 706b 6579 6469 7227 5d20  s['tempkeydir'] 
-000195c0: 3d20 7465 6d70 6b65 7964 6972 0a20 2020  = tempkeydir.   
-000195d0: 2020 2020 2020 2020 206f 7665 7272 6964           overrid
-000195e0: 6573 5b27 7465 6d70 6b65 7964 6972 6b65  es['tempkeydirke
-000195f0: 6570 275d 203d 2054 7275 650a 2020 2020  ep'] = True.    
-00019600: 2020 2020 6966 2070 6c61 6e65 6e74 7269      if planentri
-00019610: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
-00019620: 7070 7269 6e74 2822 4465 706c 6f79 696e  pprint("Deployin
-00019630: 6720 506c 616e 732e 2e2e 2229 0a20 2020  g Plans...").   
-00019640: 2020 2020 2020 2020 2066 6f72 2070 6c61           for pla
-00019650: 6e65 6e74 7279 2069 6e20 706c 616e 656e  nentry in planen
-00019660: 7472 6965 733a 0a20 2020 2020 2020 2020  tries:.         
-00019670: 2020 2020 2020 2064 6574 6169 6c73 203d         details =
-00019680: 2065 6e74 7269 6573 5b70 6c61 6e65 6e74   entries[planent
-00019690: 7279 5d0a 2020 2020 2020 2020 2020 2020  ry].            
-000196a0: 2020 2020 706c 616e 7572 6c20 3d20 6465      planurl = de
-000196b0: 7461 696c 732e 6765 7428 2775 726c 2729  tails.get('url')
-000196c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000196d0: 2070 6c61 6e66 696c 6520 3d20 6465 7461   planfile = deta
-000196e0: 696c 732e 6765 7428 2766 696c 6527 290a  ils.get('file').
-000196f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019700: 6966 2070 6c61 6e75 726c 2069 7320 4e6f  if planurl is No
-00019710: 6e65 2061 6e64 2070 6c61 6e66 696c 6520  ne and planfile 
-00019720: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-00019730: 2020 2020 2020 2020 2020 2020 2077 6172               war
-00019740: 6e69 6e67 2866 224d 6973 7369 6e67 2055  ning(f"Missing U
-00019750: 726c 2f46 696c 6520 666f 7220 706c 616e  rl/File for plan
-00019760: 207b 706c 616e 656e 7472 797d 2e20 4e6f   {planentry}. No
-00019770: 7420 6372 6561 7469 6e67 2069 742e 2e2e  t creating it...
-00019780: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-00019790: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
-000197a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000197b0: 656c 6966 2070 6c61 6e75 726c 2069 7320  elif planurl is 
-000197c0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-000197d0: 2020 2020 2020 2020 2020 2020 2020 7061                pa
-000197e0: 7468 203d 2070 6c61 6e65 6e74 7279 0a20  th = planentry. 
-000197f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019800: 2020 2069 6620 6e6f 7420 706c 616e 7572     if not planur
-00019810: 6c2e 656e 6473 7769 7468 2827 796d 6c27  l.endswith('yml'
-00019820: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00019830: 2020 2020 2020 2020 2020 2070 6c61 6e75             planu
-00019840: 726c 203d 2066 227b 706c 616e 7572 6c7d  rl = f"{planurl}
-00019850: 2f6b 636c 695f 706c 616e 2e79 6d6c 220a  /kcli_plan.yml".
-00019860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019870: 656c 6966 2027 2f27 2069 6e20 706c 616e  elif '/' in plan
-00019880: 6669 6c65 3a0a 2020 2020 2020 2020 2020  file:.          
-00019890: 2020 2020 2020 2020 2020 7061 7468 203d            path =
-000198a0: 206f 732e 7061 7468 2e64 6972 6e61 6d65   os.path.dirname
-000198b0: 2870 6c61 6e66 696c 6529 0a20 2020 2020  (planfile).     
-000198c0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000198d0: 6e70 7574 6669 6c65 203d 206f 732e 7061  nputfile = os.pa
-000198e0: 7468 2e62 6173 656e 616d 6528 706c 616e  th.basename(plan
-000198f0: 6669 6c65 290a 2020 2020 2020 2020 2020  file).          
-00019900: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00019910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019920: 7061 7468 203d 2027 2e27 0a20 2020 2020  path = '.'.     
-00019930: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00019940: 6e70 7574 6669 6c65 203d 2070 6c61 6e65  nputfile = plane
-00019950: 6e74 7279 0a20 2020 2020 2020 2020 2020  ntry.           
-00019960: 2020 2020 2069 6620 6e6f 5f6f 7665 7272       if no_overr
-00019970: 6964 6573 2061 6e64 2070 6172 616d 6574  ides and paramet
-00019980: 6572 733a 0a20 2020 2020 2020 2020 2020  ers:.           
-00019990: 2020 2020 2020 2020 2070 7072 696e 7428           pprint(
-000199a0: 2255 7369 6e67 2070 6172 616d 6574 6572  "Using parameter
-000199b0: 7320 6672 6f6d 2066 6174 6865 7220 706c  s from father pl
-000199c0: 616e 2069 6e20 6368 696c 6420 6f6e 6573  an in child ones
-000199d0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-000199e0: 2020 2020 2020 2066 6f72 206f 7665 7272         for overr
-000199f0: 6964 6520 696e 206f 7665 7272 6964 6573  ide in overrides
-00019a00: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00019a10: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00019a20: 2255 7369 6e67 2070 6172 616d 6574 6572  "Using parameter
-00019a30: 2025 733a 2025 7322 2025 2028 6f76 6572   %s: %s" % (over
-00019a40: 7269 6465 2c20 6f76 6572 7269 6465 735b  ride, overrides[
-00019a50: 6f76 6572 7269 6465 5d29 290a 2020 2020  override])).    
-00019a60: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00019a70: 2e70 6c61 6e28 706c 616e 2c20 616e 7369  .plan(plan, ansi
-00019a80: 626c 653d 4661 6c73 652c 2075 726c 3d70  ble=False, url=p
-00019a90: 6c61 6e75 726c 2c20 7061 7468 3d70 6174  lanurl, path=pat
-00019aa0: 682c 2063 6f6e 7461 696e 6572 3d46 616c  h, container=Fal
-00019ab0: 7365 2c20 696e 7075 7466 696c 653d 696e  se, inputfile=in
-00019ac0: 7075 7466 696c 652c 0a20 2020 2020 2020  putfile,.       
-00019ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019ae0: 2020 206f 7665 7272 6964 6573 3d6f 7665     overrides=ove
-00019af0: 7272 6964 6573 2c20 656d 6265 6464 6564  rrides, embedded
-00019b00: 3d65 6d62 6564 6465 642c 2064 6f77 6e6c  =embedded, downl
-00019b10: 6f61 643d 646f 776e 6c6f 6164 290a 2020  oad=download).  
-00019b20: 2020 2020 2020 6966 206b 7562 6565 6e74        if kubeent
-00019b30: 7269 6573 2061 6e64 206e 6f74 206f 6e6c  ries and not onl
-00019b40: 7961 7373 6574 733a 0a20 2020 2020 2020  yassets:.       
-00019b50: 2020 2020 2070 7072 696e 7428 2244 6570       pprint("Dep
-00019b60: 6c6f 7969 6e67 204b 7562 6520 456e 7472  loying Kube Entr
-00019b70: 6965 732e 2e2e 2229 0a20 2020 2020 2020  ies...").       
-00019b80: 2020 2020 2064 6e73 636c 6965 6e74 7320       dnsclients 
-00019b90: 3d20 7b7d 0a20 2020 2020 2020 2020 2020  = {}.           
-00019ba0: 206b 7562 6574 6872 6561 6465 6420 3d20   kubethreaded = 
-00019bb0: 5472 7565 2069 6620 6c65 6e28 6b75 6265  True if len(kube
-00019bc0: 656e 7472 6965 7329 203e 2031 2065 6c73  entries) > 1 els
-00019bd0: 6520 4661 6c73 650a 2020 2020 2020 2020  e False.        
-00019be0: 2020 2020 6966 206b 7562 6574 6872 6561      if kubethrea
-00019bf0: 6465 643a 0a20 2020 2020 2020 2020 2020  ded:.           
-00019c00: 2020 2020 2077 6172 6e69 6e67 2822 4c61       warning("La
-00019c10: 756e 6368 696e 6720 6561 6368 2063 6c75  unching each clu
-00019c20: 7374 6572 2069 6e20 6120 7468 7265 6164  ster in a thread
-00019c30: 2061 7320 7468 6572 6520 6973 206d 6f72   as there is mor
-00019c40: 6520 7468 616e 206f 6e65 2065 6e74 7279  e than one entry
-00019c50: 2e2e 2e22 290a 2020 2020 2020 2020 2020  ...").          
-00019c60: 2020 666f 7220 636c 7573 7465 7220 696e    for cluster in
-00019c70: 206b 7562 6565 6e74 7269 6573 3a0a 2020   kubeentries:.  
-00019c80: 2020 2020 2020 2020 2020 2020 2020 7070                pp
-00019c90: 7269 6e74 2866 2244 6570 6c6f 7969 6e67  rint(f"Deploying
-00019ca0: 2043 6c75 7374 6572 207b 636c 7573 7465   Cluster {cluste
-00019cb0: 727d 2e2e 2e22 290a 2020 2020 2020 2020  r}...").        
-00019cc0: 2020 2020 2020 2020 6b75 6265 7072 6f66          kubeprof
-00019cd0: 696c 6520 3d20 656e 7472 6965 735b 636c  ile = entries[cl
-00019ce0: 7573 7465 725d 0a20 2020 2020 2020 2020  uster].         
-00019cf0: 2020 2020 2020 206b 7562 6563 6c69 656e         kubeclien
-00019d00: 7420 3d20 6b75 6265 7072 6f66 696c 652e  t = kubeprofile.
-00019d10: 6765 7428 2763 6c69 656e 7427 290a 2020  get('client').  
-00019d20: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00019d30: 206b 7562 6563 6c69 656e 7420 6973 204e   kubeclient is N
-00019d40: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00019d50: 2020 2020 2020 2020 2063 7572 7265 6e74           current
-00019d60: 636f 6e66 6967 203d 2073 656c 660a 2020  config = self.  
-00019d70: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00019d80: 6966 206b 7562 6563 6c69 656e 7420 696e  if kubeclient in
-00019d90: 2073 656c 662e 636c 6965 6e74 733a 0a20   self.clients:. 
-00019da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019db0: 2020 2063 7572 7265 6e74 636f 6e66 6967     currentconfig
-00019dc0: 203d 204b 636f 6e66 6967 2863 6c69 656e   = Kconfig(clien
-00019dd0: 743d 6b75 6265 636c 6965 6e74 290a 2020  t=kubeclient).  
-00019de0: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00019df0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00019e00: 2020 2020 2020 2020 6572 726f 7228 6622          error(f"
-00019e10: 436c 6965 6e74 207b 6b75 6265 636c 6965  Client {kubeclie
-00019e20: 6e74 7d20 6e6f 7420 666f 756e 642e 2073  nt} not found. s
-00019e30: 6b69 7070 6564 2229 0a20 2020 2020 2020  kipped").       
-00019e40: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-00019e50: 7469 6e75 650a 2020 2020 2020 2020 2020  tinue.          
-00019e60: 2020 2020 2020 6b75 6265 7479 7065 203d        kubetype =
-00019e70: 206b 7562 6570 726f 6669 6c65 2e67 6574   kubeprofile.get
-00019e80: 2827 6b75 6265 7479 7065 2729 206f 7220  ('kubetype') or 
-00019e90: 6b75 6265 7072 6f66 696c 652e 6765 7428  kubeprofile.get(
-00019ea0: 2763 6c75 7374 6572 7479 7065 272c 2027  'clustertype', '
-00019eb0: 6765 6e65 7269 6327 290a 2020 2020 2020  generic').      
-00019ec0: 2020 2020 2020 2020 2020 6b75 6265 5f6f            kube_o
-00019ed0: 7665 7272 6964 6573 203d 206f 7665 7272  verrides = overr
-00019ee0: 6964 6573 2e63 6f70 7928 290a 2020 2020  ides.copy().    
-00019ef0: 2020 2020 2020 2020 2020 2020 6b75 6265              kube
-00019f00: 5f6f 7665 7272 6964 6573 2e75 7064 6174  _overrides.updat
-00019f10: 6528 6b75 6265 7072 6f66 696c 6529 0a20  e(kubeprofile). 
-00019f20: 2020 2020 2020 2020 2020 2020 2020 206b                 k
-00019f30: 7562 655f 6f76 6572 7269 6465 735b 2763  ube_overrides['c
-00019f40: 6c75 7374 6572 275d 203d 2063 6c75 7374  luster'] = clust
-00019f50: 6572 0a20 2020 2020 2020 2020 2020 2020  er.             
-00019f60: 2020 2065 7869 7374 696e 675f 6374 6c70     existing_ctlp
-00019f70: 6c61 6e65 7320 3d20 5b76 2066 6f72 2076  lanes = [v for v
-00019f80: 2069 6e20 6375 7272 656e 7463 6f6e 6669   in currentconfi
-00019f90: 672e 6b2e 6c69 7374 2829 2069 6620 6627  g.k.list() if f'
-00019fa0: 7b63 6c75 7374 6572 7d2d 6374 6c70 6c61  {cluster}-ctlpla
-00019fb0: 6e65 2720 696e 2076 5b27 6e61 6d65 275d  ne' in v['name']
-00019fc0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-00019fd0: 2020 6966 2065 7869 7374 696e 675f 6374    if existing_ct
-00019fe0: 6c70 6c61 6e65 733a 0a20 2020 2020 2020  lplanes:.       
-00019ff0: 2020 2020 2020 2020 2020 2020 2070 7072               ppr
-0001a000: 696e 7428 6622 436c 7573 7465 7220 7b63  int(f"Cluster {c
-0001a010: 6c75 7374 6572 7d20 666f 756e 642e 2073  luster} found. s
-0001a020: 6b69 7070 6564 2122 290a 2020 2020 2020  kipped!").      
-0001a030: 2020 2020 2020 2020 2020 2020 2020 636f                co
-0001a040: 6e74 696e 7565 0a20 2020 2020 2020 2020  ntinue.         
-0001a050: 2020 2020 2020 2069 6620 6b75 6265 7479         if kubety
-0001a060: 7065 206e 6f74 2069 6e20 5b27 6765 6e65  pe not in ['gene
-0001a070: 7269 6327 2c20 276f 7065 6e73 6869 6674  ric', 'openshift
-0001a080: 272c 2027 6879 7065 7273 6869 6674 272c  ', 'hypershift',
-0001a090: 2027 6d69 6372 6f73 6869 6674 272c 2027   'microshift', '
-0001a0a0: 6b33 7327 2c20 2767 6b65 272c 2027 656b  k3s', 'gke', 'ek
-0001a0b0: 7327 5d3a 0a20 2020 2020 2020 2020 2020  s']:.           
-0001a0c0: 2020 2020 2020 2020 2077 6172 6e69 6e67           warning
-0001a0d0: 2866 2249 6e63 6f72 7265 6374 206b 7562  (f"Incorrect kub
-0001a0e0: 6574 7970 6520 7b6b 7562 6574 7970 657d  etype {kubetype}
-0001a0f0: 2073 7065 6369 6669 6564 2e20 736b 6970   specified. skip
-0001a100: 7065 6421 2229 0a20 2020 2020 2020 2020  ped!").         
-0001a110: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
-0001a120: 6e75 650a 2020 2020 2020 2020 2020 2020  nue.            
-0001a130: 2020 2020 6966 206b 7562 6574 6872 6561      if kubethrea
-0001a140: 6465 643a 0a20 2020 2020 2020 2020 2020  ded:.           
-0001a150: 2020 2020 2020 2020 206b 7562 655f 6f76           kube_ov
-0001a160: 6572 7269 6465 735b 2775 7365 5f65 7869  errides['use_exi
-0001a170: 7374 696e 675f 6f70 656e 7368 6966 7427  sting_openshift'
-0001a180: 5d20 3d20 5472 7565 0a20 2020 2020 2020  ] = True.       
-0001a190: 2020 2020 2020 2020 2020 2020 206e 6577               new
-0001a1a0: 5f61 7267 7320 3d20 2870 6c61 6e2c 206b  _args = (plan, k
-0001a1b0: 7562 6574 7970 652c 206b 7562 655f 6f76  ubetype, kube_ov
-0001a1c0: 6572 7269 6465 7329 0a20 2020 2020 2020  errides).       
-0001a1d0: 2020 2020 2020 2020 2020 2020 2074 203d               t =
-0001a1e0: 2074 6872 6561 6469 6e67 2e54 6872 6561   threading.Threa
-0001a1f0: 6428 7461 7267 6574 3d73 656c 662e 7468  d(target=self.th
-0001a200: 7265 6164 6564 5f63 7265 6174 655f 6b75  readed_create_ku
-0001a210: 6265 2c20 6172 6773 3d6e 6577 5f61 7267  be, args=new_arg
-0001a220: 7329 0a20 2020 2020 2020 2020 2020 2020  s).             
-0001a230: 2020 2020 2020 2074 6872 6561 6473 2e61         threads.a
-0001a240: 7070 656e 6428 7429 0a20 2020 2020 2020  ppend(t).       
-0001a250: 2020 2020 2020 2020 2020 2020 2074 2e73               t.s
-0001a260: 7461 7274 2829 0a20 2020 2020 2020 2020  tart().         
-0001a270: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0001a280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a290: 2063 7572 7265 6e74 636f 6e66 6967 2e63   currentconfig.c
-0001a2a0: 7265 6174 655f 6b75 6265 2870 6c61 6e2c  reate_kube(plan,
-0001a2b0: 206b 7562 6574 7970 652c 206f 7665 7272   kubetype, overr
-0001a2c0: 6964 6573 3d6b 7562 655f 6f76 6572 7269  ides=kube_overri
-0001a2d0: 6465 7329 0a20 2020 2020 2020 2076 6d63  des).        vmc
-0001a2e0: 6c69 656e 7473 203d 205b 5d0a 2020 2020  lients = [].    
-0001a2f0: 2020 2020 6966 2076 6d65 6e74 7269 6573      if vmentries
-0001a300: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-0001a310: 206e 6f74 206f 6e6c 7961 7373 6574 733a   not onlyassets:
-0001a320: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a330: 2070 7072 696e 7428 2244 6570 6c6f 7969   pprint("Deployi
-0001a340: 6e67 2056 6d73 2e2e 2e22 290a 2020 2020  ng Vms...").    
-0001a350: 2020 2020 2020 2020 766d 636f 756e 7465          vmcounte
-0001a360: 7220 3d20 300a 2020 2020 2020 2020 2020  r = 0.          
-0001a370: 2020 686f 7374 7320 3d20 7b7d 0a20 2020    hosts = {}.   
-0001a380: 2020 2020 2020 2020 2076 6d73 5f74 6f5f           vms_to_
-0001a390: 686f 7374 203d 207b 7d0a 2020 2020 2020  host = {}.      
-0001a3a0: 2020 2020 2020 6261 7365 706c 616e 7320        baseplans 
-0001a3b0: 3d20 5b5d 0a20 2020 2020 2020 2020 2020  = [].           
-0001a3c0: 2076 6d6e 616d 6573 203d 205b 6e61 6d65   vmnames = [name
-0001a3d0: 2066 6f72 206e 616d 6520 696e 2076 6d65   for name in vme
-0001a3e0: 6e74 7269 6573 5d0a 2020 2020 2020 2020  ntries].        
-0001a3f0: 2020 2020 6966 2062 6173 6566 696c 6520      if basefile 
-0001a400: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-0001a410: 2020 2020 2020 2020 2020 2020 2062 6173               bas
-0001a420: 6564 6972 203d 206f 732e 7061 7468 2e64  edir = os.path.d
-0001a430: 6972 6e61 6d65 2869 6e70 7574 6669 6c65  irname(inputfile
-0001a440: 2920 6966 206f 732e 7061 7468 2e69 7361  ) if os.path.isa
-0001a450: 6273 2869 6e70 7574 6669 6c65 2920 656c  bs(inputfile) el
-0001a460: 7365 2027 2e27 0a20 2020 2020 2020 2020  se '.'.         
-0001a470: 2020 2020 2020 2062 6173 6569 6e70 7574         baseinput
-0001a480: 6669 6c65 203d 2066 227b 6261 7365 6469  file = f"{basedi
-0001a490: 727d 2f7b 6261 7365 6669 6c65 7d22 0a20  r}/{basefile}". 
-0001a4a0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0001a4b0: 6620 636f 6e74 6169 6e65 725f 6d6f 6465  f container_mode
-0001a4c0: 2829 2061 6e64 206e 6f74 206f 732e 7061  () and not os.pa
-0001a4d0: 7468 2e69 7361 6273 2862 6173 6566 696c  th.isabs(basefil
-0001a4e0: 6529 2061 6e64 2027 2f77 6f72 6b64 6972  e) and '/workdir
-0001a4f0: 2720 6e6f 7420 696e 2062 6173 6564 6972  ' not in basedir
-0001a500: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001a510: 2020 2020 2020 6261 7365 696e 7075 7466        baseinputf
-0001a520: 696c 6520 3d20 6622 2f77 6f72 6b64 6972  ile = f"/workdir
-0001a530: 2f7b 6261 7365 6469 727d 2f7b 6261 7365  /{basedir}/{base
-0001a540: 6669 6c65 7d22 0a20 2020 2020 2020 2020  file}".         
-0001a550: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
-0001a560: 7365 6c66 2e70 6c61 6e28 706c 616e 2c20  self.plan(plan, 
-0001a570: 696e 7075 7466 696c 653d 6261 7365 696e  inputfile=basein
-0001a580: 7075 7466 696c 652c 206f 7665 7272 6964  putfile, overrid
-0001a590: 6573 3d6f 7665 7272 6964 6573 2c20 6578  es=overrides, ex
-0001a5a0: 636c 7564 6576 6d73 3d76 6d6e 616d 6573  cludevms=vmnames
-0001a5b0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001a5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a5d0: 2020 2020 2062 6173 656d 6f64 653d 5472       basemode=Tr
-0001a5e0: 7565 2c20 6f6e 6c79 6173 7365 7473 3d6f  ue, onlyassets=o
-0001a5f0: 6e6c 7961 7373 6574 7329 0a20 2020 2020  nlyassets).     
-0001a600: 2020 2020 2020 2020 2020 2069 6620 7265             if re
-0001a610: 7375 6c74 5b27 7265 7375 6c74 275d 2021  sult['result'] !
-0001a620: 3d20 2773 7563 6365 7373 273a 0a20 2020  = 'success':.   
-0001a630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a640: 2072 6574 7572 6e20 7265 7375 6c74 0a20   return result. 
-0001a650: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-0001a660: 6173 6570 6c61 6e73 2e61 7070 656e 6428  aseplans.append(
-0001a670: 6261 7365 6669 6c65 290a 2020 2020 2020  basefile).      
-0001a680: 2020 2020 2020 766d 7275 6c65 735f 7374        vmrules_st
-0001a690: 7269 6374 203d 206f 7665 7272 6964 6573  rict = overrides
-0001a6a0: 2e67 6574 2827 766d 7275 6c65 735f 7374  .get('vmrules_st
-0001a6b0: 7269 6374 272c 2073 656c 662e 766d 7275  rict', self.vmru
-0001a6c0: 6c65 735f 7374 7269 6374 290a 2020 2020  les_strict).    
-0001a6d0: 2020 2020 2020 2020 666f 7220 6e61 6d65          for name
-0001a6e0: 2069 6e20 766d 656e 7472 6965 733a 0a20   in vmentries:. 
-0001a6f0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0001a700: 6620 6e61 6d65 2069 6e20 6578 636c 7564  f name in exclud
-0001a710: 6576 6d73 3a0a 2020 2020 2020 2020 2020  evms:.          
-0001a720: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
-0001a730: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
-0001a740: 2020 2063 7572 7265 6e74 706c 616e 6469     currentplandi
-0001a750: 7220 3d20 6261 7365 6469 720a 2020 2020  r = basedir.    
-0001a760: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-0001a770: 656e 2876 6d65 6e74 7269 6573 2920 3d3d  en(vmentries) ==
-0001a780: 2031 2061 6e64 2027 6e61 6d65 2720 696e   1 and 'name' in
-0001a790: 206f 7665 7272 6964 6573 3a0a 2020 2020   overrides:.    
-0001a7a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a7b0: 6e65 776e 616d 6520 3d20 6f76 6572 7269  newname = overri
-0001a7c0: 6465 735b 276e 616d 6527 5d0a 2020 2020  des['name'].    
-0001a7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a7e0: 7072 6f66 696c 6520 3d20 656e 7472 6965  profile = entrie
-0001a7f0: 735b 6e61 6d65 5d0a 2020 2020 2020 2020  s[name].        
-0001a800: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
-0001a810: 203d 206e 6577 6e61 6d65 0a20 2020 2020   = newname.     
-0001a820: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0001a830: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a840: 2020 2020 2070 726f 6669 6c65 203d 2065       profile = e
-0001a850: 6e74 7269 6573 5b6e 616d 655d 0a20 2020  ntries[name].   
-0001a860: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0001a870: 276e 616d 6527 2069 6e20 7072 6f66 696c  'name' in profil
-0001a880: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0001a890: 2020 2020 2020 206e 616d 6520 3d20 7072         name = pr
-0001a8a0: 6f66 696c 655b 276e 616d 6527 5d0a 2020  ofile['name'].  
-0001a8b0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0001a8c0: 2027 6261 7365 766d 2720 696e 2070 726f   'basevm' in pro
-0001a8d0: 6669 6c65 206f 7220 2762 6173 6570 6c61  file or 'basepla
-0001a8e0: 6e27 2069 6e20 7072 6f66 696c 653a 0a20  n' in profile:. 
-0001a8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a900: 2020 2062 6173 6570 726f 6669 6c65 203d     baseprofile =
-0001a910: 207b 7d0a 2020 2020 2020 2020 2020 2020   {}.            
-0001a920: 2020 2020 2020 2020 6170 7065 6e64 6b65          appendke
-0001a930: 7973 203d 205b 2764 6973 6b73 272c 2027  ys = ['disks', '
-0001a940: 6e65 7473 272c 2027 6669 6c65 7327 2c20  nets', 'files', 
-0001a950: 2773 6372 6970 7473 272c 2027 636d 6473  'scripts', 'cmds
-0001a960: 275d 0a20 2020 2020 2020 2020 2020 2020  '].             
-0001a970: 2020 2020 2020 2069 6620 2762 6173 6570         if 'basep
-0001a980: 6c61 6e27 2069 6e20 7072 6f66 696c 653a  lan' in profile:
-0001a990: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a9a0: 2020 2020 2020 2020 2062 6173 6570 6c61           basepla
-0001a9b0: 6e20 3d20 7072 6f66 696c 655b 2762 6173  n = profile['bas
-0001a9c0: 6570 6c61 6e27 5d0a 2020 2020 2020 2020  eplan'].        
-0001a9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a9e0: 6261 7365 6469 7220 3d20 6f73 2e70 6174  basedir = os.pat
-0001a9f0: 682e 6469 726e 616d 6528 696e 7075 7466  h.dirname(inputf
-0001aa00: 696c 6529 2069 6620 272f 2720 696e 2069  ile) if '/' in i
-0001aa10: 6e70 7574 6669 6c65 2065 6c73 6520 272e  nputfile else '.
-0001aa20: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
-0001aa30: 2020 2020 2020 2020 2020 6261 7365 696e            basein
-0001aa40: 7075 7466 696c 6520 3d20 6622 7b62 6173  putfile = f"{bas
-0001aa50: 6564 6972 7d2f 7b62 6173 6570 6c61 6e7d  edir}/{baseplan}
-0001aa60: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0001aa70: 2020 2020 2020 2020 2020 6966 2063 6f6e            if con
-0001aa80: 7461 696e 6572 5f6d 6f64 6528 2920 616e  tainer_mode() an
-0001aa90: 6420 6e6f 7420 6f73 2e70 6174 682e 6973  d not os.path.is
-0001aaa0: 6162 7328 6261 7365 706c 616e 2920 616e  abs(baseplan) an
-0001aab0: 6420 272f 776f 726b 6469 7227 206e 6f74  d '/workdir' not
-0001aac0: 2069 6e20 6261 7365 6469 723a 0a20 2020   in basedir:.   
+00018fa0: 2020 2020 636f 6e74 696e 7565 0a20 2020      continue.   
+00018fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018fc0: 206b 2e63 7265 6174 655f 706f 6f6c 2870   k.create_pool(p
+00018fd0: 6f6f 6c2c 2070 6f6f 6c70 6174 6829 0a20  ool, poolpath). 
+00018fe0: 2020 2020 2020 2069 6620 696d 6167 6565         if imagee
+00018ff0: 6e74 7269 6573 2061 6e64 206e 6f74 206f  ntries and not o
+00019000: 6e6c 7961 7373 6574 733a 0a20 2020 2020  nlyassets:.     
+00019010: 2020 2020 2020 2070 7072 696e 7428 2244         pprint("D
+00019020: 6570 6c6f 7969 6e67 2049 6d61 6765 732e  eploying Images.
+00019030: 2e2e 2229 0a20 2020 2020 2020 2020 2020  ..").           
+00019040: 2069 6d61 6765 7320 3d20 5b6f 732e 7061   images = [os.pa
+00019050: 7468 2e62 6173 656e 616d 6528 7429 2066  th.basename(t) f
+00019060: 6f72 2074 2069 6e20 6b2e 766f 6c75 6d65  or t in k.volume
+00019070: 7328 295d 0a20 2020 2020 2020 2020 2020  s()].           
+00019080: 2066 6f72 2069 6d61 6765 2069 6e20 696d   for image in im
+00019090: 6167 6565 6e74 7269 6573 3a0a 2020 2020  ageentries:.    
+000190a0: 2020 2020 2020 2020 2020 2020 696d 6167              imag
+000190b0: 6570 726f 6669 6c65 203d 2065 6e74 7269  eprofile = entri
+000190c0: 6573 5b69 6d61 6765 5d0a 2020 2020 2020  es[image].      
+000190d0: 2020 2020 2020 2020 2020 706f 6f6c 203d            pool =
+000190e0: 2069 6d61 6765 7072 6f66 696c 652e 6765   imageprofile.ge
+000190f0: 7428 2770 6f6f 6c27 2c20 7365 6c66 2e70  t('pool', self.p
+00019100: 6f6f 6c29 0a20 2020 2020 2020 2020 2020  ool).           
+00019110: 2020 2020 2069 6d61 6765 7369 7a65 203d       imagesize =
+00019120: 2069 6d61 6765 7072 6f66 696c 652e 6765   imageprofile.ge
+00019130: 7428 2773 697a 6527 290a 2020 2020 2020  t('size').      
+00019140: 2020 2020 2020 2020 2020 696d 6167 6575            imageu
+00019150: 726c 203d 2069 6d61 6765 7072 6f66 696c  rl = imageprofil
+00019160: 652e 6765 7428 2775 726c 2729 0a20 2020  e.get('url').   
+00019170: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00019180: 696d 6167 6520 696e 2069 6d61 6765 733a  image in images:
+00019190: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000191a0: 2020 2020 2070 7072 696e 7428 6622 496d       pprint(f"Im
+000191b0: 6167 6520 7b69 6d61 6765 7d20 736b 6970  age {image} skip
+000191c0: 7065 6421 2229 0a20 2020 2020 2020 2020  ped!").         
+000191d0: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
+000191e0: 6e75 650a 2020 2020 2020 2020 2020 2020  nue.            
+000191f0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00019200: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00019210: 2069 7369 6e73 7461 6e63 6528 696d 6167   isinstance(imag
+00019220: 6575 726c 2c20 7374 7229 2061 6e64 2069  eurl, str) and i
+00019230: 6d61 6765 7572 6c20 3d3d 2022 4e6f 6e65  mageurl == "None
+00019240: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
+00019250: 2020 2020 2020 2020 2020 2069 6d61 6765             image
+00019260: 7572 6c20 3d20 4e6f 6e65 0a20 2020 2020  url = None.     
+00019270: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00019280: 6d64 203d 2069 6d61 6765 7072 6f66 696c  md = imageprofil
+00019290: 652e 6765 7428 2763 6d64 2729 0a20 2020  e.get('cmd').   
+000192a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000192b0: 2073 656c 662e 6861 6e64 6c65 5f68 6f73   self.handle_hos
+000192c0: 7428 706f 6f6c 3d70 6f6f 6c2c 2069 6d61  t(pool=pool, ima
+000192d0: 6765 3d69 6d61 6765 2c20 646f 776e 6c6f  ge=image, downlo
+000192e0: 6164 3d54 7275 652c 2063 6d64 3d63 6d64  ad=True, cmd=cmd
+000192f0: 2c20 7572 6c3d 696d 6167 6575 726c 2c20  , url=imageurl, 
+00019300: 7369 7a65 3d69 6d61 6765 7369 7a65 290a  size=imagesize).
+00019310: 2020 2020 2020 2020 6966 2062 7563 6b65          if bucke
+00019320: 7465 6e74 7269 6573 2061 6e64 206e 6f74  tentries and not
+00019330: 206f 6e6c 7961 7373 6574 7320 616e 6420   onlyassets and 
+00019340: 7365 6c66 2e74 7970 6520 696e 205b 2761  self.type in ['a
+00019350: 7773 272c 2027 6763 7027 2c20 276f 7065  ws', 'gcp', 'ope
+00019360: 6e73 7461 636b 275d 3a0a 2020 2020 2020  nstack']:.      
+00019370: 2020 2020 2020 7070 7269 6e74 2822 4465        pprint("De
+00019380: 706c 6f79 696e 6720 4275 636b 6574 2045  ploying Bucket E
+00019390: 6e74 7269 6573 2e2e 2e22 290a 2020 2020  ntries...").    
+000193a0: 2020 2020 2020 2020 666f 7220 6275 636b          for buck
+000193b0: 6574 656e 7472 7920 696e 2062 7563 6b65  etentry in bucke
+000193c0: 7465 6e74 7269 6573 3a0a 2020 2020 2020  tentries:.      
+000193d0: 2020 2020 2020 2020 2020 6275 636b 6574            bucket
+000193e0: 7072 6f66 696c 6520 3d20 656e 7472 6965  profile = entrie
+000193f0: 735b 6275 636b 6574 656e 7472 795d 0a20  s[bucketentry]. 
+00019400: 2020 2020 2020 2020 2020 2020 2020 205f                 _
+00019410: 6669 6c65 7320 3d20 6275 636b 6574 7072  files = bucketpr
+00019420: 6f66 696c 652e 6765 7428 2766 696c 6573  ofile.get('files
+00019430: 272c 205b 5d29 0a20 2020 2020 2020 2020  ', []).         
+00019440: 2020 2020 2020 2073 656c 662e 6b2e 6372         self.k.cr
+00019450: 6561 7465 5f62 7563 6b65 7428 6275 636b  eate_bucket(buck
+00019460: 6574 656e 7472 7929 0a20 2020 2020 2020  etentry).       
+00019470: 2020 2020 2020 2020 2066 6f72 205f 6669           for _fi
+00019480: 6c20 696e 205f 6669 6c65 733a 0a20 2020  l in _files:.   
+00019490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000194a0: 2073 656c 662e 6b2e 7570 6c6f 6164 5f74   self.k.upload_t
+000194b0: 6f5f 6275 636b 6574 2862 7563 6b65 7465  o_bucket(buckete
+000194c0: 6e74 7279 2c20 5f66 696c 290a 2020 2020  ntry, _fil).    
+000194d0: 2020 2020 7465 6d70 6b65 7920 3d20 6f76      tempkey = ov
+000194e0: 6572 7269 6465 732e 6765 7428 2774 656d  errides.get('tem
+000194f0: 706b 6579 272c 2046 616c 7365 2920 6f72  pkey', False) or
+00019500: 2073 656c 662e 7465 6d70 6b65 790a 2020   self.tempkey.  
+00019510: 2020 2020 2020 6966 2074 656d 706b 6579        if tempkey
+00019520: 3a0a 2020 2020 2020 2020 2020 2020 7465  :.            te
+00019530: 6d70 6b65 7964 6972 203d 2054 656d 706f  mpkeydir = Tempo
+00019540: 7261 7279 4469 7265 6374 6f72 7928 290a  raryDirectory().
+00019550: 2020 2020 2020 2020 2020 2020 6f76 6572              over
+00019560: 7269 6465 735b 2774 656d 706b 6579 6469  rides['tempkeydi
+00019570: 7227 5d20 3d20 7465 6d70 6b65 7964 6972  r'] = tempkeydir
+00019580: 0a20 2020 2020 2020 2020 2020 206f 7665  .            ove
+00019590: 7272 6964 6573 5b27 7465 6d70 6b65 7964  rrides['tempkeyd
+000195a0: 6972 6b65 6570 275d 203d 2054 7275 650a  irkeep'] = True.
+000195b0: 2020 2020 2020 2020 6966 2070 6c61 6e65          if plane
+000195c0: 6e74 7269 6573 3a0a 2020 2020 2020 2020  ntries:.        
+000195d0: 2020 2020 7070 7269 6e74 2822 4465 706c      pprint("Depl
+000195e0: 6f79 696e 6720 506c 616e 732e 2e2e 2229  oying Plans...")
+000195f0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+00019600: 2070 6c61 6e65 6e74 7279 2069 6e20 706c   planentry in pl
+00019610: 616e 656e 7472 6965 733a 0a20 2020 2020  anentries:.     
+00019620: 2020 2020 2020 2020 2020 2064 6574 6169             detai
+00019630: 6c73 203d 2065 6e74 7269 6573 5b70 6c61  ls = entries[pla
+00019640: 6e65 6e74 7279 5d0a 2020 2020 2020 2020  nentry].        
+00019650: 2020 2020 2020 2020 706c 616e 7572 6c20          planurl 
+00019660: 3d20 6465 7461 696c 732e 6765 7428 2775  = details.get('u
+00019670: 726c 2729 0a20 2020 2020 2020 2020 2020  rl').           
+00019680: 2020 2020 2070 6c61 6e66 696c 6520 3d20       planfile = 
+00019690: 6465 7461 696c 732e 6765 7428 2766 696c  details.get('fil
+000196a0: 6527 290a 2020 2020 2020 2020 2020 2020  e').            
+000196b0: 2020 2020 6966 2070 6c61 6e75 726c 2069      if planurl i
+000196c0: 7320 4e6f 6e65 2061 6e64 2070 6c61 6e66  s None and planf
+000196d0: 696c 6520 6973 204e 6f6e 653a 0a20 2020  ile is None:.   
+000196e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000196f0: 2077 6172 6e69 6e67 2866 224d 6973 7369   warning(f"Missi
+00019700: 6e67 2055 726c 2f46 696c 6520 666f 7220  ng Url/File for 
+00019710: 706c 616e 207b 706c 616e 656e 7472 797d  plan {planentry}
+00019720: 2e20 4e6f 7420 6372 6561 7469 6e67 2069  . Not creating i
+00019730: 742e 2e2e 2229 0a20 2020 2020 2020 2020  t...").         
+00019740: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
+00019750: 6e75 650a 2020 2020 2020 2020 2020 2020  nue.            
+00019760: 2020 2020 656c 6966 2070 6c61 6e75 726c      elif planurl
+00019770: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+00019780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019790: 2020 7061 7468 203d 2070 6c61 6e65 6e74    path = planent
+000197a0: 7279 0a20 2020 2020 2020 2020 2020 2020  ry.             
+000197b0: 2020 2020 2020 2069 6620 6e6f 7420 706c         if not pl
+000197c0: 616e 7572 6c2e 656e 6473 7769 7468 2827  anurl.endswith('
+000197d0: 796d 6c27 293a 0a20 2020 2020 2020 2020  yml'):.         
+000197e0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+000197f0: 6c61 6e75 726c 203d 2066 227b 706c 616e  lanurl = f"{plan
+00019800: 7572 6c7d 2f6b 636c 695f 706c 616e 2e79  url}/kcli_plan.y
+00019810: 6d6c 220a 2020 2020 2020 2020 2020 2020  ml".            
+00019820: 2020 2020 656c 6966 2027 2f27 2069 6e20      elif '/' in 
+00019830: 706c 616e 6669 6c65 3a0a 2020 2020 2020  planfile:.      
+00019840: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+00019850: 7468 203d 206f 732e 7061 7468 2e64 6972  th = os.path.dir
+00019860: 6e61 6d65 2870 6c61 6e66 696c 6529 0a20  name(planfile). 
+00019870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019880: 2020 2069 6e70 7574 6669 6c65 203d 206f     inputfile = o
+00019890: 732e 7061 7468 2e62 6173 656e 616d 6528  s.path.basename(
+000198a0: 706c 616e 6669 6c65 290a 2020 2020 2020  planfile).      
+000198b0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+000198c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000198d0: 2020 2020 7061 7468 203d 2027 2e27 0a20      path = '.'. 
+000198e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000198f0: 2020 2069 6e70 7574 6669 6c65 203d 2070     inputfile = p
+00019900: 6c61 6e65 6e74 7279 0a20 2020 2020 2020  lanentry.       
+00019910: 2020 2020 2020 2020 2069 6620 6e6f 5f6f           if no_o
+00019920: 7665 7272 6964 6573 2061 6e64 2070 6172  verrides and par
+00019930: 616d 6574 6572 733a 0a20 2020 2020 2020  ameters:.       
+00019940: 2020 2020 2020 2020 2020 2020 2070 7072               ppr
+00019950: 696e 7428 2255 7369 6e67 2070 6172 616d  int("Using param
+00019960: 6574 6572 7320 6672 6f6d 2066 6174 6865  eters from fathe
+00019970: 7220 706c 616e 2069 6e20 6368 696c 6420  r plan in child 
+00019980: 6f6e 6573 2229 0a20 2020 2020 2020 2020  ones").         
+00019990: 2020 2020 2020 2020 2020 2066 6f72 206f             for o
+000199a0: 7665 7272 6964 6520 696e 206f 7665 7272  verride in overr
+000199b0: 6964 6573 3a0a 2020 2020 2020 2020 2020  ides:.          
+000199c0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+000199d0: 696e 7428 2255 7369 6e67 2070 6172 616d  int("Using param
+000199e0: 6574 6572 2025 733a 2025 7322 2025 2028  eter %s: %s" % (
+000199f0: 6f76 6572 7269 6465 2c20 6f76 6572 7269  override, overri
+00019a00: 6465 735b 6f76 6572 7269 6465 5d29 290a  des[override])).
+00019a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019a20: 7365 6c66 2e70 6c61 6e28 706c 616e 2c20  self.plan(plan, 
+00019a30: 616e 7369 626c 653d 4661 6c73 652c 2075  ansible=False, u
+00019a40: 726c 3d70 6c61 6e75 726c 2c20 7061 7468  rl=planurl, path
+00019a50: 3d70 6174 682c 2063 6f6e 7461 696e 6572  =path, container
+00019a60: 3d46 616c 7365 2c20 696e 7075 7466 696c  =False, inputfil
+00019a70: 653d 696e 7075 7466 696c 652c 0a20 2020  e=inputfile,.   
+00019a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019a90: 2020 2020 2020 206f 7665 7272 6964 6573         overrides
+00019aa0: 3d6f 7665 7272 6964 6573 2c20 656d 6265  =overrides, embe
+00019ab0: 6464 6564 3d65 6d62 6564 6465 642c 2064  dded=embedded, d
+00019ac0: 6f77 6e6c 6f61 643d 646f 776e 6c6f 6164  ownload=download
+00019ad0: 290a 2020 2020 2020 2020 6966 206b 7562  ).        if kub
+00019ae0: 6565 6e74 7269 6573 2061 6e64 206e 6f74  eentries and not
+00019af0: 206f 6e6c 7961 7373 6574 733a 0a20 2020   onlyassets:.   
+00019b00: 2020 2020 2020 2020 2070 7072 696e 7428           pprint(
+00019b10: 2244 6570 6c6f 7969 6e67 204b 7562 6520  "Deploying Kube 
+00019b20: 456e 7472 6965 732e 2e2e 2229 0a20 2020  Entries...").   
+00019b30: 2020 2020 2020 2020 2064 6e73 636c 6965           dnsclie
+00019b40: 6e74 7320 3d20 7b7d 0a20 2020 2020 2020  nts = {}.       
+00019b50: 2020 2020 206b 7562 6574 6872 6561 6465       kubethreade
+00019b60: 6420 3d20 5472 7565 2069 6620 6c65 6e28  d = True if len(
+00019b70: 6b75 6265 656e 7472 6965 7329 203e 2031  kubeentries) > 1
+00019b80: 2065 6c73 6520 4661 6c73 650a 2020 2020   else False.    
+00019b90: 2020 2020 2020 2020 6966 206b 7562 6574          if kubet
+00019ba0: 6872 6561 6465 643a 0a20 2020 2020 2020  hreaded:.       
+00019bb0: 2020 2020 2020 2020 2077 6172 6e69 6e67           warning
+00019bc0: 2822 4c61 756e 6368 696e 6720 6561 6368  ("Launching each
+00019bd0: 2063 6c75 7374 6572 2069 6e20 6120 7468   cluster in a th
+00019be0: 7265 6164 2061 7320 7468 6572 6520 6973  read as there is
+00019bf0: 206d 6f72 6520 7468 616e 206f 6e65 2065   more than one e
+00019c00: 6e74 7279 2e2e 2e22 290a 2020 2020 2020  ntry...").      
+00019c10: 2020 2020 2020 666f 7220 636c 7573 7465        for cluste
+00019c20: 7220 696e 206b 7562 6565 6e74 7269 6573  r in kubeentries
+00019c30: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00019c40: 2020 7070 7269 6e74 2866 2244 6570 6c6f    pprint(f"Deplo
+00019c50: 7969 6e67 2043 6c75 7374 6572 207b 636c  ying Cluster {cl
+00019c60: 7573 7465 727d 2e2e 2e22 290a 2020 2020  uster}...").    
+00019c70: 2020 2020 2020 2020 2020 2020 6b75 6265              kube
+00019c80: 7072 6f66 696c 6520 3d20 656e 7472 6965  profile = entrie
+00019c90: 735b 636c 7573 7465 725d 0a20 2020 2020  s[cluster].     
+00019ca0: 2020 2020 2020 2020 2020 206b 7562 6563             kubec
+00019cb0: 6c69 656e 7420 3d20 6b75 6265 7072 6f66  lient = kubeprof
+00019cc0: 696c 652e 6765 7428 2763 6c69 656e 7427  ile.get('client'
+00019cd0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00019ce0: 2020 6966 206b 7562 6563 6c69 656e 7420    if kubeclient 
+00019cf0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+00019d00: 2020 2020 2020 2020 2020 2020 2063 7572               cur
+00019d10: 7265 6e74 636f 6e66 6967 203d 2073 656c  rentconfig = sel
+00019d20: 660a 2020 2020 2020 2020 2020 2020 2020  f.              
+00019d30: 2020 656c 6966 206b 7562 6563 6c69 656e    elif kubeclien
+00019d40: 7420 696e 2073 656c 662e 636c 6965 6e74  t in self.client
+00019d50: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+00019d60: 2020 2020 2020 2063 7572 7265 6e74 636f         currentco
+00019d70: 6e66 6967 203d 204b 636f 6e66 6967 2863  nfig = Kconfig(c
+00019d80: 6c69 656e 743d 6b75 6265 636c 6965 6e74  lient=kubeclient
+00019d90: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00019da0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00019db0: 2020 2020 2020 2020 2020 2020 6572 726f              erro
+00019dc0: 7228 6622 436c 6965 6e74 207b 6b75 6265  r(f"Client {kube
+00019dd0: 636c 6965 6e74 7d20 6e6f 7420 666f 756e  client} not foun
+00019de0: 642e 2073 6b69 7070 6564 2229 0a20 2020  d. skipped").   
+00019df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019e00: 2063 6f6e 7469 6e75 650a 2020 2020 2020   continue.      
+00019e10: 2020 2020 2020 2020 2020 6b75 6265 7479            kubety
+00019e20: 7065 203d 206b 7562 6570 726f 6669 6c65  pe = kubeprofile
+00019e30: 2e67 6574 2827 6b75 6265 7479 7065 2729  .get('kubetype')
+00019e40: 206f 7220 6b75 6265 7072 6f66 696c 652e   or kubeprofile.
+00019e50: 6765 7428 2763 6c75 7374 6572 7479 7065  get('clustertype
+00019e60: 272c 2027 6765 6e65 7269 6327 290a 2020  ', 'generic').  
+00019e70: 2020 2020 2020 2020 2020 2020 2020 6b75                ku
+00019e80: 6265 5f6f 7665 7272 6964 6573 203d 206f  be_overrides = o
+00019e90: 7665 7272 6964 6573 2e63 6f70 7928 290a  verrides.copy().
+00019ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019eb0: 6b75 6265 5f6f 7665 7272 6964 6573 2e75  kube_overrides.u
+00019ec0: 7064 6174 6528 6b75 6265 7072 6f66 696c  pdate(kubeprofil
+00019ed0: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
+00019ee0: 2020 206b 7562 655f 6f76 6572 7269 6465     kube_override
+00019ef0: 735b 2763 6c75 7374 6572 275d 203d 2063  s['cluster'] = c
+00019f00: 6c75 7374 6572 0a20 2020 2020 2020 2020  luster.         
+00019f10: 2020 2020 2020 2065 7869 7374 696e 675f         existing_
+00019f20: 6374 6c70 6c61 6e65 7320 3d20 5b76 2066  ctlplanes = [v f
+00019f30: 6f72 2076 2069 6e20 6375 7272 656e 7463  or v in currentc
+00019f40: 6f6e 6669 672e 6b2e 6c69 7374 2829 2069  onfig.k.list() i
+00019f50: 6620 6627 7b63 6c75 7374 6572 7d2d 6374  f f'{cluster}-ct
+00019f60: 6c70 6c61 6e65 2720 696e 2076 5b27 6e61  lplane' in v['na
+00019f70: 6d65 275d 5d0a 2020 2020 2020 2020 2020  me']].          
+00019f80: 2020 2020 2020 6966 2065 7869 7374 696e        if existin
+00019f90: 675f 6374 6c70 6c61 6e65 733a 0a20 2020  g_ctlplanes:.   
+00019fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019fb0: 2070 7072 696e 7428 6622 436c 7573 7465   pprint(f"Cluste
+00019fc0: 7220 7b63 6c75 7374 6572 7d20 666f 756e  r {cluster} foun
+00019fd0: 642e 2073 6b69 7070 6564 2122 290a 2020  d. skipped!").  
+00019fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019ff0: 2020 636f 6e74 696e 7565 0a20 2020 2020    continue.     
+0001a000: 2020 2020 2020 2020 2020 2069 6620 6b75             if ku
+0001a010: 6265 7479 7065 206e 6f74 2069 6e20 5b27  betype not in ['
+0001a020: 6765 6e65 7269 6327 2c20 276f 7065 6e73  generic', 'opens
+0001a030: 6869 6674 272c 2027 6879 7065 7273 6869  hift', 'hypershi
+0001a040: 6674 272c 2027 6d69 6372 6f73 6869 6674  ft', 'microshift
+0001a050: 272c 2027 6b33 7327 2c20 2767 6b65 272c  ', 'k3s', 'gke',
+0001a060: 2027 656b 7327 5d3a 0a20 2020 2020 2020   'eks']:.       
+0001a070: 2020 2020 2020 2020 2020 2020 2077 6172               war
+0001a080: 6e69 6e67 2866 2249 6e63 6f72 7265 6374  ning(f"Incorrect
+0001a090: 206b 7562 6574 7970 6520 7b6b 7562 6574   kubetype {kubet
+0001a0a0: 7970 657d 2073 7065 6369 6669 6564 2e20  ype} specified. 
+0001a0b0: 736b 6970 7065 6421 2229 0a20 2020 2020  skipped!").     
+0001a0c0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0001a0d0: 6f6e 7469 6e75 650a 2020 2020 2020 2020  ontinue.        
+0001a0e0: 2020 2020 2020 2020 6966 206b 7562 6574          if kubet
+0001a0f0: 6872 6561 6465 643a 0a20 2020 2020 2020  hreaded:.       
+0001a100: 2020 2020 2020 2020 2020 2020 206b 7562               kub
+0001a110: 655f 6f76 6572 7269 6465 735b 2775 7365  e_overrides['use
+0001a120: 5f65 7869 7374 696e 675f 6f70 656e 7368  _existing_opensh
+0001a130: 6966 7427 5d20 3d20 5472 7565 0a20 2020  ift'] = True.   
+0001a140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a150: 206e 6577 5f61 7267 7320 3d20 2870 6c61   new_args = (pla
+0001a160: 6e2c 206b 7562 6574 7970 652c 206b 7562  n, kubetype, kub
+0001a170: 655f 6f76 6572 7269 6465 7329 0a20 2020  e_overrides).   
+0001a180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a190: 2074 203d 2074 6872 6561 6469 6e67 2e54   t = threading.T
+0001a1a0: 6872 6561 6428 7461 7267 6574 3d73 656c  hread(target=sel
+0001a1b0: 662e 7468 7265 6164 6564 5f63 7265 6174  f.threaded_creat
+0001a1c0: 655f 6b75 6265 2c20 6172 6773 3d6e 6577  e_kube, args=new
+0001a1d0: 5f61 7267 7329 0a20 2020 2020 2020 2020  _args).         
+0001a1e0: 2020 2020 2020 2020 2020 2074 6872 6561             threa
+0001a1f0: 6473 2e61 7070 656e 6428 7429 0a20 2020  ds.append(t).   
+0001a200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a210: 2074 2e73 7461 7274 2829 0a20 2020 2020   t.start().     
+0001a220: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0001a230: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001a240: 2020 2020 2063 7572 7265 6e74 636f 6e66       currentconf
+0001a250: 6967 2e63 7265 6174 655f 6b75 6265 2870  ig.create_kube(p
+0001a260: 6c61 6e2c 206b 7562 6574 7970 652c 206f  lan, kubetype, o
+0001a270: 7665 7272 6964 6573 3d6b 7562 655f 6f76  verrides=kube_ov
+0001a280: 6572 7269 6465 7329 0a20 2020 2020 2020  errides).       
+0001a290: 2076 6d63 6c69 656e 7473 203d 205b 5d0a   vmclients = [].
+0001a2a0: 2020 2020 2020 2020 6966 2076 6d65 6e74          if vment
+0001a2b0: 7269 6573 3a0a 2020 2020 2020 2020 2020  ries:.          
+0001a2c0: 2020 6966 206e 6f74 206f 6e6c 7961 7373    if not onlyass
+0001a2d0: 6574 733a 0a20 2020 2020 2020 2020 2020  ets:.           
+0001a2e0: 2020 2020 2070 7072 696e 7428 2244 6570       pprint("Dep
+0001a2f0: 6c6f 7969 6e67 2056 6d73 2e2e 2e22 290a  loying Vms...").
+0001a300: 2020 2020 2020 2020 2020 2020 766d 636f              vmco
+0001a310: 756e 7465 7220 3d20 300a 2020 2020 2020  unter = 0.      
+0001a320: 2020 2020 2020 686f 7374 7320 3d20 7b7d        hosts = {}
+0001a330: 0a20 2020 2020 2020 2020 2020 2076 6d73  .            vms
+0001a340: 5f74 6f5f 686f 7374 203d 207b 7d0a 2020  _to_host = {}.  
+0001a350: 2020 2020 2020 2020 2020 6261 7365 706c            basepl
+0001a360: 616e 7320 3d20 5b5d 0a20 2020 2020 2020  ans = [].       
+0001a370: 2020 2020 2076 6d6e 616d 6573 203d 205b       vmnames = [
+0001a380: 6e61 6d65 2066 6f72 206e 616d 6520 696e  name for name in
+0001a390: 2076 6d65 6e74 7269 6573 5d0a 2020 2020   vmentries].    
+0001a3a0: 2020 2020 2020 2020 6966 2062 6173 6566          if basef
+0001a3b0: 696c 6520 6973 206e 6f74 204e 6f6e 653a  ile is not None:
+0001a3c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001a3d0: 2062 6173 6564 6972 203d 206f 732e 7061   basedir = os.pa
+0001a3e0: 7468 2e64 6972 6e61 6d65 2869 6e70 7574  th.dirname(input
+0001a3f0: 6669 6c65 2920 6966 206f 732e 7061 7468  file) if os.path
+0001a400: 2e69 7361 6273 2869 6e70 7574 6669 6c65  .isabs(inputfile
+0001a410: 2920 656c 7365 2027 2e27 0a20 2020 2020  ) else '.'.     
+0001a420: 2020 2020 2020 2020 2020 2062 6173 6569             basei
+0001a430: 6e70 7574 6669 6c65 203d 2066 227b 6261  nputfile = f"{ba
+0001a440: 7365 6469 727d 2f7b 6261 7365 6669 6c65  sedir}/{basefile
+0001a450: 7d22 0a20 2020 2020 2020 2020 2020 2020  }".             
+0001a460: 2020 2069 6620 636f 6e74 6169 6e65 725f     if container_
+0001a470: 6d6f 6465 2829 2061 6e64 206e 6f74 206f  mode() and not o
+0001a480: 732e 7061 7468 2e69 7361 6273 2862 6173  s.path.isabs(bas
+0001a490: 6566 696c 6529 2061 6e64 2027 2f77 6f72  efile) and '/wor
+0001a4a0: 6b64 6972 2720 6e6f 7420 696e 2062 6173  kdir' not in bas
+0001a4b0: 6564 6972 3a0a 2020 2020 2020 2020 2020  edir:.          
+0001a4c0: 2020 2020 2020 2020 2020 6261 7365 696e            basein
+0001a4d0: 7075 7466 696c 6520 3d20 6622 2f77 6f72  putfile = f"/wor
+0001a4e0: 6b64 6972 2f7b 6261 7365 6469 727d 2f7b  kdir/{basedir}/{
+0001a4f0: 6261 7365 6669 6c65 7d22 0a20 2020 2020  basefile}".     
+0001a500: 2020 2020 2020 2020 2020 2072 6573 756c             resul
+0001a510: 7420 3d20 7365 6c66 2e70 6c61 6e28 706c  t = self.plan(pl
+0001a520: 616e 2c20 696e 7075 7466 696c 653d 6261  an, inputfile=ba
+0001a530: 7365 696e 7075 7466 696c 652c 206f 7665  seinputfile, ove
+0001a540: 7272 6964 6573 3d6f 7665 7272 6964 6573  rrides=overrides
+0001a550: 2c20 6578 636c 7564 6576 6d73 3d76 6d6e  , excludevms=vmn
+0001a560: 616d 6573 2c0a 2020 2020 2020 2020 2020  ames,.          
+0001a570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a580: 2020 2020 2020 2020 2062 6173 656d 6f64           basemod
+0001a590: 653d 5472 7565 2c20 6f6e 6c79 6173 7365  e=True, onlyasse
+0001a5a0: 7473 3d6f 6e6c 7961 7373 6574 7329 0a20  ts=onlyassets). 
+0001a5b0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0001a5c0: 6620 7265 7375 6c74 5b27 7265 7375 6c74  f result['result
+0001a5d0: 275d 2021 3d20 2773 7563 6365 7373 273a  '] != 'success':
+0001a5e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001a5f0: 2020 2020 2072 6574 7572 6e20 7265 7375       return resu
+0001a600: 6c74 0a20 2020 2020 2020 2020 2020 2020  lt.             
+0001a610: 2020 2062 6173 6570 6c61 6e73 2e61 7070     baseplans.app
+0001a620: 656e 6428 6261 7365 6669 6c65 290a 2020  end(basefile).  
+0001a630: 2020 2020 2020 2020 2020 766d 7275 6c65            vmrule
+0001a640: 735f 7374 7269 6374 203d 206f 7665 7272  s_strict = overr
+0001a650: 6964 6573 2e67 6574 2827 766d 7275 6c65  ides.get('vmrule
+0001a660: 735f 7374 7269 6374 272c 2073 656c 662e  s_strict', self.
+0001a670: 766d 7275 6c65 735f 7374 7269 6374 290a  vmrules_strict).
+0001a680: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+0001a690: 6e61 6d65 2069 6e20 766d 656e 7472 6965  name in vmentrie
+0001a6a0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+0001a6b0: 2020 2069 6620 6e61 6d65 2069 6e20 6578     if name in ex
+0001a6c0: 636c 7564 6576 6d73 3a0a 2020 2020 2020  cludevms:.      
+0001a6d0: 2020 2020 2020 2020 2020 2020 2020 636f                co
+0001a6e0: 6e74 696e 7565 0a20 2020 2020 2020 2020  ntinue.         
+0001a6f0: 2020 2020 2020 2063 7572 7265 6e74 706c         currentpl
+0001a700: 616e 6469 7220 3d20 6261 7365 6469 720a  andir = basedir.
+0001a710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a720: 6966 206c 656e 2876 6d65 6e74 7269 6573  if len(vmentries
+0001a730: 2920 3d3d 2031 2061 6e64 2027 6e61 6d65  ) == 1 and 'name
+0001a740: 2720 696e 206f 7665 7272 6964 6573 3a0a  ' in overrides:.
+0001a750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a760: 2020 2020 6e65 776e 616d 6520 3d20 6f76      newname = ov
+0001a770: 6572 7269 6465 735b 276e 616d 6527 5d0a  errides['name'].
+0001a780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a790: 2020 2020 7072 6f66 696c 6520 3d20 656e      profile = en
+0001a7a0: 7472 6965 735b 6e61 6d65 5d0a 2020 2020  tries[name].    
+0001a7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a7c0: 6e61 6d65 203d 206e 6577 6e61 6d65 0a20  name = newname. 
+0001a7d0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0001a7e0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0001a7f0: 2020 2020 2020 2020 2070 726f 6669 6c65           profile
+0001a800: 203d 2065 6e74 7269 6573 5b6e 616d 655d   = entries[name]
+0001a810: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001a820: 2069 6620 276e 616d 6527 2069 6e20 7072   if 'name' in pr
+0001a830: 6f66 696c 653a 0a20 2020 2020 2020 2020  ofile:.         
+0001a840: 2020 2020 2020 2020 2020 206e 616d 6520             name 
+0001a850: 3d20 7072 6f66 696c 655b 276e 616d 6527  = profile['name'
+0001a860: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+0001a870: 2020 6966 2027 6261 7365 766d 2720 696e    if 'basevm' in
+0001a880: 2070 726f 6669 6c65 206f 7220 2762 6173   profile or 'bas
+0001a890: 6570 6c61 6e27 2069 6e20 7072 6f66 696c  eplan' in profil
+0001a8a0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0001a8b0: 2020 2020 2020 2062 6173 6570 726f 6669         baseprofi
+0001a8c0: 6c65 203d 207b 7d0a 2020 2020 2020 2020  le = {}.        
+0001a8d0: 2020 2020 2020 2020 2020 2020 6170 7065              appe
+0001a8e0: 6e64 6b65 7973 203d 205b 2764 6973 6b73  ndkeys = ['disks
+0001a8f0: 272c 2027 6e65 7473 272c 2027 6669 6c65  ', 'nets', 'file
+0001a900: 7327 2c20 2773 6372 6970 7473 272c 2027  s', 'scripts', '
+0001a910: 636d 6473 275d 0a20 2020 2020 2020 2020  cmds'].         
+0001a920: 2020 2020 2020 2020 2020 2069 6620 2762             if 'b
+0001a930: 6173 6570 6c61 6e27 2069 6e20 7072 6f66  aseplan' in prof
+0001a940: 696c 653a 0a20 2020 2020 2020 2020 2020  ile:.           
+0001a950: 2020 2020 2020 2020 2020 2020 2062 6173               bas
+0001a960: 6570 6c61 6e20 3d20 7072 6f66 696c 655b  eplan = profile[
+0001a970: 2762 6173 6570 6c61 6e27 5d0a 2020 2020  'baseplan'].    
+0001a980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a990: 2020 2020 6261 7365 6469 7220 3d20 6f73      basedir = os
+0001a9a0: 2e70 6174 682e 6469 726e 616d 6528 696e  .path.dirname(in
+0001a9b0: 7075 7466 696c 6529 2069 6620 272f 2720  putfile) if '/' 
+0001a9c0: 696e 2069 6e70 7574 6669 6c65 2065 6c73  in inputfile els
+0001a9d0: 6520 272e 270a 2020 2020 2020 2020 2020  e '.'.          
+0001a9e0: 2020 2020 2020 2020 2020 2020 2020 6261                ba
+0001a9f0: 7365 696e 7075 7466 696c 6520 3d20 6622  seinputfile = f"
+0001aa00: 7b62 6173 6564 6972 7d2f 7b62 6173 6570  {basedir}/{basep
+0001aa10: 6c61 6e7d 220a 2020 2020 2020 2020 2020  lan}".          
+0001aa20: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0001aa30: 2063 6f6e 7461 696e 6572 5f6d 6f64 6528   container_mode(
+0001aa40: 2920 616e 6420 6e6f 7420 6f73 2e70 6174  ) and not os.pat
+0001aa50: 682e 6973 6162 7328 6261 7365 706c 616e  h.isabs(baseplan
+0001aa60: 2920 616e 6420 272f 776f 726b 6469 7227  ) and '/workdir'
+0001aa70: 206e 6f74 2069 6e20 6261 7365 6469 723a   not in basedir:
+0001aa80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001aa90: 2020 2020 2020 2020 2020 2020 2062 6173               bas
+0001aaa0: 6569 6e70 7574 6669 6c65 203d 2066 222f  einputfile = f"/
+0001aab0: 776f 726b 6469 722f 7b62 6173 6564 6972  workdir/{basedir
+0001aac0: 7d2f 7b62 6173 6570 6c61 6e7d 220a 2020  }/{baseplan}".  
 0001aad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aae0: 2020 2020 2020 2020 2062 6173 6569 6e70           baseinp
-0001aaf0: 7574 6669 6c65 203d 2066 222f 776f 726b  utfile = f"/work
-0001ab00: 6469 722f 7b62 6173 6564 6972 7d2f 7b62  dir/{basedir}/{b
-0001ab10: 6173 6570 6c61 6e7d 220a 2020 2020 2020  aseplan}".      
-0001ab20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ab30: 2020 6261 7365 766d 203d 2070 726f 6669    basevm = profi
-0001ab40: 6c65 5b27 6261 7365 766d 275d 2069 6620  le['basevm'] if 
-0001ab50: 2762 6173 6576 6d27 2069 6e20 7072 6f66  'basevm' in prof
-0001ab60: 696c 6520 656c 7365 206e 616d 650a 2020  ile else name.  
-0001ab70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ab80: 2020 2020 2020 6966 2062 6173 6570 6c61        if basepla
-0001ab90: 6e20 6e6f 7420 696e 2062 6173 6570 6c61  n not in basepla
-0001aba0: 6e73 3a0a 2020 2020 2020 2020 2020 2020  ns:.            
-0001abb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001abc0: 7365 6c66 2e70 6c61 6e28 706c 616e 2c20  self.plan(plan, 
-0001abd0: 696e 7075 7466 696c 653d 6261 7365 696e  inputfile=basein
-0001abe0: 7075 7466 696c 652c 206f 7665 7272 6964  putfile, overrid
-0001abf0: 6573 3d6f 7665 7272 6964 6573 2c20 6578  es=overrides, ex
-0001ac00: 636c 7564 6576 6d73 3d76 6d6e 616d 6573  cludevms=vmnames
-0001ac10: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001ac20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ac30: 2020 2020 2020 2020 6261 7365 6d6f 6465          basemode
-0001ac40: 3d54 7275 652c 206f 6e6c 7961 7373 6574  =True, onlyasset
-0001ac50: 733d 6f6e 6c79 6173 7365 7473 290a 2020  s=onlyassets).  
-0001ac60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ac70: 2020 2020 2020 2020 2020 6261 7365 706c            basepl
-0001ac80: 616e 732e 6170 7065 6e64 2862 6173 6570  ans.append(basep
-0001ac90: 6c61 6e29 0a20 2020 2020 2020 2020 2020  lan).           
-0001aca0: 2020 2020 2020 2020 2020 2020 2062 6173               bas
-0001acb0: 6569 6e66 6f20 3d20 7365 6c66 2e70 726f  einfo = self.pro
-0001acc0: 6365 7373 5f69 6e70 7574 6669 6c65 2870  cess_inputfile(p
-0001acd0: 6c61 6e2c 2062 6173 6569 6e70 7574 6669  lan, baseinputfi
-0001ace0: 6c65 2c20 6f76 6572 7269 6465 733d 6f76  le, overrides=ov
-0001acf0: 6572 7269 6465 732c 2066 756c 6c3d 5472  errides, full=Tr
-0001ad00: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
-0001ad10: 2020 2020 2020 2020 2020 2020 6261 7365              base
-0001ad20: 7072 6f66 696c 6520 3d20 6261 7365 696e  profile = basein
-0001ad30: 666f 5b30 5d5b 6261 7365 766d 5d20 6966  fo[0][basevm] if
-0001ad40: 2062 6173 6576 6d20 696e 2062 6173 6569   basevm in basei
-0001ad50: 6e66 6f5b 305d 2065 6c73 6520 7b7d 0a20  nfo[0] else {}. 
-0001ad60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ad70: 2020 2020 2020 2063 7572 7265 6e74 706c         currentpl
-0001ad80: 616e 6469 7220 3d20 6261 7365 696e 666f  andir = baseinfo
-0001ad90: 5b33 5d20 6966 206f 732e 7061 7468 2e69  [3] if os.path.i
-0001ada0: 7361 6273 2862 6173 6569 6e66 6f5b 335d  sabs(baseinfo[3]
-0001adb0: 2920 656c 7365 2027 2e27 0a20 2020 2020  ) else '.'.     
-0001adc0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0001add0: 6c69 6620 2762 6173 6576 6d27 2069 6e20  lif 'basevm' in 
-0001ade0: 7072 6f66 696c 6520 616e 6420 7072 6f66  profile and prof
-0001adf0: 696c 655b 2762 6173 6576 6d27 5d20 696e  ile['basevm'] in
-0001ae00: 2062 6173 6565 6e74 7269 6573 3a0a 2020   baseentries:.  
-0001ae10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ae20: 2020 2020 2020 6261 7365 7072 6f66 696c        baseprofil
-0001ae30: 6520 3d20 6261 7365 656e 7472 6965 735b  e = baseentries[
-0001ae40: 7072 6f66 696c 655b 2762 6173 6576 6d27  profile['basevm'
-0001ae50: 5d5d 0a20 2020 2020 2020 2020 2020 2020  ]].             
-0001ae60: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0001ae70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ae80: 2020 2020 2077 6172 6e69 6e67 2866 2249       warning(f"I
-0001ae90: 6e63 6f72 7265 6374 2062 6173 6520 656e  ncorrect base en
-0001aea0: 7472 7920 666f 7220 7b6e 616d 657d 2e20  try for {name}. 
-0001aeb0: 536b 6970 7069 6e67 2e2e 2e22 290a 2020  Skipping...").  
+0001aae0: 2020 2020 2020 6261 7365 766d 203d 2070        basevm = p
+0001aaf0: 726f 6669 6c65 5b27 6261 7365 766d 275d  rofile['basevm']
+0001ab00: 2069 6620 2762 6173 6576 6d27 2069 6e20   if 'basevm' in 
+0001ab10: 7072 6f66 696c 6520 656c 7365 206e 616d  profile else nam
+0001ab20: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+0001ab30: 2020 2020 2020 2020 2020 6966 2062 6173            if bas
+0001ab40: 6570 6c61 6e20 6e6f 7420 696e 2062 6173  eplan not in bas
+0001ab50: 6570 6c61 6e73 3a0a 2020 2020 2020 2020  eplans:.        
+0001ab60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ab70: 2020 2020 7365 6c66 2e70 6c61 6e28 706c      self.plan(pl
+0001ab80: 616e 2c20 696e 7075 7466 696c 653d 6261  an, inputfile=ba
+0001ab90: 7365 696e 7075 7466 696c 652c 206f 7665  seinputfile, ove
+0001aba0: 7272 6964 6573 3d6f 7665 7272 6964 6573  rrides=overrides
+0001abb0: 2c20 6578 636c 7564 6576 6d73 3d76 6d6e  , excludevms=vmn
+0001abc0: 616d 6573 2c0a 2020 2020 2020 2020 2020  ames,.          
+0001abd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001abe0: 2020 2020 2020 2020 2020 2020 6261 7365              base
+0001abf0: 6d6f 6465 3d54 7275 652c 206f 6e6c 7961  mode=True, onlya
+0001ac00: 7373 6574 733d 6f6e 6c79 6173 7365 7473  ssets=onlyassets
+0001ac10: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001ac20: 2020 2020 2020 2020 2020 2020 2020 6261                ba
+0001ac30: 7365 706c 616e 732e 6170 7065 6e64 2862  seplans.append(b
+0001ac40: 6173 6570 6c61 6e29 0a20 2020 2020 2020  aseplan).       
+0001ac50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ac60: 2062 6173 6569 6e66 6f20 3d20 7365 6c66   baseinfo = self
+0001ac70: 2e70 726f 6365 7373 5f69 6e70 7574 6669  .process_inputfi
+0001ac80: 6c65 2870 6c61 6e2c 2062 6173 6569 6e70  le(plan, baseinp
+0001ac90: 7574 6669 6c65 2c20 6f76 6572 7269 6465  utfile, override
+0001aca0: 733d 6f76 6572 7269 6465 732c 2066 756c  s=overrides, ful
+0001acb0: 6c3d 5472 7565 290a 2020 2020 2020 2020  l=True).        
+0001acc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001acd0: 6261 7365 7072 6f66 696c 6520 3d20 6261  baseprofile = ba
+0001ace0: 7365 696e 666f 5b30 5d5b 6261 7365 766d  seinfo[0][basevm
+0001acf0: 5d20 6966 2062 6173 6576 6d20 696e 2062  ] if basevm in b
+0001ad00: 6173 6569 6e66 6f5b 305d 2065 6c73 6520  aseinfo[0] else 
+0001ad10: 7b7d 0a20 2020 2020 2020 2020 2020 2020  {}.             
+0001ad20: 2020 2020 2020 2020 2020 2063 7572 7265             curre
+0001ad30: 6e74 706c 616e 6469 7220 3d20 6261 7365  ntplandir = base
+0001ad40: 696e 666f 5b33 5d20 6966 206f 732e 7061  info[3] if os.pa
+0001ad50: 7468 2e69 7361 6273 2862 6173 6569 6e66  th.isabs(baseinf
+0001ad60: 6f5b 335d 2920 656c 7365 2027 2e27 0a20  o[3]) else '.'. 
+0001ad70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ad80: 2020 2065 6c69 6620 2762 6173 6576 6d27     elif 'basevm'
+0001ad90: 2069 6e20 7072 6f66 696c 6520 616e 6420   in profile and 
+0001ada0: 7072 6f66 696c 655b 2762 6173 6576 6d27  profile['basevm'
+0001adb0: 5d20 696e 2062 6173 6565 6e74 7269 6573  ] in baseentries
+0001adc0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001add0: 2020 2020 2020 2020 2020 6261 7365 7072            basepr
+0001ade0: 6f66 696c 6520 3d20 6261 7365 656e 7472  ofile = baseentr
+0001adf0: 6965 735b 7072 6f66 696c 655b 2762 6173  ies[profile['bas
+0001ae00: 6576 6d27 5d5d 0a20 2020 2020 2020 2020  evm']].         
+0001ae10: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0001ae20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001ae30: 2020 2020 2020 2020 2077 6172 6e69 6e67           warning
+0001ae40: 2866 2249 6e63 6f72 7265 6374 2062 6173  (f"Incorrect bas
+0001ae50: 6520 656e 7472 7920 666f 7220 7b6e 616d  e entry for {nam
+0001ae60: 657d 2e20 536b 6970 7069 6e67 2e2e 2e22  e}. Skipping..."
+0001ae70: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001ae80: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
+0001ae90: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
+0001aea0: 2020 2020 2020 2066 6f72 206b 6579 2069         for key i
+0001aeb0: 6e20 6261 7365 7072 6f66 696c 653a 0a20  n baseprofile:. 
 0001aec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aed0: 2020 2020 2020 636f 6e74 696e 7565 0a20        continue. 
-0001aee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aef0: 2020 2066 6f72 206b 6579 2069 6e20 6261     for key in ba
-0001af00: 7365 7072 6f66 696c 653a 0a20 2020 2020  seprofile:.     
-0001af10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001af20: 2020 2069 6620 6b65 7920 6e6f 7420 696e     if key not in
-0001af30: 2070 726f 6669 6c65 3a0a 2020 2020 2020   profile:.      
-0001af40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001af50: 2020 2020 2020 7072 6f66 696c 655b 6b65        profile[ke
-0001af60: 795d 203d 2062 6173 6570 726f 6669 6c65  y] = baseprofile
-0001af70: 5b6b 6579 5d0a 2020 2020 2020 2020 2020  [key].          
-0001af80: 2020 2020 2020 2020 2020 2020 2020 656c                el
-0001af90: 6966 206b 6579 2069 6e20 6261 7365 7072  if key in basepr
-0001afa0: 6f66 696c 6520 616e 6420 6b65 7920 696e  ofile and key in
-0001afb0: 2070 726f 6669 6c65 2061 6e64 206b 6579   profile and key
-0001afc0: 2069 6e20 6170 7065 6e64 6b65 7973 3a0a   in appendkeys:.
-0001afd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001afe0: 2020 2020 2020 2020 2020 2020 7072 6f66              prof
-0001aff0: 696c 655b 6b65 795d 203d 2062 6173 6570  ile[key] = basep
-0001b000: 726f 6669 6c65 5b6b 6579 5d20 2b20 7072  rofile[key] + pr
-0001b010: 6f66 696c 655b 6b65 795d 0a20 2020 2020  ofile[key].     
-0001b020: 2020 2020 2020 2020 2020 2072 756c 6566             rulef
-0001b030: 6f75 6e64 203d 2046 616c 7365 0a20 2020  ound = False.   
-0001b040: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-0001b050: 2065 6e74 7279 2069 6e20 6f76 6572 7269   entry in overri
-0001b060: 6465 732e 6765 7428 2776 6d72 756c 6573  des.get('vmrules
-0001b070: 272c 2073 656c 662e 766d 7275 6c65 7329  ', self.vmrules)
-0001b080: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001b090: 2020 2020 2020 6966 206c 656e 2865 6e74        if len(ent
-0001b0a0: 7279 2920 213d 2031 3a0a 2020 2020 2020  ry) != 1:.      
-0001b0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b0c0: 2020 6572 726f 7228 6622 5772 6f6e 6720    error(f"Wrong 
-0001b0d0: 766d 2072 756c 6520 7b65 6e74 7279 7d22  vm rule {entry}"
-0001b0e0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001b0f0: 2020 2020 2020 2020 2020 7379 732e 6578            sys.ex
-0001b100: 6974 2831 290a 2020 2020 2020 2020 2020  it(1).          
-0001b110: 2020 2020 2020 2020 2020 7275 6c65 203d            rule =
-0001b120: 206c 6973 7428 656e 7472 792e 6b65 7973   list(entry.keys
-0001b130: 2829 295b 305d 0a20 2020 2020 2020 2020  ())[0].         
-0001b140: 2020 2020 2020 2020 2020 2069 6620 2872             if (r
-0001b150: 652e 6d61 7463 6828 7275 6c65 2c20 6e61  e.match(rule, na
-0001b160: 6d65 2920 6f72 2066 6e6d 6174 6368 286e  me) or fnmatch(n
-0001b170: 616d 652c 2072 756c 6529 2920 616e 6420  ame, rule)) and 
-0001b180: 6973 696e 7374 616e 6365 2865 6e74 7279  isinstance(entry
-0001b190: 5b72 756c 655d 2c20 6469 6374 293a 0a20  [rule], dict):. 
-0001b1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b1b0: 2020 2020 2020 2072 756c 6566 6f75 6e64         rulefound
-0001b1c0: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
-0001b1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b1e0: 6c69 7374 6b65 7973 203d 205b 2763 6d64  listkeys = ['cmd
-0001b1f0: 7327 2c20 2766 696c 6573 272c 2027 7363  s', 'files', 'sc
-0001b200: 7269 7074 7327 5d0a 2020 2020 2020 2020  ripts'].        
-0001b210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b220: 666f 7220 7275 6c65 2069 6e20 656e 7472  for rule in entr
-0001b230: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
-0001b240: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0001b250: 7572 7265 6e74 203d 2065 6e74 7279 5b72  urrent = entry[r
-0001b260: 756c 655d 0a20 2020 2020 2020 2020 2020  ule].           
-0001b270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b280: 2066 6f72 206b 6579 2069 6e20 6375 7272   for key in curr
-0001b290: 656e 743a 0a20 2020 2020 2020 2020 2020  ent:.           
-0001b2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b2b0: 2020 2020 2069 6620 6b65 7920 696e 206c       if key in l
-0001b2c0: 6973 746b 6579 7320 616e 6420 6973 696e  istkeys and isin
-0001b2d0: 7374 616e 6365 2863 7572 7265 6e74 5b6b  stance(current[k
-0001b2e0: 6579 5d2c 206c 6973 7429 2061 6e64 206b  ey], list) and k
-0001b2f0: 6579 2069 6e20 7072 6f66 696c 653a 0a20  ey in profile:. 
-0001b300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b320: 2020 2063 7572 7265 6e74 5b6b 6579 5d20     current[key] 
-0001b330: 3d20 7072 6f66 696c 655b 6b65 795d 202b  = profile[key] +
-0001b340: 2063 7572 7265 6e74 5b6b 6579 5d0a 2020   current[key].  
-0001b350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b360: 2020 2020 2020 2020 2020 7072 6f66 696c            profil
-0001b370: 652e 7570 6461 7465 2865 6e74 7279 5b72  e.update(entry[r
-0001b380: 756c 655d 290a 2020 2020 2020 2020 2020  ule]).          
-0001b390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b3a0: 2020 6966 2027 6e61 6d65 2720 696e 2065    if 'name' in e
-0001b3b0: 6e74 7279 5b72 756c 655d 3a0a 2020 2020  ntry[rule]:.    
-0001b3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b3d0: 2020 2020 2020 2020 2020 2020 7761 726e              warn
-0001b3e0: 696e 6728 6622 5265 6e61 6d69 6e67 207b  ing(f"Renaming {
-0001b3f0: 6e61 6d65 7d20 746f 207b 656e 7472 795b  name} to {entry[
-0001b400: 7275 6c65 5d5b 276e 616d 6527 5d7d 2229  rule]['name']}")
-0001b410: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b430: 206e 616d 6520 3d20 656e 7472 795b 7275   name = entry[ru
-0001b440: 6c65 5d5b 276e 616d 6527 5d0a 2020 2020  le]['name'].    
-0001b450: 2020 2020 2020 2020 2020 2020 6966 2076              if v
-0001b460: 6d72 756c 6573 5f73 7472 6963 7420 616e  mrules_strict an
-0001b470: 6420 6e6f 7420 7275 6c65 666f 756e 643a  d not rulefound:
-0001b480: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b490: 2020 2020 2077 6172 6e69 6e67 2866 224e       warning(f"N
-0001b4a0: 6f20 766d 7275 6c65 7320 666f 756e 6420  o vmrules found 
-0001b4b0: 666f 7220 7b6e 616d 657d 2e20 536b 6970  for {name}. Skip
-0001b4c0: 7069 6e67 2e2e 2e22 290a 2020 2020 2020  ping...").      
-0001b4d0: 2020 2020 2020 2020 2020 2020 2020 636f                co
-0001b4e0: 6e74 696e 7565 0a20 2020 2020 2020 2020  ntinue.         
-0001b4f0: 2020 2020 2020 2076 6d63 6c69 656e 7420         vmclient 
-0001b500: 3d20 7072 6f66 696c 652e 6765 7428 2763  = profile.get('c
-0001b510: 6c69 656e 7427 290a 2020 2020 2020 2020  lient').        
-0001b520: 2020 2020 2020 2020 6966 2076 6d63 6c69          if vmcli
-0001b530: 656e 7420 6973 206e 6f74 204e 6f6e 6520  ent is not None 
-0001b540: 616e 6420 766d 636c 6965 6e74 206e 6f74  and vmclient not
-0001b550: 2069 6e20 766d 636c 6965 6e74 733a 0a20   in vmclients:. 
-0001b560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b570: 2020 2076 6d63 6c69 656e 7473 2e61 7070     vmclients.app
-0001b580: 656e 6428 766d 636c 6965 6e74 290a 2020  end(vmclient).  
-0001b590: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0001b5a0: 2076 6d63 6c69 656e 7420 6973 204e 6f6e   vmclient is Non
-0001b5b0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0001b5c0: 2020 2020 2020 207a 203d 206b 0a20 2020         z = k.   
-0001b5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b5e0: 2076 6d63 6c69 656e 7420 3d20 7365 6c66   vmclient = self
-0001b5f0: 2e63 6c69 656e 740a 2020 2020 2020 2020  .client.        
-0001b600: 2020 2020 2020 2020 2020 2020 6966 2076              if v
-0001b610: 6d63 6c69 656e 7420 6e6f 7420 696e 2068  mclient not in h
-0001b620: 6f73 7473 3a0a 2020 2020 2020 2020 2020  osts:.          
-0001b630: 2020 2020 2020 2020 2020 2020 2020 686f                ho
-0001b640: 7374 735b 766d 636c 6965 6e74 5d20 3d20  sts[vmclient] = 
-0001b650: 7365 6c66 0a20 2020 2020 2020 2020 2020  self.           
-0001b660: 2020 2020 2065 6c69 6620 766d 636c 6965       elif vmclie
-0001b670: 6e74 2069 6e20 686f 7374 733a 0a20 2020  nt in hosts:.   
-0001b680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b690: 207a 203d 2068 6f73 7473 5b76 6d63 6c69   z = hosts[vmcli
-0001b6a0: 656e 745d 2e6b 0a20 2020 2020 2020 2020  ent].k.         
-0001b6b0: 2020 2020 2020 2065 6c69 6620 766d 636c         elif vmcl
-0001b6c0: 6965 6e74 2069 6e20 7365 6c66 2e63 6c69  ient in self.cli
-0001b6d0: 656e 7473 3a0a 2020 2020 2020 2020 2020  ents:.          
-0001b6e0: 2020 2020 2020 2020 2020 6e65 7763 6c69            newcli
-0001b6f0: 656e 7420 3d20 4b63 6f6e 6669 6728 636c  ent = Kconfig(cl
-0001b700: 6965 6e74 3d76 6d63 6c69 656e 7429 0a20  ient=vmclient). 
-0001b710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b720: 2020 207a 203d 206e 6577 636c 6965 6e74     z = newclient
-0001b730: 2e6b 0a20 2020 2020 2020 2020 2020 2020  .k.             
-0001b740: 2020 2020 2020 2068 6f73 7473 5b76 6d63         hosts[vmc
-0001b750: 6c69 656e 745d 203d 206e 6577 636c 6965  lient] = newclie
-0001b760: 6e74 0a20 2020 2020 2020 2020 2020 2020  nt.             
-0001b770: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0001b780: 2020 2020 2020 2020 2020 2020 2077 6172               war
-0001b790: 6e69 6e67 2866 2243 6c69 656e 7420 7b76  ning(f"Client {v
-0001b7a0: 6d63 6c69 656e 747d 206e 6f74 2066 6f75  mclient} not fou
-0001b7b0: 6e64 2e20 5573 696e 6720 6465 6661 756c  nd. Using defaul
-0001b7c0: 7420 6f6e 6522 290a 2020 2020 2020 2020  t one").        
-0001b7d0: 2020 2020 2020 2020 2020 2020 7a20 3d20              z = 
-0001b7e0: 6b0a 2020 2020 2020 2020 2020 2020 2020  k.              
-0001b7f0: 2020 2020 2020 766d 636c 6965 6e74 203d        vmclient =
-0001b800: 2073 656c 662e 636c 6965 6e74 0a20 2020   self.client.   
-0001b810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b820: 2069 6620 766d 636c 6965 6e74 206e 6f74   if vmclient not
-0001b830: 2069 6e20 686f 7374 733a 0a20 2020 2020   in hosts:.     
-0001b840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b850: 2020 2068 6f73 7473 5b76 6d63 6c69 656e     hosts[vmclien
-0001b860: 745d 203d 2073 656c 660a 2020 2020 2020  t] = self.      
-0001b870: 2020 2020 2020 2020 2020 766d 735f 746f            vms_to
-0001b880: 5f68 6f73 745b 6e61 6d65 5d20 3d20 686f  _host[name] = ho
-0001b890: 7374 735b 766d 636c 6965 6e74 5d0a 2020  sts[vmclient].  
-0001b8a0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0001b8b0: 2027 7072 6f66 696c 6527 2069 6e20 7072   'profile' in pr
-0001b8c0: 6f66 696c 6520 616e 6420 7072 6f66 696c  ofile and profil
-0001b8d0: 655b 2770 726f 6669 6c65 275d 2069 6e20  e['profile'] in 
-0001b8e0: 766d 7072 6f66 696c 6573 3a0a 2020 2020  vmprofiles:.    
-0001b8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b900: 6375 7374 6f6d 7072 6f66 696c 6520 3d20  customprofile = 
-0001b910: 766d 7072 6f66 696c 6573 5b70 726f 6669  vmprofiles[profi
-0001b920: 6c65 5b27 7072 6f66 696c 6527 5d5d 0a20  le['profile']]. 
+0001aed0: 2020 2020 2020 2069 6620 6b65 7920 6e6f         if key no
+0001aee0: 7420 696e 2070 726f 6669 6c65 3a0a 2020  t in profile:.  
+0001aef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001af00: 2020 2020 2020 2020 2020 7072 6f66 696c            profil
+0001af10: 655b 6b65 795d 203d 2062 6173 6570 726f  e[key] = basepro
+0001af20: 6669 6c65 5b6b 6579 5d0a 2020 2020 2020  file[key].      
+0001af30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001af40: 2020 656c 6966 206b 6579 2069 6e20 6261    elif key in ba
+0001af50: 7365 7072 6f66 696c 6520 616e 6420 6b65  seprofile and ke
+0001af60: 7920 696e 2070 726f 6669 6c65 2061 6e64  y in profile and
+0001af70: 206b 6579 2069 6e20 6170 7065 6e64 6b65   key in appendke
+0001af80: 7973 3a0a 2020 2020 2020 2020 2020 2020  ys:.            
+0001af90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001afa0: 7072 6f66 696c 655b 6b65 795d 203d 2062  profile[key] = b
+0001afb0: 6173 6570 726f 6669 6c65 5b6b 6579 5d20  aseprofile[key] 
+0001afc0: 2b20 7072 6f66 696c 655b 6b65 795d 0a20  + profile[key]. 
+0001afd0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0001afe0: 756c 6566 6f75 6e64 203d 2046 616c 7365  ulefound = False
+0001aff0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b000: 2066 6f72 2065 6e74 7279 2069 6e20 6f76   for entry in ov
+0001b010: 6572 7269 6465 732e 6765 7428 2776 6d72  errides.get('vmr
+0001b020: 756c 6573 272c 2073 656c 662e 766d 7275  ules', self.vmru
+0001b030: 6c65 7329 3a0a 2020 2020 2020 2020 2020  les):.          
+0001b040: 2020 2020 2020 2020 2020 6966 206c 656e            if len
+0001b050: 2865 6e74 7279 2920 213d 2031 3a0a 2020  (entry) != 1:.  
+0001b060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b070: 2020 2020 2020 6572 726f 7228 6622 5772        error(f"Wr
+0001b080: 6f6e 6720 766d 2072 756c 6520 7b65 6e74  ong vm rule {ent
+0001b090: 7279 7d22 290a 2020 2020 2020 2020 2020  ry}").          
+0001b0a0: 2020 2020 2020 2020 2020 2020 2020 7379                sy
+0001b0b0: 732e 6578 6974 2831 290a 2020 2020 2020  s.exit(1).      
+0001b0c0: 2020 2020 2020 2020 2020 2020 2020 7275                ru
+0001b0d0: 6c65 203d 206c 6973 7428 656e 7472 792e  le = list(entry.
+0001b0e0: 6b65 7973 2829 295b 305d 0a20 2020 2020  keys())[0].     
+0001b0f0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0001b100: 6620 2872 652e 6d61 7463 6828 7275 6c65  f (re.match(rule
+0001b110: 2c20 6e61 6d65 2920 6f72 2066 6e6d 6174  , name) or fnmat
+0001b120: 6368 286e 616d 652c 2072 756c 6529 2920  ch(name, rule)) 
+0001b130: 616e 6420 6973 696e 7374 616e 6365 2865  and isinstance(e
+0001b140: 6e74 7279 5b72 756c 655d 2c20 6469 6374  ntry[rule], dict
+0001b150: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0001b160: 2020 2020 2020 2020 2020 2072 756c 6566             rulef
+0001b170: 6f75 6e64 203d 2054 7275 650a 2020 2020  ound = True.    
+0001b180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b190: 2020 2020 6c69 7374 6b65 7973 203d 205b      listkeys = [
+0001b1a0: 2763 6d64 7327 2c20 2766 696c 6573 272c  'cmds', 'files',
+0001b1b0: 2027 7363 7269 7074 7327 5d0a 2020 2020   'scripts'].    
+0001b1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b1d0: 2020 2020 666f 7220 7275 6c65 2069 6e20      for rule in 
+0001b1e0: 656e 7472 793a 0a20 2020 2020 2020 2020  entry:.         
+0001b1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b200: 2020 2063 7572 7265 6e74 203d 2065 6e74     current = ent
+0001b210: 7279 5b72 756c 655d 0a20 2020 2020 2020  ry[rule].       
+0001b220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b230: 2020 2020 2066 6f72 206b 6579 2069 6e20       for key in 
+0001b240: 6375 7272 656e 743a 0a20 2020 2020 2020  current:.       
+0001b250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b260: 2020 2020 2020 2020 2069 6620 6b65 7920           if key 
+0001b270: 696e 206c 6973 746b 6579 7320 616e 6420  in listkeys and 
+0001b280: 6973 696e 7374 616e 6365 2863 7572 7265  isinstance(curre
+0001b290: 6e74 5b6b 6579 5d2c 206c 6973 7429 2061  nt[key], list) a
+0001b2a0: 6e64 206b 6579 2069 6e20 7072 6f66 696c  nd key in profil
+0001b2b0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0001b2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b2d0: 2020 2020 2020 2063 7572 7265 6e74 5b6b         current[k
+0001b2e0: 6579 5d20 3d20 7072 6f66 696c 655b 6b65  ey] = profile[ke
+0001b2f0: 795d 202b 2063 7572 7265 6e74 5b6b 6579  y] + current[key
+0001b300: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+0001b310: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+0001b320: 6f66 696c 652e 7570 6461 7465 2865 6e74  ofile.update(ent
+0001b330: 7279 5b72 756c 655d 290a 2020 2020 2020  ry[rule]).      
+0001b340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b350: 2020 2020 2020 6966 2027 6e61 6d65 2720        if 'name' 
+0001b360: 696e 2065 6e74 7279 5b72 756c 655d 3a0a  in entry[rule]:.
+0001b370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b390: 7761 726e 696e 6728 6622 5265 6e61 6d69  warning(f"Renami
+0001b3a0: 6e67 207b 6e61 6d65 7d20 746f 207b 656e  ng {name} to {en
+0001b3b0: 7472 795b 7275 6c65 5d5b 276e 616d 6527  try[rule]['name'
+0001b3c0: 5d7d 2229 0a20 2020 2020 2020 2020 2020  ]}").           
+0001b3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b3e0: 2020 2020 206e 616d 6520 3d20 656e 7472       name = entr
+0001b3f0: 795b 7275 6c65 5d5b 276e 616d 6527 5d0a  y[rule]['name'].
+0001b400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b410: 6966 2076 6d72 756c 6573 5f73 7472 6963  if vmrules_stric
+0001b420: 7420 616e 6420 6e6f 7420 7275 6c65 666f  t and not rulefo
+0001b430: 756e 643a 0a20 2020 2020 2020 2020 2020  und:.           
+0001b440: 2020 2020 2020 2020 2077 6172 6e69 6e67           warning
+0001b450: 2866 224e 6f20 766d 7275 6c65 7320 666f  (f"No vmrules fo
+0001b460: 756e 6420 666f 7220 7b6e 616d 657d 2e20  und for {name}. 
+0001b470: 536b 6970 7069 6e67 2e2e 2e22 290a 2020  Skipping...").  
+0001b480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b490: 2020 636f 6e74 696e 7565 0a20 2020 2020    continue.     
+0001b4a0: 2020 2020 2020 2020 2020 2076 6d63 6c69             vmcli
+0001b4b0: 656e 7420 3d20 7072 6f66 696c 652e 6765  ent = profile.ge
+0001b4c0: 7428 2763 6c69 656e 7427 290a 2020 2020  t('client').    
+0001b4d0: 2020 2020 2020 2020 2020 2020 6966 2076              if v
+0001b4e0: 6d63 6c69 656e 7420 6973 206e 6f74 204e  mclient is not N
+0001b4f0: 6f6e 6520 616e 6420 766d 636c 6965 6e74  one and vmclient
+0001b500: 206e 6f74 2069 6e20 766d 636c 6965 6e74   not in vmclient
+0001b510: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+0001b520: 2020 2020 2020 2076 6d63 6c69 656e 7473         vmclients
+0001b530: 2e61 7070 656e 6428 766d 636c 6965 6e74  .append(vmclient
+0001b540: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001b550: 2020 6966 2076 6d63 6c69 656e 7420 6973    if vmclient is
+0001b560: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+0001b570: 2020 2020 2020 2020 2020 207a 203d 206b             z = k
+0001b580: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b590: 2020 2020 2076 6d63 6c69 656e 7420 3d20       vmclient = 
+0001b5a0: 7365 6c66 2e63 6c69 656e 740a 2020 2020  self.client.    
+0001b5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b5c0: 6966 2076 6d63 6c69 656e 7420 6e6f 7420  if vmclient not 
+0001b5d0: 696e 2068 6f73 7473 3a0a 2020 2020 2020  in hosts:.      
+0001b5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b5f0: 2020 686f 7374 735b 766d 636c 6965 6e74    hosts[vmclient
+0001b600: 5d20 3d20 7365 6c66 0a20 2020 2020 2020  ] = self.       
+0001b610: 2020 2020 2020 2020 2065 6c69 6620 766d           elif vm
+0001b620: 636c 6965 6e74 2069 6e20 686f 7374 733a  client in hosts:
+0001b630: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b640: 2020 2020 207a 203d 2068 6f73 7473 5b76       z = hosts[v
+0001b650: 6d63 6c69 656e 745d 2e6b 0a20 2020 2020  mclient].k.     
+0001b660: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+0001b670: 766d 636c 6965 6e74 2069 6e20 7365 6c66  vmclient in self
+0001b680: 2e63 6c69 656e 7473 3a0a 2020 2020 2020  .clients:.      
+0001b690: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
+0001b6a0: 7763 6c69 656e 7420 3d20 4b63 6f6e 6669  wclient = Kconfi
+0001b6b0: 6728 636c 6965 6e74 3d76 6d63 6c69 656e  g(client=vmclien
+0001b6c0: 7429 0a20 2020 2020 2020 2020 2020 2020  t).             
+0001b6d0: 2020 2020 2020 207a 203d 206e 6577 636c         z = newcl
+0001b6e0: 6965 6e74 2e6b 0a20 2020 2020 2020 2020  ient.k.         
+0001b6f0: 2020 2020 2020 2020 2020 2068 6f73 7473             hosts
+0001b700: 5b76 6d63 6c69 656e 745d 203d 206e 6577  [vmclient] = new
+0001b710: 636c 6965 6e74 0a20 2020 2020 2020 2020  client.         
+0001b720: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0001b730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b740: 2077 6172 6e69 6e67 2866 2243 6c69 656e   warning(f"Clien
+0001b750: 7420 7b76 6d63 6c69 656e 747d 206e 6f74  t {vmclient} not
+0001b760: 2066 6f75 6e64 2e20 5573 696e 6720 6465   found. Using de
+0001b770: 6661 756c 7420 6f6e 6522 290a 2020 2020  fault one").    
+0001b780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b790: 7a20 3d20 6b0a 2020 2020 2020 2020 2020  z = k.          
+0001b7a0: 2020 2020 2020 2020 2020 766d 636c 6965            vmclie
+0001b7b0: 6e74 203d 2073 656c 662e 636c 6965 6e74  nt = self.client
+0001b7c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b7d0: 2020 2020 2069 6620 766d 636c 6965 6e74       if vmclient
+0001b7e0: 206e 6f74 2069 6e20 686f 7374 733a 0a20   not in hosts:. 
+0001b7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b800: 2020 2020 2020 2068 6f73 7473 5b76 6d63         hosts[vmc
+0001b810: 6c69 656e 745d 203d 2073 656c 660a 2020  lient] = self.  
+0001b820: 2020 2020 2020 2020 2020 2020 2020 766d                vm
+0001b830: 735f 746f 5f68 6f73 745b 6e61 6d65 5d20  s_to_host[name] 
+0001b840: 3d20 686f 7374 735b 766d 636c 6965 6e74  = hosts[vmclient
+0001b850: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+0001b860: 2020 6966 2027 7072 6f66 696c 6527 2069    if 'profile' i
+0001b870: 6e20 7072 6f66 696c 6520 616e 6420 7072  n profile and pr
+0001b880: 6f66 696c 655b 2770 726f 6669 6c65 275d  ofile['profile']
+0001b890: 2069 6e20 766d 7072 6f66 696c 6573 3a0a   in vmprofiles:.
+0001b8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b8b0: 2020 2020 6375 7374 6f6d 7072 6f66 696c      customprofil
+0001b8c0: 6520 3d20 766d 7072 6f66 696c 6573 5b70  e = vmprofiles[p
+0001b8d0: 726f 6669 6c65 5b27 7072 6f66 696c 6527  rofile['profile'
+0001b8e0: 5d5d 0a20 2020 2020 2020 2020 2020 2020  ]].             
+0001b8f0: 2020 2020 2020 2070 726f 6669 6c65 6e61         profilena
+0001b900: 6d65 203d 2070 726f 6669 6c65 5b27 7072  me = profile['pr
+0001b910: 6f66 696c 6527 5d0a 2020 2020 2020 2020  ofile'].        
+0001b920: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
 0001b930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b940: 2020 2070 726f 6669 6c65 6e61 6d65 203d     profilename =
-0001b950: 2070 726f 6669 6c65 5b27 7072 6f66 696c   profile['profil
-0001b960: 6527 5d0a 2020 2020 2020 2020 2020 2020  e'].            
-0001b970: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0001b980: 2020 2020 2020 2020 2020 2020 2020 6375                cu
-0001b990: 7374 6f6d 7072 6f66 696c 6520 3d20 7b7d  stomprofile = {}
+0001b940: 2020 6375 7374 6f6d 7072 6f66 696c 6520    customprofile 
+0001b950: 3d20 7b7d 0a20 2020 2020 2020 2020 2020  = {}.           
+0001b960: 2020 2020 2020 2020 2070 726f 6669 6c65           profile
+0001b970: 6e61 6d65 203d 2027 6b76 6972 7427 0a20  name = 'kvirt'. 
+0001b980: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0001b990: 6620 6375 7374 6f6d 7072 6f66 696c 653a  f customprofile:
 0001b9a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b9b0: 2020 2020 2070 726f 6669 6c65 6e61 6d65       profilename
-0001b9c0: 203d 2027 6b76 6972 7427 0a20 2020 2020   = 'kvirt'.     
-0001b9d0: 2020 2020 2020 2020 2020 2069 6620 6375             if cu
-0001b9e0: 7374 6f6d 7072 6f66 696c 653a 0a20 2020  stomprofile:.   
-0001b9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ba00: 2063 7573 746f 6d70 726f 6669 6c65 2e75   customprofile.u
-0001ba10: 7064 6174 6528 7072 6f66 696c 6529 0a20  pdate(profile). 
-0001ba20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ba30: 2020 2070 726f 6669 6c65 203d 2063 7573     profile = cus
-0001ba40: 746f 6d70 726f 6669 6c65 0a20 2020 2020  tomprofile.     
-0001ba50: 2020 2020 2020 2020 2020 2069 6620 2770             if 'p
-0001ba60: 6c61 7962 6f6f 6b27 2069 6e20 7072 6f66  laybook' in prof
-0001ba70: 696c 6520 616e 6420 7072 6f66 696c 655b  ile and profile[
-0001ba80: 2770 6c61 7962 6f6f 6b27 5d3a 0a20 2020  'playbook']:.   
-0001ba90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001baa0: 2069 6620 2773 6372 6970 7473 2720 6e6f   if 'scripts' no
-0001bab0: 7420 696e 2070 726f 6669 6c65 2061 6e64  t in profile and
-0001bac0: 2027 6669 6c65 7327 206e 6f74 2069 6e20   'files' not in 
-0001bad0: 7072 6f66 696c 6520 616e 6420 2763 6d64  profile and 'cmd
-0001bae0: 7327 206e 6f74 2069 6e20 7072 6f66 696c  s' not in profil
-0001baf0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0001bb00: 2020 2020 2020 2020 2020 2070 7072 696e             pprin
-0001bb10: 7428 6622 536b 6970 7069 6e67 2065 6d70  t(f"Skipping emp
-0001bb20: 7479 2070 6c61 7962 6f6f 6b20 666f 7220  ty playbook for 
-0001bb30: 7b6e 616d 657d 2229 0a20 2020 2020 2020  {name}").       
-0001bb40: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-0001bb50: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0001bb60: 2020 2020 2020 2020 2020 2069 6620 2769             if 'i
-0001bb70: 6d61 6765 2720 696e 2070 726f 6669 6c65  mage' in profile
-0001bb80: 2061 6e64 2027 7268 656c 2720 696e 2070   and 'rhel' in p
-0001bb90: 726f 6669 6c65 5b27 696d 6167 6527 5d5c  rofile['image']\
-0001bba0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b9b0: 2020 2020 2063 7573 746f 6d70 726f 6669       customprofi
+0001b9c0: 6c65 2e75 7064 6174 6528 7072 6f66 696c  le.update(profil
+0001b9d0: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
+0001b9e0: 2020 2020 2020 2070 726f 6669 6c65 203d         profile =
+0001b9f0: 2063 7573 746f 6d70 726f 6669 6c65 0a20   customprofile. 
+0001ba00: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0001ba10: 6620 2770 6c61 7962 6f6f 6b27 2069 6e20  f 'playbook' in 
+0001ba20: 7072 6f66 696c 6520 616e 6420 7072 6f66  profile and prof
+0001ba30: 696c 655b 2770 6c61 7962 6f6f 6b27 5d3a  ile['playbook']:
+0001ba40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001ba50: 2020 2020 2069 6620 2773 6372 6970 7473       if 'scripts
+0001ba60: 2720 6e6f 7420 696e 2070 726f 6669 6c65  ' not in profile
+0001ba70: 2061 6e64 2027 6669 6c65 7327 206e 6f74   and 'files' not
+0001ba80: 2069 6e20 7072 6f66 696c 6520 616e 6420   in profile and 
+0001ba90: 2763 6d64 7327 206e 6f74 2069 6e20 7072  'cmds' not in pr
+0001baa0: 6f66 696c 653a 0a20 2020 2020 2020 2020  ofile:.         
+0001bab0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0001bac0: 7072 696e 7428 6622 536b 6970 7069 6e67  print(f"Skipping
+0001bad0: 2065 6d70 7479 2070 6c61 7962 6f6f 6b20   empty playbook 
+0001bae0: 666f 7220 7b6e 616d 657d 2229 0a20 2020  for {name}").   
+0001baf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bb00: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0001bb10: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0001bb20: 6620 2769 6d61 6765 2720 696e 2070 726f  f 'image' in pro
+0001bb30: 6669 6c65 2061 6e64 2027 7268 656c 2720  file and 'rhel' 
+0001bb40: 696e 2070 726f 6669 6c65 5b27 696d 6167  in profile['imag
+0001bb50: 6527 5d5c 0a20 2020 2020 2020 2020 2020  e']\.           
+0001bb60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bb70: 2020 2020 2061 6e64 2027 7268 6e72 6567       and 'rhnreg
+0001bb80: 6973 7465 7227 2069 6e20 7072 6f66 696c  ister' in profil
+0001bb90: 6520 616e 6420 7072 6f66 696c 655b 2772  e and profile['r
+0001bba0: 686e 7265 6769 7374 6572 275d 3a0a 2020  hnregister']:.  
 0001bbb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bbc0: 2061 6e64 2027 7268 6e72 6567 6973 7465   and 'rhnregiste
-0001bbd0: 7227 2069 6e20 7072 6f66 696c 6520 616e  r' in profile an
-0001bbe0: 6420 7072 6f66 696c 655b 2772 686e 7265  d profile['rhnre
-0001bbf0: 6769 7374 6572 275d 3a0a 2020 2020 2020  gister']:.      
-0001bc00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bc10: 2020 2020 2020 7761 726e 696e 6728 6622        warning(f"
-0001bc20: 4d61 6b65 2073 7572 6520 746f 2073 7562  Make sure to sub
-0001bc30: 7363 7269 6265 207b 6e61 6d65 7d20 746f  scribe {name} to
-0001bc40: 2052 6564 2048 6174 206e 6574 776f 726b   Red Hat network
-0001bc50: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-0001bc60: 2020 2020 2020 2020 2020 2069 6620 2770             if 'p
-0001bc70: 7269 7661 7465 6b65 7927 2069 6e20 7072  rivatekey' in pr
-0001bc80: 6f66 696c 6520 616e 6420 7072 6f66 696c  ofile and profil
-0001bc90: 655b 2770 7269 7661 7465 6b65 7927 5d3a  e['privatekey']:
-0001bca0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001bcb0: 2020 2020 2020 2020 2020 2020 2077 6172               war
-0001bcc0: 6e69 6e67 2866 2243 6f70 7920 796f 7572  ning(f"Copy your
-0001bcd0: 2070 7269 7661 7465 206b 6579 2074 6f20   private key to 
-0001bce0: 7b6e 616d 657d 2229 0a20 2020 2020 2020  {name}").       
-0001bcf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bd00: 2066 6f72 206e 6574 2069 6e20 7072 6f66   for net in prof
-0001bd10: 696c 652e 6765 7428 276e 6574 7327 2c20  ile.get('nets', 
-0001bd20: 5b5d 293a 0a20 2020 2020 2020 2020 2020  []):.           
+0001bbc0: 2020 2020 2020 2020 2020 7761 726e 696e            warnin
+0001bbd0: 6728 6622 4d61 6b65 2073 7572 6520 746f  g(f"Make sure to
+0001bbe0: 2073 7562 7363 7269 6265 207b 6e61 6d65   subscribe {name
+0001bbf0: 7d20 746f 2052 6564 2048 6174 206e 6574  } to Red Hat net
+0001bc00: 776f 726b 2229 0a20 2020 2020 2020 2020  work").         
+0001bc10: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0001bc20: 6620 2770 7269 7661 7465 6b65 7927 2069  f 'privatekey' i
+0001bc30: 6e20 7072 6f66 696c 6520 616e 6420 7072  n profile and pr
+0001bc40: 6f66 696c 655b 2770 7269 7661 7465 6b65  ofile['privateke
+0001bc50: 7927 5d3a 0a20 2020 2020 2020 2020 2020  y']:.           
+0001bc60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bc70: 2077 6172 6e69 6e67 2866 2243 6f70 7920   warning(f"Copy 
+0001bc80: 796f 7572 2070 7269 7661 7465 206b 6579  your private key
+0001bc90: 2074 6f20 7b6e 616d 657d 2229 0a20 2020   to {name}").   
+0001bca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bcb0: 2020 2020 2066 6f72 206e 6574 2069 6e20       for net in 
+0001bcc0: 7072 6f66 696c 652e 6765 7428 276e 6574  profile.get('net
+0001bcd0: 7327 2c20 5b5d 293a 0a20 2020 2020 2020  s', []):.       
+0001bce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bcf0: 2020 2020 2069 6620 2769 7027 2069 6e20       if 'ip' in 
+0001bd00: 6e65 7420 616e 6420 276d 6173 6b27 2069  net and 'mask' i
+0001bd10: 6e20 6e65 7420 616e 6420 2767 6174 6577  n net and 'gatew
+0001bd20: 6179 2720 696e 206e 6574 3a0a 2020 2020  ay' in net:.    
 0001bd30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bd40: 2069 6620 2769 7027 2069 6e20 6e65 7420   if 'ip' in net 
-0001bd50: 616e 6420 276d 6173 6b27 2069 6e20 6e65  and 'mask' in ne
-0001bd60: 7420 616e 6420 2767 6174 6577 6179 2720  t and 'gateway' 
-0001bd70: 696e 206e 6574 3a0a 2020 2020 2020 2020  in net:.        
-0001bd80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bd90: 2020 2020 2020 2020 6970 2c20 6d61 736b          ip, mask
-0001bda0: 2c20 6761 7465 7761 7920 3d20 6e65 745b  , gateway = net[
-0001bdb0: 2769 7027 5d2c 206e 6574 5b27 6d61 736b  'ip'], net['mask
-0001bdc0: 275d 2c20 6e65 745b 2767 6174 6577 6179  '], net['gateway
-0001bdd0: 275d 0a20 2020 2020 2020 2020 2020 2020  '].             
-0001bde0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bdf0: 2020 2077 6172 6e69 6e67 2866 2241 6464     warning(f"Add
-0001be00: 206d 616e 7561 6c6c 7920 7468 6973 206e   manually this n
-0001be10: 6574 776f 726b 207b 6970 7d2f 7b6d 6173  etwork {ip}/{mas
-0001be20: 6b7d 2077 6974 6820 6761 7465 7761 7920  k} with gateway 
-0001be30: 7b67 6174 6577 6179 7d22 290a 2020 2020  {gateway}").    
-0001be40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001be50: 2020 2020 2020 2020 6966 2027 7669 7073          if 'vips
-0001be60: 2720 696e 206e 6574 3a0a 2020 2020 2020  ' in net:.      
-0001be70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001be80: 2020 2020 2020 2020 2020 7669 7073 203d            vips =
-0001be90: 2027 2c27 2e6a 6f69 6e28 6e65 745b 2776   ','.join(net['v
-0001bea0: 6970 7327 5d29 0a20 2020 2020 2020 2020  ips']).         
-0001beb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bec0: 2020 2020 2020 2077 6172 6e69 6e67 2866         warning(f
-0001bed0: 2241 6464 206d 616e 7561 6c6c 7920 7669  "Add manually vi
-0001bee0: 7073 207b 7669 7073 7d22 290a 2020 2020  ps {vips}").    
-0001bef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bf00: 2020 2020 7070 7269 6e74 2822 4d61 6b65      pprint("Make
-0001bf10: 2073 7572 6520 746f 2065 7870 6f72 7420   sure to export 
-0001bf20: 414e 5349 424c 455f 4a49 4e4a 4132 5f45  ANSIBLE_JINJA2_E
-0001bf30: 5854 454e 5349 4f4e 533d 6a69 6e6a 6132  XTENSIONS=jinja2
-0001bf40: 2e65 7874 2e64 6f22 290a 2020 2020 2020  .ext.do").      
-0001bf50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bf60: 2020 7365 6c66 2e63 7265 6174 655f 766d    self.create_vm
-0001bf70: 5f70 6c61 7962 6f6f 6b28 6e61 6d65 2c20  _playbook(name, 
-0001bf80: 7072 6f66 696c 652c 206f 7665 7272 6964  profile, overrid
-0001bf90: 6573 3d6f 7665 7272 6964 6573 2c20 7374  es=overrides, st
-0001bfa0: 6f72 653d 5472 7565 290a 2020 2020 2020  ore=True).      
-0001bfb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bfc0: 2020 636f 6e74 696e 7565 0a20 2020 2020    continue.     
-0001bfd0: 2020 2020 2020 2020 2020 2069 6620 7a2e             if z.
-0001bfe0: 6578 6973 7473 286e 616d 6529 2061 6e64  exists(name) and
-0001bff0: 206e 6f74 206f 6e6c 7961 7373 6574 733a   not onlyassets:
-0001c000: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001c010: 2020 2020 2069 6620 6e6f 7420 7570 6461       if not upda
-0001c020: 7465 3a0a 2020 2020 2020 2020 2020 2020  te:.            
-0001c030: 2020 2020 2020 2020 2020 2020 7070 7269              ppri
-0001c040: 6e74 2866 227b 6e61 6d65 7dc2 a073 6b69  nt(f"{name}..ski
-0001c050: 7070 6564 206f 6e20 7b76 6d63 6c69 656e  pped on {vmclien
-0001c060: 747d 2122 290a 2020 2020 2020 2020 2020  t}!").          
-0001c070: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-0001c080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c090: 2020 2020 2020 2020 7570 6461 7465 6420          updated 
-0001c0a0: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
-0001c0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c0c0: 6375 7272 656e 7476 6d20 3d20 7a2e 696e  currentvm = z.in
-0001c0d0: 666f 286e 616d 6529 0a20 2020 2020 2020  fo(name).       
-0001c0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c0f0: 2063 7572 7265 6e74 7374 6172 7420 3d20   currentstart = 
-0001c100: 6375 7272 656e 7476 6d2e 6765 7428 2761  currentvm.get('a
-0001c110: 7574 6f73 7461 7274 272c 2046 616c 7365  utostart', False
-0001c120: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001c130: 2020 2020 2020 2020 2020 6375 7272 656e            curren
-0001c140: 746d 656d 6f72 7920 3d20 6375 7272 656e  tmemory = curren
-0001c150: 7476 6d5b 276d 656d 6f72 7927 5d0a 2020  tvm['memory'].  
-0001c160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c170: 2020 2020 2020 6375 7272 656e 7469 6d61        currentima
-0001c180: 6765 203d 2063 7572 7265 6e74 766d 2e67  ge = currentvm.g
-0001c190: 6574 2827 7465 6d70 6c61 7465 2729 0a20  et('template'). 
+0001bd40: 2020 2020 2020 2020 2020 2020 6970 2c20              ip, 
+0001bd50: 6d61 736b 2c20 6761 7465 7761 7920 3d20  mask, gateway = 
+0001bd60: 6e65 745b 2769 7027 5d2c 206e 6574 5b27  net['ip'], net['
+0001bd70: 6d61 736b 275d 2c20 6e65 745b 2767 6174  mask'], net['gat
+0001bd80: 6577 6179 275d 0a20 2020 2020 2020 2020  eway'].         
+0001bd90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bda0: 2020 2020 2020 2077 6172 6e69 6e67 2866         warning(f
+0001bdb0: 2241 6464 206d 616e 7561 6c6c 7920 7468  "Add manually th
+0001bdc0: 6973 206e 6574 776f 726b 207b 6970 7d2f  is network {ip}/
+0001bdd0: 7b6d 6173 6b7d 2077 6974 6820 6761 7465  {mask} with gate
+0001bde0: 7761 7920 7b67 6174 6577 6179 7d22 290a  way {gateway}").
+0001bdf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001be00: 2020 2020 2020 2020 2020 2020 6966 2027              if '
+0001be10: 7669 7073 2720 696e 206e 6574 3a0a 2020  vips' in net:.  
+0001be20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001be30: 2020 2020 2020 2020 2020 2020 2020 7669                vi
+0001be40: 7073 203d 2027 2c27 2e6a 6f69 6e28 6e65  ps = ','.join(ne
+0001be50: 745b 2776 6970 7327 5d29 0a20 2020 2020  t['vips']).     
+0001be60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001be70: 2020 2020 2020 2020 2020 2077 6172 6e69             warni
+0001be80: 6e67 2866 2241 6464 206d 616e 7561 6c6c  ng(f"Add manuall
+0001be90: 7920 7669 7073 207b 7669 7073 7d22 290a  y vips {vips}").
+0001bea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001beb0: 2020 2020 2020 2020 7070 7269 6e74 2822          pprint("
+0001bec0: 4d61 6b65 2073 7572 6520 746f 2065 7870  Make sure to exp
+0001bed0: 6f72 7420 414e 5349 424c 455f 4a49 4e4a  ort ANSIBLE_JINJ
+0001bee0: 4132 5f45 5854 454e 5349 4f4e 533d 6a69  A2_EXTENSIONS=ji
+0001bef0: 6e6a 6132 2e65 7874 2e64 6f22 290a 2020  nja2.ext.do").  
+0001bf00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bf10: 2020 2020 2020 7365 6c66 2e63 7265 6174        self.creat
+0001bf20: 655f 766d 5f70 6c61 7962 6f6f 6b28 6e61  e_vm_playbook(na
+0001bf30: 6d65 2c20 7072 6f66 696c 652c 206f 7665  me, profile, ove
+0001bf40: 7272 6964 6573 3d6f 7665 7272 6964 6573  rrides=overrides
+0001bf50: 2c20 7374 6f72 653d 5472 7565 290a 2020  , store=True).  
+0001bf60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bf70: 2020 2020 2020 636f 6e74 696e 7565 0a20        continue. 
+0001bf80: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0001bf90: 6620 7a2e 6578 6973 7473 286e 616d 6529  f z.exists(name)
+0001bfa0: 2061 6e64 206e 6f74 206f 6e6c 7961 7373   and not onlyass
+0001bfb0: 6574 733a 0a20 2020 2020 2020 2020 2020  ets:.           
+0001bfc0: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+0001bfd0: 7570 6461 7465 3a0a 2020 2020 2020 2020  update:.        
+0001bfe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bff0: 7070 7269 6e74 2866 227b 6e61 6d65 7dc2  pprint(f"{name}.
+0001c000: a073 6b69 7070 6564 206f 6e20 7b76 6d63  .skipped on {vmc
+0001c010: 6c69 656e 747d 2122 290a 2020 2020 2020  lient}!").      
+0001c020: 2020 2020 2020 2020 2020 2020 2020 656c                el
+0001c030: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0001c040: 2020 2020 2020 2020 2020 2020 7570 6461              upda
+0001c050: 7465 6420 3d20 4661 6c73 650a 2020 2020  ted = False.    
+0001c060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c070: 2020 2020 6375 7272 656e 7476 6d20 3d20      currentvm = 
+0001c080: 7a2e 696e 666f 286e 616d 6529 0a20 2020  z.info(name).   
+0001c090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c0a0: 2020 2020 2063 7572 7265 6e74 7374 6172       currentstar
+0001c0b0: 7420 3d20 6375 7272 656e 7476 6d2e 6765  t = currentvm.ge
+0001c0c0: 7428 2761 7574 6f73 7461 7274 272c 2046  t('autostart', F
+0001c0d0: 616c 7365 290a 2020 2020 2020 2020 2020  alse).          
+0001c0e0: 2020 2020 2020 2020 2020 2020 2020 6375                cu
+0001c0f0: 7272 656e 746d 656d 6f72 7920 3d20 6375  rrentmemory = cu
+0001c100: 7272 656e 7476 6d5b 276d 656d 6f72 7927  rrentvm['memory'
+0001c110: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+0001c120: 2020 2020 2020 2020 2020 6375 7272 656e            curren
+0001c130: 7469 6d61 6765 203d 2063 7572 7265 6e74  timage = current
+0001c140: 766d 2e67 6574 2827 7465 6d70 6c61 7465  vm.get('template
+0001c150: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
+0001c160: 2020 2020 2020 2020 2020 2063 7572 7265             curre
+0001c170: 6e74 696d 6167 6520 3d20 6375 7272 656e  ntimage = curren
+0001c180: 7476 6d2e 6765 7428 2769 6d61 6765 272c  tvm.get('image',
+0001c190: 2063 7572 7265 6e74 696d 6167 6529 0a20   currentimage). 
 0001c1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c1b0: 2020 2020 2020 2063 7572 7265 6e74 696d         currentim
-0001c1c0: 6167 6520 3d20 6375 7272 656e 7476 6d2e  age = currentvm.
-0001c1d0: 6765 7428 2769 6d61 6765 272c 2063 7572  get('image', cur
-0001c1e0: 7265 6e74 696d 6167 6529 0a20 2020 2020  rentimage).     
-0001c1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c200: 2020 2063 7572 7265 6e74 6370 7573 203d     currentcpus =
-0001c210: 2069 6e74 2863 7572 7265 6e74 766d 5b27   int(currentvm['
-0001c220: 6370 7573 275d 290a 2020 2020 2020 2020  cpus']).        
-0001c230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c240: 6375 7272 656e 746e 6574 7320 3d20 6375  currentnets = cu
-0001c250: 7272 656e 7476 6d5b 276e 6574 7327 5d0a  rrentvm['nets'].
-0001c260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c270: 2020 2020 2020 2020 6375 7272 656e 7464          currentd
-0001c280: 6973 6b73 203d 2063 7572 7265 6e74 766d  isks = currentvm
-0001c290: 5b27 6469 736b 7327 5d0a 2020 2020 2020  ['disks'].      
-0001c2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c2b0: 2020 6375 7272 656e 7466 6c61 766f 7220    currentflavor 
-0001c2c0: 3d20 6375 7272 656e 7476 6d2e 6765 7428  = currentvm.get(
-0001c2d0: 2766 6c61 766f 7227 290a 2020 2020 2020  'flavor').      
-0001c2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c2f0: 2020 6966 2027 6175 746f 7374 6172 7427    if 'autostart'
-0001c300: 2069 6e20 7072 6f66 696c 6520 616e 6420   in profile and 
-0001c310: 6375 7272 656e 7473 7461 7274 2021 3d20  currentstart != 
-0001c320: 7072 6f66 696c 655b 2761 7574 6f73 7461  profile['autosta
-0001c330: 7274 275d 3a0a 2020 2020 2020 2020 2020  rt']:.          
-0001c340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c350: 2020 7570 6461 7465 6420 3d20 5472 7565    updated = True
-0001c360: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001c370: 2020 2020 2020 2020 2020 2020 2070 7072               ppr
-0001c380: 696e 7428 6622 5570 6461 7469 6e67 2061  int(f"Updating a
-0001c390: 7574 6f73 7461 7274 206f 6620 7b6e 616d  utostart of {nam
-0001c3a0: 657d 2074 6f20 7b70 726f 6669 6c65 5b27  e} to {profile['
-0001c3b0: 6175 746f 7374 6172 7427 5d7d 2229 0a20  autostart']}"). 
+0001c1b0: 2020 2020 2020 2063 7572 7265 6e74 6370         currentcp
+0001c1c0: 7573 203d 2069 6e74 2863 7572 7265 6e74  us = int(current
+0001c1d0: 766d 5b27 6370 7573 275d 290a 2020 2020  vm['cpus']).    
+0001c1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c1f0: 2020 2020 6375 7272 656e 746e 6574 7320      currentnets 
+0001c200: 3d20 6375 7272 656e 7476 6d5b 276e 6574  = currentvm['net
+0001c210: 7327 5d0a 2020 2020 2020 2020 2020 2020  s'].            
+0001c220: 2020 2020 2020 2020 2020 2020 6375 7272              curr
+0001c230: 656e 7464 6973 6b73 203d 2063 7572 7265  entdisks = curre
+0001c240: 6e74 766d 5b27 6469 736b 7327 5d0a 2020  ntvm['disks'].  
+0001c250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c260: 2020 2020 2020 6375 7272 656e 7466 6c61        currentfla
+0001c270: 766f 7220 3d20 6375 7272 656e 7476 6d2e  vor = currentvm.
+0001c280: 6765 7428 2766 6c61 766f 7227 290a 2020  get('flavor').  
+0001c290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c2a0: 2020 2020 2020 6966 2027 6175 746f 7374        if 'autost
+0001c2b0: 6172 7427 2069 6e20 7072 6f66 696c 6520  art' in profile 
+0001c2c0: 616e 6420 6375 7272 656e 7473 7461 7274  and currentstart
+0001c2d0: 2021 3d20 7072 6f66 696c 655b 2761 7574   != profile['aut
+0001c2e0: 6f73 7461 7274 275d 3a0a 2020 2020 2020  ostart']:.      
+0001c2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c300: 2020 2020 2020 7570 6461 7465 6420 3d20        updated = 
+0001c310: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
+0001c320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c330: 2070 7072 696e 7428 6622 5570 6461 7469   pprint(f"Updati
+0001c340: 6e67 2061 7574 6f73 7461 7274 206f 6620  ng autostart of 
+0001c350: 7b6e 616d 657d 2074 6f20 7b70 726f 6669  {name} to {profi
+0001c360: 6c65 5b27 6175 746f 7374 6172 7427 5d7d  le['autostart']}
+0001c370: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+0001c380: 2020 2020 2020 2020 2020 2020 2020 207a                 z
+0001c390: 2e75 7064 6174 655f 7374 6172 7428 6e61  .update_start(na
+0001c3a0: 6d65 2c20 7072 6f66 696c 655b 2761 7574  me, profile['aut
+0001c3b0: 6f73 7461 7274 275d 290a 2020 2020 2020  ostart']).      
 0001c3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c3d0: 2020 2020 2020 2020 2020 207a 2e75 7064             z.upd
-0001c3e0: 6174 655f 7374 6172 7428 6e61 6d65 2c20  ate_start(name, 
-0001c3f0: 7072 6f66 696c 655b 2761 7574 6f73 7461  profile['autosta
-0001c400: 7274 275d 290a 2020 2020 2020 2020 2020  rt']).          
-0001c410: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0001c420: 2027 666c 6176 6f72 2720 696e 2070 726f   'flavor' in pro
-0001c430: 6669 6c65 2061 6e64 2063 7572 7265 6e74  file and current
-0001c440: 666c 6176 6f72 2021 3d20 7072 6f66 696c  flavor != profil
-0001c450: 655b 2766 6c61 766f 7227 5d3a 0a20 2020  e['flavor']:.   
-0001c460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c470: 2020 2020 2020 2020 2075 7064 6174 6564           updated
-0001c480: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
-0001c490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c4a0: 2020 2020 7070 7269 6e74 2866 2255 7064      pprint(f"Upd
-0001c4b0: 6174 696e 6720 666c 6176 6f72 206f 6620  ating flavor of 
-0001c4c0: 7b6e 616d 657d 2074 6f20 7b70 726f 6669  {name} to {profi
-0001c4d0: 6c65 5b27 666c 6176 6f72 275d 7d22 290a  le['flavor']}").
+0001c3d0: 2020 6966 2027 666c 6176 6f72 2720 696e    if 'flavor' in
+0001c3e0: 2070 726f 6669 6c65 2061 6e64 2063 7572   profile and cur
+0001c3f0: 7265 6e74 666c 6176 6f72 2021 3d20 7072  rentflavor != pr
+0001c400: 6f66 696c 655b 2766 6c61 766f 7227 5d3a  ofile['flavor']:
+0001c410: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001c420: 2020 2020 2020 2020 2020 2020 2075 7064               upd
+0001c430: 6174 6564 203d 2054 7275 650a 2020 2020  ated = True.    
+0001c440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c450: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
+0001c460: 2255 7064 6174 696e 6720 666c 6176 6f72  "Updating flavor
+0001c470: 206f 6620 7b6e 616d 657d 2074 6f20 7b70   of {name} to {p
+0001c480: 726f 6669 6c65 5b27 666c 6176 6f72 275d  rofile['flavor']
+0001c490: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
+0001c4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c4b0: 7a2e 7570 6461 7465 5f66 6c61 766f 7228  z.update_flavor(
+0001c4c0: 6e61 6d65 2c20 7072 6f66 696c 655b 2766  name, profile['f
+0001c4d0: 6c61 766f 7227 5d29 0a20 2020 2020 2020  lavor']).       
 0001c4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c4f0: 2020 2020 2020 2020 2020 2020 7a2e 7570              z.up
-0001c500: 6461 7465 5f66 6c61 766f 7228 6e61 6d65  date_flavor(name
-0001c510: 2c20 7072 6f66 696c 655b 2766 6c61 766f  , profile['flavo
-0001c520: 7227 5d29 0a20 2020 2020 2020 2020 2020  r']).           
-0001c530: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-0001c540: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0001c550: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0001c560: 6620 276d 656d 6f72 7927 2069 6e20 7072  f 'memory' in pr
-0001c570: 6f66 696c 6520 616e 6420 6375 7272 656e  ofile and curren
-0001c580: 746d 656d 6f72 7920 213d 2070 726f 6669  tmemory != profi
-0001c590: 6c65 5b27 6d65 6d6f 7279 275d 3a0a 2020  le['memory']:.  
-0001c5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c5b0: 2020 2020 2020 2020 2020 2020 2020 7570                up
-0001c5c0: 6461 7465 6420 3d20 5472 7565 0a20 2020  dated = True.   
-0001c5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c5e0: 2020 2020 2020 2020 2020 2020 2070 7072               ppr
-0001c5f0: 696e 7428 6622 5570 6461 7469 6e67 206d  int(f"Updating m
-0001c600: 656d 6f72 7920 6f66 207b 6e61 6d65 7d20  emory of {name} 
-0001c610: 746f 207b 7072 6f66 696c 655b 276d 656d  to {profile['mem
-0001c620: 6f72 7927 5d7d 2229 0a20 2020 2020 2020  ory']}").       
+0001c4f0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0001c500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c510: 2020 2069 6620 276d 656d 6f72 7927 2069     if 'memory' i
+0001c520: 6e20 7072 6f66 696c 6520 616e 6420 6375  n profile and cu
+0001c530: 7272 656e 746d 656d 6f72 7920 213d 2070  rrentmemory != p
+0001c540: 726f 6669 6c65 5b27 6d65 6d6f 7279 275d  rofile['memory']
+0001c550: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001c560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c570: 2020 7570 6461 7465 6420 3d20 5472 7565    updated = True
+0001c580: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001c590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c5a0: 2070 7072 696e 7428 6622 5570 6461 7469   pprint(f"Updati
+0001c5b0: 6e67 206d 656d 6f72 7920 6f66 207b 6e61  ng memory of {na
+0001c5c0: 6d65 7d20 746f 207b 7072 6f66 696c 655b  me} to {profile[
+0001c5d0: 276d 656d 6f72 7927 5d7d 2229 0a20 2020  'memory']}").   
+0001c5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c5f0: 2020 2020 2020 2020 2020 2020 207a 2e75               z.u
+0001c600: 7064 6174 655f 6d65 6d6f 7279 286e 616d  pdate_memory(nam
+0001c610: 652c 2070 726f 6669 6c65 5b27 6d65 6d6f  e, profile['memo
+0001c620: 7279 275d 290a 2020 2020 2020 2020 2020  ry']).          
 0001c630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c640: 2020 2020 2020 2020 207a 2e75 7064 6174           z.updat
-0001c650: 655f 6d65 6d6f 7279 286e 616d 652c 2070  e_memory(name, p
-0001c660: 726f 6669 6c65 5b27 6d65 6d6f 7279 275d  rofile['memory']
-0001c670: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001c680: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0001c690: 2027 6e75 6d63 7075 7327 2069 6e20 7072   'numcpus' in pr
-0001c6a0: 6f66 696c 6520 616e 6420 6375 7272 656e  ofile and curren
-0001c6b0: 7463 7075 7320 213d 2070 726f 6669 6c65  tcpus != profile
-0001c6c0: 5b27 6e75 6d63 7075 7327 5d3a 0a20 2020  ['numcpus']:.   
-0001c6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c6e0: 2020 2020 2020 2020 2020 2020 2075 7064               upd
-0001c6f0: 6174 6564 203d 2054 7275 650a 2020 2020  ated = True.    
-0001c700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c710: 2020 2020 2020 2020 2020 2020 7070 7269              ppri
-0001c720: 6e74 2866 2255 7064 6174 696e 6720 6370  nt(f"Updating cp
-0001c730: 7573 206f 6620 7b6e 616d 657d 2074 6f20  us of {name} to 
-0001c740: 7b70 726f 6669 6c65 5b27 6e75 6d63 7075  {profile['numcpu
-0001c750: 7327 5d7d 2229 0a20 2020 2020 2020 2020  s']}").         
-0001c760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c770: 2020 2020 2020 207a 2e75 7064 6174 655f         z.update_
-0001c780: 6370 7573 286e 616d 652c 2070 726f 6669  cpus(name, profi
-0001c790: 6c65 5b27 6e75 6d63 7075 7327 5d29 0a20  le['numcpus']). 
-0001c7a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c7b0: 2020 2020 2020 2069 6620 2764 6973 6b73         if 'disks
-0001c7c0: 2720 696e 2070 726f 6669 6c65 3a0a 2020  ' in profile:.  
+0001c640: 2020 6966 2027 6e75 6d63 7075 7327 2069    if 'numcpus' i
+0001c650: 6e20 7072 6f66 696c 6520 616e 6420 6375  n profile and cu
+0001c660: 7272 656e 7463 7075 7320 213d 2070 726f  rrentcpus != pro
+0001c670: 6669 6c65 5b27 6e75 6d63 7075 7327 5d3a  file['numcpus']:
+0001c680: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001c690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c6a0: 2075 7064 6174 6564 203d 2054 7275 650a   updated = True.
+0001c6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c6d0: 7070 7269 6e74 2866 2255 7064 6174 696e  pprint(f"Updatin
+0001c6e0: 6720 6370 7573 206f 6620 7b6e 616d 657d  g cpus of {name}
+0001c6f0: 2074 6f20 7b70 726f 6669 6c65 5b27 6e75   to {profile['nu
+0001c700: 6d63 7075 7327 5d7d 2229 0a20 2020 2020  mcpus']}").     
+0001c710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c720: 2020 2020 2020 2020 2020 207a 2e75 7064             z.upd
+0001c730: 6174 655f 6370 7573 286e 616d 652c 2070  ate_cpus(name, p
+0001c740: 726f 6669 6c65 5b27 6e75 6d63 7075 7327  rofile['numcpus'
+0001c750: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
+0001c760: 2020 2020 2020 2020 2020 2069 6620 2764             if 'd
+0001c770: 6973 6b73 2720 696e 2070 726f 6669 6c65  isks' in profile
+0001c780: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001c790: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0001c7a0: 206c 656e 2863 7572 7265 6e74 6469 736b   len(currentdisk
+0001c7b0: 7329 203c 206c 656e 2870 726f 6669 6c65  s) < len(profile
+0001c7c0: 5b27 6469 736b 7327 5d29 3a0a 2020 2020  ['disks']):.    
 0001c7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c7e0: 2020 2020 2020 2020 2020 6966 206c 656e            if len
-0001c7f0: 2863 7572 7265 6e74 6469 736b 7329 203c  (currentdisks) <
-0001c800: 206c 656e 2870 726f 6669 6c65 5b27 6469   len(profile['di
-0001c810: 736b 7327 5d29 3a0a 2020 2020 2020 2020  sks']):.        
-0001c820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c830: 2020 2020 2020 2020 7570 6461 7465 6420          updated 
-0001c840: 3d20 5472 7565 0a20 2020 2020 2020 2020  = True.         
-0001c850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c860: 2020 2020 2020 2070 7072 696e 7428 6622         pprint(f"
-0001c870: 4164 6469 6e67 2044 6973 6b73 2074 6f20  Adding Disks to 
-0001c880: 7b6e 616d 657d 2229 0a20 2020 2020 2020  {name}").       
+0001c7e0: 2020 2020 2020 2020 2020 2020 7570 6461              upda
+0001c7f0: 7465 6420 3d20 5472 7565 0a20 2020 2020  ted = True.     
+0001c800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c810: 2020 2020 2020 2020 2020 2070 7072 696e             pprin
+0001c820: 7428 6622 4164 6469 6e67 2044 6973 6b73  t(f"Adding Disks
+0001c830: 2074 6f20 7b6e 616d 657d 2229 0a20 2020   to {name}").   
+0001c840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c850: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+0001c860: 2064 6973 6b20 696e 2070 726f 6669 6c65   disk in profile
+0001c870: 5b27 6469 736b 7327 5d5b 6c65 6e28 6375  ['disks'][len(cu
+0001c880: 7272 656e 7464 6973 6b73 293a 5d3a 0a20  rrentdisks):]:. 
 0001c890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c8a0: 2020 2020 2020 2020 2066 6f72 2064 6973           for dis
-0001c8b0: 6b20 696e 2070 726f 6669 6c65 5b27 6469  k in profile['di
-0001c8c0: 736b 7327 5d5b 6c65 6e28 6375 7272 656e  sks'][len(curren
-0001c8d0: 7464 6973 6b73 293a 5d3a 0a20 2020 2020  tdisks):]:.     
+0001c8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c8b0: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+0001c8c0: 2864 6973 6b2c 2069 6e74 293a 0a20 2020  (disk, int):.   
+0001c8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001c8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c8f0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0001c900: 6620 6973 696e 7374 616e 6365 2864 6973  f isinstance(dis
-0001c910: 6b2c 2069 6e74 293a 0a20 2020 2020 2020  k, int):.       
-0001c920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c940: 2073 697a 6520 3d20 6469 736b 0a20 2020   size = disk.   
-0001c950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c970: 2020 2020 2070 6f6f 6c20 3d20 7365 6c66       pool = self
-0001c980: 2e70 6f6f 6c0a 2020 2020 2020 2020 2020  .pool.          
+0001c8f0: 2020 2020 2073 697a 6520 3d20 6469 736b       size = disk
+0001c900: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001c910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c920: 2020 2020 2020 2020 2070 6f6f 6c20 3d20           pool = 
+0001c930: 7365 6c66 2e70 6f6f 6c0a 2020 2020 2020  self.pool.      
+0001c940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c950: 2020 2020 2020 2020 2020 2020 2020 656c                el
+0001c960: 6966 2069 7369 6e73 7461 6e63 6528 6469  if isinstance(di
+0001c970: 736b 2c20 7374 7229 2061 6e64 2064 6973  sk, str) and dis
+0001c980: 6b2e 6973 6469 6769 7428 293a 0a20 2020  k.isdigit():.   
 0001c990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c9a0: 2020 2020 2020 2020 2020 656c 6966 2069            elif i
-0001c9b0: 7369 6e73 7461 6e63 6528 6469 736b 2c20  sinstance(disk, 
-0001c9c0: 7374 7229 2061 6e64 2064 6973 6b2e 6973  str) and disk.is
-0001c9d0: 6469 6769 7428 293a 0a20 2020 2020 2020  digit():.       
-0001c9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ca00: 2073 697a 6520 3d20 696e 7428 6469 736b   size = int(disk
-0001ca10: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001ca20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ca30: 2020 2020 2020 2020 2020 706f 6f6c 203d            pool =
-0001ca40: 2073 656c 662e 706f 6f6c 0a20 2020 2020   self.pool.     
+0001c9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c9b0: 2020 2020 2073 697a 6520 3d20 696e 7428       size = int(
+0001c9c0: 6469 736b 290a 2020 2020 2020 2020 2020  disk).          
+0001c9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c9e0: 2020 2020 2020 2020 2020 2020 2020 706f                po
+0001c9f0: 6f6c 203d 2073 656c 662e 706f 6f6c 0a20  ol = self.pool. 
+0001ca00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ca10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ca20: 2020 2065 6c69 6620 6973 696e 7374 616e     elif isinstan
+0001ca30: 6365 2864 6973 6b2c 2064 6963 7429 3a0a  ce(disk, dict):.
+0001ca40: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001ca50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ca60: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0001ca70: 6c69 6620 6973 696e 7374 616e 6365 2864  lif isinstance(d
-0001ca80: 6973 6b2c 2064 6963 7429 3a0a 2020 2020  isk, dict):.    
+0001ca60: 2020 2020 2020 2020 7369 7a65 203d 2064          size = d
+0001ca70: 6973 6b2e 6765 7428 2773 697a 6527 2c20  isk.get('size', 
+0001ca80: 7365 6c66 2e64 6973 6b73 697a 6529 0a20  self.disksize). 
 0001ca90: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001caa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cab0: 2020 2020 7369 7a65 203d 2064 6973 6b2e      size = disk.
-0001cac0: 6765 7428 2773 697a 6527 2c20 7365 6c66  get('size', self
-0001cad0: 2e64 6973 6b73 697a 6529 0a20 2020 2020  .disksize).     
+0001cab0: 2020 2020 2020 2070 6f6f 6c20 3d20 6469         pool = di
+0001cac0: 736b 2e67 6574 2827 706f 6f6c 272c 2073  sk.get('pool', s
+0001cad0: 656c 662e 706f 6f6c 290a 2020 2020 2020  elf.pool).      
 0001cae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001caf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cb00: 2020 2070 6f6f 6c20 3d20 6469 736b 2e67     pool = disk.g
-0001cb10: 6574 2827 706f 6f6c 272c 2073 656c 662e  et('pool', self.
-0001cb20: 706f 6f6c 290a 2020 2020 2020 2020 2020  pool).          
-0001cb30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cb40: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-0001cb50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cb60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cb70: 2020 2020 2020 2020 636f 6e74 696e 7565          continue
-0001cb80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001caf0: 2020 2020 2020 2020 2020 2020 2020 656c                el
+0001cb00: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0001cb10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cb20: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+0001cb30: 696e 7565 0a20 2020 2020 2020 2020 2020  inue.           
+0001cb40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cb50: 2020 2020 2020 2020 207a 2e61 6464 5f64           z.add_d
+0001cb60: 6973 6b28 6e61 6d65 3d6e 616d 652c 2073  isk(name=name, s
+0001cb70: 697a 653d 7369 7a65 2c20 706f 6f6c 3d70  ize=size, pool=p
+0001cb80: 6f6f 6c29 0a20 2020 2020 2020 2020 2020  ool).           
 0001cb90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cba0: 2020 2020 207a 2e61 6464 5f64 6973 6b28       z.add_disk(
-0001cbb0: 6e61 6d65 3d6e 616d 652c 2073 697a 653d  name=name, size=
-0001cbc0: 7369 7a65 2c20 706f 6f6c 3d70 6f6f 6c29  size, pool=pool)
-0001cbd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001cbe0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0001cbf0: 6c65 6e28 6375 7272 656e 7464 6973 6b73  len(currentdisks
-0001cc00: 2920 3e20 6c65 6e28 7072 6f66 696c 655b  ) > len(profile[
-0001cc10: 2764 6973 6b73 275d 293a 0a20 2020 2020  'disks']):.     
-0001cc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cc30: 2020 2020 2020 2020 2020 2075 7064 6174             updat
-0001cc40: 6564 203d 2054 7275 650a 2020 2020 2020  ed = True.      
+0001cba0: 2069 6620 6c65 6e28 6375 7272 656e 7464   if len(currentd
+0001cbb0: 6973 6b73 2920 3e20 6c65 6e28 7072 6f66  isks) > len(prof
+0001cbc0: 696c 655b 2764 6973 6b73 275d 293a 0a20  ile['disks']):. 
+0001cbd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cbe0: 2020 2020 2020 2020 2020 2020 2020 2075                 u
+0001cbf0: 7064 6174 6564 203d 2054 7275 650a 2020  pdated = True.  
+0001cc00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cc10: 2020 2020 2020 2020 2020 2020 2020 7070                pp
+0001cc20: 7269 6e74 2866 2252 656d 6f76 696e 6720  rint(f"Removing 
+0001cc30: 4469 736b 7320 6f66 207b 6e61 6d65 7d22  Disks of {name}"
+0001cc40: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
 0001cc50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cc60: 2020 2020 2020 2020 2020 7070 7269 6e74            pprint
-0001cc70: 2866 2252 656d 6f76 696e 6720 4469 736b  (f"Removing Disk
-0001cc80: 7320 6f66 207b 6e61 6d65 7d22 290a 2020  s of {name}").  
-0001cc90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cca0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-0001ccb0: 7220 6469 736b 2069 6e20 6375 7272 656e  r disk in curren
-0001ccc0: 7464 6973 6b73 5b6c 656e 2863 7572 7265  tdisks[len(curre
-0001ccd0: 6e74 6469 736b 7329 202d 206c 656e 2870  ntdisks) - len(p
-0001cce0: 726f 6669 6c65 5b27 6469 736b 7327 5d29  rofile['disks'])
-0001ccf0: 3a5d 3a0a 2020 2020 2020 2020 2020 2020  :]:.            
+0001cc60: 2020 666f 7220 6469 736b 2069 6e20 6375    for disk in cu
+0001cc70: 7272 656e 7464 6973 6b73 5b6c 656e 2863  rrentdisks[len(c
+0001cc80: 7572 7265 6e74 6469 736b 7329 202d 206c  urrentdisks) - l
+0001cc90: 656e 2870 726f 6669 6c65 5b27 6469 736b  en(profile['disk
+0001cca0: 7327 5d29 3a5d 3a0a 2020 2020 2020 2020  s']):]:.        
+0001ccb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ccc0: 2020 2020 2020 2020 2020 2020 6469 736b              disk
+0001ccd0: 6e61 6d65 203d 206f 732e 7061 7468 2e62  name = os.path.b
+0001cce0: 6173 656e 616d 6528 6469 736b 5b27 7061  asename(disk['pa
+0001ccf0: 7468 275d 290a 2020 2020 2020 2020 2020  th']).          
 0001cd00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cd10: 2020 2020 2020 2020 6469 736b 6e61 6d65          diskname
-0001cd20: 203d 206f 732e 7061 7468 2e62 6173 656e   = os.path.basen
-0001cd30: 616d 6528 6469 736b 5b27 7061 7468 275d  ame(disk['path']
-0001cd40: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001cd10: 2020 2020 2020 2020 2020 6469 736b 706f            diskpo
+0001cd20: 6f6c 203d 206f 732e 7061 7468 2e64 6972  ol = os.path.dir
+0001cd30: 6e61 6d65 2864 6973 6b5b 2770 6174 6827  name(disk['path'
+0001cd40: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
 0001cd50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cd60: 2020 2020 2020 6469 736b 706f 6f6c 203d        diskpool =
-0001cd70: 206f 732e 7061 7468 2e64 6972 6e61 6d65   os.path.dirname
-0001cd80: 2864 6973 6b5b 2770 6174 6827 5d29 0a20  (disk['path']). 
-0001cd90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cdb0: 2020 207a 2e64 656c 6574 655f 6469 736b     z.delete_disk
-0001cdc0: 286e 616d 653d 6e61 6d65 2c20 6469 736b  (name=name, disk
-0001cdd0: 6e61 6d65 3d64 6973 6b6e 616d 652c 2070  name=diskname, p
-0001cde0: 6f6f 6c3d 6469 736b 706f 6f6c 290a 2020  ool=diskpool).  
-0001cdf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ce00: 2020 2020 2020 6966 2027 6e65 7473 2720        if 'nets' 
-0001ce10: 696e 2070 726f 6669 6c65 3a0a 2020 2020  in profile:.    
+0001cd60: 2020 2020 2020 207a 2e64 656c 6574 655f         z.delete_
+0001cd70: 6469 736b 286e 616d 653d 6e61 6d65 2c20  disk(name=name, 
+0001cd80: 6469 736b 6e61 6d65 3d64 6973 6b6e 616d  diskname=disknam
+0001cd90: 652c 2070 6f6f 6c3d 6469 736b 706f 6f6c  e, pool=diskpool
+0001cda0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001cdb0: 2020 2020 2020 2020 2020 6966 2027 6e65            if 'ne
+0001cdc0: 7473 2720 696e 2070 726f 6669 6c65 3a0a  ts' in profile:.
+0001cdd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cde0: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+0001cdf0: 656e 2863 7572 7265 6e74 6e65 7473 2920  en(currentnets) 
+0001ce00: 3c20 6c65 6e28 7072 6f66 696c 655b 276e  < len(profile['n
+0001ce10: 6574 7327 5d29 3a0a 2020 2020 2020 2020  ets']):.        
 0001ce20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ce30: 2020 2020 2020 2020 6966 206c 656e 2863          if len(c
-0001ce40: 7572 7265 6e74 6e65 7473 2920 3c20 6c65  urrentnets) < le
-0001ce50: 6e28 7072 6f66 696c 655b 276e 6574 7327  n(profile['nets'
-0001ce60: 5d29 3a0a 2020 2020 2020 2020 2020 2020  ]):.            
-0001ce70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ce80: 2020 2020 7570 6461 7465 6420 3d20 5472      updated = Tr
-0001ce90: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
-0001cea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ceb0: 2020 2070 7072 696e 7428 6622 4164 6469     pprint(f"Addi
-0001cec0: 6e67 204e 6963 7320 746f 207b 6e61 6d65  ng Nics to {name
-0001ced0: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
+0001ce30: 2020 2020 2020 2020 7570 6461 7465 6420          updated 
+0001ce40: 3d20 5472 7565 0a20 2020 2020 2020 2020  = True.         
+0001ce50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ce60: 2020 2020 2020 2070 7072 696e 7428 6622         pprint(f"
+0001ce70: 4164 6469 6e67 204e 6963 7320 746f 207b  Adding Nics to {
+0001ce80: 6e61 6d65 7d22 290a 2020 2020 2020 2020  name}").        
+0001ce90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cea0: 2020 2020 2020 2020 666f 7220 6e65 7420          for net 
+0001ceb0: 696e 2070 726f 6669 6c65 5b27 6e65 7473  in profile['nets
+0001cec0: 275d 5b6c 656e 2863 7572 7265 6e74 6e65  '][len(currentne
+0001ced0: 7473 293a 5d3a 0a20 2020 2020 2020 2020  ts):]:.         
 0001cee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cef0: 2020 2020 666f 7220 6e65 7420 696e 2070      for net in p
-0001cf00: 726f 6669 6c65 5b27 6e65 7473 275d 5b6c  rofile['nets'][l
-0001cf10: 656e 2863 7572 7265 6e74 6e65 7473 293a  en(currentnets):
-0001cf20: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
-0001cf30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cf40: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
-0001cf50: 616e 6365 286e 6574 2c20 7374 7229 3a0a  ance(net, str):.
-0001cf60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cf70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cf80: 2020 2020 2020 2020 6e65 7477 6f72 6b20          network 
-0001cf90: 3d20 6e65 740a 2020 2020 2020 2020 2020  = net.          
+0001cef0: 2020 2020 2020 2020 2020 2069 6620 6973             if is
+0001cf00: 696e 7374 616e 6365 286e 6574 2c20 7374  instance(net, st
+0001cf10: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
+0001cf20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cf30: 2020 2020 2020 2020 2020 2020 6e65 7477              netw
+0001cf40: 6f72 6b20 3d20 6e65 740a 2020 2020 2020  ork = net.      
+0001cf50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cf60: 2020 2020 2020 2020 2020 2020 2020 656c                el
+0001cf70: 6966 2069 7369 6e73 7461 6e63 6528 6e65  if isinstance(ne
+0001cf80: 742c 2064 6963 7429 2061 6e64 2027 6e61  t, dict) and 'na
+0001cf90: 6d65 2720 696e 206e 6574 3a0a 2020 2020  me' in net:.    
 0001cfa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cfb0: 2020 2020 2020 2020 2020 656c 6966 2069            elif i
-0001cfc0: 7369 6e73 7461 6e63 6528 6e65 742c 2064  sinstance(net, d
-0001cfd0: 6963 7429 2061 6e64 2027 6e61 6d65 2720  ict) and 'name' 
-0001cfe0: 696e 206e 6574 3a0a 2020 2020 2020 2020  in net:.        
-0001cff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d010: 6e65 7477 6f72 6b20 3d20 6e65 745b 276e  network = net['n
-0001d020: 616d 6527 5d0a 2020 2020 2020 2020 2020  ame'].          
-0001d030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d040: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-0001d050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cfb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cfc0: 2020 2020 6e65 7477 6f72 6b20 3d20 6e65      network = ne
+0001cfd0: 745b 276e 616d 6527 5d0a 2020 2020 2020  t['name'].      
+0001cfe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cff0: 2020 2020 2020 2020 2020 2020 2020 656c                el
+0001d000: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0001d010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d020: 2020 2020 2020 2020 2020 2020 6572 726f              erro
+0001d030: 7228 6622 536b 7070 696e 6720 7772 6f6e  r(f"Skpping wron
+0001d040: 6720 6e69 6320 7370 6563 2066 6f72 207b  g nic spec for {
+0001d050: 6e61 6d65 7d22 290a 2020 2020 2020 2020  name}").        
 0001d060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d070: 2020 2020 2020 2020 6572 726f 7228 6622          error(f"
-0001d080: 536b 7070 696e 6720 7772 6f6e 6720 6e69  Skpping wrong ni
-0001d090: 6320 7370 6563 2066 6f72 207b 6e61 6d65  c spec for {name
-0001d0a0: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
-0001d0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d0c0: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
-0001d0d0: 696e 7565 0a20 2020 2020 2020 2020 2020  inue.           
-0001d0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d0f0: 2020 2020 2020 2020 207a 2e61 6464 5f6e           z.add_n
-0001d100: 6963 286e 616d 652c 206e 6574 776f 726b  ic(name, network
-0001d110: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001d120: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0001d130: 206c 656e 2863 7572 7265 6e74 6e65 7473   len(currentnets
-0001d140: 2920 3e20 6c65 6e28 7072 6f66 696c 655b  ) > len(profile[
-0001d150: 276e 6574 7327 5d29 3a0a 2020 2020 2020  'nets']):.      
-0001d160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d170: 2020 2020 2020 2020 2020 7570 6461 7465            update
-0001d180: 6420 3d20 5472 7565 0a20 2020 2020 2020  d = True.       
+0001d070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d080: 636f 6e74 696e 7565 0a20 2020 2020 2020  continue.       
+0001d090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d0a0: 2020 2020 2020 2020 2020 2020 207a 2e61               z.a
+0001d0b0: 6464 5f6e 6963 286e 616d 652c 206e 6574  dd_nic(name, net
+0001d0c0: 776f 726b 290a 2020 2020 2020 2020 2020  work).          
+0001d0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d0e0: 2020 6966 206c 656e 2863 7572 7265 6e74    if len(current
+0001d0f0: 6e65 7473 2920 3e20 6c65 6e28 7072 6f66  nets) > len(prof
+0001d100: 696c 655b 276e 6574 7327 5d29 3a0a 2020  ile['nets']):.  
+0001d110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d120: 2020 2020 2020 2020 2020 2020 2020 7570                up
+0001d130: 6461 7465 6420 3d20 5472 7565 0a20 2020  dated = True.   
+0001d140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d150: 2020 2020 2020 2020 2020 2020 2070 7072               ppr
+0001d160: 696e 7428 6622 5265 6d6f 7669 6e67 204e  int(f"Removing N
+0001d170: 6963 7320 6f66 207b 6e61 6d65 7d22 290a  ics of {name}").
+0001d180: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001d190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d1a0: 2020 2020 2020 2020 2070 7072 696e 7428           pprint(
-0001d1b0: 6622 5265 6d6f 7669 6e67 204e 6963 7320  f"Removing Nics 
-0001d1c0: 6f66 207b 6e61 6d65 7d22 290a 2020 2020  of {name}").    
-0001d1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d1e0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-0001d1f0: 6e65 7420 696e 2072 616e 6765 286c 656e  net in range(len
-0001d200: 2863 7572 7265 6e74 6e65 7473 292c 206c  (currentnets), l
-0001d210: 656e 2870 726f 6669 6c65 5b27 6e65 7473  en(profile['nets
-0001d220: 275d 292c 202d 3129 3a0a 2020 2020 2020  ']), -1):.      
+0001d1a0: 666f 7220 6e65 7420 696e 2072 616e 6765  for net in range
+0001d1b0: 286c 656e 2863 7572 7265 6e74 6e65 7473  (len(currentnets
+0001d1c0: 292c 206c 656e 2870 726f 6669 6c65 5b27  ), len(profile['
+0001d1d0: 6e65 7473 275d 292c 202d 3129 3a0a 2020  nets']), -1):.  
+0001d1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d200: 2020 696e 7465 7266 6163 6520 3d20 6622    interface = f"
+0001d210: 6574 687b 6e65 7420 2d31 7d22 0a20 2020  eth{net -1}".   
+0001d220: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001d230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d240: 2020 2020 2020 2020 2020 2020 2020 696e                in
-0001d250: 7465 7266 6163 6520 3d20 6622 6574 687b  terface = f"eth{
-0001d260: 6e65 7420 2d31 7d22 0a20 2020 2020 2020  net -1}".       
-0001d270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d280: 2020 2020 2020 2020 2020 2020 207a 2e64               z.d
-0001d290: 656c 6574 655f 6e69 6328 6e61 6d65 2c20  elete_nic(name, 
-0001d2a0: 696e 7465 7266 6163 6529 0a20 2020 2020  interface).     
+0001d240: 207a 2e64 656c 6574 655f 6e69 6328 6e61   z.delete_nic(na
+0001d250: 6d65 2c20 696e 7465 7266 6163 6529 0a20  me, interface). 
+0001d260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d270: 2020 2020 2020 2069 6620 6f76 6572 7269         if overri
+0001d280: 6465 732e 6765 7428 2773 6b69 705f 6669  des.get('skip_fi
+0001d290: 6c65 735f 7265 6d65 6469 6174 696f 6e27  les_remediation'
+0001d2a0: 2c20 4661 6c73 6529 3a0a 2020 2020 2020  , False):.      
 0001d2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d2c0: 2020 2069 6620 6f76 6572 7269 6465 732e     if overrides.
-0001d2d0: 6765 7428 2773 6b69 705f 6669 6c65 735f  get('skip_files_
-0001d2e0: 7265 6d65 6469 6174 696f 6e27 2c20 4661  remediation', Fa
-0001d2f0: 6c73 6529 3a0a 2020 2020 2020 2020 2020  lse):.          
-0001d300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d310: 2020 7070 7269 6e74 2866 2253 6b69 7070    pprint(f"Skipp
-0001d320: 696e 6720 5265 6d65 6469 6174 696f 6e20  ing Remediation 
-0001d330: 6669 6c65 7320 6f66 207b 6e61 6d65 7d22  files of {name}"
-0001d340: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001d350: 2020 2020 2020 2020 2020 656c 6966 2073            elif s
-0001d360: 656c 662e 7265 6d65 6469 6174 655f 6669  elf.remediate_fi
-0001d370: 6c65 7328 6e61 6d65 2c20 7072 6f66 696c  les(name, profil
-0001d380: 652e 6765 7428 2766 696c 6573 272c 205b  e.get('files', [
-0001d390: 5d29 2c20 6f76 6572 7269 6465 732c 2069  ]), overrides, i
-0001d3a0: 6e70 7574 6469 723d 696e 7075 7464 6972  nputdir=inputdir
-0001d3b0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0001d3c0: 2020 2020 2020 2020 2020 2020 2020 2075                 u
-0001d3d0: 7064 6174 6564 203d 2054 7275 650a 2020  pdated = True.  
-0001d3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d3f0: 2020 2020 2020 6966 206e 6f74 2075 7064        if not upd
-0001d400: 6174 6564 3a0a 2020 2020 2020 2020 2020  ated:.          
-0001d410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d420: 2020 7070 7269 6e74 2866 227b 6e61 6d65    pprint(f"{name
-0001d430: 7d20 736b 6970 7065 6420 6f6e 207b 766d  } skipped on {vm
-0001d440: 636c 6965 6e74 7d21 2229 0a20 2020 2020  client}!").     
-0001d450: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0001d460: 7869 7374 696e 6776 6d73 2e61 7070 656e  xistingvms.appen
-0001d470: 6428 6e61 6d65 290a 2020 2020 2020 2020  d(name).        
-0001d480: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
-0001d490: 696e 7565 0a20 2020 2020 2020 2020 2020  inue.           
-0001d4a0: 2020 2020 2073 6861 7265 646b 6579 203d       sharedkey =
-0001d4b0: 2070 726f 6669 6c65 2e67 6574 2827 7368   profile.get('sh
-0001d4c0: 6172 6564 6b65 7927 2c20 7365 6c66 2e73  aredkey', self.s
-0001d4d0: 6861 7265 646b 6579 290a 2020 2020 2020  haredkey).      
-0001d4e0: 2020 2020 2020 2020 2020 6966 2073 6861            if sha
-0001d4f0: 7265 646b 6579 3a0a 2020 2020 2020 2020  redkey:.        
-0001d500: 2020 2020 2020 2020 2020 2020 766d 636f              vmco
-0001d510: 756e 7465 7220 2b3d 2031 0a20 2020 2020  unter += 1.     
-0001d520: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0001d530: 6620 6e6f 7420 6f73 2e70 6174 682e 6578  f not os.path.ex
-0001d540: 6973 7473 2866 227b 706c 616e 7d2e 6b65  ists(f"{plan}.ke
-0001d550: 7922 2920 6f72 206e 6f74 206f 732e 7061  y") or not os.pa
-0001d560: 7468 2e65 7869 7374 7328 6622 7b70 6c61  th.exists(f"{pla
-0001d570: 6e7d 2e6b 6579 2e70 7562 2229 3a0a 2020  n}.key.pub"):.  
+0001d2c0: 2020 2020 2020 7070 7269 6e74 2866 2253        pprint(f"S
+0001d2d0: 6b69 7070 696e 6720 5265 6d65 6469 6174  kipping Remediat
+0001d2e0: 696f 6e20 6669 6c65 7320 6f66 207b 6e61  ion files of {na
+0001d2f0: 6d65 7d22 290a 2020 2020 2020 2020 2020  me}").          
+0001d300: 2020 2020 2020 2020 2020 2020 2020 656c                el
+0001d310: 6966 2073 656c 662e 7265 6d65 6469 6174  if self.remediat
+0001d320: 655f 6669 6c65 7328 6e61 6d65 2c20 7072  e_files(name, pr
+0001d330: 6f66 696c 652e 6765 7428 2766 696c 6573  ofile.get('files
+0001d340: 272c 205b 5d29 2c20 6f76 6572 7269 6465  ', []), override
+0001d350: 732c 2069 6e70 7574 6469 723d 696e 7075  s, inputdir=inpu
+0001d360: 7464 6972 293a 0a20 2020 2020 2020 2020  tdir):.         
+0001d370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d380: 2020 2075 7064 6174 6564 203d 2054 7275     updated = Tru
+0001d390: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+0001d3a0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+0001d3b0: 2075 7064 6174 6564 3a0a 2020 2020 2020   updated:.      
+0001d3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d3d0: 2020 2020 2020 7070 7269 6e74 2866 227b        pprint(f"{
+0001d3e0: 6e61 6d65 7d20 736b 6970 7065 6420 6f6e  name} skipped on
+0001d3f0: 207b 766d 636c 6965 6e74 7d21 2229 0a20   {vmclient}!"). 
+0001d400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d410: 2020 2065 7869 7374 696e 6776 6d73 2e61     existingvms.a
+0001d420: 7070 656e 6428 6e61 6d65 290a 2020 2020  ppend(name).    
+0001d430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d440: 636f 6e74 696e 7565 0a20 2020 2020 2020  continue.       
+0001d450: 2020 2020 2020 2020 2073 6861 7265 646b           sharedk
+0001d460: 6579 203d 2070 726f 6669 6c65 2e67 6574  ey = profile.get
+0001d470: 2827 7368 6172 6564 6b65 7927 2c20 7365  ('sharedkey', se
+0001d480: 6c66 2e73 6861 7265 646b 6579 290a 2020  lf.sharedkey).  
+0001d490: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0001d4a0: 2073 6861 7265 646b 6579 3a0a 2020 2020   sharedkey:.    
+0001d4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d4c0: 766d 636f 756e 7465 7220 2b3d 2031 0a20  vmcounter += 1. 
+0001d4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d4e0: 2020 2069 6620 6e6f 7420 6f73 2e70 6174     if not os.pat
+0001d4f0: 682e 6578 6973 7473 2866 227b 706c 616e  h.exists(f"{plan
+0001d500: 7d2e 6b65 7922 2920 6f72 206e 6f74 206f  }.key") or not o
+0001d510: 732e 7061 7468 2e65 7869 7374 7328 6622  s.path.exists(f"
+0001d520: 7b70 6c61 6e7d 2e6b 6579 2e70 7562 2229  {plan}.key.pub")
+0001d530: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001d540: 2020 2020 2020 2020 2020 6f73 2e73 7973            os.sys
+0001d550: 7465 6d28 6622 7373 682d 6b65 7967 656e  tem(f"ssh-keygen
+0001d560: 202d 7174 2072 7361 202d 4e20 2727 202d   -qt rsa -N '' -
+0001d570: 6620 7b70 6c61 6e7d 2e6b 6579 2229 0a20  f {plan}.key"). 
 0001d580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d590: 2020 2020 2020 6f73 2e73 7973 7465 6d28        os.system(
-0001d5a0: 6622 7373 682d 6b65 7967 656e 202d 7174  f"ssh-keygen -qt
-0001d5b0: 2072 7361 202d 4e20 2727 202d 6620 7b70   rsa -N '' -f {p
-0001d5c0: 6c61 6e7d 2e6b 6579 2229 0a20 2020 2020  lan}.key").     
-0001d5d0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0001d5e0: 7562 6c69 636b 6579 203d 206f 7065 6e28  ublickey = open(
-0001d5f0: 6622 7b70 6c61 6e7d 2e6b 6579 2e70 7562  f"{plan}.key.pub
-0001d600: 2229 2e72 6561 6428 292e 7374 7269 7028  ").read().strip(
-0001d610: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001d620: 2020 2020 2020 7072 6976 6174 656b 6579        privatekey
-0001d630: 203d 206f 7065 6e28 6622 7b70 6c61 6e7d   = open(f"{plan}
-0001d640: 2e6b 6579 2229 2e72 6561 6428 292e 7374  .key").read().st
-0001d650: 7269 7028 290a 2020 2020 2020 2020 2020  rip().          
-0001d660: 2020 2020 2020 2020 2020 6966 2027 6b65            if 'ke
-0001d670: 7973 2720 6e6f 7420 696e 2070 726f 6669  ys' not in profi
-0001d680: 6c65 3a0a 2020 2020 2020 2020 2020 2020  le:.            
-0001d690: 2020 2020 2020 2020 2020 2020 7072 6f66              prof
-0001d6a0: 696c 655b 276b 6579 7327 5d20 3d20 5b70  ile['keys'] = [p
-0001d6b0: 7562 6c69 636b 6579 5d0a 2020 2020 2020  ublickey].      
-0001d6c0: 2020 2020 2020 2020 2020 2020 2020 656c                el
-0001d6d0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0001d6e0: 2020 2020 2020 2020 2020 2020 7072 6f66              prof
-0001d6f0: 696c 655b 276b 6579 7327 5d2e 6170 7065  ile['keys'].appe
-0001d700: 6e64 2870 7562 6c69 636b 6579 290a 2020  nd(publickey).  
-0001d710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d720: 2020 6966 2027 6669 6c65 7327 2069 6e20    if 'files' in 
-0001d730: 7072 6f66 696c 653a 0a20 2020 2020 2020  profile:.       
-0001d740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d750: 2070 726f 6669 6c65 5b27 6669 6c65 7327   profile['files'
-0001d760: 5d2e 6170 7065 6e64 287b 2770 6174 6827  ].append({'path'
-0001d770: 3a20 272f 726f 6f74 2f2e 7373 682f 6964  : '/root/.ssh/id
-0001d780: 5f72 7361 272c 2027 636f 6e74 656e 7427  _rsa', 'content'
-0001d790: 3a20 7072 6976 6174 656b 6579 7d29 0a20  : privatekey}). 
-0001d7a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d7b0: 2020 2020 2020 2070 726f 6669 6c65 5b27         profile['
-0001d7c0: 6669 6c65 7327 5d2e 6170 7065 6e64 287b  files'].append({
-0001d7d0: 2770 6174 6827 3a20 272f 726f 6f74 2f2e  'path': '/root/.
-0001d7e0: 7373 682f 6964 5f72 7361 2e70 7562 272c  ssh/id_rsa.pub',
-0001d7f0: 2027 636f 6e74 656e 7427 3a20 7075 626c   'content': publ
-0001d800: 6963 6b65 797d 290a 2020 2020 2020 2020  ickey}).        
-0001d810: 2020 2020 2020 2020 2020 2020 656c 7365              else
-0001d820: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001d830: 2020 2020 2020 2020 2020 7072 6f66 696c            profil
-0001d840: 655b 2766 696c 6573 275d 203d 205b 7b27  e['files'] = [{'
-0001d850: 7061 7468 273a 2027 2f72 6f6f 742f 2e73  path': '/root/.s
-0001d860: 7368 2f69 645f 7273 6127 2c20 2763 6f6e  sh/id_rsa', 'con
-0001d870: 7465 6e74 273a 2070 7269 7661 7465 6b65  tent': privateke
-0001d880: 797d 2c0a 2020 2020 2020 2020 2020 2020  y},.            
-0001d890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d590: 2020 2070 7562 6c69 636b 6579 203d 206f     publickey = o
+0001d5a0: 7065 6e28 6622 7b70 6c61 6e7d 2e6b 6579  pen(f"{plan}.key
+0001d5b0: 2e70 7562 2229 2e72 6561 6428 292e 7374  .pub").read().st
+0001d5c0: 7269 7028 290a 2020 2020 2020 2020 2020  rip().          
+0001d5d0: 2020 2020 2020 2020 2020 7072 6976 6174            privat
+0001d5e0: 656b 6579 203d 206f 7065 6e28 6622 7b70  ekey = open(f"{p
+0001d5f0: 6c61 6e7d 2e6b 6579 2229 2e72 6561 6428  lan}.key").read(
+0001d600: 292e 7374 7269 7028 290a 2020 2020 2020  ).strip().      
+0001d610: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0001d620: 2027 6b65 7973 2720 6e6f 7420 696e 2070   'keys' not in p
+0001d630: 726f 6669 6c65 3a0a 2020 2020 2020 2020  rofile:.        
+0001d640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d650: 7072 6f66 696c 655b 276b 6579 7327 5d20  profile['keys'] 
+0001d660: 3d20 5b70 7562 6c69 636b 6579 5d0a 2020  = [publickey].  
+0001d670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d680: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0001d690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d6a0: 7072 6f66 696c 655b 276b 6579 7327 5d2e  profile['keys'].
+0001d6b0: 6170 7065 6e64 2870 7562 6c69 636b 6579  append(publickey
+0001d6c0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001d6d0: 2020 2020 2020 6966 2027 6669 6c65 7327        if 'files'
+0001d6e0: 2069 6e20 7072 6f66 696c 653a 0a20 2020   in profile:.   
+0001d6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d700: 2020 2020 2070 726f 6669 6c65 5b27 6669       profile['fi
+0001d710: 6c65 7327 5d2e 6170 7065 6e64 287b 2770  les'].append({'p
+0001d720: 6174 6827 3a20 272f 726f 6f74 2f2e 7373  ath': '/root/.ss
+0001d730: 682f 6964 5f72 7361 272c 2027 636f 6e74  h/id_rsa', 'cont
+0001d740: 656e 7427 3a20 7072 6976 6174 656b 6579  ent': privatekey
+0001d750: 7d29 0a20 2020 2020 2020 2020 2020 2020  }).             
+0001d760: 2020 2020 2020 2020 2020 2070 726f 6669             profi
+0001d770: 6c65 5b27 6669 6c65 7327 5d2e 6170 7065  le['files'].appe
+0001d780: 6e64 287b 2770 6174 6827 3a20 272f 726f  nd({'path': '/ro
+0001d790: 6f74 2f2e 7373 682f 6964 5f72 7361 2e70  ot/.ssh/id_rsa.p
+0001d7a0: 7562 272c 2027 636f 6e74 656e 7427 3a20  ub', 'content': 
+0001d7b0: 7075 626c 6963 6b65 797d 290a 2020 2020  publickey}).    
+0001d7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d7d0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0001d7e0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+0001d7f0: 6f66 696c 655b 2766 696c 6573 275d 203d  ofile['files'] =
+0001d800: 205b 7b27 7061 7468 273a 2027 2f72 6f6f   [{'path': '/roo
+0001d810: 742f 2e73 7368 2f69 645f 7273 6127 2c20  t/.ssh/id_rsa', 
+0001d820: 2763 6f6e 7465 6e74 273a 2070 7269 7661  'content': priva
+0001d830: 7465 6b65 797d 2c0a 2020 2020 2020 2020  tekey},.        
+0001d840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d860: 2020 2020 7b27 7061 7468 273a 2027 2f72      {'path': '/r
+0001d870: 6f6f 742f 2e73 7368 2f69 645f 7273 612e  oot/.ssh/id_rsa.
+0001d880: 7075 6227 2c20 2763 6f6e 7465 6e74 273a  pub', 'content':
+0001d890: 2070 7562 6c69 636b 6579 7d5d 0a20 2020   publickey}].   
 0001d8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d8b0: 7b27 7061 7468 273a 2027 2f72 6f6f 742f  {'path': '/root/
-0001d8c0: 2e73 7368 2f69 645f 7273 612e 7075 6227  .ssh/id_rsa.pub'
-0001d8d0: 2c20 2763 6f6e 7465 6e74 273a 2070 7562  , 'content': pub
-0001d8e0: 6c69 636b 6579 7d5d 0a20 2020 2020 2020  lickey}].       
-0001d8f0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0001d900: 766d 636f 756e 7465 7220 3e3d 206c 656e  vmcounter >= len
-0001d910: 2876 6d65 6e74 7269 6573 293a 0a20 2020  (vmentries):.   
-0001d920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d930: 2020 2020 206f 732e 7265 6d6f 7665 2866       os.remove(f
-0001d940: 227b 706c 616e 7d2e 6b65 792e 7075 6222  "{plan}.key.pub"
-0001d950: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001d960: 2020 2020 2020 2020 2020 6f73 2e72 656d            os.rem
-0001d970: 6f76 6528 6622 7b70 6c61 6e7d 2e6b 6579  ove(f"{plan}.key
-0001d980: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-0001d990: 2020 2063 7572 7265 6e74 6f76 6572 7269     currentoverri
-0001d9a0: 6465 7320 3d20 6f76 6572 7269 6465 732e  des = overrides.
-0001d9b0: 636f 7079 2829 0a20 2020 2020 2020 2020  copy().         
-0001d9c0: 2020 2020 2020 2069 6620 2769 6d61 6765         if 'image
-0001d9d0: 2720 696e 2070 726f 6669 6c65 3a0a 2020  ' in profile:.  
-0001d9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d9f0: 2020 666f 7220 656e 7472 7920 696e 2073    for entry in s
-0001da00: 656c 662e 6c69 7374 5f70 726f 6669 6c65  elf.list_profile
-0001da10: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
-0001da20: 2020 2020 2020 2020 2020 2020 2063 7572               cur
-0001da30: 7265 6e74 696d 6167 6520 3d20 7072 6f66  rentimage = prof
-0001da40: 696c 655b 2769 6d61 6765 275d 0a20 2020  ile['image'].   
-0001da50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001da60: 2020 2020 2065 6e74 7279 7072 6f66 696c       entryprofil
-0001da70: 6520 3d20 656e 7472 795b 305d 0a20 2020  e = entry[0].   
-0001da80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001da90: 2020 2020 2069 6620 656e 7472 7970 726f       if entrypro
-0001daa0: 6669 6c65 203d 3d20 6375 7272 656e 7469  file == currenti
-0001dab0: 6d61 6765 3a0a 2020 2020 2020 2020 2020  mage:.          
-0001dac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dad0: 2020 7072 6f66 696c 655b 2769 6d61 6765    profile['image
-0001dae0: 275d 203d 2065 6e74 7279 5b34 5d0a 2020  '] = entry[4].  
+0001d8b0: 2069 6620 766d 636f 756e 7465 7220 3e3d   if vmcounter >=
+0001d8c0: 206c 656e 2876 6d65 6e74 7269 6573 293a   len(vmentries):
+0001d8d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001d8e0: 2020 2020 2020 2020 206f 732e 7265 6d6f           os.remo
+0001d8f0: 7665 2866 227b 706c 616e 7d2e 6b65 792e  ve(f"{plan}.key.
+0001d900: 7075 6222 290a 2020 2020 2020 2020 2020  pub").          
+0001d910: 2020 2020 2020 2020 2020 2020 2020 6f73                os
+0001d920: 2e72 656d 6f76 6528 6622 7b70 6c61 6e7d  .remove(f"{plan}
+0001d930: 2e6b 6579 2229 0a20 2020 2020 2020 2020  .key").         
+0001d940: 2020 2020 2020 2063 7572 7265 6e74 6f76         currentov
+0001d950: 6572 7269 6465 7320 3d20 6f76 6572 7269  errides = overri
+0001d960: 6465 732e 636f 7079 2829 0a20 2020 2020  des.copy().     
+0001d970: 2020 2020 2020 2020 2020 2069 6620 2769             if 'i
+0001d980: 6d61 6765 2720 696e 2070 726f 6669 6c65  mage' in profile
+0001d990: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001d9a0: 2020 2020 2020 666f 7220 656e 7472 7920        for entry 
+0001d9b0: 696e 2073 656c 662e 6c69 7374 5f70 726f  in self.list_pro
+0001d9c0: 6669 6c65 7328 293a 0a20 2020 2020 2020  files():.       
+0001d9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d9e0: 2063 7572 7265 6e74 696d 6167 6520 3d20   currentimage = 
+0001d9f0: 7072 6f66 696c 655b 2769 6d61 6765 275d  profile['image']
+0001da00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001da10: 2020 2020 2020 2020 2065 6e74 7279 7072           entrypr
+0001da20: 6f66 696c 6520 3d20 656e 7472 795b 305d  ofile = entry[0]
+0001da30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001da40: 2020 2020 2020 2020 2069 6620 656e 7472           if entr
+0001da50: 7970 726f 6669 6c65 203d 3d20 6375 7272  yprofile == curr
+0001da60: 656e 7469 6d61 6765 3a0a 2020 2020 2020  entimage:.      
+0001da70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001da80: 2020 2020 2020 7072 6f66 696c 655b 2769        profile['i
+0001da90: 6d61 6765 275d 203d 2065 6e74 7279 5b34  mage'] = entry[4
+0001daa0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+0001dab0: 2020 2020 2020 2020 2020 2020 2020 6375                cu
+0001dac0: 7272 656e 746f 7665 7272 6964 6573 5b27  rrentoverrides['
+0001dad0: 696d 6167 6527 5d20 3d20 7072 6f66 696c  image'] = profil
+0001dae0: 655b 2769 6d61 6765 275d 0a20 2020 2020  e['image'].     
 0001daf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001db00: 2020 2020 2020 2020 2020 6375 7272 656e            curren
-0001db10: 746f 7665 7272 6964 6573 5b27 696d 6167  toverrides['imag
-0001db20: 6527 5d20 3d20 7072 6f66 696c 655b 2769  e'] = profile['i
-0001db30: 6d61 6765 275d 0a20 2020 2020 2020 2020  mage'].         
-0001db40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001db50: 2020 2062 7265 616b 0a20 2020 2020 2020     break.       
-0001db60: 2020 2020 2020 2020 2069 6620 7468 7265           if thre
-0001db70: 6164 6564 3a0a 2020 2020 2020 2020 2020  aded:.          
-0001db80: 2020 2020 2020 2020 2020 6e65 775f 6172            new_ar
-0001db90: 6773 203d 2028 6e61 6d65 2c20 7072 6f66  gs = (name, prof
-0001dba0: 696c 656e 616d 652c 2063 7572 7265 6e74  ilename, current
-0001dbb0: 6f76 6572 7269 6465 732c 2070 726f 6669  overrides, profi
-0001dbc0: 6c65 2c20 7a2c 2070 6c61 6e2c 2063 7572  le, z, plan, cur
-0001dbd0: 7265 6e74 706c 616e 6469 722c 2076 6d63  rentplandir, vmc
-0001dbe0: 6c69 656e 742c 0a20 2020 2020 2020 2020  lient,.         
-0001dbf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dc00: 2020 2020 2020 206f 6e66 6c79 2c20 6f6e         onfly, on
-0001dc10: 6c79 6173 7365 7473 2c20 6e65 7776 6d73  lyassets, newvms
-0001dc20: 2c20 6661 696c 6564 766d 732c 2061 7379  , failedvms, asy
-0001dc30: 6e63 7761 6974 766d 732c 206e 6577 6173  ncwaitvms, newas
-0001dc40: 7365 7473 290a 2020 2020 2020 2020 2020  sets).          
-0001dc50: 2020 2020 2020 2020 2020 7420 3d20 7468            t = th
-0001dc60: 7265 6164 696e 672e 5468 7265 6164 2874  reading.Thread(t
-0001dc70: 6172 6765 743d 7365 6c66 2e74 6872 6561  arget=self.threa
-0001dc80: 6465 645f 6372 6561 7465 5f76 6d2c 2061  ded_create_vm, a
-0001dc90: 7267 733d 6e65 775f 6172 6773 290a 2020  rgs=new_args).  
-0001dca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dcb0: 2020 7468 7265 6164 732e 6170 7065 6e64    threads.append
-0001dcc0: 2874 290a 2020 2020 2020 2020 2020 2020  (t).            
-0001dcd0: 2020 2020 2020 2020 742e 7374 6172 7428          t.start(
-0001dce0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001dcf0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0001dd00: 2020 2020 2020 2020 2020 2020 7265 7375              resu
-0001dd10: 6c74 203d 2073 656c 662e 6372 6561 7465  lt = self.create
-0001dd20: 5f76 6d28 6e61 6d65 2c20 7072 6f66 696c  _vm(name, profil
-0001dd30: 656e 616d 652c 206f 7665 7272 6964 6573  ename, overrides
-0001dd40: 3d63 7572 7265 6e74 6f76 6572 7269 6465  =currentoverride
-0001dd50: 732c 2063 7573 746f 6d70 726f 6669 6c65  s, customprofile
-0001dd60: 3d70 726f 6669 6c65 2c20 6b3d 7a2c 0a20  =profile, k=z,. 
-0001dd70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dd80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dd90: 2020 2020 2020 2020 2020 2070 6c61 6e3d             plan=
-0001dda0: 706c 616e 2c20 6261 7365 6469 723d 6375  plan, basedir=cu
-0001ddb0: 7272 656e 7470 6c61 6e64 6972 2c20 636c  rrentplandir, cl
-0001ddc0: 6965 6e74 3d76 6d63 6c69 656e 742c 206f  ient=vmclient, o
-0001ddd0: 6e66 6c79 3d6f 6e66 6c79 2c0a 2020 2020  nfly=onfly,.    
-0001dde0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ddf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001de00: 2020 2020 2020 2020 6f6e 6c79 6173 7365          onlyasse
-0001de10: 7473 3d6f 6e6c 7961 7373 6574 7329 0a20  ts=onlyassets). 
-0001de20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001de30: 2020 2069 6620 6e6f 7420 6f6e 6c79 6173     if not onlyas
-0001de40: 7365 7473 3a0a 2020 2020 2020 2020 2020  sets:.          
-0001de50: 2020 2020 2020 2020 2020 2020 2020 636f                co
-0001de60: 6d6d 6f6e 2e68 616e 646c 655f 7265 7370  mmon.handle_resp
-0001de70: 6f6e 7365 2872 6573 756c 742c 206e 616d  onse(result, nam
-0001de80: 652c 2063 6c69 656e 743d 766d 636c 6965  e, client=vmclie
-0001de90: 6e74 290a 2020 2020 2020 2020 2020 2020  nt).            
-0001dea0: 2020 2020 2020 2020 7365 6c66 2e68 616e          self.han
-0001deb0: 646c 655f 766d 5f72 6573 756c 7428 6e61  dle_vm_result(na
-0001dec0: 6d65 2c20 7072 6f66 696c 652c 2072 6573  me, profile, res
-0001ded0: 756c 743d 7265 7375 6c74 2c20 6e65 7776  ult=result, newv
-0001dee0: 6d73 3d6e 6577 766d 732c 2066 6169 6c65  ms=newvms, faile
-0001def0: 6476 6d73 3d66 6169 6c65 6476 6d73 2c0a  dvms=failedvms,.
-0001df00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001df10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001df20: 2020 2020 2020 2020 2020 6173 796e 6377            asyncw
-0001df30: 6169 7476 6d73 3d61 7379 6e63 7761 6974  aitvms=asyncwait
-0001df40: 766d 732c 206f 6e6c 7961 7373 6574 733d  vms, onlyassets=
-0001df50: 6f6e 6c79 6173 7365 7473 2c20 6e65 7761  onlyassets, newa
-0001df60: 7373 6574 733d 6e65 7761 7373 6574 732c  ssets=newassets,
-0001df70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001df80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001df90: 2020 2020 2020 2020 2020 2076 6d63 6c69             vmcli
-0001dfa0: 656e 743d 766d 636c 6965 6e74 290a 2020  ent=vmclient).  
-0001dfb0: 2020 2020 2020 6966 2076 6d65 6e74 7269        if vmentri
-0001dfc0: 6573 2061 6e64 2074 6872 6561 6465 643a  es and threaded:
-0001dfd0: 0a20 2020 2020 2020 2020 2020 2077 6869  .            whi
-0001dfe0: 6c65 2054 7275 653a 0a20 2020 2020 2020  le True:.       
-0001dff0: 2020 2020 2020 2020 2066 6f72 2069 6e64           for ind
-0001e000: 6578 2c20 7420 696e 2065 6e75 6d65 7261  ex, t in enumera
-0001e010: 7465 2874 6872 6561 6473 293a 0a20 2020  te(threads):.   
-0001e020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e030: 2069 6620 6e6f 7420 742e 6973 5f61 6c69   if not t.is_ali
-0001e040: 7665 2829 3a0a 2020 2020 2020 2020 2020  ve():.          
-0001e050: 2020 2020 2020 2020 2020 2020 2020 6465                de
-0001e060: 6c20 7468 7265 6164 735b 696e 6465 785d  l threads[index]
-0001e070: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001e080: 2069 6620 6e6f 7420 7468 7265 6164 733a   if not threads:
-0001e090: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001e0a0: 2020 2020 2062 7265 616b 0a20 2020 2020       break.     
-0001e0b0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0001e0c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001e0d0: 2020 2020 2073 6c65 6570 2831 290a 2020       sleep(1).  
-0001e0e0: 2020 2020 2020 6966 2076 6d63 6c69 656e        if vmclien
-0001e0f0: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
-0001e100: 7961 6d6c 2e73 6166 655f 6475 6d70 2876  yaml.safe_dump(v
-0001e110: 6d63 6c69 656e 7473 2c20 6f70 656e 286f  mclients, open(o
-0001e120: 732e 7061 7468 2e65 7870 616e 6475 7365  s.path.expanduse
-0001e130: 7228 6627 7e2f 2e6b 636c 692f 766d 636c  r(f'~/.kcli/vmcl
-0001e140: 6965 6e74 735f 7b70 6c61 6e7d 2729 2c20  ients_{plan}'), 
-0001e150: 2777 2729 290a 2020 2020 2020 2020 6966  'w')).        if
-0001e160: 2064 6973 6b65 6e74 7269 6573 2061 6e64   diskentries and
-0001e170: 206e 6f74 206f 6e6c 7961 7373 6574 733a   not onlyassets:
-0001e180: 0a20 2020 2020 2020 2020 2020 2070 7072  .            ppr
-0001e190: 696e 7428 2244 6570 6c6f 7969 6e67 2044  int("Deploying D
-0001e1a0: 6973 6b73 2e2e 2e22 290a 2020 2020 2020  isks...").      
-0001e1b0: 2020 666f 7220 6469 736b 2069 6e20 6469    for disk in di
-0001e1c0: 736b 656e 7472 6965 733a 0a20 2020 2020  skentries:.     
-0001e1d0: 2020 2020 2020 2070 726f 6669 6c65 203d         profile =
-0001e1e0: 2065 6e74 7269 6573 5b64 6973 6b5d 0a20   entries[disk]. 
-0001e1f0: 2020 2020 2020 2020 2020 2070 6f6f 6c20             pool 
-0001e200: 3d20 7072 6f66 696c 652e 6765 7428 2770  = profile.get('p
-0001e210: 6f6f 6c27 290a 2020 2020 2020 2020 2020  ool').          
-0001e220: 2020 766d 7320 3d20 7072 6f66 696c 652e    vms = profile.
-0001e230: 6765 7428 2776 6d73 2729 0a20 2020 2020  get('vms').     
-0001e240: 2020 2020 2020 2074 656d 706c 6174 6520         template 
-0001e250: 3d20 7072 6f66 696c 652e 6765 7428 2774  = profile.get('t
-0001e260: 656d 706c 6174 6527 290a 2020 2020 2020  emplate').      
-0001e270: 2020 2020 2020 696d 6167 6520 3d20 7072        image = pr
-0001e280: 6f66 696c 652e 6765 7428 2769 6d61 6765  ofile.get('image
-0001e290: 272c 2074 656d 706c 6174 6529 0a20 2020  ', template).   
-0001e2a0: 2020 2020 2020 2020 2073 697a 6520 3d20           size = 
-0001e2b0: 696e 7428 7072 6f66 696c 652e 6765 7428  int(profile.get(
-0001e2c0: 2773 697a 6527 2c20 3130 2929 0a20 2020  'size', 10)).   
-0001e2d0: 2020 2020 2020 2020 2069 6620 706f 6f6c           if pool
-0001e2e0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-0001e2f0: 2020 2020 2020 2020 2020 6572 726f 7228            error(
-0001e300: 6622 4d69 7373 696e 6720 4b65 7920 506f  f"Missing Key Po
-0001e310: 6f6c 2066 6f72 2064 6973 6b20 7365 6374  ol for disk sect
-0001e320: 696f 6e20 7b64 6973 6b7d 2e20 4e6f 7420  ion {disk}. Not 
-0001e330: 6372 6561 7469 6e67 2069 742e 2e2e 2229  creating it...")
-0001e340: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001e350: 2063 6f6e 7469 6e75 650a 2020 2020 2020   continue.      
-0001e360: 2020 2020 2020 6966 2076 6d73 2069 7320        if vms is 
-0001e370: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-0001e380: 2020 2020 2020 6572 726f 7228 6622 4d69        error(f"Mi
-0001e390: 7373 696e 6720 6f72 2049 6e63 6f72 7265  ssing or Incorre
-0001e3a0: 6374 204b 6579 2056 6d73 2066 6f72 2064  ct Key Vms for d
-0001e3b0: 6973 6b20 7365 6374 696f 6e20 7b64 6973  isk section {dis
-0001e3c0: 6b7d 2e20 4e6f 7420 6372 6561 7469 6e67  k}. Not creating
-0001e3d0: 2069 742e 2e2e 2229 0a20 2020 2020 2020   it...").       
-0001e3e0: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
-0001e3f0: 650a 2020 2020 2020 2020 2020 2020 7368  e.            sh
-0001e400: 6172 6561 626c 6520 3d20 5472 7565 2069  areable = True i
-0001e410: 6620 6c65 6e28 766d 7329 203e 2031 2065  f len(vms) > 1 e
-0001e420: 6c73 6520 4661 6c73 650a 2020 2020 2020  lse False.      
-0001e430: 2020 2020 2020 6966 206b 2e64 6973 6b5f        if k.disk_
-0001e440: 6578 6973 7473 2870 6f6f 6c2c 2064 6973  exists(pool, dis
-0001e450: 6b29 3a0a 2020 2020 2020 2020 2020 2020  k):.            
-0001e460: 2020 2020 7070 7269 6e74 2866 2243 7265      pprint(f"Cre
-0001e470: 6174 696f 6e20 666f 7220 4469 736b 207b  ation for Disk {
-0001e480: 6469 736b 7d20 736b 6970 7065 6421 2229  disk} skipped!")
-0001e490: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001e4a0: 2070 6f6f 6c70 6174 6820 3d20 6b2e 6765   poolpath = k.ge
-0001e4b0: 745f 706f 6f6c 5f70 6174 6828 706f 6f6c  t_pool_path(pool
-0001e4c0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001e4d0: 2020 6e65 7764 6973 6b20 3d20 6622 7b70    newdisk = f"{p
-0001e4e0: 6f6f 6c70 6174 687d 2f7b 6469 736b 7d22  oolpath}/{disk}"
-0001e4f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001e500: 2066 6f72 2076 6d20 696e 2076 6d73 3a0a   for vm in vms:.
-0001e510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e520: 2020 2020 7070 7269 6e74 2866 2241 6464      pprint(f"Add
-0001e530: 696e 6720 6469 736b 207b 6469 736b 7d20  ing disk {disk} 
-0001e540: 746f 207b 766d 7d22 290a 2020 2020 2020  to {vm}").      
-0001e550: 2020 2020 2020 2020 2020 2020 2020 6b2e                k.
-0001e560: 6164 645f 6469 736b 286e 616d 653d 766d  add_disk(name=vm
-0001e570: 2c20 7369 7a65 3d73 697a 652c 2070 6f6f  , size=size, poo
-0001e580: 6c3d 706f 6f6c 2c20 696d 6167 653d 696d  l=pool, image=im
-0001e590: 6167 652c 2073 6861 7265 6162 6c65 3d73  age, shareable=s
-0001e5a0: 6861 7265 6162 6c65 2c20 6578 6973 7469  hareable, existi
-0001e5b0: 6e67 3d6e 6577 6469 736b 2c0a 2020 2020  ng=newdisk,.    
-0001e5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e5d0: 2020 2020 2020 2020 2020 2074 6869 6e3d             thin=
-0001e5e0: 4661 6c73 6529 0a20 2020 2020 2020 2020  False).         
-0001e5f0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0001e600: 2020 2020 2020 2020 206e 6577 6469 736b           newdisk
-0001e610: 203d 206b 2e63 7265 6174 655f 6469 736b   = k.create_disk
-0001e620: 2864 6973 6b2c 2073 697a 653d 7369 7a65  (disk, size=size
-0001e630: 2c20 706f 6f6c 3d70 6f6f 6c2c 2069 6d61  , pool=pool, ima
-0001e640: 6765 3d69 6d61 6765 2c20 7468 696e 3d46  ge=image, thin=F
-0001e650: 616c 7365 290a 2020 2020 2020 2020 2020  alse).          
-0001e660: 2020 2020 2020 6966 206e 6577 6469 736b        if newdisk
-0001e670: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-0001e680: 2020 2020 2020 2020 2020 2020 2020 6572                er
-0001e690: 726f 7228 6622 4469 736b 207b 6469 736b  ror(f"Disk {disk
-0001e6a0: 7d20 6e6f 7420 6465 706c 6f79 6564 2e20  } not deployed. 
-0001e6b0: 4974 2077 6f6e 2774 2062 6520 6164 6465  It won't be adde
-0001e6c0: 6420 746f 2061 6e79 2076 6d22 290a 2020  d to any vm").  
-0001e6d0: 2020 2020 2020 2020 2020 2020 2020 656c                el
-0001e6e0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0001e6f0: 2020 2020 2020 2020 636f 6d6d 6f6e 2e70          common.p
-0001e700: 7072 696e 7428 6622 4469 736b 207b 6469  print(f"Disk {di
-0001e710: 736b 7d20 6465 706c 6f79 6564 2122 290a  sk} deployed!").
-0001e720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e730: 2020 2020 666f 7220 766d 2069 6e20 766d      for vm in vm
-0001e740: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-0001e750: 2020 2020 2020 2020 2020 2070 7072 696e             pprin
-0001e760: 7428 6622 4164 6469 6e67 2064 6973 6b20  t(f"Adding disk 
-0001e770: 7b64 6973 6b7d 2074 6f20 7b76 6d7d 2229  {disk} to {vm}")
-0001e780: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001e790: 2020 2020 2020 2020 206b 2e61 6464 5f64           k.add_d
-0001e7a0: 6973 6b28 6e61 6d65 3d76 6d2c 2073 697a  isk(name=vm, siz
-0001e7b0: 653d 7369 7a65 2c20 706f 6f6c 3d70 6f6f  e=size, pool=poo
-0001e7c0: 6c2c 2069 6d61 6765 3d69 6d61 6765 2c20  l, image=image, 
-0001e7d0: 7368 6172 6561 626c 653d 7368 6172 6561  shareable=sharea
-0001e7e0: 626c 652c 0a20 2020 2020 2020 2020 2020  ble,.           
-0001e7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e800: 2020 2020 2020 2020 6578 6973 7469 6e67          existing
-0001e810: 3d6e 6577 6469 736b 2c20 7468 696e 3d46  =newdisk, thin=F
-0001e820: 616c 7365 290a 2020 2020 2020 2020 6966  alse).        if
-0001e830: 2063 6f6e 7461 696e 6572 656e 7472 6965   containerentrie
-0001e840: 7320 616e 6420 6e6f 7420 6f6e 6c79 6173  s and not onlyas
-0001e850: 7365 7473 3a0a 2020 2020 2020 2020 2020  sets:.          
-0001e860: 2020 636f 6e74 203d 204b 636f 6e74 6169    cont = Kcontai
-0001e870: 6e65 7263 6f6e 6669 6728 7365 6c66 2c20  nerconfig(self, 
-0001e880: 636c 6965 6e74 3d73 656c 662e 636f 6e74  client=self.cont
-0001e890: 6169 6e65 7263 6c69 656e 7429 2e63 6f6e  ainerclient).con
-0001e8a0: 740a 2020 2020 2020 2020 2020 2020 7070  t.            pp
-0001e8b0: 7269 6e74 2822 4465 706c 6f79 696e 6720  rint("Deploying 
-0001e8c0: 436f 6e74 6169 6e65 7273 2e2e 2e22 290a  Containers...").
-0001e8d0: 2020 2020 2020 2020 2020 2020 6c61 6265              labe
-0001e8e0: 6c20 3d20 6622 706c 616e 3d7b 706c 616e  l = f"plan={plan
-0001e8f0: 7d22 0a20 2020 2020 2020 2020 2020 2066  }".            f
-0001e900: 6f72 2063 6f6e 7461 696e 6572 2069 6e20  or container in 
-0001e910: 636f 6e74 6169 6e65 7265 6e74 7269 6573  containerentries
-0001e920: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001e930: 2020 6966 2063 6f6e 742e 6578 6973 7473    if cont.exists
-0001e940: 5f63 6f6e 7461 696e 6572 2863 6f6e 7461  _container(conta
-0001e950: 696e 6572 293a 0a20 2020 2020 2020 2020  iner):.         
-0001e960: 2020 2020 2020 2020 2020 2070 7072 696e             pprin
-0001e970: 7428 6622 436f 6e74 6169 6e65 7220 7b63  t(f"Container {c
-0001e980: 6f6e 7461 696e 6572 7d20 736b 6970 7065  ontainer} skippe
-0001e990: 6421 2229 0a20 2020 2020 2020 2020 2020  d!").           
-0001e9a0: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
-0001e9b0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-0001e9c0: 2020 7072 6f66 696c 6520 3d20 656e 7472    profile = entr
-0001e9d0: 6965 735b 636f 6e74 6169 6e65 725d 0a20  ies[container]. 
-0001e9e0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0001e9f0: 6620 2770 726f 6669 6c65 2720 696e 2070  f 'profile' in p
-0001ea00: 726f 6669 6c65 2061 6e64 2070 726f 6669  rofile and profi
-0001ea10: 6c65 5b27 7072 6f66 696c 6527 5d20 696e  le['profile'] in
-0001ea20: 2063 6f6e 7461 696e 6572 7072 6f66 696c   containerprofil
-0001ea30: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
-0001ea40: 2020 2020 2020 2020 6375 7374 6f6d 7072          custompr
-0001ea50: 6f66 696c 6520 3d20 636f 6e74 6169 6e65  ofile = containe
-0001ea60: 7270 726f 6669 6c65 735b 7072 6f66 696c  rprofiles[profil
-0001ea70: 655b 2770 726f 6669 6c65 275d 5d0a 2020  e['profile']].  
-0001ea80: 2020 2020 2020 2020 2020 2020 2020 656c                el
-0001ea90: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0001eaa0: 2020 2020 2020 2020 6375 7374 6f6d 7072          custompr
-0001eab0: 6f66 696c 6520 3d20 7b7d 0a20 2020 2020  ofile = {}.     
-0001eac0: 2020 2020 2020 2020 2020 2063 6f6e 7461             conta
-0001ead0: 696e 6572 696d 6167 6520 3d20 6e65 7874  inerimage = next
-0001eae0: 2828 6520 666f 7220 6520 696e 205b 7072  ((e for e in [pr
-0001eaf0: 6f66 696c 652e 6765 7428 2769 6d61 6765  ofile.get('image
-0001eb00: 2729 2c20 7072 6f66 696c 652e 6765 7428  '), profile.get(
-0001eb10: 2769 6d61 6765 2729 2c0a 2020 2020 2020  'image'),.      
+0001db00: 2020 2020 2020 2062 7265 616b 0a20 2020         break.   
+0001db10: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0001db20: 7468 7265 6164 6564 3a0a 2020 2020 2020  threaded:.      
+0001db30: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
+0001db40: 775f 6172 6773 203d 2028 6e61 6d65 2c20  w_args = (name, 
+0001db50: 7072 6f66 696c 656e 616d 652c 2063 7572  profilename, cur
+0001db60: 7265 6e74 6f76 6572 7269 6465 732c 2070  rentoverrides, p
+0001db70: 726f 6669 6c65 2c20 7a2c 2070 6c61 6e2c  rofile, z, plan,
+0001db80: 2063 7572 7265 6e74 706c 616e 6469 722c   currentplandir,
+0001db90: 2076 6d63 6c69 656e 742c 0a20 2020 2020   vmclient,.     
+0001dba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dbb0: 2020 2020 2020 2020 2020 206f 6e66 6c79             onfly
+0001dbc0: 2c20 6f6e 6c79 6173 7365 7473 2c20 6e65  , onlyassets, ne
+0001dbd0: 7776 6d73 2c20 6661 696c 6564 766d 732c  wvms, failedvms,
+0001dbe0: 2061 7379 6e63 7761 6974 766d 732c 206e   asyncwaitvms, n
+0001dbf0: 6577 6173 7365 7473 290a 2020 2020 2020  ewassets).      
+0001dc00: 2020 2020 2020 2020 2020 2020 2020 7420                t 
+0001dc10: 3d20 7468 7265 6164 696e 672e 5468 7265  = threading.Thre
+0001dc20: 6164 2874 6172 6765 743d 7365 6c66 2e74  ad(target=self.t
+0001dc30: 6872 6561 6465 645f 6372 6561 7465 5f76  hreaded_create_v
+0001dc40: 6d2c 2061 7267 733d 6e65 775f 6172 6773  m, args=new_args
+0001dc50: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001dc60: 2020 2020 2020 7468 7265 6164 732e 6170        threads.ap
+0001dc70: 7065 6e64 2874 290a 2020 2020 2020 2020  pend(t).        
+0001dc80: 2020 2020 2020 2020 2020 2020 742e 7374              t.st
+0001dc90: 6172 7428 290a 2020 2020 2020 2020 2020  art().          
+0001dca0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0001dcb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dcc0: 7265 7375 6c74 203d 2073 656c 662e 6372  result = self.cr
+0001dcd0: 6561 7465 5f76 6d28 6e61 6d65 2c20 7072  eate_vm(name, pr
+0001dce0: 6f66 696c 656e 616d 652c 206f 7665 7272  ofilename, overr
+0001dcf0: 6964 6573 3d63 7572 7265 6e74 6f76 6572  ides=currentover
+0001dd00: 7269 6465 732c 2063 7573 746f 6d70 726f  rides, custompro
+0001dd10: 6669 6c65 3d70 726f 6669 6c65 2c20 6b3d  file=profile, k=
+0001dd20: 7a2c 0a20 2020 2020 2020 2020 2020 2020  z,.             
+0001dd30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dd40: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0001dd50: 6c61 6e3d 706c 616e 2c20 6261 7365 6469  lan=plan, basedi
+0001dd60: 723d 6375 7272 656e 7470 6c61 6e64 6972  r=currentplandir
+0001dd70: 2c20 636c 6965 6e74 3d76 6d63 6c69 656e  , client=vmclien
+0001dd80: 742c 206f 6e66 6c79 3d6f 6e66 6c79 2c0a  t, onfly=onfly,.
+0001dd90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ddb0: 2020 2020 2020 2020 2020 2020 6f6e 6c79              only
+0001ddc0: 6173 7365 7473 3d6f 6e6c 7961 7373 6574  assets=onlyasset
+0001ddd0: 7329 0a20 2020 2020 2020 2020 2020 2020  s).             
+0001dde0: 2020 2020 2020 2069 6620 6e6f 7420 6f6e         if not on
+0001ddf0: 6c79 6173 7365 7473 3a0a 2020 2020 2020  lyassets:.      
+0001de00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001de10: 2020 636f 6d6d 6f6e 2e68 616e 646c 655f    common.handle_
+0001de20: 7265 7370 6f6e 7365 2872 6573 756c 742c  response(result,
+0001de30: 206e 616d 652c 2063 6c69 656e 743d 766d   name, client=vm
+0001de40: 636c 6965 6e74 290a 2020 2020 2020 2020  client).        
+0001de50: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0001de60: 2e68 616e 646c 655f 766d 5f72 6573 756c  .handle_vm_resul
+0001de70: 7428 6e61 6d65 2c20 7072 6f66 696c 652c  t(name, profile,
+0001de80: 2072 6573 756c 743d 7265 7375 6c74 2c20   result=result, 
+0001de90: 6e65 7776 6d73 3d6e 6577 766d 732c 2066  newvms=newvms, f
+0001dea0: 6169 6c65 6476 6d73 3d66 6169 6c65 6476  ailedvms=failedv
+0001deb0: 6d73 2c0a 2020 2020 2020 2020 2020 2020  ms,.            
+0001dec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ded0: 2020 2020 2020 2020 2020 2020 2020 6173                as
+0001dee0: 796e 6377 6169 7476 6d73 3d61 7379 6e63  yncwaitvms=async
+0001def0: 7761 6974 766d 732c 206f 6e6c 7961 7373  waitvms, onlyass
+0001df00: 6574 733d 6f6e 6c79 6173 7365 7473 2c20  ets=onlyassets, 
+0001df10: 6e65 7761 7373 6574 733d 6e65 7761 7373  newassets=newass
+0001df20: 6574 732c 0a20 2020 2020 2020 2020 2020  ets,.           
+0001df30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001df40: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+0001df50: 6d63 6c69 656e 743d 766d 636c 6965 6e74  mclient=vmclient
+0001df60: 290a 2020 2020 2020 2020 6966 2076 6d65  ).        if vme
+0001df70: 6e74 7269 6573 2061 6e64 2074 6872 6561  ntries and threa
+0001df80: 6465 643a 0a20 2020 2020 2020 2020 2020  ded:.           
+0001df90: 2077 6869 6c65 2054 7275 653a 0a20 2020   while True:.   
+0001dfa0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+0001dfb0: 2069 6e64 6578 2c20 7420 696e 2065 6e75   index, t in enu
+0001dfc0: 6d65 7261 7465 2874 6872 6561 6473 293a  merate(threads):
+0001dfd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001dfe0: 2020 2020 2069 6620 6e6f 7420 742e 6973       if not t.is
+0001dff0: 5f61 6c69 7665 2829 3a0a 2020 2020 2020  _alive():.      
+0001e000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e010: 2020 6465 6c20 7468 7265 6164 735b 696e    del threads[in
+0001e020: 6465 785d 0a20 2020 2020 2020 2020 2020  dex].           
+0001e030: 2020 2020 2069 6620 6e6f 7420 7468 7265       if not thre
+0001e040: 6164 733a 0a20 2020 2020 2020 2020 2020  ads:.           
+0001e050: 2020 2020 2020 2020 2062 7265 616b 0a20           break. 
+0001e060: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0001e070: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0001e080: 2020 2020 2020 2020 2073 6c65 6570 2831           sleep(1
+0001e090: 290a 2020 2020 2020 2020 6966 2076 6d63  ).        if vmc
+0001e0a0: 6c69 656e 7473 3a0a 2020 2020 2020 2020  lients:.        
+0001e0b0: 2020 2020 7961 6d6c 2e73 6166 655f 6475      yaml.safe_du
+0001e0c0: 6d70 2876 6d63 6c69 656e 7473 2c20 6f70  mp(vmclients, op
+0001e0d0: 656e 286f 732e 7061 7468 2e65 7870 616e  en(os.path.expan
+0001e0e0: 6475 7365 7228 6627 7e2f 2e6b 636c 692f  duser(f'~/.kcli/
+0001e0f0: 766d 636c 6965 6e74 735f 7b70 6c61 6e7d  vmclients_{plan}
+0001e100: 2729 2c20 2777 2729 290a 2020 2020 2020  '), 'w')).      
+0001e110: 2020 6966 2064 6973 6b65 6e74 7269 6573    if diskentries
+0001e120: 2061 6e64 206e 6f74 206f 6e6c 7961 7373   and not onlyass
+0001e130: 6574 733a 0a20 2020 2020 2020 2020 2020  ets:.           
+0001e140: 2070 7072 696e 7428 2244 6570 6c6f 7969   pprint("Deployi
+0001e150: 6e67 2044 6973 6b73 2e2e 2e22 290a 2020  ng Disks...").  
+0001e160: 2020 2020 2020 666f 7220 6469 736b 2069        for disk i
+0001e170: 6e20 6469 736b 656e 7472 6965 733a 0a20  n diskentries:. 
+0001e180: 2020 2020 2020 2020 2020 2070 726f 6669             profi
+0001e190: 6c65 203d 2065 6e74 7269 6573 5b64 6973  le = entries[dis
+0001e1a0: 6b5d 0a20 2020 2020 2020 2020 2020 2070  k].            p
+0001e1b0: 6f6f 6c20 3d20 7072 6f66 696c 652e 6765  ool = profile.ge
+0001e1c0: 7428 2770 6f6f 6c27 290a 2020 2020 2020  t('pool').      
+0001e1d0: 2020 2020 2020 766d 7320 3d20 7072 6f66        vms = prof
+0001e1e0: 696c 652e 6765 7428 2776 6d73 2729 0a20  ile.get('vms'). 
+0001e1f0: 2020 2020 2020 2020 2020 2074 656d 706c             templ
+0001e200: 6174 6520 3d20 7072 6f66 696c 652e 6765  ate = profile.ge
+0001e210: 7428 2774 656d 706c 6174 6527 290a 2020  t('template').  
+0001e220: 2020 2020 2020 2020 2020 696d 6167 6520            image 
+0001e230: 3d20 7072 6f66 696c 652e 6765 7428 2769  = profile.get('i
+0001e240: 6d61 6765 272c 2074 656d 706c 6174 6529  mage', template)
+0001e250: 0a20 2020 2020 2020 2020 2020 2073 697a  .            siz
+0001e260: 6520 3d20 696e 7428 7072 6f66 696c 652e  e = int(profile.
+0001e270: 6765 7428 2773 697a 6527 2c20 3130 2929  get('size', 10))
+0001e280: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0001e290: 706f 6f6c 2069 7320 4e6f 6e65 3a0a 2020  pool is None:.  
+0001e2a0: 2020 2020 2020 2020 2020 2020 2020 6572                er
+0001e2b0: 726f 7228 6622 4d69 7373 696e 6720 4b65  ror(f"Missing Ke
+0001e2c0: 7920 506f 6f6c 2066 6f72 2064 6973 6b20  y Pool for disk 
+0001e2d0: 7365 6374 696f 6e20 7b64 6973 6b7d 2e20  section {disk}. 
+0001e2e0: 4e6f 7420 6372 6561 7469 6e67 2069 742e  Not creating it.
+0001e2f0: 2e2e 2229 0a20 2020 2020 2020 2020 2020  ..").           
+0001e300: 2020 2020 2063 6f6e 7469 6e75 650a 2020       continue.  
+0001e310: 2020 2020 2020 2020 2020 6966 2076 6d73            if vms
+0001e320: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+0001e330: 2020 2020 2020 2020 2020 6572 726f 7228            error(
+0001e340: 6622 4d69 7373 696e 6720 6f72 2049 6e63  f"Missing or Inc
+0001e350: 6f72 7265 6374 204b 6579 2056 6d73 2066  orrect Key Vms f
+0001e360: 6f72 2064 6973 6b20 7365 6374 696f 6e20  or disk section 
+0001e370: 7b64 6973 6b7d 2e20 4e6f 7420 6372 6561  {disk}. Not crea
+0001e380: 7469 6e67 2069 742e 2e2e 2229 0a20 2020  ting it...").   
+0001e390: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+0001e3a0: 7469 6e75 650a 2020 2020 2020 2020 2020  tinue.          
+0001e3b0: 2020 7368 6172 6561 626c 6520 3d20 5472    shareable = Tr
+0001e3c0: 7565 2069 6620 6c65 6e28 766d 7329 203e  ue if len(vms) >
+0001e3d0: 2031 2065 6c73 6520 4661 6c73 650a 2020   1 else False.  
+0001e3e0: 2020 2020 2020 2020 2020 6966 206b 2e64            if k.d
+0001e3f0: 6973 6b5f 6578 6973 7473 2870 6f6f 6c2c  isk_exists(pool,
+0001e400: 2064 6973 6b29 3a0a 2020 2020 2020 2020   disk):.        
+0001e410: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
+0001e420: 2243 7265 6174 696f 6e20 666f 7220 4469  "Creation for Di
+0001e430: 736b 207b 6469 736b 7d20 736b 6970 7065  sk {disk} skippe
+0001e440: 6421 2229 0a20 2020 2020 2020 2020 2020  d!").           
+0001e450: 2020 2020 2070 6f6f 6c70 6174 6820 3d20       poolpath = 
+0001e460: 6b2e 6765 745f 706f 6f6c 5f70 6174 6828  k.get_pool_path(
+0001e470: 706f 6f6c 290a 2020 2020 2020 2020 2020  pool).          
+0001e480: 2020 2020 2020 6e65 7764 6973 6b20 3d20        newdisk = 
+0001e490: 6622 7b70 6f6f 6c70 6174 687d 2f7b 6469  f"{poolpath}/{di
+0001e4a0: 736b 7d22 0a20 2020 2020 2020 2020 2020  sk}".           
+0001e4b0: 2020 2020 2066 6f72 2076 6d20 696e 2076       for vm in v
+0001e4c0: 6d73 3a0a 2020 2020 2020 2020 2020 2020  ms:.            
+0001e4d0: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
+0001e4e0: 2241 6464 696e 6720 6469 736b 207b 6469  "Adding disk {di
+0001e4f0: 736b 7d20 746f 207b 766d 7d22 290a 2020  sk} to {vm}").  
+0001e500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e510: 2020 6b2e 6164 645f 6469 736b 286e 616d    k.add_disk(nam
+0001e520: 653d 766d 2c20 7369 7a65 3d73 697a 652c  e=vm, size=size,
+0001e530: 2070 6f6f 6c3d 706f 6f6c 2c20 696d 6167   pool=pool, imag
+0001e540: 653d 696d 6167 652c 2073 6861 7265 6162  e=image, shareab
+0001e550: 6c65 3d73 6861 7265 6162 6c65 2c20 6578  le=shareable, ex
+0001e560: 6973 7469 6e67 3d6e 6577 6469 736b 2c0a  isting=newdisk,.
+0001e570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e580: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0001e590: 6869 6e3d 4661 6c73 6529 0a20 2020 2020  hin=False).     
+0001e5a0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0001e5b0: 2020 2020 2020 2020 2020 2020 206e 6577               new
+0001e5c0: 6469 736b 203d 206b 2e63 7265 6174 655f  disk = k.create_
+0001e5d0: 6469 736b 2864 6973 6b2c 2073 697a 653d  disk(disk, size=
+0001e5e0: 7369 7a65 2c20 706f 6f6c 3d70 6f6f 6c2c  size, pool=pool,
+0001e5f0: 2069 6d61 6765 3d69 6d61 6765 2c20 7468   image=image, th
+0001e600: 696e 3d46 616c 7365 290a 2020 2020 2020  in=False).      
+0001e610: 2020 2020 2020 2020 2020 6966 206e 6577            if new
+0001e620: 6469 736b 2069 7320 4e6f 6e65 3a0a 2020  disk is None:.  
+0001e630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e640: 2020 6572 726f 7228 6622 4469 736b 207b    error(f"Disk {
+0001e650: 6469 736b 7d20 6e6f 7420 6465 706c 6f79  disk} not deploy
+0001e660: 6564 2e20 4974 2077 6f6e 2774 2062 6520  ed. It won't be 
+0001e670: 6164 6465 6420 746f 2061 6e79 2076 6d22  added to any vm"
+0001e680: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001e690: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0001e6a0: 2020 2020 2020 2020 2020 2020 636f 6d6d              comm
+0001e6b0: 6f6e 2e70 7072 696e 7428 6622 4469 736b  on.pprint(f"Disk
+0001e6c0: 207b 6469 736b 7d20 6465 706c 6f79 6564   {disk} deployed
+0001e6d0: 2122 290a 2020 2020 2020 2020 2020 2020  !").            
+0001e6e0: 2020 2020 2020 2020 666f 7220 766d 2069          for vm i
+0001e6f0: 6e20 766d 733a 0a20 2020 2020 2020 2020  n vms:.         
+0001e700: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0001e710: 7072 696e 7428 6622 4164 6469 6e67 2064  print(f"Adding d
+0001e720: 6973 6b20 7b64 6973 6b7d 2074 6f20 7b76  isk {disk} to {v
+0001e730: 6d7d 2229 0a20 2020 2020 2020 2020 2020  m}").           
+0001e740: 2020 2020 2020 2020 2020 2020 206b 2e61               k.a
+0001e750: 6464 5f64 6973 6b28 6e61 6d65 3d76 6d2c  dd_disk(name=vm,
+0001e760: 2073 697a 653d 7369 7a65 2c20 706f 6f6c   size=size, pool
+0001e770: 3d70 6f6f 6c2c 2069 6d61 6765 3d69 6d61  =pool, image=ima
+0001e780: 6765 2c20 7368 6172 6561 626c 653d 7368  ge, shareable=sh
+0001e790: 6172 6561 626c 652c 0a20 2020 2020 2020  areable,.       
+0001e7a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e7b0: 2020 2020 2020 2020 2020 2020 6578 6973              exis
+0001e7c0: 7469 6e67 3d6e 6577 6469 736b 2c20 7468  ting=newdisk, th
+0001e7d0: 696e 3d46 616c 7365 290a 2020 2020 2020  in=False).      
+0001e7e0: 2020 6966 2063 6f6e 7461 696e 6572 656e    if containeren
+0001e7f0: 7472 6965 7320 616e 6420 6e6f 7420 6f6e  tries and not on
+0001e800: 6c79 6173 7365 7473 3a0a 2020 2020 2020  lyassets:.      
+0001e810: 2020 2020 2020 636f 6e74 203d 204b 636f        cont = Kco
+0001e820: 6e74 6169 6e65 7263 6f6e 6669 6728 7365  ntainerconfig(se
+0001e830: 6c66 2c20 636c 6965 6e74 3d73 656c 662e  lf, client=self.
+0001e840: 636f 6e74 6169 6e65 7263 6c69 656e 7429  containerclient)
+0001e850: 2e63 6f6e 740a 2020 2020 2020 2020 2020  .cont.          
+0001e860: 2020 7070 7269 6e74 2822 4465 706c 6f79    pprint("Deploy
+0001e870: 696e 6720 436f 6e74 6169 6e65 7273 2e2e  ing Containers..
+0001e880: 2e22 290a 2020 2020 2020 2020 2020 2020  .").            
+0001e890: 6c61 6265 6c20 3d20 6622 706c 616e 3d7b  label = f"plan={
+0001e8a0: 706c 616e 7d22 0a20 2020 2020 2020 2020  plan}".         
+0001e8b0: 2020 2066 6f72 2063 6f6e 7461 696e 6572     for container
+0001e8c0: 2069 6e20 636f 6e74 6169 6e65 7265 6e74   in containerent
+0001e8d0: 7269 6573 3a0a 2020 2020 2020 2020 2020  ries:.          
+0001e8e0: 2020 2020 2020 6966 2063 6f6e 742e 6578        if cont.ex
+0001e8f0: 6973 7473 5f63 6f6e 7461 696e 6572 2863  ists_container(c
+0001e900: 6f6e 7461 696e 6572 293a 0a20 2020 2020  ontainer):.     
+0001e910: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0001e920: 7072 696e 7428 6622 436f 6e74 6169 6e65  print(f"Containe
+0001e930: 7220 7b63 6f6e 7461 696e 6572 7d20 736b  r {container} sk
+0001e940: 6970 7065 6421 2229 0a20 2020 2020 2020  ipped!").       
+0001e950: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+0001e960: 7469 6e75 650a 2020 2020 2020 2020 2020  tinue.          
+0001e970: 2020 2020 2020 7072 6f66 696c 6520 3d20        profile = 
+0001e980: 656e 7472 6965 735b 636f 6e74 6169 6e65  entries[containe
+0001e990: 725d 0a20 2020 2020 2020 2020 2020 2020  r].             
+0001e9a0: 2020 2069 6620 2770 726f 6669 6c65 2720     if 'profile' 
+0001e9b0: 696e 2070 726f 6669 6c65 2061 6e64 2070  in profile and p
+0001e9c0: 726f 6669 6c65 5b27 7072 6f66 696c 6527  rofile['profile'
+0001e9d0: 5d20 696e 2063 6f6e 7461 696e 6572 7072  ] in containerpr
+0001e9e0: 6f66 696c 6573 3a0a 2020 2020 2020 2020  ofiles:.        
+0001e9f0: 2020 2020 2020 2020 2020 2020 6375 7374              cust
+0001ea00: 6f6d 7072 6f66 696c 6520 3d20 636f 6e74  omprofile = cont
+0001ea10: 6169 6e65 7270 726f 6669 6c65 735b 7072  ainerprofiles[pr
+0001ea20: 6f66 696c 655b 2770 726f 6669 6c65 275d  ofile['profile']
+0001ea30: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+0001ea40: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0001ea50: 2020 2020 2020 2020 2020 2020 6375 7374              cust
+0001ea60: 6f6d 7072 6f66 696c 6520 3d20 7b7d 0a20  omprofile = {}. 
+0001ea70: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0001ea80: 6f6e 7461 696e 6572 696d 6167 6520 3d20  ontainerimage = 
+0001ea90: 6e65 7874 2828 6520 666f 7220 6520 696e  next((e for e in
+0001eaa0: 205b 7072 6f66 696c 652e 6765 7428 2769   [profile.get('i
+0001eab0: 6d61 6765 2729 2c20 7072 6f66 696c 652e  mage'), profile.
+0001eac0: 6765 7428 2769 6d61 6765 2729 2c0a 2020  get('image'),.  
+0001ead0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001eae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001eaf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001eb00: 2063 7573 746f 6d70 726f 6669 6c65 2e67   customprofile.g
+0001eb10: 6574 2827 696d 6167 6527 292c 0a20 2020  et('image'),.   
 0001eb20: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001eb30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001eb40: 2020 2020 2020 2020 2020 2020 2063 7573               cus
-0001eb50: 746f 6d70 726f 6669 6c65 2e67 6574 2827  tomprofile.get('
-0001eb60: 696d 6167 6527 292c 0a20 2020 2020 2020  image'),.       
-0001eb70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001eb80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001eb90: 2020 2020 2020 2020 2020 2020 6375 7374              cust
-0001eba0: 6f6d 7072 6f66 696c 652e 6765 7428 2769  omprofile.get('i
-0001ebb0: 6d61 6765 2729 5d20 6966 2065 2069 7320  mage')] if e is 
-0001ebc0: 6e6f 7420 4e6f 6e65 292c 204e 6f6e 6529  not None), None)
-0001ebd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001ebe0: 206e 6574 7320 3d20 6e65 7874 2828 6520   nets = next((e 
-0001ebf0: 666f 7220 6520 696e 205b 7072 6f66 696c  for e in [profil
-0001ec00: 652e 6765 7428 276e 6574 7327 292c 2063  e.get('nets'), c
-0001ec10: 7573 746f 6d70 726f 6669 6c65 2e67 6574  ustomprofile.get
-0001ec20: 2827 6e65 7473 2729 5d20 6966 2065 2069  ('nets')] if e i
-0001ec30: 7320 6e6f 7420 4e6f 6e65 292c 204e 6f6e  s not None), Non
-0001ec40: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-0001ec50: 2020 2070 6f72 7473 203d 206e 6578 7428     ports = next(
-0001ec60: 2865 2066 6f72 2065 2069 6e20 5b70 726f  (e for e in [pro
-0001ec70: 6669 6c65 2e67 6574 2827 706f 7274 7327  file.get('ports'
-0001ec80: 292c 2063 7573 746f 6d70 726f 6669 6c65  ), customprofile
-0001ec90: 2e67 6574 2827 706f 7274 7327 295d 2069  .get('ports')] i
-0001eca0: 6620 6520 6973 206e 6f74 204e 6f6e 6529  f e is not None)
-0001ecb0: 2c20 4e6f 6e65 290a 2020 2020 2020 2020  , None).        
-0001ecc0: 2020 2020 2020 2020 766f 6c75 6d65 7320          volumes 
-0001ecd0: 3d20 6e65 7874 2828 6520 666f 7220 6520  = next((e for e 
-0001ece0: 696e 205b 7072 6f66 696c 652e 6765 7428  in [profile.get(
-0001ecf0: 2776 6f6c 756d 6573 2729 2c20 7072 6f66  'volumes'), prof
-0001ed00: 696c 652e 6765 7428 2764 6973 6b73 2729  ile.get('disks')
-0001ed10: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001ed20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ed30: 2020 2020 2020 2020 2020 2020 2020 6375                cu
-0001ed40: 7374 6f6d 7072 6f66 696c 652e 6765 7428  stomprofile.get(
-0001ed50: 2776 6f6c 756d 6573 2729 2c20 6375 7374  'volumes'), cust
-0001ed60: 6f6d 7072 6f66 696c 652e 6765 7428 2764  omprofile.get('d
-0001ed70: 6973 6b73 2729 5d0a 2020 2020 2020 2020  isks')].        
-0001ed80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ed90: 2020 2020 2020 2020 6966 2065 2069 7320          if e is 
-0001eda0: 6e6f 7420 4e6f 6e65 292c 204e 6f6e 6529  not None), None)
-0001edb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001edc0: 2065 6e76 6972 6f6e 6d65 6e74 203d 206e   environment = n
-0001edd0: 6578 7428 2865 2066 6f72 2065 2069 6e20  ext((e for e in 
-0001ede0: 5b70 726f 6669 6c65 2e67 6574 2827 656e  [profile.get('en
-0001edf0: 7669 726f 6e6d 656e 7427 292c 2063 7573  vironment'), cus
-0001ee00: 746f 6d70 726f 6669 6c65 2e67 6574 2827  tomprofile.get('
-0001ee10: 656e 7669 726f 6e6d 656e 7427 295d 0a20  environment')]. 
-0001ee20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ee30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ee40: 2020 2069 6620 6520 6973 206e 6f74 204e     if e is not N
-0001ee50: 6f6e 6529 2c20 4e6f 6e65 290a 2020 2020  one), None).    
-0001ee60: 2020 2020 2020 2020 2020 2020 636d 6473              cmds
-0001ee70: 203d 206e 6578 7428 2865 2066 6f72 2065   = next((e for e
-0001ee80: 2069 6e20 5b70 726f 6669 6c65 2e67 6574   in [profile.get
-0001ee90: 2827 636d 6473 2729 2c20 6375 7374 6f6d  ('cmds'), custom
-0001eea0: 7072 6f66 696c 652e 6765 7428 2763 6d64  profile.get('cmd
-0001eeb0: 7327 295d 2069 6620 6520 6973 206e 6f74  s')] if e is not
-0001eec0: 204e 6f6e 6529 2c20 5b5d 290a 2020 2020   None), []).    
-0001eed0: 2020 2020 2020 2020 2020 2020 7375 6363              succ
-0001eee0: 6573 7328 6622 436f 6e74 6169 6e65 7220  ess(f"Container 
-0001eef0: 7b63 6f6e 7461 696e 6572 7dc2 a064 6570  {container}..dep
-0001ef00: 6c6f 7965 6421 2229 0a20 2020 2020 2020  loyed!").       
-0001ef10: 2020 2020 2020 2020 2063 6f6e 742e 6372           cont.cr
-0001ef20: 6561 7465 5f63 6f6e 7461 696e 6572 286e  eate_container(n
-0001ef30: 616d 653d 636f 6e74 6169 6e65 722c 2069  ame=container, i
-0001ef40: 6d61 6765 3d63 6f6e 7461 696e 6572 696d  mage=containerim
-0001ef50: 6167 652c 206e 6574 733d 6e65 7473 2c20  age, nets=nets, 
-0001ef60: 636d 6473 3d63 6d64 732c 2070 6f72 7473  cmds=cmds, ports
-0001ef70: 3d70 6f72 7473 2c0a 2020 2020 2020 2020  =ports,.        
-0001ef80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ef90: 2020 2020 2020 2020 2020 2020 2020 766f                vo
-0001efa0: 6c75 6d65 733d 766f 6c75 6d65 732c 2065  lumes=volumes, e
-0001efb0: 6e76 6972 6f6e 6d65 6e74 3d65 6e76 6972  nvironment=envir
-0001efc0: 6f6e 6d65 6e74 2c20 6c61 6265 6c3d 6c61  onment, label=la
-0001efd0: 6265 6c29 0a20 2020 2020 2020 2069 6620  bel).        if 
-0001efe0: 646e 7365 6e74 7269 6573 2061 6e64 206e  dnsentries and n
-0001eff0: 6f74 206f 6e6c 7961 7373 6574 733a 0a20  ot onlyassets:. 
-0001f000: 2020 2020 2020 2020 2020 2070 7072 696e             pprin
-0001f010: 7428 2244 6570 6c6f 7969 6e67 2044 6e73  t("Deploying Dns
-0001f020: 2045 6e74 7269 6573 2e2e 2e22 290a 2020   Entries...").  
-0001f030: 2020 2020 2020 2020 2020 646e 7363 6c69            dnscli
-0001f040: 656e 7473 203d 207b 7d0a 2020 2020 2020  ents = {}.      
-0001f050: 2020 2020 2020 666f 7220 646e 7365 6e74        for dnsent
-0001f060: 7279 2069 6e20 646e 7365 6e74 7269 6573  ry in dnsentries
-0001f070: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001f080: 2020 646e 7370 726f 6669 6c65 203d 2065    dnsprofile = e
-0001f090: 6e74 7269 6573 5b64 6e73 656e 7472 795d  ntries[dnsentry]
-0001f0a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001f0b0: 2064 6e73 646f 6d61 696e 203d 2064 6e73   dnsdomain = dns
-0001f0c0: 7072 6f66 696c 652e 6765 7428 2764 6f6d  profile.get('dom
-0001f0d0: 6169 6e27 290a 2020 2020 2020 2020 2020  ain').          
-0001f0e0: 2020 2020 2020 646e 736e 6574 203d 2064        dnsnet = d
-0001f0f0: 6e73 7072 6f66 696c 652e 6765 7428 276e  nsprofile.get('n
-0001f100: 6574 272c 2027 6465 6661 756c 7427 290a  et', 'default').
-0001f110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f120: 646e 7369 7020 3d20 646e 7370 726f 6669  dnsip = dnsprofi
-0001f130: 6c65 2e67 6574 2827 6970 2729 0a20 2020  le.get('ip').   
-0001f140: 2020 2020 2020 2020 2020 2020 2064 6e73               dns
-0001f150: 616c 6961 7320 3d20 646e 7370 726f 6669  alias = dnsprofi
-0001f160: 6c65 2e67 6574 2827 616c 6961 7327 2c20  le.get('alias', 
-0001f170: 5b5d 290a 2020 2020 2020 2020 2020 2020  []).            
-0001f180: 2020 2020 646e 7363 6c69 656e 7420 3d20      dnsclient = 
-0001f190: 646e 7370 726f 6669 6c65 2e67 6574 2827  dnsprofile.get('
-0001f1a0: 636c 6965 6e74 2729 0a20 2020 2020 2020  client').       
-0001f1b0: 2020 2020 2020 2020 2069 6620 646e 7363           if dnsc
-0001f1c0: 6c69 656e 7420 6973 204e 6f6e 653a 0a20  lient is None:. 
-0001f1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f1e0: 2020 207a 203d 206b 0a20 2020 2020 2020     z = k.       
-0001f1f0: 2020 2020 2020 2020 2065 6c69 6620 646e           elif dn
-0001f200: 7363 6c69 656e 7420 696e 2064 6e73 636c  sclient in dnscl
-0001f210: 6965 6e74 733a 0a20 2020 2020 2020 2020  ients:.         
-0001f220: 2020 2020 2020 2020 2020 207a 203d 2064             z = d
-0001f230: 6e73 636c 6965 6e74 735b 646e 7363 6c69  nsclients[dnscli
-0001f240: 656e 745d 0a20 2020 2020 2020 2020 2020  ent].           
-0001f250: 2020 2020 2065 6c69 6620 646e 7363 6c69       elif dnscli
-0001f260: 656e 7420 696e 2073 656c 662e 636c 6965  ent in self.clie
-0001f270: 6e74 733a 0a20 2020 2020 2020 2020 2020  nts:.           
-0001f280: 2020 2020 2020 2020 207a 203d 204b 636f           z = Kco
-0001f290: 6e66 6967 2863 6c69 656e 743d 646e 7363  nfig(client=dnsc
-0001f2a0: 6c69 656e 7429 2e6b 0a20 2020 2020 2020  lient).k.       
-0001f2b0: 2020 2020 2020 2020 2020 2020 2064 6e73               dns
-0001f2c0: 636c 6965 6e74 735b 646e 7363 6c69 656e  clients[dnsclien
-0001f2d0: 745d 203d 207a 0a20 2020 2020 2020 2020  t] = z.         
-0001f2e0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0001f2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f300: 2077 6172 6e69 6e67 2866 2243 6c69 656e   warning(f"Clien
-0001f310: 7420 7b64 6e73 636c 6965 6e74 7d20 6e6f  t {dnsclient} no
-0001f320: 7420 666f 756e 642e 2053 6b69 7070 696e  t found. Skippin
-0001f330: 6722 290a 2020 2020 2020 2020 2020 2020  g").            
-0001f340: 2020 2020 2020 2020 7265 7475 726e 0a20          return. 
-0001f350: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0001f360: 6620 646e 7369 7020 6973 204e 6f6e 653a  f dnsip is None:
-0001f370: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001f380: 2020 2020 2077 6172 6e69 6e67 2822 4d69       warning("Mi
-0001f390: 7373 696e 6720 6970 2e20 536b 6970 7069  ssing ip. Skippi
-0001f3a0: 6e67 2122 290a 2020 2020 2020 2020 2020  ng!").          
-0001f3b0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0001f3c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001f3d0: 2069 6620 646e 736e 6574 2069 7320 4e6f   if dnsnet is No
-0001f3e0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-0001f3f0: 2020 2020 2020 2020 7761 726e 696e 6728          warning(
-0001f400: 224d 6973 7369 6e67 206e 6574 2e20 536b  "Missing net. Sk
-0001f410: 6970 7069 6e67 2122 290a 2020 2020 2020  ipping!").      
-0001f420: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0001f430: 7475 726e 0a20 2020 2020 2020 2020 2020  turn.           
-0001f440: 2020 2020 207a 2e72 6573 6572 7665 5f64       z.reserve_d
-0001f450: 6e73 286e 616d 653d 646e 7365 6e74 7279  ns(name=dnsentry
-0001f460: 2c20 6e65 7473 3d5b 646e 736e 6574 5d2c  , nets=[dnsnet],
-0001f470: 2064 6f6d 6169 6e3d 646e 7364 6f6d 6169   domain=dnsdomai
-0001f480: 6e2c 2069 703d 646e 7369 702c 2061 6c69  n, ip=dnsip, ali
-0001f490: 6173 3d64 6e73 616c 6961 732c 2066 6f72  as=dnsalias, for
-0001f4a0: 6365 3d54 7275 652c 0a20 2020 2020 2020  ce=True,.       
-0001f4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f4c0: 2020 2020 2020 2070 7269 6d61 7279 3d54         primary=T
-0001f4d0: 7275 6529 0a20 2020 2020 2020 2069 6620  rue).        if 
-0001f4e0: 616e 7369 626c 6565 6e74 7269 6573 2061  ansibleentries a
-0001f4f0: 6e64 206e 6f74 206f 6e6c 7961 7373 6574  nd not onlyasset
-0001f500: 733a 0a20 2020 2020 2020 2020 2020 2069  s:.            i
-0001f510: 6620 6e6f 7420 6e65 7776 6d73 3a0a 2020  f not newvms:.  
-0001f520: 2020 2020 2020 2020 2020 2020 2020 7761                wa
-0001f530: 726e 696e 6728 2241 6e73 6962 6c65 2073  rning("Ansible s
-0001f540: 6b69 7070 6564 2061 7320 6e6f 206e 6577  kipped as no new
-0001f550: 2076 6d20 7769 7468 696e 2070 6c61 7962   vm within playb
-0001f560: 6f6f 6b20 7072 6f76 6973 696f 6e65 6422  ook provisioned"
-0001f570: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001f580: 2020 7265 7475 726e 0a20 2020 2020 2020    return.       
-0001f590: 2020 2020 2066 6f72 2065 6e74 7279 2069       for entry i
-0001f5a0: 6e20 736f 7274 6564 2861 6e73 6962 6c65  n sorted(ansible
-0001f5b0: 656e 7472 6965 7329 3a0a 2020 2020 2020  entries):.      
-0001f5c0: 2020 2020 2020 2020 2020 5f61 6e73 6962            _ansib
-0001f5d0: 6c65 203d 2065 6e74 7269 6573 5b65 6e74  le = entries[ent
-0001f5e0: 7279 5d0a 2020 2020 2020 2020 2020 2020  ry].            
-0001f5f0: 2020 2020 6966 2027 706c 6179 626f 6f6b      if 'playbook
-0001f600: 2720 6e6f 7420 696e 205f 616e 7369 626c  ' not in _ansibl
-0001f610: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0001f620: 2020 2020 2020 2065 7272 6f72 2822 4d69         error("Mi
-0001f630: 7373 696e 6720 506c 6179 626f 6f6b 2066  ssing Playbook f
-0001f640: 6f72 2061 6e73 6962 6c65 2e49 676e 6f72  or ansible.Ignor
-0001f650: 696e 672e 2e2e 2229 0a20 2020 2020 2020  ing...").       
-0001f660: 2020 2020 2020 2020 2020 2020 2073 7973               sys
-0001f670: 2e65 7869 7428 3129 0a20 2020 2020 2020  .exit(1).       
-0001f680: 2020 2020 2020 2020 2070 6c61 7962 6f6f           playboo
-0001f690: 6b20 3d20 5f61 6e73 6962 6c65 5b27 706c  k = _ansible['pl
-0001f6a0: 6179 626f 6f6b 275d 0a20 2020 2020 2020  aybook'].       
-0001f6b0: 2020 2020 2020 2020 2076 6572 626f 7365           verbose
-0001f6c0: 203d 205f 616e 7369 626c 655b 2776 6572   = _ansible['ver
-0001f6d0: 626f 7365 275d 2069 6620 2776 6572 626f  bose'] if 'verbo
-0001f6e0: 7365 2720 696e 205f 616e 7369 626c 6520  se' in _ansible 
-0001f6f0: 656c 7365 2046 616c 7365 0a20 2020 2020  else False.     
-0001f700: 2020 2020 2020 2020 2020 2067 726f 7570             group
-0001f710: 7320 3d20 5f61 6e73 6962 6c65 2e67 6574  s = _ansible.get
-0001f720: 2827 6772 6f75 7073 272c 207b 7d29 0a20  ('groups', {}). 
-0001f730: 2020 2020 2020 2020 2020 2020 2020 2075                 u
-0001f740: 7365 7220 3d20 5f61 6e73 6962 6c65 2e67  ser = _ansible.g
-0001f750: 6574 2827 7573 6572 2729 0a20 2020 2020  et('user').     
-0001f760: 2020 2020 2020 2020 2020 2076 6172 6961             varia
-0001f770: 626c 6573 203d 205f 616e 7369 626c 652e  bles = _ansible.
-0001f780: 6765 7428 2776 6172 6961 626c 6573 272c  get('variables',
-0001f790: 207b 7d29 0a20 2020 2020 2020 2020 2020   {}).           
-0001f7a0: 2020 2020 2074 6172 6765 7476 6d73 203d       targetvms =
-0001f7b0: 205b 766d 2066 6f72 2076 6d20 696e 205f   [vm for vm in _
-0001f7c0: 616e 7369 626c 655b 2776 6d73 275d 2069  ansible['vms'] i
-0001f7d0: 6620 766d 2069 6e20 6e65 7776 6d73 5d20  f vm in newvms] 
-0001f7e0: 6966 2027 766d 7327 2069 6e20 5f61 6e73  if 'vms' in _ans
-0001f7f0: 6962 6c65 2065 6c73 6520 6e65 7776 6d73  ible else newvms
-0001f800: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001f810: 2069 6620 6e6f 7420 7461 7267 6574 766d   if not targetvm
-0001f820: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-0001f830: 2020 2020 2020 2077 6172 6e69 6e67 2822         warning("
-0001f840: 416e 7369 626c 6520 736b 6970 7065 6420  Ansible skipped 
-0001f850: 6173 206e 6f20 6e65 7720 766d 2077 6974  as no new vm wit
-0001f860: 6869 6e20 706c 6179 626f 6f6b 2070 726f  hin playbook pro
-0001f870: 7669 7369 6f6e 6564 2229 0a20 2020 2020  visioned").     
-0001f880: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0001f890: 6574 7572 6e0a 2020 2020 2020 2020 2020  eturn.          
-0001f8a0: 2020 2020 2020 616e 7369 626c 6563 6f6d        ansiblecom
-0001f8b0: 6d61 6e64 203d 2022 616e 7369 626c 652d  mand = "ansible-
-0001f8c0: 706c 6179 626f 6f6b 220a 2020 2020 2020  playbook".      
-0001f8d0: 2020 2020 2020 2020 2020 6966 2076 6572            if ver
-0001f8e0: 626f 7365 3a0a 2020 2020 2020 2020 2020  bose:.          
-0001f8f0: 2020 2020 2020 2020 2020 616e 7369 626c            ansibl
-0001f900: 6563 6f6d 6d61 6e64 202b 3d20 2220 2d76  ecommand += " -v
-0001f910: 7676 220a 2020 2020 2020 2020 2020 2020  vv".            
-0001f920: 2020 2020 696e 7665 6e74 6f72 7966 696c      inventoryfil
-0001f930: 6520 3d20 6622 2f74 6d70 2f7b 706c 616e  e = f"/tmp/{plan
-0001f940: 7d2e 696e 762e 7961 6d6c 2220 6966 2073  }.inv.yaml" if s
-0001f950: 656c 662e 7961 6d6c 696e 7665 6e74 6f72  elf.yamlinventor
-0001f960: 7920 656c 7365 2066 222f 746d 702f 7b70  y else f"/tmp/{p
-0001f970: 6c61 6e7d 2e69 6e76 220a 2020 2020 2020  lan}.inv".      
-0001f980: 2020 2020 2020 2020 2020 616e 7369 626c            ansibl
-0001f990: 6575 7469 6c73 2e6d 616b 655f 706c 616e  eutils.make_plan
-0001f9a0: 5f69 6e76 656e 746f 7279 2876 6d73 5f74  _inventory(vms_t
-0001f9b0: 6f5f 686f 7374 2c20 706c 616e 2c20 7461  o_host, plan, ta
-0001f9c0: 7267 6574 766d 732c 2067 726f 7570 733d  rgetvms, groups=
-0001f9d0: 6772 6f75 7073 2c20 7573 6572 3d75 7365  groups, user=use
-0001f9e0: 722c 0a20 2020 2020 2020 2020 2020 2020  r,.             
-0001f9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001eb40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001eb50: 6375 7374 6f6d 7072 6f66 696c 652e 6765  customprofile.ge
+0001eb60: 7428 2769 6d61 6765 2729 5d20 6966 2065  t('image')] if e
+0001eb70: 2069 7320 6e6f 7420 4e6f 6e65 292c 204e   is not None), N
+0001eb80: 6f6e 6529 0a20 2020 2020 2020 2020 2020  one).           
+0001eb90: 2020 2020 206e 6574 7320 3d20 6e65 7874       nets = next
+0001eba0: 2828 6520 666f 7220 6520 696e 205b 7072  ((e for e in [pr
+0001ebb0: 6f66 696c 652e 6765 7428 276e 6574 7327  ofile.get('nets'
+0001ebc0: 292c 2063 7573 746f 6d70 726f 6669 6c65  ), customprofile
+0001ebd0: 2e67 6574 2827 6e65 7473 2729 5d20 6966  .get('nets')] if
+0001ebe0: 2065 2069 7320 6e6f 7420 4e6f 6e65 292c   e is not None),
+0001ebf0: 204e 6f6e 6529 0a20 2020 2020 2020 2020   None).         
+0001ec00: 2020 2020 2020 2070 6f72 7473 203d 206e         ports = n
+0001ec10: 6578 7428 2865 2066 6f72 2065 2069 6e20  ext((e for e in 
+0001ec20: 5b70 726f 6669 6c65 2e67 6574 2827 706f  [profile.get('po
+0001ec30: 7274 7327 292c 2063 7573 746f 6d70 726f  rts'), custompro
+0001ec40: 6669 6c65 2e67 6574 2827 706f 7274 7327  file.get('ports'
+0001ec50: 295d 2069 6620 6520 6973 206e 6f74 204e  )] if e is not N
+0001ec60: 6f6e 6529 2c20 4e6f 6e65 290a 2020 2020  one), None).    
+0001ec70: 2020 2020 2020 2020 2020 2020 766f 6c75              volu
+0001ec80: 6d65 7320 3d20 6e65 7874 2828 6520 666f  mes = next((e fo
+0001ec90: 7220 6520 696e 205b 7072 6f66 696c 652e  r e in [profile.
+0001eca0: 6765 7428 2776 6f6c 756d 6573 2729 2c20  get('volumes'), 
+0001ecb0: 7072 6f66 696c 652e 6765 7428 2764 6973  profile.get('dis
+0001ecc0: 6b73 2729 2c0a 2020 2020 2020 2020 2020  ks'),.          
+0001ecd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ece0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ecf0: 2020 6375 7374 6f6d 7072 6f66 696c 652e    customprofile.
+0001ed00: 6765 7428 2776 6f6c 756d 6573 2729 2c20  get('volumes'), 
+0001ed10: 6375 7374 6f6d 7072 6f66 696c 652e 6765  customprofile.ge
+0001ed20: 7428 2764 6973 6b73 2729 5d0a 2020 2020  t('disks')].    
+0001ed30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ed40: 2020 2020 2020 2020 2020 2020 6966 2065              if e
+0001ed50: 2069 7320 6e6f 7420 4e6f 6e65 292c 204e   is not None), N
+0001ed60: 6f6e 6529 0a20 2020 2020 2020 2020 2020  one).           
+0001ed70: 2020 2020 2065 6e76 6972 6f6e 6d65 6e74       environment
+0001ed80: 203d 206e 6578 7428 2865 2066 6f72 2065   = next((e for e
+0001ed90: 2069 6e20 5b70 726f 6669 6c65 2e67 6574   in [profile.get
+0001eda0: 2827 656e 7669 726f 6e6d 656e 7427 292c  ('environment'),
+0001edb0: 2063 7573 746f 6d70 726f 6669 6c65 2e67   customprofile.g
+0001edc0: 6574 2827 656e 7669 726f 6e6d 656e 7427  et('environment'
+0001edd0: 295d 0a20 2020 2020 2020 2020 2020 2020  )].             
+0001ede0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001edf0: 2020 2020 2020 2069 6620 6520 6973 206e         if e is n
+0001ee00: 6f74 204e 6f6e 6529 2c20 4e6f 6e65 290a  ot None), None).
+0001ee10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ee20: 636d 6473 203d 206e 6578 7428 2865 2066  cmds = next((e f
+0001ee30: 6f72 2065 2069 6e20 5b70 726f 6669 6c65  or e in [profile
+0001ee40: 2e67 6574 2827 636d 6473 2729 2c20 6375  .get('cmds'), cu
+0001ee50: 7374 6f6d 7072 6f66 696c 652e 6765 7428  stomprofile.get(
+0001ee60: 2763 6d64 7327 295d 2069 6620 6520 6973  'cmds')] if e is
+0001ee70: 206e 6f74 204e 6f6e 6529 2c20 5b5d 290a   not None), []).
+0001ee80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ee90: 7375 6363 6573 7328 6622 436f 6e74 6169  success(f"Contai
+0001eea0: 6e65 7220 7b63 6f6e 7461 696e 6572 7dc2  ner {container}.
+0001eeb0: a064 6570 6c6f 7965 6421 2229 0a20 2020  .deployed!").   
+0001eec0: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+0001eed0: 742e 6372 6561 7465 5f63 6f6e 7461 696e  t.create_contain
+0001eee0: 6572 286e 616d 653d 636f 6e74 6169 6e65  er(name=containe
+0001eef0: 722c 2069 6d61 6765 3d63 6f6e 7461 696e  r, image=contain
+0001ef00: 6572 696d 6167 652c 206e 6574 733d 6e65  erimage, nets=ne
+0001ef10: 7473 2c20 636d 6473 3d63 6d64 732c 2070  ts, cmds=cmds, p
+0001ef20: 6f72 7473 3d70 6f72 7473 2c0a 2020 2020  orts=ports,.    
+0001ef30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ef40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ef50: 2020 766f 6c75 6d65 733d 766f 6c75 6d65    volumes=volume
+0001ef60: 732c 2065 6e76 6972 6f6e 6d65 6e74 3d65  s, environment=e
+0001ef70: 6e76 6972 6f6e 6d65 6e74 2c20 6c61 6265  nvironment, labe
+0001ef80: 6c3d 6c61 6265 6c29 0a20 2020 2020 2020  l=label).       
+0001ef90: 2069 6620 646e 7365 6e74 7269 6573 2061   if dnsentries a
+0001efa0: 6e64 206e 6f74 206f 6e6c 7961 7373 6574  nd not onlyasset
+0001efb0: 733a 0a20 2020 2020 2020 2020 2020 2070  s:.            p
+0001efc0: 7072 696e 7428 2244 6570 6c6f 7969 6e67  print("Deploying
+0001efd0: 2044 6e73 2045 6e74 7269 6573 2e2e 2e22   Dns Entries..."
+0001efe0: 290a 2020 2020 2020 2020 2020 2020 646e  ).            dn
+0001eff0: 7363 6c69 656e 7473 203d 207b 7d0a 2020  sclients = {}.  
+0001f000: 2020 2020 2020 2020 2020 666f 7220 646e            for dn
+0001f010: 7365 6e74 7279 2069 6e20 646e 7365 6e74  sentry in dnsent
+0001f020: 7269 6573 3a0a 2020 2020 2020 2020 2020  ries:.          
+0001f030: 2020 2020 2020 646e 7370 726f 6669 6c65        dnsprofile
+0001f040: 203d 2065 6e74 7269 6573 5b64 6e73 656e   = entries[dnsen
+0001f050: 7472 795d 0a20 2020 2020 2020 2020 2020  try].           
+0001f060: 2020 2020 2064 6e73 646f 6d61 696e 203d       dnsdomain =
+0001f070: 2064 6e73 7072 6f66 696c 652e 6765 7428   dnsprofile.get(
+0001f080: 2764 6f6d 6169 6e27 290a 2020 2020 2020  'domain').      
+0001f090: 2020 2020 2020 2020 2020 646e 736e 6574            dnsnet
+0001f0a0: 203d 2064 6e73 7072 6f66 696c 652e 6765   = dnsprofile.ge
+0001f0b0: 7428 276e 6574 272c 2027 6465 6661 756c  t('net', 'defaul
+0001f0c0: 7427 290a 2020 2020 2020 2020 2020 2020  t').            
+0001f0d0: 2020 2020 646e 7369 7020 3d20 646e 7370      dnsip = dnsp
+0001f0e0: 726f 6669 6c65 2e67 6574 2827 6970 2729  rofile.get('ip')
+0001f0f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001f100: 2064 6e73 616c 6961 7320 3d20 646e 7370   dnsalias = dnsp
+0001f110: 726f 6669 6c65 2e67 6574 2827 616c 6961  rofile.get('alia
+0001f120: 7327 2c20 5b5d 290a 2020 2020 2020 2020  s', []).        
+0001f130: 2020 2020 2020 2020 646e 7363 6c69 656e          dnsclien
+0001f140: 7420 3d20 646e 7370 726f 6669 6c65 2e67  t = dnsprofile.g
+0001f150: 6574 2827 636c 6965 6e74 2729 0a20 2020  et('client').   
+0001f160: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0001f170: 646e 7363 6c69 656e 7420 6973 204e 6f6e  dnsclient is Non
+0001f180: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0001f190: 2020 2020 2020 207a 203d 206b 0a20 2020         z = k.   
+0001f1a0: 2020 2020 2020 2020 2020 2020 2065 6c69               eli
+0001f1b0: 6620 646e 7363 6c69 656e 7420 696e 2064  f dnsclient in d
+0001f1c0: 6e73 636c 6965 6e74 733a 0a20 2020 2020  nsclients:.     
+0001f1d0: 2020 2020 2020 2020 2020 2020 2020 207a                 z
+0001f1e0: 203d 2064 6e73 636c 6965 6e74 735b 646e   = dnsclients[dn
+0001f1f0: 7363 6c69 656e 745d 0a20 2020 2020 2020  sclient].       
+0001f200: 2020 2020 2020 2020 2065 6c69 6620 646e           elif dn
+0001f210: 7363 6c69 656e 7420 696e 2073 656c 662e  sclient in self.
+0001f220: 636c 6965 6e74 733a 0a20 2020 2020 2020  clients:.       
+0001f230: 2020 2020 2020 2020 2020 2020 207a 203d               z =
+0001f240: 204b 636f 6e66 6967 2863 6c69 656e 743d   Kconfig(client=
+0001f250: 646e 7363 6c69 656e 7429 2e6b 0a20 2020  dnsclient).k.   
+0001f260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f270: 2064 6e73 636c 6965 6e74 735b 646e 7363   dnsclients[dnsc
+0001f280: 6c69 656e 745d 203d 207a 0a20 2020 2020  lient] = z.     
+0001f290: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0001f2a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001f2b0: 2020 2020 2077 6172 6e69 6e67 2866 2243       warning(f"C
+0001f2c0: 6c69 656e 7420 7b64 6e73 636c 6965 6e74  lient {dnsclient
+0001f2d0: 7d20 6e6f 7420 666f 756e 642e 2053 6b69  } not found. Ski
+0001f2e0: 7070 696e 6722 290a 2020 2020 2020 2020  pping").        
+0001f2f0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0001f300: 726e 0a20 2020 2020 2020 2020 2020 2020  rn.             
+0001f310: 2020 2069 6620 646e 7369 7020 6973 204e     if dnsip is N
+0001f320: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0001f330: 2020 2020 2020 2020 2077 6172 6e69 6e67           warning
+0001f340: 2822 4d69 7373 696e 6720 6970 2e20 536b  ("Missing ip. Sk
+0001f350: 6970 7069 6e67 2122 290a 2020 2020 2020  ipping!").      
+0001f360: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0001f370: 7475 726e 0a20 2020 2020 2020 2020 2020  turn.           
+0001f380: 2020 2020 2069 6620 646e 736e 6574 2069       if dnsnet i
+0001f390: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+0001f3a0: 2020 2020 2020 2020 2020 2020 7761 726e              warn
+0001f3b0: 696e 6728 224d 6973 7369 6e67 206e 6574  ing("Missing net
+0001f3c0: 2e20 536b 6970 7069 6e67 2122 290a 2020  . Skipping!").  
+0001f3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f3e0: 2020 7265 7475 726e 0a20 2020 2020 2020    return.       
+0001f3f0: 2020 2020 2020 2020 207a 2e72 6573 6572           z.reser
+0001f400: 7665 5f64 6e73 286e 616d 653d 646e 7365  ve_dns(name=dnse
+0001f410: 6e74 7279 2c20 6e65 7473 3d5b 646e 736e  ntry, nets=[dnsn
+0001f420: 6574 5d2c 2064 6f6d 6169 6e3d 646e 7364  et], domain=dnsd
+0001f430: 6f6d 6169 6e2c 2069 703d 646e 7369 702c  omain, ip=dnsip,
+0001f440: 2061 6c69 6173 3d64 6e73 616c 6961 732c   alias=dnsalias,
+0001f450: 2066 6f72 6365 3d54 7275 652c 0a20 2020   force=True,.   
+0001f460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f470: 2020 2020 2020 2020 2020 2070 7269 6d61             prima
+0001f480: 7279 3d54 7275 6529 0a20 2020 2020 2020  ry=True).       
+0001f490: 2069 6620 616e 7369 626c 6565 6e74 7269   if ansibleentri
+0001f4a0: 6573 2061 6e64 206e 6f74 206f 6e6c 7961  es and not onlya
+0001f4b0: 7373 6574 733a 0a20 2020 2020 2020 2020  ssets:.         
+0001f4c0: 2020 2069 6620 6e6f 7420 6e65 7776 6d73     if not newvms
+0001f4d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001f4e0: 2020 7761 726e 696e 6728 2241 6e73 6962    warning("Ansib
+0001f4f0: 6c65 2073 6b69 7070 6564 2061 7320 6e6f  le skipped as no
+0001f500: 206e 6577 2076 6d20 7769 7468 696e 2070   new vm within p
+0001f510: 6c61 7962 6f6f 6b20 7072 6f76 6973 696f  laybook provisio
+0001f520: 6e65 6422 290a 2020 2020 2020 2020 2020  ned").          
+0001f530: 2020 2020 2020 7265 7475 726e 0a20 2020        return.   
+0001f540: 2020 2020 2020 2020 2066 6f72 2065 6e74           for ent
+0001f550: 7279 2069 6e20 736f 7274 6564 2861 6e73  ry in sorted(ans
+0001f560: 6962 6c65 656e 7472 6965 7329 3a0a 2020  ibleentries):.  
+0001f570: 2020 2020 2020 2020 2020 2020 2020 5f61                _a
+0001f580: 6e73 6962 6c65 203d 2065 6e74 7269 6573  nsible = entries
+0001f590: 5b65 6e74 7279 5d0a 2020 2020 2020 2020  [entry].        
+0001f5a0: 2020 2020 2020 2020 6966 2027 706c 6179          if 'play
+0001f5b0: 626f 6f6b 2720 6e6f 7420 696e 205f 616e  book' not in _an
+0001f5c0: 7369 626c 653a 0a20 2020 2020 2020 2020  sible:.         
+0001f5d0: 2020 2020 2020 2020 2020 2065 7272 6f72             error
+0001f5e0: 2822 4d69 7373 696e 6720 506c 6179 626f  ("Missing Playbo
+0001f5f0: 6f6b 2066 6f72 2061 6e73 6962 6c65 2e49  ok for ansible.I
+0001f600: 676e 6f72 696e 672e 2e2e 2229 0a20 2020  gnoring...").   
+0001f610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f620: 2073 7973 2e65 7869 7428 3129 0a20 2020   sys.exit(1).   
+0001f630: 2020 2020 2020 2020 2020 2020 2070 6c61               pla
+0001f640: 7962 6f6f 6b20 3d20 5f61 6e73 6962 6c65  ybook = _ansible
+0001f650: 5b27 706c 6179 626f 6f6b 275d 0a20 2020  ['playbook'].   
+0001f660: 2020 2020 2020 2020 2020 2020 2076 6572               ver
+0001f670: 626f 7365 203d 205f 616e 7369 626c 655b  bose = _ansible[
+0001f680: 2776 6572 626f 7365 275d 2069 6620 2776  'verbose'] if 'v
+0001f690: 6572 626f 7365 2720 696e 205f 616e 7369  erbose' in _ansi
+0001f6a0: 626c 6520 656c 7365 2046 616c 7365 0a20  ble else False. 
+0001f6b0: 2020 2020 2020 2020 2020 2020 2020 2067                 g
+0001f6c0: 726f 7570 7320 3d20 5f61 6e73 6962 6c65  roups = _ansible
+0001f6d0: 2e67 6574 2827 6772 6f75 7073 272c 207b  .get('groups', {
+0001f6e0: 7d29 0a20 2020 2020 2020 2020 2020 2020  }).             
+0001f6f0: 2020 2075 7365 7220 3d20 5f61 6e73 6962     user = _ansib
+0001f700: 6c65 2e67 6574 2827 7573 6572 2729 0a20  le.get('user'). 
+0001f710: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+0001f720: 6172 6961 626c 6573 203d 205f 616e 7369  ariables = _ansi
+0001f730: 626c 652e 6765 7428 2776 6172 6961 626c  ble.get('variabl
+0001f740: 6573 272c 207b 7d29 0a20 2020 2020 2020  es', {}).       
+0001f750: 2020 2020 2020 2020 2074 6172 6765 7476           targetv
+0001f760: 6d73 203d 205b 766d 2066 6f72 2076 6d20  ms = [vm for vm 
+0001f770: 696e 205f 616e 7369 626c 655b 2776 6d73  in _ansible['vms
+0001f780: 275d 2069 6620 766d 2069 6e20 6e65 7776  '] if vm in newv
+0001f790: 6d73 5d20 6966 2027 766d 7327 2069 6e20  ms] if 'vms' in 
+0001f7a0: 5f61 6e73 6962 6c65 2065 6c73 6520 6e65  _ansible else ne
+0001f7b0: 7776 6d73 0a20 2020 2020 2020 2020 2020  wvms.           
+0001f7c0: 2020 2020 2069 6620 6e6f 7420 7461 7267       if not targ
+0001f7d0: 6574 766d 733a 0a20 2020 2020 2020 2020  etvms:.         
+0001f7e0: 2020 2020 2020 2020 2020 2077 6172 6e69             warni
+0001f7f0: 6e67 2822 416e 7369 626c 6520 736b 6970  ng("Ansible skip
+0001f800: 7065 6420 6173 206e 6f20 6e65 7720 766d  ped as no new vm
+0001f810: 2077 6974 6869 6e20 706c 6179 626f 6f6b   within playbook
+0001f820: 2070 726f 7669 7369 6f6e 6564 2229 0a20   provisioned"). 
+0001f830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f840: 2020 2072 6574 7572 6e0a 2020 2020 2020     return.      
+0001f850: 2020 2020 2020 2020 2020 616e 7369 626c            ansibl
+0001f860: 6563 6f6d 6d61 6e64 203d 2022 616e 7369  ecommand = "ansi
+0001f870: 626c 652d 706c 6179 626f 6f6b 220a 2020  ble-playbook".  
+0001f880: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0001f890: 2076 6572 626f 7365 3a0a 2020 2020 2020   verbose:.      
+0001f8a0: 2020 2020 2020 2020 2020 2020 2020 616e                an
+0001f8b0: 7369 626c 6563 6f6d 6d61 6e64 202b 3d20  siblecommand += 
+0001f8c0: 2220 2d76 7676 220a 2020 2020 2020 2020  " -vvv".        
+0001f8d0: 2020 2020 2020 2020 696e 7665 6e74 6f72          inventor
+0001f8e0: 7966 696c 6520 3d20 6622 2f74 6d70 2f7b  yfile = f"/tmp/{
+0001f8f0: 706c 616e 7d2e 696e 762e 7961 6d6c 2220  plan}.inv.yaml" 
+0001f900: 6966 2073 656c 662e 7961 6d6c 696e 7665  if self.yamlinve
+0001f910: 6e74 6f72 7920 656c 7365 2066 222f 746d  ntory else f"/tm
+0001f920: 702f 7b70 6c61 6e7d 2e69 6e76 220a 2020  p/{plan}.inv".  
+0001f930: 2020 2020 2020 2020 2020 2020 2020 616e                an
+0001f940: 7369 626c 6575 7469 6c73 2e6d 616b 655f  sibleutils.make_
+0001f950: 706c 616e 5f69 6e76 656e 746f 7279 2876  plan_inventory(v
+0001f960: 6d73 5f74 6f5f 686f 7374 2c20 706c 616e  ms_to_host, plan
+0001f970: 2c20 7461 7267 6574 766d 732c 2067 726f  , targetvms, gro
+0001f980: 7570 733d 6772 6f75 7073 2c20 7573 6572  ups=groups, user
+0001f990: 3d75 7365 722c 0a20 2020 2020 2020 2020  =user,.         
+0001f9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f9c0: 2020 2020 2020 2020 7961 6d6c 696e 7665          yamlinve
+0001f9d0: 6e74 6f72 793d 7365 6c66 2e79 616d 6c69  ntory=self.yamli
+0001f9e0: 6e76 656e 746f 7279 2c20 7475 6e6e 656c  nventory, tunnel
+0001f9f0: 3d73 656c 662e 7475 6e6e 656c 2c0a 2020  =self.tunnel,.  
 0001fa00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fa10: 2020 2020 7961 6d6c 696e 7665 6e74 6f72      yamlinventor
-0001fa20: 793d 7365 6c66 2e79 616d 6c69 6e76 656e  y=self.yamlinven
-0001fa30: 746f 7279 2c20 7475 6e6e 656c 3d73 656c  tory, tunnel=sel
-0001fa40: 662e 7475 6e6e 656c 2c0a 2020 2020 2020  f.tunnel,.      
-0001fa50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fa60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fa70: 2020 2020 2020 2020 2020 2074 756e 6e65             tunne
-0001fa80: 6c68 6f73 743d 7365 6c66 2e74 756e 6e65  lhost=self.tunne
-0001fa90: 6c68 6f73 742c 2074 756e 6e65 6c75 7365  lhost, tunneluse
-0001faa0: 723d 7365 6c66 2e74 756e 6e65 6c75 7365  r=self.tunneluse
-0001fab0: 722c 0a20 2020 2020 2020 2020 2020 2020  r,.             
-0001fac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fae0: 2020 2020 7475 6e6e 656c 706f 7274 3d73      tunnelport=s
-0001faf0: 656c 662e 7475 6e6e 656c 706f 7274 2c20  elf.tunnelport, 
-0001fb00: 696e 7365 6375 7265 3d73 656c 662e 696e  insecure=self.in
-0001fb10: 7365 6375 7265 290a 2020 2020 2020 2020  secure).        
-0001fb20: 2020 2020 2020 2020 6966 206e 6f74 206f          if not o
-0001fb30: 732e 7061 7468 2e65 7869 7374 7328 277e  s.path.exists('~
-0001fb40: 2f2e 616e 7369 626c 652e 6366 6727 293a  /.ansible.cfg'):
-0001fb50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001fb60: 2020 2020 2061 6e73 6962 6c65 636f 6e66       ansibleconf
-0001fb70: 6967 203d 206f 732e 7061 7468 2e65 7870  ig = os.path.exp
-0001fb80: 616e 6475 7365 7228 277e 2f2e 616e 7369  anduser('~/.ansi
-0001fb90: 626c 652e 6366 6727 290a 2020 2020 2020  ble.cfg').      
-0001fba0: 2020 2020 2020 2020 2020 2020 2020 7769                wi
-0001fbb0: 7468 206f 7065 6e28 616e 7369 626c 6563  th open(ansiblec
-0001fbc0: 6f6e 6669 672c 2022 7722 2920 6173 2066  onfig, "w") as f
-0001fbd0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001fbe0: 2020 2020 2020 2020 2020 662e 7772 6974            f.writ
-0001fbf0: 6528 225b 7373 685f 636f 6e6e 6563 7469  e("[ssh_connecti
-0001fc00: 6f6e 5d5c 6e72 6574 7269 6573 3d31 305c  on]\nretries=10\
-0001fc10: 6e22 290a 2020 2020 2020 2020 2020 2020  n").            
-0001fc20: 2020 2020 6966 2076 6172 6961 626c 6573      if variables
-0001fc30: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001fc40: 2020 2020 2020 7661 7273 6669 6c65 203d        varsfile =
-0001fc50: 2066 222f 746d 702f 7b70 6c61 6e7d 2e76   f"/tmp/{plan}.v
-0001fc60: 6172 732e 796d 6c22 0a20 2020 2020 2020  ars.yml".       
-0001fc70: 2020 2020 2020 2020 2020 2020 2077 6974               wit
-0001fc80: 6820 6f70 656e 2876 6172 7366 696c 652c  h open(varsfile,
-0001fc90: 2027 7727 2920 6173 2066 3a0a 2020 2020   'w') as f:.    
-0001fca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fcb0: 2020 2020 7961 6d6c 2e64 756d 7028 7661      yaml.dump(va
-0001fcc0: 7269 6162 6c65 732c 2066 2c20 6465 6661  riables, f, defa
-0001fcd0: 756c 745f 666c 6f77 5f73 7479 6c65 3d46  ult_flow_style=F
-0001fce0: 616c 7365 290a 2020 2020 2020 2020 2020  alse).          
-0001fcf0: 2020 2020 2020 2020 2020 616e 7369 626c            ansibl
-0001fd00: 6563 6f6d 6d61 6e64 202b 3d20 6622 202d  ecommand += f" -
-0001fd10: 2d65 7874 7261 2d76 6172 7320 407b 7661  -extra-vars @{va
-0001fd20: 7273 6669 6c65 7d22 0a20 2020 2020 2020  rsfile}".       
-0001fd30: 2020 2020 2020 2020 2061 6e73 6962 6c65           ansible
-0001fd40: 636f 6d6d 616e 6420 2b3d 2066 2220 2d69  command += f" -i
-0001fd50: 207b 696e 7665 6e74 6f72 7966 696c 657d   {inventoryfile}
-0001fd60: 207b 706c 6179 626f 6f6b 7d22 0a20 2020   {playbook}".   
-0001fd70: 2020 2020 2020 2020 2020 2020 2070 7072               ppr
-0001fd80: 696e 7428 6622 5275 6e6e 696e 673a 207b  int(f"Running: {
-0001fd90: 616e 7369 626c 6563 6f6d 6d61 6e64 7d22  ansiblecommand}"
-0001fda0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001fdb0: 2020 6f73 2e73 7973 7465 6d28 616e 7369    os.system(ansi
-0001fdc0: 626c 6563 6f6d 6d61 6e64 290a 2020 2020  blecommand).    
-0001fdd0: 2020 2020 6966 2061 6e73 6962 6c65 2061      if ansible a
-0001fde0: 6e64 206e 6f74 206f 6e6c 7961 7373 6574  nd not onlyasset
-0001fdf0: 733a 0a20 2020 2020 2020 2020 2020 2070  s:.            p
-0001fe00: 7072 696e 7428 2244 6570 6c6f 7969 6e67  print("Deploying
-0001fe10: 2041 6e73 6962 6c65 2049 6e76 656e 746f   Ansible Invento
-0001fe20: 7279 2e2e 2e22 290a 2020 2020 2020 2020  ry...").        
-0001fe30: 2020 2020 696e 7665 6e74 6f72 7966 696c      inventoryfil
-0001fe40: 6520 3d20 6622 2f74 6d70 2f7b 706c 616e  e = f"/tmp/{plan
-0001fe50: 7d2e 696e 762e 7961 6d6c 2220 6966 2073  }.inv.yaml" if s
-0001fe60: 656c 662e 7961 6d6c 696e 7665 6e74 6f72  elf.yamlinventor
-0001fe70: 7920 656c 7365 2066 222f 746d 702f 7b70  y else f"/tmp/{p
-0001fe80: 6c61 6e7d 2e69 6e76 220a 2020 2020 2020  lan}.inv".      
-0001fe90: 2020 2020 2020 6966 206f 732e 7061 7468        if os.path
-0001fea0: 2e65 7869 7374 7328 696e 7665 6e74 6f72  .exists(inventor
-0001feb0: 7966 696c 6529 3a0a 2020 2020 2020 2020  yfile):.        
-0001fec0: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
-0001fed0: 2249 6e76 656e 746f 7279 2069 6e20 7b69  "Inventory in {i
-0001fee0: 6e76 656e 746f 7279 6669 6c65 7d20 736b  nventoryfile} sk
-0001fef0: 6970 7065 6421 2229 0a20 2020 2020 2020  ipped!").       
-0001ff00: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0001ff10: 2020 2020 2020 2020 2020 2070 7072 696e             pprin
-0001ff20: 7428 6622 4372 6561 7469 6e67 2061 6e73  t(f"Creating ans
-0001ff30: 6962 6c65 2069 6e76 656e 746f 7279 2066  ible inventory f
-0001ff40: 6f72 2070 6c61 6e20 7b70 6c61 6e7d 2069  or plan {plan} i
-0001ff50: 6e20 7b69 6e76 656e 746f 7279 6669 6c65  n {inventoryfile
-0001ff60: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
-0001ff70: 2020 2020 766d 7320 3d20 5b5d 0a20 2020      vms = [].   
-0001ff80: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-0001ff90: 2076 6d20 696e 2073 6f72 7465 6428 6b2e   vm in sorted(k.
-0001ffa0: 6c69 7374 2829 2c20 6b65 793d 6c61 6d62  list(), key=lamb
-0001ffb0: 6461 2078 3a20 785b 276e 616d 6527 5d29  da x: x['name'])
-0001ffc0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001ffd0: 2020 2020 2020 6e61 6d65 203d 2076 6d5b        name = vm[
-0001ffe0: 276e 616d 6527 5d0a 2020 2020 2020 2020  'name'].        
-0001fff0: 2020 2020 2020 2020 2020 2020 6465 7363              desc
-00020000: 7269 7074 696f 6e20 3d20 766d 5b27 706c  ription = vm['pl
-00020010: 616e 275d 0a20 2020 2020 2020 2020 2020  an'].           
-00020020: 2020 2020 2020 2020 2069 6620 6465 7363           if desc
-00020030: 7269 7074 696f 6e20 3d3d 2070 6c61 6e3a  ription == plan:
-00020040: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00020050: 2020 2020 2020 2020 2076 6d73 2e61 7070           vms.app
-00020060: 656e 6428 6e61 6d65 290a 2020 2020 2020  end(name).      
-00020070: 2020 2020 2020 2020 2020 616e 7369 626c            ansibl
-00020080: 6575 7469 6c73 2e6d 616b 655f 706c 616e  eutils.make_plan
-00020090: 5f69 6e76 656e 746f 7279 2876 6d73 5f74  _inventory(vms_t
-000200a0: 6f5f 686f 7374 2c20 706c 616e 2c20 766d  o_host, plan, vm
-000200b0: 732c 2079 616d 6c69 6e76 656e 746f 7279  s, yamlinventory
-000200c0: 3d73 656c 662e 7961 6d6c 696e 7665 6e74  =self.yamlinvent
-000200d0: 6f72 792c 0a20 2020 2020 2020 2020 2020  ory,.           
-000200e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000200f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020100: 2020 2020 2020 696e 7365 6375 7265 3d73        insecure=s
-00020110: 656c 662e 696e 7365 6375 7265 290a 2020  elf.insecure).  
-00020120: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00020130: 7475 726e 207b 2772 6573 756c 7427 3a20  turn {'result': 
-00020140: 2773 7563 6365 7373 272c 2027 706c 616e  'success', 'plan
-00020150: 273a 2070 6c61 6e7d 0a20 2020 2020 2020  ': plan}.       
-00020160: 2069 6620 6c62 7320 616e 6420 6e6f 7420   if lbs and not 
-00020170: 6f6e 6c79 6173 7365 7473 3a0a 2020 2020  onlyassets:.    
-00020180: 2020 2020 2020 2020 646e 7363 6c69 656e          dnsclien
-00020190: 7473 203d 207b 7d0a 2020 2020 2020 2020  ts = {}.        
-000201a0: 2020 2020 7070 7269 6e74 2822 4465 706c      pprint("Depl
-000201b0: 6f79 696e 6720 4c6f 6164 6261 6c61 6e63  oying Loadbalanc
-000201c0: 6572 732e 2e2e 2229 0a20 2020 2020 2020  ers...").       
-000201d0: 2020 2020 2066 6f72 2069 6e64 6578 2c20       for index, 
-000201e0: 6c62 656e 7472 7920 696e 2065 6e75 6d65  lbentry in enume
-000201f0: 7261 7465 286c 6273 293a 0a20 2020 2020  rate(lbs):.     
-00020200: 2020 2020 2020 2020 2020 2064 6574 6169             detai
-00020210: 6c73 203d 2065 6e74 7269 6573 5b6c 6265  ls = entries[lbe
-00020220: 6e74 7279 5d0a 2020 2020 2020 2020 2020  ntry].          
-00020230: 2020 2020 2020 706f 7274 7320 3d20 6465        ports = de
-00020240: 7461 696c 732e 6765 7428 2770 6f72 7473  tails.get('ports
-00020250: 272c 205b 5d29 0a20 2020 2020 2020 2020  ', []).         
-00020260: 2020 2020 2020 2069 6620 6e6f 7420 706f         if not po
-00020270: 7274 733a 0a20 2020 2020 2020 2020 2020  rts:.           
-00020280: 2020 2020 2020 2020 2065 7272 6f72 2822           error("
-00020290: 4d69 7373 696e 6720 506f 7274 7320 666f  Missing Ports fo
-000202a0: 7220 6c6f 6164 6261 6c61 6e63 6572 2e20  r loadbalancer. 
-000202b0: 4e6f 7420 6372 6561 7469 6e67 2069 742e  Not creating it.
-000202c0: 2e2e 2229 0a20 2020 2020 2020 2020 2020  ..").           
-000202d0: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
-000202e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000202f0: 6368 6563 6b70 6174 6820 3d20 6465 7461  checkpath = deta
-00020300: 696c 732e 6765 7428 2763 6865 636b 7061  ils.get('checkpa
-00020310: 7468 272c 2027 2f27 290a 2020 2020 2020  th', '/').      
-00020320: 2020 2020 2020 2020 2020 6368 6563 6b70            checkp
-00020330: 6f72 7420 3d20 6465 7461 696c 732e 6765  ort = details.ge
-00020340: 7428 2763 6865 636b 706f 7274 272c 2038  t('checkport', 8
-00020350: 3029 0a20 2020 2020 2020 2020 2020 2020  0).             
-00020360: 2020 2061 6c69 6173 203d 2064 6574 6169     alias = detai
-00020370: 6c73 2e67 6574 2827 616c 6961 7327 2c20  ls.get('alias', 
-00020380: 5b5d 290a 2020 2020 2020 2020 2020 2020  []).            
-00020390: 2020 2020 646f 6d61 696e 203d 2064 6574      domain = det
-000203a0: 6169 6c73 2e67 6574 2827 646f 6d61 696e  ails.get('domain
-000203b0: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
-000203c0: 2020 2064 6e73 636c 6965 6e74 203d 2064     dnsclient = d
-000203d0: 6574 6169 6c73 2e67 6574 2827 646e 7363  etails.get('dnsc
-000203e0: 6c69 656e 7427 2c20 6f76 6572 7269 6465  lient', override
-000203f0: 732e 6765 7428 2764 6e73 636c 6965 6e74  s.get('dnsclient
-00020400: 2729 290a 2020 2020 2020 2020 2020 2020  ')).            
-00020410: 2020 2020 6c62 766d 7320 3d20 6465 7461      lbvms = deta
-00020420: 696c 732e 6765 7428 2776 6d73 272c 205b  ils.get('vms', [
-00020430: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
-00020440: 2020 206c 626e 6574 7320 3d20 6465 7461     lbnets = deta
-00020450: 696c 732e 6765 7428 276e 6574 7327 2c20  ils.get('nets', 
-00020460: 5b27 6465 6661 756c 7427 5d29 0a20 2020  ['default']).   
-00020470: 2020 2020 2020 2020 2020 2020 2069 6e74               int
-00020480: 6572 6e61 6c20 3d20 6465 7461 696c 732e  ernal = details.
-00020490: 6765 7428 2769 6e74 6572 6e61 6c27 290a  get('internal').
-000204a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000204b0: 7375 626e 6574 6964 203d 2064 6574 6169  subnetid = detai
-000204c0: 6c73 2e67 6574 2827 7375 626e 6574 6964  ls.get('subnetid
-000204d0: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
-000204e0: 2020 2069 7020 3d20 6465 7461 696c 732e     ip = details.
-000204f0: 6765 7428 2769 7027 290a 2020 2020 2020  get('ip').      
-00020500: 2020 2020 2020 2020 2020 7365 6c66 2e63            self.c
-00020510: 7265 6174 655f 6c6f 6164 6261 6c61 6e63  reate_loadbalanc
-00020520: 6572 286c 6265 6e74 7279 2c20 6e65 7473  er(lbentry, nets
-00020530: 3d6c 626e 6574 732c 2070 6f72 7473 3d70  =lbnets, ports=p
-00020540: 6f72 7473 2c20 6368 6563 6b70 6174 683d  orts, checkpath=
-00020550: 6368 6563 6b70 6174 682c 2076 6d73 3d6c  checkpath, vms=l
-00020560: 6276 6d73 2c0a 2020 2020 2020 2020 2020  bvms,.          
-00020570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020580: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00020590: 6f6d 6169 6e3d 646f 6d61 696e 2c20 706c  omain=domain, pl
-000205a0: 616e 3d70 6c61 6e2c 2063 6865 636b 706f  an=plan, checkpo
-000205b0: 7274 3d63 6865 636b 706f 7274 2c20 616c  rt=checkport, al
-000205c0: 6961 733d 616c 6961 732c 0a20 2020 2020  ias=alias,.     
-000205d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000205e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000205f0: 2020 2020 696e 7465 726e 616c 3d69 6e74      internal=int
-00020600: 6572 6e61 6c2c 2064 6e73 636c 6965 6e74  ernal, dnsclient
-00020610: 3d64 6e73 636c 6965 6e74 2c20 7375 626e  =dnsclient, subn
-00020620: 6574 6964 3d73 7562 6e65 7469 642c 2069  etid=subnetid, i
-00020630: 703d 6970 290a 2020 2020 2020 2020 6966  p=ip).        if
-00020640: 2073 6773 2061 6e64 206e 6f74 206f 6e6c   sgs and not onl
-00020650: 7961 7373 6574 733a 0a20 2020 2020 2020  yassets:.       
-00020660: 2020 2020 2070 7072 696e 7428 2244 6570       pprint("Dep
-00020670: 6c6f 7969 6e67 2053 6563 7572 6974 7947  loying SecurityG
-00020680: 726f 7570 732e 2e2e 2229 0a20 2020 2020  roups...").     
-00020690: 2020 2020 2020 2066 6f72 2073 6720 696e         for sg in
-000206a0: 2073 6773 3a0a 2020 2020 2020 2020 2020   sgs:.          
-000206b0: 2020 2020 2020 6465 7461 696c 7320 3d20        details = 
-000206c0: 656e 7472 6965 735b 7367 5d0a 2020 2020  entries[sg].    
-000206d0: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
-000206e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000206f0: 2070 6f72 7473 203d 2064 6574 6169 6c73   ports = details
-00020700: 2e67 6574 2827 706f 7274 7327 2c20 5b5d  .get('ports', []
-00020710: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00020720: 2020 6966 206e 6f74 2070 6f72 7473 3a0a    if not ports:.
-00020730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020740: 2020 2020 6572 726f 7228 224d 6973 7369      error("Missi
-00020750: 6e67 2050 6f72 7473 2066 6f72 2073 6773  ng Ports for sgs
-00020760: 2e20 4e6f 7420 6372 6561 7469 6e67 2069  . Not creating i
-00020770: 742e 2e2e 2229 0a20 2020 2020 2020 2020  t...").         
-00020780: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00020790: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
-000207a0: 2020 7365 6c66 2e63 7265 6174 655f 7365    self.create_se
-000207b0: 6375 7269 7479 5f67 726f 7570 2873 672c  curity_group(sg,
-000207c0: 207b 2770 6f72 7473 273a 2070 6f72 7473   {'ports': ports
-000207d0: 7d29 0a20 2020 2020 2020 2069 6620 776f  }).        if wo
-000207e0: 726b 666c 6f77 656e 7472 6965 7320 616e  rkflowentries an
-000207f0: 6420 6e6f 7420 6f6e 6c79 6173 7365 7473  d not onlyassets
-00020800: 3a0a 2020 2020 2020 2020 2020 2020 7070  :.            pp
-00020810: 7269 6e74 2822 4465 706c 6f79 696e 6720  rint("Deploying 
-00020820: 576f 726b 666c 6f77 2045 6e74 7269 6573  Workflow Entries
-00020830: 2e2e 2e22 290a 2020 2020 2020 2020 2020  ...").          
-00020840: 2020 666f 7220 776f 726b 666c 6f77 2069    for workflow i
-00020850: 6e20 776f 726b 666c 6f77 656e 7472 6965  n workflowentrie
-00020860: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-00020870: 2020 2077 6f72 6b66 6c6f 775f 6f76 6572     workflow_over
-00020880: 7269 6465 7320 3d20 6f76 6572 7269 6465  rides = override
-00020890: 732e 636f 7079 2829 0a20 2020 2020 2020  s.copy().       
-000208a0: 2020 2020 2020 2020 2077 6f72 6b66 6c6f           workflo
-000208b0: 775f 6f76 6572 7269 6465 732e 7570 6461  w_overrides.upda
-000208c0: 7465 2865 6e74 7269 6573 5b77 6f72 6b66  te(entries[workf
-000208d0: 6c6f 775d 290a 2020 2020 2020 2020 2020  low]).          
-000208e0: 2020 2020 2020 7365 6c66 2e63 7265 6174        self.creat
-000208f0: 655f 776f 726b 666c 6f77 2877 6f72 6b66  e_workflow(workf
-00020900: 6c6f 772c 206f 7665 7272 6964 6573 3d77  low, overrides=w
-00020910: 6f72 6b66 6c6f 775f 6f76 6572 7269 6465  orkflow_override
-00020920: 7329 0a20 2020 2020 2020 2072 6574 7572  s).        retur
-00020930: 6e64 6174 6120 3d20 7b27 7265 7375 6c74  ndata = {'result
-00020940: 273a 2027 7375 6363 6573 7327 2c20 2770  ': 'success', 'p
-00020950: 6c61 6e27 3a20 706c 616e 7d0a 2020 2020  lan': plan}.    
-00020960: 2020 2020 7265 7475 726e 6461 7461 5b27      returndata['
-00020970: 6e65 7776 6d73 275d 203d 206e 6577 766d  newvms'] = newvm
-00020980: 7320 6966 206e 6577 766d 7320 656c 7365  s if newvms else
-00020990: 205b 5d0a 2020 2020 2020 2020 7265 7475   [].        retu
-000209a0: 726e 6461 7461 5b27 6578 6973 7469 6e67  rndata['existing
-000209b0: 766d 7327 5d20 3d20 6578 6973 7469 6e67  vms'] = existing
-000209c0: 766d 7320 6966 2065 7869 7374 696e 6776  vms if existingv
-000209d0: 6d73 2065 6c73 6520 5b5d 0a20 2020 2020  ms else [].     
-000209e0: 2020 2072 6574 7572 6e64 6174 615b 2766     returndata['f
-000209f0: 6169 6c65 6476 6d73 275d 203d 2066 6169  ailedvms'] = fai
-00020a00: 6c65 6476 6d73 2069 6620 6661 696c 6564  ledvms if failed
-00020a10: 766d 7320 656c 7365 205b 5d0a 2020 2020  vms else [].    
-00020a20: 2020 2020 7265 7475 726e 6461 7461 5b27      returndata['
-00020a30: 6173 7365 7473 275d 203d 206e 6577 6173  assets'] = newas
-00020a40: 7365 7473 2069 6620 6e65 7761 7373 6574  sets if newasset
-00020a50: 7320 656c 7365 205b 5d0a 2020 2020 2020  s else [].      
-00020a60: 2020 6966 2066 6169 6c65 6476 6d73 3a0a    if failedvms:.
-00020a70: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00020a80: 726e 6461 7461 5b27 7265 7375 6c74 275d  rndata['result']
-00020a90: 203d 2027 6661 696c 7572 6527 0a20 2020   = 'failure'.   
-00020aa0: 2020 2020 2020 2020 2066 6169 6c65 646e           failedn
-00020ab0: 616d 6573 203d 2027 2c27 2e6a 6f69 6e28  ames = ','.join(
-00020ac0: 5b76 5b27 6e61 6d65 275d 2066 6f72 2076  [v['name'] for v
-00020ad0: 2069 6e20 6661 696c 6564 766d 735d 290a   in failedvms]).
-00020ae0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00020af0: 726e 6461 7461 5b27 7265 6173 6f6e 275d  rndata['reason']
-00020b00: 203d 2066 2754 6865 2066 6f6c 6c6f 7769   = f'The followi
-00020b10: 6e67 2076 6d73 2066 6169 6c65 643a 207b  ng vms failed: {
-00020b20: 6661 696c 6564 6e61 6d65 737d 270a 2020  failednames}'.  
-00020b30: 2020 2020 2020 6966 2067 6574 6261 636b        if getback
-00020b40: 206f 7220 746f 636c 6561 6e3a 0a20 2020   or toclean:.   
-00020b50: 2020 2020 2020 2020 206f 732e 6368 6469           os.chdi
-00020b60: 7228 272e 2e27 290a 2020 2020 2020 2020  r('..').        
-00020b70: 6966 2074 6f63 6c65 616e 3a0a 2020 2020  if toclean:.    
-00020b80: 2020 2020 2020 2020 726d 7472 6565 2870          rmtree(p
-00020b90: 6174 6829 0a20 2020 2020 2020 2069 6620  ath).        if 
-00020ba0: 696e 7075 7473 7472 696e 6720 6973 206e  inputstring is n
-00020bb0: 6f74 204e 6f6e 6520 616e 6420 6f73 2e70  ot None and os.p
-00020bc0: 6174 682e 6578 6973 7473 2866 2274 656d  ath.exists(f"tem
-00020bd0: 705f 706c 616e 5f7b 706c 616e 7d2e 796d  p_plan_{plan}.ym
-00020be0: 6c22 293a 0a20 2020 2020 2020 2020 2020  l"):.           
-00020bf0: 206f 732e 7265 6d6f 7665 2866 2274 656d   os.remove(f"tem
-00020c00: 705f 706c 616e 5f7b 706c 616e 7d2e 796d  p_plan_{plan}.ym
-00020c10: 6c22 290a 2020 2020 2020 2020 666f 7220  l").        for 
-00020c20: 656e 7472 7920 696e 2061 7379 6e63 7761  entry in asyncwa
-00020c30: 6974 766d 733a 0a20 2020 2020 2020 2020  itvms:.         
-00020c40: 2020 206e 616d 652c 2066 696e 6973 6866     name, finishf
-00020c50: 696c 6573 203d 2065 6e74 7279 5b27 6e61  iles = entry['na
-00020c60: 6d65 275d 2c20 656e 7472 795b 2766 696e  me'], entry['fin
-00020c70: 6973 6866 696c 6573 275d 0a20 2020 2020  ishfiles'].     
-00020c80: 2020 2020 2020 2077 6169 7463 6f6d 6d61         waitcomma
-00020c90: 6e64 2c20 7761 6974 7469 6d65 6f75 7420  nd, waittimeout 
-00020ca0: 3d20 656e 7472 795b 2777 6169 7463 6f6d  = entry['waitcom
-00020cb0: 6d61 6e64 275d 2c20 656e 7472 795b 2777  mand'], entry['w
-00020cc0: 6169 7474 696d 656f 7574 275d 0a20 2020  aittimeout'].   
-00020cd0: 2020 2020 2020 2020 2076 6d63 6c69 656e           vmclien
-00020ce0: 7420 3d20 656e 7472 795b 2776 6d63 6c69  t = entry['vmcli
-00020cf0: 656e 7427 5d0a 2020 2020 2020 2020 2020  ent'].          
-00020d00: 2020 7365 6c66 2e77 6169 745f 6669 6e69    self.wait_fini
-00020d10: 7368 286e 616d 652c 2077 6169 7463 6f6d  sh(name, waitcom
-00020d20: 6d61 6e64 3d77 6169 7463 6f6d 6d61 6e64  mand=waitcommand
-00020d30: 2c20 7761 6974 7469 6d65 6f75 743d 7761  , waittimeout=wa
-00020d40: 6974 7469 6d65 6f75 742c 2076 6d63 6c69  ittimeout, vmcli
-00020d50: 656e 743d 766d 636c 6965 6e74 290a 2020  ent=vmclient).  
-00020d60: 2020 2020 2020 2020 2020 6966 2066 696e            if fin
-00020d70: 6973 6866 696c 6573 3a0a 2020 2020 2020  ishfiles:.      
-00020d80: 2020 2020 2020 2020 2020 7365 6c66 2e68            self.h
-00020d90: 616e 646c 655f 6669 6e69 7368 6669 6c65  andle_finishfile
-00020da0: 7328 6e61 6d65 2c20 6669 6e69 7368 6669  s(name, finishfi
-00020db0: 6c65 732c 2076 6d63 6c69 656e 743d 766d  les, vmclient=vm
-00020dc0: 636c 6965 6e74 290a 2020 2020 2020 2020  client).        
-00020dd0: 706f 7374 5f73 6372 6970 7420 3d20 6627  post_script = f'
-00020de0: 7b69 6e70 7574 6469 727d 2f6b 636c 695f  {inputdir}/kcli_
-00020df0: 706f 7374 2e73 6827 0a20 2020 2020 2020  post.sh'.       
-00020e00: 2069 6620 6f73 2e70 6174 682e 6578 6973   if os.path.exis
-00020e10: 7473 2870 6f73 745f 7363 7269 7074 293a  ts(post_script):
-00020e20: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00020e30: 706f 7374 3a0a 2020 2020 2020 2020 2020  post:.          
-00020e40: 2020 2020 2020 7070 7269 6e74 2822 5275        pprint("Ru
-00020e50: 6e6e 696e 6720 6b63 6c69 5f70 6f73 742e  nning kcli_post.
-00020e60: 7368 2229 0a20 2020 2020 2020 2020 2020  sh").           
-00020e70: 2020 2020 2077 6974 6820 5465 6d70 6f72       with Tempor
-00020e80: 6172 7944 6972 6563 746f 7279 2829 2061  aryDirectory() a
-00020e90: 7320 746d 7064 6972 3a0a 2020 2020 2020  s tmpdir:.      
-00020ea0: 2020 2020 2020 2020 2020 2020 2020 706f                po
-00020eb0: 7374 5f73 6372 6970 7420 3d20 7365 6c66  st_script = self
-00020ec0: 2e70 726f 6365 7373 5f69 6e70 7574 6669  .process_inputfi
-00020ed0: 6c65 2827 7878 7827 2c20 706f 7374 5f73  le('xxx', post_s
-00020ee0: 6372 6970 742c 206f 7665 7272 6964 6573  cript, overrides
-00020ef0: 3d6f 7665 7272 6964 6573 290a 2020 2020  =overrides).    
-00020f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020f10: 7769 7468 206f 7065 6e28 6622 7b74 6d70  with open(f"{tmp
-00020f20: 6469 727d 2f70 6f73 742e 7368 222c 2027  dir}/post.sh", '
-00020f30: 7727 2920 6173 2066 3a0a 2020 2020 2020  w') as f:.      
-00020f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020f50: 2020 662e 7772 6974 6528 706f 7374 5f73    f.write(post_s
-00020f60: 6372 6970 7429 0a20 2020 2020 2020 2020  cript).         
-00020f70: 2020 2020 2020 2020 2020 2070 6f73 745f             post_
-00020f80: 7275 6e20 3d20 7275 6e28 6627 6261 7368  run = run(f'bash
-00020f90: 207b 746d 7064 6972 7d2f 706f 7374 2e73   {tmpdir}/post.s
-00020fa0: 6827 2c20 7368 656c 6c3d 5472 7565 2c20  h', shell=True, 
-00020fb0: 7374 646f 7574 3d50 4950 452c 2073 7464  stdout=PIPE, std
-00020fc0: 6572 723d 5354 444f 5554 2c0a 2020 2020  err=STDOUT,.    
-00020fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020fe0: 2020 2020 2020 2020 2020 2020 2020 2075                 u
-00020ff0: 6e69 7665 7273 616c 5f6e 6577 6c69 6e65  niversal_newline
-00021000: 733d 5472 7565 290a 2020 2020 2020 2020  s=True).        
-00021010: 2020 2020 2020 2020 2020 2020 6966 2070              if p
-00021020: 6f73 745f 7275 6e2e 7265 7475 726e 636f  ost_run.returnco
-00021030: 6465 2021 3d20 303a 0a20 2020 2020 2020  de != 0:.       
-00021040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021050: 206d 7367 203d 2066 2249 7373 7565 2077   msg = f"Issue w
-00021060: 6865 6e20 7275 6e6e 696e 6720 6b63 6c69  hen running kcli
-00021070: 5f70 6f73 742e 7368 203a 5c6e 7b70 6f73  _post.sh :\n{pos
-00021080: 745f 7275 6e2e 7374 646f 7574 7d22 0a20  t_run.stdout}". 
-00021090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000210a0: 2020 2020 2020 2065 7272 6f72 286d 7367         error(msg
-000210b0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000210c0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-000210d0: 207b 2772 6573 756c 7427 3a20 2766 6169   {'result': 'fai
-000210e0: 6c75 7265 272c 2027 7265 6173 6f6e 273a  lure', 'reason':
-000210f0: 206d 7367 7d0a 2020 2020 2020 2020 2020   msg}.          
-00021100: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00021110: 2020 2020 2020 2020 7761 726e 696e 6728          warning(
-00021120: 2253 6b69 7070 696e 6720 6b63 6c69 5f70  "Skipping kcli_p
-00021130: 6f73 742e 7368 2061 7320 7265 7175 6573  ost.sh as reques
-00021140: 7465 6422 290a 2020 2020 2020 2020 6966  ted").        if
-00021150: 206f 7665 7272 6964 6573 2e67 6574 2827   overrides.get('
-00021160: 7465 6d70 6b65 7964 6972 2729 2069 7320  tempkeydir') is 
-00021170: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-00021180: 2020 2020 2020 6f76 6572 7269 6465 732e        overrides.
-00021190: 6765 7428 2774 656d 706b 6579 6469 7227  get('tempkeydir'
-000211a0: 292e 636c 6561 6e75 7028 290a 2020 2020  ).cleanup().    
-000211b0: 2020 2020 7265 7475 726e 2072 6574 7572      return retur
-000211c0: 6e64 6174 610a 0a20 2020 2064 6566 2068  ndata..    def h
-000211d0: 616e 646c 655f 686f 7374 2873 656c 662c  andle_host(self,
-000211e0: 2070 6f6f 6c3d 4e6f 6e65 2c20 696d 6167   pool=None, imag
-000211f0: 653d 4e6f 6e65 2c20 7377 6974 6368 3d4e  e=None, switch=N
-00021200: 6f6e 652c 2064 6f77 6e6c 6f61 643d 4661  one, download=Fa
-00021210: 6c73 652c 0a20 2020 2020 2020 2020 2020  lse,.           
-00021220: 2020 2020 2020 2020 2075 726c 3d4e 6f6e           url=Non
-00021230: 652c 2063 6d64 3d4e 6f6e 652c 2073 796e  e, cmd=None, syn
-00021240: 633d 4661 6c73 652c 2073 697a 653d 4e6f  c=False, size=No
-00021250: 6e65 2c20 6172 6368 3d27 7838 365f 3634  ne, arch='x86_64
-00021260: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
-00021270: 2020 2020 2020 206b 766d 5f6f 7065 6e73         kvm_opens
-00021280: 7461 636b 3d54 7275 652c 2072 6863 6f73  tack=True, rhcos
-00021290: 5f63 6f6d 6d69 743d 4e6f 6e65 2c20 7268  _commit=None, rh
-000212a0: 636f 735f 696e 7374 616c 6c65 723d 4661  cos_installer=Fa
-000212b0: 6c73 6529 3a0a 2020 2020 2020 2020 6966  lse):.        if
-000212c0: 2064 6f77 6e6c 6f61 643a 0a20 2020 2020   download:.     
-000212d0: 2020 2020 2020 206b 203d 2073 656c 662e         k = self.
-000212e0: 6b0a 2020 2020 2020 2020 2020 2020 6966  k.            if
-000212f0: 2070 6f6f 6c20 6973 204e 6f6e 653a 0a20   pool is None:. 
-00021300: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00021310: 6f6f 6c20 3d20 7365 6c66 2e70 6f6f 6c0a  ool = self.pool.
-00021320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021330: 7070 7269 6e74 2866 2255 7369 6e67 2070  pprint(f"Using p
-00021340: 6f6f 6c20 7b70 6f6f 6c7d 2229 0a20 2020  ool {pool}").   
-00021350: 2020 2020 2020 2020 2069 6620 696d 6167           if imag
-00021360: 6520 6973 206e 6f74 204e 6f6e 653a 0a20  e is not None:. 
-00021370: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00021380: 6620 7572 6c20 6973 204e 6f6e 653a 0a20  f url is None:. 
-00021390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000213a0: 2020 2069 6620 6172 6368 2021 3d20 2778     if arch != 'x
-000213b0: 3836 5f36 3427 3a0a 2020 2020 2020 2020  86_64':.        
-000213c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000213d0: 494d 4147 4553 2e75 7064 6174 6528 7b69  IMAGES.update({i
-000213e0: 3a20 494d 4147 4553 5b69 5d2e 7265 706c  : IMAGES[i].repl
-000213f0: 6163 6528 2778 3836 5f36 3427 2c20 6172  ace('x86_64', ar
-00021400: 6368 292e 7265 706c 6163 6528 2761 6d64  ch).replace('amd
-00021410: 3634 272c 2061 7263 6829 0a20 2020 2020  64', arch).     
-00021420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021440: 2020 666f 7220 6920 696e 2049 4d41 4745    for i in IMAGE
-00021450: 537d 290a 2020 2020 2020 2020 2020 2020  S}).            
-00021460: 2020 2020 2020 2020 6966 2069 6d61 6765          if image
-00021470: 206e 6f74 2069 6e20 494d 4147 4553 3a0a   not in IMAGES:.
+0001fa10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fa20: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0001fa30: 756e 6e65 6c68 6f73 743d 7365 6c66 2e74  unnelhost=self.t
+0001fa40: 756e 6e65 6c68 6f73 742c 2074 756e 6e65  unnelhost, tunne
+0001fa50: 6c75 7365 723d 7365 6c66 2e74 756e 6e65  luser=self.tunne
+0001fa60: 6c75 7365 722c 0a20 2020 2020 2020 2020  luser,.         
+0001fa70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fa80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fa90: 2020 2020 2020 2020 7475 6e6e 656c 706f          tunnelpo
+0001faa0: 7274 3d73 656c 662e 7475 6e6e 656c 706f  rt=self.tunnelpo
+0001fab0: 7274 2c20 696e 7365 6375 7265 3d73 656c  rt, insecure=sel
+0001fac0: 662e 696e 7365 6375 7265 290a 2020 2020  f.insecure).    
+0001fad0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+0001fae0: 6f74 206f 732e 7061 7468 2e65 7869 7374  ot os.path.exist
+0001faf0: 7328 277e 2f2e 616e 7369 626c 652e 6366  s('~/.ansible.cf
+0001fb00: 6727 293a 0a20 2020 2020 2020 2020 2020  g'):.           
+0001fb10: 2020 2020 2020 2020 2061 6e73 6962 6c65           ansible
+0001fb20: 636f 6e66 6967 203d 206f 732e 7061 7468  config = os.path
+0001fb30: 2e65 7870 616e 6475 7365 7228 277e 2f2e  .expanduser('~/.
+0001fb40: 616e 7369 626c 652e 6366 6727 290a 2020  ansible.cfg').  
+0001fb50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fb60: 2020 7769 7468 206f 7065 6e28 616e 7369    with open(ansi
+0001fb70: 626c 6563 6f6e 6669 672c 2022 7722 2920  bleconfig, "w") 
+0001fb80: 6173 2066 3a0a 2020 2020 2020 2020 2020  as f:.          
+0001fb90: 2020 2020 2020 2020 2020 2020 2020 662e                f.
+0001fba0: 7772 6974 6528 225b 7373 685f 636f 6e6e  write("[ssh_conn
+0001fbb0: 6563 7469 6f6e 5d5c 6e72 6574 7269 6573  ection]\nretries
+0001fbc0: 3d31 305c 6e22 290a 2020 2020 2020 2020  =10\n").        
+0001fbd0: 2020 2020 2020 2020 6966 2076 6172 6961          if varia
+0001fbe0: 626c 6573 3a0a 2020 2020 2020 2020 2020  bles:.          
+0001fbf0: 2020 2020 2020 2020 2020 7661 7273 6669            varsfi
+0001fc00: 6c65 203d 2066 222f 746d 702f 7b70 6c61  le = f"/tmp/{pla
+0001fc10: 6e7d 2e76 6172 732e 796d 6c22 0a20 2020  n}.vars.yml".   
+0001fc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fc30: 2077 6974 6820 6f70 656e 2876 6172 7366   with open(varsf
+0001fc40: 696c 652c 2027 7727 2920 6173 2066 3a0a  ile, 'w') as f:.
+0001fc50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fc60: 2020 2020 2020 2020 7961 6d6c 2e64 756d          yaml.dum
+0001fc70: 7028 7661 7269 6162 6c65 732c 2066 2c20  p(variables, f, 
+0001fc80: 6465 6661 756c 745f 666c 6f77 5f73 7479  default_flow_sty
+0001fc90: 6c65 3d46 616c 7365 290a 2020 2020 2020  le=False).      
+0001fca0: 2020 2020 2020 2020 2020 2020 2020 616e                an
+0001fcb0: 7369 626c 6563 6f6d 6d61 6e64 202b 3d20  siblecommand += 
+0001fcc0: 6622 202d 2d65 7874 7261 2d76 6172 7320  f" --extra-vars 
+0001fcd0: 407b 7661 7273 6669 6c65 7d22 0a20 2020  @{varsfile}".   
+0001fce0: 2020 2020 2020 2020 2020 2020 2061 6e73               ans
+0001fcf0: 6962 6c65 636f 6d6d 616e 6420 2b3d 2066  iblecommand += f
+0001fd00: 2220 2d69 207b 696e 7665 6e74 6f72 7966  " -i {inventoryf
+0001fd10: 696c 657d 207b 706c 6179 626f 6f6b 7d22  ile} {playbook}"
+0001fd20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001fd30: 2070 7072 696e 7428 6622 5275 6e6e 696e   pprint(f"Runnin
+0001fd40: 673a 207b 616e 7369 626c 6563 6f6d 6d61  g: {ansiblecomma
+0001fd50: 6e64 7d22 290a 2020 2020 2020 2020 2020  nd}").          
+0001fd60: 2020 2020 2020 6f73 2e73 7973 7465 6d28        os.system(
+0001fd70: 616e 7369 626c 6563 6f6d 6d61 6e64 290a  ansiblecommand).
+0001fd80: 2020 2020 2020 2020 6966 2061 6e73 6962          if ansib
+0001fd90: 6c65 2061 6e64 206e 6f74 206f 6e6c 7961  le and not onlya
+0001fda0: 7373 6574 733a 0a20 2020 2020 2020 2020  ssets:.         
+0001fdb0: 2020 2070 7072 696e 7428 2244 6570 6c6f     pprint("Deplo
+0001fdc0: 7969 6e67 2041 6e73 6962 6c65 2049 6e76  ying Ansible Inv
+0001fdd0: 656e 746f 7279 2e2e 2e22 290a 2020 2020  entory...").    
+0001fde0: 2020 2020 2020 2020 696e 7665 6e74 6f72          inventor
+0001fdf0: 7966 696c 6520 3d20 6622 2f74 6d70 2f7b  yfile = f"/tmp/{
+0001fe00: 706c 616e 7d2e 696e 762e 7961 6d6c 2220  plan}.inv.yaml" 
+0001fe10: 6966 2073 656c 662e 7961 6d6c 696e 7665  if self.yamlinve
+0001fe20: 6e74 6f72 7920 656c 7365 2066 222f 746d  ntory else f"/tm
+0001fe30: 702f 7b70 6c61 6e7d 2e69 6e76 220a 2020  p/{plan}.inv".  
+0001fe40: 2020 2020 2020 2020 2020 6966 206f 732e            if os.
+0001fe50: 7061 7468 2e65 7869 7374 7328 696e 7665  path.exists(inve
+0001fe60: 6e74 6f72 7966 696c 6529 3a0a 2020 2020  ntoryfile):.    
+0001fe70: 2020 2020 2020 2020 2020 2020 7070 7269              ppri
+0001fe80: 6e74 2866 2249 6e76 656e 746f 7279 2069  nt(f"Inventory i
+0001fe90: 6e20 7b69 6e76 656e 746f 7279 6669 6c65  n {inventoryfile
+0001fea0: 7d20 736b 6970 7065 6421 2229 0a20 2020  } skipped!").   
+0001feb0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+0001fec0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0001fed0: 7072 696e 7428 6622 4372 6561 7469 6e67  print(f"Creating
+0001fee0: 2061 6e73 6962 6c65 2069 6e76 656e 746f   ansible invento
+0001fef0: 7279 2066 6f72 2070 6c61 6e20 7b70 6c61  ry for plan {pla
+0001ff00: 6e7d 2069 6e20 7b69 6e76 656e 746f 7279  n} in {inventory
+0001ff10: 6669 6c65 7d22 290a 2020 2020 2020 2020  file}").        
+0001ff20: 2020 2020 2020 2020 766d 7320 3d20 5b5d          vms = []
+0001ff30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001ff40: 2066 6f72 2076 6d20 696e 2073 6f72 7465   for vm in sorte
+0001ff50: 6428 6b2e 6c69 7374 2829 2c20 6b65 793d  d(k.list(), key=
+0001ff60: 6c61 6d62 6461 2078 3a20 785b 276e 616d  lambda x: x['nam
+0001ff70: 6527 5d29 3a0a 2020 2020 2020 2020 2020  e']):.          
+0001ff80: 2020 2020 2020 2020 2020 6e61 6d65 203d            name =
+0001ff90: 2076 6d5b 276e 616d 6527 5d0a 2020 2020   vm['name'].    
+0001ffa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ffb0: 6465 7363 7269 7074 696f 6e20 3d20 766d  description = vm
+0001ffc0: 5b27 706c 616e 275d 0a20 2020 2020 2020  ['plan'].       
+0001ffd0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0001ffe0: 6465 7363 7269 7074 696f 6e20 3d3d 2070  description == p
+0001fff0: 6c61 6e3a 0a20 2020 2020 2020 2020 2020  lan:.           
+00020000: 2020 2020 2020 2020 2020 2020 2076 6d73               vms
+00020010: 2e61 7070 656e 6428 6e61 6d65 290a 2020  .append(name).  
+00020020: 2020 2020 2020 2020 2020 2020 2020 616e                an
+00020030: 7369 626c 6575 7469 6c73 2e6d 616b 655f  sibleutils.make_
+00020040: 706c 616e 5f69 6e76 656e 746f 7279 2876  plan_inventory(v
+00020050: 6d73 5f74 6f5f 686f 7374 2c20 706c 616e  ms_to_host, plan
+00020060: 2c20 766d 732c 2079 616d 6c69 6e76 656e  , vms, yamlinven
+00020070: 746f 7279 3d73 656c 662e 7961 6d6c 696e  tory=self.yamlin
+00020080: 7665 6e74 6f72 792c 0a20 2020 2020 2020  ventory,.       
+00020090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000200a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000200b0: 2020 2020 2020 2020 2020 696e 7365 6375            insecu
+000200c0: 7265 3d73 656c 662e 696e 7365 6375 7265  re=self.insecure
+000200d0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000200e0: 2020 7265 7475 726e 207b 2772 6573 756c    return {'resul
+000200f0: 7427 3a20 2773 7563 6365 7373 272c 2027  t': 'success', '
+00020100: 706c 616e 273a 2070 6c61 6e7d 0a20 2020  plan': plan}.   
+00020110: 2020 2020 2069 6620 6c62 7320 616e 6420       if lbs and 
+00020120: 6e6f 7420 6f6e 6c79 6173 7365 7473 3a0a  not onlyassets:.
+00020130: 2020 2020 2020 2020 2020 2020 646e 7363              dnsc
+00020140: 6c69 656e 7473 203d 207b 7d0a 2020 2020  lients = {}.    
+00020150: 2020 2020 2020 2020 7070 7269 6e74 2822          pprint("
+00020160: 4465 706c 6f79 696e 6720 4c6f 6164 6261  Deploying Loadba
+00020170: 6c61 6e63 6572 732e 2e2e 2229 0a20 2020  lancers...").   
+00020180: 2020 2020 2020 2020 2066 6f72 2069 6e64           for ind
+00020190: 6578 2c20 6c62 656e 7472 7920 696e 2065  ex, lbentry in e
+000201a0: 6e75 6d65 7261 7465 286c 6273 293a 0a20  numerate(lbs):. 
+000201b0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+000201c0: 6574 6169 6c73 203d 2065 6e74 7269 6573  etails = entries
+000201d0: 5b6c 6265 6e74 7279 5d0a 2020 2020 2020  [lbentry].      
+000201e0: 2020 2020 2020 2020 2020 706f 7274 7320            ports 
+000201f0: 3d20 6465 7461 696c 732e 6765 7428 2770  = details.get('p
+00020200: 6f72 7473 272c 205b 5d29 0a20 2020 2020  orts', []).     
+00020210: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+00020220: 7420 706f 7274 733a 0a20 2020 2020 2020  t ports:.       
+00020230: 2020 2020 2020 2020 2020 2020 2065 7272               err
+00020240: 6f72 2822 4d69 7373 696e 6720 506f 7274  or("Missing Port
+00020250: 7320 666f 7220 6c6f 6164 6261 6c61 6e63  s for loadbalanc
+00020260: 6572 2e20 4e6f 7420 6372 6561 7469 6e67  er. Not creating
+00020270: 2069 742e 2e2e 2229 0a20 2020 2020 2020   it...").       
+00020280: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+00020290: 7572 6e0a 2020 2020 2020 2020 2020 2020  urn.            
+000202a0: 2020 2020 6368 6563 6b70 6174 6820 3d20      checkpath = 
+000202b0: 6465 7461 696c 732e 6765 7428 2763 6865  details.get('che
+000202c0: 636b 7061 7468 272c 2027 2f27 290a 2020  ckpath', '/').  
+000202d0: 2020 2020 2020 2020 2020 2020 2020 6368                ch
+000202e0: 6563 6b70 6f72 7420 3d20 6465 7461 696c  eckport = detail
+000202f0: 732e 6765 7428 2763 6865 636b 706f 7274  s.get('checkport
+00020300: 272c 2038 3029 0a20 2020 2020 2020 2020  ', 80).         
+00020310: 2020 2020 2020 2061 6c69 6173 203d 2064         alias = d
+00020320: 6574 6169 6c73 2e67 6574 2827 616c 6961  etails.get('alia
+00020330: 7327 2c20 5b5d 290a 2020 2020 2020 2020  s', []).        
+00020340: 2020 2020 2020 2020 646f 6d61 696e 203d          domain =
+00020350: 2064 6574 6169 6c73 2e67 6574 2827 646f   details.get('do
+00020360: 6d61 696e 2729 0a20 2020 2020 2020 2020  main').         
+00020370: 2020 2020 2020 2064 6e73 636c 6965 6e74         dnsclient
+00020380: 203d 2064 6574 6169 6c73 2e67 6574 2827   = details.get('
+00020390: 646e 7363 6c69 656e 7427 2c20 6f76 6572  dnsclient', over
+000203a0: 7269 6465 732e 6765 7428 2764 6e73 636c  rides.get('dnscl
+000203b0: 6965 6e74 2729 290a 2020 2020 2020 2020  ient')).        
+000203c0: 2020 2020 2020 2020 6c62 766d 7320 3d20          lbvms = 
+000203d0: 6465 7461 696c 732e 6765 7428 2776 6d73  details.get('vms
+000203e0: 272c 205b 5d29 0a20 2020 2020 2020 2020  ', []).         
+000203f0: 2020 2020 2020 206c 626e 6574 7320 3d20         lbnets = 
+00020400: 6465 7461 696c 732e 6765 7428 276e 6574  details.get('net
+00020410: 7327 2c20 5b27 6465 6661 756c 7427 5d29  s', ['default'])
+00020420: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00020430: 2069 6e74 6572 6e61 6c20 3d20 6465 7461   internal = deta
+00020440: 696c 732e 6765 7428 2769 6e74 6572 6e61  ils.get('interna
+00020450: 6c27 290a 2020 2020 2020 2020 2020 2020  l').            
+00020460: 2020 2020 7375 626e 6574 6964 203d 2064      subnetid = d
+00020470: 6574 6169 6c73 2e67 6574 2827 7375 626e  etails.get('subn
+00020480: 6574 6964 2729 0a20 2020 2020 2020 2020  etid').         
+00020490: 2020 2020 2020 2069 7020 3d20 6465 7461         ip = deta
+000204a0: 696c 732e 6765 7428 2769 7027 290a 2020  ils.get('ip').  
+000204b0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+000204c0: 6c66 2e63 7265 6174 655f 6c6f 6164 6261  lf.create_loadba
+000204d0: 6c61 6e63 6572 286c 6265 6e74 7279 2c20  lancer(lbentry, 
+000204e0: 6e65 7473 3d6c 626e 6574 732c 2070 6f72  nets=lbnets, por
+000204f0: 7473 3d70 6f72 7473 2c20 6368 6563 6b70  ts=ports, checkp
+00020500: 6174 683d 6368 6563 6b70 6174 682c 2076  ath=checkpath, v
+00020510: 6d73 3d6c 6276 6d73 2c0a 2020 2020 2020  ms=lbvms,.      
+00020520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020540: 2020 2064 6f6d 6169 6e3d 646f 6d61 696e     domain=domain
+00020550: 2c20 706c 616e 3d70 6c61 6e2c 2063 6865  , plan=plan, che
+00020560: 636b 706f 7274 3d63 6865 636b 706f 7274  ckport=checkport
+00020570: 2c20 616c 6961 733d 616c 6961 732c 0a20  , alias=alias,. 
+00020580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000205a0: 2020 2020 2020 2020 696e 7465 726e 616c          internal
+000205b0: 3d69 6e74 6572 6e61 6c2c 2064 6e73 636c  =internal, dnscl
+000205c0: 6965 6e74 3d64 6e73 636c 6965 6e74 2c20  ient=dnsclient, 
+000205d0: 7375 626e 6574 6964 3d73 7562 6e65 7469  subnetid=subneti
+000205e0: 642c 2069 703d 6970 290a 2020 2020 2020  d, ip=ip).      
+000205f0: 2020 6966 2073 6773 2061 6e64 206e 6f74    if sgs and not
+00020600: 206f 6e6c 7961 7373 6574 733a 0a20 2020   onlyassets:.   
+00020610: 2020 2020 2020 2020 2070 7072 696e 7428           pprint(
+00020620: 2244 6570 6c6f 7969 6e67 2053 6563 7572  "Deploying Secur
+00020630: 6974 7947 726f 7570 732e 2e2e 2229 0a20  ityGroups..."). 
+00020640: 2020 2020 2020 2020 2020 2066 6f72 2073             for s
+00020650: 6720 696e 2073 6773 3a0a 2020 2020 2020  g in sgs:.      
+00020660: 2020 2020 2020 2020 2020 6465 7461 696c            detail
+00020670: 7320 3d20 656e 7472 6965 735b 7367 5d0a  s = entries[sg].
+00020680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020690: 6e61 6d65 0a20 2020 2020 2020 2020 2020  name.           
+000206a0: 2020 2020 2070 6f72 7473 203d 2064 6574       ports = det
+000206b0: 6169 6c73 2e67 6574 2827 706f 7274 7327  ails.get('ports'
+000206c0: 2c20 5b5d 290a 2020 2020 2020 2020 2020  , []).          
+000206d0: 2020 2020 2020 6966 206e 6f74 2070 6f72        if not por
+000206e0: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
+000206f0: 2020 2020 2020 2020 6572 726f 7228 224d          error("M
+00020700: 6973 7369 6e67 2050 6f72 7473 2066 6f72  issing Ports for
+00020710: 2073 6773 2e20 4e6f 7420 6372 6561 7469   sgs. Not creati
+00020720: 6e67 2069 742e 2e2e 2229 0a20 2020 2020  ng it...").     
+00020730: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00020740: 6574 7572 6e0a 2020 2020 2020 2020 2020  eturn.          
+00020750: 2020 2020 2020 7365 6c66 2e63 7265 6174        self.creat
+00020760: 655f 7365 6375 7269 7479 5f67 726f 7570  e_security_group
+00020770: 2873 672c 207b 2770 6f72 7473 273a 2070  (sg, {'ports': p
+00020780: 6f72 7473 7d29 0a20 2020 2020 2020 2069  orts}).        i
+00020790: 6620 776f 726b 666c 6f77 656e 7472 6965  f workflowentrie
+000207a0: 7320 616e 6420 6e6f 7420 6f6e 6c79 6173  s and not onlyas
+000207b0: 7365 7473 3a0a 2020 2020 2020 2020 2020  sets:.          
+000207c0: 2020 7070 7269 6e74 2822 4465 706c 6f79    pprint("Deploy
+000207d0: 696e 6720 576f 726b 666c 6f77 2045 6e74  ing Workflow Ent
+000207e0: 7269 6573 2e2e 2e22 290a 2020 2020 2020  ries...").      
+000207f0: 2020 2020 2020 666f 7220 776f 726b 666c        for workfl
+00020800: 6f77 2069 6e20 776f 726b 666c 6f77 656e  ow in workflowen
+00020810: 7472 6965 733a 0a20 2020 2020 2020 2020  tries:.         
+00020820: 2020 2020 2020 2077 6f72 6b66 6c6f 775f         workflow_
+00020830: 6f76 6572 7269 6465 7320 3d20 6f76 6572  overrides = over
+00020840: 7269 6465 732e 636f 7079 2829 0a20 2020  rides.copy().   
+00020850: 2020 2020 2020 2020 2020 2020 2077 6f72               wor
+00020860: 6b66 6c6f 775f 6f76 6572 7269 6465 732e  kflow_overrides.
+00020870: 7570 6461 7465 2865 6e74 7269 6573 5b77  update(entries[w
+00020880: 6f72 6b66 6c6f 775d 290a 2020 2020 2020  orkflow]).      
+00020890: 2020 2020 2020 2020 2020 7365 6c66 2e63            self.c
+000208a0: 7265 6174 655f 776f 726b 666c 6f77 2877  reate_workflow(w
+000208b0: 6f72 6b66 6c6f 772c 206f 7665 7272 6964  orkflow, overrid
+000208c0: 6573 3d77 6f72 6b66 6c6f 775f 6f76 6572  es=workflow_over
+000208d0: 7269 6465 7329 0a20 2020 2020 2020 2072  rides).        r
+000208e0: 6574 7572 6e64 6174 6120 3d20 7b27 7265  eturndata = {'re
+000208f0: 7375 6c74 273a 2027 7375 6363 6573 7327  sult': 'success'
+00020900: 2c20 2770 6c61 6e27 3a20 706c 616e 7d0a  , 'plan': plan}.
+00020910: 2020 2020 2020 2020 7265 7475 726e 6461          returnda
+00020920: 7461 5b27 6e65 7776 6d73 275d 203d 206e  ta['newvms'] = n
+00020930: 6577 766d 7320 6966 206e 6577 766d 7320  ewvms if newvms 
+00020940: 656c 7365 205b 5d0a 2020 2020 2020 2020  else [].        
+00020950: 7265 7475 726e 6461 7461 5b27 6578 6973  returndata['exis
+00020960: 7469 6e67 766d 7327 5d20 3d20 6578 6973  tingvms'] = exis
+00020970: 7469 6e67 766d 7320 6966 2065 7869 7374  tingvms if exist
+00020980: 696e 6776 6d73 2065 6c73 6520 5b5d 0a20  ingvms else []. 
+00020990: 2020 2020 2020 2072 6574 7572 6e64 6174         returndat
+000209a0: 615b 2766 6169 6c65 6476 6d73 275d 203d  a['failedvms'] =
+000209b0: 2066 6169 6c65 6476 6d73 2069 6620 6661   failedvms if fa
+000209c0: 696c 6564 766d 7320 656c 7365 205b 5d0a  iledvms else [].
+000209d0: 2020 2020 2020 2020 7265 7475 726e 6461          returnda
+000209e0: 7461 5b27 6173 7365 7473 275d 203d 206e  ta['assets'] = n
+000209f0: 6577 6173 7365 7473 2069 6620 6e65 7761  ewassets if newa
+00020a00: 7373 6574 7320 656c 7365 205b 5d0a 2020  ssets else [].  
+00020a10: 2020 2020 2020 6966 2066 6169 6c65 6476        if failedv
+00020a20: 6d73 3a0a 2020 2020 2020 2020 2020 2020  ms:.            
+00020a30: 7265 7475 726e 6461 7461 5b27 7265 7375  returndata['resu
+00020a40: 6c74 275d 203d 2027 6661 696c 7572 6527  lt'] = 'failure'
+00020a50: 0a20 2020 2020 2020 2020 2020 2066 6169  .            fai
+00020a60: 6c65 646e 616d 6573 203d 2027 2c27 2e6a  lednames = ','.j
+00020a70: 6f69 6e28 5b76 5b27 6e61 6d65 275d 2066  oin([v['name'] f
+00020a80: 6f72 2076 2069 6e20 6661 696c 6564 766d  or v in failedvm
+00020a90: 735d 290a 2020 2020 2020 2020 2020 2020  s]).            
+00020aa0: 7265 7475 726e 6461 7461 5b27 7265 6173  returndata['reas
+00020ab0: 6f6e 275d 203d 2066 2754 6865 2066 6f6c  on'] = f'The fol
+00020ac0: 6c6f 7769 6e67 2076 6d73 2066 6169 6c65  lowing vms faile
+00020ad0: 643a 207b 6661 696c 6564 6e61 6d65 737d  d: {failednames}
+00020ae0: 270a 2020 2020 2020 2020 6966 2067 6574  '.        if get
+00020af0: 6261 636b 206f 7220 746f 636c 6561 6e3a  back or toclean:
+00020b00: 0a20 2020 2020 2020 2020 2020 206f 732e  .            os.
+00020b10: 6368 6469 7228 272e 2e27 290a 2020 2020  chdir('..').    
+00020b20: 2020 2020 6966 2074 6f63 6c65 616e 3a0a      if toclean:.
+00020b30: 2020 2020 2020 2020 2020 2020 726d 7472              rmtr
+00020b40: 6565 2870 6174 6829 0a20 2020 2020 2020  ee(path).       
+00020b50: 2069 6620 696e 7075 7473 7472 696e 6720   if inputstring 
+00020b60: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
+00020b70: 6f73 2e70 6174 682e 6578 6973 7473 2866  os.path.exists(f
+00020b80: 2274 656d 705f 706c 616e 5f7b 706c 616e  "temp_plan_{plan
+00020b90: 7d2e 796d 6c22 293a 0a20 2020 2020 2020  }.yml"):.       
+00020ba0: 2020 2020 206f 732e 7265 6d6f 7665 2866       os.remove(f
+00020bb0: 2274 656d 705f 706c 616e 5f7b 706c 616e  "temp_plan_{plan
+00020bc0: 7d2e 796d 6c22 290a 2020 2020 2020 2020  }.yml").        
+00020bd0: 666f 7220 656e 7472 7920 696e 2061 7379  for entry in asy
+00020be0: 6e63 7761 6974 766d 733a 0a20 2020 2020  ncwaitvms:.     
+00020bf0: 2020 2020 2020 206e 616d 652c 2066 696e         name, fin
+00020c00: 6973 6866 696c 6573 203d 2065 6e74 7279  ishfiles = entry
+00020c10: 5b27 6e61 6d65 275d 2c20 656e 7472 795b  ['name'], entry[
+00020c20: 2766 696e 6973 6866 696c 6573 275d 0a20  'finishfiles']. 
+00020c30: 2020 2020 2020 2020 2020 2077 6169 7463             waitc
+00020c40: 6f6d 6d61 6e64 2c20 7761 6974 7469 6d65  ommand, waittime
+00020c50: 6f75 7420 3d20 656e 7472 795b 2777 6169  out = entry['wai
+00020c60: 7463 6f6d 6d61 6e64 275d 2c20 656e 7472  tcommand'], entr
+00020c70: 795b 2777 6169 7474 696d 656f 7574 275d  y['waittimeout']
+00020c80: 0a20 2020 2020 2020 2020 2020 2076 6d63  .            vmc
+00020c90: 6c69 656e 7420 3d20 656e 7472 795b 2776  lient = entry['v
+00020ca0: 6d63 6c69 656e 7427 5d0a 2020 2020 2020  mclient'].      
+00020cb0: 2020 2020 2020 7365 6c66 2e77 6169 745f        self.wait_
+00020cc0: 6669 6e69 7368 286e 616d 652c 2077 6169  finish(name, wai
+00020cd0: 7463 6f6d 6d61 6e64 3d77 6169 7463 6f6d  tcommand=waitcom
+00020ce0: 6d61 6e64 2c20 7761 6974 7469 6d65 6f75  mand, waittimeou
+00020cf0: 743d 7761 6974 7469 6d65 6f75 742c 2076  t=waittimeout, v
+00020d00: 6d63 6c69 656e 743d 766d 636c 6965 6e74  mclient=vmclient
+00020d10: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+00020d20: 2066 696e 6973 6866 696c 6573 3a0a 2020   finishfiles:.  
+00020d30: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00020d40: 6c66 2e68 616e 646c 655f 6669 6e69 7368  lf.handle_finish
+00020d50: 6669 6c65 7328 6e61 6d65 2c20 6669 6e69  files(name, fini
+00020d60: 7368 6669 6c65 732c 2076 6d63 6c69 656e  shfiles, vmclien
+00020d70: 743d 766d 636c 6965 6e74 290a 2020 2020  t=vmclient).    
+00020d80: 2020 2020 706f 7374 5f73 6372 6970 7420      post_script 
+00020d90: 3d20 6627 7b69 6e70 7574 6469 727d 2f6b  = f'{inputdir}/k
+00020da0: 636c 695f 706f 7374 2e73 6827 0a20 2020  cli_post.sh'.   
+00020db0: 2020 2020 2069 6620 6f73 2e70 6174 682e       if os.path.
+00020dc0: 6578 6973 7473 2870 6f73 745f 7363 7269  exists(post_scri
+00020dd0: 7074 293a 0a20 2020 2020 2020 2020 2020  pt):.           
+00020de0: 2069 6620 706f 7374 3a0a 2020 2020 2020   if post:.      
+00020df0: 2020 2020 2020 2020 2020 7070 7269 6e74            pprint
+00020e00: 2822 5275 6e6e 696e 6720 6b63 6c69 5f70  ("Running kcli_p
+00020e10: 6f73 742e 7368 2229 0a20 2020 2020 2020  ost.sh").       
+00020e20: 2020 2020 2020 2020 2077 6974 6820 5465           with Te
+00020e30: 6d70 6f72 6172 7944 6972 6563 746f 7279  mporaryDirectory
+00020e40: 2829 2061 7320 746d 7064 6972 3a0a 2020  () as tmpdir:.  
+00020e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020e60: 2020 706f 7374 5f73 6372 6970 7420 3d20    post_script = 
+00020e70: 7365 6c66 2e70 726f 6365 7373 5f69 6e70  self.process_inp
+00020e80: 7574 6669 6c65 2827 7878 7827 2c20 706f  utfile('xxx', po
+00020e90: 7374 5f73 6372 6970 742c 206f 7665 7272  st_script, overr
+00020ea0: 6964 6573 3d6f 7665 7272 6964 6573 290a  ides=overrides).
+00020eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020ec0: 2020 2020 7769 7468 206f 7065 6e28 6622      with open(f"
+00020ed0: 7b74 6d70 6469 727d 2f70 6f73 742e 7368  {tmpdir}/post.sh
+00020ee0: 222c 2027 7727 2920 6173 2066 3a0a 2020  ", 'w') as f:.  
+00020ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020f00: 2020 2020 2020 662e 7772 6974 6528 706f        f.write(po
+00020f10: 7374 5f73 6372 6970 7429 0a20 2020 2020  st_script).     
+00020f20: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00020f30: 6f73 745f 7275 6e20 3d20 7275 6e28 6627  ost_run = run(f'
+00020f40: 6261 7368 207b 746d 7064 6972 7d2f 706f  bash {tmpdir}/po
+00020f50: 7374 2e73 6827 2c20 7368 656c 6c3d 5472  st.sh', shell=Tr
+00020f60: 7565 2c20 7374 646f 7574 3d50 4950 452c  ue, stdout=PIPE,
+00020f70: 2073 7464 6572 723d 5354 444f 5554 2c0a   stderr=STDOUT,.
+00020f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020fa0: 2020 2075 6e69 7665 7273 616c 5f6e 6577     universal_new
+00020fb0: 6c69 6e65 733d 5472 7565 290a 2020 2020  lines=True).    
+00020fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020fd0: 6966 2070 6f73 745f 7275 6e2e 7265 7475  if post_run.retu
+00020fe0: 726e 636f 6465 2021 3d20 303a 0a20 2020  rncode != 0:.   
+00020ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021000: 2020 2020 206d 7367 203d 2066 2249 7373       msg = f"Iss
+00021010: 7565 2077 6865 6e20 7275 6e6e 696e 6720  ue when running 
+00021020: 6b63 6c69 5f70 6f73 742e 7368 203a 5c6e  kcli_post.sh :\n
+00021030: 7b70 6f73 745f 7275 6e2e 7374 646f 7574  {post_run.stdout
+00021040: 7d22 0a20 2020 2020 2020 2020 2020 2020  }".             
+00021050: 2020 2020 2020 2020 2020 2065 7272 6f72             error
+00021060: 286d 7367 290a 2020 2020 2020 2020 2020  (msg).          
+00021070: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00021080: 7475 726e 207b 2772 6573 756c 7427 3a20  turn {'result': 
+00021090: 2766 6169 6c75 7265 272c 2027 7265 6173  'failure', 'reas
+000210a0: 6f6e 273a 206d 7367 7d0a 2020 2020 2020  on': msg}.      
+000210b0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+000210c0: 2020 2020 2020 2020 2020 2020 7761 726e              warn
+000210d0: 696e 6728 2253 6b69 7070 696e 6720 6b63  ing("Skipping kc
+000210e0: 6c69 5f70 6f73 742e 7368 2061 7320 7265  li_post.sh as re
+000210f0: 7175 6573 7465 6422 290a 2020 2020 2020  quested").      
+00021100: 2020 6966 206f 7665 7272 6964 6573 2e67    if overrides.g
+00021110: 6574 2827 7465 6d70 6b65 7964 6972 2729  et('tempkeydir')
+00021120: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+00021130: 2020 2020 2020 2020 2020 6f76 6572 7269            overri
+00021140: 6465 732e 6765 7428 2774 656d 706b 6579  des.get('tempkey
+00021150: 6469 7227 292e 636c 6561 6e75 7028 290a  dir').cleanup().
+00021160: 2020 2020 2020 2020 7265 7475 726e 2072          return r
+00021170: 6574 7572 6e64 6174 610a 0a20 2020 2064  eturndata..    d
+00021180: 6566 2068 616e 646c 655f 686f 7374 2873  ef handle_host(s
+00021190: 656c 662c 2070 6f6f 6c3d 4e6f 6e65 2c20  elf, pool=None, 
+000211a0: 696d 6167 653d 4e6f 6e65 2c20 7377 6974  image=None, swit
+000211b0: 6368 3d4e 6f6e 652c 2064 6f77 6e6c 6f61  ch=None, downloa
+000211c0: 643d 4661 6c73 652c 0a20 2020 2020 2020  d=False,.       
+000211d0: 2020 2020 2020 2020 2020 2020 2075 726c               url
+000211e0: 3d4e 6f6e 652c 2063 6d64 3d4e 6f6e 652c  =None, cmd=None,
+000211f0: 2073 796e 633d 4661 6c73 652c 2073 697a   sync=False, siz
+00021200: 653d 4e6f 6e65 2c20 6172 6368 3d27 7838  e=None, arch='x8
+00021210: 365f 3634 272c 0a20 2020 2020 2020 2020  6_64',.         
+00021220: 2020 2020 2020 2020 2020 206b 766d 5f6f             kvm_o
+00021230: 7065 6e73 7461 636b 3d54 7275 652c 2072  penstack=True, r
+00021240: 6863 6f73 5f63 6f6d 6d69 743d 4e6f 6e65  hcos_commit=None
+00021250: 2c20 7268 636f 735f 696e 7374 616c 6c65  , rhcos_installe
+00021260: 723d 4661 6c73 6529 3a0a 2020 2020 2020  r=False):.      
+00021270: 2020 6966 2064 6f77 6e6c 6f61 643a 0a20    if download:. 
+00021280: 2020 2020 2020 2020 2020 206b 203d 2073             k = s
+00021290: 656c 662e 6b0a 2020 2020 2020 2020 2020  elf.k.          
+000212a0: 2020 6966 2070 6f6f 6c20 6973 204e 6f6e    if pool is Non
+000212b0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+000212c0: 2020 2070 6f6f 6c20 3d20 7365 6c66 2e70     pool = self.p
+000212d0: 6f6f 6c0a 2020 2020 2020 2020 2020 2020  ool.            
+000212e0: 2020 2020 7070 7269 6e74 2866 2255 7369      pprint(f"Usi
+000212f0: 6e67 2070 6f6f 6c20 7b70 6f6f 6c7d 2229  ng pool {pool}")
+00021300: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00021310: 696d 6167 6520 6973 206e 6f74 204e 6f6e  image is not Non
+00021320: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00021330: 2020 2069 6620 7572 6c20 6973 204e 6f6e     if url is Non
+00021340: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00021350: 2020 2020 2020 2069 6620 6172 6368 2021         if arch !
+00021360: 3d20 2778 3836 5f36 3427 3a0a 2020 2020  = 'x86_64':.    
+00021370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021380: 2020 2020 494d 4147 4553 2e75 7064 6174      IMAGES.updat
+00021390: 6528 7b69 3a20 494d 4147 4553 5b69 5d2e  e({i: IMAGES[i].
+000213a0: 7265 706c 6163 6528 2778 3836 5f36 3427  replace('x86_64'
+000213b0: 2c20 6172 6368 292e 7265 706c 6163 6528  , arch).replace(
+000213c0: 2761 6d64 3634 272c 2061 7263 6829 0a20  'amd64', arch). 
+000213d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000213e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000213f0: 2020 2020 2020 666f 7220 6920 696e 2049        for i in I
+00021400: 4d41 4745 537d 290a 2020 2020 2020 2020  MAGES}).        
+00021410: 2020 2020 2020 2020 2020 2020 6966 2069              if i
+00021420: 6d61 6765 206e 6f74 2069 6e20 494d 4147  mage not in IMAG
+00021430: 4553 3a0a 2020 2020 2020 2020 2020 2020  ES:.            
+00021440: 2020 2020 2020 2020 2020 2020 6572 726f              erro
+00021450: 7228 6622 496d 6167 6520 7b69 6d61 6765  r(f"Image {image
+00021460: 7d20 6861 7320 6e6f 2061 7373 6f63 6961  } has no associa
+00021470: 7465 6420 7572 6c22 290a 2020 2020 2020  ted url").      
 00021480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021490: 2020 2020 2020 2020 6572 726f 7228 6622          error(f"
-000214a0: 496d 6167 6520 7b69 6d61 6765 7d20 6861  Image {image} ha
-000214b0: 7320 6e6f 2061 7373 6f63 6961 7465 6420  s no associated 
-000214c0: 7572 6c22 290a 2020 2020 2020 2020 2020  url").          
-000214d0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-000214e0: 7475 726e 207b 2772 6573 756c 7427 3a20  turn {'result': 
-000214f0: 2766 6169 6c75 7265 272c 2027 7265 6173  'failure', 'reas
-00021500: 6f6e 273a 2022 496e 636f 7272 6563 7420  on': "Incorrect 
-00021510: 696d 6167 6522 7d0a 2020 2020 2020 2020  image"}.        
-00021520: 2020 2020 2020 2020 2020 2020 7572 6c20              url 
-00021530: 3d20 494d 4147 4553 5b69 6d61 6765 5d0a  = IMAGES[image].
-00021540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021550: 2020 2020 696d 6167 655f 7479 7065 203d      image_type =
-00021560: 2073 656c 662e 7479 7065 0a20 2020 2020   self.type.     
-00021570: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00021580: 6620 6b76 6d5f 6f70 656e 7374 6163 6b20  f kvm_openstack 
-00021590: 616e 6420 7365 6c66 2e74 7970 6520 3d3d  and self.type ==
-000215a0: 2027 6b76 6d27 3a0a 2020 2020 2020 2020   'kvm':.        
-000215b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000215c0: 696d 6167 655f 7479 7065 203d 2027 6f70  image_type = 'op
-000215d0: 656e 7374 6163 6b27 0a20 2020 2020 2020  enstack'.       
-000215e0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-000215f0: 7365 6c66 2e74 7970 6520 3d3d 2022 7072  self.type == "pr
-00021600: 6f78 6d6f 7822 3a0a 2020 2020 2020 2020  oxmox":.        
-00021610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021620: 696d 6167 655f 7479 7065 203d 2027 6b76  image_type = 'kv
-00021630: 6d27 0a20 2020 2020 2020 2020 2020 2020  m'.             
-00021640: 2020 2020 2020 2069 6620 6e6f 7420 6b76         if not kv
-00021650: 6d5f 6f70 656e 7374 6163 6b20 616e 6420  m_openstack and 
-00021660: 7365 6c66 2e74 7970 6520 3d3d 2027 6b76  self.type == 'kv
-00021670: 6d27 3a0a 2020 2020 2020 2020 2020 2020  m':.            
-00021680: 2020 2020 2020 2020 2020 2020 696d 6167              imag
-00021690: 6520 2b3d 2022 2d71 656d 7522 0a20 2020  e += "-qemu".   
+00021490: 2020 7265 7475 726e 207b 2772 6573 756c    return {'resul
+000214a0: 7427 3a20 2766 6169 6c75 7265 272c 2027  t': 'failure', '
+000214b0: 7265 6173 6f6e 273a 2022 496e 636f 7272  reason': "Incorr
+000214c0: 6563 7420 696d 6167 6522 7d0a 2020 2020  ect image"}.    
+000214d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000214e0: 7572 6c20 3d20 494d 4147 4553 5b69 6d61  url = IMAGES[ima
+000214f0: 6765 5d0a 2020 2020 2020 2020 2020 2020  ge].            
+00021500: 2020 2020 2020 2020 696d 6167 655f 7479          image_ty
+00021510: 7065 203d 2073 656c 662e 7479 7065 0a20  pe = self.type. 
+00021520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021530: 2020 2069 6620 6b76 6d5f 6f70 656e 7374     if kvm_openst
+00021540: 6163 6b20 616e 6420 7365 6c66 2e74 7970  ack and self.typ
+00021550: 6520 3d3d 2027 6b76 6d27 3a0a 2020 2020  e == 'kvm':.    
+00021560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021570: 2020 2020 696d 6167 655f 7479 7065 203d      image_type =
+00021580: 2027 6f70 656e 7374 6163 6b27 0a20 2020   'openstack'.   
+00021590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000215a0: 2069 6620 7365 6c66 2e74 7970 6520 3d3d   if self.type ==
+000215b0: 2022 7072 6f78 6d6f 7822 3a0a 2020 2020   "proxmox":.    
+000215c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000215d0: 2020 2020 696d 6167 655f 7479 7065 203d      image_type =
+000215e0: 2027 6b76 6d27 0a20 2020 2020 2020 2020   'kvm'.         
+000215f0: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+00021600: 7420 6b76 6d5f 6f70 656e 7374 6163 6b20  t kvm_openstack 
+00021610: 616e 6420 7365 6c66 2e74 7970 6520 3d3d  and self.type ==
+00021620: 2027 6b76 6d27 3a0a 2020 2020 2020 2020   'kvm':.        
+00021630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021640: 696d 6167 6520 2b3d 2022 2d71 656d 7522  image += "-qemu"
+00021650: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00021660: 2020 2020 2069 6620 2772 6863 6f73 2720       if 'rhcos' 
+00021670: 696e 2069 6d61 6765 2061 6e64 206e 6f74  in image and not
+00021680: 2069 6d61 6765 2e65 6e64 7377 6974 6828   image.endswith(
+00021690: 2771 636f 7732 2e67 7a27 293a 0a20 2020  'qcow2.gz'):.   
 000216a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000216b0: 2069 6620 2772 6863 6f73 2720 696e 2069   if 'rhcos' in i
-000216c0: 6d61 6765 2061 6e64 206e 6f74 2069 6d61  mage and not ima
-000216d0: 6765 2e65 6e64 7377 6974 6828 2771 636f  ge.endswith('qco
-000216e0: 7732 2e67 7a27 293a 0a20 2020 2020 2020  w2.gz'):.       
-000216f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021700: 2069 6620 7268 636f 735f 636f 6d6d 6974   if rhcos_commit
-00021710: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-00021720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021730: 2020 2020 2020 2020 2020 7572 6c20 3d20            url = 
-00021740: 636f 6d6d 6f6e 2e67 6574 5f63 6f6d 6d69  common.get_commi
-00021750: 745f 7268 636f 7328 7268 636f 735f 636f  t_rhcos(rhcos_co
-00021760: 6d6d 6974 2c20 5f74 7970 653d 696d 6167  mmit, _type=imag
-00021770: 655f 7479 7065 290a 2020 2020 2020 2020  e_type).        
-00021780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021790: 656c 6966 2072 6863 6f73 5f69 6e73 7461  elif rhcos_insta
-000217a0: 6c6c 6572 3a0a 2020 2020 2020 2020 2020  ller:.          
-000217b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000217c0: 2020 6f73 2e65 6e76 6972 6f6e 5b27 5041    os.environ['PA
-000217d0: 5448 275d 202b 3d20 6627 3a7b 6f73 2e67  TH'] += f':{os.g
-000217e0: 6574 6377 6428 297d 270a 2020 2020 2020  etcwd()}'.      
-000217f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021800: 2020 2020 2020 7572 6c20 3d20 636f 6d6d        url = comm
-00021810: 6f6e 2e67 6574 5f69 6e73 7461 6c6c 6572  on.get_installer
-00021820: 5f72 6863 6f73 285f 7479 7065 3d69 6d61  _rhcos(_type=ima
-00021830: 6765 5f74 7970 652c 2061 7263 683d 6172  ge_type, arch=ar
-00021840: 6368 290a 2020 2020 2020 2020 2020 2020  ch).            
-00021850: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00021860: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00021870: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00021880: 2061 7263 6820 213d 2027 7838 365f 3634   arch != 'x86_64
-00021890: 273a 0a20 2020 2020 2020 2020 2020 2020  ':.             
-000218a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000218b0: 2020 2075 726c 202b 3d20 6627 2d7b 6172     url += f'-{ar
-000218c0: 6368 7d27 0a20 2020 2020 2020 2020 2020  ch}'.           
-000218d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000218e0: 2075 726c 203d 2063 6f6d 6d6f 6e2e 6765   url = common.ge
-000218f0: 745f 6c61 7465 7374 5f72 6863 6f73 2875  t_latest_rhcos(u
-00021900: 726c 2c20 5f74 7970 653d 696d 6167 655f  rl, _type=image_
-00021910: 7479 7065 2c20 6172 6368 3d61 7263 6829  type, arch=arch)
-00021920: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00021930: 2020 2020 2069 6620 2766 636f 7327 2069       if 'fcos' i
-00021940: 6e20 696d 6167 653a 0a20 2020 2020 2020  n image:.       
-00021950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021960: 2075 726c 203d 2063 6f6d 6d6f 6e2e 6765   url = common.ge
-00021970: 745f 6c61 7465 7374 5f66 636f 7328 7572  t_latest_fcos(ur
-00021980: 6c2c 205f 7479 7065 3d69 6d61 6765 5f74  l, _type=image_t
-00021990: 7970 6529 0a20 2020 2020 2020 2020 2020  ype).           
-000219a0: 2020 2020 2020 2020 2069 6620 696d 6167           if imag
-000219b0: 6520 3d3d 2027 6665 646f 7261 6c61 7465  e == 'fedoralate
-000219c0: 7374 273a 0a20 2020 2020 2020 2020 2020  st':.           
-000219d0: 2020 2020 2020 2020 2020 2020 2075 726c               url
-000219e0: 203d 2063 6f6d 6d6f 6e2e 6765 745f 6c61   = common.get_la
-000219f0: 7465 7374 5f66 6564 6f72 6128 7572 6c29  test_fedora(url)
-00021a00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00021a10: 2020 2020 2069 6d61 6765 203d 206f 732e       image = os.
-00021a20: 7061 7468 2e62 6173 656e 616d 6528 696d  path.basename(im
-00021a30: 6167 6529 0a20 2020 2020 2020 2020 2020  age).           
-00021a40: 2020 2020 2020 2020 2069 6620 696d 6167           if imag
-00021a50: 652e 7374 6172 7473 7769 7468 2827 7268  e.startswith('rh
-00021a60: 656c 2729 3a0a 2020 2020 2020 2020 2020  el'):.          
-00021a70: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00021a80: 2027 7765 6227 2069 6e20 7379 732e 6172   'web' in sys.ar
-00021a90: 6776 5b30 5d3a 0a20 2020 2020 2020 2020  gv[0]:.         
+000216b0: 2020 2020 2069 6620 7268 636f 735f 636f       if rhcos_co
+000216c0: 6d6d 6974 2069 7320 6e6f 7420 4e6f 6e65  mmit is not None
+000216d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000216e0: 2020 2020 2020 2020 2020 2020 2020 7572                ur
+000216f0: 6c20 3d20 636f 6d6d 6f6e 2e67 6574 5f63  l = common.get_c
+00021700: 6f6d 6d69 745f 7268 636f 7328 7268 636f  ommit_rhcos(rhco
+00021710: 735f 636f 6d6d 6974 2c20 5f74 7970 653d  s_commit, _type=
+00021720: 696d 6167 655f 7479 7065 290a 2020 2020  image_type).    
+00021730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021740: 2020 2020 656c 6966 2072 6863 6f73 5f69      elif rhcos_i
+00021750: 6e73 7461 6c6c 6572 3a0a 2020 2020 2020  nstaller:.      
+00021760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021770: 2020 2020 2020 6f73 2e65 6e76 6972 6f6e        os.environ
+00021780: 5b27 5041 5448 275d 202b 3d20 6627 3a7b  ['PATH'] += f':{
+00021790: 6f73 2e67 6574 6377 6428 297d 270a 2020  os.getcwd()}'.  
+000217a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000217b0: 2020 2020 2020 2020 2020 7572 6c20 3d20            url = 
+000217c0: 636f 6d6d 6f6e 2e67 6574 5f69 6e73 7461  common.get_insta
+000217d0: 6c6c 6572 5f72 6863 6f73 285f 7479 7065  ller_rhcos(_type
+000217e0: 3d69 6d61 6765 5f74 7970 652c 2061 7263  =image_type, arc
+000217f0: 683d 6172 6368 290a 2020 2020 2020 2020  h=arch).        
+00021800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021810: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00021820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021830: 2020 6966 2061 7263 6820 213d 2027 7838    if arch != 'x8
+00021840: 365f 3634 273a 0a20 2020 2020 2020 2020  6_64':.         
+00021850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021860: 2020 2020 2020 2075 726c 202b 3d20 6627         url += f'
+00021870: 2d7b 6172 6368 7d27 0a20 2020 2020 2020  -{arch}'.       
+00021880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021890: 2020 2020 2075 726c 203d 2063 6f6d 6d6f       url = commo
+000218a0: 6e2e 6765 745f 6c61 7465 7374 5f72 6863  n.get_latest_rhc
+000218b0: 6f73 2875 726c 2c20 5f74 7970 653d 696d  os(url, _type=im
+000218c0: 6167 655f 7479 7065 2c20 6172 6368 3d61  age_type, arch=a
+000218d0: 7263 6829 0a20 2020 2020 2020 2020 2020  rch).           
+000218e0: 2020 2020 2020 2020 2069 6620 2766 636f           if 'fco
+000218f0: 7327 2069 6e20 696d 6167 653a 0a20 2020  s' in image:.   
+00021900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021910: 2020 2020 2075 726c 203d 2063 6f6d 6d6f       url = commo
+00021920: 6e2e 6765 745f 6c61 7465 7374 5f66 636f  n.get_latest_fco
+00021930: 7328 7572 6c2c 205f 7479 7065 3d69 6d61  s(url, _type=ima
+00021940: 6765 5f74 7970 6529 0a20 2020 2020 2020  ge_type).       
+00021950: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00021960: 696d 6167 6520 3d3d 2027 6665 646f 7261  image == 'fedora
+00021970: 6c61 7465 7374 273a 0a20 2020 2020 2020  latest':.       
+00021980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021990: 2075 726c 203d 2063 6f6d 6d6f 6e2e 6765   url = common.ge
+000219a0: 745f 6c61 7465 7374 5f66 6564 6f72 6128  t_latest_fedora(
+000219b0: 7572 6c29 0a20 2020 2020 2020 2020 2020  url).           
+000219c0: 2020 2020 2020 2020 2069 6d61 6765 203d           image =
+000219d0: 206f 732e 7061 7468 2e62 6173 656e 616d   os.path.basenam
+000219e0: 6528 696d 6167 6529 0a20 2020 2020 2020  e(image).       
+000219f0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00021a00: 696d 6167 652e 7374 6172 7473 7769 7468  image.startswith
+00021a10: 2827 7268 656c 2729 3a0a 2020 2020 2020  ('rhel'):.      
+00021a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021a30: 2020 6966 2027 7765 6227 2069 6e20 7379    if 'web' in sy
+00021a40: 732e 6172 6776 5b30 5d3a 0a20 2020 2020  s.argv[0]:.     
+00021a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021a60: 2020 2020 2020 2072 6574 7572 6e20 7b27         return {'
+00021a70: 7265 7375 6c74 273a 2027 6661 696c 7572  result': 'failur
+00021a80: 6527 2c20 2772 6561 736f 6e27 3a20 224d  e', 'reason': "M
+00021a90: 6973 7369 6e67 2075 726c 227d 0a20 2020  issing url"}.   
 00021aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021ab0: 2020 2072 6574 7572 6e20 7b27 7265 7375     return {'resu
-00021ac0: 6c74 273a 2027 6661 696c 7572 6527 2c20  lt': 'failure', 
-00021ad0: 2772 6561 736f 6e27 3a20 224d 6973 7369  'reason': "Missi
-00021ae0: 6e67 2075 726c 227d 0a20 2020 2020 2020  ng url"}.       
-00021af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021b00: 2070 7072 696e 7428 6622 4f70 656e 696e   pprint(f"Openin
-00021b10: 6720 7572 6c20 7b75 726c 7d20 666f 7220  g url {url} for 
-00021b20: 796f 7520 746f 2067 7261 6220 636f 6d70  you to grab comp
-00021b30: 6c65 7465 2075 726c 2066 6f72 207b 696d  lete url for {im
-00021b40: 6167 657d 206b 766d 2067 7565 7374 2069  age} kvm guest i
-00021b50: 6d61 6765 2229 0a20 2020 2020 2020 2020  mage").         
-00021b60: 2020 2020 2020 2020 2020 2020 2020 2077                 w
-00021b70: 6562 6272 6f77 7365 722e 6f70 656e 2875  ebbrowser.open(u
-00021b80: 726c 2c20 6e65 773d 322c 2061 7574 6f72  rl, new=2, autor
-00021b90: 6169 7365 3d54 7275 6529 0a20 2020 2020  aise=True).     
-00021ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021bb0: 2020 2075 726c 203d 2069 6e70 7574 2822     url = input("
-00021bc0: 436f 7079 2055 726c 3a5c 6e22 290a 2020  Copy Url:\n").  
-00021bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021be0: 2020 2020 2020 6966 2075 726c 2e73 7472        if url.str
-00021bf0: 6970 2829 203d 3d20 2727 3a0a 2020 2020  ip() == '':.    
-00021c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021c10: 2020 2020 2020 2020 6572 726f 7228 224d          error("M
-00021c20: 6973 7369 6e67 2070 726f 7065 7220 7572  issing proper ur
-00021c30: 6c2e 4c65 6176 696e 672e 2e2e 2229 0a20  l.Leaving..."). 
-00021c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021c50: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00021c60: 6e20 7b27 7265 7375 6c74 273a 2027 6661  n {'result': 'fa
-00021c70: 696c 7572 6527 2c20 2772 6561 736f 6e27  ilure', 'reason'
-00021c80: 3a20 224d 6973 7369 6e67 2069 6d61 6765  : "Missing image
-00021c90: 227d 0a20 2020 2020 2020 2020 2020 2020  "}.             
-00021ca0: 2020 2069 6620 636d 6420 6973 204e 6f6e     if cmd is Non
-00021cb0: 6520 616e 6420 696d 6167 6520 213d 2027  e and image != '
-00021cc0: 2720 616e 6420 696d 6167 6520 696e 2049  ' and image in I
-00021cd0: 4d41 4745 5343 4f4d 4d41 4e44 533a 0a20  MAGESCOMMANDS:. 
-00021ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021cf0: 2020 2063 6d64 203d 2049 4d41 4745 5343     cmd = IMAGESC
-00021d00: 4f4d 4d41 4e44 535b 696d 6167 655d 0a20  OMMANDS[image]. 
-00021d10: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00021d20: 7072 696e 7428 6622 4772 6162 6269 6e67  print(f"Grabbing
-00021d30: 2069 6d61 6765 207b 696d 6167 657d 2066   image {image} f
-00021d40: 726f 6d20 7572 6c20 7b75 726c 7d22 290a  rom url {url}").
-00021d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021d60: 6e65 6564 5f69 736f 203d 2027 6170 692f  need_iso = 'api/
-00021d70: 6173 7369 7374 6564 2d69 6d61 6765 732f  assisted-images/
-00021d80: 696d 6167 6573 2720 696e 2075 726c 0a20  images' in url. 
-00021d90: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00021da0: 686f 7274 6e61 6d65 203d 206f 732e 7061  hortname = os.pa
-00021db0: 7468 2e62 6173 656e 616d 6528 7572 6c29  th.basename(url)
-00021dc0: 2e73 706c 6974 2827 3f27 295b 305d 0a20  .split('?')[0]. 
-00021dd0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00021de0: 6620 6e65 6564 5f69 736f 3a0a 2020 2020  f need_iso:.    
-00021df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021e00: 696d 6167 6520 3d20 6627 626f 6f74 2d7b  image = f'boot-{
-00021e10: 7368 6f72 746e 616d 657d 2e69 736f 270a  shortname}.iso'.
-00021e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021e30: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-00021e40: 2020 2020 2020 2020 2063 6f6e 7665 7274           convert
-00021e50: 203d 2027 2e72 6177 2e27 2069 6e20 7572   = '.raw.' in ur
-00021e60: 6c0a 2020 2020 2020 2020 2020 2020 2020  l.              
-00021e70: 2020 2020 2020 7265 7375 6c74 203d 206b        result = k
-00021e80: 2e61 6464 5f69 6d61 6765 2875 726c 2c20  .add_image(url, 
-00021e90: 706f 6f6c 2c20 636d 643d 636d 642c 206e  pool, cmd=cmd, n
-00021ea0: 616d 653d 696d 6167 652c 2073 697a 653d  ame=image, size=
-00021eb0: 7369 7a65 2c20 636f 6e76 6572 743d 636f  size, convert=co
-00021ec0: 6e76 6572 7429 0a20 2020 2020 2020 2020  nvert).         
-00021ed0: 2020 2020 2020 2065 7863 6570 7420 4578         except Ex
-00021ee0: 6365 7074 696f 6e20 6173 2065 3a0a 2020  ception as e:.  
-00021ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021f00: 2020 6572 726f 7228 6622 476f 7420 7b65    error(f"Got {e
-00021f10: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
-00021f20: 2020 2020 2020 2020 6572 726f 7228 6622          error(f"
-00021f30: 506c 6561 7365 2072 756e 206b 636c 6920  Please run kcli 
-00021f40: 6465 6c65 7465 2069 6d61 6765 202d 2d79  delete image --y
-00021f50: 6573 207b 7368 6f72 746e 616d 657d 2229  es {shortname}")
-00021f60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00021f70: 2020 2020 2072 6574 7572 6e20 7b27 7265       return {'re
-00021f80: 7375 6c74 273a 2027 6661 696c 7572 6527  sult': 'failure'
-00021f90: 2c20 2772 6561 736f 6e27 3a20 2255 7365  , 'reason': "Use
-00021fa0: 7220 696e 7465 7272 7570 7469 6f6e 227d  r interruption"}
-00021fb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00021fc0: 2066 6f75 6e64 203d 2027 666f 756e 6427   found = 'found'
-00021fd0: 2069 6e20 7265 7375 6c74 0a20 2020 2020   in result.     
-00021fe0: 2020 2020 2020 2020 2020 2069 6620 666f             if fo
-00021ff0: 756e 643a 0a20 2020 2020 2020 2020 2020  und:.           
-00022000: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00022010: 7b27 7265 7375 6c74 273a 2027 7375 6363  {'result': 'succ
-00022020: 6573 7327 7d0a 2020 2020 2020 2020 2020  ess'}.          
-00022030: 2020 2020 2020 636f 6d6d 6f6e 2e68 616e        common.han
-00022040: 646c 655f 7265 7370 6f6e 7365 2872 6573  dle_response(res
-00022050: 756c 742c 2069 6d61 6765 2c20 656c 656d  ult, image, elem
-00022060: 656e 743d 2749 6d61 6765 272c 2061 6374  ent='Image', act
-00022070: 696f 6e3d 2741 6464 6564 2729 0a20 2020  ion='Added').   
-00022080: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00022090: 7265 7375 6c74 5b27 7265 7375 6c74 275d  result['result']
-000220a0: 2021 3d20 2773 7563 6365 7373 273a 0a20   != 'success':. 
-000220b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000220c0: 2020 2072 6574 7572 6e20 7b27 7265 7375     return {'resu
-000220d0: 6c74 273a 2027 6661 696c 7572 6527 2c20  lt': 'failure', 
-000220e0: 2772 6561 736f 6e27 3a20 7265 7375 6c74  'reason': result
-000220f0: 5b27 7265 6173 6f6e 275d 7d0a 2020 2020  ['reason']}.    
-00022100: 2020 2020 2020 2020 7265 7475 726e 207b          return {
-00022110: 2772 6573 756c 7427 3a20 2773 7563 6365  'result': 'succe
-00022120: 7373 277d 0a20 2020 2020 2020 2065 6c69  ss'}.        eli
-00022130: 6620 7377 6974 6368 3a0a 2020 2020 2020  f switch:.      
-00022140: 2020 2020 2020 6966 2073 7769 7463 6820        if switch 
-00022150: 6e6f 7420 696e 2073 656c 662e 636c 6965  not in self.clie
-00022160: 6e74 733a 0a20 2020 2020 2020 2020 2020  nts:.           
-00022170: 2020 2020 2065 7272 6f72 2866 2243 6c69       error(f"Cli
-00022180: 656e 7420 7b73 7769 7463 687d 206e 6f74  ent {switch} not
-00022190: 2066 6f75 6e64 2069 6e20 636f 6e66 6967   found in config
-000221a0: 2e4c 6561 7669 6e67 2e2e 2e2e 2229 0a20  .Leaving...."). 
-000221b0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-000221c0: 6574 7572 6e20 7b27 7265 7375 6c74 273a  eturn {'result':
-000221d0: 2027 6661 696c 7572 6527 2c20 2772 6561   'failure', 'rea
-000221e0: 736f 6e27 3a20 6622 436c 6965 6e74 207b  son': f"Client {
-000221f0: 7377 6974 6368 7d20 6e6f 7420 666f 756e  switch} not foun
-00022200: 6420 696e 2063 6f6e 6669 6722 7d0a 2020  d in config"}.  
-00022210: 2020 2020 2020 2020 2020 656e 6162 6c65            enable
-00022220: 6420 3d20 7365 6c66 2e69 6e69 5b73 7769  d = self.ini[swi
-00022230: 7463 685d 2e67 6574 2827 656e 6162 6c65  tch].get('enable
-00022240: 6427 2c20 5472 7565 290a 2020 2020 2020  d', True).      
-00022250: 2020 2020 2020 6966 206e 6f74 2065 6e61        if not ena
-00022260: 626c 6564 3a0a 2020 2020 2020 2020 2020  bled:.          
-00022270: 2020 2020 2020 6572 726f 7228 6622 436c        error(f"Cl
-00022280: 6965 6e74 207b 7377 6974 6368 7d20 6973  ient {switch} is
-00022290: 2064 6973 6162 6c65 642e 4c65 6176 696e   disabled.Leavin
-000222a0: 672e 2e2e 2e22 290a 2020 2020 2020 2020  g....").        
-000222b0: 2020 2020 2020 2020 7265 7475 726e 207b          return {
-000222c0: 2772 6573 756c 7427 3a20 2766 6169 6c75  'result': 'failu
-000222d0: 7265 272c 2027 7265 6173 6f6e 273a 2066  re', 'reason': f
-000222e0: 2243 6c69 656e 7420 7b73 7769 7463 687d  "Client {switch}
-000222f0: 2069 7320 6469 7361 626c 6564 227d 0a20   is disabled"}. 
-00022300: 2020 2020 2020 2020 2020 2070 7072 696e             pprin
-00022310: 7428 6622 5377 6974 6368 696e 6720 746f  t(f"Switching to
-00022320: 2063 6c69 656e 7420 7b73 7769 7463 687d   client {switch}
-00022330: 2e2e 2e22 290a 2020 2020 2020 2020 2020  ...").          
-00022340: 2020 696e 6966 696c 6520 3d20 2225 732f    inifile = "%s/
-00022350: 2e6b 636c 692f 636f 6e66 6967 2e79 6d6c  .kcli/config.yml
-00022360: 2220 2520 6f73 2e65 6e76 6972 6f6e 2e67  " % os.environ.g
-00022370: 6574 2827 484f 4d45 2729 0a20 2020 2020  et('HOME').     
-00022380: 2020 2020 2020 2069 6620 6f73 2e70 6174         if os.pat
-00022390: 682e 6578 6973 7473 2869 6e69 6669 6c65  h.exists(inifile
-000223a0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-000223b0: 2020 206e 6577 696e 6920 3d20 2727 0a20     newini = ''. 
-000223c0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-000223d0: 6f72 206c 696e 6520 696e 206f 7065 6e28  or line in open(
-000223e0: 696e 6966 696c 6529 2e72 6561 646c 696e  inifile).readlin
-000223f0: 6573 2829 3a0a 2020 2020 2020 2020 2020  es():.          
-00022400: 2020 2020 2020 2020 2020 6966 2027 636c            if 'cl
-00022410: 6965 6e74 2720 696e 206c 696e 653a 0a20  ient' in line:. 
-00022420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022430: 2020 2020 2020 206e 6577 696e 6920 2b3d         newini +=
-00022440: 2066 2220 636c 6965 6e74 3a20 7b73 7769   f" client: {swi
-00022450: 7463 687d 5c6e 220a 2020 2020 2020 2020  tch}\n".        
-00022460: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00022470: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00022480: 2020 2020 2020 2020 2020 6e65 7769 6e69            newini
-00022490: 202b 3d20 6c69 6e65 0a20 2020 2020 2020   += line.       
-000224a0: 2020 2020 2020 2020 206f 7065 6e28 696e           open(in
-000224b0: 6966 696c 652c 2027 7727 292e 7772 6974  ifile, 'w').writ
-000224c0: 6528 6e65 7769 6e69 290a 2020 2020 2020  e(newini).      
-000224d0: 2020 2020 2020 7265 7475 726e 207b 2772        return {'r
-000224e0: 6573 756c 7427 3a20 2773 7563 6365 7373  esult': 'success
-000224f0: 277d 0a20 2020 2020 2020 2065 6c69 6620  '}.        elif 
-00022500: 7379 6e63 3a0a 2020 2020 2020 2020 2020  sync:.          
-00022510: 2020 6b20 3d20 7365 6c66 2e6b 0a20 2020    k = self.k.   
-00022520: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-00022530: 7365 6c66 2e65 7874 7261 636c 6965 6e74  self.extraclient
-00022540: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-00022550: 2020 2077 6172 6e69 6e67 2822 4e6f 7468     warning("Noth
-00022560: 696e 6720 746f 2064 6f2e 204c 6561 7669  ing to do. Leavi
-00022570: 6e67 2e2e 2e22 290a 2020 2020 2020 2020  ng...").        
-00022580: 2020 2020 2020 2020 7265 7475 726e 207b          return {
-00022590: 2772 6573 756c 7427 3a20 2773 7563 6365  'result': 'succe
-000225a0: 7373 277d 0a20 2020 2020 2020 2020 2020  ss'}.           
-000225b0: 2066 6f72 2063 6c69 2069 6e20 7365 6c66   for cli in self
-000225c0: 2e65 7874 7261 636c 6965 6e74 733a 0a20  .extraclients:. 
-000225d0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-000225e0: 6573 7420 3d20 7365 6c66 2e65 7874 7261  est = self.extra
-000225f0: 636c 6965 6e74 735b 636c 695d 0a20 2020  clients[cli].   
-00022600: 2020 2020 2020 2020 2020 2020 2070 7072               ppr
-00022610: 696e 7428 6622 7379 6e63 696e 6720 636c  int(f"syncing cl
-00022620: 6965 6e74 2069 6d61 6765 7320 6672 6f6d  ient images from
-00022630: 207b 7365 6c66 2e63 6c69 656e 747d 2074   {self.client} t
-00022640: 6f20 7b63 6c69 7d22 290a 2020 2020 2020  o {cli}").      
-00022650: 2020 2020 2020 2020 2020 7761 726e 696e            warnin
-00022660: 6728 224e 6f74 6520 7268 656c 2069 6d61  g("Note rhel ima
-00022670: 6765 7320 6172 6520 6375 7272 656e 746c  ges are currentl
-00022680: 7920 6e6f 7420 7379 6e63 6564 2229 0a20  y not synced"). 
-00022690: 2020 2020 2020 2020 2020 2066 6f72 2076             for v
-000226a0: 6f6c 2069 6e20 6b2e 766f 6c75 6d65 7328  ol in k.volumes(
-000226b0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-000226c0: 2020 2069 6d61 6765 203d 206f 732e 7061     image = os.pa
-000226d0: 7468 2e62 6173 656e 616d 6528 766f 6c29  th.basename(vol)
-000226e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000226f0: 2069 6620 696d 6167 6520 696e 205b 6f73   if image in [os
-00022700: 2e70 6174 682e 6261 7365 6e61 6d65 2876  .path.basename(v
-00022710: 2920 666f 7220 7620 696e 2064 6573 742e  ) for v in dest.
-00022720: 766f 6c75 6d65 7328 295d 3a0a 2020 2020  volumes()]:.    
-00022730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022740: 7761 726e 696e 6728 6622 4967 6e6f 7269  warning(f"Ignori
-00022750: 6e67 207b 696d 6167 657d 2061 7320 6974  ng {image} as it
-00022760: 2773 2061 6c72 6561 6479 2074 6865 7265  's already there
-00022770: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-00022780: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
+00021ab0: 2020 2020 2070 7072 696e 7428 6622 4f70       pprint(f"Op
+00021ac0: 656e 696e 6720 7572 6c20 7b75 726c 7d20  ening url {url} 
+00021ad0: 666f 7220 796f 7520 746f 2067 7261 6220  for you to grab 
+00021ae0: 636f 6d70 6c65 7465 2075 726c 2066 6f72  complete url for
+00021af0: 207b 696d 6167 657d 206b 766d 2067 7565   {image} kvm gue
+00021b00: 7374 2069 6d61 6765 2229 0a20 2020 2020  st image").     
+00021b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021b20: 2020 2077 6562 6272 6f77 7365 722e 6f70     webbrowser.op
+00021b30: 656e 2875 726c 2c20 6e65 773d 322c 2061  en(url, new=2, a
+00021b40: 7574 6f72 6169 7365 3d54 7275 6529 0a20  utoraise=True). 
+00021b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021b60: 2020 2020 2020 2075 726c 203d 2069 6e70         url = inp
+00021b70: 7574 2822 436f 7079 2055 726c 3a5c 6e22  ut("Copy Url:\n"
+00021b80: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00021b90: 2020 2020 2020 2020 2020 6966 2075 726c            if url
+00021ba0: 2e73 7472 6970 2829 203d 3d20 2727 3a0a  .strip() == '':.
+00021bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021bc0: 2020 2020 2020 2020 2020 2020 6572 726f              erro
+00021bd0: 7228 224d 6973 7369 6e67 2070 726f 7065  r("Missing prope
+00021be0: 7220 7572 6c2e 4c65 6176 696e 672e 2e2e  r url.Leaving...
+00021bf0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+00021c00: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00021c10: 6574 7572 6e20 7b27 7265 7375 6c74 273a  eturn {'result':
+00021c20: 2027 6661 696c 7572 6527 2c20 2772 6561   'failure', 'rea
+00021c30: 736f 6e27 3a20 224d 6973 7369 6e67 2069  son': "Missing i
+00021c40: 6d61 6765 227d 0a20 2020 2020 2020 2020  mage"}.         
+00021c50: 2020 2020 2020 2069 6620 636d 6420 6973         if cmd is
+00021c60: 204e 6f6e 6520 616e 6420 696d 6167 6520   None and image 
+00021c70: 213d 2027 2720 616e 6420 696d 6167 6520  != '' and image 
+00021c80: 696e 2049 4d41 4745 5343 4f4d 4d41 4e44  in IMAGESCOMMAND
+00021c90: 533a 0a20 2020 2020 2020 2020 2020 2020  S:.             
+00021ca0: 2020 2020 2020 2063 6d64 203d 2049 4d41         cmd = IMA
+00021cb0: 4745 5343 4f4d 4d41 4e44 535b 696d 6167  GESCOMMANDS[imag
+00021cc0: 655d 0a20 2020 2020 2020 2020 2020 2020  e].             
+00021cd0: 2020 2070 7072 696e 7428 6622 4772 6162     pprint(f"Grab
+00021ce0: 6269 6e67 2069 6d61 6765 207b 696d 6167  bing image {imag
+00021cf0: 657d 2066 726f 6d20 7572 6c20 7b75 726c  e} from url {url
+00021d00: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
+00021d10: 2020 2020 6e65 6564 5f69 736f 203d 2027      need_iso = '
+00021d20: 6170 692f 6173 7369 7374 6564 2d69 6d61  api/assisted-ima
+00021d30: 6765 732f 696d 6167 6573 2720 696e 2075  ges/images' in u
+00021d40: 726c 0a20 2020 2020 2020 2020 2020 2020  rl.             
+00021d50: 2020 2073 686f 7274 6e61 6d65 203d 206f     shortname = o
+00021d60: 732e 7061 7468 2e62 6173 656e 616d 6528  s.path.basename(
+00021d70: 7572 6c29 2e73 706c 6974 2827 3f27 295b  url).split('?')[
+00021d80: 305d 0a20 2020 2020 2020 2020 2020 2020  0].             
+00021d90: 2020 2069 6620 6e65 6564 5f69 736f 3a0a     if need_iso:.
+00021da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021db0: 2020 2020 696d 6167 6520 3d20 6627 626f      image = f'bo
+00021dc0: 6f74 2d7b 7368 6f72 746e 616d 657d 2e69  ot-{shortname}.i
+00021dd0: 736f 270a 2020 2020 2020 2020 2020 2020  so'.            
+00021de0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+00021df0: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+00021e00: 7665 7274 203d 2027 2e72 6177 2e27 2069  vert = '.raw.' i
+00021e10: 6e20 7572 6c0a 2020 2020 2020 2020 2020  n url.          
+00021e20: 2020 2020 2020 2020 2020 7265 7375 6c74            result
+00021e30: 203d 206b 2e61 6464 5f69 6d61 6765 2875   = k.add_image(u
+00021e40: 726c 2c20 706f 6f6c 2c20 636d 643d 636d  rl, pool, cmd=cm
+00021e50: 642c 206e 616d 653d 696d 6167 652c 2073  d, name=image, s
+00021e60: 697a 653d 7369 7a65 2c20 636f 6e76 6572  ize=size, conver
+00021e70: 743d 636f 6e76 6572 7429 0a20 2020 2020  t=convert).     
+00021e80: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+00021e90: 7420 4578 6365 7074 696f 6e20 6173 2065  t Exception as e
+00021ea0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00021eb0: 2020 2020 2020 6572 726f 7228 6622 476f        error(f"Go
+00021ec0: 7420 7b65 7d22 290a 2020 2020 2020 2020  t {e}").        
+00021ed0: 2020 2020 2020 2020 2020 2020 6572 726f              erro
+00021ee0: 7228 6622 506c 6561 7365 2072 756e 206b  r(f"Please run k
+00021ef0: 636c 6920 6465 6c65 7465 2069 6d61 6765  cli delete image
+00021f00: 202d 2d79 6573 207b 7368 6f72 746e 616d   --yes {shortnam
+00021f10: 657d 2229 0a20 2020 2020 2020 2020 2020  e}").           
+00021f20: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00021f30: 7b27 7265 7375 6c74 273a 2027 6661 696c  {'result': 'fail
+00021f40: 7572 6527 2c20 2772 6561 736f 6e27 3a20  ure', 'reason': 
+00021f50: 2255 7365 7220 696e 7465 7272 7570 7469  "User interrupti
+00021f60: 6f6e 227d 0a20 2020 2020 2020 2020 2020  on"}.           
+00021f70: 2020 2020 2066 6f75 6e64 203d 2027 666f       found = 'fo
+00021f80: 756e 6427 2069 6e20 7265 7375 6c74 0a20  und' in result. 
+00021f90: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00021fa0: 6620 666f 756e 643a 0a20 2020 2020 2020  f found:.       
+00021fb0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+00021fc0: 7572 6e20 7b27 7265 7375 6c74 273a 2027  urn {'result': '
+00021fd0: 7375 6363 6573 7327 7d0a 2020 2020 2020  success'}.      
+00021fe0: 2020 2020 2020 2020 2020 636f 6d6d 6f6e            common
+00021ff0: 2e68 616e 646c 655f 7265 7370 6f6e 7365  .handle_response
+00022000: 2872 6573 756c 742c 2069 6d61 6765 2c20  (result, image, 
+00022010: 656c 656d 656e 743d 2749 6d61 6765 272c  element='Image',
+00022020: 2061 6374 696f 6e3d 2741 6464 6564 2729   action='Added')
+00022030: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00022040: 2069 6620 7265 7375 6c74 5b27 7265 7375   if result['resu
+00022050: 6c74 275d 2021 3d20 2773 7563 6365 7373  lt'] != 'success
+00022060: 273a 0a20 2020 2020 2020 2020 2020 2020  ':.             
+00022070: 2020 2020 2020 2072 6574 7572 6e20 7b27         return {'
+00022080: 7265 7375 6c74 273a 2027 6661 696c 7572  result': 'failur
+00022090: 6527 2c20 2772 6561 736f 6e27 3a20 7265  e', 'reason': re
+000220a0: 7375 6c74 5b27 7265 6173 6f6e 275d 7d0a  sult['reason']}.
+000220b0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+000220c0: 726e 207b 2772 6573 756c 7427 3a20 2773  rn {'result': 's
+000220d0: 7563 6365 7373 277d 0a20 2020 2020 2020  uccess'}.       
+000220e0: 2065 6c69 6620 7377 6974 6368 3a0a 2020   elif switch:.  
+000220f0: 2020 2020 2020 2020 2020 6966 2073 7769            if swi
+00022100: 7463 6820 6e6f 7420 696e 2073 656c 662e  tch not in self.
+00022110: 636c 6965 6e74 733a 0a20 2020 2020 2020  clients:.       
+00022120: 2020 2020 2020 2020 2065 7272 6f72 2866           error(f
+00022130: 2243 6c69 656e 7420 7b73 7769 7463 687d  "Client {switch}
+00022140: 206e 6f74 2066 6f75 6e64 2069 6e20 636f   not found in co
+00022150: 6e66 6967 2e4c 6561 7669 6e67 2e2e 2e2e  nfig.Leaving....
+00022160: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+00022170: 2020 2072 6574 7572 6e20 7b27 7265 7375     return {'resu
+00022180: 6c74 273a 2027 6661 696c 7572 6527 2c20  lt': 'failure', 
+00022190: 2772 6561 736f 6e27 3a20 6622 436c 6965  'reason': f"Clie
+000221a0: 6e74 207b 7377 6974 6368 7d20 6e6f 7420  nt {switch} not 
+000221b0: 666f 756e 6420 696e 2063 6f6e 6669 6722  found in config"
+000221c0: 7d0a 2020 2020 2020 2020 2020 2020 656e  }.            en
+000221d0: 6162 6c65 6420 3d20 7365 6c66 2e69 6e69  abled = self.ini
+000221e0: 5b73 7769 7463 685d 2e67 6574 2827 656e  [switch].get('en
+000221f0: 6162 6c65 6427 2c20 5472 7565 290a 2020  abled', True).  
+00022200: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+00022210: 2065 6e61 626c 6564 3a0a 2020 2020 2020   enabled:.      
+00022220: 2020 2020 2020 2020 2020 6572 726f 7228            error(
+00022230: 6622 436c 6965 6e74 207b 7377 6974 6368  f"Client {switch
+00022240: 7d20 6973 2064 6973 6162 6c65 642e 4c65  } is disabled.Le
+00022250: 6176 696e 672e 2e2e 2e22 290a 2020 2020  aving....").    
+00022260: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00022270: 726e 207b 2772 6573 756c 7427 3a20 2766  rn {'result': 'f
+00022280: 6169 6c75 7265 272c 2027 7265 6173 6f6e  ailure', 'reason
+00022290: 273a 2066 2243 6c69 656e 7420 7b73 7769  ': f"Client {swi
+000222a0: 7463 687d 2069 7320 6469 7361 626c 6564  tch} is disabled
+000222b0: 227d 0a20 2020 2020 2020 2020 2020 2070  "}.            p
+000222c0: 7072 696e 7428 6622 5377 6974 6368 696e  print(f"Switchin
+000222d0: 6720 746f 2063 6c69 656e 7420 7b73 7769  g to client {swi
+000222e0: 7463 687d 2e2e 2e22 290a 2020 2020 2020  tch}...").      
+000222f0: 2020 2020 2020 696e 6966 696c 6520 3d20        inifile = 
+00022300: 2225 732f 2e6b 636c 692f 636f 6e66 6967  "%s/.kcli/config
+00022310: 2e79 6d6c 2220 2520 6f73 2e65 6e76 6972  .yml" % os.envir
+00022320: 6f6e 2e67 6574 2827 484f 4d45 2729 0a20  on.get('HOME'). 
+00022330: 2020 2020 2020 2020 2020 2069 6620 6f73             if os
+00022340: 2e70 6174 682e 6578 6973 7473 2869 6e69  .path.exists(ini
+00022350: 6669 6c65 293a 0a20 2020 2020 2020 2020  file):.         
+00022360: 2020 2020 2020 206e 6577 696e 6920 3d20         newini = 
+00022370: 2727 0a20 2020 2020 2020 2020 2020 2020  ''.             
+00022380: 2020 2066 6f72 206c 696e 6520 696e 206f     for line in o
+00022390: 7065 6e28 696e 6966 696c 6529 2e72 6561  pen(inifile).rea
+000223a0: 646c 696e 6573 2829 3a0a 2020 2020 2020  dlines():.      
+000223b0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+000223c0: 2027 636c 6965 6e74 2720 696e 206c 696e   'client' in lin
+000223d0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+000223e0: 2020 2020 2020 2020 2020 206e 6577 696e             newin
+000223f0: 6920 2b3d 2066 2220 636c 6965 6e74 3a20  i += f" client: 
+00022400: 7b73 7769 7463 687d 5c6e 220a 2020 2020  {switch}\n".    
+00022410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022420: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00022430: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
+00022440: 7769 6e69 202b 3d20 6c69 6e65 0a20 2020  wini += line.   
+00022450: 2020 2020 2020 2020 2020 2020 206f 7065               ope
+00022460: 6e28 696e 6966 696c 652c 2027 7727 292e  n(inifile, 'w').
+00022470: 7772 6974 6528 6e65 7769 6e69 290a 2020  write(newini).  
+00022480: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00022490: 207b 2772 6573 756c 7427 3a20 2773 7563   {'result': 'suc
+000224a0: 6365 7373 277d 0a20 2020 2020 2020 2065  cess'}.        e
+000224b0: 6c69 6620 7379 6e63 3a0a 2020 2020 2020  lif sync:.      
+000224c0: 2020 2020 2020 6b20 3d20 7365 6c66 2e6b        k = self.k
+000224d0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000224e0: 6e6f 7420 7365 6c66 2e65 7874 7261 636c  not self.extracl
+000224f0: 6965 6e74 733a 0a20 2020 2020 2020 2020  ients:.         
+00022500: 2020 2020 2020 2077 6172 6e69 6e67 2822         warning("
+00022510: 4e6f 7468 696e 6720 746f 2064 6f2e 204c  Nothing to do. L
+00022520: 6561 7669 6e67 2e2e 2e22 290a 2020 2020  eaving...").    
+00022530: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00022540: 726e 207b 2772 6573 756c 7427 3a20 2773  rn {'result': 's
+00022550: 7563 6365 7373 277d 0a20 2020 2020 2020  uccess'}.       
+00022560: 2020 2020 2066 6f72 2063 6c69 2069 6e20       for cli in 
+00022570: 7365 6c66 2e65 7874 7261 636c 6965 6e74  self.extraclient
+00022580: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+00022590: 2020 2064 6573 7420 3d20 7365 6c66 2e65     dest = self.e
+000225a0: 7874 7261 636c 6965 6e74 735b 636c 695d  xtraclients[cli]
+000225b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000225c0: 2070 7072 696e 7428 6622 7379 6e63 696e   pprint(f"syncin
+000225d0: 6720 636c 6965 6e74 2069 6d61 6765 7320  g client images 
+000225e0: 6672 6f6d 207b 7365 6c66 2e63 6c69 656e  from {self.clien
+000225f0: 747d 2074 6f20 7b63 6c69 7d22 290a 2020  t} to {cli}").  
+00022600: 2020 2020 2020 2020 2020 2020 2020 7761                wa
+00022610: 726e 696e 6728 224e 6f74 6520 7268 656c  rning("Note rhel
+00022620: 2069 6d61 6765 7320 6172 6520 6375 7272   images are curr
+00022630: 656e 746c 7920 6e6f 7420 7379 6e63 6564  ently not synced
+00022640: 2229 0a20 2020 2020 2020 2020 2020 2066  ").            f
+00022650: 6f72 2076 6f6c 2069 6e20 6b2e 766f 6c75  or vol in k.volu
+00022660: 6d65 7328 293a 0a20 2020 2020 2020 2020  mes():.         
+00022670: 2020 2020 2020 2069 6d61 6765 203d 206f         image = o
+00022680: 732e 7061 7468 2e62 6173 656e 616d 6528  s.path.basename(
+00022690: 766f 6c29 0a20 2020 2020 2020 2020 2020  vol).           
+000226a0: 2020 2020 2069 6620 696d 6167 6520 696e       if image in
+000226b0: 205b 6f73 2e70 6174 682e 6261 7365 6e61   [os.path.basena
+000226c0: 6d65 2876 2920 666f 7220 7620 696e 2064  me(v) for v in d
+000226d0: 6573 742e 766f 6c75 6d65 7328 295d 3a0a  est.volumes()]:.
+000226e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000226f0: 2020 2020 7761 726e 696e 6728 6622 4967      warning(f"Ig
+00022700: 6e6f 7269 6e67 207b 696d 6167 657d 2061  noring {image} a
+00022710: 7320 6974 2773 2061 6c72 6561 6479 2074  s it's already t
+00022720: 6865 7265 2229 0a20 2020 2020 2020 2020  here").         
+00022730: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
+00022740: 6e75 650a 2020 2020 2020 2020 2020 2020  nue.            
+00022750: 2020 2020 7572 6c20 3d20 4e6f 6e65 0a20      url = None. 
+00022760: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00022770: 6f72 206e 2069 6e20 6c69 7374 2849 4d41  or n in list(IMA
+00022780: 4745 532e 7661 6c75 6573 2829 293a 0a20  GES.values()):. 
 00022790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000227a0: 7572 6c20 3d20 4e6f 6e65 0a20 2020 2020  url = None.     
-000227b0: 2020 2020 2020 2020 2020 2066 6f72 206e             for n
-000227c0: 2069 6e20 6c69 7374 2849 4d41 4745 532e   in list(IMAGES.
-000227d0: 7661 6c75 6573 2829 293a 0a20 2020 2020  values()):.     
-000227e0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000227f0: 6620 6e20 6973 204e 6f6e 653a 0a20 2020  f n is None:.   
-00022800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022810: 2020 2020 2063 6f6e 7469 6e75 650a 2020       continue.  
-00022820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022830: 2020 656c 6966 206e 2e73 706c 6974 2827    elif n.split('
-00022840: 2f27 295b 2d31 5d20 3d3d 2069 6d61 6765  /')[-1] == image
-00022850: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00022860: 2020 2020 2020 2020 2020 7572 6c20 3d20            url = 
-00022870: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
-00022880: 2020 6966 2075 726c 2069 7320 4e6f 6e65    if url is None
-00022890: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000228a0: 2020 2020 2020 7265 7475 726e 207b 2772        return {'r
-000228b0: 6573 756c 7427 3a20 2766 6169 6c75 7265  esult': 'failure
-000228c0: 272c 2027 7265 6173 6f6e 273a 2022 696d  ', 'reason': "im
-000228d0: 6167 6520 6e6f 7420 696e 2064 6566 6175  age not in defau
-000228e0: 6c74 206c 6973 7422 7d0a 2020 2020 2020  lt list"}.      
-000228f0: 2020 2020 2020 2020 2020 6966 2069 6d61            if ima
-00022900: 6765 2e73 7461 7274 7377 6974 6828 2772  ge.startswith('r
-00022910: 6865 6c27 293a 0a20 2020 2020 2020 2020  hel'):.         
-00022920: 2020 2020 2020 2020 2020 2069 6620 2777             if 'w
-00022930: 6562 2720 696e 2073 7973 2e61 7267 765b  eb' in sys.argv[
-00022940: 305d 3a0a 2020 2020 2020 2020 2020 2020  0]:.            
-00022950: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00022960: 726e 207b 2772 6573 756c 7427 3a20 2766  rn {'result': 'f
-00022970: 6169 6c75 7265 272c 2027 7265 6173 6f6e  ailure', 'reason
-00022980: 273a 2022 4d69 7373 696e 6720 7572 6c22  ': "Missing url"
-00022990: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
-000229a0: 2020 2020 2020 7070 7269 6e74 2866 224f        pprint(f"O
-000229b0: 7065 6e69 6e67 2075 726c 207b 7572 6c7d  pening url {url}
-000229c0: 2066 6f72 2079 6f75 2074 6f20 6772 6162   for you to grab
-000229d0: 2063 6f6d 706c 6574 6520 7572 6c20 666f   complete url fo
-000229e0: 7220 7b76 6f6c 7d20 6b76 6d20 6775 6573  r {vol} kvm gues
-000229f0: 7420 696d 6167 6522 290a 2020 2020 2020  t image").      
-00022a00: 2020 2020 2020 2020 2020 2020 2020 7765                we
-00022a10: 6262 726f 7773 6572 2e6f 7065 6e28 7572  bbrowser.open(ur
-00022a20: 6c2c 206e 6577 3d32 2c20 6175 746f 7261  l, new=2, autora
-00022a30: 6973 653d 5472 7565 290a 2020 2020 2020  ise=True).      
-00022a40: 2020 2020 2020 2020 2020 2020 2020 7572                ur
-00022a50: 6c20 3d20 696e 7075 7428 2243 6f70 7920  l = input("Copy 
-00022a60: 5572 6c3a 5c6e 2229 0a20 2020 2020 2020  Url:\n").       
-00022a70: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00022a80: 7572 6c2e 7374 7269 7028 2920 3d3d 2027  url.strip() == '
-00022a90: 273a 0a20 2020 2020 2020 2020 2020 2020  ':.             
-00022aa0: 2020 2020 2020 2020 2020 2065 7272 6f72             error
-00022ab0: 2822 4d69 7373 696e 6720 7072 6f70 6572  ("Missing proper
-00022ac0: 2075 726c 2e4c 6561 7669 6e67 2e2e 2e22   url.Leaving..."
-00022ad0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00022ae0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00022af0: 207b 2772 6573 756c 7427 3a20 2766 6169   {'result': 'fai
-00022b00: 6c75 7265 272c 2027 7265 6173 6f6e 273a  lure', 'reason':
-00022b10: 2022 4d69 7373 696e 6720 696d 6167 6522   "Missing image"
-00022b20: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
-00022b30: 2020 636d 6420 3d20 4e6f 6e65 0a20 2020    cmd = None.   
-00022b40: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00022b50: 766f 6c20 696e 2049 4d41 4745 5343 4f4d  vol in IMAGESCOM
-00022b60: 4d41 4e44 533a 0a20 2020 2020 2020 2020  MANDS:.         
-00022b70: 2020 2020 2020 2020 2020 2063 6d64 203d             cmd =
-00022b80: 2049 4d41 4745 5343 4f4d 4d41 4e44 535b   IMAGESCOMMANDS[
-00022b90: 696d 6167 655d 0a20 2020 2020 2020 2020  image].         
-00022ba0: 2020 2020 2020 2070 7072 696e 7428 6622         pprint(f"
-00022bb0: 4772 6162 6269 6e67 2069 6d61 6765 207b  Grabbing image {
-00022bc0: 696d 6167 657d 2e2e 2e22 290a 2020 2020  image}...").    
-00022bd0: 2020 2020 2020 2020 2020 2020 6465 7374              dest
-00022be0: 2e61 6464 5f69 6d61 6765 2875 726c 2c20  .add_image(url, 
-00022bf0: 706f 6f6c 2c20 636d 643d 636d 6429 0a20  pool, cmd=cmd). 
-00022c00: 2020 2020 2020 2072 6574 7572 6e20 7b27         return {'
-00022c10: 7265 7375 6c74 273a 2027 7375 6363 6573  result': 'succes
-00022c20: 7327 7d0a 0a20 2020 2064 6566 2064 656c  s'}..    def del
-00022c30: 6574 655f 6c6f 6164 6261 6c61 6e63 6572  ete_loadbalancer
-00022c40: 2873 656c 662c 206e 616d 652c 2064 6f6d  (self, name, dom
-00022c50: 6169 6e3d 4e6f 6e65 293a 0a20 2020 2020  ain=None):.     
-00022c60: 2020 206b 203d 2073 656c 662e 6b0a 2020     k = self.k.  
-00022c70: 2020 2020 2020 7070 7269 6e74 2866 2244        pprint(f"D
-00022c80: 656c 6574 696e 6720 6c6f 6164 6261 6c61  eleting loadbala
-00022c90: 6e63 6572 207b 6e61 6d65 7d22 290a 2020  ncer {name}").  
-00022ca0: 2020 2020 2020 6966 2073 656c 662e 7479        if self.ty
-00022cb0: 7065 2069 6e20 5b27 6177 7327 2c20 2767  pe in ['aws', 'g
-00022cc0: 6370 272c 2027 6962 6d27 5d3a 0a20 2020  cp', 'ibm']:.   
-00022cd0: 2020 2020 2020 2020 2064 6e73 636c 6965           dnsclie
-00022ce0: 6e74 203d 206b 2e64 656c 6574 655f 6c6f  nt = k.delete_lo
-00022cf0: 6164 6261 6c61 6e63 6572 286e 616d 6529  adbalancer(name)
-00022d00: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00022d10: 646f 6d61 696e 2069 7320 6e6f 7420 4e6f  domain is not No
-00022d20: 6e65 2061 6e64 2064 6e73 636c 6965 6e74  ne and dnsclient
-00022d30: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
-00022d40: 2069 7369 6e73 7461 6e63 6528 646e 7363   isinstance(dnsc
-00022d50: 6c69 656e 742c 2073 7472 293a 0a20 2020  lient, str):.   
-00022d60: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00022d70: 646e 7363 6c69 656e 7420 696e 2073 656c  dnsclient in sel
-00022d80: 662e 636c 6965 6e74 733a 0a20 2020 2020  f.clients:.     
-00022d90: 2020 2020 2020 2020 2020 2020 2020 207a                 z
-00022da0: 203d 204b 636f 6e66 6967 2863 6c69 656e   = Kconfig(clien
-00022db0: 743d 646e 7363 6c69 656e 7429 2e6b 0a20  t=dnsclient).k. 
-00022dc0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00022dd0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00022de0: 2020 2020 2020 2020 2077 6172 6e69 6e67           warning
-00022df0: 2866 2243 6c69 656e 7420 7b64 6e73 636c  (f"Client {dnscl
-00022e00: 6965 6e74 7d20 6e6f 7420 666f 756e 642e  ient} not found.
-00022e10: 2053 6b69 7070 696e 6722 290a 2020 2020   Skipping").    
-00022e20: 2020 2020 2020 2020 2020 2020 7a2e 6465              z.de
-00022e30: 6c65 7465 5f64 6e73 286e 616d 652e 7265  lete_dns(name.re
-00022e40: 706c 6163 6528 275f 272c 2027 2d27 292c  place('_', '-'),
-00022e50: 2064 6f6d 6169 6e29 0a20 2020 2020 2020   domain).       
-00022e60: 2065 6c69 6620 7365 6c66 2e74 7970 6520   elif self.type 
-00022e70: 3d3d 2027 6b76 6d27 3a0a 2020 2020 2020  == 'kvm':.      
-00022e80: 2020 2020 2020 6b2e 6465 6c65 7465 286e        k.delete(n
-00022e90: 616d 6529 0a0a 2020 2020 6465 6620 6372  ame)..    def cr
-00022ea0: 6561 7465 5f6c 6f61 6462 616c 616e 6365  eate_loadbalance
-00022eb0: 7228 7365 6c66 2c20 6e61 6d65 2c20 6e65  r(self, name, ne
-00022ec0: 7473 3d5b 2764 6566 6175 6c74 275d 2c20  ts=['default'], 
-00022ed0: 706f 7274 733d 5b5d 2c20 6368 6563 6b70  ports=[], checkp
-00022ee0: 6174 683d 272f 272c 2076 6d73 3d5b 5d2c  ath='/', vms=[],
-00022ef0: 2064 6f6d 6169 6e3d 4e6f 6e65 2c0a 2020   domain=None,.  
-00022f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00022f10: 2020 2020 2020 2020 2020 706c 616e 3d4e            plan=N
-00022f20: 6f6e 652c 2063 6865 636b 706f 7274 3d38  one, checkport=8
-00022f30: 302c 2061 6c69 6173 3d5b 5d2c 2069 6e74  0, alias=[], int
-00022f40: 6572 6e61 6c3d 4661 6c73 652c 2064 6e73  ernal=False, dns
-00022f50: 636c 6965 6e74 3d4e 6f6e 652c 2073 7562  client=None, sub
-00022f60: 6e65 7469 643d 4e6f 6e65 2c20 6970 3d4e  netid=None, ip=N
-00022f70: 6f6e 6529 3a0a 2020 2020 2020 2020 6e61  one):.        na
-00022f80: 6d65 203d 206e 616d 6575 7469 6c73 2e67  me = nameutils.g
-00022f90: 6574 5f72 616e 646f 6d5f 6e61 6d65 2829  et_random_name()
-00022fa0: 2e72 6570 6c61 6365 2827 5f27 2c20 272d  .replace('_', '-
-00022fb0: 2729 2069 6620 6e61 6d65 2069 7320 4e6f  ') if name is No
-00022fc0: 6e65 2065 6c73 6520 6e61 6d65 0a20 2020  ne else name.   
-00022fd0: 2020 2020 2070 7072 696e 7428 6622 4465       pprint(f"De
-00022fe0: 706c 6f79 696e 6720 6c6f 6164 6261 6c61  ploying loadbala
-00022ff0: 6e63 6572 207b 6e61 6d65 7d22 290a 2020  ncer {name}").  
-00023000: 2020 2020 2020 6b20 3d20 7365 6c66 2e6b        k = self.k
-00023010: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-00023020: 2e74 7970 6520 696e 205b 2761 7773 272c  .type in ['aws',
-00023030: 2027 6763 7027 2c20 2769 626d 275d 3a0a   'gcp', 'ibm']:.
-00023040: 2020 2020 2020 2020 2020 2020 6c62 5f69              lb_i
-00023050: 7020 3d20 6b2e 6372 6561 7465 5f6c 6f61  p = k.create_loa
-00023060: 6462 616c 616e 6365 7228 6e61 6d65 2c20  dbalancer(name, 
-00023070: 706f 7274 733d 706f 7274 732c 2063 6865  ports=ports, che
-00023080: 636b 7061 7468 3d63 6865 636b 7061 7468  ckpath=checkpath
-00023090: 2c20 766d 733d 766d 732c 2064 6f6d 6169  , vms=vms, domai
-000230a0: 6e3d 646f 6d61 696e 2c0a 2020 2020 2020  n=domain,.      
-000230b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000227a0: 2020 2069 6620 6e20 6973 204e 6f6e 653a     if n is None:
+000227b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000227c0: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
+000227d0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+000227e0: 2020 2020 2020 656c 6966 206e 2e73 706c        elif n.spl
+000227f0: 6974 2827 2f27 295b 2d31 5d20 3d3d 2069  it('/')[-1] == i
+00022800: 6d61 6765 3a0a 2020 2020 2020 2020 2020  mage:.          
+00022810: 2020 2020 2020 2020 2020 2020 2020 7572                ur
+00022820: 6c20 3d20 6e0a 2020 2020 2020 2020 2020  l = n.          
+00022830: 2020 2020 2020 6966 2075 726c 2069 7320        if url is 
+00022840: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00022850: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00022860: 207b 2772 6573 756c 7427 3a20 2766 6169   {'result': 'fai
+00022870: 6c75 7265 272c 2027 7265 6173 6f6e 273a  lure', 'reason':
+00022880: 2022 696d 6167 6520 6e6f 7420 696e 2064   "image not in d
+00022890: 6566 6175 6c74 206c 6973 7422 7d0a 2020  efault list"}.  
+000228a0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+000228b0: 2069 6d61 6765 2e73 7461 7274 7377 6974   image.startswit
+000228c0: 6828 2772 6865 6c27 293a 0a20 2020 2020  h('rhel'):.     
+000228d0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000228e0: 6620 2777 6562 2720 696e 2073 7973 2e61  f 'web' in sys.a
+000228f0: 7267 765b 305d 3a0a 2020 2020 2020 2020  rgv[0]:.        
+00022900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022910: 7265 7475 726e 207b 2772 6573 756c 7427  return {'result'
+00022920: 3a20 2766 6169 6c75 7265 272c 2027 7265  : 'failure', 're
+00022930: 6173 6f6e 273a 2022 4d69 7373 696e 6720  ason': "Missing 
+00022940: 7572 6c22 7d0a 2020 2020 2020 2020 2020  url"}.          
+00022950: 2020 2020 2020 2020 2020 7070 7269 6e74            pprint
+00022960: 2866 224f 7065 6e69 6e67 2075 726c 207b  (f"Opening url {
+00022970: 7572 6c7d 2066 6f72 2079 6f75 2074 6f20  url} for you to 
+00022980: 6772 6162 2063 6f6d 706c 6574 6520 7572  grab complete ur
+00022990: 6c20 666f 7220 7b76 6f6c 7d20 6b76 6d20  l for {vol} kvm 
+000229a0: 6775 6573 7420 696d 6167 6522 290a 2020  guest image").  
+000229b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000229c0: 2020 7765 6262 726f 7773 6572 2e6f 7065    webbrowser.ope
+000229d0: 6e28 7572 6c2c 206e 6577 3d32 2c20 6175  n(url, new=2, au
+000229e0: 746f 7261 6973 653d 5472 7565 290a 2020  toraise=True).  
+000229f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022a00: 2020 7572 6c20 3d20 696e 7075 7428 2243    url = input("C
+00022a10: 6f70 7920 5572 6c3a 5c6e 2229 0a20 2020  opy Url:\n").   
+00022a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022a30: 2069 6620 7572 6c2e 7374 7269 7028 2920   if url.strip() 
+00022a40: 3d3d 2027 273a 0a20 2020 2020 2020 2020  == '':.         
+00022a50: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00022a60: 7272 6f72 2822 4d69 7373 696e 6720 7072  rror("Missing pr
+00022a70: 6f70 6572 2075 726c 2e4c 6561 7669 6e67  oper url.Leaving
+00022a80: 2e2e 2e22 290a 2020 2020 2020 2020 2020  ...").          
+00022a90: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00022aa0: 7475 726e 207b 2772 6573 756c 7427 3a20  turn {'result': 
+00022ab0: 2766 6169 6c75 7265 272c 2027 7265 6173  'failure', 'reas
+00022ac0: 6f6e 273a 2022 4d69 7373 696e 6720 696d  on': "Missing im
+00022ad0: 6167 6522 7d0a 2020 2020 2020 2020 2020  age"}.          
+00022ae0: 2020 2020 2020 636d 6420 3d20 4e6f 6e65        cmd = None
+00022af0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00022b00: 2069 6620 766f 6c20 696e 2049 4d41 4745   if vol in IMAGE
+00022b10: 5343 4f4d 4d41 4e44 533a 0a20 2020 2020  SCOMMANDS:.     
+00022b20: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00022b30: 6d64 203d 2049 4d41 4745 5343 4f4d 4d41  md = IMAGESCOMMA
+00022b40: 4e44 535b 696d 6167 655d 0a20 2020 2020  NDS[image].     
+00022b50: 2020 2020 2020 2020 2020 2070 7072 696e             pprin
+00022b60: 7428 6622 4772 6162 6269 6e67 2069 6d61  t(f"Grabbing ima
+00022b70: 6765 207b 696d 6167 657d 2e2e 2e22 290a  ge {image}...").
+00022b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022b90: 6465 7374 2e61 6464 5f69 6d61 6765 2875  dest.add_image(u
+00022ba0: 726c 2c20 706f 6f6c 2c20 636d 643d 636d  rl, pool, cmd=cm
+00022bb0: 6429 0a20 2020 2020 2020 2072 6574 7572  d).        retur
+00022bc0: 6e20 7b27 7265 7375 6c74 273a 2027 7375  n {'result': 'su
+00022bd0: 6363 6573 7327 7d0a 0a20 2020 2064 6566  ccess'}..    def
+00022be0: 2064 656c 6574 655f 6c6f 6164 6261 6c61   delete_loadbala
+00022bf0: 6e63 6572 2873 656c 662c 206e 616d 652c  ncer(self, name,
+00022c00: 2064 6f6d 6169 6e3d 4e6f 6e65 293a 0a20   domain=None):. 
+00022c10: 2020 2020 2020 206b 203d 2073 656c 662e         k = self.
+00022c20: 6b0a 2020 2020 2020 2020 7070 7269 6e74  k.        pprint
+00022c30: 2866 2244 656c 6574 696e 6720 6c6f 6164  (f"Deleting load
+00022c40: 6261 6c61 6e63 6572 207b 6e61 6d65 7d22  balancer {name}"
+00022c50: 290a 2020 2020 2020 2020 6966 2073 656c  ).        if sel
+00022c60: 662e 7479 7065 2069 6e20 5b27 6177 7327  f.type in ['aws'
+00022c70: 2c20 2767 6370 272c 2027 6962 6d27 5d3a  , 'gcp', 'ibm']:
+00022c80: 0a20 2020 2020 2020 2020 2020 2064 6e73  .            dns
+00022c90: 636c 6965 6e74 203d 206b 2e64 656c 6574  client = k.delet
+00022ca0: 655f 6c6f 6164 6261 6c61 6e63 6572 286e  e_loadbalancer(n
+00022cb0: 616d 6529 0a20 2020 2020 2020 2020 2020  ame).           
+00022cc0: 2069 6620 646f 6d61 696e 2069 7320 6e6f   if domain is no
+00022cd0: 7420 4e6f 6e65 2061 6e64 2064 6e73 636c  t None and dnscl
+00022ce0: 6965 6e74 2069 7320 6e6f 7420 4e6f 6e65  ient is not None
+00022cf0: 2061 6e64 2069 7369 6e73 7461 6e63 6528   and isinstance(
+00022d00: 646e 7363 6c69 656e 742c 2073 7472 293a  dnsclient, str):
+00022d10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00022d20: 2069 6620 646e 7363 6c69 656e 7420 696e   if dnsclient in
+00022d30: 2073 656c 662e 636c 6965 6e74 733a 0a20   self.clients:. 
+00022d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022d50: 2020 207a 203d 204b 636f 6e66 6967 2863     z = Kconfig(c
+00022d60: 6c69 656e 743d 646e 7363 6c69 656e 7429  lient=dnsclient)
+00022d70: 2e6b 0a20 2020 2020 2020 2020 2020 2020  .k.             
+00022d80: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00022d90: 2020 2020 2020 2020 2020 2020 2077 6172               war
+00022da0: 6e69 6e67 2866 2243 6c69 656e 7420 7b64  ning(f"Client {d
+00022db0: 6e73 636c 6965 6e74 7d20 6e6f 7420 666f  nsclient} not fo
+00022dc0: 756e 642e 2053 6b69 7070 696e 6722 290a  und. Skipping").
+00022dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022de0: 7a2e 6465 6c65 7465 5f64 6e73 286e 616d  z.delete_dns(nam
+00022df0: 652e 7265 706c 6163 6528 275f 272c 2027  e.replace('_', '
+00022e00: 2d27 292c 2064 6f6d 6169 6e29 0a20 2020  -'), domain).   
+00022e10: 2020 2020 2065 6c69 6620 7365 6c66 2e74       elif self.t
+00022e20: 7970 6520 3d3d 2027 6b76 6d27 3a0a 2020  ype == 'kvm':.  
+00022e30: 2020 2020 2020 2020 2020 6b2e 6465 6c65            k.dele
+00022e40: 7465 286e 616d 6529 0a0a 2020 2020 6465  te(name)..    de
+00022e50: 6620 6372 6561 7465 5f6c 6f61 6462 616c  f create_loadbal
+00022e60: 616e 6365 7228 7365 6c66 2c20 6e61 6d65  ancer(self, name
+00022e70: 2c20 6e65 7473 3d5b 2764 6566 6175 6c74  , nets=['default
+00022e80: 275d 2c20 706f 7274 733d 5b5d 2c20 6368  '], ports=[], ch
+00022e90: 6563 6b70 6174 683d 272f 272c 2076 6d73  eckpath='/', vms
+00022ea0: 3d5b 5d2c 2064 6f6d 6169 6e3d 4e6f 6e65  =[], domain=None
+00022eb0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00022ec0: 2020 2020 2020 2020 2020 2020 2020 706c                pl
+00022ed0: 616e 3d4e 6f6e 652c 2063 6865 636b 706f  an=None, checkpo
+00022ee0: 7274 3d38 302c 2061 6c69 6173 3d5b 5d2c  rt=80, alias=[],
+00022ef0: 2069 6e74 6572 6e61 6c3d 4661 6c73 652c   internal=False,
+00022f00: 2064 6e73 636c 6965 6e74 3d4e 6f6e 652c   dnsclient=None,
+00022f10: 2073 7562 6e65 7469 643d 4e6f 6e65 2c20   subnetid=None, 
+00022f20: 6970 3d4e 6f6e 6529 3a0a 2020 2020 2020  ip=None):.      
+00022f30: 2020 6e61 6d65 203d 206e 616d 6575 7469    name = nameuti
+00022f40: 6c73 2e67 6574 5f72 616e 646f 6d5f 6e61  ls.get_random_na
+00022f50: 6d65 2829 2e72 6570 6c61 6365 2827 5f27  me().replace('_'
+00022f60: 2c20 272d 2729 2069 6620 6e61 6d65 2069  , '-') if name i
+00022f70: 7320 4e6f 6e65 2065 6c73 6520 6e61 6d65  s None else name
+00022f80: 0a20 2020 2020 2020 2070 7072 696e 7428  .        pprint(
+00022f90: 6622 4465 706c 6f79 696e 6720 6c6f 6164  f"Deploying load
+00022fa0: 6261 6c61 6e63 6572 207b 6e61 6d65 7d22  balancer {name}"
+00022fb0: 290a 2020 2020 2020 2020 6b20 3d20 7365  ).        k = se
+00022fc0: 6c66 2e6b 0a20 2020 2020 2020 2069 6620  lf.k.        if 
+00022fd0: 7365 6c66 2e74 7970 6520 696e 205b 2761  self.type in ['a
+00022fe0: 7773 272c 2027 6763 7027 2c20 2769 626d  ws', 'gcp', 'ibm
+00022ff0: 275d 3a0a 2020 2020 2020 2020 2020 2020  ']:.            
+00023000: 6c62 5f69 7020 3d20 6b2e 6372 6561 7465  lb_ip = k.create
+00023010: 5f6c 6f61 6462 616c 616e 6365 7228 6e61  _loadbalancer(na
+00023020: 6d65 2c20 706f 7274 733d 706f 7274 732c  me, ports=ports,
+00023030: 2063 6865 636b 7061 7468 3d63 6865 636b   checkpath=check
+00023040: 7061 7468 2c20 766d 733d 766d 732c 2064  path, vms=vms, d
+00023050: 6f6d 6169 6e3d 646f 6d61 696e 2c0a 2020  omain=domain,.  
+00023060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023080: 2020 2020 2020 2020 6368 6563 6b70 6f72          checkpor
+00023090: 743d 6368 6563 6b70 6f72 742c 2061 6c69  t=checkport, ali
+000230a0: 6173 3d61 6c69 6173 2c20 696e 7465 726e  as=alias, intern
+000230b0: 616c 3d69 6e74 6572 6e61 6c2c 0a20 2020  al=internal,.   
 000230c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000230d0: 2020 2020 6368 6563 6b70 6f72 743d 6368      checkport=ch
-000230e0: 6563 6b70 6f72 742c 2061 6c69 6173 3d61  eckport, alias=a
-000230f0: 6c69 6173 2c20 696e 7465 726e 616c 3d69  lias, internal=i
-00023100: 6e74 6572 6e61 6c2c 0a20 2020 2020 2020  nternal,.       
-00023110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023130: 2020 2064 6e73 636c 6965 6e74 3d64 6e73     dnsclient=dns
-00023140: 636c 6965 6e74 2c20 7375 626e 6574 6964  client, subnetid
-00023150: 3d73 7562 6e65 7469 642c 2069 703d 6970  =subnetid, ip=ip
-00023160: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-00023170: 2064 6e73 636c 6965 6e74 2069 7320 6e6f   dnsclient is no
-00023180: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-00023190: 2020 2020 2020 2020 6966 2064 6e73 636c          if dnscl
-000231a0: 6965 6e74 2069 6e20 7365 6c66 2e63 6c69  ient in self.cli
-000231b0: 656e 7473 3a0a 2020 2020 2020 2020 2020  ents:.          
-000231c0: 2020 2020 2020 2020 2020 7a20 3d20 4b63            z = Kc
-000231d0: 6f6e 6669 6728 636c 6965 6e74 3d64 6e73  onfig(client=dns
-000231e0: 636c 6965 6e74 292e 6b0a 2020 2020 2020  client).k.      
-000231f0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-00023200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023210: 2020 2020 7761 726e 696e 6728 6622 436c      warning(f"Cl
-00023220: 6965 6e74 207b 646e 7363 6c69 656e 747d  ient {dnsclient}
-00023230: 206e 6f74 2066 6f75 6e64 2e20 536b 6970   not found. Skip
-00023240: 7069 6e67 2229 0a20 2020 2020 2020 2020  ping").         
-00023250: 2020 2020 2020 207a 2e72 6573 6572 7665         z.reserve
-00023260: 5f64 6e73 286e 616d 652e 7265 706c 6163  _dns(name.replac
-00023270: 6528 275f 272c 2027 2d27 292c 2069 703d  e('_', '-'), ip=
-00023280: 6c62 5f69 702c 2064 6f6d 6169 6e3d 646f  lb_ip, domain=do
-00023290: 6d61 696e 2c20 616c 6961 733d 616c 6961  main, alias=alia
-000232a0: 7329 0a20 2020 2020 2020 2065 6c73 653a  s).        else:
-000232b0: 0a20 2020 2020 2020 2020 2020 2076 6d69  .            vmi
-000232c0: 6e66 6f20 3d20 5b5d 0a20 2020 2020 2020  nfo = [].       
-000232d0: 2020 2020 2066 6f72 2076 6d20 696e 2076       for vm in v
-000232e0: 6d73 3a0a 2020 2020 2020 2020 2020 2020  ms:.            
-000232f0: 2020 2020 6966 2076 616c 6964 5f69 7028      if valid_ip(
-00023300: 766d 293a 0a20 2020 2020 2020 2020 2020  vm):.           
-00023310: 2020 2020 2020 2020 2076 6d6e 616d 6520           vmname 
-00023320: 3d20 766d 2e72 6570 6c61 6365 2827 3a27  = vm.replace(':'
-00023330: 2c20 272d 2729 2e72 6570 6c61 6365 2827  , '-').replace('
-00023340: 2e27 2c20 272d 2729 0a20 2020 2020 2020  .', '-').       
-00023350: 2020 2020 2020 2020 2020 2020 2076 6d69               vmi
-00023360: 6e66 6f2e 6170 7065 6e64 287b 276e 616d  nfo.append({'nam
-00023370: 6527 3a20 766d 6e61 6d65 2c20 2769 7027  e': vmname, 'ip'
-00023380: 3a20 766d 7d29 0a20 2020 2020 2020 2020  : vm}).         
-00023390: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
-000233a0: 6e75 650a 2020 2020 2020 2020 2020 2020  nue.            
-000233b0: 2020 2020 636f 756e 7465 7220 3d20 300a      counter = 0.
+000230d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000230e0: 2020 2020 2020 2064 6e73 636c 6965 6e74         dnsclient
+000230f0: 3d64 6e73 636c 6965 6e74 2c20 7375 626e  =dnsclient, subn
+00023100: 6574 6964 3d73 7562 6e65 7469 642c 2069  etid=subnetid, i
+00023110: 703d 6970 290a 2020 2020 2020 2020 2020  p=ip).          
+00023120: 2020 6966 2064 6e73 636c 6965 6e74 2069    if dnsclient i
+00023130: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+00023140: 2020 2020 2020 2020 2020 2020 6966 2064              if d
+00023150: 6e73 636c 6965 6e74 2069 6e20 7365 6c66  nsclient in self
+00023160: 2e63 6c69 656e 7473 3a0a 2020 2020 2020  .clients:.      
+00023170: 2020 2020 2020 2020 2020 2020 2020 7a20                z 
+00023180: 3d20 4b63 6f6e 6669 6728 636c 6965 6e74  = Kconfig(client
+00023190: 3d64 6e73 636c 6965 6e74 292e 6b0a 2020  =dnsclient).k.  
+000231a0: 2020 2020 2020 2020 2020 2020 2020 656c                el
+000231b0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+000231c0: 2020 2020 2020 2020 7761 726e 696e 6728          warning(
+000231d0: 6622 436c 6965 6e74 207b 646e 7363 6c69  f"Client {dnscli
+000231e0: 656e 747d 206e 6f74 2066 6f75 6e64 2e20  ent} not found. 
+000231f0: 536b 6970 7069 6e67 2229 0a20 2020 2020  Skipping").     
+00023200: 2020 2020 2020 2020 2020 207a 2e72 6573             z.res
+00023210: 6572 7665 5f64 6e73 286e 616d 652e 7265  erve_dns(name.re
+00023220: 706c 6163 6528 275f 272c 2027 2d27 292c  place('_', '-'),
+00023230: 2069 703d 6c62 5f69 702c 2064 6f6d 6169   ip=lb_ip, domai
+00023240: 6e3d 646f 6d61 696e 2c20 616c 6961 733d  n=domain, alias=
+00023250: 616c 6961 7329 0a20 2020 2020 2020 2065  alias).        e
+00023260: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00023270: 2076 6d69 6e66 6f20 3d20 5b5d 0a20 2020   vminfo = [].   
+00023280: 2020 2020 2020 2020 2066 6f72 2076 6d20           for vm 
+00023290: 696e 2076 6d73 3a0a 2020 2020 2020 2020  in vms:.        
+000232a0: 2020 2020 2020 2020 6966 2076 616c 6964          if valid
+000232b0: 5f69 7028 766d 293a 0a20 2020 2020 2020  _ip(vm):.       
+000232c0: 2020 2020 2020 2020 2020 2020 2076 6d6e               vmn
+000232d0: 616d 6520 3d20 766d 2e72 6570 6c61 6365  ame = vm.replace
+000232e0: 2827 3a27 2c20 272d 2729 2e72 6570 6c61  (':', '-').repla
+000232f0: 6365 2827 2e27 2c20 272d 2729 0a20 2020  ce('.', '-').   
+00023300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023310: 2076 6d69 6e66 6f2e 6170 7065 6e64 287b   vminfo.append({
+00023320: 276e 616d 6527 3a20 766d 6e61 6d65 2c20  'name': vmname, 
+00023330: 2769 7027 3a20 766d 7d29 0a20 2020 2020  'ip': vm}).     
+00023340: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00023350: 6f6e 7469 6e75 650a 2020 2020 2020 2020  ontinue.        
+00023360: 2020 2020 2020 2020 636f 756e 7465 7220          counter 
+00023370: 3d20 300a 2020 2020 2020 2020 2020 2020  = 0.            
+00023380: 2020 2020 7768 696c 6520 636f 756e 7465      while counte
+00023390: 7220 213d 2031 3030 3a0a 2020 2020 2020  r != 100:.      
+000233a0: 2020 2020 2020 2020 2020 2020 2020 6970                ip
+000233b0: 203d 206b 2e69 7028 766d 290a 2020 2020   = k.ip(vm).    
 000233c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000233d0: 7768 696c 6520 636f 756e 7465 7220 213d  while counter !=
-000233e0: 2031 3030 3a0a 2020 2020 2020 2020 2020   100:.          
-000233f0: 2020 2020 2020 2020 2020 6970 203d 206b            ip = k
-00023400: 2e69 7028 766d 290a 2020 2020 2020 2020  .ip(vm).        
-00023410: 2020 2020 2020 2020 2020 2020 6966 2069              if i
-00023420: 7020 6973 204e 6f6e 653a 0a20 2020 2020  p is None:.     
-00023430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023440: 2020 2073 6c65 6570 2835 290a 2020 2020     sleep(5).    
+000233d0: 6966 2069 7020 6973 204e 6f6e 653a 0a20  if ip is None:. 
+000233e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000233f0: 2020 2020 2020 2073 6c65 6570 2835 290a         sleep(5).
+00023400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023410: 2020 2020 2020 2020 7072 696e 7428 6622          print(f"
+00023420: 5761 6974 696e 6720 3520 7365 636f 6e64  Waiting 5 second
+00023430: 7320 746f 2067 7261 6220 6970 2066 6f72  s to grab ip for
+00023440: 2076 6d20 7b76 6d7d 2e2e 2e22 290a 2020   vm {vm}...").  
 00023450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023460: 2020 2020 7072 696e 7428 6622 5761 6974      print(f"Wait
-00023470: 696e 6720 3520 7365 636f 6e64 7320 746f  ing 5 seconds to
-00023480: 2067 7261 6220 6970 2066 6f72 2076 6d20   grab ip for vm 
-00023490: 7b76 6d7d 2e2e 2e22 290a 2020 2020 2020  {vm}...").      
-000234a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000234b0: 2020 636f 756e 7465 7220 2b3d 2035 0a20    counter += 5. 
-000234c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000234d0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-000234e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000234f0: 2062 7265 616b 0a20 2020 2020 2020 2020   break.         
-00023500: 2020 2020 2020 2076 6d69 6e66 6f2e 6170         vminfo.ap
-00023510: 7065 6e64 287b 276e 616d 6527 3a20 766d  pend({'name': vm
-00023520: 2c20 2769 7027 3a20 6970 7d29 0a20 2020  , 'ip': ip}).   
-00023530: 2020 2020 2020 2020 206f 7665 7272 6964           overrid
-00023540: 6573 203d 207b 0a20 2020 2020 2020 2020  es = {.         
-00023550: 2020 2020 2020 2022 6e61 6d65 223a 206e         "name": n
-00023560: 616d 652c 0a20 2020 2020 2020 2020 2020  ame,.           
-00023570: 2020 2020 2022 766d 7322 3a20 766d 696e       "vms": vmin
-00023580: 666f 2c0a 2020 2020 2020 2020 2020 2020  fo,.            
-00023590: 2020 2020 226e 6574 7322 3a20 6e65 7473      "nets": nets
-000235a0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000235b0: 2020 2270 6f72 7473 223a 2070 6f72 7473    "ports": ports
-000235c0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000235d0: 2020 2263 6865 636b 7061 7468 223a 2063    "checkpath": c
-000235e0: 6865 636b 7061 7468 2c0a 2020 2020 2020  heckpath,.      
-000235f0: 2020 2020 2020 2020 2020 2264 6f6d 6169            "domai
-00023600: 6e22 3a20 646f 6d61 696e 2c0a 2020 2020  n": domain,.    
-00023610: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
-00023620: 2020 2020 2020 7365 6c66 2e70 6c61 6e28        self.plan(
-00023630: 706c 616e 2c20 696e 7075 7473 7472 696e  plan, inputstrin
-00023640: 673d 6861 7072 6f78 7970 6c61 6e2c 206f  g=haproxyplan, o
-00023650: 7665 7272 6964 6573 3d6f 7665 7272 6964  verrides=overrid
-00023660: 6573 290a 0a20 2020 2064 6566 206c 6973  es)..    def lis
-00023670: 745f 6c6f 6164 6261 6c61 6e63 6572 7328  t_loadbalancers(
-00023680: 7365 6c66 293a 0a20 2020 2020 2020 206b  self):.        k
-00023690: 203d 2073 656c 662e 6b0a 2020 2020 2020   = self.k.      
-000236a0: 2020 6966 2073 656c 662e 7479 7065 206e    if self.type n
-000236b0: 6f74 2069 6e20 5b27 6177 7327 2c20 2767  ot in ['aws', 'g
-000236c0: 6370 272c 2027 6962 6d27 5d3a 0a20 2020  cp', 'ibm']:.   
-000236d0: 2020 2020 2020 2020 2072 6573 756c 7473           results
-000236e0: 203d 205b 5d0a 2020 2020 2020 2020 2020   = [].          
-000236f0: 2020 666f 7220 766d 2069 6e20 6b2e 6c69    for vm in k.li
-00023700: 7374 2829 3a0a 2020 2020 2020 2020 2020  st():.          
-00023710: 2020 2020 2020 6966 2076 6d5b 2770 726f        if vm['pro
-00023720: 6669 6c65 275d 2e73 7461 7274 7377 6974  file'].startswit
-00023730: 6828 276c 6f61 6462 616c 616e 6365 7227  h('loadbalancer'
-00023740: 2920 616e 6420 6c65 6e28 766d 5b27 7072  ) and len(vm['pr
-00023750: 6f66 696c 6527 5d2e 7370 6c69 7428 272d  ofile'].split('-
-00023760: 2729 2920 3d3d 2032 3a0a 2020 2020 2020  ')) == 2:.      
-00023770: 2020 2020 2020 2020 2020 2020 2020 706f                po
-00023780: 7274 7320 3d20 766d 5b27 7072 6f66 696c  rts = vm['profil
-00023790: 6527 5d2e 7370 6c69 7428 272d 2729 5b31  e'].split('-')[1
-000237a0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-000237b0: 2020 2020 2020 7265 7375 6c74 732e 6170        results.ap
-000237c0: 7065 6e64 285b 766d 5b27 6e61 6d65 275d  pend([vm['name']
-000237d0: 2c20 766d 5b27 6970 275d 2c20 2774 6370  , vm['ip'], 'tcp
-000237e0: 272c 2070 6f72 7473 2c20 2727 5d29 0a20  ', ports, '']). 
-000237f0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00023800: 6e20 7265 7375 6c74 730a 2020 2020 2020  n results.      
-00023810: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00023820: 2020 2020 7265 7475 726e 206b 2e6c 6973      return k.lis
-00023830: 745f 6c6f 6164 6261 6c61 6e63 6572 7328  t_loadbalancers(
-00023840: 290a 0a20 2020 2064 6566 2077 6169 745f  )..    def wait_
-00023850: 6669 6e69 7368 2873 656c 662c 206e 616d  finish(self, nam
-00023860: 652c 2069 6d61 6765 3d4e 6f6e 652c 2071  e, image=None, q
-00023870: 7569 6574 3d46 616c 7365 2c20 7761 6974  uiet=False, wait
-00023880: 636f 6d6d 616e 643d 4e6f 6e65 2c20 7761  command=None, wa
-00023890: 6974 7469 6d65 6f75 743d 302c 2069 6465  ittimeout=0, ide
-000238a0: 6e74 6974 7966 696c 653d 4e6f 6e65 2c0a  ntityfile=None,.
-000238b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000238c0: 2020 2020 766d 636c 6965 6e74 3d4e 6f6e      vmclient=Non
-000238d0: 6529 3a0a 2020 2020 2020 2020 636f 6e66  e):.        conf
-000238e0: 6967 203d 204b 636f 6e66 6967 2863 6c69  ig = Kconfig(cli
-000238f0: 656e 743d 766d 636c 6965 6e74 2920 6966  ent=vmclient) if
-00023900: 2076 6d63 6c69 656e 7420 6973 206e 6f74   vmclient is not
-00023910: 204e 6f6e 6520 656c 7365 2073 656c 660a   None else self.
-00023920: 2020 2020 2020 2020 6b20 3d20 636f 6e66          k = conf
-00023930: 6967 2e6b 0a20 2020 2020 2020 2069 6620  ig.k.        if 
-00023940: 696d 6167 6520 6973 204e 6f6e 653a 0a20  image is None:. 
-00023950: 2020 2020 2020 2020 2020 2069 6d61 6765             image
-00023960: 203d 206b 2e69 6e66 6f28 6e61 6d65 295b   = k.info(name)[
-00023970: 2769 6d61 6765 275d 0a20 2020 2020 2020  'image'].       
-00023980: 2070 7072 696e 7428 6622 5761 6974 696e   pprint(f"Waitin
-00023990: 6720 666f 7220 766d 207b 6e61 6d65 7d20  g for vm {name} 
-000239a0: 746f 2066 696e 6973 6820 6375 7374 6f6d  to finish custom
-000239b0: 6973 6174 696f 6e22 290a 2020 2020 2020  isation").      
-000239c0: 2020 6966 2077 6169 7463 6f6d 6d61 6e64    if waitcommand
-000239d0: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
-000239e0: 2027 323e 2720 6e6f 7420 696e 2077 6169   '2>' not in wai
-000239f0: 7463 6f6d 6d61 6e64 3a0a 2020 2020 2020  tcommand:.      
-00023a00: 2020 2020 2020 7761 6974 636f 6d6d 616e        waitcomman
-00023a10: 6420 2b3d 2022 2032 3e2f 6465 762f 6e75  d += " 2>/dev/nu
-00023a20: 6c6c 220a 2020 2020 2020 2020 6966 2063  ll".        if c
-00023a30: 6f6d 6d6f 6e2e 6e65 6564 735f 6967 6e69  ommon.needs_igni
-00023a40: 7469 6f6e 2869 6d61 6765 293a 0a20 2020  tion(image):.   
-00023a50: 2020 2020 2020 2020 2063 6d64 203d 2077           cmd = w
-00023a60: 6169 7463 6f6d 6d61 6e64 206f 7220 2773  aitcommand or 's
-00023a70: 7564 6f20 6a6f 7572 6e61 6c63 746c 202d  udo journalctl -
-00023a80: 2d61 6c6c 202d 2d6e 6f2d 7061 6765 7227  -all --no-pager'
-00023a90: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-00023aa0: 2020 2020 2020 2020 2020 2063 6d64 203d             cmd =
-00023ab0: 2077 6169 7463 6f6d 6d61 6e64 206f 7220   waitcommand or 
-00023ac0: 6622 7375 646f 2074 6169 6c20 2d6e 2035  f"sudo tail -n 5
-00023ad0: 3020 7b63 6f6d 6d6f 6e2e 6765 745f 636c  0 {common.get_cl
-00023ae0: 6f75 6469 6e69 7466 696c 6528 696d 6167  oudinitfile(imag
-00023af0: 6529 7d22 0a20 2020 2020 2020 2075 7365  e)}".        use
-00023b00: 722c 2069 702c 2076 6d70 6f72 7420 3d20  r, ip, vmport = 
-00023b10: 4e6f 6e65 2c20 4e6f 6e65 2c20 4e6f 6e65  None, None, None
-00023b20: 0a20 2020 2020 2020 2068 6f73 7469 7020  .        hostip 
-00023b30: 3d20 4e6f 6e65 0a20 2020 2020 2020 2074  = None.        t
-00023b40: 696d 656f 7574 203d 2030 0a20 2020 2020  imeout = 0.     
-00023b50: 2020 2077 6869 6c65 2069 7020 6973 204e     while ip is N
-00023b60: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00023b70: 2069 6e66 6f20 3d20 6b2e 696e 666f 286e   info = k.info(n
-00023b80: 616d 6529 0a20 2020 2020 2020 2020 2020  ame).           
-00023b90: 2069 6620 636f 6e66 6967 2e74 7970 6520   if config.type 
-00023ba0: 3d3d 2027 7061 636b 6574 2720 616e 6420  == 'packet' and 
-00023bb0: 696e 666f 2e67 6574 2827 7374 6174 7573  info.get('status
-00023bc0: 2729 2021 3d20 2761 6374 6976 6527 3a0a  ') != 'active':.
-00023bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023be0: 7761 726e 696e 6728 2257 6169 7469 6e67  warning("Waiting
-00023bf0: 2066 6f72 206e 6f64 6520 746f 2062 6520   for node to be 
-00023c00: 6163 7469 7665 2229 0a20 2020 2020 2020  active").       
-00023c10: 2020 2020 2020 2020 2069 7020 3d20 4e6f           ip = No
-00023c20: 6e65 0a20 2020 2020 2020 2020 2020 2065  ne.            e
-00023c30: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00023c40: 2020 2020 2075 7365 722c 2069 7020 3d20       user, ip = 
-00023c50: 636f 6e66 6967 2e76 6d75 7365 7220 6f72  config.vmuser or
-00023c60: 2069 6e66 6f2e 6765 7428 2775 7365 7227   info.get('user'
-00023c70: 292c 2069 6e66 6f2e 6765 7428 2769 7027  ), info.get('ip'
-00023c80: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00023c90: 2020 6966 2063 6f6e 6669 672e 7479 7065    if config.type
-00023ca0: 203d 3d20 276b 7562 6576 6972 7427 3a0a   == 'kubevirt':.
-00023cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023cc0: 2020 2020 6966 206b 2e61 6363 6573 735f      if k.access_
-00023cd0: 6d6f 6465 203d 3d20 274e 6f64 6550 6f72  mode == 'NodePor
-00023ce0: 7427 3a0a 2020 2020 2020 2020 2020 2020  t':.            
-00023cf0: 2020 2020 2020 2020 2020 2020 766d 706f              vmpo
-00023d00: 7274 203d 2069 6e66 6f2e 6765 7428 276e  rt = info.get('n
-00023d10: 6f64 6570 6f72 7427 290a 2020 2020 2020  odeport').      
-00023d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023d30: 2020 6966 2068 6f73 7469 7020 6973 204e    if hostip is N
-00023d40: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00023d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023d60: 2068 6f73 7469 7020 3d20 6b2e 6e6f 6465   hostip = k.node
-00023d70: 5f68 6f73 7428 6e61 6d65 3d69 6e66 6f2e  _host(name=info.
-00023d80: 6765 7428 2768 6f73 7427 2929 0a20 2020  get('host')).   
-00023d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023da0: 2020 2020 2069 7020 3d20 686f 7374 6970       ip = hostip
-00023db0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00023dc0: 2020 2020 2065 6c69 6620 6b2e 6163 6365       elif k.acce
-00023dd0: 7373 5f6d 6f64 6520 3d3d 2027 4c6f 6164  ss_mode == 'Load
-00023de0: 4261 6c61 6e63 6572 273a 0a20 2020 2020  Balancer':.     
-00023df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023e00: 2020 2069 7020 3d20 696e 666f 2e67 6574     ip = info.get
-00023e10: 2827 6c6f 6164 6261 6c61 6e63 6572 6970  ('loadbalancerip
-00023e20: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
-00023e30: 2020 2069 6620 7573 6572 2069 7320 6e6f     if user is no
-00023e40: 7420 4e6f 6e65 2061 6e64 2069 7020 6973  t None and ip is
-00023e50: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-00023e60: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00023e70: 6620 636f 6e66 6967 2e74 7970 6520 3d3d  f config.type ==
-00023e80: 2027 6f70 656e 7374 6163 6b27 2061 6e64   'openstack' and
-00023e90: 2069 6e66 6f2e 6765 7428 2770 7269 7661   info.get('priva
-00023ea0: 7465 6970 2729 203d 3d20 6970 2061 6e64  teip') == ip and
-00023eb0: 206b 2e65 7874 6572 6e61 6c5f 6e65 7477   k.external_netw
-00023ec0: 6f72 6b20 6973 206e 6f74 204e 6f6e 655c  ork is not None\
-00023ed0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00023ee0: 2020 2020 2020 2020 2020 2020 2061 6e64               and
-00023ef0: 2069 6e66 6f2e 6765 7428 276e 6574 7327   info.get('nets'
-00023f00: 295b 305d 5b27 6e65 7427 5d20 213d 206b  )[0]['net'] != k
-00023f10: 2e65 7874 6572 6e61 6c5f 6e65 7477 6f72  .external_networ
-00023f20: 6b3a 0a20 2020 2020 2020 2020 2020 2020  k:.             
-00023f30: 2020 2020 2020 2020 2020 2077 6172 6e69             warni
-00023f40: 6e67 2822 5761 6974 696e 6720 666f 7220  ng("Waiting for 
-00023f50: 666c 6f61 7469 6e67 2069 7020 696e 7374  floating ip inst
-00023f60: 6561 6420 6f66 2061 2070 7269 7661 7465  ead of a private
-00023f70: 2069 702e 2e2e 2229 0a20 2020 2020 2020   ip...").       
-00023f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00023f90: 2069 7020 3d20 4e6f 6e65 0a20 2020 2020   ip = None.     
-00023fa0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00023fb0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00023fc0: 2020 2020 2020 2020 2020 2020 2074 6573               tes
-00023fd0: 7463 6d64 203d 2063 6f6d 6d6f 6e2e 7373  tcmd = common.ss
-00023fe0: 6828 6e61 6d65 2c20 7573 6572 3d75 7365  h(name, user=use
-00023ff0: 722c 2069 703d 6970 2c20 7475 6e6e 656c  r, ip=ip, tunnel
-00024000: 3d63 6f6e 6669 672e 7475 6e6e 656c 2c20  =config.tunnel, 
-00024010: 7475 6e6e 656c 686f 7374 3d63 6f6e 6669  tunnelhost=confi
-00024020: 672e 7475 6e6e 656c 686f 7374 2c0a 2020  g.tunnelhost,.  
-00024030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024050: 2020 2020 2020 2020 2020 2074 756e 6e65             tunne
-00024060: 6c70 6f72 743d 636f 6e66 6967 2e74 756e  lport=config.tun
-00024070: 6e65 6c70 6f72 742c 2074 756e 6e65 6c75  nelport, tunnelu
-00024080: 7365 723d 636f 6e66 6967 2e74 756e 6e65  ser=config.tunne
-00024090: 6c75 7365 722c 0a20 2020 2020 2020 2020  luser,.         
-000240a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023460: 2020 2020 2020 636f 756e 7465 7220 2b3d        counter +=
+00023470: 2035 0a20 2020 2020 2020 2020 2020 2020   5.             
+00023480: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00023490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000234a0: 2020 2020 2062 7265 616b 0a20 2020 2020       break.     
+000234b0: 2020 2020 2020 2020 2020 2076 6d69 6e66             vminf
+000234c0: 6f2e 6170 7065 6e64 287b 276e 616d 6527  o.append({'name'
+000234d0: 3a20 766d 2c20 2769 7027 3a20 6970 7d29  : vm, 'ip': ip})
+000234e0: 0a20 2020 2020 2020 2020 2020 206f 7665  .            ove
+000234f0: 7272 6964 6573 203d 207b 0a20 2020 2020  rrides = {.     
+00023500: 2020 2020 2020 2020 2020 2022 6e61 6d65             "name
+00023510: 223a 206e 616d 652c 0a20 2020 2020 2020  ": name,.       
+00023520: 2020 2020 2020 2020 2022 766d 7322 3a20           "vms": 
+00023530: 766d 696e 666f 2c0a 2020 2020 2020 2020  vminfo,.        
+00023540: 2020 2020 2020 2020 226e 6574 7322 3a20          "nets": 
+00023550: 6e65 7473 2c0a 2020 2020 2020 2020 2020  nets,.          
+00023560: 2020 2020 2020 2270 6f72 7473 223a 2070        "ports": p
+00023570: 6f72 7473 2c0a 2020 2020 2020 2020 2020  orts,.          
+00023580: 2020 2020 2020 2263 6865 636b 7061 7468        "checkpath
+00023590: 223a 2063 6865 636b 7061 7468 2c0a 2020  ": checkpath,.  
+000235a0: 2020 2020 2020 2020 2020 2020 2020 2264                "d
+000235b0: 6f6d 6169 6e22 3a20 646f 6d61 696e 2c0a  omain": domain,.
+000235c0: 2020 2020 2020 2020 2020 2020 7d0a 2020              }.  
+000235d0: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+000235e0: 6c61 6e28 706c 616e 2c20 696e 7075 7473  lan(plan, inputs
+000235f0: 7472 696e 673d 6861 7072 6f78 7970 6c61  tring=haproxypla
+00023600: 6e2c 206f 7665 7272 6964 6573 3d6f 7665  n, overrides=ove
+00023610: 7272 6964 6573 290a 0a20 2020 2064 6566  rrides)..    def
+00023620: 206c 6973 745f 6c6f 6164 6261 6c61 6e63   list_loadbalanc
+00023630: 6572 7328 7365 6c66 293a 0a20 2020 2020  ers(self):.     
+00023640: 2020 206b 203d 2073 656c 662e 6b0a 2020     k = self.k.  
+00023650: 2020 2020 2020 6966 2073 656c 662e 7479        if self.ty
+00023660: 7065 206e 6f74 2069 6e20 5b27 6177 7327  pe not in ['aws'
+00023670: 2c20 2767 6370 272c 2027 6962 6d27 5d3a  , 'gcp', 'ibm']:
+00023680: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
+00023690: 756c 7473 203d 205b 5d0a 2020 2020 2020  ults = [].      
+000236a0: 2020 2020 2020 666f 7220 766d 2069 6e20        for vm in 
+000236b0: 6b2e 6c69 7374 2829 3a0a 2020 2020 2020  k.list():.      
+000236c0: 2020 2020 2020 2020 2020 6966 2076 6d5b            if vm[
+000236d0: 2770 726f 6669 6c65 275d 2e73 7461 7274  'profile'].start
+000236e0: 7377 6974 6828 276c 6f61 6462 616c 616e  swith('loadbalan
+000236f0: 6365 7227 2920 616e 6420 6c65 6e28 766d  cer') and len(vm
+00023700: 5b27 7072 6f66 696c 6527 5d2e 7370 6c69  ['profile'].spli
+00023710: 7428 272d 2729 2920 3d3d 2032 3a0a 2020  t('-')) == 2:.  
+00023720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023730: 2020 706f 7274 7320 3d20 766d 5b27 7072    ports = vm['pr
+00023740: 6f66 696c 6527 5d2e 7370 6c69 7428 272d  ofile'].split('-
+00023750: 2729 5b31 5d0a 2020 2020 2020 2020 2020  ')[1].          
+00023760: 2020 2020 2020 2020 2020 7265 7375 6c74            result
+00023770: 732e 6170 7065 6e64 285b 766d 5b27 6e61  s.append([vm['na
+00023780: 6d65 275d 2c20 766d 5b27 6970 275d 2c20  me'], vm['ip'], 
+00023790: 2774 6370 272c 2070 6f72 7473 2c20 2727  'tcp', ports, ''
+000237a0: 5d29 0a20 2020 2020 2020 2020 2020 2072  ]).            r
+000237b0: 6574 7572 6e20 7265 7375 6c74 730a 2020  eturn results.  
+000237c0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+000237d0: 2020 2020 2020 2020 7265 7475 726e 206b          return k
+000237e0: 2e6c 6973 745f 6c6f 6164 6261 6c61 6e63  .list_loadbalanc
+000237f0: 6572 7328 290a 0a20 2020 2064 6566 2077  ers()..    def w
+00023800: 6169 745f 6669 6e69 7368 2873 656c 662c  ait_finish(self,
+00023810: 206e 616d 652c 2069 6d61 6765 3d4e 6f6e   name, image=Non
+00023820: 652c 2071 7569 6574 3d46 616c 7365 2c20  e, quiet=False, 
+00023830: 7761 6974 636f 6d6d 616e 643d 4e6f 6e65  waitcommand=None
+00023840: 2c20 7761 6974 7469 6d65 6f75 743d 302c  , waittimeout=0,
+00023850: 2069 6465 6e74 6974 7966 696c 653d 4e6f   identityfile=No
+00023860: 6e65 2c0a 2020 2020 2020 2020 2020 2020  ne,.            
+00023870: 2020 2020 2020 2020 766d 636c 6965 6e74          vmclient
+00023880: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
+00023890: 636f 6e66 6967 203d 204b 636f 6e66 6967  config = Kconfig
+000238a0: 2863 6c69 656e 743d 766d 636c 6965 6e74  (client=vmclient
+000238b0: 2920 6966 2076 6d63 6c69 656e 7420 6973  ) if vmclient is
+000238c0: 206e 6f74 204e 6f6e 6520 656c 7365 2073   not None else s
+000238d0: 656c 660a 2020 2020 2020 2020 6b20 3d20  elf.        k = 
+000238e0: 636f 6e66 6967 2e6b 0a20 2020 2020 2020  config.k.       
+000238f0: 2069 6620 696d 6167 6520 6973 204e 6f6e   if image is Non
+00023900: 653a 0a20 2020 2020 2020 2020 2020 2069  e:.            i
+00023910: 6d61 6765 203d 206b 2e69 6e66 6f28 6e61  mage = k.info(na
+00023920: 6d65 295b 2769 6d61 6765 275d 0a20 2020  me)['image'].   
+00023930: 2020 2020 2070 7072 696e 7428 6622 5761       pprint(f"Wa
+00023940: 6974 696e 6720 666f 7220 766d 207b 6e61  iting for vm {na
+00023950: 6d65 7d20 746f 2066 696e 6973 6820 6375  me} to finish cu
+00023960: 7374 6f6d 6973 6174 696f 6e22 290a 2020  stomisation").  
+00023970: 2020 2020 2020 6966 2077 6169 7463 6f6d        if waitcom
+00023980: 6d61 6e64 2069 7320 6e6f 7420 4e6f 6e65  mand is not None
+00023990: 2061 6e64 2027 323e 2720 6e6f 7420 696e   and '2>' not in
+000239a0: 2077 6169 7463 6f6d 6d61 6e64 3a0a 2020   waitcommand:.  
+000239b0: 2020 2020 2020 2020 2020 7761 6974 636f            waitco
+000239c0: 6d6d 616e 6420 2b3d 2022 2032 3e2f 6465  mmand += " 2>/de
+000239d0: 762f 6e75 6c6c 220a 2020 2020 2020 2020  v/null".        
+000239e0: 6966 2063 6f6d 6d6f 6e2e 6e65 6564 735f  if common.needs_
+000239f0: 6967 6e69 7469 6f6e 2869 6d61 6765 293a  ignition(image):
+00023a00: 0a20 2020 2020 2020 2020 2020 2063 6d64  .            cmd
+00023a10: 203d 2077 6169 7463 6f6d 6d61 6e64 206f   = waitcommand o
+00023a20: 7220 2773 7564 6f20 6a6f 7572 6e61 6c63  r 'sudo journalc
+00023a30: 746c 202d 2d61 6c6c 202d 2d6e 6f2d 7061  tl --all --no-pa
+00023a40: 6765 7227 0a20 2020 2020 2020 2065 6c73  ger'.        els
+00023a50: 653a 0a20 2020 2020 2020 2020 2020 2063  e:.            c
+00023a60: 6d64 203d 2077 6169 7463 6f6d 6d61 6e64  md = waitcommand
+00023a70: 206f 7220 6622 7375 646f 2074 6169 6c20   or f"sudo tail 
+00023a80: 2d6e 2035 3020 7b63 6f6d 6d6f 6e2e 6765  -n 50 {common.ge
+00023a90: 745f 636c 6f75 6469 6e69 7466 696c 6528  t_cloudinitfile(
+00023aa0: 696d 6167 6529 7d22 0a20 2020 2020 2020  image)}".       
+00023ab0: 2075 7365 722c 2069 702c 2076 6d70 6f72   user, ip, vmpor
+00023ac0: 7420 3d20 4e6f 6e65 2c20 4e6f 6e65 2c20  t = None, None, 
+00023ad0: 4e6f 6e65 0a20 2020 2020 2020 2068 6f73  None.        hos
+00023ae0: 7469 7020 3d20 4e6f 6e65 0a20 2020 2020  tip = None.     
+00023af0: 2020 2074 696d 656f 7574 203d 2030 0a20     timeout = 0. 
+00023b00: 2020 2020 2020 2077 6869 6c65 2069 7020         while ip 
+00023b10: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+00023b20: 2020 2020 2069 6e66 6f20 3d20 6b2e 696e       info = k.in
+00023b30: 666f 286e 616d 6529 0a20 2020 2020 2020  fo(name).       
+00023b40: 2020 2020 2069 6620 636f 6e66 6967 2e74       if config.t
+00023b50: 7970 6520 3d3d 2027 7061 636b 6574 2720  ype == 'packet' 
+00023b60: 616e 6420 696e 666f 2e67 6574 2827 7374  and info.get('st
+00023b70: 6174 7573 2729 2021 3d20 2761 6374 6976  atus') != 'activ
+00023b80: 6527 3a0a 2020 2020 2020 2020 2020 2020  e':.            
+00023b90: 2020 2020 7761 726e 696e 6728 2257 6169      warning("Wai
+00023ba0: 7469 6e67 2066 6f72 206e 6f64 6520 746f  ting for node to
+00023bb0: 2062 6520 6163 7469 7665 2229 0a20 2020   be active").   
+00023bc0: 2020 2020 2020 2020 2020 2020 2069 7020               ip 
+00023bd0: 3d20 4e6f 6e65 0a20 2020 2020 2020 2020  = None.         
+00023be0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00023bf0: 2020 2020 2020 2020 2075 7365 722c 2069           user, i
+00023c00: 7020 3d20 636f 6e66 6967 2e76 6d75 7365  p = config.vmuse
+00023c10: 7220 6f72 2069 6e66 6f2e 6765 7428 2775  r or info.get('u
+00023c20: 7365 7227 292c 2069 6e66 6f2e 6765 7428  ser'), info.get(
+00023c30: 2769 7027 290a 2020 2020 2020 2020 2020  'ip').          
+00023c40: 2020 2020 2020 6966 2063 6f6e 6669 672e        if config.
+00023c50: 7479 7065 203d 3d20 276b 7562 6576 6972  type == 'kubevir
+00023c60: 7427 3a0a 2020 2020 2020 2020 2020 2020  t':.            
+00023c70: 2020 2020 2020 2020 6966 206b 2e61 6363          if k.acc
+00023c80: 6573 735f 6d6f 6465 203d 3d20 274e 6f64  ess_mode == 'Nod
+00023c90: 6550 6f72 7427 3a0a 2020 2020 2020 2020  ePort':.        
+00023ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023cb0: 766d 706f 7274 203d 2069 6e66 6f2e 6765  vmport = info.ge
+00023cc0: 7428 276e 6f64 6570 6f72 7427 290a 2020  t('nodeport').  
+00023cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023ce0: 2020 2020 2020 6966 2068 6f73 7469 7020        if hostip 
+00023cf0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+00023d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023d10: 2020 2020 2068 6f73 7469 7020 3d20 6b2e       hostip = k.
+00023d20: 6e6f 6465 5f68 6f73 7428 6e61 6d65 3d69  node_host(name=i
+00023d30: 6e66 6f2e 6765 7428 2768 6f73 7427 2929  nfo.get('host'))
+00023d40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00023d50: 2020 2020 2020 2020 2069 7020 3d20 686f           ip = ho
+00023d60: 7374 6970 0a20 2020 2020 2020 2020 2020  stip.           
+00023d70: 2020 2020 2020 2020 2065 6c69 6620 6b2e           elif k.
+00023d80: 6163 6365 7373 5f6d 6f64 6520 3d3d 2027  access_mode == '
+00023d90: 4c6f 6164 4261 6c61 6e63 6572 273a 0a20  LoadBalancer':. 
+00023da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023db0: 2020 2020 2020 2069 7020 3d20 696e 666f         ip = info
+00023dc0: 2e67 6574 2827 6c6f 6164 6261 6c61 6e63  .get('loadbalanc
+00023dd0: 6572 6970 2729 0a20 2020 2020 2020 2020  erip').         
+00023de0: 2020 2020 2020 2069 6620 7573 6572 2069         if user i
+00023df0: 7320 6e6f 7420 4e6f 6e65 2061 6e64 2069  s not None and i
+00023e00: 7020 6973 206e 6f74 204e 6f6e 653a 0a20  p is not None:. 
+00023e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023e20: 2020 2069 6620 636f 6e66 6967 2e74 7970     if config.typ
+00023e30: 6520 3d3d 2027 6f70 656e 7374 6163 6b27  e == 'openstack'
+00023e40: 2061 6e64 2069 6e66 6f2e 6765 7428 2770   and info.get('p
+00023e50: 7269 7661 7465 6970 2729 203d 3d20 6970  rivateip') == ip
+00023e60: 2061 6e64 206b 2e65 7874 6572 6e61 6c5f   and k.external_
+00023e70: 6e65 7477 6f72 6b20 6973 206e 6f74 204e  network is not N
+00023e80: 6f6e 655c 0a20 2020 2020 2020 2020 2020  one\.           
+00023e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023ea0: 2061 6e64 2069 6e66 6f2e 6765 7428 276e   and info.get('n
+00023eb0: 6574 7327 295b 305d 5b27 6e65 7427 5d20  ets')[0]['net'] 
+00023ec0: 213d 206b 2e65 7874 6572 6e61 6c5f 6e65  != k.external_ne
+00023ed0: 7477 6f72 6b3a 0a20 2020 2020 2020 2020  twork:.         
+00023ee0: 2020 2020 2020 2020 2020 2020 2020 2077                 w
+00023ef0: 6172 6e69 6e67 2822 5761 6974 696e 6720  arning("Waiting 
+00023f00: 666f 7220 666c 6f61 7469 6e67 2069 7020  for floating ip 
+00023f10: 696e 7374 6561 6420 6f66 2061 2070 7269  instead of a pri
+00023f20: 7661 7465 2069 702e 2e2e 2229 0a20 2020  vate ip...").   
+00023f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023f40: 2020 2020 2069 7020 3d20 4e6f 6e65 0a20       ip = None. 
+00023f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023f60: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00023f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023f80: 2074 6573 7463 6d64 203d 2063 6f6d 6d6f   testcmd = commo
+00023f90: 6e2e 7373 6828 6e61 6d65 2c20 7573 6572  n.ssh(name, user
+00023fa0: 3d75 7365 722c 2069 703d 6970 2c20 7475  =user, ip=ip, tu
+00023fb0: 6e6e 656c 3d63 6f6e 6669 672e 7475 6e6e  nnel=config.tunn
+00023fc0: 656c 2c20 7475 6e6e 656c 686f 7374 3d63  el, tunnelhost=c
+00023fd0: 6f6e 6669 672e 7475 6e6e 656c 686f 7374  onfig.tunnelhost
+00023fe0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00023ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024000: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00024010: 756e 6e65 6c70 6f72 743d 636f 6e66 6967  unnelport=config
+00024020: 2e74 756e 6e65 6c70 6f72 742c 2074 756e  .tunnelport, tun
+00024030: 6e65 6c75 7365 723d 636f 6e66 6967 2e74  neluser=config.t
+00024040: 756e 6e65 6c75 7365 722c 0a20 2020 2020  unneluser,.     
+00024050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024070: 2020 2020 2020 2020 696e 7365 6375 7265          insecure
+00024080: 3d63 6f6e 6669 672e 696e 7365 6375 7265  =config.insecure
+00024090: 2c20 636d 643d 2769 6420 2d75 6e27 2c20  , cmd='id -un', 
+000240a0: 766d 706f 7274 3d76 6d70 6f72 742c 0a20  vmport=vmport,. 
 000240b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000240c0: 2020 2020 696e 7365 6375 7265 3d63 6f6e      insecure=con
-000240d0: 6669 672e 696e 7365 6375 7265 2c20 636d  fig.insecure, cm
-000240e0: 643d 2769 6420 2d75 6e27 2c20 766d 706f  d='id -un', vmpo
-000240f0: 7274 3d76 6d70 6f72 742c 0a20 2020 2020  rt=vmport,.     
-00024100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024120: 2020 2020 2020 2020 6964 656e 7469 7479          identity
-00024130: 6669 6c65 3d69 6465 6e74 6974 7966 696c  file=identityfil
-00024140: 652c 2070 6173 7377 6f72 643d 4661 6c73  e, password=Fals
-00024150: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-00024160: 2020 2020 2020 2020 2020 2069 6620 6f73             if os
-00024170: 2e70 6f70 656e 2874 6573 7463 6d64 292e  .popen(testcmd).
-00024180: 7265 6164 2829 2e73 7472 6970 2829 2021  read().strip() !
-00024190: 3d20 7573 6572 3a0a 2020 2020 2020 2020  = user:.        
+000240c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000240d0: 2020 2020 2020 2020 2020 2020 6964 656e              iden
+000240e0: 7469 7479 6669 6c65 3d69 6465 6e74 6974  tityfile=identit
+000240f0: 7966 696c 652c 2070 6173 7377 6f72 643d  yfile, password=
+00024100: 4661 6c73 6529 0a20 2020 2020 2020 2020  False).         
+00024110: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00024120: 6620 6f73 2e70 6f70 656e 2874 6573 7463  f os.popen(testc
+00024130: 6d64 292e 7265 6164 2829 2e73 7472 6970  md).read().strip
+00024140: 2829 2021 3d20 7573 6572 3a0a 2020 2020  () != user:.    
+00024150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024160: 2020 2020 2020 2020 7761 726e 696e 6728          warning(
+00024170: 2247 6174 6865 7265 6420 6970 206e 6f74  "Gathered ip not
+00024180: 2066 756e 6374 696f 6e61 6c20 7965 742e   functional yet.
+00024190: 2e2e 2229 0a20 2020 2020 2020 2020 2020  ..").           
 000241a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000241b0: 2020 2020 7761 726e 696e 6728 2247 6174      warning("Gat
-000241c0: 6865 7265 6420 6970 206e 6f74 2066 756e  hered ip not fun
-000241d0: 6374 696f 6e61 6c20 7965 742e 2e2e 2229  ctional yet...")
-000241e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000241f0: 2020 2020 2020 2020 2020 2020 2069 7020               ip 
-00024200: 3d20 4e6f 6e65 0a20 2020 2020 2020 2020  = None.         
-00024210: 2020 2070 7072 696e 7428 2257 6169 7469     pprint("Waiti
-00024220: 6e67 2066 6f72 2076 6d20 746f 2062 6520  ng for vm to be 
-00024230: 6163 6365 7373 6962 6c65 2e2e 2e22 290a  accessible...").
-00024240: 2020 2020 2020 2020 2020 2020 736c 6565              slee
-00024250: 7028 3529 0a20 2020 2020 2020 2020 2020  p(5).           
-00024260: 2074 696d 656f 7574 202b 3d20 350a 2020   timeout += 5.  
-00024270: 2020 2020 2020 2020 2020 6966 2077 6169            if wai
-00024280: 7474 696d 656f 7574 203e 2030 2061 6e64  ttimeout > 0 and
-00024290: 2074 696d 656f 7574 203e 2077 6169 7474   timeout > waitt
-000242a0: 696d 656f 7574 3a0a 2020 2020 2020 2020  imeout:.        
-000242b0: 2020 2020 2020 2020 6572 726f 7228 2254          error("T
-000242c0: 696d 656f 7574 2077 6169 7469 6e67 2066  imeout waiting f
-000242d0: 6f72 2076 6d20 746f 2062 6520 6163 6365  or vm to be acce
-000242e0: 7373 6962 6c65 2e2e 2e22 290a 2020 2020  ssible...").    
-000242f0: 2020 2020 2020 2020 2020 2020 6272 6561              brea
-00024300: 6b0a 2020 2020 2020 2020 736c 6565 7028  k.        sleep(
-00024310: 3529 0a20 2020 2020 2020 206f 6c64 6f75  5).        oldou
-00024320: 7470 7574 203d 2027 270a 2020 2020 2020  tput = ''.      
-00024330: 2020 7469 6d65 6f75 7420 3d20 300a 2020    timeout = 0.  
-00024340: 2020 2020 2020 7768 696c 6520 5472 7565        while True
-00024350: 3a0a 2020 2020 2020 2020 2020 2020 7373  :.            ss
-00024360: 6863 6d64 203d 2063 6f6d 6d6f 6e2e 7373  hcmd = common.ss
-00024370: 6828 6e61 6d65 2c20 7573 6572 3d27 726f  h(name, user='ro
-00024380: 6f74 272c 2069 703d 6970 2c20 7475 6e6e  ot', ip=ip, tunn
-00024390: 656c 3d63 6f6e 6669 672e 7475 6e6e 656c  el=config.tunnel
-000243a0: 2c20 7475 6e6e 656c 686f 7374 3d63 6f6e  , tunnelhost=con
-000243b0: 6669 672e 7475 6e6e 656c 686f 7374 2c0a  fig.tunnelhost,.
-000243c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000243d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000243e0: 766d 706f 7274 3d76 6d70 6f72 742c 2074  vmport=vmport, t
-000243f0: 756e 6e65 6c70 6f72 743d 636f 6e66 6967  unnelport=config
-00024400: 2e74 756e 6e65 6c70 6f72 742c 2074 756e  .tunnelport, tun
-00024410: 6e65 6c75 7365 723d 636f 6e66 6967 2e74  neluser=config.t
-00024420: 756e 6e65 6c75 7365 722c 0a20 2020 2020  unneluser,.     
-00024430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024440: 2020 2020 2020 2020 2020 2069 6e73 6563             insec
-00024450: 7572 653d 636f 6e66 6967 2e69 6e73 6563  ure=config.insec
-00024460: 7572 652c 2063 6d64 3d63 6d64 2c20 6964  ure, cmd=cmd, id
-00024470: 656e 7469 7479 6669 6c65 3d69 6465 6e74  entityfile=ident
-00024480: 6974 7966 696c 652c 2070 6173 7377 6f72  ityfile, passwor
-00024490: 643d 4661 6c73 6529 0a20 2020 2020 2020  d=False).       
-000244a0: 2020 2020 206f 7574 7075 7420 3d20 6f73       output = os
-000244b0: 2e70 6f70 656e 2873 7368 636d 6429 2e72  .popen(sshcmd).r
-000244c0: 6561 6428 290a 2020 2020 2020 2020 2020  ead().          
-000244d0: 2020 6966 2077 6169 7463 6f6d 6d61 6e64    if waitcommand
-000244e0: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-000244f0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00024500: 206f 7574 7075 7420 213d 2027 273a 0a20   output != '':. 
-00024510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024520: 2020 2070 7269 6e74 286f 7574 7075 7429     print(output)
-00024530: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00024540: 2020 2020 2062 7265 616b 0a20 2020 2020       break.     
-00024550: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00024560: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00024570: 2020 2020 2070 7072 696e 7428 2257 6169       pprint("Wai
-00024580: 7469 6e67 2066 6f72 2077 6169 7463 6f6d  ting for waitcom
-00024590: 6d61 6e64 2074 6f20 7375 6363 6565 642e  mand to succeed.
-000245a0: 2e2e 2229 0a20 2020 2020 2020 2020 2020  ..").           
-000245b0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-000245c0: 2020 2020 2020 2069 6620 276b 636c 6920         if 'kcli 
-000245d0: 626f 6f74 2066 696e 6973 6865 6427 2069  boot finished' i
-000245e0: 6e20 6f75 7470 7574 206f 7220 2749 676e  n output or 'Ign
-000245f0: 6974 696f 6e20 6669 6e69 7368 6564 2073  ition finished s
-00024600: 7563 6365 7373 6675 6c6c 7927 2069 6e20  uccessfully' in 
-00024610: 6f75 7470 7574 206f 725c 0a20 2020 2020  output or\.     
-00024620: 2020 2020 2020 2020 2020 2020 2020 2746                'F
-00024630: 696e 6973 6865 6420 436f 6d62 7573 7469  inished Combusti
-00024640: 6f6e 2720 696e 206f 7574 7075 743a 0a20  on' in output:. 
-00024650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024660: 2020 2062 7265 616b 0a20 2020 2020 2020     break.       
-00024670: 2020 2020 2020 2020 206f 7574 7075 7420           output 
-00024680: 3d20 6f75 7470 7574 2e72 6570 6c61 6365  = output.replace
-00024690: 286f 6c64 6f75 7470 7574 2c20 2727 290a  (oldoutput, '').
-000246a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000246b0: 6966 206e 6f74 2071 7569 6574 3a0a 2020  if not quiet:.  
-000246c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000246d0: 2020 7072 696e 7428 6f75 7470 7574 290a    print(output).
-000246e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000246f0: 6f6c 646f 7574 7075 7420 3d20 6f75 7470  oldoutput = outp
-00024700: 7574 0a20 2020 2020 2020 2020 2020 2073  ut.            s
-00024710: 6c65 6570 2832 290a 2020 2020 2020 2020  leep(2).        
-00024720: 2020 2020 7469 6d65 6f75 7420 2b3d 2032      timeout += 2
-00024730: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00024740: 7761 6974 7469 6d65 6f75 7420 3e20 3020  waittimeout > 0 
-00024750: 616e 6420 7469 6d65 6f75 7420 3e20 7761  and timeout > wa
-00024760: 6974 7469 6d65 6f75 743a 0a20 2020 2020  ittimeout:.     
-00024770: 2020 2020 2020 2020 2020 2065 7272 6f72             error
-00024780: 2822 5469 6d65 6f75 7420 7761 6974 696e  ("Timeout waitin
-00024790: 6720 666f 7220 7761 6974 636f 6d6d 616e  g for waitcomman
-000247a0: 6420 746f 2065 7865 6375 7465 2e2e 2e22  d to execute..."
-000247b0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000247c0: 2020 6272 6561 6b0a 2020 2020 2020 2020    break.        
-000247d0: 7265 7475 726e 2054 7275 650a 0a20 2020  return True..   
-000247e0: 2064 6566 2063 6c65 616e 5f74 656d 706b   def clean_tempk
-000247f0: 6579 2873 656c 662c 206e 616d 652c 2069  ey(self, name, i
-00024800: 6465 6e74 6974 7966 696c 653d 4e6f 6e65  dentityfile=None
-00024810: 293a 0a20 2020 2020 2020 2063 6d64 203d  ):.        cmd =
-00024820: 2022 7365 6420 2d69 2027 2f74 656d 702d   "sed -i '/temp-
-00024830: 6b63 6c69 2d6b 6579 2f64 2720 2f68 6f6d  kcli-key/d' /hom
-00024840: 652f 2a2f 2e73 7368 2f61 7574 686f 7269  e/*/.ssh/authori
-00024850: 7a65 645f 6b65 7973 202f 726f 6f74 2f2e  zed_keys /root/.
-00024860: 7373 682f 6175 7468 6f72 697a 6564 5f6b  ssh/authorized_k
-00024870: 6579 7322 0a20 2020 2020 2020 206b 203d  eys".        k =
-00024880: 2073 656c 662e 6b0a 2020 2020 2020 2020   self.k.        
-00024890: 696e 666f 203d 206b 2e69 6e66 6f28 6e61  info = k.info(na
-000248a0: 6d65 290a 2020 2020 2020 2020 766d 706f  me).        vmpo
-000248b0: 7274 203d 204e 6f6e 650a 2020 2020 2020  rt = None.      
-000248c0: 2020 6970 203d 2069 6e66 6f2e 6765 7428    ip = info.get(
-000248d0: 2769 7027 290a 2020 2020 2020 2020 6966  'ip').        if
-000248e0: 2073 656c 662e 7479 7065 203d 3d20 276b   self.type == 'k
-000248f0: 7562 6576 6972 7427 3a0a 2020 2020 2020  ubevirt':.      
-00024900: 2020 2020 2020 6966 206b 2e61 6363 6573        if k.acces
-00024910: 735f 6d6f 6465 203d 3d20 274e 6f64 6550  s_mode == 'NodeP
-00024920: 6f72 7427 3a0a 2020 2020 2020 2020 2020  ort':.          
-00024930: 2020 2020 2020 766d 706f 7274 203d 2069        vmport = i
-00024940: 6e66 6f2e 6765 7428 276e 6f64 6570 6f72  nfo.get('nodepor
-00024950: 7427 290a 2020 2020 2020 2020 2020 2020  t').            
-00024960: 2020 2020 6970 203d 206b 2e6e 6f64 655f      ip = k.node_
-00024970: 686f 7374 286e 616d 653d 696e 666f 2e67  host(name=info.g
-00024980: 6574 2827 686f 7374 2729 290a 2020 2020  et('host')).    
-00024990: 2020 2020 2020 2020 656c 6966 206b 2e61          elif k.a
-000249a0: 6363 6573 735f 6d6f 6465 203d 3d20 274c  ccess_mode == 'L
-000249b0: 6f61 6442 616c 616e 6365 7227 3a0a 2020  oadBalancer':.  
-000249c0: 2020 2020 2020 2020 2020 2020 2020 6970                ip
-000249d0: 203d 2069 6e66 6f2e 6765 7428 276c 6f61   = info.get('loa
-000249e0: 6462 616c 616e 6365 7269 7027 290a 2020  dbalancerip').  
-000249f0: 2020 2020 2020 7373 6863 6d64 203d 2063        sshcmd = c
-00024a00: 6f6d 6d6f 6e2e 7373 6828 6e61 6d65 2c20  ommon.ssh(name, 
-00024a10: 7573 6572 3d27 726f 6f74 272c 2069 703d  user='root', ip=
-00024a20: 6970 2c20 7475 6e6e 656c 3d73 656c 662e  ip, tunnel=self.
-00024a30: 7475 6e6e 656c 2c20 7475 6e6e 656c 686f  tunnel, tunnelho
-00024a40: 7374 3d73 656c 662e 7475 6e6e 656c 686f  st=self.tunnelho
-00024a50: 7374 2c20 766d 706f 7274 3d76 6d70 6f72  st, vmport=vmpor
-00024a60: 742c 0a20 2020 2020 2020 2020 2020 2020  t,.             
-00024a70: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-00024a80: 756e 6e65 6c70 6f72 743d 7365 6c66 2e74  unnelport=self.t
-00024a90: 756e 6e65 6c70 6f72 742c 2074 756e 6e65  unnelport, tunne
-00024aa0: 6c75 7365 723d 7365 6c66 2e74 756e 6e65  luser=self.tunne
-00024ab0: 6c75 7365 722c 2069 6e73 6563 7572 653d  luser, insecure=
-00024ac0: 7365 6c66 2e69 6e73 6563 7572 652c 2063  self.insecure, c
-00024ad0: 6d64 3d63 6d64 2c0a 2020 2020 2020 2020  md=cmd,.        
-00024ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024af0: 2020 2020 6964 656e 7469 7479 6669 6c65      identityfile
-00024b00: 3d69 6465 6e74 6974 7966 696c 652c 2070  =identityfile, p
-00024b10: 6173 7377 6f72 643d 4661 6c73 6529 0a20  assword=False). 
-00024b20: 2020 2020 2020 206f 732e 706f 7065 6e28         os.popen(
-00024b30: 7373 6863 6d64 292e 7265 6164 2829 0a0a  sshcmd).read()..
-00024b40: 2020 2020 6465 6620 7468 7265 6164 6564      def threaded
-00024b50: 5f63 7265 6174 655f 6b75 6265 2873 656c  _create_kube(sel
-00024b60: 662c 2063 6c75 7374 6572 2c20 6b75 6265  f, cluster, kube
-00024b70: 7479 7065 2c20 6b75 6265 5f6f 7665 7272  type, kube_overr
-00024b80: 6964 6573 293a 0a20 2020 2020 2020 2069  ides):.        i
-00024b90: 7070 6f6f 6c20 3d20 6b75 6265 5f6f 7665  ppool = kube_ove
-00024ba0: 7272 6964 6573 2e67 6574 2827 6970 706f  rrides.get('ippo
-00024bb0: 6f6c 2729 206f 7220 6b75 6265 5f6f 7665  ol') or kube_ove
-00024bc0: 7272 6964 6573 2e67 6574 2827 636f 6e66  rrides.get('conf
-00024bd0: 706f 6f6c 2729 0a20 2020 2020 2020 2062  pool').        b
-00024be0: 6172 656d 6574 616c 706f 6f6c 203d 206b  aremetalpool = k
-00024bf0: 7562 655f 6f76 6572 7269 6465 732e 6765  ube_overrides.ge
-00024c00: 7428 2769 7070 6f6f 6c27 2920 6f72 206b  t('ippool') or k
-00024c10: 7562 655f 6f76 6572 7269 6465 732e 6765  ube_overrides.ge
-00024c20: 7428 2763 6f6e 6670 6f6f 6c27 290a 2020  t('confpool').  
-00024c30: 2020 2020 2020 6966 2069 7070 6f6f 6c20        if ippool 
-00024c40: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-00024c50: 2020 2020 2020 2020 2073 656c 662e 6765           self.ge
-00024c60: 745f 7669 705f 6672 6f6d 5f63 6f6e 6670  t_vip_from_confp
-00024c70: 6f6f 6c28 636c 7573 7465 722c 2069 7070  ool(cluster, ipp
-00024c80: 6f6f 6c2c 206f 7665 7272 6964 6573 3d6b  ool, overrides=k
-00024c90: 7562 655f 6f76 6572 7269 6465 7329 0a20  ube_overrides). 
-00024ca0: 2020 2020 2020 2069 6620 6261 7265 6d65         if bareme
-00024cb0: 7461 6c70 6f6f 6c20 6973 206e 6f74 204e  talpool is not N
-00024cc0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00024cd0: 2073 656c 662e 6765 745f 6261 7265 6d65   self.get_bareme
-00024ce0: 7461 6c5f 686f 7374 735f 6672 6f6d 5f63  tal_hosts_from_c
-00024cf0: 6f6e 6670 6f6f 6c28 636c 7573 7465 722c  onfpool(cluster,
-00024d00: 2062 6172 656d 6574 616c 706f 6f6c 2c20   baremetalpool, 
-00024d10: 6f76 6572 7269 6465 733d 6b75 6265 5f6f  overrides=kube_o
-00024d20: 7665 7272 6964 6573 290a 2020 2020 2020  verrides).      
-00024d30: 2020 7365 6c66 2e63 7265 6174 655f 6b75    self.create_ku
-00024d40: 6265 2863 6c75 7374 6572 2c20 6b75 6265  be(cluster, kube
-00024d50: 7479 7065 2c20 6b75 6265 5f6f 7665 7272  type, kube_overr
-00024d60: 6964 6573 290a 0a20 2020 2064 6566 2063  ides)..    def c
-00024d70: 7265 6174 655f 6b75 6265 2873 656c 662c  reate_kube(self,
-00024d80: 2063 6c75 7374 6572 2c20 6b75 6265 7479   cluster, kubety
-00024d90: 7065 2c20 6f76 6572 7269 6465 733d 7b7d  pe, overrides={}
-00024da0: 293a 0a20 2020 2020 2020 2069 6620 7365  ):.        if se
-00024db0: 6c66 2e74 7970 6520 3d3d 2027 7765 6227  lf.type == 'web'
-00024dc0: 2061 6e64 2073 656c 662e 6b2e 6c6f 6361   and self.k.loca
-00024dd0: 6c6b 7562 653a 0a20 2020 2020 2020 2020  lkube:.         
-00024de0: 2020 2072 6574 7572 6e20 7365 6c66 2e6b     return self.k
-00024df0: 2e63 7265 6174 655f 6b75 6265 2863 6c75  .create_kube(clu
-00024e00: 7374 6572 2c20 6b75 6265 7479 7065 2c20  ster, kubetype, 
-00024e10: 6f76 6572 7269 6465 733d 6f76 6572 7269  overrides=overri
-00024e20: 6465 7329 0a20 2020 2020 2020 2069 7070  des).        ipp
-00024e30: 6f6f 6c20 3d20 6f76 6572 7269 6465 732e  ool = overrides.
-00024e40: 6765 7428 2769 7070 6f6f 6c27 2920 6f72  get('ippool') or
-00024e50: 206f 7665 7272 6964 6573 2e67 6574 2827   overrides.get('
-00024e60: 636f 6e66 706f 6f6c 2729 0a20 2020 2020  confpool').     
-00024e70: 2020 2062 6172 656d 6574 616c 706f 6f6c     baremetalpool
-00024e80: 203d 206f 7665 7272 6964 6573 2e67 6574   = overrides.get
-00024e90: 2827 6970 706f 6f6c 2729 206f 7220 6f76  ('ippool') or ov
-00024ea0: 6572 7269 6465 732e 6765 7428 2763 6f6e  errides.get('con
-00024eb0: 6670 6f6f 6c27 290a 2020 2020 2020 2020  fpool').        
-00024ec0: 6966 2069 7070 6f6f 6c20 6973 206e 6f74  if ippool is not
-00024ed0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00024ee0: 2020 2073 656c 662e 6765 745f 7669 705f     self.get_vip_
-00024ef0: 6672 6f6d 5f63 6f6e 6670 6f6f 6c28 636c  from_confpool(cl
-00024f00: 7573 7465 722c 2069 7070 6f6f 6c2c 206f  uster, ippool, o
-00024f10: 7665 7272 6964 6573 3d6f 7665 7272 6964  verrides=overrid
-00024f20: 6573 290a 2020 2020 2020 2020 6966 2062  es).        if b
-00024f30: 6172 656d 6574 616c 706f 6f6c 2069 7320  aremetalpool is 
-00024f40: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-00024f50: 2020 2020 2020 7365 6c66 2e67 6574 5f62        self.get_b
-00024f60: 6172 656d 6574 616c 5f68 6f73 7473 5f66  aremetal_hosts_f
-00024f70: 726f 6d5f 636f 6e66 706f 6f6c 2863 6c75  rom_confpool(clu
-00024f80: 7374 6572 2c20 6261 7265 6d65 7461 6c70  ster, baremetalp
-00024f90: 6f6f 6c2c 206f 7665 7272 6964 6573 3d6f  ool, overrides=o
-00024fa0: 7665 7272 6964 6573 290a 2020 2020 2020  verrides).      
-00024fb0: 2020 6966 206b 7562 6574 7970 6520 3d3d    if kubetype ==
-00024fc0: 2027 6f70 656e 7368 6966 7427 3a0a 2020   'openshift':.  
-00024fd0: 2020 2020 2020 2020 2020 7265 7375 6c74            result
-00024fe0: 203d 2073 656c 662e 6372 6561 7465 5f6b   = self.create_k
-00024ff0: 7562 655f 6f70 656e 7368 6966 7428 636c  ube_openshift(cl
-00025000: 7573 7465 722c 206f 7665 7272 6964 6573  uster, overrides
-00025010: 3d6f 7665 7272 6964 6573 290a 2020 2020  =overrides).    
-00025020: 2020 2020 656c 6966 206b 7562 6574 7970      elif kubetyp
-00025030: 6520 3d3d 2027 6879 7065 7273 6869 6674  e == 'hypershift
-00025040: 273a 0a20 2020 2020 2020 2020 2020 2072  ':.            r
-00025050: 6573 756c 7420 3d20 7365 6c66 2e63 7265  esult = self.cre
-00025060: 6174 655f 6b75 6265 5f68 7970 6572 7368  ate_kube_hypersh
-00025070: 6966 7428 636c 7573 7465 722c 206f 7665  ift(cluster, ove
-00025080: 7272 6964 6573 3d6f 7665 7272 6964 6573  rrides=overrides
-00025090: 290a 2020 2020 2020 2020 656c 6966 206b  ).        elif k
-000250a0: 7562 6574 7970 6520 3d3d 2027 6d69 6372  ubetype == 'micr
-000250b0: 6f73 6869 6674 273a 0a20 2020 2020 2020  oshift':.       
-000250c0: 2020 2020 2072 6573 756c 7420 3d20 7365       result = se
-000250d0: 6c66 2e63 7265 6174 655f 6b75 6265 5f6d  lf.create_kube_m
-000250e0: 6963 726f 7368 6966 7428 636c 7573 7465  icroshift(cluste
-000250f0: 722c 206f 7665 7272 6964 6573 3d6f 7665  r, overrides=ove
-00025100: 7272 6964 6573 290a 2020 2020 2020 2020  rrides).        
-00025110: 656c 6966 206b 7562 6574 7970 6520 3d3d  elif kubetype ==
-00025120: 2027 6b33 7327 3a0a 2020 2020 2020 2020   'k3s':.        
-00025130: 2020 2020 7265 7375 6c74 203d 2073 656c      result = sel
-00025140: 662e 6372 6561 7465 5f6b 7562 655f 6b33  f.create_kube_k3
-00025150: 7328 636c 7573 7465 722c 206f 7665 7272  s(cluster, overr
-00025160: 6964 6573 3d6f 7665 7272 6964 6573 290a  ides=overrides).
-00025170: 2020 2020 2020 2020 656c 6966 206b 7562          elif kub
-00025180: 6574 7970 6520 3d3d 2027 676b 6527 3a0a  etype == 'gke':.
-00025190: 2020 2020 2020 2020 2020 2020 7265 7375              resu
-000251a0: 6c74 203d 2073 656c 662e 6372 6561 7465  lt = self.create
-000251b0: 5f6b 7562 655f 676b 6528 636c 7573 7465  _kube_gke(cluste
-000251c0: 722c 206f 7665 7272 6964 6573 3d6f 7665  r, overrides=ove
-000251d0: 7272 6964 6573 290a 2020 2020 2020 2020  rrides).        
-000251e0: 656c 6966 206b 7562 6574 7970 6520 3d3d  elif kubetype ==
-000251f0: 2027 656b 7327 3a0a 2020 2020 2020 2020   'eks':.        
-00025200: 2020 2020 7265 7375 6c74 203d 2073 656c      result = sel
-00025210: 662e 6372 6561 7465 5f6b 7562 655f 656b  f.create_kube_ek
-00025220: 7328 636c 7573 7465 722c 206f 7665 7272  s(cluster, overr
-00025230: 6964 6573 3d6f 7665 7272 6964 6573 290a  ides=overrides).
-00025240: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00025250: 2020 2020 2020 2020 2020 7265 7375 6c74            result
-00025260: 203d 2073 656c 662e 6372 6561 7465 5f6b   = self.create_k
-00025270: 7562 655f 6765 6e65 7269 6328 636c 7573  ube_generic(clus
-00025280: 7465 722c 206f 7665 7272 6964 6573 3d6f  ter, overrides=o
-00025290: 7665 7272 6964 6573 290a 2020 2020 2020  verrides).      
-000252a0: 2020 7265 7475 726e 2072 6573 756c 740a    return result.
-000252b0: 0a20 2020 2064 6566 2063 7265 6174 655f  .    def create_
-000252c0: 6b75 6265 5f65 6b73 2873 656c 662c 2063  kube_eks(self, c
-000252d0: 6c75 7374 6572 2c20 6f76 6572 7269 6465  luster, override
-000252e0: 733d 7b7d 293a 0a20 2020 2020 2020 2066  s={}):.        f
-000252f0: 726f 6d20 6b76 6972 742e 636c 7573 7465  rom kvirt.cluste
-00025300: 7220 696d 706f 7274 2065 6b73 0a20 2020  r import eks.   
-00025310: 2020 2020 2069 6620 636f 6e74 6169 6e65       if containe
-00025320: 725f 6d6f 6465 2829 3a0a 2020 2020 2020  r_mode():.      
-00025330: 2020 2020 2020 6f73 2e65 6e76 6972 6f6e        os.environ
-00025340: 5b27 5041 5448 275d 202b 3d20 273a 2f77  ['PATH'] += ':/w
-00025350: 6f72 6b64 6972 270a 2020 2020 2020 2020  orkdir'.        
-00025360: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00025370: 2020 6f73 2e65 6e76 6972 6f6e 5b27 5041    os.environ['PA
-00025380: 5448 275d 202b 3d20 273a 2573 2720 2520  TH'] += ':%s' % 
-00025390: 6f73 2e67 6574 6377 6428 290a 2020 2020  os.getcwd().    
-000253a0: 2020 2020 7265 7475 726e 2065 6b73 2e63      return eks.c
-000253b0: 7265 6174 6528 7365 6c66 2c20 636c 7573  reate(self, clus
-000253c0: 7465 722c 206f 7665 7272 6964 6573 290a  ter, overrides).
-000253d0: 0a20 2020 2064 6566 2063 7265 6174 655f  .    def create_
-000253e0: 6b75 6265 5f67 656e 6572 6963 2873 656c  kube_generic(sel
-000253f0: 662c 2063 6c75 7374 6572 2c20 6f76 6572  f, cluster, over
-00025400: 7269 6465 733d 7b7d 293a 0a20 2020 2020  rides={}):.     
-00025410: 2020 2069 6620 636f 6e74 6169 6e65 725f     if container_
-00025420: 6d6f 6465 2829 3a0a 2020 2020 2020 2020  mode():.        
-00025430: 2020 2020 6f73 2e65 6e76 6972 6f6e 5b27      os.environ['
-00025440: 5041 5448 275d 202b 3d20 273a 2f77 6f72  PATH'] += ':/wor
-00025450: 6b64 6972 270a 2020 2020 2020 2020 656c  kdir'.        el
-00025460: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00025470: 6f73 2e65 6e76 6972 6f6e 5b27 5041 5448  os.environ['PATH
-00025480: 275d 202b 3d20 273a 2573 2720 2520 6f73  '] += ':%s' % os
-00025490: 2e67 6574 6377 6428 290a 2020 2020 2020  .getcwd().      
-000254a0: 2020 706c 616e 6469 7220 3d20 6f73 2e70    plandir = os.p
-000254b0: 6174 682e 6469 726e 616d 6528 6b75 6265  ath.dirname(kube
-000254c0: 6164 6d2e 6372 6561 7465 2e5f 5f63 6f64  adm.create.__cod
-000254d0: 655f 5f2e 636f 5f66 696c 656e 616d 6529  e__.co_filename)
-000254e0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000254f0: 6b75 6265 6164 6d2e 6372 6561 7465 2873  kubeadm.create(s
-00025500: 656c 662c 2070 6c61 6e64 6972 2c20 636c  elf, plandir, cl
-00025510: 7573 7465 722c 206f 7665 7272 6964 6573  uster, overrides
-00025520: 290a 0a20 2020 2064 6566 2063 7265 6174  )..    def creat
-00025530: 655f 6b75 6265 5f67 6b65 2873 656c 662c  e_kube_gke(self,
-00025540: 2063 6c75 7374 6572 2c20 6f76 6572 7269   cluster, overri
-00025550: 6465 733d 7b7d 293a 0a20 2020 2020 2020  des={}):.       
-00025560: 2066 726f 6d20 6b76 6972 742e 636c 7573   from kvirt.clus
-00025570: 7465 7220 696d 706f 7274 2067 6b65 0a20  ter import gke. 
-00025580: 2020 2020 2020 2069 6620 636f 6e74 6169         if contai
-00025590: 6e65 725f 6d6f 6465 2829 3a0a 2020 2020  ner_mode():.    
-000255a0: 2020 2020 2020 2020 6f73 2e65 6e76 6972          os.envir
-000255b0: 6f6e 5b27 5041 5448 275d 202b 3d20 273a  on['PATH'] += ':
-000255c0: 2f77 6f72 6b64 6972 270a 2020 2020 2020  /workdir'.      
-000255d0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-000255e0: 2020 2020 6f73 2e65 6e76 6972 6f6e 5b27      os.environ['
-000255f0: 5041 5448 275d 202b 3d20 273a 2573 2720  PATH'] += ':%s' 
-00025600: 2520 6f73 2e67 6574 6377 6428 290a 2020  % os.getcwd().  
-00025610: 2020 2020 2020 7265 7475 726e 2067 6b65        return gke
-00025620: 2e63 7265 6174 6528 7365 6c66 2c20 636c  .create(self, cl
-00025630: 7573 7465 722c 206f 7665 7272 6964 6573  uster, overrides
-00025640: 290a 0a20 2020 2064 6566 2063 7265 6174  )..    def creat
-00025650: 655f 6b75 6265 5f6d 6963 726f 7368 6966  e_kube_microshif
-00025660: 7428 7365 6c66 2c20 636c 7573 7465 722c  t(self, cluster,
-00025670: 206f 7665 7272 6964 6573 3d7b 7d29 3a0a   overrides={}):.
-00025680: 2020 2020 2020 2020 6966 2063 6f6e 7461          if conta
-00025690: 696e 6572 5f6d 6f64 6528 293a 0a20 2020  iner_mode():.   
-000256a0: 2020 2020 2020 2020 206f 732e 656e 7669           os.envi
-000256b0: 726f 6e5b 2750 4154 4827 5d20 2b3d 2027  ron['PATH'] += '
-000256c0: 3a2f 776f 726b 6469 7227 0a20 2020 2020  :/workdir'.     
-000256d0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-000256e0: 2020 2020 206f 732e 656e 7669 726f 6e5b       os.environ[
-000256f0: 2750 4154 4827 5d20 2b3d 2027 3a25 7327  'PATH'] += ':%s'
-00025700: 2025 206f 732e 6765 7463 7764 2829 0a20   % os.getcwd(). 
-00025710: 2020 2020 2020 2070 6c61 6e64 6972 203d         plandir =
-00025720: 206f 732e 7061 7468 2e64 6972 6e61 6d65   os.path.dirname
-00025730: 286d 6963 726f 7368 6966 742e 6372 6561  (microshift.crea
-00025740: 7465 2e5f 5f63 6f64 655f 5f2e 636f 5f66  te.__code__.co_f
-00025750: 696c 656e 616d 6529 0a20 2020 2020 2020  ilename).       
-00025760: 2072 6574 7572 6e20 6d69 6372 6f73 6869   return microshi
-00025770: 6674 2e63 7265 6174 6528 7365 6c66 2c20  ft.create(self, 
-00025780: 706c 616e 6469 722c 2063 6c75 7374 6572  plandir, cluster
-00025790: 2c20 6f76 6572 7269 6465 7329 0a0a 2020  , overrides)..  
-000257a0: 2020 6465 6620 6372 6561 7465 5f6b 7562    def create_kub
-000257b0: 655f 6b33 7328 7365 6c66 2c20 636c 7573  e_k3s(self, clus
-000257c0: 7465 722c 206f 7665 7272 6964 6573 3d7b  ter, overrides={
-000257d0: 7d29 3a0a 2020 2020 2020 2020 6966 2063  }):.        if c
-000257e0: 6f6e 7461 696e 6572 5f6d 6f64 6528 293a  ontainer_mode():
-000257f0: 0a20 2020 2020 2020 2020 2020 206f 732e  .            os.
-00025800: 656e 7669 726f 6e5b 2750 4154 4827 5d20  environ['PATH'] 
-00025810: 2b3d 2027 3a2f 776f 726b 6469 7227 0a20  += ':/workdir'. 
-00025820: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00025830: 2020 2020 2020 2020 206f 732e 656e 7669           os.envi
-00025840: 726f 6e5b 2750 4154 4827 5d20 2b3d 2027  ron['PATH'] += '
-00025850: 3a25 7327 2025 206f 732e 6765 7463 7764  :%s' % os.getcwd
-00025860: 2829 0a20 2020 2020 2020 2070 6c61 6e64  ().        pland
-00025870: 6972 203d 206f 732e 7061 7468 2e64 6972  ir = os.path.dir
-00025880: 6e61 6d65 286b 3373 2e63 7265 6174 652e  name(k3s.create.
-00025890: 5f5f 636f 6465 5f5f 2e63 6f5f 6669 6c65  __code__.co_file
-000258a0: 6e61 6d65 290a 2020 2020 2020 2020 7265  name).        re
-000258b0: 7475 726e 206b 3373 2e63 7265 6174 6528  turn k3s.create(
-000258c0: 7365 6c66 2c20 706c 616e 6469 722c 2063  self, plandir, c
-000258d0: 6c75 7374 6572 2c20 6f76 6572 7269 6465  luster, override
-000258e0: 7329 0a0a 2020 2020 6465 6620 6372 6561  s)..    def crea
-000258f0: 7465 5f6b 7562 655f 6879 7065 7273 6869  te_kube_hypershi
-00025900: 6674 2873 656c 662c 2063 6c75 7374 6572  ft(self, cluster
-00025910: 2c20 6f76 6572 7269 6465 733d 7b7d 293a  , overrides={}):
-00025920: 0a20 2020 2020 2020 2069 6620 636f 6e74  .        if cont
-00025930: 6169 6e65 725f 6d6f 6465 2829 3a0a 2020  ainer_mode():.  
-00025940: 2020 2020 2020 2020 2020 6f73 2e65 6e76            os.env
-00025950: 6972 6f6e 5b27 5041 5448 275d 202b 3d20  iron['PATH'] += 
-00025960: 273a 2f77 6f72 6b64 6972 270a 2020 2020  ':/workdir'.    
-00025970: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00025980: 2020 2020 2020 6f73 2e65 6e76 6972 6f6e        os.environ
-00025990: 5b27 5041 5448 275d 202b 3d20 273a 2573  ['PATH'] += ':%s
-000259a0: 2720 2520 6f73 2e67 6574 6377 6428 290a  ' % os.getcwd().
-000259b0: 2020 2020 2020 2020 706c 616e 6469 7220          plandir 
-000259c0: 3d20 6f73 2e70 6174 682e 6469 726e 616d  = os.path.dirnam
-000259d0: 6528 6879 7065 7273 6869 6674 2e63 7265  e(hypershift.cre
-000259e0: 6174 652e 5f5f 636f 6465 5f5f 2e63 6f5f  ate.__code__.co_
-000259f0: 6669 6c65 6e61 6d65 290a 2020 2020 2020  filename).      
-00025a00: 2020 2320 646e 7363 6c69 656e 7420 3d20    # dnsclient = 
-00025a10: 6f76 6572 7269 6465 732e 6765 7428 2764  overrides.get('d
-00025a20: 6e73 636c 6965 6e74 2729 0a20 2020 2020  nsclient').     
-00025a30: 2020 2023 2064 6e73 636f 6e66 6967 203d     # dnsconfig =
-00025a40: 204b 636f 6e66 6967 2863 6c69 656e 743d   Kconfig(client=
-00025a50: 646e 7363 6c69 656e 7429 2069 6620 646e  dnsclient) if dn
-00025a60: 7363 6c69 656e 7420 6973 206e 6f74 204e  sclient is not N
-00025a70: 6f6e 6520 656c 7365 204e 6f6e 650a 2020  one else None.  
-00025a80: 2020 2020 2020 7265 7475 726e 2068 7970        return hyp
-00025a90: 6572 7368 6966 742e 6372 6561 7465 2873  ershift.create(s
-00025aa0: 656c 662c 2070 6c61 6e64 6972 2c20 636c  elf, plandir, cl
-00025ab0: 7573 7465 722c 206f 7665 7272 6964 6573  uster, overrides
-00025ac0: 290a 0a20 2020 2064 6566 2063 7265 6174  )..    def creat
-00025ad0: 655f 6b75 6265 5f6f 7065 6e73 6869 6674  e_kube_openshift
-00025ae0: 2873 656c 662c 2063 6c75 7374 6572 2c20  (self, cluster, 
-00025af0: 6f76 6572 7269 6465 733d 7b7d 293a 0a20  overrides={}):. 
-00025b00: 2020 2020 2020 2069 6620 636f 6e74 6169         if contai
-00025b10: 6e65 725f 6d6f 6465 2829 3a0a 2020 2020  ner_mode():.    
-00025b20: 2020 2020 2020 2020 6f73 2e65 6e76 6972          os.envir
-00025b30: 6f6e 5b27 5041 5448 275d 202b 3d20 273a  on['PATH'] += ':
-00025b40: 2f77 6f72 6b64 6972 270a 2020 2020 2020  /workdir'.      
-00025b50: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00025b60: 2020 2020 6f73 2e65 6e76 6972 6f6e 5b27      os.environ['
-00025b70: 5041 5448 275d 202b 3d20 273a 2573 2720  PATH'] += ':%s' 
-00025b80: 2520 6f73 2e67 6574 6377 6428 290a 2020  % os.getcwd().  
-00025b90: 2020 2020 2020 706c 616e 6469 7220 3d20        plandir = 
-00025ba0: 6f73 2e70 6174 682e 6469 726e 616d 6528  os.path.dirname(
-00025bb0: 6f70 656e 7368 6966 742e 6372 6561 7465  openshift.create
-00025bc0: 2e5f 5f63 6f64 655f 5f2e 636f 5f66 696c  .__code__.co_fil
-00025bd0: 656e 616d 6529 0a20 2020 2020 2020 2064  ename).        d
-00025be0: 6e73 636c 6965 6e74 203d 206f 7665 7272  nsclient = overr
-00025bf0: 6964 6573 2e67 6574 2827 646e 7363 6c69  ides.get('dnscli
-00025c00: 656e 7427 290a 2020 2020 2020 2020 646e  ent').        dn
-00025c10: 7363 6f6e 6669 6720 3d20 4b63 6f6e 6669  sconfig = Kconfi
-00025c20: 6728 636c 6965 6e74 3d64 6e73 636c 6965  g(client=dnsclie
-00025c30: 6e74 2920 6966 2064 6e73 636c 6965 6e74  nt) if dnsclient
-00025c40: 2069 7320 6e6f 7420 4e6f 6e65 2065 6c73   is not None els
-00025c50: 6520 4e6f 6e65 0a20 2020 2020 2020 2072  e None.        r
-00025c60: 6574 7572 6e20 6f70 656e 7368 6966 742e  eturn openshift.
-00025c70: 6372 6561 7465 2873 656c 662c 2070 6c61  create(self, pla
-00025c80: 6e64 6972 2c20 636c 7573 7465 722c 206f  ndir, cluster, o
-00025c90: 7665 7272 6964 6573 2c20 646e 7363 6f6e  verrides, dnscon
-00025ca0: 6669 673d 646e 7363 6f6e 6669 6729 0a0a  fig=dnsconfig)..
-00025cb0: 2020 2020 6465 6620 6465 6c65 7465 5f6b      def delete_k
-00025cc0: 7562 6528 7365 6c66 2c20 636c 7573 7465  ube(self, cluste
-00025cd0: 722c 206f 7665 7272 6964 6573 3d7b 7d29  r, overrides={})
-00025ce0: 3a0a 2020 2020 2020 2020 6879 7065 7273  :.        hypers
-00025cf0: 6869 6674 203d 206f 7665 7272 6964 6573  hift = overrides
-00025d00: 2e67 6574 2827 6b75 6265 7479 7065 272c  .get('kubetype',
-00025d10: 2027 7878 7827 2920 3d3d 2027 6879 7065   'xxx') == 'hype
-00025d20: 7273 6869 6674 270a 2020 2020 2020 2020  rshift'.        
-00025d30: 6173 7369 7374 6564 203d 2046 616c 7365  assisted = False
-00025d40: 0a20 2020 2020 2020 2065 6b73 203d 206f  .        eks = o
-00025d50: 7665 7272 6964 6573 2e67 6574 2827 6b75  verrides.get('ku
-00025d60: 6265 7479 7065 272c 2027 7878 7827 2920  betype', 'xxx') 
-00025d70: 3d3d 2027 656b 7327 0a20 2020 2020 2020  == 'eks'.       
-00025d80: 2067 6b65 203d 206f 7665 7272 6964 6573   gke = overrides
-00025d90: 2e67 6574 2827 6b75 6265 7479 7065 272c  .get('kubetype',
-00025da0: 2027 7878 7827 2920 3d3d 2027 676b 6527   'xxx') == 'gke'
-00025db0: 0a20 2020 2020 2020 2064 6f6d 6169 6e20  .        domain 
-00025dc0: 3d20 6f76 6572 7269 6465 732e 6765 7428  = overrides.get(
-00025dd0: 2764 6f6d 6169 6e27 2c20 276b 6172 6d61  'domain', 'karma
-00025de0: 6c61 6273 2e63 6f72 7027 290a 2020 2020  labs.corp').    
-00025df0: 2020 2020 6b75 6265 7479 7065 203d 206f      kubetype = o
-00025e00: 7665 7272 6964 6573 2e67 6574 2827 6b75  verrides.get('ku
-00025e10: 6265 7479 7065 272c 2027 6765 6e65 7269  betype', 'generi
-00025e20: 6327 290a 2020 2020 2020 2020 646e 7363  c').        dnsc
-00025e30: 6c69 656e 7420 3d20 4e6f 6e65 0a20 2020  lient = None.   
-00025e40: 2020 2020 206b 203d 2073 656c 662e 6b0a       k = self.k.
-00025e50: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00025e60: 7479 7065 203d 3d20 2777 6562 2720 616e  type == 'web' an
-00025e70: 6420 7365 6c66 2e6b 2e6c 6f63 616c 6b75  d self.k.localku
-00025e80: 6265 3a0a 2020 2020 2020 2020 2020 2020  be:.            
-00025e90: 7265 7475 726e 206b 2e64 656c 6574 655f  return k.delete_
-00025ea0: 6b75 6265 2863 6c75 7374 6572 2c20 6b75  kube(cluster, ku
-00025eb0: 6265 7479 7065 2c20 6f76 6572 7269 6465  betype, override
-00025ec0: 733d 6f76 6572 7269 6465 7329 0a20 2020  s=overrides).   
-00025ed0: 2020 2020 2063 6c75 7374 6572 203d 206f       cluster = o
-00025ee0: 7665 7272 6964 6573 2e67 6574 2827 636c  verrides.get('cl
-00025ef0: 7573 7465 7227 2c20 636c 7573 7465 7229  uster', cluster)
-00025f00: 0a20 2020 2020 2020 2069 6620 636c 7573  .        if clus
-00025f10: 7465 7220 6973 204e 6f6e 6520 6f72 2063  ter is None or c
-00025f20: 6c75 7374 6572 203d 3d20 2727 3a0a 2020  luster == '':.  
-00025f30: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
-00025f40: 745f 636c 7573 7465 7273 203d 207b 2767  t_clusters = {'g
-00025f50: 656e 6572 6963 273a 2027 6d79 6b75 6265  eneric': 'mykube
-00025f60: 272c 2027 6879 7065 7273 6869 6674 273a  ', 'hypershift':
-00025f70: 2027 6d79 6879 7065 7273 6869 6674 272c   'myhypershift',
-00025f80: 2027 6f70 656e 7368 6966 7427 3a20 276d   'openshift': 'm
-00025f90: 796f 7065 6e73 6869 6674 272c 0a20 2020  yopenshift',.   
-00025fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025fb0: 2020 2020 2020 2020 2020 2020 2027 6b33               'k3
-00025fc0: 7327 3a20 276d 796b 3373 272c 2027 6d69  s': 'myk3s', 'mi
-00025fd0: 6372 6f73 6869 6674 273a 2027 6d79 6d69  croshift': 'mymi
-00025fe0: 6372 6f73 6869 6674 272c 2027 676b 6527  croshift', 'gke'
-00025ff0: 3a20 276d 7967 6b65 272c 2027 656b 7327  : 'mygke', 'eks'
-00026000: 3a20 276d 7965 6b73 277d 0a20 2020 2020  : 'myeks'}.     
-00026010: 2020 2020 2020 2063 6c75 7374 6572 203d         cluster =
-00026020: 2064 6566 6175 6c74 5f63 6c75 7374 6572   default_cluster
-00026030: 735b 6b75 6265 7479 7065 5d0a 2020 2020  s[kubetype].    
-00026040: 2020 2020 636c 7573 7465 7264 6174 6120      clusterdata 
-00026050: 3d20 7b7d 0a20 2020 2020 2020 2063 6c75  = {}.        clu
-00026060: 7374 6572 6469 7220 3d20 6f73 2e70 6174  sterdir = os.pat
-00026070: 682e 6578 7061 6e64 7573 6572 2866 227e  h.expanduser(f"~
-00026080: 2f2e 6b63 6c69 2f63 6c75 7374 6572 732f  /.kcli/clusters/
-00026090: 7b63 6c75 7374 6572 7d22 290a 2020 2020  {cluster}").    
-000260a0: 2020 2020 6966 206f 732e 7061 7468 2e65      if os.path.e
-000260b0: 7869 7374 7328 636c 7573 7465 7264 6972  xists(clusterdir
-000260c0: 293a 0a20 2020 2020 2020 2020 2020 2070  ):.            p
-000260d0: 6172 616d 6574 6572 7366 696c 6520 3d20  arametersfile = 
-000260e0: 6622 7b63 6c75 7374 6572 6469 727d 2f6b  f"{clusterdir}/k
-000260f0: 636c 695f 7061 7261 6d65 7465 7273 2e79  cli_parameters.y
-00026100: 6d6c 220a 2020 2020 2020 2020 2020 2020  ml".            
-00026110: 6966 206f 732e 7061 7468 2e65 7869 7374  if os.path.exist
-00026120: 7328 7061 7261 6d65 7465 7273 6669 6c65  s(parametersfile
-00026130: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00026140: 2020 2077 6974 6820 6f70 656e 2870 6172     with open(par
-00026150: 616d 6574 6572 7366 696c 6529 2061 7320  ametersfile) as 
-00026160: 663a 0a20 2020 2020 2020 2020 2020 2020  f:.             
-00026170: 2020 2020 2020 2063 6c75 7374 6572 6461         clusterda
-00026180: 7461 203d 2079 616d 6c2e 7361 6665 5f6c  ta = yaml.safe_l
-00026190: 6f61 6428 6629 0a20 2020 2020 2020 2020  oad(f).         
-000261a0: 2020 2020 2020 2020 2020 206b 7562 6574             kubet
-000261b0: 7970 6520 3d20 636c 7573 7465 7264 6174  ype = clusterdat
-000261c0: 612e 6765 7428 276b 7562 6574 7970 6527  a.get('kubetype'
-000261d0: 2c20 2767 656e 6572 6963 2729 0a20 2020  , 'generic').   
-000261e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000261f0: 2069 6620 6b75 6265 7479 7065 203d 3d20   if kubetype == 
-00026200: 2768 7970 6572 7368 6966 7427 3a0a 2020  'hypershift':.  
-00026210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026220: 2020 2020 2020 6879 7065 7273 6869 6674        hypershift
-00026230: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
-00026240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026250: 6173 7369 7374 6564 203d 2063 6c75 7374  assisted = clust
-00026260: 6572 6461 7461 2e67 6574 2827 6173 7369  erdata.get('assi
-00026270: 7374 6564 272c 2046 616c 7365 290a 2020  sted', False).  
-00026280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026290: 2020 646f 6d61 696e 203d 2063 6c75 7374    domain = clust
-000262a0: 6572 6461 7461 2e67 6574 2827 646f 6d61  erdata.get('doma
-000262b0: 696e 272c 2064 6f6d 6169 6e29 0a20 2020  in', domain).   
-000262c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000262d0: 2064 6e73 636c 6965 6e74 203d 2063 6c75   dnsclient = clu
-000262e0: 7374 6572 6461 7461 2e67 6574 2827 646e  sterdata.get('dn
-000262f0: 7363 6c69 656e 7427 290a 2020 2020 2020  sclient').      
-00026300: 2020 2020 2020 2020 2020 2020 2020 676b                gk
-00026310: 6520 3d20 6b75 6265 7479 7065 203d 3d20  e = kubetype == 
-00026320: 2767 6b65 270a 2020 2020 2020 2020 2020  'gke'.          
-00026330: 2020 2020 2020 2020 2020 656b 7320 3d20            eks = 
-00026340: 6b75 6265 7479 7065 203d 3d20 2765 6b73  kubetype == 'eks
-00026350: 270a 2020 2020 2020 2020 6465 6c65 7465  '.        delete
-00026360: 636c 6965 6e74 7320 3d20 7b73 656c 662e  clients = {self.
-00026370: 636c 6965 6e74 3a20 6b7d 0a20 2020 2020  client: k}.     
-00026380: 2020 2076 6d63 6c69 656e 7473 203d 205b     vmclients = [
-00026390: 5d0a 2020 2020 2020 2020 766d 636c 6965  ].        vmclie
-000263a0: 6e74 735f 6669 6c65 203d 206f 732e 7061  nts_file = os.pa
-000263b0: 7468 2e65 7870 616e 6475 7365 7228 6627  th.expanduser(f'
-000263c0: 7e2f 2e6b 636c 692f 766d 636c 6965 6e74  ~/.kcli/vmclient
-000263d0: 735f 7b63 6c75 7374 6572 7d27 290a 2020  s_{cluster}').  
-000263e0: 2020 2020 2020 6966 206f 732e 7061 7468        if os.path
-000263f0: 2e65 7869 7374 7328 766d 636c 6965 6e74  .exists(vmclient
-00026400: 735f 6669 6c65 293a 0a20 2020 2020 2020  s_file):.       
-00026410: 2020 2020 2076 6d63 6c69 656e 7473 203d       vmclients =
-00026420: 2079 616d 6c2e 7361 6665 5f6c 6f61 6428   yaml.safe_load(
-00026430: 6f70 656e 2876 6d63 6c69 656e 7473 5f66  open(vmclients_f
-00026440: 696c 6529 290a 2020 2020 2020 2020 2020  ile)).          
-00026450: 2020 6f73 2e72 656d 6f76 6528 766d 636c    os.remove(vmcl
-00026460: 6965 6e74 735f 6669 6c65 290a 2020 2020  ients_file).    
-00026470: 2020 2020 6966 2073 656c 662e 6578 7472      if self.extr
-00026480: 6163 6c69 656e 7473 3a0a 2020 2020 2020  aclients:.      
+000241b0: 2069 7020 3d20 4e6f 6e65 0a20 2020 2020   ip = None.     
+000241c0: 2020 2020 2020 2070 7072 696e 7428 2257         pprint("W
+000241d0: 6169 7469 6e67 2066 6f72 2076 6d20 746f  aiting for vm to
+000241e0: 2062 6520 6163 6365 7373 6962 6c65 2e2e   be accessible..
+000241f0: 2e22 290a 2020 2020 2020 2020 2020 2020  .").            
+00024200: 736c 6565 7028 3529 0a20 2020 2020 2020  sleep(5).       
+00024210: 2020 2020 2074 696d 656f 7574 202b 3d20       timeout += 
+00024220: 350a 2020 2020 2020 2020 2020 2020 6966  5.            if
+00024230: 2077 6169 7474 696d 656f 7574 203e 2030   waittimeout > 0
+00024240: 2061 6e64 2074 696d 656f 7574 203e 2077   and timeout > w
+00024250: 6169 7474 696d 656f 7574 3a0a 2020 2020  aittimeout:.    
+00024260: 2020 2020 2020 2020 2020 2020 6572 726f              erro
+00024270: 7228 2254 696d 656f 7574 2077 6169 7469  r("Timeout waiti
+00024280: 6e67 2066 6f72 2076 6d20 746f 2062 6520  ng for vm to be 
+00024290: 6163 6365 7373 6962 6c65 2e2e 2e22 290a  accessible...").
+000242a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000242b0: 6272 6561 6b0a 2020 2020 2020 2020 736c  break.        sl
+000242c0: 6565 7028 3529 0a20 2020 2020 2020 206f  eep(5).        o
+000242d0: 6c64 6f75 7470 7574 203d 2027 270a 2020  ldoutput = ''.  
+000242e0: 2020 2020 2020 7469 6d65 6f75 7420 3d20        timeout = 
+000242f0: 300a 2020 2020 2020 2020 7768 696c 6520  0.        while 
+00024300: 5472 7565 3a0a 2020 2020 2020 2020 2020  True:.          
+00024310: 2020 7373 6863 6d64 203d 2063 6f6d 6d6f    sshcmd = commo
+00024320: 6e2e 7373 6828 6e61 6d65 2c20 7573 6572  n.ssh(name, user
+00024330: 3d27 726f 6f74 272c 2069 703d 6970 2c20  ='root', ip=ip, 
+00024340: 7475 6e6e 656c 3d63 6f6e 6669 672e 7475  tunnel=config.tu
+00024350: 6e6e 656c 2c20 7475 6e6e 656c 686f 7374  nnel, tunnelhost
+00024360: 3d63 6f6e 6669 672e 7475 6e6e 656c 686f  =config.tunnelho
+00024370: 7374 2c0a 2020 2020 2020 2020 2020 2020  st,.            
+00024380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024390: 2020 2020 766d 706f 7274 3d76 6d70 6f72      vmport=vmpor
+000243a0: 742c 2074 756e 6e65 6c70 6f72 743d 636f  t, tunnelport=co
+000243b0: 6e66 6967 2e74 756e 6e65 6c70 6f72 742c  nfig.tunnelport,
+000243c0: 2074 756e 6e65 6c75 7365 723d 636f 6e66   tunneluser=conf
+000243d0: 6967 2e74 756e 6e65 6c75 7365 722c 0a20  ig.tunneluser,. 
+000243e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000243f0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00024400: 6e73 6563 7572 653d 636f 6e66 6967 2e69  nsecure=config.i
+00024410: 6e73 6563 7572 652c 2063 6d64 3d63 6d64  nsecure, cmd=cmd
+00024420: 2c20 6964 656e 7469 7479 6669 6c65 3d69  , identityfile=i
+00024430: 6465 6e74 6974 7966 696c 652c 2070 6173  dentityfile, pas
+00024440: 7377 6f72 643d 4661 6c73 6529 0a20 2020  sword=False).   
+00024450: 2020 2020 2020 2020 206f 7574 7075 7420           output 
+00024460: 3d20 6f73 2e70 6f70 656e 2873 7368 636d  = os.popen(sshcm
+00024470: 6429 2e72 6561 6428 290a 2020 2020 2020  d).read().      
+00024480: 2020 2020 2020 6966 2077 6169 7463 6f6d        if waitcom
+00024490: 6d61 6e64 2069 7320 6e6f 7420 4e6f 6e65  mand is not None
+000244a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000244b0: 2020 6966 206f 7574 7075 7420 213d 2027    if output != '
+000244c0: 273a 0a20 2020 2020 2020 2020 2020 2020  ':.             
+000244d0: 2020 2020 2020 2070 7269 6e74 286f 7574         print(out
+000244e0: 7075 7429 0a20 2020 2020 2020 2020 2020  put).           
+000244f0: 2020 2020 2020 2020 2062 7265 616b 0a20           break. 
+00024500: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00024510: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00024520: 2020 2020 2020 2020 2070 7072 696e 7428           pprint(
+00024530: 2257 6169 7469 6e67 2066 6f72 2077 6169  "Waiting for wai
+00024540: 7463 6f6d 6d61 6e64 2074 6f20 7375 6363  tcommand to succ
+00024550: 6565 642e 2e2e 2229 0a20 2020 2020 2020  eed...").       
+00024560: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00024570: 2020 2020 2020 2020 2020 2069 6620 276b             if 'k
+00024580: 636c 6920 626f 6f74 2066 696e 6973 6865  cli boot finishe
+00024590: 6427 2069 6e20 6f75 7470 7574 206f 7220  d' in output or 
+000245a0: 2749 676e 6974 696f 6e20 6669 6e69 7368  'Ignition finish
+000245b0: 6564 2073 7563 6365 7373 6675 6c6c 7927  ed successfully'
+000245c0: 2069 6e20 6f75 7470 7574 206f 725c 0a20   in output or\. 
+000245d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000245e0: 2020 2746 696e 6973 6865 6420 436f 6d62    'Finished Comb
+000245f0: 7573 7469 6f6e 2720 696e 206f 7574 7075  ustion' in outpu
+00024600: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
+00024610: 2020 2020 2020 2062 7265 616b 0a20 2020         break.   
+00024620: 2020 2020 2020 2020 2020 2020 206f 7574               out
+00024630: 7075 7420 3d20 6f75 7470 7574 2e72 6570  put = output.rep
+00024640: 6c61 6365 286f 6c64 6f75 7470 7574 2c20  lace(oldoutput, 
+00024650: 2727 290a 2020 2020 2020 2020 2020 2020  '').            
+00024660: 2020 2020 6966 206e 6f74 2071 7569 6574      if not quiet
+00024670: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00024680: 2020 2020 2020 7072 696e 7428 6f75 7470        print(outp
+00024690: 7574 290a 2020 2020 2020 2020 2020 2020  ut).            
+000246a0: 2020 2020 6f6c 646f 7574 7075 7420 3d20      oldoutput = 
+000246b0: 6f75 7470 7574 0a20 2020 2020 2020 2020  output.         
+000246c0: 2020 2073 6c65 6570 2832 290a 2020 2020     sleep(2).    
+000246d0: 2020 2020 2020 2020 7469 6d65 6f75 7420          timeout 
+000246e0: 2b3d 2032 0a20 2020 2020 2020 2020 2020  += 2.           
+000246f0: 2069 6620 7761 6974 7469 6d65 6f75 7420   if waittimeout 
+00024700: 3e20 3020 616e 6420 7469 6d65 6f75 7420  > 0 and timeout 
+00024710: 3e20 7761 6974 7469 6d65 6f75 743a 0a20  > waittimeout:. 
+00024720: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00024730: 7272 6f72 2822 5469 6d65 6f75 7420 7761  rror("Timeout wa
+00024740: 6974 696e 6720 666f 7220 7761 6974 636f  iting for waitco
+00024750: 6d6d 616e 6420 746f 2065 7865 6375 7465  mmand to execute
+00024760: 2e2e 2e22 290a 2020 2020 2020 2020 2020  ...").          
+00024770: 2020 2020 2020 6272 6561 6b0a 2020 2020        break.    
+00024780: 2020 2020 7265 7475 726e 2054 7275 650a      return True.
+00024790: 0a20 2020 2064 6566 2063 6c65 616e 5f74  .    def clean_t
+000247a0: 656d 706b 6579 2873 656c 662c 206e 616d  empkey(self, nam
+000247b0: 652c 2069 6465 6e74 6974 7966 696c 653d  e, identityfile=
+000247c0: 4e6f 6e65 293a 0a20 2020 2020 2020 2063  None):.        c
+000247d0: 6d64 203d 2022 7365 6420 2d69 2027 2f74  md = "sed -i '/t
+000247e0: 656d 702d 6b63 6c69 2d6b 6579 2f64 2720  emp-kcli-key/d' 
+000247f0: 2f68 6f6d 652f 2a2f 2e73 7368 2f61 7574  /home/*/.ssh/aut
+00024800: 686f 7269 7a65 645f 6b65 7973 202f 726f  horized_keys /ro
+00024810: 6f74 2f2e 7373 682f 6175 7468 6f72 697a  ot/.ssh/authoriz
+00024820: 6564 5f6b 6579 7322 0a20 2020 2020 2020  ed_keys".       
+00024830: 206b 203d 2073 656c 662e 6b0a 2020 2020   k = self.k.    
+00024840: 2020 2020 696e 666f 203d 206b 2e69 6e66      info = k.inf
+00024850: 6f28 6e61 6d65 290a 2020 2020 2020 2020  o(name).        
+00024860: 766d 706f 7274 203d 204e 6f6e 650a 2020  vmport = None.  
+00024870: 2020 2020 2020 6970 203d 2069 6e66 6f2e        ip = info.
+00024880: 6765 7428 2769 7027 290a 2020 2020 2020  get('ip').      
+00024890: 2020 6966 2073 656c 662e 7479 7065 203d    if self.type =
+000248a0: 3d20 276b 7562 6576 6972 7427 3a0a 2020  = 'kubevirt':.  
+000248b0: 2020 2020 2020 2020 2020 6966 206b 2e61            if k.a
+000248c0: 6363 6573 735f 6d6f 6465 203d 3d20 274e  ccess_mode == 'N
+000248d0: 6f64 6550 6f72 7427 3a0a 2020 2020 2020  odePort':.      
+000248e0: 2020 2020 2020 2020 2020 766d 706f 7274            vmport
+000248f0: 203d 2069 6e66 6f2e 6765 7428 276e 6f64   = info.get('nod
+00024900: 6570 6f72 7427 290a 2020 2020 2020 2020  eport').        
+00024910: 2020 2020 2020 2020 6970 203d 206b 2e6e          ip = k.n
+00024920: 6f64 655f 686f 7374 286e 616d 653d 696e  ode_host(name=in
+00024930: 666f 2e67 6574 2827 686f 7374 2729 290a  fo.get('host')).
+00024940: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+00024950: 206b 2e61 6363 6573 735f 6d6f 6465 203d   k.access_mode =
+00024960: 3d20 274c 6f61 6442 616c 616e 6365 7227  = 'LoadBalancer'
+00024970: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00024980: 2020 6970 203d 2069 6e66 6f2e 6765 7428    ip = info.get(
+00024990: 276c 6f61 6462 616c 616e 6365 7269 7027  'loadbalancerip'
+000249a0: 290a 2020 2020 2020 2020 7373 6863 6d64  ).        sshcmd
+000249b0: 203d 2063 6f6d 6d6f 6e2e 7373 6828 6e61   = common.ssh(na
+000249c0: 6d65 2c20 7573 6572 3d27 726f 6f74 272c  me, user='root',
+000249d0: 2069 703d 6970 2c20 7475 6e6e 656c 3d73   ip=ip, tunnel=s
+000249e0: 656c 662e 7475 6e6e 656c 2c20 7475 6e6e  elf.tunnel, tunn
+000249f0: 656c 686f 7374 3d73 656c 662e 7475 6e6e  elhost=self.tunn
+00024a00: 656c 686f 7374 2c20 766d 706f 7274 3d76  elhost, vmport=v
+00024a10: 6d70 6f72 742c 0a20 2020 2020 2020 2020  mport,.         
+00024a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024a30: 2020 2074 756e 6e65 6c70 6f72 743d 7365     tunnelport=se
+00024a40: 6c66 2e74 756e 6e65 6c70 6f72 742c 2074  lf.tunnelport, t
+00024a50: 756e 6e65 6c75 7365 723d 7365 6c66 2e74  unneluser=self.t
+00024a60: 756e 6e65 6c75 7365 722c 2069 6e73 6563  unneluser, insec
+00024a70: 7572 653d 7365 6c66 2e69 6e73 6563 7572  ure=self.insecur
+00024a80: 652c 2063 6d64 3d63 6d64 2c0a 2020 2020  e, cmd=cmd,.    
+00024a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024aa0: 2020 2020 2020 2020 6964 656e 7469 7479          identity
+00024ab0: 6669 6c65 3d69 6465 6e74 6974 7966 696c  file=identityfil
+00024ac0: 652c 2070 6173 7377 6f72 643d 4661 6c73  e, password=Fals
+00024ad0: 6529 0a20 2020 2020 2020 206f 732e 706f  e).        os.po
+00024ae0: 7065 6e28 7373 6863 6d64 292e 7265 6164  pen(sshcmd).read
+00024af0: 2829 0a0a 2020 2020 6465 6620 7468 7265  ()..    def thre
+00024b00: 6164 6564 5f63 7265 6174 655f 6b75 6265  aded_create_kube
+00024b10: 2873 656c 662c 2063 6c75 7374 6572 2c20  (self, cluster, 
+00024b20: 6b75 6265 7479 7065 2c20 6b75 6265 5f6f  kubetype, kube_o
+00024b30: 7665 7272 6964 6573 293a 0a20 2020 2020  verrides):.     
+00024b40: 2020 2069 7070 6f6f 6c20 3d20 6b75 6265     ippool = kube
+00024b50: 5f6f 7665 7272 6964 6573 2e67 6574 2827  _overrides.get('
+00024b60: 6970 706f 6f6c 2729 206f 7220 6b75 6265  ippool') or kube
+00024b70: 5f6f 7665 7272 6964 6573 2e67 6574 2827  _overrides.get('
+00024b80: 636f 6e66 706f 6f6c 2729 0a20 2020 2020  confpool').     
+00024b90: 2020 2062 6172 656d 6574 616c 706f 6f6c     baremetalpool
+00024ba0: 203d 206b 7562 655f 6f76 6572 7269 6465   = kube_override
+00024bb0: 732e 6765 7428 2769 7070 6f6f 6c27 2920  s.get('ippool') 
+00024bc0: 6f72 206b 7562 655f 6f76 6572 7269 6465  or kube_override
+00024bd0: 732e 6765 7428 2763 6f6e 6670 6f6f 6c27  s.get('confpool'
+00024be0: 290a 2020 2020 2020 2020 6966 2069 7070  ).        if ipp
+00024bf0: 6f6f 6c20 6973 206e 6f74 204e 6f6e 653a  ool is not None:
+00024c00: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00024c10: 662e 6765 745f 7669 705f 6672 6f6d 5f63  f.get_vip_from_c
+00024c20: 6f6e 6670 6f6f 6c28 636c 7573 7465 722c  onfpool(cluster,
+00024c30: 2069 7070 6f6f 6c2c 206f 7665 7272 6964   ippool, overrid
+00024c40: 6573 3d6b 7562 655f 6f76 6572 7269 6465  es=kube_override
+00024c50: 7329 0a20 2020 2020 2020 2069 6620 6261  s).        if ba
+00024c60: 7265 6d65 7461 6c70 6f6f 6c20 6973 206e  remetalpool is n
+00024c70: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+00024c80: 2020 2020 2073 656c 662e 6765 745f 6261       self.get_ba
+00024c90: 7265 6d65 7461 6c5f 686f 7374 735f 6672  remetal_hosts_fr
+00024ca0: 6f6d 5f63 6f6e 6670 6f6f 6c28 636c 7573  om_confpool(clus
+00024cb0: 7465 722c 2062 6172 656d 6574 616c 706f  ter, baremetalpo
+00024cc0: 6f6c 2c20 6f76 6572 7269 6465 733d 6b75  ol, overrides=ku
+00024cd0: 6265 5f6f 7665 7272 6964 6573 290a 2020  be_overrides).  
+00024ce0: 2020 2020 2020 7365 6c66 2e63 7265 6174        self.creat
+00024cf0: 655f 6b75 6265 2863 6c75 7374 6572 2c20  e_kube(cluster, 
+00024d00: 6b75 6265 7479 7065 2c20 6b75 6265 5f6f  kubetype, kube_o
+00024d10: 7665 7272 6964 6573 290a 0a20 2020 2064  verrides)..    d
+00024d20: 6566 2063 7265 6174 655f 6b75 6265 2873  ef create_kube(s
+00024d30: 656c 662c 2063 6c75 7374 6572 2c20 6b75  elf, cluster, ku
+00024d40: 6265 7479 7065 2c20 6f76 6572 7269 6465  betype, override
+00024d50: 733d 7b7d 293a 0a20 2020 2020 2020 2069  s={}):.        i
+00024d60: 6620 7365 6c66 2e74 7970 6520 3d3d 2027  f self.type == '
+00024d70: 7765 6227 2061 6e64 2073 656c 662e 6b2e  web' and self.k.
+00024d80: 6c6f 6361 6c6b 7562 653a 0a20 2020 2020  localkube:.     
+00024d90: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+00024da0: 6c66 2e6b 2e63 7265 6174 655f 6b75 6265  lf.k.create_kube
+00024db0: 2863 6c75 7374 6572 2c20 6b75 6265 7479  (cluster, kubety
+00024dc0: 7065 2c20 6f76 6572 7269 6465 733d 6f76  pe, overrides=ov
+00024dd0: 6572 7269 6465 7329 0a20 2020 2020 2020  errides).       
+00024de0: 2069 7070 6f6f 6c20 3d20 6f76 6572 7269   ippool = overri
+00024df0: 6465 732e 6765 7428 2769 7070 6f6f 6c27  des.get('ippool'
+00024e00: 2920 6f72 206f 7665 7272 6964 6573 2e67  ) or overrides.g
+00024e10: 6574 2827 636f 6e66 706f 6f6c 2729 0a20  et('confpool'). 
+00024e20: 2020 2020 2020 2062 6172 656d 6574 616c         baremetal
+00024e30: 706f 6f6c 203d 206f 7665 7272 6964 6573  pool = overrides
+00024e40: 2e67 6574 2827 6970 706f 6f6c 2729 206f  .get('ippool') o
+00024e50: 7220 6f76 6572 7269 6465 732e 6765 7428  r overrides.get(
+00024e60: 2763 6f6e 6670 6f6f 6c27 290a 2020 2020  'confpool').    
+00024e70: 2020 2020 6966 2069 7070 6f6f 6c20 6973      if ippool is
+00024e80: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+00024e90: 2020 2020 2020 2073 656c 662e 6765 745f         self.get_
+00024ea0: 7669 705f 6672 6f6d 5f63 6f6e 6670 6f6f  vip_from_confpoo
+00024eb0: 6c28 636c 7573 7465 722c 2069 7070 6f6f  l(cluster, ippoo
+00024ec0: 6c2c 206f 7665 7272 6964 6573 3d6f 7665  l, overrides=ove
+00024ed0: 7272 6964 6573 290a 2020 2020 2020 2020  rrides).        
+00024ee0: 6966 2062 6172 656d 6574 616c 706f 6f6c  if baremetalpool
+00024ef0: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+00024f00: 2020 2020 2020 2020 2020 7365 6c66 2e67            self.g
+00024f10: 6574 5f62 6172 656d 6574 616c 5f68 6f73  et_baremetal_hos
+00024f20: 7473 5f66 726f 6d5f 636f 6e66 706f 6f6c  ts_from_confpool
+00024f30: 2863 6c75 7374 6572 2c20 6261 7265 6d65  (cluster, bareme
+00024f40: 7461 6c70 6f6f 6c2c 206f 7665 7272 6964  talpool, overrid
+00024f50: 6573 3d6f 7665 7272 6964 6573 290a 2020  es=overrides).  
+00024f60: 2020 2020 2020 6966 206b 7562 6574 7970        if kubetyp
+00024f70: 6520 3d3d 2027 6f70 656e 7368 6966 7427  e == 'openshift'
+00024f80: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00024f90: 7375 6c74 203d 2073 656c 662e 6372 6561  sult = self.crea
+00024fa0: 7465 5f6b 7562 655f 6f70 656e 7368 6966  te_kube_openshif
+00024fb0: 7428 636c 7573 7465 722c 206f 7665 7272  t(cluster, overr
+00024fc0: 6964 6573 3d6f 7665 7272 6964 6573 290a  ides=overrides).
+00024fd0: 2020 2020 2020 2020 656c 6966 206b 7562          elif kub
+00024fe0: 6574 7970 6520 3d3d 2027 6879 7065 7273  etype == 'hypers
+00024ff0: 6869 6674 273a 0a20 2020 2020 2020 2020  hift':.         
+00025000: 2020 2072 6573 756c 7420 3d20 7365 6c66     result = self
+00025010: 2e63 7265 6174 655f 6b75 6265 5f68 7970  .create_kube_hyp
+00025020: 6572 7368 6966 7428 636c 7573 7465 722c  ershift(cluster,
+00025030: 206f 7665 7272 6964 6573 3d6f 7665 7272   overrides=overr
+00025040: 6964 6573 290a 2020 2020 2020 2020 656c  ides).        el
+00025050: 6966 206b 7562 6574 7970 6520 3d3d 2027  if kubetype == '
+00025060: 6d69 6372 6f73 6869 6674 273a 0a20 2020  microshift':.   
+00025070: 2020 2020 2020 2020 2072 6573 756c 7420           result 
+00025080: 3d20 7365 6c66 2e63 7265 6174 655f 6b75  = self.create_ku
+00025090: 6265 5f6d 6963 726f 7368 6966 7428 636c  be_microshift(cl
+000250a0: 7573 7465 722c 206f 7665 7272 6964 6573  uster, overrides
+000250b0: 3d6f 7665 7272 6964 6573 290a 2020 2020  =overrides).    
+000250c0: 2020 2020 656c 6966 206b 7562 6574 7970      elif kubetyp
+000250d0: 6520 3d3d 2027 6b33 7327 3a0a 2020 2020  e == 'k3s':.    
+000250e0: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
+000250f0: 2073 656c 662e 6372 6561 7465 5f6b 7562   self.create_kub
+00025100: 655f 6b33 7328 636c 7573 7465 722c 206f  e_k3s(cluster, o
+00025110: 7665 7272 6964 6573 3d6f 7665 7272 6964  verrides=overrid
+00025120: 6573 290a 2020 2020 2020 2020 656c 6966  es).        elif
+00025130: 206b 7562 6574 7970 6520 3d3d 2027 676b   kubetype == 'gk
+00025140: 6527 3a0a 2020 2020 2020 2020 2020 2020  e':.            
+00025150: 7265 7375 6c74 203d 2073 656c 662e 6372  result = self.cr
+00025160: 6561 7465 5f6b 7562 655f 676b 6528 636c  eate_kube_gke(cl
+00025170: 7573 7465 722c 206f 7665 7272 6964 6573  uster, overrides
+00025180: 3d6f 7665 7272 6964 6573 290a 2020 2020  =overrides).    
+00025190: 2020 2020 656c 6966 206b 7562 6574 7970      elif kubetyp
+000251a0: 6520 3d3d 2027 656b 7327 3a0a 2020 2020  e == 'eks':.    
+000251b0: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
+000251c0: 2073 656c 662e 6372 6561 7465 5f6b 7562   self.create_kub
+000251d0: 655f 656b 7328 636c 7573 7465 722c 206f  e_eks(cluster, o
+000251e0: 7665 7272 6964 6573 3d6f 7665 7272 6964  verrides=overrid
+000251f0: 6573 290a 2020 2020 2020 2020 656c 7365  es).        else
+00025200: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00025210: 7375 6c74 203d 2073 656c 662e 6372 6561  sult = self.crea
+00025220: 7465 5f6b 7562 655f 6765 6e65 7269 6328  te_kube_generic(
+00025230: 636c 7573 7465 722c 206f 7665 7272 6964  cluster, overrid
+00025240: 6573 3d6f 7665 7272 6964 6573 290a 2020  es=overrides).  
+00025250: 2020 2020 2020 7265 7475 726e 2072 6573        return res
+00025260: 756c 740a 0a20 2020 2064 6566 2063 7265  ult..    def cre
+00025270: 6174 655f 6b75 6265 5f65 6b73 2873 656c  ate_kube_eks(sel
+00025280: 662c 2063 6c75 7374 6572 2c20 6f76 6572  f, cluster, over
+00025290: 7269 6465 733d 7b7d 293a 0a20 2020 2020  rides={}):.     
+000252a0: 2020 2066 726f 6d20 6b76 6972 742e 636c     from kvirt.cl
+000252b0: 7573 7465 7220 696d 706f 7274 2065 6b73  uster import eks
+000252c0: 0a20 2020 2020 2020 2069 6620 636f 6e74  .        if cont
+000252d0: 6169 6e65 725f 6d6f 6465 2829 3a0a 2020  ainer_mode():.  
+000252e0: 2020 2020 2020 2020 2020 6f73 2e65 6e76            os.env
+000252f0: 6972 6f6e 5b27 5041 5448 275d 202b 3d20  iron['PATH'] += 
+00025300: 273a 2f77 6f72 6b64 6972 270a 2020 2020  ':/workdir'.    
+00025310: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00025320: 2020 2020 2020 6f73 2e65 6e76 6972 6f6e        os.environ
+00025330: 5b27 5041 5448 275d 202b 3d20 273a 2573  ['PATH'] += ':%s
+00025340: 2720 2520 6f73 2e67 6574 6377 6428 290a  ' % os.getcwd().
+00025350: 2020 2020 2020 2020 7265 7475 726e 2065          return e
+00025360: 6b73 2e63 7265 6174 6528 7365 6c66 2c20  ks.create(self, 
+00025370: 636c 7573 7465 722c 206f 7665 7272 6964  cluster, overrid
+00025380: 6573 290a 0a20 2020 2064 6566 2063 7265  es)..    def cre
+00025390: 6174 655f 6b75 6265 5f67 656e 6572 6963  ate_kube_generic
+000253a0: 2873 656c 662c 2063 6c75 7374 6572 2c20  (self, cluster, 
+000253b0: 6f76 6572 7269 6465 733d 7b7d 293a 0a20  overrides={}):. 
+000253c0: 2020 2020 2020 2069 6620 636f 6e74 6169         if contai
+000253d0: 6e65 725f 6d6f 6465 2829 3a0a 2020 2020  ner_mode():.    
+000253e0: 2020 2020 2020 2020 6f73 2e65 6e76 6972          os.envir
+000253f0: 6f6e 5b27 5041 5448 275d 202b 3d20 273a  on['PATH'] += ':
+00025400: 2f77 6f72 6b64 6972 270a 2020 2020 2020  /workdir'.      
+00025410: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00025420: 2020 2020 6f73 2e65 6e76 6972 6f6e 5b27      os.environ['
+00025430: 5041 5448 275d 202b 3d20 273a 2573 2720  PATH'] += ':%s' 
+00025440: 2520 6f73 2e67 6574 6377 6428 290a 2020  % os.getcwd().  
+00025450: 2020 2020 2020 706c 616e 6469 7220 3d20        plandir = 
+00025460: 6f73 2e70 6174 682e 6469 726e 616d 6528  os.path.dirname(
+00025470: 6b75 6265 6164 6d2e 6372 6561 7465 2e5f  kubeadm.create._
+00025480: 5f63 6f64 655f 5f2e 636f 5f66 696c 656e  _code__.co_filen
+00025490: 616d 6529 0a20 2020 2020 2020 2072 6574  ame).        ret
+000254a0: 7572 6e20 6b75 6265 6164 6d2e 6372 6561  urn kubeadm.crea
+000254b0: 7465 2873 656c 662c 2070 6c61 6e64 6972  te(self, plandir
+000254c0: 2c20 636c 7573 7465 722c 206f 7665 7272  , cluster, overr
+000254d0: 6964 6573 290a 0a20 2020 2064 6566 2063  ides)..    def c
+000254e0: 7265 6174 655f 6b75 6265 5f67 6b65 2873  reate_kube_gke(s
+000254f0: 656c 662c 2063 6c75 7374 6572 2c20 6f76  elf, cluster, ov
+00025500: 6572 7269 6465 733d 7b7d 293a 0a20 2020  errides={}):.   
+00025510: 2020 2020 2066 726f 6d20 6b76 6972 742e       from kvirt.
+00025520: 636c 7573 7465 7220 696d 706f 7274 2067  cluster import g
+00025530: 6b65 0a20 2020 2020 2020 2069 6620 636f  ke.        if co
+00025540: 6e74 6169 6e65 725f 6d6f 6465 2829 3a0a  ntainer_mode():.
+00025550: 2020 2020 2020 2020 2020 2020 6f73 2e65              os.e
+00025560: 6e76 6972 6f6e 5b27 5041 5448 275d 202b  nviron['PATH'] +
+00025570: 3d20 273a 2f77 6f72 6b64 6972 270a 2020  = ':/workdir'.  
+00025580: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00025590: 2020 2020 2020 2020 6f73 2e65 6e76 6972          os.envir
+000255a0: 6f6e 5b27 5041 5448 275d 202b 3d20 273a  on['PATH'] += ':
+000255b0: 2573 2720 2520 6f73 2e67 6574 6377 6428  %s' % os.getcwd(
+000255c0: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+000255d0: 2067 6b65 2e63 7265 6174 6528 7365 6c66   gke.create(self
+000255e0: 2c20 636c 7573 7465 722c 206f 7665 7272  , cluster, overr
+000255f0: 6964 6573 290a 0a20 2020 2064 6566 2063  ides)..    def c
+00025600: 7265 6174 655f 6b75 6265 5f6d 6963 726f  reate_kube_micro
+00025610: 7368 6966 7428 7365 6c66 2c20 636c 7573  shift(self, clus
+00025620: 7465 722c 206f 7665 7272 6964 6573 3d7b  ter, overrides={
+00025630: 7d29 3a0a 2020 2020 2020 2020 6966 2063  }):.        if c
+00025640: 6f6e 7461 696e 6572 5f6d 6f64 6528 293a  ontainer_mode():
+00025650: 0a20 2020 2020 2020 2020 2020 206f 732e  .            os.
+00025660: 656e 7669 726f 6e5b 2750 4154 4827 5d20  environ['PATH'] 
+00025670: 2b3d 2027 3a2f 776f 726b 6469 7227 0a20  += ':/workdir'. 
+00025680: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00025690: 2020 2020 2020 2020 206f 732e 656e 7669           os.envi
+000256a0: 726f 6e5b 2750 4154 4827 5d20 2b3d 2027  ron['PATH'] += '
+000256b0: 3a25 7327 2025 206f 732e 6765 7463 7764  :%s' % os.getcwd
+000256c0: 2829 0a20 2020 2020 2020 2070 6c61 6e64  ().        pland
+000256d0: 6972 203d 206f 732e 7061 7468 2e64 6972  ir = os.path.dir
+000256e0: 6e61 6d65 286d 6963 726f 7368 6966 742e  name(microshift.
+000256f0: 6372 6561 7465 2e5f 5f63 6f64 655f 5f2e  create.__code__.
+00025700: 636f 5f66 696c 656e 616d 6529 0a20 2020  co_filename).   
+00025710: 2020 2020 2072 6574 7572 6e20 6d69 6372       return micr
+00025720: 6f73 6869 6674 2e63 7265 6174 6528 7365  oshift.create(se
+00025730: 6c66 2c20 706c 616e 6469 722c 2063 6c75  lf, plandir, clu
+00025740: 7374 6572 2c20 6f76 6572 7269 6465 7329  ster, overrides)
+00025750: 0a0a 2020 2020 6465 6620 6372 6561 7465  ..    def create
+00025760: 5f6b 7562 655f 6b33 7328 7365 6c66 2c20  _kube_k3s(self, 
+00025770: 636c 7573 7465 722c 206f 7665 7272 6964  cluster, overrid
+00025780: 6573 3d7b 7d29 3a0a 2020 2020 2020 2020  es={}):.        
+00025790: 6966 2063 6f6e 7461 696e 6572 5f6d 6f64  if container_mod
+000257a0: 6528 293a 0a20 2020 2020 2020 2020 2020  e():.           
+000257b0: 206f 732e 656e 7669 726f 6e5b 2750 4154   os.environ['PAT
+000257c0: 4827 5d20 2b3d 2027 3a2f 776f 726b 6469  H'] += ':/workdi
+000257d0: 7227 0a20 2020 2020 2020 2065 6c73 653a  r'.        else:
+000257e0: 0a20 2020 2020 2020 2020 2020 206f 732e  .            os.
+000257f0: 656e 7669 726f 6e5b 2750 4154 4827 5d20  environ['PATH'] 
+00025800: 2b3d 2027 3a25 7327 2025 206f 732e 6765  += ':%s' % os.ge
+00025810: 7463 7764 2829 0a20 2020 2020 2020 2070  tcwd().        p
+00025820: 6c61 6e64 6972 203d 206f 732e 7061 7468  landir = os.path
+00025830: 2e64 6972 6e61 6d65 286b 3373 2e63 7265  .dirname(k3s.cre
+00025840: 6174 652e 5f5f 636f 6465 5f5f 2e63 6f5f  ate.__code__.co_
+00025850: 6669 6c65 6e61 6d65 290a 2020 2020 2020  filename).      
+00025860: 2020 7265 7475 726e 206b 3373 2e63 7265    return k3s.cre
+00025870: 6174 6528 7365 6c66 2c20 706c 616e 6469  ate(self, plandi
+00025880: 722c 2063 6c75 7374 6572 2c20 6f76 6572  r, cluster, over
+00025890: 7269 6465 7329 0a0a 2020 2020 6465 6620  rides)..    def 
+000258a0: 6372 6561 7465 5f6b 7562 655f 6879 7065  create_kube_hype
+000258b0: 7273 6869 6674 2873 656c 662c 2063 6c75  rshift(self, clu
+000258c0: 7374 6572 2c20 6f76 6572 7269 6465 733d  ster, overrides=
+000258d0: 7b7d 293a 0a20 2020 2020 2020 2069 6620  {}):.        if 
+000258e0: 636f 6e74 6169 6e65 725f 6d6f 6465 2829  container_mode()
+000258f0: 3a0a 2020 2020 2020 2020 2020 2020 6f73  :.            os
+00025900: 2e65 6e76 6972 6f6e 5b27 5041 5448 275d  .environ['PATH']
+00025910: 202b 3d20 273a 2f77 6f72 6b64 6972 270a   += ':/workdir'.
+00025920: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00025930: 2020 2020 2020 2020 2020 6f73 2e65 6e76            os.env
+00025940: 6972 6f6e 5b27 5041 5448 275d 202b 3d20  iron['PATH'] += 
+00025950: 273a 2573 2720 2520 6f73 2e67 6574 6377  ':%s' % os.getcw
+00025960: 6428 290a 2020 2020 2020 2020 706c 616e  d().        plan
+00025970: 6469 7220 3d20 6f73 2e70 6174 682e 6469  dir = os.path.di
+00025980: 726e 616d 6528 6879 7065 7273 6869 6674  rname(hypershift
+00025990: 2e63 7265 6174 652e 5f5f 636f 6465 5f5f  .create.__code__
+000259a0: 2e63 6f5f 6669 6c65 6e61 6d65 290a 2020  .co_filename).  
+000259b0: 2020 2020 2020 2320 646e 7363 6c69 656e        # dnsclien
+000259c0: 7420 3d20 6f76 6572 7269 6465 732e 6765  t = overrides.ge
+000259d0: 7428 2764 6e73 636c 6965 6e74 2729 0a20  t('dnsclient'). 
+000259e0: 2020 2020 2020 2023 2064 6e73 636f 6e66         # dnsconf
+000259f0: 6967 203d 204b 636f 6e66 6967 2863 6c69  ig = Kconfig(cli
+00025a00: 656e 743d 646e 7363 6c69 656e 7429 2069  ent=dnsclient) i
+00025a10: 6620 646e 7363 6c69 656e 7420 6973 206e  f dnsclient is n
+00025a20: 6f74 204e 6f6e 6520 656c 7365 204e 6f6e  ot None else Non
+00025a30: 650a 2020 2020 2020 2020 7265 7475 726e  e.        return
+00025a40: 2068 7970 6572 7368 6966 742e 6372 6561   hypershift.crea
+00025a50: 7465 2873 656c 662c 2070 6c61 6e64 6972  te(self, plandir
+00025a60: 2c20 636c 7573 7465 722c 206f 7665 7272  , cluster, overr
+00025a70: 6964 6573 290a 0a20 2020 2064 6566 2063  ides)..    def c
+00025a80: 7265 6174 655f 6b75 6265 5f6f 7065 6e73  reate_kube_opens
+00025a90: 6869 6674 2873 656c 662c 2063 6c75 7374  hift(self, clust
+00025aa0: 6572 2c20 6f76 6572 7269 6465 733d 7b7d  er, overrides={}
+00025ab0: 293a 0a20 2020 2020 2020 2069 6620 636f  ):.        if co
+00025ac0: 6e74 6169 6e65 725f 6d6f 6465 2829 3a0a  ntainer_mode():.
+00025ad0: 2020 2020 2020 2020 2020 2020 6f73 2e65              os.e
+00025ae0: 6e76 6972 6f6e 5b27 5041 5448 275d 202b  nviron['PATH'] +
+00025af0: 3d20 273a 2f77 6f72 6b64 6972 270a 2020  = ':/workdir'.  
+00025b00: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00025b10: 2020 2020 2020 2020 6f73 2e65 6e76 6972          os.envir
+00025b20: 6f6e 5b27 5041 5448 275d 202b 3d20 273a  on['PATH'] += ':
+00025b30: 2573 2720 2520 6f73 2e67 6574 6377 6428  %s' % os.getcwd(
+00025b40: 290a 2020 2020 2020 2020 706c 616e 6469  ).        plandi
+00025b50: 7220 3d20 6f73 2e70 6174 682e 6469 726e  r = os.path.dirn
+00025b60: 616d 6528 6f70 656e 7368 6966 742e 6372  ame(openshift.cr
+00025b70: 6561 7465 2e5f 5f63 6f64 655f 5f2e 636f  eate.__code__.co
+00025b80: 5f66 696c 656e 616d 6529 0a20 2020 2020  _filename).     
+00025b90: 2020 2064 6e73 636c 6965 6e74 203d 206f     dnsclient = o
+00025ba0: 7665 7272 6964 6573 2e67 6574 2827 646e  verrides.get('dn
+00025bb0: 7363 6c69 656e 7427 290a 2020 2020 2020  sclient').      
+00025bc0: 2020 646e 7363 6f6e 6669 6720 3d20 4b63    dnsconfig = Kc
+00025bd0: 6f6e 6669 6728 636c 6965 6e74 3d64 6e73  onfig(client=dns
+00025be0: 636c 6965 6e74 2920 6966 2064 6e73 636c  client) if dnscl
+00025bf0: 6965 6e74 2069 7320 6e6f 7420 4e6f 6e65  ient is not None
+00025c00: 2065 6c73 6520 4e6f 6e65 0a20 2020 2020   else None.     
+00025c10: 2020 2072 6574 7572 6e20 6f70 656e 7368     return opensh
+00025c20: 6966 742e 6372 6561 7465 2873 656c 662c  ift.create(self,
+00025c30: 2070 6c61 6e64 6972 2c20 636c 7573 7465   plandir, cluste
+00025c40: 722c 206f 7665 7272 6964 6573 2c20 646e  r, overrides, dn
+00025c50: 7363 6f6e 6669 673d 646e 7363 6f6e 6669  sconfig=dnsconfi
+00025c60: 6729 0a0a 2020 2020 6465 6620 6465 6c65  g)..    def dele
+00025c70: 7465 5f6b 7562 6528 7365 6c66 2c20 636c  te_kube(self, cl
+00025c80: 7573 7465 722c 206f 7665 7272 6964 6573  uster, overrides
+00025c90: 3d7b 7d29 3a0a 2020 2020 2020 2020 6879  ={}):.        hy
+00025ca0: 7065 7273 6869 6674 203d 206f 7665 7272  pershift = overr
+00025cb0: 6964 6573 2e67 6574 2827 6b75 6265 7479  ides.get('kubety
+00025cc0: 7065 272c 2027 7878 7827 2920 3d3d 2027  pe', 'xxx') == '
+00025cd0: 6879 7065 7273 6869 6674 270a 2020 2020  hypershift'.    
+00025ce0: 2020 2020 6173 7369 7374 6564 203d 2046      assisted = F
+00025cf0: 616c 7365 0a20 2020 2020 2020 2065 6b73  alse.        eks
+00025d00: 203d 206f 7665 7272 6964 6573 2e67 6574   = overrides.get
+00025d10: 2827 6b75 6265 7479 7065 272c 2027 7878  ('kubetype', 'xx
+00025d20: 7827 2920 3d3d 2027 656b 7327 0a20 2020  x') == 'eks'.   
+00025d30: 2020 2020 2067 6b65 203d 206f 7665 7272       gke = overr
+00025d40: 6964 6573 2e67 6574 2827 6b75 6265 7479  ides.get('kubety
+00025d50: 7065 272c 2027 7878 7827 2920 3d3d 2027  pe', 'xxx') == '
+00025d60: 676b 6527 0a20 2020 2020 2020 2064 6f6d  gke'.        dom
+00025d70: 6169 6e20 3d20 6f76 6572 7269 6465 732e  ain = overrides.
+00025d80: 6765 7428 2764 6f6d 6169 6e27 2c20 276b  get('domain', 'k
+00025d90: 6172 6d61 6c61 6273 2e63 6f72 7027 290a  armalabs.corp').
+00025da0: 2020 2020 2020 2020 6b75 6265 7479 7065          kubetype
+00025db0: 203d 206f 7665 7272 6964 6573 2e67 6574   = overrides.get
+00025dc0: 2827 6b75 6265 7479 7065 272c 2027 6765  ('kubetype', 'ge
+00025dd0: 6e65 7269 6327 290a 2020 2020 2020 2020  neric').        
+00025de0: 646e 7363 6c69 656e 7420 3d20 4e6f 6e65  dnsclient = None
+00025df0: 0a20 2020 2020 2020 206b 203d 2073 656c  .        k = sel
+00025e00: 662e 6b0a 2020 2020 2020 2020 6966 2073  f.k.        if s
+00025e10: 656c 662e 7479 7065 203d 3d20 2777 6562  elf.type == 'web
+00025e20: 2720 616e 6420 7365 6c66 2e6b 2e6c 6f63  ' and self.k.loc
+00025e30: 616c 6b75 6265 3a0a 2020 2020 2020 2020  alkube:.        
+00025e40: 2020 2020 7265 7475 726e 206b 2e64 656c      return k.del
+00025e50: 6574 655f 6b75 6265 2863 6c75 7374 6572  ete_kube(cluster
+00025e60: 2c20 6b75 6265 7479 7065 2c20 6f76 6572  , kubetype, over
+00025e70: 7269 6465 733d 6f76 6572 7269 6465 7329  rides=overrides)
+00025e80: 0a20 2020 2020 2020 2063 6c75 7374 6572  .        cluster
+00025e90: 203d 206f 7665 7272 6964 6573 2e67 6574   = overrides.get
+00025ea0: 2827 636c 7573 7465 7227 2c20 636c 7573  ('cluster', clus
+00025eb0: 7465 7229 0a20 2020 2020 2020 2069 6620  ter).        if 
+00025ec0: 636c 7573 7465 7220 6973 204e 6f6e 6520  cluster is None 
+00025ed0: 6f72 2063 6c75 7374 6572 203d 3d20 2727  or cluster == ''
+00025ee0: 3a0a 2020 2020 2020 2020 2020 2020 6465  :.            de
+00025ef0: 6661 756c 745f 636c 7573 7465 7273 203d  fault_clusters =
+00025f00: 207b 2767 656e 6572 6963 273a 2027 6d79   {'generic': 'my
+00025f10: 6b75 6265 272c 2027 6879 7065 7273 6869  kube', 'hypershi
+00025f20: 6674 273a 2027 6d79 6879 7065 7273 6869  ft': 'myhypershi
+00025f30: 6674 272c 2027 6f70 656e 7368 6966 7427  ft', 'openshift'
+00025f40: 3a20 276d 796f 7065 6e73 6869 6674 272c  : 'myopenshift',
+00025f50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00025f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025f70: 2027 6b33 7327 3a20 276d 796b 3373 272c   'k3s': 'myk3s',
+00025f80: 2027 6d69 6372 6f73 6869 6674 273a 2027   'microshift': '
+00025f90: 6d79 6d69 6372 6f73 6869 6674 272c 2027  mymicroshift', '
+00025fa0: 676b 6527 3a20 276d 7967 6b65 272c 2027  gke': 'mygke', '
+00025fb0: 656b 7327 3a20 276d 7965 6b73 277d 0a20  eks': 'myeks'}. 
+00025fc0: 2020 2020 2020 2020 2020 2063 6c75 7374             clust
+00025fd0: 6572 203d 2064 6566 6175 6c74 5f63 6c75  er = default_clu
+00025fe0: 7374 6572 735b 6b75 6265 7479 7065 5d0a  sters[kubetype].
+00025ff0: 2020 2020 2020 2020 636c 7573 7465 7264          clusterd
+00026000: 6174 6120 3d20 7b7d 0a20 2020 2020 2020  ata = {}.       
+00026010: 2063 6c75 7374 6572 6469 7220 3d20 6f73   clusterdir = os
+00026020: 2e70 6174 682e 6578 7061 6e64 7573 6572  .path.expanduser
+00026030: 2866 227e 2f2e 6b63 6c69 2f63 6c75 7374  (f"~/.kcli/clust
+00026040: 6572 732f 7b63 6c75 7374 6572 7d22 290a  ers/{cluster}").
+00026050: 2020 2020 2020 2020 6966 206f 732e 7061          if os.pa
+00026060: 7468 2e65 7869 7374 7328 636c 7573 7465  th.exists(cluste
+00026070: 7264 6972 293a 0a20 2020 2020 2020 2020  rdir):.         
+00026080: 2020 2070 6172 616d 6574 6572 7366 696c     parametersfil
+00026090: 6520 3d20 6622 7b63 6c75 7374 6572 6469  e = f"{clusterdi
+000260a0: 727d 2f6b 636c 695f 7061 7261 6d65 7465  r}/kcli_paramete
+000260b0: 7273 2e79 6d6c 220a 2020 2020 2020 2020  rs.yml".        
+000260c0: 2020 2020 6966 206f 732e 7061 7468 2e65      if os.path.e
+000260d0: 7869 7374 7328 7061 7261 6d65 7465 7273  xists(parameters
+000260e0: 6669 6c65 293a 0a20 2020 2020 2020 2020  file):.         
+000260f0: 2020 2020 2020 2077 6974 6820 6f70 656e         with open
+00026100: 2870 6172 616d 6574 6572 7366 696c 6529  (parametersfile)
+00026110: 2061 7320 663a 0a20 2020 2020 2020 2020   as f:.         
+00026120: 2020 2020 2020 2020 2020 2063 6c75 7374             clust
+00026130: 6572 6461 7461 203d 2079 616d 6c2e 7361  erdata = yaml.sa
+00026140: 6665 5f6c 6f61 6428 6629 0a20 2020 2020  fe_load(f).     
+00026150: 2020 2020 2020 2020 2020 2020 2020 206b                 k
+00026160: 7562 6574 7970 6520 3d20 636c 7573 7465  ubetype = cluste
+00026170: 7264 6174 612e 6765 7428 276b 7562 6574  rdata.get('kubet
+00026180: 7970 6527 2c20 2767 656e 6572 6963 2729  ype', 'generic')
+00026190: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000261a0: 2020 2020 2069 6620 6b75 6265 7479 7065       if kubetype
+000261b0: 203d 3d20 2768 7970 6572 7368 6966 7427   == 'hypershift'
+000261c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000261d0: 2020 2020 2020 2020 2020 6879 7065 7273            hypers
+000261e0: 6869 6674 203d 2054 7275 650a 2020 2020  hift = True.    
+000261f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026200: 2020 2020 6173 7369 7374 6564 203d 2063      assisted = c
+00026210: 6c75 7374 6572 6461 7461 2e67 6574 2827  lusterdata.get('
+00026220: 6173 7369 7374 6564 272c 2046 616c 7365  assisted', False
+00026230: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00026240: 2020 2020 2020 646f 6d61 696e 203d 2063        domain = c
+00026250: 6c75 7374 6572 6461 7461 2e67 6574 2827  lusterdata.get('
+00026260: 646f 6d61 696e 272c 2064 6f6d 6169 6e29  domain', domain)
+00026270: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00026280: 2020 2020 2064 6e73 636c 6965 6e74 203d       dnsclient =
+00026290: 2063 6c75 7374 6572 6461 7461 2e67 6574   clusterdata.get
+000262a0: 2827 646e 7363 6c69 656e 7427 290a 2020  ('dnsclient').  
+000262b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000262c0: 2020 676b 6520 3d20 6b75 6265 7479 7065    gke = kubetype
+000262d0: 203d 3d20 2767 6b65 270a 2020 2020 2020   == 'gke'.      
+000262e0: 2020 2020 2020 2020 2020 2020 2020 656b                ek
+000262f0: 7320 3d20 6b75 6265 7479 7065 203d 3d20  s = kubetype == 
+00026300: 2765 6b73 270a 2020 2020 2020 2020 6465  'eks'.        de
+00026310: 6c65 7465 636c 6965 6e74 7320 3d20 7b73  leteclients = {s
+00026320: 656c 662e 636c 6965 6e74 3a20 6b7d 0a20  elf.client: k}. 
+00026330: 2020 2020 2020 2076 6d63 6c69 656e 7473         vmclients
+00026340: 203d 205b 5d0a 2020 2020 2020 2020 766d   = [].        vm
+00026350: 636c 6965 6e74 735f 6669 6c65 203d 206f  clients_file = o
+00026360: 732e 7061 7468 2e65 7870 616e 6475 7365  s.path.expanduse
+00026370: 7228 6627 7e2f 2e6b 636c 692f 766d 636c  r(f'~/.kcli/vmcl
+00026380: 6965 6e74 735f 7b63 6c75 7374 6572 7d27  ients_{cluster}'
+00026390: 290a 2020 2020 2020 2020 6966 206f 732e  ).        if os.
+000263a0: 7061 7468 2e65 7869 7374 7328 766d 636c  path.exists(vmcl
+000263b0: 6965 6e74 735f 6669 6c65 293a 0a20 2020  ients_file):.   
+000263c0: 2020 2020 2020 2020 2076 6d63 6c69 656e           vmclien
+000263d0: 7473 203d 2079 616d 6c2e 7361 6665 5f6c  ts = yaml.safe_l
+000263e0: 6f61 6428 6f70 656e 2876 6d63 6c69 656e  oad(open(vmclien
+000263f0: 7473 5f66 696c 6529 290a 2020 2020 2020  ts_file)).      
+00026400: 2020 2020 2020 6f73 2e72 656d 6f76 6528        os.remove(
+00026410: 766d 636c 6965 6e74 735f 6669 6c65 290a  vmclients_file).
+00026420: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00026430: 6578 7472 6163 6c69 656e 7473 3a0a 2020  extraclients:.  
+00026440: 2020 2020 2020 2020 2020 6465 6c65 7465            delete
+00026450: 636c 6965 6e74 732e 7570 6461 7465 2873  clients.update(s
+00026460: 656c 662e 6578 7472 6163 6c69 656e 7473  elf.extraclients
+00026470: 290a 2020 2020 2020 2020 656c 6966 2076  ).        elif v
+00026480: 6d63 6c69 656e 7473 3a0a 2020 2020 2020  mclients:.      
 00026490: 2020 2020 2020 6465 6c65 7465 636c 6965        deleteclie
-000264a0: 6e74 732e 7570 6461 7465 2873 656c 662e  nts.update(self.
-000264b0: 6578 7472 6163 6c69 656e 7473 290a 2020  extraclients).  
-000264c0: 2020 2020 2020 656c 6966 2076 6d63 6c69        elif vmcli
-000264d0: 656e 7473 3a0a 2020 2020 2020 2020 2020  ents:.          
-000264e0: 2020 6465 6c65 7465 636c 6965 6e74 732e    deleteclients.
-000264f0: 7570 6461 7465 287b 636c 693a 204b 636f  update({cli: Kco
-00026500: 6e66 6967 2863 6c69 656e 743d 636c 6929  nfig(client=cli)
-00026510: 2e6b 2066 6f72 2063 6c69 2069 6e20 766d  .k for cli in vm
-00026520: 636c 6965 6e74 7320 6966 2063 6c69 2021  clients if cli !
-00026530: 3d20 7365 6c66 2e63 6c69 656e 747d 290a  = self.client}).
-00026540: 2020 2020 2020 2020 666f 7220 6879 7065          for hype
-00026550: 7276 6973 6f72 2069 6e20 6465 6c65 7465  rvisor in delete
-00026560: 636c 6965 6e74 733a 0a20 2020 2020 2020  clients:.       
-00026570: 2020 2020 2063 203d 2064 656c 6574 6563       c = deletec
-00026580: 6c69 656e 7473 5b68 7970 6572 7669 736f  lients[hyperviso
-00026590: 725d 0a20 2020 2020 2020 2020 2020 2066  r].            f
-000265a0: 6f72 2076 6d20 696e 2073 6f72 7465 6428  or vm in sorted(
-000265b0: 632e 6c69 7374 2829 2c20 6b65 793d 6c61  c.list(), key=la
-000265c0: 6d62 6461 2078 3a20 785b 276e 616d 6527  mbda x: x['name'
-000265d0: 5d29 3a0a 2020 2020 2020 2020 2020 2020  ]):.            
-000265e0: 2020 2020 6e61 6d65 203d 2076 6d5b 276e      name = vm['n
-000265f0: 616d 6527 5d0a 2020 2020 2020 2020 2020  ame'].          
-00026600: 2020 2020 2020 646e 7363 6c69 656e 7420        dnsclient 
-00026610: 3d20 766d 2e67 6574 2827 646e 7363 6c69  = vm.get('dnscli
-00026620: 656e 7427 2920 6f72 2064 6e73 636c 6965  ent') or dnsclie
-00026630: 6e74 0a20 2020 2020 2020 2020 2020 2020  nt.             
-00026640: 2020 2063 7572 7265 6e74 636c 7573 7465     currentcluste
-00026650: 7220 3d20 766d 2e67 6574 2827 6b75 6265  r = vm.get('kube
-00026660: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
-00026670: 2020 206b 7562 6574 7970 6520 3d20 766d     kubetype = vm
-00026680: 2e67 6574 2827 6b75 6265 7479 7065 272c  .get('kubetype',
-00026690: 2027 6765 6e65 7269 6327 290a 2020 2020   'generic').    
-000266a0: 2020 2020 2020 2020 2020 2020 6966 2063              if c
-000266b0: 7572 7265 6e74 636c 7573 7465 7220 6973  urrentcluster is
-000266c0: 206e 6f74 204e 6f6e 6520 616e 6420 6375   not None and cu
-000266d0: 7272 656e 7463 6c75 7374 6572 203d 3d20  rrentcluster == 
-000266e0: 636c 7573 7465 723a 0a20 2020 2020 2020  cluster:.       
-000266f0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00026700: 6b75 6265 7479 7065 203d 3d20 2767 6b65  kubetype == 'gke
-00026710: 273a 0a20 2020 2020 2020 2020 2020 2020  ':.             
-00026720: 2020 2020 2020 2020 2020 2067 6b65 203d             gke =
-00026730: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
-00026740: 2020 2020 2020 2020 2020 2020 2020 6272                br
-00026750: 6561 6b0a 2020 2020 2020 2020 2020 2020  eak.            
-00026760: 2020 2020 2020 2020 656c 6966 206b 7562          elif kub
-00026770: 6574 7970 6520 3d3d 2027 656b 7327 3a0a  etype == 'eks':.
-00026780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026790: 2020 2020 2020 2020 656b 7320 3d20 5472          eks = Tr
-000267a0: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
-000267b0: 2020 2020 2020 2020 2020 2062 7265 616b             break
-000267c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000267d0: 2020 2020 2063 2e64 656c 6574 6528 6e61       c.delete(na
-000267e0: 6d65 2c20 736e 6170 7368 6f74 733d 5472  me, snapshots=Tr
-000267f0: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
-00026800: 2020 2020 2020 2020 636f 6d6d 6f6e 2e64          common.d
-00026810: 656c 6574 655f 6c61 7374 766d 286e 616d  elete_lastvm(nam
-00026820: 652c 2073 656c 662e 636c 6965 6e74 290a  e, self.client).
-00026830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026840: 2020 2020 7375 6363 6573 7328 6622 7b6e      success(f"{n
-00026850: 616d 657d 2064 656c 6574 6564 206f 6e20  ame} deleted on 
-00026860: 7b68 7970 6572 7669 736f 727d 2122 290a  {hypervisor}!").
-00026870: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00026880: 7479 7065 203d 3d20 276b 7562 6576 6972  type == 'kubevir
-00026890: 7427 3a0a 2020 2020 2020 2020 2020 2020  t':.            
-000268a0: 6966 2066 227b 636c 7573 7465 727d 2d61  if f"{cluster}-a
-000268b0: 7069 2220 696e 206b 2e6c 6973 745f 7365  pi" in k.list_se
-000268c0: 7276 6963 6573 286b 2e6e 616d 6573 7061  rvices(k.namespa
-000268d0: 6365 293a 0a20 2020 2020 2020 2020 2020  ce):.           
-000268e0: 2020 2020 206b 2e64 656c 6574 655f 7365       k.delete_se
-000268f0: 7276 6963 6528 6622 7b63 6c75 7374 6572  rvice(f"{cluster
-00026900: 7d2d 6170 6922 2c20 6b2e 6e61 6d65 7370  }-api", k.namesp
-00026910: 6163 6529 0a20 2020 2020 2020 2020 2020  ace).           
-00026920: 2069 6620 6622 7b63 6c75 7374 6572 7d2d   if f"{cluster}-
-00026930: 696e 6772 6573 7322 2069 6e20 6b2e 6c69  ingress" in k.li
-00026940: 7374 5f73 6572 7669 6365 7328 6b2e 6e61  st_services(k.na
-00026950: 6d65 7370 6163 6529 3a0a 2020 2020 2020  mespace):.      
-00026960: 2020 2020 2020 2020 2020 6b2e 6465 6c65            k.dele
-00026970: 7465 5f73 6572 7669 6365 2866 227b 636c  te_service(f"{cl
-00026980: 7573 7465 727d 2d69 6e67 7265 7373 222c  uster}-ingress",
-00026990: 206b 2e6e 616d 6573 7061 6365 290a 2020   k.namespace).  
-000269a0: 2020 2020 2020 6966 2073 656c 662e 7479        if self.ty
-000269b0: 7065 2069 6e20 5b27 6177 7327 2c20 2767  pe in ['aws', 'g
-000269c0: 6370 272c 2027 6962 6d27 5d20 616e 6420  cp', 'ibm'] and 
-000269d0: 6e6f 7420 676b 6520 616e 6420 6e6f 7420  not gke and not 
-000269e0: 656b 733a 0a20 2020 2020 2020 2020 2020  eks:.           
-000269f0: 206c 6273 203d 205b 2761 7069 272c 2027   lbs = ['api', '
-00026a00: 6170 7073 275d 0a20 2020 2020 2020 2020  apps'].         
-00026a10: 2020 2069 6620 6b75 6265 7479 7065 206e     if kubetype n
-00026a20: 6f74 2069 6e20 5b27 6b33 7327 2c20 2767  ot in ['k3s', 'g
-00026a30: 656e 6572 6963 275d 3a0a 2020 2020 2020  eneric']:.      
-00026a40: 2020 2020 2020 2020 2020 6c62 732e 6170            lbs.ap
-00026a50: 7065 6e64 2827 6170 7073 2729 0a20 2020  pend('apps').   
-00026a60: 2020 2020 2020 2020 2066 6f72 206c 6220           for lb 
-00026a70: 696e 206c 6273 3a0a 2020 2020 2020 2020  in lbs:.        
-00026a80: 2020 2020 2020 2020 7365 6c66 2e64 656c          self.del
-00026a90: 6574 655f 6c6f 6164 6261 6c61 6e63 6572  ete_loadbalancer
-00026aa0: 2866 227b 6c62 7d2e 7b63 6c75 7374 6572  (f"{lb}.{cluster
-00026ab0: 7d22 2c20 646f 6d61 696e 3d64 6f6d 6169  }", domain=domai
-00026ac0: 6e29 0a20 2020 2020 2020 2020 2020 2062  n).            b
-00026ad0: 7563 6b65 7420 3d20 6622 7b63 6c75 7374  ucket = f"{clust
-00026ae0: 6572 7d2d 7b64 6f6d 6169 6e7d 220a 2020  er}-{domain}".  
-00026af0: 2020 2020 2020 2020 2020 6966 2062 7563            if buc
-00026b00: 6b65 7420 696e 2073 656c 662e 6b2e 6c69  ket in self.k.li
-00026b10: 7374 5f62 7563 6b65 7473 2829 3a0a 2020  st_buckets():.  
-00026b20: 2020 2020 2020 2020 2020 2020 2020 7070                pp
-00026b30: 7269 6e74 2866 2244 656c 6574 696e 6720  rint(f"Deleting 
-00026b40: 6275 636b 6574 207b 6275 636b 6574 7d22  bucket {bucket}"
-00026b50: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00026b60: 2020 6b2e 6465 6c65 7465 5f62 7563 6b65    k.delete_bucke
-00026b70: 7428 6275 636b 6574 290a 2020 2020 2020  t(bucket).      
-00026b80: 2020 2020 2020 6966 2073 656c 662e 7479        if self.ty
-00026b90: 7065 203d 3d20 2761 7773 2720 616e 6420  pe == 'aws' and 
-00026ba0: 636c 7573 7465 7220 696e 206b 2e6c 6973  cluster in k.lis
-00026bb0: 745f 696e 7374 616e 6365 5f70 726f 6669  t_instance_profi
-00026bc0: 6c65 7328 293a 0a20 2020 2020 2020 2020  les():.         
-00026bd0: 2020 2020 2020 2069 616d 5f72 6f6c 6520         iam_role 
-00026be0: 3d20 636c 7573 7465 7264 6174 612e 6765  = clusterdata.ge
-00026bf0: 7428 2772 6f6c 6527 2c20 636c 7573 7465  t('role', cluste
-00026c00: 7229 0a20 2020 2020 2020 2020 2020 2020  r).             
-00026c10: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-00026c20: 2020 2020 2020 2020 2020 2020 6b2e 6465              k.de
-00026c30: 6c65 7465 5f69 6e73 7461 6e63 655f 7072  lete_instance_pr
-00026c40: 6f66 696c 6528 636c 7573 7465 722c 2069  ofile(cluster, i
-00026c50: 616d 5f72 6f6c 6529 0a20 2020 2020 2020  am_role).       
-00026c60: 2020 2020 2020 2020 2065 7863 6570 743a           except:
-00026c70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00026c80: 2020 2020 2070 6173 730a 2020 2020 2020       pass.      
-00026c90: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
-00026ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026cb0: 2020 206b 2e64 656c 6574 655f 726f 6c65     k.delete_role
-00026cc0: 2869 616d 5f72 6f6c 6529 0a20 2020 2020  (iam_role).     
-00026cd0: 2020 2020 2020 2020 2020 2065 7863 6570             excep
-00026ce0: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
-00026cf0: 2020 2020 2020 2070 6173 730a 2020 2020         pass.    
-00026d00: 2020 2020 656c 6966 2064 6e73 636c 6965      elif dnsclie
-00026d10: 6e74 2069 7320 6e6f 7420 4e6f 6e65 3a0a  nt is not None:.
-00026d20: 2020 2020 2020 2020 2020 2020 7a20 3d20              z = 
-00026d30: 4b63 6f6e 6669 6728 636c 6965 6e74 3d64  Kconfig(client=d
-00026d40: 6e73 636c 6965 6e74 292e 6b0a 2020 2020  nsclient).k.    
-00026d50: 2020 2020 2020 2020 7a2e 6465 6c65 7465          z.delete
-00026d60: 5f64 6e73 2866 2261 7069 2e7b 636c 7573  _dns(f"api.{clus
-00026d70: 7465 727d 222c 2064 6f6d 6169 6e29 0a20  ter}", domain). 
-00026d80: 2020 2020 2020 2020 2020 207a 2e64 656c             z.del
-00026d90: 6574 655f 646e 7328 6622 6170 7073 2e7b  ete_dns(f"apps.{
-00026da0: 636c 7573 7465 727d 222c 2064 6f6d 6169  cluster}", domai
-00026db0: 6e29 0a20 2020 2020 2020 2069 6620 6879  n).        if hy
-00026dc0: 7065 7273 6869 6674 3a0a 2020 2020 2020  pershift:.      
-00026dd0: 2020 2020 2020 6b75 6265 636f 6e66 6967        kubeconfig
-00026de0: 6d67 6d74 203d 2066 227b 636c 7573 7465  mgmt = f"{cluste
-00026df0: 7264 6972 7d2f 6b75 6265 636f 6e66 6967  rdir}/kubeconfig
-00026e00: 2e6d 676d 7422 0a20 2020 2020 2020 2020  .mgmt".         
-00026e10: 2020 2063 616c 6c28 6627 4b55 4245 434f     call(f'KUBECO
-00026e20: 4e46 4947 3d7b 6b75 6265 636f 6e66 6967  NFIG={kubeconfig
-00026e30: 6d67 6d74 7d20 6f63 2064 656c 6574 6520  mgmt} oc delete 
-00026e40: 2d66 207b 636c 7573 7465 7264 6972 7d2f  -f {clusterdir}/
-00026e50: 6175 746f 6170 7072 6f76 6572 6372 6f6e  autoapprovercron
-00026e60: 2e79 6d6c 272c 2073 6865 6c6c 3d54 7275  .yml', shell=Tru
-00026e70: 6529 0a20 2020 2020 2020 2020 2020 2063  e).            c
-00026e80: 616c 6c28 6627 4b55 4245 434f 4e46 4947  all(f'KUBECONFIG
-00026e90: 3d7b 6b75 6265 636f 6e66 6967 6d67 6d74  ={kubeconfigmgmt
-00026ea0: 7d20 6f63 2064 656c 6574 6520 2d66 207b  } oc delete -f {
-00026eb0: 636c 7573 7465 7264 6972 7d2f 6e6f 6465  clusterdir}/node
-00026ec0: 706f 6f6c 2e79 616d 6c27 2c20 7368 656c  pool.yaml', shel
-00026ed0: 6c3d 5472 7565 290a 2020 2020 2020 2020  l=True).        
-00026ee0: 2020 2020 6361 6c6c 2866 274b 5542 4543      call(f'KUBEC
-00026ef0: 4f4e 4649 473d 7b6b 7562 6563 6f6e 6669  ONFIG={kubeconfi
-00026f00: 676d 676d 747d 206f 6320 6465 6c65 7465  gmgmt} oc delete
-00026f10: 202d 6620 7b63 6c75 7374 6572 6469 727d   -f {clusterdir}
-00026f20: 2f68 6f73 7465 6463 6c75 7374 6572 2e79  /hostedcluster.y
-00026f30: 616d 6c27 2c20 7368 656c 6c3d 5472 7565  aml', shell=True
-00026f40: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-00026f50: 206e 6f74 2061 7373 6973 7465 6420 616e   not assisted an
-00026f60: 6420 2827 6261 7265 6d65 7461 6c5f 6973  d ('baremetal_is
-00026f70: 6f27 2069 6e20 636c 7573 7465 7264 6174  o' in clusterdat
-00026f80: 6120 6f72 2027 6261 7265 6d65 7461 6c5f  a or 'baremetal_
-00026f90: 686f 7374 7327 2069 6e20 636c 7573 7465  hosts' in cluste
-00026fa0: 7264 6174 6129 3a0a 2020 2020 2020 2020  rdata):.        
-00026fb0: 2020 2020 2020 2020 6361 6c6c 2866 274b          call(f'K
-00026fc0: 5542 4543 4f4e 4649 473d 7b6b 7562 6563  UBECONFIG={kubec
-00026fd0: 6f6e 6669 676d 676d 747d 206f 6320 2d6e  onfigmgmt} oc -n
-00026fe0: 2064 6566 6175 6c74 2064 656c 6574 6520   default delete 
-00026ff0: 616c 6c20 2d6c 2061 7070 3d68 7474 7064  all -l app=httpd
-00027000: 2d6b 636c 6927 2c20 7368 656c 6c3d 5472  -kcli', shell=Tr
-00027010: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
-00027020: 2020 2020 6361 6c6c 2866 274b 5542 4543      call(f'KUBEC
-00027030: 4f4e 4649 473d 7b6b 7562 6563 6f6e 6669  ONFIG={kubeconfi
-00027040: 676d 676d 747d 206f 6320 2d6e 2064 6566  gmgmt} oc -n def
-00027050: 6175 6c74 2064 656c 6574 6520 7076 6320  ault delete pvc 
-00027060: 6874 7470 642d 6b63 6c69 2d70 7663 272c  httpd-kcli-pvc',
-00027070: 2073 6865 6c6c 3d54 7275 6529 0a20 2020   shell=True).   
-00027080: 2020 2020 2069 6620 676b 653a 0a20 2020       if gke:.   
-00027090: 2020 2020 2020 2020 2067 6370 636c 6965           gcpclie
-000270a0: 6e74 203d 204e 6f6e 650a 2020 2020 2020  nt = None.      
-000270b0: 2020 2020 2020 6966 2027 636c 6965 6e74        if 'client
-000270c0: 2720 696e 2063 6c75 7374 6572 6461 7461  ' in clusterdata
-000270d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000270e0: 2020 6763 7063 6c69 656e 7420 3d20 636c    gcpclient = cl
-000270f0: 7573 7465 7264 6174 615b 2763 6c69 656e  usterdata['clien
-00027100: 7427 5d0a 2020 2020 2020 2020 2020 2020  t'].            
-00027110: 656c 6966 2073 656c 662e 7479 7065 203d  elif self.type =
-00027120: 3d20 2767 6370 273a 0a20 2020 2020 2020  = 'gcp':.       
-00027130: 2020 2020 2020 2020 2067 6370 636c 6965           gcpclie
-00027140: 6e74 203d 2073 656c 662e 636c 6965 6e74  nt = self.client
-00027150: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-00027160: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00027170: 2020 206d 7367 203d 2022 4465 6c65 7469     msg = "Deleti
-00027180: 6e67 2067 6b65 2063 6c75 7374 6572 2072  ng gke cluster r
-00027190: 6571 7569 7265 7320 746f 2069 6e73 7461  equires to insta
-000271a0: 6e74 6961 7465 2067 6370 2070 726f 7669  ntiate gcp provi
-000271b0: 6465 7222 0a20 2020 2020 2020 2020 2020  der".           
-000271c0: 2020 2020 2065 7272 6f72 286d 7367 290a       error(msg).
-000271d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000271e0: 7265 7475 726e 207b 2772 6573 756c 7427  return {'result'
-000271f0: 3a20 2766 6169 6c75 7265 272c 2027 7265  : 'failure', 're
-00027200: 6173 6f6e 273a 206d 7367 7d0a 2020 2020  ason': msg}.    
-00027210: 2020 2020 2020 2020 6672 6f6d 206b 7669          from kvi
-00027220: 7274 2e63 6c75 7374 6572 2069 6d70 6f72  rt.cluster impor
-00027230: 7420 676b 650a 2020 2020 2020 2020 2020  t gke.          
-00027240: 2020 6375 7272 656e 7463 6f6e 6669 6720    currentconfig 
-00027250: 3d20 4b63 6f6e 6669 6728 636c 6965 6e74  = Kconfig(client
-00027260: 3d67 6370 636c 6965 6e74 292e 6b20 6966  =gcpclient).k if
-00027270: 2067 6370 636c 6965 6e74 2021 3d20 7365   gcpclient != se
-00027280: 6c66 2e63 6c69 656e 7420 656c 7365 2073  lf.client else s
-00027290: 656c 660a 2020 2020 2020 2020 2020 2020  elf.            
-000272a0: 7a6f 6e61 6c20 3d20 636c 7573 7465 7264  zonal = clusterd
-000272b0: 6174 612e 6765 7428 277a 6f6e 616c 272c  ata.get('zonal',
-000272c0: 2054 7275 6529 0a20 2020 2020 2020 2020   True).         
-000272d0: 2020 2067 6b65 2e64 656c 6574 6528 6375     gke.delete(cu
-000272e0: 7272 656e 7463 6f6e 6669 672c 2063 6c75  rrentconfig, clu
-000272f0: 7374 6572 2c20 7a6f 6e61 6c29 0a20 2020  ster, zonal).   
-00027300: 2020 2020 2069 6620 656b 733a 0a20 2020       if eks:.   
-00027310: 2020 2020 2020 2020 2065 6b73 636c 6965           eksclie
-00027320: 6e74 203d 204e 6f6e 650a 2020 2020 2020  nt = None.      
-00027330: 2020 2020 2020 6966 2027 636c 6965 6e74        if 'client
-00027340: 2720 696e 2063 6c75 7374 6572 6461 7461  ' in clusterdata
-00027350: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00027360: 2020 656b 7363 6c69 656e 7420 3d20 636c    eksclient = cl
-00027370: 7573 7465 7264 6174 615b 2763 6c69 656e  usterdata['clien
-00027380: 7427 5d0a 2020 2020 2020 2020 2020 2020  t'].            
-00027390: 656c 6966 2073 656c 662e 7479 7065 203d  elif self.type =
-000273a0: 3d20 2761 7773 273a 0a20 2020 2020 2020  = 'aws':.       
-000273b0: 2020 2020 2020 2020 2065 6b73 636c 6965           eksclie
-000273c0: 6e74 203d 2073 656c 662e 636c 6965 6e74  nt = self.client
-000273d0: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-000273e0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-000273f0: 2020 206d 7367 203d 2022 4465 6c65 7469     msg = "Deleti
-00027400: 6e67 2067 6b65 2063 6c75 7374 6572 2072  ng gke cluster r
-00027410: 6571 7569 7265 7320 746f 2069 6e73 7461  equires to insta
-00027420: 6e74 6961 7465 2067 6370 2070 726f 7669  ntiate gcp provi
-00027430: 6465 7222 0a20 2020 2020 2020 2020 2020  der".           
-00027440: 2020 2020 2065 7272 6f72 286d 7367 290a       error(msg).
-00027450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027460: 7265 7475 726e 207b 2772 6573 756c 7427  return {'result'
-00027470: 3a20 2766 6169 6c75 7265 272c 2027 7265  : 'failure', 're
-00027480: 6173 6f6e 273a 206d 7367 7d0a 2020 2020  ason': msg}.    
-00027490: 2020 2020 2020 2020 6672 6f6d 206b 7669          from kvi
-000274a0: 7274 2e63 6c75 7374 6572 2069 6d70 6f72  rt.cluster impor
-000274b0: 7420 656b 730a 2020 2020 2020 2020 2020  t eks.          
-000274c0: 2020 6375 7272 656e 7463 6f6e 6669 6720    currentconfig 
-000274d0: 3d20 4b63 6f6e 6669 6728 636c 6965 6e74  = Kconfig(client
-000274e0: 3d65 6b73 636c 6965 6e74 292e 6b20 6966  =eksclient).k if
-000274f0: 2065 6b73 636c 6965 6e74 2021 3d20 7365   eksclient != se
-00027500: 6c66 2e63 6c69 656e 7420 656c 7365 2073  lf.client else s
-00027510: 656c 660a 2020 2020 2020 2020 2020 2020  elf.            
-00027520: 656b 732e 6465 6c65 7465 2863 7572 7265  eks.delete(curre
-00027530: 6e74 636f 6e66 6967 2c20 636c 7573 7465  ntconfig, cluste
-00027540: 7229 0a20 2020 2020 2020 2066 6f72 2063  r).        for c
-00027550: 6f6e 6670 6f6f 6c20 696e 2073 656c 662e  onfpool in self.
-00027560: 636f 6e66 706f 6f6c 733a 0a20 2020 2020  confpools:.     
-00027570: 2020 2020 2020 2069 705f 7265 7365 7276         ip_reserv
-00027580: 6174 696f 6e73 203d 2073 656c 662e 636f  ations = self.co
-00027590: 6e66 706f 6f6c 735b 636f 6e66 706f 6f6c  nfpools[confpool
-000275a0: 5d2e 6765 7428 2769 705f 7265 7365 7276  ].get('ip_reserv
-000275b0: 6174 696f 6e73 272c 207b 7d29 0a20 2020  ations', {}).   
-000275c0: 2020 2020 2020 2020 2069 6620 636c 7573           if clus
-000275d0: 7465 7220 696e 2069 705f 7265 7365 7276  ter in ip_reserv
-000275e0: 6174 696f 6e73 3a0a 2020 2020 2020 2020  ations:.        
-000275f0: 2020 2020 2020 2020 6465 6c20 6970 5f72          del ip_r
-00027600: 6573 6572 7661 7469 6f6e 735b 636c 7573  eservations[clus
-00027610: 7465 725d 0a20 2020 2020 2020 2020 2020  ter].           
-00027620: 2020 2020 2073 656c 662e 7570 6461 7465       self.update
-00027630: 5f63 6f6e 6670 6f6f 6c28 636f 6e66 706f  _confpool(confpo
-00027640: 6f6c 2c20 7b27 6970 5f72 6573 6572 7661  ol, {'ip_reserva
-00027650: 7469 6f6e 7327 3a20 6970 5f72 6573 6572  tions': ip_reser
-00027660: 7661 7469 6f6e 737d 290a 2020 2020 2020  vations}).      
-00027670: 2020 2020 2020 6e61 6d65 5f72 6573 6572        name_reser
-00027680: 7661 7469 6f6e 7320 3d20 7365 6c66 2e63  vations = self.c
-00027690: 6f6e 6670 6f6f 6c73 5b63 6f6e 6670 6f6f  onfpools[confpoo
-000276a0: 6c5d 2e67 6574 2827 6e61 6d65 5f72 6573  l].get('name_res
-000276b0: 6572 7661 7469 6f6e 7327 2c20 5b5d 290a  ervations', []).
-000276c0: 2020 2020 2020 2020 2020 2020 6966 2063              if c
-000276d0: 6c75 7374 6572 2069 6e20 6e61 6d65 5f72  luster in name_r
-000276e0: 6573 6572 7661 7469 6f6e 733a 0a20 2020  eservations:.   
-000276f0: 2020 2020 2020 2020 2020 2020 206e 616d               nam
-00027700: 655f 7265 7365 7276 6174 696f 6e73 2e72  e_reservations.r
-00027710: 656d 6f76 6528 636c 7573 7465 7229 0a20  emove(cluster). 
-00027720: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00027730: 656c 662e 7570 6461 7465 5f63 6f6e 6670  elf.update_confp
-00027740: 6f6f 6c28 636f 6e66 706f 6f6c 2c20 7b27  ool(confpool, {'
-00027750: 6e61 6d65 5f72 6573 6572 7661 7469 6f6e  name_reservation
-00027760: 7327 3a20 6e61 6d65 5f72 6573 6572 7661  s': name_reserva
-00027770: 7469 6f6e 737d 290a 2020 2020 2020 2020  tions}).        
-00027780: 2020 2020 636c 7573 7465 725f 6261 7265      cluster_bare
-00027790: 6d65 7461 6c5f 7265 7365 7276 6174 696f  metal_reservatio
-000277a0: 6e73 203d 2073 656c 662e 636f 6e66 706f  ns = self.confpo
-000277b0: 6f6c 735b 636f 6e66 706f 6f6c 5d2e 6765  ols[confpool].ge
-000277c0: 7428 2763 6c75 7374 6572 5f62 6172 656d  t('cluster_barem
-000277d0: 6574 616c 5f72 6573 6572 7661 7469 6f6e  etal_reservation
-000277e0: 7327 2c20 7b7d 290a 2020 2020 2020 2020  s', {}).        
-000277f0: 2020 2020 6966 2063 6c75 7374 6572 2069      if cluster i
-00027800: 6e20 636c 7573 7465 725f 6261 7265 6d65  n cluster_bareme
-00027810: 7461 6c5f 7265 7365 7276 6174 696f 6e73  tal_reservations
-00027820: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00027830: 2020 6465 6c20 636c 7573 7465 725f 6261    del cluster_ba
-00027840: 7265 6d65 7461 6c5f 7265 7365 7276 6174  remetal_reservat
-00027850: 696f 6e73 5b63 6c75 7374 6572 5d0a 2020  ions[cluster].  
-00027860: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00027870: 6c66 2e75 7064 6174 655f 636f 6e66 706f  lf.update_confpo
-00027880: 6f6c 2863 6f6e 6670 6f6f 6c2c 207b 2763  ol(confpool, {'c
-00027890: 6c75 7374 6572 5f62 6172 656d 6574 616c  luster_baremetal
-000278a0: 5f72 6573 6572 7661 7469 6f6e 7327 3a20  _reservations': 
-000278b0: 636c 7573 7465 725f 6261 7265 6d65 7461  cluster_baremeta
-000278c0: 6c5f 7265 7365 7276 6174 696f 6e73 7d29  l_reservations})
-000278d0: 0a20 2020 2020 2020 2069 6620 6f73 2e70  .        if os.p
-000278e0: 6174 682e 6578 6973 7473 2863 6c75 7374  ath.exists(clust
-000278f0: 6572 6469 7229 3a0a 2020 2020 2020 2020  erdir):.        
-00027900: 2020 2020 7070 7269 6e74 2866 2244 656c      pprint(f"Del
-00027910: 6574 696e 6720 6469 7265 6374 6f72 7920  eting directory 
-00027920: 7b63 6c75 7374 6572 6469 727d 2229 0a20  {clusterdir}"). 
-00027930: 2020 2020 2020 2020 2020 2072 6d74 7265             rmtre
-00027940: 6528 636c 7573 7465 7264 6972 290a 2020  e(clusterdir).  
-00027950: 2020 2020 2020 7265 7475 726e 207b 2772        return {'r
-00027960: 6573 756c 7427 3a20 2773 7563 6365 7373  esult': 'success
-00027970: 277d 0a0a 2020 2020 6465 6620 7363 616c  '}..    def scal
-00027980: 655f 6b75 6265 2873 656c 662c 2063 6c75  e_kube(self, clu
-00027990: 7374 6572 2c20 6b75 6265 7479 7065 2c20  ster, kubetype, 
-000279a0: 6f76 6572 7269 6465 733d 7b7d 293a 0a20  overrides={}):. 
-000279b0: 2020 2020 2020 2069 6620 6b75 6265 7479         if kubety
-000279c0: 7065 203d 3d20 2767 656e 6572 6963 273a  pe == 'generic':
-000279d0: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
-000279e0: 756c 7420 3d20 7365 6c66 2e73 6361 6c65  ult = self.scale
-000279f0: 5f6b 7562 655f 6765 6e65 7269 6328 636c  _kube_generic(cl
-00027a00: 7573 7465 722c 206f 7665 7272 6964 6573  uster, overrides
-00027a10: 3d6f 7665 7272 6964 6573 290a 2020 2020  =overrides).    
-00027a20: 2020 2020 656c 6966 206b 7562 6574 7970      elif kubetyp
-00027a30: 6520 3d3d 2027 6b33 7327 3a0a 2020 2020  e == 'k3s':.    
-00027a40: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
-00027a50: 2073 656c 662e 7363 616c 655f 6b75 6265   self.scale_kube
-00027a60: 5f6b 3373 2863 6c75 7374 6572 2c20 6f76  _k3s(cluster, ov
-00027a70: 6572 7269 6465 733d 6f76 6572 7269 6465  errides=override
-00027a80: 7329 0a20 2020 2020 2020 2065 6c69 6620  s).        elif 
-00027a90: 6b75 6265 7479 7065 203d 3d20 276f 7065  kubetype == 'ope
-00027aa0: 6e73 6869 6674 273a 0a20 2020 2020 2020  nshift':.       
-00027ab0: 2020 2020 2072 6573 756c 7420 3d20 7365       result = se
-00027ac0: 6c66 2e73 6361 6c65 5f6b 7562 655f 6f70  lf.scale_kube_op
-00027ad0: 656e 7368 6966 7428 636c 7573 7465 722c  enshift(cluster,
-00027ae0: 206f 7665 7272 6964 6573 3d6f 7665 7272   overrides=overr
-00027af0: 6964 6573 290a 2020 2020 2020 2020 656c  ides).        el
-00027b00: 6966 206b 7562 6574 7970 6520 3d3d 2027  if kubetype == '
-00027b10: 6879 7065 7273 6869 6674 273a 0a20 2020  hypershift':.   
-00027b20: 2020 2020 2020 2020 2072 6573 756c 7420           result 
-00027b30: 3d20 7365 6c66 2e73 6361 6c65 5f6b 7562  = self.scale_kub
-00027b40: 655f 6879 7065 7273 6869 6674 2863 6c75  e_hypershift(clu
-00027b50: 7374 6572 2c20 6f76 6572 7269 6465 733d  ster, overrides=
-00027b60: 6f76 6572 7269 6465 7329 0a20 2020 2020  overrides).     
-00027b70: 2020 2065 6c69 6620 6b75 6265 7479 7065     elif kubetype
-00027b80: 203d 3d20 2767 6b65 273a 0a20 2020 2020   == 'gke':.     
-00027b90: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
-00027ba0: 7365 6c66 2e73 6361 6c65 5f6b 7562 655f  self.scale_kube_
-00027bb0: 676b 6528 636c 7573 7465 722c 206f 7665  gke(cluster, ove
-00027bc0: 7272 6964 6573 3d6f 7665 7272 6964 6573  rrides=overrides
-00027bd0: 290a 2020 2020 2020 2020 656c 6966 206b  ).        elif k
-00027be0: 7562 6574 7970 6520 3d3d 2027 656b 7327  ubetype == 'eks'
-00027bf0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00027c00: 7375 6c74 203d 2073 656c 662e 7363 616c  sult = self.scal
-00027c10: 655f 6b75 6265 5f65 6b73 2863 6c75 7374  e_kube_eks(clust
-00027c20: 6572 2c20 6f76 6572 7269 6465 733d 6f76  er, overrides=ov
-00027c30: 6572 7269 6465 7329 0a20 2020 2020 2020  errides).       
-00027c40: 2072 6574 7572 6e20 7265 7375 6c74 0a0a   return result..
-00027c50: 2020 2020 6465 6620 7363 616c 655f 6b75      def scale_ku
-00027c60: 6265 5f65 6b73 2873 656c 662c 2063 6c75  be_eks(self, clu
-00027c70: 7374 6572 2c20 6f76 6572 7269 6465 733d  ster, overrides=
-00027c80: 7b7d 293a 0a20 2020 2020 2020 2066 726f  {}):.        fro
-00027c90: 6d20 6b76 6972 742e 636c 7573 7465 7220  m kvirt.cluster 
-00027ca0: 696d 706f 7274 2065 6b73 0a20 2020 2020  import eks.     
-00027cb0: 2020 2072 6574 7572 6e20 656b 732e 7363     return eks.sc
-00027cc0: 616c 6528 7365 6c66 2c20 636c 7573 7465  ale(self, cluste
-00027cd0: 722c 206f 7665 7272 6964 6573 290a 0a20  r, overrides).. 
-00027ce0: 2020 2064 6566 2073 6361 6c65 5f6b 7562     def scale_kub
-00027cf0: 655f 6765 6e65 7269 6328 7365 6c66 2c20  e_generic(self, 
-00027d00: 636c 7573 7465 722c 206f 7665 7272 6964  cluster, overrid
-00027d10: 6573 3d7b 7d29 3a0a 2020 2020 2020 2020  es={}):.        
-00027d20: 706c 616e 6469 7220 3d20 6f73 2e70 6174  plandir = os.pat
-00027d30: 682e 6469 726e 616d 6528 6b75 6265 6164  h.dirname(kubead
-00027d40: 6d2e 6372 6561 7465 2e5f 5f63 6f64 655f  m.create.__code_
-00027d50: 5f2e 636f 5f66 696c 656e 616d 6529 0a20  _.co_filename). 
-00027d60: 2020 2020 2020 2072 6574 7572 6e20 6b75         return ku
-00027d70: 6265 6164 6d2e 7363 616c 6528 7365 6c66  beadm.scale(self
-00027d80: 2c20 706c 616e 6469 722c 2063 6c75 7374  , plandir, clust
-00027d90: 6572 2c20 6f76 6572 7269 6465 7329 0a0a  er, overrides)..
-00027da0: 2020 2020 6465 6620 7363 616c 655f 6b75      def scale_ku
-00027db0: 6265 5f67 6b65 2873 656c 662c 2063 6c75  be_gke(self, clu
-00027dc0: 7374 6572 2c20 6f76 6572 7269 6465 733d  ster, overrides=
-00027dd0: 7b7d 293a 0a20 2020 2020 2020 2066 726f  {}):.        fro
-00027de0: 6d20 6b76 6972 742e 636c 7573 7465 7220  m kvirt.cluster 
-00027df0: 696d 706f 7274 2067 6b65 0a20 2020 2020  import gke.     
-00027e00: 2020 2072 6574 7572 6e20 676b 652e 7363     return gke.sc
-00027e10: 616c 6528 7365 6c66 2c20 636c 7573 7465  ale(self, cluste
-00027e20: 722c 206f 7665 7272 6964 6573 290a 0a20  r, overrides).. 
-00027e30: 2020 2064 6566 2073 6361 6c65 5f6b 7562     def scale_kub
-00027e40: 655f 6879 7065 7273 6869 6674 2873 656c  e_hypershift(sel
-00027e50: 662c 2063 6c75 7374 6572 2c20 6f76 6572  f, cluster, over
-00027e60: 7269 6465 733d 7b7d 293a 0a20 2020 2020  rides={}):.     
-00027e70: 2020 2070 6c61 6e64 6972 203d 206f 732e     plandir = os.
-00027e80: 7061 7468 2e64 6972 6e61 6d65 2868 7970  path.dirname(hyp
-00027e90: 6572 7368 6966 742e 6372 6561 7465 2e5f  ershift.create._
-00027ea0: 5f63 6f64 655f 5f2e 636f 5f66 696c 656e  _code__.co_filen
-00027eb0: 616d 6529 0a20 2020 2020 2020 2072 6574  ame).        ret
-00027ec0: 7572 6e20 6879 7065 7273 6869 6674 2e73  urn hypershift.s
-00027ed0: 6361 6c65 2873 656c 662c 2070 6c61 6e64  cale(self, pland
-00027ee0: 6972 2c20 636c 7573 7465 722c 206f 7665  ir, cluster, ove
-00027ef0: 7272 6964 6573 290a 0a20 2020 2064 6566  rrides)..    def
-00027f00: 2073 6361 6c65 5f6b 7562 655f 6b33 7328   scale_kube_k3s(
-00027f10: 7365 6c66 2c20 636c 7573 7465 722c 206f  self, cluster, o
-00027f20: 7665 7272 6964 6573 3d7b 7d29 3a0a 2020  verrides={}):.  
-00027f30: 2020 2020 2020 706c 616e 6469 7220 3d20        plandir = 
-00027f40: 6f73 2e70 6174 682e 6469 726e 616d 6528  os.path.dirname(
-00027f50: 6b33 732e 6372 6561 7465 2e5f 5f63 6f64  k3s.create.__cod
-00027f60: 655f 5f2e 636f 5f66 696c 656e 616d 6529  e__.co_filename)
-00027f70: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00027f80: 6b33 732e 7363 616c 6528 7365 6c66 2c20  k3s.scale(self, 
-00027f90: 706c 616e 6469 722c 2063 6c75 7374 6572  plandir, cluster
-00027fa0: 2c20 6f76 6572 7269 6465 7329 0a0a 2020  , overrides)..  
-00027fb0: 2020 6465 6620 7363 616c 655f 6b75 6265    def scale_kube
-00027fc0: 5f6f 7065 6e73 6869 6674 2873 656c 662c  _openshift(self,
-00027fd0: 2063 6c75 7374 6572 2c20 6f76 6572 7269   cluster, overri
-00027fe0: 6465 733d 7b7d 293a 0a20 2020 2020 2020  des={}):.       
-00027ff0: 2070 6c61 6e64 6972 203d 206f 732e 7061   plandir = os.pa
-00028000: 7468 2e64 6972 6e61 6d65 286f 7065 6e73  th.dirname(opens
-00028010: 6869 6674 2e63 7265 6174 652e 5f5f 636f  hift.create.__co
-00028020: 6465 5f5f 2e63 6f5f 6669 6c65 6e61 6d65  de__.co_filename
-00028030: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-00028040: 206f 7065 6e73 6869 6674 2e73 6361 6c65   openshift.scale
-00028050: 2873 656c 662c 2070 6c61 6e64 6972 2c20  (self, plandir, 
-00028060: 636c 7573 7465 722c 206f 7665 7272 6964  cluster, overrid
-00028070: 6573 290a 0a20 2020 2064 6566 2075 7064  es)..    def upd
-00028080: 6174 655f 6b75 6265 2873 656c 662c 2063  ate_kube(self, c
-00028090: 6c75 7374 6572 2c20 5f74 7970 652c 206f  luster, _type, o
-000280a0: 7665 7272 6964 6573 3d7b 7d2c 2070 6c61  verrides={}, pla
-000280b0: 6e3d 4e6f 6e65 293a 0a20 2020 2020 2020  n=None):.       
-000280c0: 206f 7665 7272 6964 6573 5b27 736b 6970   overrides['skip
-000280d0: 5f66 696c 6573 5f72 656d 6564 6961 7469  _files_remediati
-000280e0: 6f6e 275d 203d 2054 7275 650a 2020 2020  on'] = True.    
-000280f0: 2020 2020 6f76 6572 7269 6465 735b 2773      overrides['s
-00028100: 6361 6c65 275d 203d 2054 7275 650a 2020  cale'] = True.  
-00028110: 2020 2020 2020 636c 7573 7465 7264 6972        clusterdir
-00028120: 203d 206f 732e 7061 7468 2e65 7870 616e   = os.path.expan
-00028130: 6475 7365 7228 6622 7e2f 2e6b 636c 692f  duser(f"~/.kcli/
-00028140: 636c 7573 7465 7273 2f7b 636c 7573 7465  clusters/{cluste
-00028150: 727d 2229 0a20 2020 2020 2020 2070 6c61  r}").        pla
-00028160: 6e76 6d73 203d 205b 5d0a 2020 2020 2020  nvms = [].      
-00028170: 2020 6966 2070 6c61 6e20 6973 204e 6f6e    if plan is Non
-00028180: 653a 0a20 2020 2020 2020 2020 2020 2070  e:.            p
-00028190: 6c61 6e20 3d20 636c 7573 7465 720a 2020  lan = cluster.  
-000281a0: 2020 2020 2020 6966 205f 7479 7065 203d        if _type =
-000281b0: 3d20 2765 6b73 273a 0a20 2020 2020 2020  = 'eks':.       
-000281c0: 2020 2020 2073 656c 662e 7363 616c 655f       self.scale_
-000281d0: 6b75 6265 5f65 6b73 2863 6c75 7374 6572  kube_eks(cluster
-000281e0: 2c20 6f76 6572 7269 6465 733d 6f76 6572  , overrides=over
-000281f0: 7269 6465 7329 0a20 2020 2020 2020 2020  rides).         
-00028200: 2020 2072 6574 7572 6e0a 2020 2020 2020     return.      
-00028210: 2020 6966 205f 7479 7065 203d 3d20 2767    if _type == 'g
-00028220: 6b65 273a 0a20 2020 2020 2020 2020 2020  ke':.           
-00028230: 2073 656c 662e 7363 616c 655f 6b75 6265   self.scale_kube
-00028240: 5f67 6b65 2863 6c75 7374 6572 2c20 6f76  _gke(cluster, ov
-00028250: 6572 7269 6465 733d 6f76 6572 7269 6465  errides=override
-00028260: 7329 0a20 2020 2020 2020 2020 2020 2072  s).            r
-00028270: 6574 7572 6e0a 2020 2020 2020 2020 6966  eturn.        if
-00028280: 205f 7479 7065 203d 3d20 2767 656e 6572   _type == 'gener
-00028290: 6963 273a 0a20 2020 2020 2020 2020 2020  ic':.           
-000282a0: 2072 6f6c 6573 203d 205b 2763 746c 706c   roles = ['ctlpl
-000282b0: 616e 6573 272c 2027 776f 726b 6572 7327  anes', 'workers'
-000282c0: 5d0a 2020 2020 2020 2020 2020 2020 706c  ].            pl
-000282d0: 616e 6469 7220 3d20 6f73 2e70 6174 682e  andir = os.path.
-000282e0: 6469 726e 616d 6528 6b75 6265 6164 6d2e  dirname(kubeadm.
-000282f0: 6372 6561 7465 2e5f 5f63 6f64 655f 5f2e  create.__code__.
-00028300: 636f 5f66 696c 656e 616d 6529 0a20 2020  co_filename).   
-00028310: 2020 2020 2065 6c69 6620 5f74 7970 6520       elif _type 
-00028320: 3d3d 2027 6b33 7327 3a0a 2020 2020 2020  == 'k3s':.      
-00028330: 2020 2020 2020 706c 616e 6469 7220 3d20        plandir = 
-00028340: 6f73 2e70 6174 682e 6469 726e 616d 6528  os.path.dirname(
-00028350: 6b33 732e 6372 6561 7465 2e5f 5f63 6f64  k3s.create.__cod
-00028360: 655f 5f2e 636f 5f66 696c 656e 616d 6529  e__.co_filename)
-00028370: 0a20 2020 2020 2020 2020 2020 2072 6f6c  .            rol
-00028380: 6573 203d 205b 2762 6f6f 7473 7472 6170  es = ['bootstrap
-00028390: 272c 2027 776f 726b 6572 7327 5d20 6966  ', 'workers'] if
-000283a0: 206f 7665 7272 6964 6573 2e67 6574 2827   overrides.get('
-000283b0: 6374 6c70 6c61 6e65 7327 2c20 3129 203d  ctlplanes', 1) =
-000283c0: 3d20 3120 656c 7365 205b 2762 6f6f 7473  = 1 else ['boots
-000283d0: 7472 6170 272c 2027 6374 6c70 6c61 6e65  trap', 'ctlplane
-000283e0: 7327 2c0a 2020 2020 2020 2020 2020 2020  s',.            
-000283f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028430: 2020 2020 2020 2020 2020 2020 2027 776f               'wo
-00028440: 726b 6572 7327 5d0a 2020 2020 2020 2020  rkers'].        
-00028450: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00028460: 2020 706c 616e 6469 7220 3d20 6f73 2e70    plandir = os.p
-00028470: 6174 682e 6469 726e 616d 6528 6f70 656e  ath.dirname(open
-00028480: 7368 6966 742e 6372 6561 7465 2e5f 5f63  shift.create.__c
-00028490: 6f64 655f 5f2e 636f 5f66 696c 656e 616d  ode__.co_filenam
-000284a0: 6529 0a20 2020 2020 2020 2020 2020 2072  e).            r
-000284b0: 6f6c 6573 203d 205b 2763 6c6f 7564 5f63  oles = ['cloud_c
-000284c0: 746c 706c 616e 6573 272c 2027 636c 6f75  tlplanes', 'clou
-000284d0: 645f 776f 726b 6572 7327 5d20 6966 2073  d_workers'] if s
-000284e0: 656c 662e 7479 7065 2069 6e20 5b27 6177  elf.type in ['aw
-000284f0: 7327 2c20 2767 6370 275d 2065 6c73 6520  s', 'gcp'] else 
-00028500: 5b27 6374 6c70 6c61 6e65 7327 2c20 2777  ['ctlplanes', 'w
-00028510: 6f72 6b65 7273 275d 0a20 2020 2020 2020  orkers'].       
-00028520: 2069 6620 6f76 6572 7269 6465 732e 6765   if overrides.ge
-00028530: 7428 2777 6f72 6b65 7273 272c 2030 2920  t('workers', 0) 
-00028540: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
-00028550: 2020 6465 6c20 726f 6c65 735b 2d31 5d0a    del roles[-1].
-00028560: 2020 2020 2020 2020 6966 206f 732e 7061          if os.pa
-00028570: 7468 2e65 7869 7374 7328 6622 7b63 6c75  th.exists(f"{clu
-00028580: 7374 6572 6469 727d 2f6b 636c 695f 7061  sterdir}/kcli_pa
-00028590: 7261 6d65 7465 7273 2e79 6d6c 2229 3a0a  rameters.yml"):.
-000285a0: 2020 2020 2020 2020 2020 2020 6461 7461              data
-000285b0: 203d 207b 2763 6c75 7374 6572 273a 2063   = {'cluster': c
-000285c0: 6c75 7374 6572 2c20 276b 7562 6527 3a20  luster, 'kube': 
-000285d0: 636c 7573 7465 722c 2027 6b75 6265 7479  cluster, 'kubety
-000285e0: 7065 273a 205f 7479 7065 7d0a 2020 2020  pe': _type}.    
-000285f0: 2020 2020 2020 2020 7769 7468 206f 7065          with ope
-00028600: 6e28 6622 7b63 6c75 7374 6572 6469 727d  n(f"{clusterdir}
-00028610: 2f6b 636c 695f 7061 7261 6d65 7465 7273  /kcli_parameters
-00028620: 2e79 6d6c 222c 2027 7227 2920 6173 2069  .yml", 'r') as i
-00028630: 6e73 7461 6c6c 3a0a 2020 2020 2020 2020  nstall:.        
-00028640: 2020 2020 2020 2020 696e 7374 616c 6c70          installp
-00028650: 6172 616d 203d 2079 616d 6c2e 7361 6665  aram = yaml.safe
-00028660: 5f6c 6f61 6428 696e 7374 616c 6c29 0a20  _load(install). 
-00028670: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00028680: 6174 612e 7570 6461 7465 2869 6e73 7461  ata.update(insta
-00028690: 6c6c 7061 7261 6d29 0a20 2020 2020 2020  llparam).       
-000286a0: 2020 2020 2020 2020 2070 6c61 6e20 3d20           plan = 
-000286b0: 696e 7374 616c 6c70 6172 616d 2e67 6574  installparam.get
-000286c0: 2827 706c 616e 272c 2070 6c61 6e29 0a20  ('plan', plan). 
-000286d0: 2020 2020 2020 2020 2020 2064 6174 612e             data.
-000286e0: 7570 6461 7465 286f 7665 7272 6964 6573  update(overrides
-000286f0: 290a 2020 2020 2020 2020 2020 2020 7769  ).            wi
-00028700: 7468 206f 7065 6e28 6622 7b63 6c75 7374  th open(f"{clust
-00028710: 6572 6469 727d 2f6b 636c 695f 7061 7261  erdir}/kcli_para
-00028720: 6d65 7465 7273 2e79 6d6c 222c 2027 7727  meters.yml", 'w'
-00028730: 2920 6173 2070 6172 616d 6669 6c65 3a0a  ) as paramfile:.
-00028740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028750: 7961 6d6c 2e73 6166 655f 6475 6d70 2864  yaml.safe_dump(d
-00028760: 6174 612c 2070 6172 616d 6669 6c65 290a  ata, paramfile).
-00028770: 2020 2020 2020 2020 6f73 2e63 6864 6972          os.chdir
-00028780: 286f 732e 7061 7468 2e65 7870 616e 6475  (os.path.expandu
-00028790: 7365 7228 227e 2f2e 6b63 6c69 2229 290a  ser("~/.kcli")).
-000287a0: 2020 2020 2020 2020 666f 7220 726f 6c65          for role
-000287b0: 2069 6e20 726f 6c65 733a 0a20 2020 2020   in roles:.     
-000287c0: 2020 2020 2020 2070 7072 696e 7428 6622         pprint(f"
-000287d0: 5570 6461 7469 6e67 2076 6d73 2077 6974  Updating vms wit
-000287e0: 6820 7b72 6f6c 657d 2072 6f6c 6522 290a  h {role} role").
-000287f0: 2020 2020 2020 2020 2020 2020 706c 616e              plan
-00028800: 6461 7461 203d 2073 656c 662e 706c 616e  data = self.plan
-00028810: 2870 6c61 6e2c 2069 6e70 7574 6669 6c65  (plan, inputfile
-00028820: 3d66 277b 706c 616e 6469 727d 2f7b 726f  =f'{plandir}/{ro
-00028830: 6c65 7d2e 796d 6c27 2c20 6f76 6572 7269  le}.yml', overri
-00028840: 6465 733d 6f76 6572 7269 6465 732c 2075  des=overrides, u
-00028850: 7064 6174 653d 5472 7565 290a 2020 2020  pdate=True).    
-00028860: 2020 2020 2020 2020 706c 616e 766d 732e          planvms.
-00028870: 6578 7465 6e64 2870 6c61 6e64 6174 615b  extend(plandata[
-00028880: 276e 6577 766d 7327 5d20 2b20 706c 616e  'newvms'] + plan
-00028890: 6461 7461 5b27 6578 6973 7469 6e67 766d  data['existingvm
-000288a0: 7327 5d29 0a20 2020 2020 2020 206f 732e  s']).        os.
-000288b0: 656e 7669 726f 6e5b 274b 5542 4543 4f4e  environ['KUBECON
-000288c0: 4649 4727 5d20 3d20 6622 7b63 6c75 7374  FIG'] = f"{clust
-000288d0: 6572 6469 727d 2f61 7574 682f 6b75 6265  erdir}/auth/kube
-000288e0: 636f 6e66 6967 220a 2020 2020 2020 2020  config".        
-000288f0: 6269 6e61 7279 203d 2027 6f63 2720 6966  binary = 'oc' if
-00028900: 2077 6869 6368 2827 6f63 2729 2069 7320   which('oc') is 
-00028910: 6e6f 7420 4e6f 6e65 2065 6c73 6520 276b  not None else 'k
-00028920: 7562 6563 746c 270a 2020 2020 2020 2020  ubectl'.        
-00028930: 6e6f 6465 7363 6d64 203d 2066 277b 6269  nodescmd = f'{bi
-00028940: 6e61 7279 7d20 6765 7420 6e6f 6465 202d  nary} get node -
-00028950: 6f20 6e61 6d65 270a 2020 2020 2020 2020  o name'.        
-00028960: 6e6f 6465 7320 3d20 5b6e 2e73 7472 6970  nodes = [n.strip
-00028970: 2829 2e72 6570 6c61 6365 2827 6e6f 6465  ().replace('node
-00028980: 2f27 2c20 2727 2920 666f 7220 6e20 696e  /', '') for n in
-00028990: 206f 732e 706f 7065 6e28 6e6f 6465 7363   os.popen(nodesc
-000289a0: 6d64 292e 7265 6164 6c69 6e65 7328 295d  md).readlines()]
-000289b0: 0a20 2020 2020 2020 2066 6f72 2076 6d20  .        for vm 
-000289c0: 696e 2073 656c 662e 6b2e 6c69 7374 2829  in self.k.list()
-000289d0: 3a0a 2020 2020 2020 2020 2020 2020 766d  :.            vm
-000289e0: 6e61 6d65 203d 2076 6d5b 276e 616d 6527  name = vm['name'
-000289f0: 5d0a 2020 2020 2020 2020 2020 2020 766d  ].            vm
-00028a00: 706c 616e 203d 2076 6d2e 6765 7428 2770  plan = vm.get('p
-00028a10: 6c61 6e27 2c20 276b 7669 7274 2729 0a20  lan', 'kvirt'). 
-00028a20: 2020 2020 2020 2020 2020 2069 6620 766d             if vm
-00028a30: 706c 616e 203d 3d20 706c 616e 2061 6e64  plan == plan and
-00028a40: 2076 6d6e 616d 6520 6e6f 7420 696e 2070   vmname not in p
-00028a50: 6c61 6e76 6d73 3a0a 2020 2020 2020 2020  lanvms:.        
-00028a60: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
-00028a70: 2244 656c 6574 696e 6720 766d 207b 766d  "Deleting vm {vm
-00028a80: 6e61 6d65 7d22 290a 2020 2020 2020 2020  name}").        
-00028a90: 2020 2020 2020 2020 7365 6c66 2e6b 2e64          self.k.d
-00028aa0: 656c 6574 6528 766d 6e61 6d65 290a 2020  elete(vmname).  
-00028ab0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-00028ac0: 7220 6e6f 6465 2069 6e20 6e6f 6465 733a  r node in nodes:
-00028ad0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00028ae0: 2020 2020 2069 6620 6e6f 6465 2e73 706c       if node.spl
-00028af0: 6974 2827 2e27 295b 305d 203d 3d20 766d  it('.')[0] == vm
-00028b00: 6e61 6d65 3a0a 2020 2020 2020 2020 2020  name:.          
-00028b10: 2020 2020 2020 2020 2020 2020 2020 7070                pp
-00028b20: 7269 6e74 2866 2244 656c 6574 696e 6720  rint(f"Deleting 
-00028b30: 6e6f 6465 207b 6e6f 6465 7d20 6672 6f6d  node {node} from
-00028b40: 2079 6f75 7220 636c 7573 7465 7222 290a   your cluster").
+000264a0: 6e74 732e 7570 6461 7465 287b 636c 693a  nts.update({cli:
+000264b0: 204b 636f 6e66 6967 2863 6c69 656e 743d   Kconfig(client=
+000264c0: 636c 6929 2e6b 2066 6f72 2063 6c69 2069  cli).k for cli i
+000264d0: 6e20 766d 636c 6965 6e74 7320 6966 2063  n vmclients if c
+000264e0: 6c69 2021 3d20 7365 6c66 2e63 6c69 656e  li != self.clien
+000264f0: 747d 290a 2020 2020 2020 2020 666f 7220  t}).        for 
+00026500: 6879 7065 7276 6973 6f72 2069 6e20 6465  hypervisor in de
+00026510: 6c65 7465 636c 6965 6e74 733a 0a20 2020  leteclients:.   
+00026520: 2020 2020 2020 2020 2063 203d 2064 656c           c = del
+00026530: 6574 6563 6c69 656e 7473 5b68 7970 6572  eteclients[hyper
+00026540: 7669 736f 725d 0a20 2020 2020 2020 2020  visor].         
+00026550: 2020 2066 6f72 2076 6d20 696e 2073 6f72     for vm in sor
+00026560: 7465 6428 632e 6c69 7374 2829 2c20 6b65  ted(c.list(), ke
+00026570: 793d 6c61 6d62 6461 2078 3a20 785b 276e  y=lambda x: x['n
+00026580: 616d 6527 5d29 3a0a 2020 2020 2020 2020  ame']):.        
+00026590: 2020 2020 2020 2020 6e61 6d65 203d 2076          name = v
+000265a0: 6d5b 276e 616d 6527 5d0a 2020 2020 2020  m['name'].      
+000265b0: 2020 2020 2020 2020 2020 646e 7363 6c69            dnscli
+000265c0: 656e 7420 3d20 766d 2e67 6574 2827 646e  ent = vm.get('dn
+000265d0: 7363 6c69 656e 7427 2920 6f72 2064 6e73  sclient') or dns
+000265e0: 636c 6965 6e74 0a20 2020 2020 2020 2020  client.         
+000265f0: 2020 2020 2020 2063 7572 7265 6e74 636c         currentcl
+00026600: 7573 7465 7220 3d20 766d 2e67 6574 2827  uster = vm.get('
+00026610: 6b75 6265 2729 0a20 2020 2020 2020 2020  kube').         
+00026620: 2020 2020 2020 206b 7562 6574 7970 6520         kubetype 
+00026630: 3d20 766d 2e67 6574 2827 6b75 6265 7479  = vm.get('kubety
+00026640: 7065 272c 2027 6765 6e65 7269 6327 290a  pe', 'generic').
+00026650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026660: 6966 2063 7572 7265 6e74 636c 7573 7465  if currentcluste
+00026670: 7220 6973 206e 6f74 204e 6f6e 6520 616e  r is not None an
+00026680: 6420 6375 7272 656e 7463 6c75 7374 6572  d currentcluster
+00026690: 203d 3d20 636c 7573 7465 723a 0a20 2020   == cluster:.   
+000266a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000266b0: 2069 6620 6b75 6265 7479 7065 203d 3d20   if kubetype == 
+000266c0: 2767 6b65 273a 0a20 2020 2020 2020 2020  'gke':.         
+000266d0: 2020 2020 2020 2020 2020 2020 2020 2067                 g
+000266e0: 6b65 203d 2054 7275 650a 2020 2020 2020  ke = True.      
+000266f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026700: 2020 6272 6561 6b0a 2020 2020 2020 2020    break.        
+00026710: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+00026720: 206b 7562 6574 7970 6520 3d3d 2027 656b   kubetype == 'ek
+00026730: 7327 3a0a 2020 2020 2020 2020 2020 2020  s':.            
+00026740: 2020 2020 2020 2020 2020 2020 656b 7320              eks 
+00026750: 3d20 5472 7565 0a20 2020 2020 2020 2020  = True.         
+00026760: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+00026770: 7265 616b 0a20 2020 2020 2020 2020 2020  reak.           
+00026780: 2020 2020 2020 2020 2063 2e64 656c 6574           c.delet
+00026790: 6528 6e61 6d65 2c20 736e 6170 7368 6f74  e(name, snapshot
+000267a0: 733d 5472 7565 290a 2020 2020 2020 2020  s=True).        
+000267b0: 2020 2020 2020 2020 2020 2020 636f 6d6d              comm
+000267c0: 6f6e 2e64 656c 6574 655f 6c61 7374 766d  on.delete_lastvm
+000267d0: 286e 616d 652c 2073 656c 662e 636c 6965  (name, self.clie
+000267e0: 6e74 290a 2020 2020 2020 2020 2020 2020  nt).            
+000267f0: 2020 2020 2020 2020 7375 6363 6573 7328          success(
+00026800: 6622 7b6e 616d 657d 2064 656c 6574 6564  f"{name} deleted
+00026810: 206f 6e20 7b68 7970 6572 7669 736f 727d   on {hypervisor}
+00026820: 2122 290a 2020 2020 2020 2020 6966 2073  !").        if s
+00026830: 656c 662e 7479 7065 203d 3d20 276b 7562  elf.type == 'kub
+00026840: 6576 6972 7427 3a0a 2020 2020 2020 2020  evirt':.        
+00026850: 2020 2020 6966 2066 227b 636c 7573 7465      if f"{cluste
+00026860: 727d 2d61 7069 2220 696e 206b 2e6c 6973  r}-api" in k.lis
+00026870: 745f 7365 7276 6963 6573 286b 2e6e 616d  t_services(k.nam
+00026880: 6573 7061 6365 293a 0a20 2020 2020 2020  espace):.       
+00026890: 2020 2020 2020 2020 206b 2e64 656c 6574           k.delet
+000268a0: 655f 7365 7276 6963 6528 6622 7b63 6c75  e_service(f"{clu
+000268b0: 7374 6572 7d2d 6170 6922 2c20 6b2e 6e61  ster}-api", k.na
+000268c0: 6d65 7370 6163 6529 0a20 2020 2020 2020  mespace).       
+000268d0: 2020 2020 2069 6620 6622 7b63 6c75 7374       if f"{clust
+000268e0: 6572 7d2d 696e 6772 6573 7322 2069 6e20  er}-ingress" in 
+000268f0: 6b2e 6c69 7374 5f73 6572 7669 6365 7328  k.list_services(
+00026900: 6b2e 6e61 6d65 7370 6163 6529 3a0a 2020  k.namespace):.  
+00026910: 2020 2020 2020 2020 2020 2020 2020 6b2e                k.
+00026920: 6465 6c65 7465 5f73 6572 7669 6365 2866  delete_service(f
+00026930: 227b 636c 7573 7465 727d 2d69 6e67 7265  "{cluster}-ingre
+00026940: 7373 222c 206b 2e6e 616d 6573 7061 6365  ss", k.namespace
+00026950: 290a 2020 2020 2020 2020 6966 2073 656c  ).        if sel
+00026960: 662e 7479 7065 2069 6e20 5b27 6177 7327  f.type in ['aws'
+00026970: 2c20 2767 6370 272c 2027 6962 6d27 5d20  , 'gcp', 'ibm'] 
+00026980: 616e 6420 6e6f 7420 676b 6520 616e 6420  and not gke and 
+00026990: 6e6f 7420 656b 733a 0a20 2020 2020 2020  not eks:.       
+000269a0: 2020 2020 206c 6273 203d 205b 2761 7069       lbs = ['api
+000269b0: 272c 2027 6170 7073 275d 0a20 2020 2020  ', 'apps'].     
+000269c0: 2020 2020 2020 2069 6620 6b75 6265 7479         if kubety
+000269d0: 7065 206e 6f74 2069 6e20 5b27 6b33 7327  pe not in ['k3s'
+000269e0: 2c20 2767 656e 6572 6963 275d 3a0a 2020  , 'generic']:.  
+000269f0: 2020 2020 2020 2020 2020 2020 2020 6c62                lb
+00026a00: 732e 6170 7065 6e64 2827 6170 7073 2729  s.append('apps')
+00026a10: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+00026a20: 206c 6220 696e 206c 6273 3a0a 2020 2020   lb in lbs:.    
+00026a30: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00026a40: 2e64 656c 6574 655f 6c6f 6164 6261 6c61  .delete_loadbala
+00026a50: 6e63 6572 2866 227b 6c62 7d2e 7b63 6c75  ncer(f"{lb}.{clu
+00026a60: 7374 6572 7d22 2c20 646f 6d61 696e 3d64  ster}", domain=d
+00026a70: 6f6d 6169 6e29 0a20 2020 2020 2020 2020  omain).         
+00026a80: 2020 2062 7563 6b65 7420 3d20 6622 7b63     bucket = f"{c
+00026a90: 6c75 7374 6572 7d2d 7b64 6f6d 6169 6e7d  luster}-{domain}
+00026aa0: 220a 2020 2020 2020 2020 2020 2020 6966  ".            if
+00026ab0: 2062 7563 6b65 7420 696e 2073 656c 662e   bucket in self.
+00026ac0: 6b2e 6c69 7374 5f62 7563 6b65 7473 2829  k.list_buckets()
+00026ad0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00026ae0: 2020 7070 7269 6e74 2866 2244 656c 6574    pprint(f"Delet
+00026af0: 696e 6720 6275 636b 6574 207b 6275 636b  ing bucket {buck
+00026b00: 6574 7d22 290a 2020 2020 2020 2020 2020  et}").          
+00026b10: 2020 2020 2020 6b2e 6465 6c65 7465 5f62        k.delete_b
+00026b20: 7563 6b65 7428 6275 636b 6574 290a 2020  ucket(bucket).  
+00026b30: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
+00026b40: 662e 7479 7065 203d 3d20 2761 7773 2720  f.type == 'aws' 
+00026b50: 616e 6420 636c 7573 7465 7220 696e 206b  and cluster in k
+00026b60: 2e6c 6973 745f 696e 7374 616e 6365 5f70  .list_instance_p
+00026b70: 726f 6669 6c65 7328 293a 0a20 2020 2020  rofiles():.     
+00026b80: 2020 2020 2020 2020 2020 2069 616d 5f72             iam_r
+00026b90: 6f6c 6520 3d20 636c 7573 7465 7264 6174  ole = clusterdat
+00026ba0: 612e 6765 7428 2772 6f6c 6527 2c20 636c  a.get('role', cl
+00026bb0: 7573 7465 7229 0a20 2020 2020 2020 2020  uster).         
+00026bc0: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+00026bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026be0: 6b2e 6465 6c65 7465 5f69 6e73 7461 6e63  k.delete_instanc
+00026bf0: 655f 7072 6f66 696c 6528 636c 7573 7465  e_profile(cluste
+00026c00: 722c 2069 616d 5f72 6f6c 6529 0a20 2020  r, iam_role).   
+00026c10: 2020 2020 2020 2020 2020 2020 2065 7863               exc
+00026c20: 6570 743a 0a20 2020 2020 2020 2020 2020  ept:.           
+00026c30: 2020 2020 2020 2020 2070 6173 730a 2020           pass.  
+00026c40: 2020 2020 2020 2020 2020 2020 2020 7472                tr
+00026c50: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
+00026c60: 2020 2020 2020 206b 2e64 656c 6574 655f         k.delete_
+00026c70: 726f 6c65 2869 616d 5f72 6f6c 6529 0a20  role(iam_role). 
+00026c80: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00026c90: 7863 6570 743a 0a20 2020 2020 2020 2020  xcept:.         
+00026ca0: 2020 2020 2020 2020 2020 2070 6173 730a             pass.
+00026cb0: 2020 2020 2020 2020 656c 6966 2064 6e73          elif dns
+00026cc0: 636c 6965 6e74 2069 7320 6e6f 7420 4e6f  client is not No
+00026cd0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00026ce0: 7a20 3d20 4b63 6f6e 6669 6728 636c 6965  z = Kconfig(clie
+00026cf0: 6e74 3d64 6e73 636c 6965 6e74 292e 6b0a  nt=dnsclient).k.
+00026d00: 2020 2020 2020 2020 2020 2020 7a2e 6465              z.de
+00026d10: 6c65 7465 5f64 6e73 2866 2261 7069 2e7b  lete_dns(f"api.{
+00026d20: 636c 7573 7465 727d 222c 2064 6f6d 6169  cluster}", domai
+00026d30: 6e29 0a20 2020 2020 2020 2020 2020 207a  n).            z
+00026d40: 2e64 656c 6574 655f 646e 7328 6622 6170  .delete_dns(f"ap
+00026d50: 7073 2e7b 636c 7573 7465 727d 222c 2064  ps.{cluster}", d
+00026d60: 6f6d 6169 6e29 0a20 2020 2020 2020 2069  omain).        i
+00026d70: 6620 6879 7065 7273 6869 6674 3a0a 2020  f hypershift:.  
+00026d80: 2020 2020 2020 2020 2020 6b75 6265 636f            kubeco
+00026d90: 6e66 6967 6d67 6d74 203d 2066 227b 636c  nfigmgmt = f"{cl
+00026da0: 7573 7465 7264 6972 7d2f 6b75 6265 636f  usterdir}/kubeco
+00026db0: 6e66 6967 2e6d 676d 7422 0a20 2020 2020  nfig.mgmt".     
+00026dc0: 2020 2020 2020 2063 616c 6c28 6627 4b55         call(f'KU
+00026dd0: 4245 434f 4e46 4947 3d7b 6b75 6265 636f  BECONFIG={kubeco
+00026de0: 6e66 6967 6d67 6d74 7d20 6f63 2064 656c  nfigmgmt} oc del
+00026df0: 6574 6520 2d66 207b 636c 7573 7465 7264  ete -f {clusterd
+00026e00: 6972 7d2f 6175 746f 6170 7072 6f76 6572  ir}/autoapprover
+00026e10: 6372 6f6e 2e79 6d6c 272c 2073 6865 6c6c  cron.yml', shell
+00026e20: 3d54 7275 6529 0a20 2020 2020 2020 2020  =True).         
+00026e30: 2020 2063 616c 6c28 6627 4b55 4245 434f     call(f'KUBECO
+00026e40: 4e46 4947 3d7b 6b75 6265 636f 6e66 6967  NFIG={kubeconfig
+00026e50: 6d67 6d74 7d20 6f63 2064 656c 6574 6520  mgmt} oc delete 
+00026e60: 2d66 207b 636c 7573 7465 7264 6972 7d2f  -f {clusterdir}/
+00026e70: 6e6f 6465 706f 6f6c 2e79 616d 6c27 2c20  nodepool.yaml', 
+00026e80: 7368 656c 6c3d 5472 7565 290a 2020 2020  shell=True).    
+00026e90: 2020 2020 2020 2020 6361 6c6c 2866 274b          call(f'K
+00026ea0: 5542 4543 4f4e 4649 473d 7b6b 7562 6563  UBECONFIG={kubec
+00026eb0: 6f6e 6669 676d 676d 747d 206f 6320 6465  onfigmgmt} oc de
+00026ec0: 6c65 7465 202d 6620 7b63 6c75 7374 6572  lete -f {cluster
+00026ed0: 6469 727d 2f68 6f73 7465 6463 6c75 7374  dir}/hostedclust
+00026ee0: 6572 2e79 616d 6c27 2c20 7368 656c 6c3d  er.yaml', shell=
+00026ef0: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
+00026f00: 2020 6966 206e 6f74 2061 7373 6973 7465    if not assiste
+00026f10: 6420 616e 6420 2827 6261 7265 6d65 7461  d and ('baremeta
+00026f20: 6c5f 6973 6f27 2069 6e20 636c 7573 7465  l_iso' in cluste
+00026f30: 7264 6174 6120 6f72 2027 6261 7265 6d65  rdata or 'bareme
+00026f40: 7461 6c5f 686f 7374 7327 2069 6e20 636c  tal_hosts' in cl
+00026f50: 7573 7465 7264 6174 6129 3a0a 2020 2020  usterdata):.    
+00026f60: 2020 2020 2020 2020 2020 2020 6361 6c6c              call
+00026f70: 2866 274b 5542 4543 4f4e 4649 473d 7b6b  (f'KUBECONFIG={k
+00026f80: 7562 6563 6f6e 6669 676d 676d 747d 206f  ubeconfigmgmt} o
+00026f90: 6320 2d6e 2064 6566 6175 6c74 2064 656c  c -n default del
+00026fa0: 6574 6520 616c 6c20 2d6c 2061 7070 3d68  ete all -l app=h
+00026fb0: 7474 7064 2d6b 636c 6927 2c20 7368 656c  ttpd-kcli', shel
+00026fc0: 6c3d 5472 7565 290a 2020 2020 2020 2020  l=True).        
+00026fd0: 2020 2020 2020 2020 6361 6c6c 2866 274b          call(f'K
+00026fe0: 5542 4543 4f4e 4649 473d 7b6b 7562 6563  UBECONFIG={kubec
+00026ff0: 6f6e 6669 676d 676d 747d 206f 6320 2d6e  onfigmgmt} oc -n
+00027000: 2064 6566 6175 6c74 2064 656c 6574 6520   default delete 
+00027010: 7076 6320 6874 7470 642d 6b63 6c69 2d70  pvc httpd-kcli-p
+00027020: 7663 272c 2073 6865 6c6c 3d54 7275 6529  vc', shell=True)
+00027030: 0a20 2020 2020 2020 2069 6620 676b 653a  .        if gke:
+00027040: 0a20 2020 2020 2020 2020 2020 2067 6370  .            gcp
+00027050: 636c 6965 6e74 203d 204e 6f6e 650a 2020  client = None.  
+00027060: 2020 2020 2020 2020 2020 6966 2027 636c            if 'cl
+00027070: 6965 6e74 2720 696e 2063 6c75 7374 6572  ient' in cluster
+00027080: 6461 7461 3a0a 2020 2020 2020 2020 2020  data:.          
+00027090: 2020 2020 2020 6763 7063 6c69 656e 7420        gcpclient 
+000270a0: 3d20 636c 7573 7465 7264 6174 615b 2763  = clusterdata['c
+000270b0: 6c69 656e 7427 5d0a 2020 2020 2020 2020  lient'].        
+000270c0: 2020 2020 656c 6966 2073 656c 662e 7479      elif self.ty
+000270d0: 7065 203d 3d20 2767 6370 273a 0a20 2020  pe == 'gcp':.   
+000270e0: 2020 2020 2020 2020 2020 2020 2067 6370               gcp
+000270f0: 636c 6965 6e74 203d 2073 656c 662e 636c  client = self.cl
+00027100: 6965 6e74 0a20 2020 2020 2020 2020 2020  ient.           
+00027110: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00027120: 2020 2020 2020 206d 7367 203d 2022 4465         msg = "De
+00027130: 6c65 7469 6e67 2067 6b65 2063 6c75 7374  leting gke clust
+00027140: 6572 2072 6571 7569 7265 7320 746f 2069  er requires to i
+00027150: 6e73 7461 6e74 6961 7465 2067 6370 2070  nstantiate gcp p
+00027160: 726f 7669 6465 7222 0a20 2020 2020 2020  rovider".       
+00027170: 2020 2020 2020 2020 2065 7272 6f72 286d           error(m
+00027180: 7367 290a 2020 2020 2020 2020 2020 2020  sg).            
+00027190: 2020 2020 7265 7475 726e 207b 2772 6573      return {'res
+000271a0: 756c 7427 3a20 2766 6169 6c75 7265 272c  ult': 'failure',
+000271b0: 2027 7265 6173 6f6e 273a 206d 7367 7d0a   'reason': msg}.
+000271c0: 2020 2020 2020 2020 2020 2020 6672 6f6d              from
+000271d0: 206b 7669 7274 2e63 6c75 7374 6572 2069   kvirt.cluster i
+000271e0: 6d70 6f72 7420 676b 650a 2020 2020 2020  mport gke.      
+000271f0: 2020 2020 2020 6375 7272 656e 7463 6f6e        currentcon
+00027200: 6669 6720 3d20 4b63 6f6e 6669 6728 636c  fig = Kconfig(cl
+00027210: 6965 6e74 3d67 6370 636c 6965 6e74 292e  ient=gcpclient).
+00027220: 6b20 6966 2067 6370 636c 6965 6e74 2021  k if gcpclient !
+00027230: 3d20 7365 6c66 2e63 6c69 656e 7420 656c  = self.client el
+00027240: 7365 2073 656c 660a 2020 2020 2020 2020  se self.        
+00027250: 2020 2020 7a6f 6e61 6c20 3d20 636c 7573      zonal = clus
+00027260: 7465 7264 6174 612e 6765 7428 277a 6f6e  terdata.get('zon
+00027270: 616c 272c 2054 7275 6529 0a20 2020 2020  al', True).     
+00027280: 2020 2020 2020 2067 6b65 2e64 656c 6574         gke.delet
+00027290: 6528 6375 7272 656e 7463 6f6e 6669 672c  e(currentconfig,
+000272a0: 2063 6c75 7374 6572 2c20 7a6f 6e61 6c29   cluster, zonal)
+000272b0: 0a20 2020 2020 2020 2069 6620 656b 733a  .        if eks:
+000272c0: 0a20 2020 2020 2020 2020 2020 2065 6b73  .            eks
+000272d0: 636c 6965 6e74 203d 204e 6f6e 650a 2020  client = None.  
+000272e0: 2020 2020 2020 2020 2020 6966 2027 636c            if 'cl
+000272f0: 6965 6e74 2720 696e 2063 6c75 7374 6572  ient' in cluster
+00027300: 6461 7461 3a0a 2020 2020 2020 2020 2020  data:.          
+00027310: 2020 2020 2020 656b 7363 6c69 656e 7420        eksclient 
+00027320: 3d20 636c 7573 7465 7264 6174 615b 2763  = clusterdata['c
+00027330: 6c69 656e 7427 5d0a 2020 2020 2020 2020  lient'].        
+00027340: 2020 2020 656c 6966 2073 656c 662e 7479      elif self.ty
+00027350: 7065 203d 3d20 2761 7773 273a 0a20 2020  pe == 'aws':.   
+00027360: 2020 2020 2020 2020 2020 2020 2065 6b73               eks
+00027370: 636c 6965 6e74 203d 2073 656c 662e 636c  client = self.cl
+00027380: 6965 6e74 0a20 2020 2020 2020 2020 2020  ient.           
+00027390: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+000273a0: 2020 2020 2020 206d 7367 203d 2022 4465         msg = "De
+000273b0: 6c65 7469 6e67 2067 6b65 2063 6c75 7374  leting gke clust
+000273c0: 6572 2072 6571 7569 7265 7320 746f 2069  er requires to i
+000273d0: 6e73 7461 6e74 6961 7465 2067 6370 2070  nstantiate gcp p
+000273e0: 726f 7669 6465 7222 0a20 2020 2020 2020  rovider".       
+000273f0: 2020 2020 2020 2020 2065 7272 6f72 286d           error(m
+00027400: 7367 290a 2020 2020 2020 2020 2020 2020  sg).            
+00027410: 2020 2020 7265 7475 726e 207b 2772 6573      return {'res
+00027420: 756c 7427 3a20 2766 6169 6c75 7265 272c  ult': 'failure',
+00027430: 2027 7265 6173 6f6e 273a 206d 7367 7d0a   'reason': msg}.
+00027440: 2020 2020 2020 2020 2020 2020 6672 6f6d              from
+00027450: 206b 7669 7274 2e63 6c75 7374 6572 2069   kvirt.cluster i
+00027460: 6d70 6f72 7420 656b 730a 2020 2020 2020  mport eks.      
+00027470: 2020 2020 2020 6375 7272 656e 7463 6f6e        currentcon
+00027480: 6669 6720 3d20 4b63 6f6e 6669 6728 636c  fig = Kconfig(cl
+00027490: 6965 6e74 3d65 6b73 636c 6965 6e74 292e  ient=eksclient).
+000274a0: 6b20 6966 2065 6b73 636c 6965 6e74 2021  k if eksclient !
+000274b0: 3d20 7365 6c66 2e63 6c69 656e 7420 656c  = self.client el
+000274c0: 7365 2073 656c 660a 2020 2020 2020 2020  se self.        
+000274d0: 2020 2020 656b 732e 6465 6c65 7465 2863      eks.delete(c
+000274e0: 7572 7265 6e74 636f 6e66 6967 2c20 636c  urrentconfig, cl
+000274f0: 7573 7465 7229 0a20 2020 2020 2020 2066  uster).        f
+00027500: 6f72 2063 6f6e 6670 6f6f 6c20 696e 2073  or confpool in s
+00027510: 656c 662e 636f 6e66 706f 6f6c 733a 0a20  elf.confpools:. 
+00027520: 2020 2020 2020 2020 2020 2069 705f 7265             ip_re
+00027530: 7365 7276 6174 696f 6e73 203d 2073 656c  servations = sel
+00027540: 662e 636f 6e66 706f 6f6c 735b 636f 6e66  f.confpools[conf
+00027550: 706f 6f6c 5d2e 6765 7428 2769 705f 7265  pool].get('ip_re
+00027560: 7365 7276 6174 696f 6e73 272c 207b 7d29  servations', {})
+00027570: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00027580: 636c 7573 7465 7220 696e 2069 705f 7265  cluster in ip_re
+00027590: 7365 7276 6174 696f 6e73 3a0a 2020 2020  servations:.    
+000275a0: 2020 2020 2020 2020 2020 2020 6465 6c20              del 
+000275b0: 6970 5f72 6573 6572 7661 7469 6f6e 735b  ip_reservations[
+000275c0: 636c 7573 7465 725d 0a20 2020 2020 2020  cluster].       
+000275d0: 2020 2020 2020 2020 2073 656c 662e 7570           self.up
+000275e0: 6461 7465 5f63 6f6e 6670 6f6f 6c28 636f  date_confpool(co
+000275f0: 6e66 706f 6f6c 2c20 7b27 6970 5f72 6573  nfpool, {'ip_res
+00027600: 6572 7661 7469 6f6e 7327 3a20 6970 5f72  ervations': ip_r
+00027610: 6573 6572 7661 7469 6f6e 737d 290a 2020  eservations}).  
+00027620: 2020 2020 2020 2020 2020 6e61 6d65 5f72            name_r
+00027630: 6573 6572 7661 7469 6f6e 7320 3d20 7365  eservations = se
+00027640: 6c66 2e63 6f6e 6670 6f6f 6c73 5b63 6f6e  lf.confpools[con
+00027650: 6670 6f6f 6c5d 2e67 6574 2827 6e61 6d65  fpool].get('name
+00027660: 5f72 6573 6572 7661 7469 6f6e 7327 2c20  _reservations', 
+00027670: 5b5d 290a 2020 2020 2020 2020 2020 2020  []).            
+00027680: 6966 2063 6c75 7374 6572 2069 6e20 6e61  if cluster in na
+00027690: 6d65 5f72 6573 6572 7661 7469 6f6e 733a  me_reservations:
+000276a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000276b0: 206e 616d 655f 7265 7365 7276 6174 696f   name_reservatio
+000276c0: 6e73 2e72 656d 6f76 6528 636c 7573 7465  ns.remove(cluste
+000276d0: 7229 0a20 2020 2020 2020 2020 2020 2020  r).             
+000276e0: 2020 2073 656c 662e 7570 6461 7465 5f63     self.update_c
+000276f0: 6f6e 6670 6f6f 6c28 636f 6e66 706f 6f6c  onfpool(confpool
+00027700: 2c20 7b27 6e61 6d65 5f72 6573 6572 7661  , {'name_reserva
+00027710: 7469 6f6e 7327 3a20 6e61 6d65 5f72 6573  tions': name_res
+00027720: 6572 7661 7469 6f6e 737d 290a 2020 2020  ervations}).    
+00027730: 2020 2020 2020 2020 636c 7573 7465 725f          cluster_
+00027740: 6261 7265 6d65 7461 6c5f 7265 7365 7276  baremetal_reserv
+00027750: 6174 696f 6e73 203d 2073 656c 662e 636f  ations = self.co
+00027760: 6e66 706f 6f6c 735b 636f 6e66 706f 6f6c  nfpools[confpool
+00027770: 5d2e 6765 7428 2763 6c75 7374 6572 5f62  ].get('cluster_b
+00027780: 6172 656d 6574 616c 5f72 6573 6572 7661  aremetal_reserva
+00027790: 7469 6f6e 7327 2c20 7b7d 290a 2020 2020  tions', {}).    
+000277a0: 2020 2020 2020 2020 6966 2063 6c75 7374          if clust
+000277b0: 6572 2069 6e20 636c 7573 7465 725f 6261  er in cluster_ba
+000277c0: 7265 6d65 7461 6c5f 7265 7365 7276 6174  remetal_reservat
+000277d0: 696f 6e73 3a0a 2020 2020 2020 2020 2020  ions:.          
+000277e0: 2020 2020 2020 6465 6c20 636c 7573 7465        del cluste
+000277f0: 725f 6261 7265 6d65 7461 6c5f 7265 7365  r_baremetal_rese
+00027800: 7276 6174 696f 6e73 5b63 6c75 7374 6572  rvations[cluster
+00027810: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+00027820: 2020 7365 6c66 2e75 7064 6174 655f 636f    self.update_co
+00027830: 6e66 706f 6f6c 2863 6f6e 6670 6f6f 6c2c  nfpool(confpool,
+00027840: 207b 2763 6c75 7374 6572 5f62 6172 656d   {'cluster_barem
+00027850: 6574 616c 5f72 6573 6572 7661 7469 6f6e  etal_reservation
+00027860: 7327 3a20 636c 7573 7465 725f 6261 7265  s': cluster_bare
+00027870: 6d65 7461 6c5f 7265 7365 7276 6174 696f  metal_reservatio
+00027880: 6e73 7d29 0a20 2020 2020 2020 2069 6620  ns}).        if 
+00027890: 6f73 2e70 6174 682e 6578 6973 7473 2863  os.path.exists(c
+000278a0: 6c75 7374 6572 6469 7229 3a0a 2020 2020  lusterdir):.    
+000278b0: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
+000278c0: 2244 656c 6574 696e 6720 6469 7265 6374  "Deleting direct
+000278d0: 6f72 7920 7b63 6c75 7374 6572 6469 727d  ory {clusterdir}
+000278e0: 2229 0a20 2020 2020 2020 2020 2020 2072  ").            r
+000278f0: 6d74 7265 6528 636c 7573 7465 7264 6972  mtree(clusterdir
+00027900: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+00027910: 207b 2772 6573 756c 7427 3a20 2773 7563   {'result': 'suc
+00027920: 6365 7373 277d 0a0a 2020 2020 6465 6620  cess'}..    def 
+00027930: 7363 616c 655f 6b75 6265 2873 656c 662c  scale_kube(self,
+00027940: 2063 6c75 7374 6572 2c20 6b75 6265 7479   cluster, kubety
+00027950: 7065 2c20 6f76 6572 7269 6465 733d 7b7d  pe, overrides={}
+00027960: 293a 0a20 2020 2020 2020 2069 6620 6b75  ):.        if ku
+00027970: 6265 7479 7065 203d 3d20 2767 656e 6572  betype == 'gener
+00027980: 6963 273a 0a20 2020 2020 2020 2020 2020  ic':.           
+00027990: 2072 6573 756c 7420 3d20 7365 6c66 2e73   result = self.s
+000279a0: 6361 6c65 5f6b 7562 655f 6765 6e65 7269  cale_kube_generi
+000279b0: 6328 636c 7573 7465 722c 206f 7665 7272  c(cluster, overr
+000279c0: 6964 6573 3d6f 7665 7272 6964 6573 290a  ides=overrides).
+000279d0: 2020 2020 2020 2020 656c 6966 206b 7562          elif kub
+000279e0: 6574 7970 6520 3d3d 2027 6b33 7327 3a0a  etype == 'k3s':.
+000279f0: 2020 2020 2020 2020 2020 2020 7265 7375              resu
+00027a00: 6c74 203d 2073 656c 662e 7363 616c 655f  lt = self.scale_
+00027a10: 6b75 6265 5f6b 3373 2863 6c75 7374 6572  kube_k3s(cluster
+00027a20: 2c20 6f76 6572 7269 6465 733d 6f76 6572  , overrides=over
+00027a30: 7269 6465 7329 0a20 2020 2020 2020 2065  rides).        e
+00027a40: 6c69 6620 6b75 6265 7479 7065 203d 3d20  lif kubetype == 
+00027a50: 276f 7065 6e73 6869 6674 273a 0a20 2020  'openshift':.   
+00027a60: 2020 2020 2020 2020 2072 6573 756c 7420           result 
+00027a70: 3d20 7365 6c66 2e73 6361 6c65 5f6b 7562  = self.scale_kub
+00027a80: 655f 6f70 656e 7368 6966 7428 636c 7573  e_openshift(clus
+00027a90: 7465 722c 206f 7665 7272 6964 6573 3d6f  ter, overrides=o
+00027aa0: 7665 7272 6964 6573 290a 2020 2020 2020  verrides).      
+00027ab0: 2020 656c 6966 206b 7562 6574 7970 6520    elif kubetype 
+00027ac0: 3d3d 2027 6879 7065 7273 6869 6674 273a  == 'hypershift':
+00027ad0: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
+00027ae0: 756c 7420 3d20 7365 6c66 2e73 6361 6c65  ult = self.scale
+00027af0: 5f6b 7562 655f 6879 7065 7273 6869 6674  _kube_hypershift
+00027b00: 2863 6c75 7374 6572 2c20 6f76 6572 7269  (cluster, overri
+00027b10: 6465 733d 6f76 6572 7269 6465 7329 0a20  des=overrides). 
+00027b20: 2020 2020 2020 2065 6c69 6620 6b75 6265         elif kube
+00027b30: 7479 7065 203d 3d20 2767 6b65 273a 0a20  type == 'gke':. 
+00027b40: 2020 2020 2020 2020 2020 2072 6573 756c             resul
+00027b50: 7420 3d20 7365 6c66 2e73 6361 6c65 5f6b  t = self.scale_k
+00027b60: 7562 655f 676b 6528 636c 7573 7465 722c  ube_gke(cluster,
+00027b70: 206f 7665 7272 6964 6573 3d6f 7665 7272   overrides=overr
+00027b80: 6964 6573 290a 2020 2020 2020 2020 656c  ides).        el
+00027b90: 6966 206b 7562 6574 7970 6520 3d3d 2027  if kubetype == '
+00027ba0: 656b 7327 3a0a 2020 2020 2020 2020 2020  eks':.          
+00027bb0: 2020 7265 7375 6c74 203d 2073 656c 662e    result = self.
+00027bc0: 7363 616c 655f 6b75 6265 5f65 6b73 2863  scale_kube_eks(c
+00027bd0: 6c75 7374 6572 2c20 6f76 6572 7269 6465  luster, override
+00027be0: 733d 6f76 6572 7269 6465 7329 0a20 2020  s=overrides).   
+00027bf0: 2020 2020 2072 6574 7572 6e20 7265 7375       return resu
+00027c00: 6c74 0a0a 2020 2020 6465 6620 7363 616c  lt..    def scal
+00027c10: 655f 6b75 6265 5f65 6b73 2873 656c 662c  e_kube_eks(self,
+00027c20: 2063 6c75 7374 6572 2c20 6f76 6572 7269   cluster, overri
+00027c30: 6465 733d 7b7d 293a 0a20 2020 2020 2020  des={}):.       
+00027c40: 2066 726f 6d20 6b76 6972 742e 636c 7573   from kvirt.clus
+00027c50: 7465 7220 696d 706f 7274 2065 6b73 0a20  ter import eks. 
+00027c60: 2020 2020 2020 2072 6574 7572 6e20 656b         return ek
+00027c70: 732e 7363 616c 6528 7365 6c66 2c20 636c  s.scale(self, cl
+00027c80: 7573 7465 722c 206f 7665 7272 6964 6573  uster, overrides
+00027c90: 290a 0a20 2020 2064 6566 2073 6361 6c65  )..    def scale
+00027ca0: 5f6b 7562 655f 6765 6e65 7269 6328 7365  _kube_generic(se
+00027cb0: 6c66 2c20 636c 7573 7465 722c 206f 7665  lf, cluster, ove
+00027cc0: 7272 6964 6573 3d7b 7d29 3a0a 2020 2020  rrides={}):.    
+00027cd0: 2020 2020 706c 616e 6469 7220 3d20 6f73      plandir = os
+00027ce0: 2e70 6174 682e 6469 726e 616d 6528 6b75  .path.dirname(ku
+00027cf0: 6265 6164 6d2e 6372 6561 7465 2e5f 5f63  beadm.create.__c
+00027d00: 6f64 655f 5f2e 636f 5f66 696c 656e 616d  ode__.co_filenam
+00027d10: 6529 0a20 2020 2020 2020 2072 6574 7572  e).        retur
+00027d20: 6e20 6b75 6265 6164 6d2e 7363 616c 6528  n kubeadm.scale(
+00027d30: 7365 6c66 2c20 706c 616e 6469 722c 2063  self, plandir, c
+00027d40: 6c75 7374 6572 2c20 6f76 6572 7269 6465  luster, override
+00027d50: 7329 0a0a 2020 2020 6465 6620 7363 616c  s)..    def scal
+00027d60: 655f 6b75 6265 5f67 6b65 2873 656c 662c  e_kube_gke(self,
+00027d70: 2063 6c75 7374 6572 2c20 6f76 6572 7269   cluster, overri
+00027d80: 6465 733d 7b7d 293a 0a20 2020 2020 2020  des={}):.       
+00027d90: 2066 726f 6d20 6b76 6972 742e 636c 7573   from kvirt.clus
+00027da0: 7465 7220 696d 706f 7274 2067 6b65 0a20  ter import gke. 
+00027db0: 2020 2020 2020 2072 6574 7572 6e20 676b         return gk
+00027dc0: 652e 7363 616c 6528 7365 6c66 2c20 636c  e.scale(self, cl
+00027dd0: 7573 7465 722c 206f 7665 7272 6964 6573  uster, overrides
+00027de0: 290a 0a20 2020 2064 6566 2073 6361 6c65  )..    def scale
+00027df0: 5f6b 7562 655f 6879 7065 7273 6869 6674  _kube_hypershift
+00027e00: 2873 656c 662c 2063 6c75 7374 6572 2c20  (self, cluster, 
+00027e10: 6f76 6572 7269 6465 733d 7b7d 293a 0a20  overrides={}):. 
+00027e20: 2020 2020 2020 2070 6c61 6e64 6972 203d         plandir =
+00027e30: 206f 732e 7061 7468 2e64 6972 6e61 6d65   os.path.dirname
+00027e40: 2868 7970 6572 7368 6966 742e 6372 6561  (hypershift.crea
+00027e50: 7465 2e5f 5f63 6f64 655f 5f2e 636f 5f66  te.__code__.co_f
+00027e60: 696c 656e 616d 6529 0a20 2020 2020 2020  ilename).       
+00027e70: 2072 6574 7572 6e20 6879 7065 7273 6869   return hypershi
+00027e80: 6674 2e73 6361 6c65 2873 656c 662c 2070  ft.scale(self, p
+00027e90: 6c61 6e64 6972 2c20 636c 7573 7465 722c  landir, cluster,
+00027ea0: 206f 7665 7272 6964 6573 290a 0a20 2020   overrides)..   
+00027eb0: 2064 6566 2073 6361 6c65 5f6b 7562 655f   def scale_kube_
+00027ec0: 6b33 7328 7365 6c66 2c20 636c 7573 7465  k3s(self, cluste
+00027ed0: 722c 206f 7665 7272 6964 6573 3d7b 7d29  r, overrides={})
+00027ee0: 3a0a 2020 2020 2020 2020 706c 616e 6469  :.        plandi
+00027ef0: 7220 3d20 6f73 2e70 6174 682e 6469 726e  r = os.path.dirn
+00027f00: 616d 6528 6b33 732e 6372 6561 7465 2e5f  ame(k3s.create._
+00027f10: 5f63 6f64 655f 5f2e 636f 5f66 696c 656e  _code__.co_filen
+00027f20: 616d 6529 0a20 2020 2020 2020 2072 6574  ame).        ret
+00027f30: 7572 6e20 6b33 732e 7363 616c 6528 7365  urn k3s.scale(se
+00027f40: 6c66 2c20 706c 616e 6469 722c 2063 6c75  lf, plandir, clu
+00027f50: 7374 6572 2c20 6f76 6572 7269 6465 7329  ster, overrides)
+00027f60: 0a0a 2020 2020 6465 6620 7363 616c 655f  ..    def scale_
+00027f70: 6b75 6265 5f6f 7065 6e73 6869 6674 2873  kube_openshift(s
+00027f80: 656c 662c 2063 6c75 7374 6572 2c20 6f76  elf, cluster, ov
+00027f90: 6572 7269 6465 733d 7b7d 293a 0a20 2020  errides={}):.   
+00027fa0: 2020 2020 2070 6c61 6e64 6972 203d 206f       plandir = o
+00027fb0: 732e 7061 7468 2e64 6972 6e61 6d65 286f  s.path.dirname(o
+00027fc0: 7065 6e73 6869 6674 2e63 7265 6174 652e  penshift.create.
+00027fd0: 5f5f 636f 6465 5f5f 2e63 6f5f 6669 6c65  __code__.co_file
+00027fe0: 6e61 6d65 290a 2020 2020 2020 2020 7265  name).        re
+00027ff0: 7475 726e 206f 7065 6e73 6869 6674 2e73  turn openshift.s
+00028000: 6361 6c65 2873 656c 662c 2070 6c61 6e64  cale(self, pland
+00028010: 6972 2c20 636c 7573 7465 722c 206f 7665  ir, cluster, ove
+00028020: 7272 6964 6573 290a 0a20 2020 2064 6566  rrides)..    def
+00028030: 2075 7064 6174 655f 6b75 6265 2873 656c   update_kube(sel
+00028040: 662c 2063 6c75 7374 6572 2c20 5f74 7970  f, cluster, _typ
+00028050: 652c 206f 7665 7272 6964 6573 3d7b 7d2c  e, overrides={},
+00028060: 2070 6c61 6e3d 4e6f 6e65 293a 0a20 2020   plan=None):.   
+00028070: 2020 2020 206f 7665 7272 6964 6573 5b27       overrides['
+00028080: 736b 6970 5f66 696c 6573 5f72 656d 6564  skip_files_remed
+00028090: 6961 7469 6f6e 275d 203d 2054 7275 650a  iation'] = True.
+000280a0: 2020 2020 2020 2020 6f76 6572 7269 6465          override
+000280b0: 735b 2773 6361 6c65 275d 203d 2054 7275  s['scale'] = Tru
+000280c0: 650a 2020 2020 2020 2020 636c 7573 7465  e.        cluste
+000280d0: 7264 6972 203d 206f 732e 7061 7468 2e65  rdir = os.path.e
+000280e0: 7870 616e 6475 7365 7228 6622 7e2f 2e6b  xpanduser(f"~/.k
+000280f0: 636c 692f 636c 7573 7465 7273 2f7b 636c  cli/clusters/{cl
+00028100: 7573 7465 727d 2229 0a20 2020 2020 2020  uster}").       
+00028110: 2070 6c61 6e76 6d73 203d 205b 5d0a 2020   planvms = [].  
+00028120: 2020 2020 2020 6966 2070 6c61 6e20 6973        if plan is
+00028130: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00028140: 2020 2070 6c61 6e20 3d20 636c 7573 7465     plan = cluste
+00028150: 720a 2020 2020 2020 2020 6966 205f 7479  r.        if _ty
+00028160: 7065 203d 3d20 2765 6b73 273a 0a20 2020  pe == 'eks':.   
+00028170: 2020 2020 2020 2020 2073 656c 662e 7363           self.sc
+00028180: 616c 655f 6b75 6265 5f65 6b73 2863 6c75  ale_kube_eks(clu
+00028190: 7374 6572 2c20 6f76 6572 7269 6465 733d  ster, overrides=
+000281a0: 6f76 6572 7269 6465 7329 0a20 2020 2020  overrides).     
+000281b0: 2020 2020 2020 2072 6574 7572 6e0a 2020         return.  
+000281c0: 2020 2020 2020 6966 205f 7479 7065 203d        if _type =
+000281d0: 3d20 2767 6b65 273a 0a20 2020 2020 2020  = 'gke':.       
+000281e0: 2020 2020 2073 656c 662e 7363 616c 655f       self.scale_
+000281f0: 6b75 6265 5f67 6b65 2863 6c75 7374 6572  kube_gke(cluster
+00028200: 2c20 6f76 6572 7269 6465 733d 6f76 6572  , overrides=over
+00028210: 7269 6465 7329 0a20 2020 2020 2020 2020  rides).         
+00028220: 2020 2072 6574 7572 6e0a 2020 2020 2020     return.      
+00028230: 2020 6966 205f 7479 7065 203d 3d20 2767    if _type == 'g
+00028240: 656e 6572 6963 273a 0a20 2020 2020 2020  eneric':.       
+00028250: 2020 2020 2072 6f6c 6573 203d 205b 2763       roles = ['c
+00028260: 746c 706c 616e 6573 272c 2027 776f 726b  tlplanes', 'work
+00028270: 6572 7327 5d0a 2020 2020 2020 2020 2020  ers'].          
+00028280: 2020 706c 616e 6469 7220 3d20 6f73 2e70    plandir = os.p
+00028290: 6174 682e 6469 726e 616d 6528 6b75 6265  ath.dirname(kube
+000282a0: 6164 6d2e 6372 6561 7465 2e5f 5f63 6f64  adm.create.__cod
+000282b0: 655f 5f2e 636f 5f66 696c 656e 616d 6529  e__.co_filename)
+000282c0: 0a20 2020 2020 2020 2065 6c69 6620 5f74  .        elif _t
+000282d0: 7970 6520 3d3d 2027 6b33 7327 3a0a 2020  ype == 'k3s':.  
+000282e0: 2020 2020 2020 2020 2020 706c 616e 6469            plandi
+000282f0: 7220 3d20 6f73 2e70 6174 682e 6469 726e  r = os.path.dirn
+00028300: 616d 6528 6b33 732e 6372 6561 7465 2e5f  ame(k3s.create._
+00028310: 5f63 6f64 655f 5f2e 636f 5f66 696c 656e  _code__.co_filen
+00028320: 616d 6529 0a20 2020 2020 2020 2020 2020  ame).           
+00028330: 2072 6f6c 6573 203d 205b 2762 6f6f 7473   roles = ['boots
+00028340: 7472 6170 272c 2027 776f 726b 6572 7327  trap', 'workers'
+00028350: 5d20 6966 206f 7665 7272 6964 6573 2e67  ] if overrides.g
+00028360: 6574 2827 6374 6c70 6c61 6e65 7327 2c20  et('ctlplanes', 
+00028370: 3129 203d 3d20 3120 656c 7365 205b 2762  1) == 1 else ['b
+00028380: 6f6f 7473 7472 6170 272c 2027 6374 6c70  ootstrap', 'ctlp
+00028390: 6c61 6e65 7327 2c0a 2020 2020 2020 2020  lanes',.        
+000283a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000283b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000283c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000283d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000283e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000283f0: 2027 776f 726b 6572 7327 5d0a 2020 2020   'workers'].    
+00028400: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00028410: 2020 2020 2020 706c 616e 6469 7220 3d20        plandir = 
+00028420: 6f73 2e70 6174 682e 6469 726e 616d 6528  os.path.dirname(
+00028430: 6f70 656e 7368 6966 742e 6372 6561 7465  openshift.create
+00028440: 2e5f 5f63 6f64 655f 5f2e 636f 5f66 696c  .__code__.co_fil
+00028450: 656e 616d 6529 0a20 2020 2020 2020 2020  ename).         
+00028460: 2020 2072 6f6c 6573 203d 205b 2763 6c6f     roles = ['clo
+00028470: 7564 5f63 746c 706c 616e 6573 272c 2027  ud_ctlplanes', '
+00028480: 636c 6f75 645f 776f 726b 6572 7327 5d20  cloud_workers'] 
+00028490: 6966 2073 656c 662e 7479 7065 2069 6e20  if self.type in 
+000284a0: 5b27 6177 7327 2c20 2767 6370 275d 2065  ['aws', 'gcp'] e
+000284b0: 6c73 6520 5b27 6374 6c70 6c61 6e65 7327  lse ['ctlplanes'
+000284c0: 2c20 2777 6f72 6b65 7273 275d 0a20 2020  , 'workers'].   
+000284d0: 2020 2020 2069 6620 6f76 6572 7269 6465       if override
+000284e0: 732e 6765 7428 2777 6f72 6b65 7273 272c  s.get('workers',
+000284f0: 2030 2920 3d3d 2030 3a0a 2020 2020 2020   0) == 0:.      
+00028500: 2020 2020 2020 6465 6c20 726f 6c65 735b        del roles[
+00028510: 2d31 5d0a 2020 2020 2020 2020 6966 206f  -1].        if o
+00028520: 732e 7061 7468 2e65 7869 7374 7328 6622  s.path.exists(f"
+00028530: 7b63 6c75 7374 6572 6469 727d 2f6b 636c  {clusterdir}/kcl
+00028540: 695f 7061 7261 6d65 7465 7273 2e79 6d6c  i_parameters.yml
+00028550: 2229 3a0a 2020 2020 2020 2020 2020 2020  "):.            
+00028560: 6461 7461 203d 207b 2763 6c75 7374 6572  data = {'cluster
+00028570: 273a 2063 6c75 7374 6572 2c20 276b 7562  ': cluster, 'kub
+00028580: 6527 3a20 636c 7573 7465 722c 2027 6b75  e': cluster, 'ku
+00028590: 6265 7479 7065 273a 205f 7479 7065 7d0a  betype': _type}.
+000285a0: 2020 2020 2020 2020 2020 2020 7769 7468              with
+000285b0: 206f 7065 6e28 6622 7b63 6c75 7374 6572   open(f"{cluster
+000285c0: 6469 727d 2f6b 636c 695f 7061 7261 6d65  dir}/kcli_parame
+000285d0: 7465 7273 2e79 6d6c 222c 2027 7227 2920  ters.yml", 'r') 
+000285e0: 6173 2069 6e73 7461 6c6c 3a0a 2020 2020  as install:.    
+000285f0: 2020 2020 2020 2020 2020 2020 696e 7374              inst
+00028600: 616c 6c70 6172 616d 203d 2079 616d 6c2e  allparam = yaml.
+00028610: 7361 6665 5f6c 6f61 6428 696e 7374 616c  safe_load(instal
+00028620: 6c29 0a20 2020 2020 2020 2020 2020 2020  l).             
+00028630: 2020 2064 6174 612e 7570 6461 7465 2869     data.update(i
+00028640: 6e73 7461 6c6c 7061 7261 6d29 0a20 2020  nstallparam).   
+00028650: 2020 2020 2020 2020 2020 2020 2070 6c61               pla
+00028660: 6e20 3d20 696e 7374 616c 6c70 6172 616d  n = installparam
+00028670: 2e67 6574 2827 706c 616e 272c 2070 6c61  .get('plan', pla
+00028680: 6e29 0a20 2020 2020 2020 2020 2020 2064  n).            d
+00028690: 6174 612e 7570 6461 7465 286f 7665 7272  ata.update(overr
+000286a0: 6964 6573 290a 2020 2020 2020 2020 2020  ides).          
+000286b0: 2020 7769 7468 206f 7065 6e28 6622 7b63    with open(f"{c
+000286c0: 6c75 7374 6572 6469 727d 2f6b 636c 695f  lusterdir}/kcli_
+000286d0: 7061 7261 6d65 7465 7273 2e79 6d6c 222c  parameters.yml",
+000286e0: 2027 7727 2920 6173 2070 6172 616d 6669   'w') as paramfi
+000286f0: 6c65 3a0a 2020 2020 2020 2020 2020 2020  le:.            
+00028700: 2020 2020 7961 6d6c 2e73 6166 655f 6475      yaml.safe_du
+00028710: 6d70 2864 6174 612c 2070 6172 616d 6669  mp(data, paramfi
+00028720: 6c65 290a 2020 2020 2020 2020 6f73 2e63  le).        os.c
+00028730: 6864 6972 286f 732e 7061 7468 2e65 7870  hdir(os.path.exp
+00028740: 616e 6475 7365 7228 227e 2f2e 6b63 6c69  anduser("~/.kcli
+00028750: 2229 290a 2020 2020 2020 2020 666f 7220  ")).        for 
+00028760: 726f 6c65 2069 6e20 726f 6c65 733a 0a20  role in roles:. 
+00028770: 2020 2020 2020 2020 2020 2070 7072 696e             pprin
+00028780: 7428 6622 5570 6461 7469 6e67 2076 6d73  t(f"Updating vms
+00028790: 2077 6974 6820 7b72 6f6c 657d 2072 6f6c   with {role} rol
+000287a0: 6522 290a 2020 2020 2020 2020 2020 2020  e").            
+000287b0: 706c 616e 6461 7461 203d 2073 656c 662e  plandata = self.
+000287c0: 706c 616e 2870 6c61 6e2c 2069 6e70 7574  plan(plan, input
+000287d0: 6669 6c65 3d66 277b 706c 616e 6469 727d  file=f'{plandir}
+000287e0: 2f7b 726f 6c65 7d2e 796d 6c27 2c20 6f76  /{role}.yml', ov
+000287f0: 6572 7269 6465 733d 6f76 6572 7269 6465  errides=override
+00028800: 732c 2075 7064 6174 653d 5472 7565 290a  s, update=True).
+00028810: 2020 2020 2020 2020 2020 2020 706c 616e              plan
+00028820: 766d 732e 6578 7465 6e64 2870 6c61 6e64  vms.extend(pland
+00028830: 6174 615b 276e 6577 766d 7327 5d20 2b20  ata['newvms'] + 
+00028840: 706c 616e 6461 7461 5b27 6578 6973 7469  plandata['existi
+00028850: 6e67 766d 7327 5d29 0a20 2020 2020 2020  ngvms']).       
+00028860: 206f 732e 656e 7669 726f 6e5b 274b 5542   os.environ['KUB
+00028870: 4543 4f4e 4649 4727 5d20 3d20 6622 7b63  ECONFIG'] = f"{c
+00028880: 6c75 7374 6572 6469 727d 2f61 7574 682f  lusterdir}/auth/
+00028890: 6b75 6265 636f 6e66 6967 220a 2020 2020  kubeconfig".    
+000288a0: 2020 2020 6269 6e61 7279 203d 2027 6f63      binary = 'oc
+000288b0: 2720 6966 2077 6869 6368 2827 6f63 2729  ' if which('oc')
+000288c0: 2069 7320 6e6f 7420 4e6f 6e65 2065 6c73   is not None els
+000288d0: 6520 276b 7562 6563 746c 270a 2020 2020  e 'kubectl'.    
+000288e0: 2020 2020 6e6f 6465 7363 6d64 203d 2066      nodescmd = f
+000288f0: 277b 6269 6e61 7279 7d20 6765 7420 6e6f  '{binary} get no
+00028900: 6465 202d 6f20 6e61 6d65 270a 2020 2020  de -o name'.    
+00028910: 2020 2020 6e6f 6465 7320 3d20 5b6e 2e73      nodes = [n.s
+00028920: 7472 6970 2829 2e72 6570 6c61 6365 2827  trip().replace('
+00028930: 6e6f 6465 2f27 2c20 2727 2920 666f 7220  node/', '') for 
+00028940: 6e20 696e 206f 732e 706f 7065 6e28 6e6f  n in os.popen(no
+00028950: 6465 7363 6d64 292e 7265 6164 6c69 6e65  descmd).readline
+00028960: 7328 295d 0a20 2020 2020 2020 2066 6f72  s()].        for
+00028970: 2076 6d20 696e 2073 656c 662e 6b2e 6c69   vm in self.k.li
+00028980: 7374 2829 3a0a 2020 2020 2020 2020 2020  st():.          
+00028990: 2020 766d 6e61 6d65 203d 2076 6d5b 276e    vmname = vm['n
+000289a0: 616d 6527 5d0a 2020 2020 2020 2020 2020  ame'].          
+000289b0: 2020 766d 706c 616e 203d 2076 6d2e 6765    vmplan = vm.ge
+000289c0: 7428 2770 6c61 6e27 2c20 276b 7669 7274  t('plan', 'kvirt
+000289d0: 2729 0a20 2020 2020 2020 2020 2020 2069  ').            i
+000289e0: 6620 766d 706c 616e 203d 3d20 706c 616e  f vmplan == plan
+000289f0: 2061 6e64 2076 6d6e 616d 6520 6e6f 7420   and vmname not 
+00028a00: 696e 2070 6c61 6e76 6d73 3a0a 2020 2020  in planvms:.    
+00028a10: 2020 2020 2020 2020 2020 2020 7070 7269              ppri
+00028a20: 6e74 2866 2244 656c 6574 696e 6720 766d  nt(f"Deleting vm
+00028a30: 207b 766d 6e61 6d65 7d22 290a 2020 2020   {vmname}").    
+00028a40: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00028a50: 2e6b 2e64 656c 6574 6528 766d 6e61 6d65  .k.delete(vmname
+00028a60: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00028a70: 2020 666f 7220 6e6f 6465 2069 6e20 6e6f    for node in no
+00028a80: 6465 733a 0a20 2020 2020 2020 2020 2020  des:.           
+00028a90: 2020 2020 2020 2020 2069 6620 6e6f 6465           if node
+00028aa0: 2e73 706c 6974 2827 2e27 295b 305d 203d  .split('.')[0] =
+00028ab0: 3d20 766d 6e61 6d65 3a0a 2020 2020 2020  = vmname:.      
+00028ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028ad0: 2020 7070 7269 6e74 2866 2244 656c 6574    pprint(f"Delet
+00028ae0: 696e 6720 6e6f 6465 207b 6e6f 6465 7d20  ing node {node} 
+00028af0: 6672 6f6d 2079 6f75 7220 636c 7573 7465  from your cluste
+00028b00: 7222 290a 2020 2020 2020 2020 2020 2020  r").            
+00028b10: 2020 2020 2020 2020 2020 2020 6361 6c6c              call
+00028b20: 2866 277b 6269 6e61 7279 7d20 6465 6c65  (f'{binary} dele
+00028b30: 7465 206e 6f64 6520 7b6e 6f64 657d 272c  te node {node}',
+00028b40: 2073 6865 6c6c 3d54 7275 6529 0a20 2020   shell=True).   
 00028b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028b60: 2020 2020 2020 2020 6361 6c6c 2866 277b          call(f'{
-00028b70: 6269 6e61 7279 7d20 6465 6c65 7465 206e  binary} delete n
-00028b80: 6f64 6520 7b6e 6f64 657d 272c 2073 6865  ode {node}', she
-00028b90: 6c6c 3d54 7275 6529 0a20 2020 2020 2020  ll=True).       
-00028ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028bb0: 2062 7265 616b 0a0a 2020 2020 6465 6620   break..    def 
-00028bc0: 6578 706f 7365 5f70 6c61 6e28 7365 6c66  expose_plan(self
-00028bd0: 2c20 706c 616e 2c20 696e 7075 7466 696c  , plan, inputfil
-00028be0: 653d 4e6f 6e65 2c20 6f76 6572 7269 6465  e=None, override
-00028bf0: 733d 7b7d 2c20 706f 7274 3d39 3030 302c  s={}, port=9000,
-00028c00: 2070 666d 6f64 653d 4661 6c73 652c 2063   pfmode=False, c
-00028c10: 6c75 7374 6572 3d46 616c 7365 293a 0a20  luster=False):. 
-00028c20: 2020 2020 2020 2069 6e70 7574 6669 6c65         inputfile
-00028c30: 203d 206f 732e 7061 7468 2e65 7870 616e   = os.path.expan
-00028c40: 6475 7365 7228 696e 7075 7466 696c 6529  duser(inputfile)
-00028c50: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-00028c60: 6f73 2e70 6174 682e 6578 6973 7473 2869  os.path.exists(i
-00028c70: 6e70 7574 6669 6c65 293a 0a20 2020 2020  nputfile):.     
-00028c80: 2020 2020 2020 2065 7272 6f72 2822 4e6f         error("No
-00028c90: 2069 6e70 7574 2066 696c 6520 666f 756e   input file foun
-00028ca0: 6420 6e6f 7220 6465 6661 756c 7420 6b63  d nor default kc
-00028cb0: 6c69 5f70 6c61 6e2e 796d 6c2e 4c65 6176  li_plan.yml.Leav
-00028cc0: 696e 672e 2e2e 2e22 290a 2020 2020 2020  ing....").      
-00028cd0: 2020 2020 2020 7379 732e 6578 6974 2831        sys.exit(1
-00028ce0: 290a 2020 2020 2020 2020 7070 7269 6e74  ).        pprint
-00028cf0: 2866 2248 616e 646c 696e 6720 6578 706f  (f"Handling expo
-00028d00: 7365 206f 6620 706c 616e 2077 6974 6820  se of plan with 
-00028d10: 6e61 6d65 207b 706c 616e 7d20 616e 6420  name {plan} and 
-00028d20: 696e 7075 7466 696c 6520 7b69 6e70 7574  inputfile {input
-00028d30: 6669 6c65 7d22 290a 2020 2020 2020 2020  file}").        
-00028d40: 6b65 7870 6f73 6572 203d 204b 6578 706f  kexposer = Kexpo
-00028d50: 7365 7228 7365 6c66 2c20 706c 616e 2c20  ser(self, plan, 
-00028d60: 696e 7075 7466 696c 652c 206f 7665 7272  inputfile, overr
-00028d70: 6964 6573 3d6f 7665 7272 6964 6573 2c20  ides=overrides, 
-00028d80: 706f 7274 3d70 6f72 742c 2070 666d 6f64  port=port, pfmod
-00028d90: 653d 7066 6d6f 6465 2c20 636c 7573 7465  e=pfmode, cluste
-00028da0: 723d 636c 7573 7465 7229 0a20 2020 2020  r=cluster).     
-00028db0: 2020 206b 6578 706f 7365 722e 7275 6e28     kexposer.run(
-00028dc0: 290a 0a20 2020 2064 6566 2063 7265 6174  )..    def creat
-00028dd0: 655f 6f70 656e 7368 6966 745f 6973 6f28  e_openshift_iso(
-00028de0: 7365 6c66 2c20 636c 7573 7465 722c 206f  self, cluster, o
-00028df0: 7665 7272 6964 6573 3d7b 7d2c 2069 676e  verrides={}, ign
-00028e00: 6974 696f 6e66 696c 653d 4e6f 6e65 2c20  itionfile=None, 
-00028e10: 706f 646d 616e 3d46 616c 7365 2c20 696e  podman=False, in
-00028e20: 7374 616c 6c65 723d 4661 6c73 652c 0a20  staller=False,. 
-00028e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028e40: 2020 2020 2020 2020 2020 2020 6469 7265              dire
-00028e50: 6374 3d46 616c 7365 293a 0a20 2020 2020  ct=False):.     
-00028e60: 2020 206d 6574 616c 5f75 726c 203d 204e     metal_url = N
-00028e70: 6f6e 650a 2020 2020 2020 2020 6973 6f5f  one.        iso_
-00028e80: 7665 7273 696f 6e20 3d20 7374 7228 6f76  version = str(ov
-00028e90: 6572 7269 6465 732e 6765 7428 2776 6572  errides.get('ver
-00028ea0: 7369 6f6e 272c 2027 6c61 7465 7374 2729  sion', 'latest')
-00028eb0: 290a 2020 2020 2020 2020 6966 206e 6f74  ).        if not
-00028ec0: 2069 6e73 7461 6c6c 6572 3a0a 2020 2020   installer:.    
-00028ed0: 2020 2020 2020 2020 6966 2069 736f 5f76          if iso_v
-00028ee0: 6572 7369 6f6e 206e 6f74 2069 6e20 5b27  ersion not in ['
-00028ef0: 6c61 7465 7374 272c 2027 7072 652d 7265  latest', 'pre-re
-00028f00: 6c65 6173 6527 5d20 616e 6420 6e6f 7420  lease'] and not 
-00028f10: 6973 6f5f 7665 7273 696f 6e2e 7374 6172  iso_version.star
-00028f20: 7473 7769 7468 2827 342e 2729 3a0a 2020  tswith('4.'):.  
-00028f30: 2020 2020 2020 2020 2020 2020 2020 7761                wa
-00028f40: 726e 696e 6728 2246 6f72 6369 6e67 206c  rning("Forcing l
-00028f50: 6976 6520 6973 6f20 7665 7273 696f 6e20  ive iso version 
-00028f60: 746f 206c 6174 6573 7422 290a 2020 2020  to latest").    
-00028f70: 2020 2020 2020 2020 2020 2020 6973 6f5f              iso_
-00028f80: 7665 7273 696f 6e20 3d20 276c 6174 6573  version = 'lates
-00028f90: 7427 0a20 2020 2020 2020 2020 2020 2065  t'.            e
-00028fa0: 6c69 6620 6973 6f5f 7665 7273 696f 6e2e  lif iso_version.
-00028fb0: 7374 6172 7473 7769 7468 2827 342e 2729  startswith('4.')
-00028fc0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00028fd0: 2020 6d69 6e6f 725f 7665 7273 696f 6e20    minor_version 
-00028fe0: 3d20 6973 6f5f 7665 7273 696f 6e2e 7370  = iso_version.sp
-00028ff0: 6c69 7428 272e 2729 5b31 5d0a 2020 2020  lit('.')[1].    
-00029000: 2020 2020 2020 2020 2020 2020 6966 206d              if m
-00029010: 696e 6f72 5f76 6572 7369 6f6e 2e69 7364  inor_version.isd
-00029020: 6967 6974 2829 2061 6e64 2069 6e74 286d  igit() and int(m
-00029030: 696e 6f72 5f76 6572 7369 6f6e 2920 3c20  inor_version) < 
-00029040: 363a 0a20 2020 2020 2020 2020 2020 2020  6:.             
-00029050: 2020 2020 2020 206d 6574 616c 5f75 726c         metal_url
-00029060: 203d 2066 2268 7474 7073 3a2f 2f6d 6972   = f"https://mir
-00029070: 726f 722e 6f70 656e 7368 6966 742e 636f  ror.openshift.co
-00029080: 6d2f 7075 622f 6f70 656e 7368 6966 742d  m/pub/openshift-
-00029090: 7634 2f64 6570 656e 6465 6e63 6965 732f  v4/dependencies/
-000290a0: 7268 636f 732f 7b69 736f 5f76 6572 7369  rhcos/{iso_versi
-000290b0: 6f6e 7d2f 6c61 7465 7374 220a 2020 2020  on}/latest".    
-000290c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000290d0: 6d65 7461 6c5f 7572 6c20 2b3d 2022 2f72  metal_url += "/r
-000290e0: 6863 6f73 2d6d 6574 616c 2e78 3836 5f36  hcos-metal.x86_6
-000290f0: 342e 7261 772e 677a 220a 2020 2020 2020  4.raw.gz".      
-00029100: 2020 2020 2020 2020 2020 2020 2020 7761                wa
-00029110: 726e 696e 6728 2245 6d62 6564 6469 6e67  rning("Embedding
-00029120: 206d 6574 616c 2075 726c 2069 6e20 6973   metal url in is
-00029130: 6f20 666f 7220 7461 7267 6574 2076 6572  o for target ver
-00029140: 7369 6f6e 2061 6e64 2069 6e73 7461 6c6c  sion and install
-00029150: 696e 6720 7769 7468 2061 206d 6f72 6520  ing with a more 
-00029160: 7265 6365 6e74 2069 736f 2229 0a20 2020  recent iso").   
-00029170: 2020 2020 2020 2020 2020 2020 2069 736f               iso
-00029180: 5f76 6572 7369 6f6e 203d 2027 6c61 7465  _version = 'late
-00029190: 7374 270a 2020 2020 2020 2020 6170 695f  st'.        api_
-000291a0: 6970 203d 206f 7665 7272 6964 6573 2e67  ip = overrides.g
-000291b0: 6574 2827 6170 695f 6970 2729 0a20 2020  et('api_ip').   
-000291c0: 2020 2020 2069 676e 6974 696f 6e5f 7665       ignition_ve
-000291d0: 7273 696f 6e20 3d20 6f76 6572 7269 6465  rsion = override
-000291e0: 732e 6765 7428 2769 676e 6974 696f 6e5f  s.get('ignition_
-000291f0: 7665 7273 696f 6e27 2c0a 2020 2020 2020  version',.      
-00029200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029220: 2020 2063 6f6d 6d6f 6e2e 6967 6e69 7469     common.igniti
-00029230: 6f6e 5f76 6572 7369 6f6e 2822 7268 636f  on_version("rhco
-00029240: 732d 2573 2220 2520 6973 6f5f 7665 7273  s-%s" % iso_vers
-00029250: 696f 6e2e 7265 706c 6163 6528 272e 272c  ion.replace('.',
-00029260: 2027 2729 2929 0a20 2020 2020 2020 2072   ''))).        r
-00029270: 6f6c 6520 3d20 6f76 6572 7269 6465 732e  ole = overrides.
-00029280: 6765 7428 2772 6f6c 6527 2c20 2777 6f72  get('role', 'wor
-00029290: 6b65 7227 290a 2020 2020 2020 2020 6973  ker').        is
-000292a0: 6f20 3d20 6f76 6572 7269 6465 732e 6765  o = overrides.ge
-000292b0: 7428 2769 736f 272c 2054 7275 6529 0a20  t('iso', True). 
-000292c0: 2020 2020 2020 2064 6f6d 6169 6e20 3d20         domain = 
-000292d0: 6f76 6572 7269 6465 732e 6765 7428 2764  overrides.get('d
-000292e0: 6f6d 6169 6e27 290a 2020 2020 2020 2020  omain').        
-000292f0: 6966 2027 2e27 2069 6e20 636c 7573 7465  if '.' in cluste
-00029300: 723a 0a20 2020 2020 2020 2020 2020 2064  r:.            d
-00029310: 6f6d 6169 6e20 3d20 272e 272e 6a6f 696e  omain = '.'.join
-00029320: 2863 6c75 7374 6572 2e73 706c 6974 2827  (cluster.split('
-00029330: 2e27 295b 313a 5d29 0a20 2020 2020 2020  .')[1:]).       
-00029340: 2020 2020 2070 7072 696e 7428 6622 5573       pprint(f"Us
-00029350: 696e 6720 646f 6d61 696e 207b 646f 6d61  ing domain {doma
-00029360: 696e 7d22 290a 2020 2020 2020 2020 2020  in}").          
-00029370: 2020 636c 7573 7465 7220 3d20 636c 7573    cluster = clus
-00029380: 7465 722e 7265 706c 6163 6528 6622 2e7b  ter.replace(f".{
-00029390: 646f 6d61 696e 7d22 2c20 2727 290a 2020  domain}", '').  
-000293a0: 2020 2020 2020 6966 2063 6c75 7374 6572        if cluster
-000293b0: 2e73 7461 7274 7377 6974 6828 2761 7069  .startswith('api
-000293c0: 2e27 293a 0a20 2020 2020 2020 2020 2020  .'):.           
-000293d0: 2063 6c75 7374 6572 203d 2063 6c75 7374   cluster = clust
-000293e0: 6572 2e72 6570 6c61 6365 2822 6170 692e  er.replace("api.
-000293f0: 222c 2027 2729 0a20 2020 2020 2020 2020  ", '').         
-00029400: 2020 2070 7072 696e 7428 6622 5573 696e     pprint(f"Usin
-00029410: 6720 636c 7573 7465 7220 7b63 6c75 7374  g cluster {clust
-00029420: 6572 7d22 290a 2020 2020 2020 2020 686f  er}").        ho
-00029430: 7374 735f 636f 6e74 656e 7420 3d20 4e6f  sts_content = No
-00029440: 6e65 0a20 2020 2020 2020 2066 696e 616c  ne.        final
-00029450: 6461 7461 203d 204e 6f6e 650a 2020 2020  data = None.    
-00029460: 2020 2020 6966 2069 676e 6974 696f 6e66      if ignitionf
-00029470: 696c 6520 6973 206e 6f74 204e 6f6e 653a  ile is not None:
-00029480: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00029490: 6e6f 7420 6f73 2e70 6174 682e 6578 6973  not os.path.exis
-000294a0: 7473 2869 676e 6974 696f 6e66 696c 6529  ts(ignitionfile)
-000294b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000294c0: 2020 6572 726f 7228 6622 7b69 676e 6974    error(f"{ignit
-000294d0: 696f 6e66 696c 657d 206e 6f74 2066 6f75  ionfile} not fou
-000294e0: 6e64 2229 0a20 2020 2020 2020 2020 2020  nd").           
-000294f0: 2020 2020 2073 7973 2e65 7869 7428 3129       sys.exit(1)
-00029500: 0a20 2020 2020 2020 2020 2020 2066 696e  .            fin
-00029510: 616c 6461 7461 203d 206f 7065 6e28 6967  aldata = open(ig
-00029520: 6e69 7469 6f6e 6669 6c65 292e 7265 6164  nitionfile).read
-00029530: 2829 0a20 2020 2020 2020 2065 6c73 653a  ().        else:
-00029540: 0a20 2020 2020 2020 2020 2020 2069 676e  .            ign
-00029550: 6974 696f 6e66 696c 6520 3d20 6622 7b72  itionfile = f"{r
-00029560: 6f6c 657d 2e69 676e 220a 2020 2020 2020  ole}.ign".      
-00029570: 2020 2020 2020 6966 206f 732e 7061 7468        if os.path
-00029580: 2e65 7869 7374 7328 6967 6e69 7469 6f6e  .exists(ignition
-00029590: 6669 6c65 293a 0a20 2020 2020 2020 2020  file):.         
-000295a0: 2020 2020 2020 2077 6172 6e69 6e67 2866         warning(f
-000295b0: 2255 7369 6e67 2065 7869 7374 696e 6720  "Using existing 
-000295c0: 7b69 676e 6974 696f 6e66 696c 657d 2229  {ignitionfile}")
-000295d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000295e0: 2066 696e 616c 6461 7461 203d 206f 7065   finaldata = ope
-000295f0: 6e28 6967 6e69 7469 6f6e 6669 6c65 292e  n(ignitionfile).
-00029600: 7265 6164 2829 0a20 2020 2020 2020 2020  read().         
-00029610: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00029620: 2020 2020 2020 2020 2069 6620 6170 695f           if api_
-00029630: 6970 2069 7320 4e6f 6e65 3a0a 2020 2020  ip is None:.    
-00029640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029650: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-00029660: 2020 2020 2020 2020 2020 2020 2061 7069               api
-00029670: 5f69 7020 3d20 736f 636b 6574 2e67 6574  _ip = socket.get
-00029680: 686f 7374 6279 6e61 6d65 2866 2761 7069  hostbyname(f'api
-00029690: 2e7b 636c 7573 7465 727d 2e7b 646f 6d61  .{cluster}.{doma
-000296a0: 696e 7d27 290a 2020 2020 2020 2020 2020  in}').          
-000296b0: 2020 2020 2020 2020 2020 6578 6365 7074            except
-000296c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000296d0: 2020 2020 2020 2020 2020 7061 7373 0a20            pass. 
-000296e0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000296f0: 6620 6170 695f 6970 2069 7320 4e6f 6e65  f api_ip is None
-00029700: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00029710: 2020 2020 2020 6966 2064 6f6d 6169 6e20        if domain 
-00029720: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-00029730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029740: 2065 7272 6f72 2822 436f 756c 646e 2774   error("Couldn't
-00029750: 2066 6967 7572 6520 6f75 7420 6170 695f   figure out api_
-00029760: 6970 206e 6f72 2072 656c 7920 6f6e 2064  ip nor rely on d
-00029770: 6e73 2073 696e 6365 2064 6f6d 6169 6e20  ns since domain 
-00029780: 6973 206e 6f74 2073 6574 2229 0a20 2020  is not set").   
-00029790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000297a0: 2020 2020 2073 7973 2e65 7869 7428 3129       sys.exit(1)
-000297b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000297c0: 2020 2020 2077 6172 6e69 6e67 2822 436f       warning("Co
-000297d0: 756c 646e 2774 2066 6967 7572 6520 6f75  uldn't figure ou
-000297e0: 7420 6170 695f 6970 2e20 5265 6c79 696e  t api_ip. Relyin
-000297f0: 6720 6f6e 2064 6e73 2229 0a20 2020 2020  g on dns").     
-00029800: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-00029810: 7069 5f69 7020 3d20 6622 6170 692e 7b63  pi_ip = f"api.{c
-00029820: 6c75 7374 6572 7d2e 7b64 6f6d 6169 6e7d  luster}.{domain}
-00029830: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00029840: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00029850: 2020 2020 2020 2020 2020 2020 686f 7374              host
-00029860: 735f 636f 6e74 656e 7420 3d20 2231 3237  s_content = "127
-00029870: 2e30 2e30 2e31 2020 206c 6f63 616c 686f  .0.0.1   localho
-00029880: 7374 206c 6f63 616c 686f 7374 2e6c 6f63  st localhost.loc
-00029890: 616c 646f 6d61 696e 206c 6f63 616c 686f  aldomain localho
-000298a0: 7374 3420 6c6f 6361 6c68 6f73 7434 2e6c  st4 localhost4.l
-000298b0: 6f63 616c 646f 6d61 696e 345c 6e22 0a20  ocaldomain4\n". 
-000298c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000298d0: 2020 2068 6f73 7473 5f63 6f6e 7465 6e74     hosts_content
-000298e0: 202b 3d20 223a 3a31 2020 2020 2020 2020   += "::1        
-000298f0: 206c 6f63 616c 686f 7374 206c 6f63 616c   localhost local
-00029900: 686f 7374 2e6c 6f63 616c 646f 6d61 696e  host.localdomain
-00029910: 206c 6f63 616c 686f 7374 3620 6c6f 6361   localhost6 loca
-00029920: 6c68 6f73 7436 2e6c 6f63 616c 646f 6d61  lhost6.localdoma
-00029930: 696e 365c 6e22 0a20 2020 2020 2020 2020  in6\n".         
-00029940: 2020 2020 2020 2020 2020 2068 6f73 7473             hosts
-00029950: 5f63 6f6e 7465 6e74 202b 3d20 6622 7b61  _content += f"{a
-00029960: 7069 5f69 707d 2061 7069 2d69 6e74 2e7b  pi_ip} api-int.{
-00029970: 636c 7573 7465 727d 2e7b 646f 6d61 696e  cluster}.{domain
-00029980: 7d20 6170 692e 7b63 6c75 7374 6572 7d2e  } api.{cluster}.
-00029990: 7b64 6f6d 6169 6e7d 220a 2020 2020 2020  {domain}".      
-000299a0: 2020 706c 616e 6469 7220 3d20 6f73 2e70    plandir = os.p
-000299b0: 6174 682e 6469 726e 616d 6528 6f70 656e  ath.dirname(open
-000299c0: 7368 6966 742e 6372 6561 7465 2e5f 5f63  shift.create.__c
-000299d0: 6f64 655f 5f2e 636f 5f66 696c 656e 616d  ode__.co_filenam
-000299e0: 6529 0a20 2020 2020 2020 2077 6974 6820  e).        with 
-000299f0: 6f70 656e 2822 6973 6f2e 6967 6e22 2c20  open("iso.ign", 
-00029a00: 2777 2729 2061 7320 663a 0a20 2020 2020  'w') as f:.     
-00029a10: 2020 2020 2020 2066 756c 6c5f 6e61 6d65         full_name
-00029a20: 203d 2066 277b 636c 7573 7465 727d 2e7b   = f'{cluster}.{
-00029a30: 646f 6d61 696e 7d27 2069 6620 646f 6d61  domain}' if doma
-00029a40: 696e 2069 7320 6e6f 7420 4e6f 6e65 2065  in is not None e
-00029a50: 6c73 6520 636c 7573 7465 720a 2020 2020  lse cluster.    
-00029a60: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
-00029a70: 2257 7269 7469 6e67 2066 696c 6520 6973  "Writing file is
-00029a80: 6f2e 6967 6e20 666f 7220 7b72 6f6c 657d  o.ign for {role}
-00029a90: 2069 6e20 7b66 756c 6c5f 6e61 6d65 7d22   in {full_name}"
-00029aa0: 290a 2020 2020 2020 2020 2020 2020 6973  ).            is
-00029ab0: 6f64 6972 203d 206f 732e 7061 7468 2e64  odir = os.path.d
-00029ac0: 6972 6e61 6d65 2863 6f6d 6d6f 6e2e 5f5f  irname(common.__
-00029ad0: 6669 6c65 5f5f 290a 2020 2020 2020 2020  file__).        
-00029ae0: 2020 2020 6966 2066 696e 616c 6461 7461      if finaldata
-00029af0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-00029b00: 2020 2020 2020 2020 2020 656e 7620 3d20            env = 
-00029b10: 456e 7669 726f 6e6d 656e 7428 6c6f 6164  Environment(load
-00029b20: 6572 3d46 696c 6553 7973 7465 6d4c 6f61  er=FileSystemLoa
-00029b30: 6465 7228 6973 6f64 6972 292c 2065 7874  der(isodir), ext
-00029b40: 656e 7369 6f6e 733d 5b27 6a69 6e6a 6132  ensions=['jinja2
-00029b50: 2e65 7874 2e64 6f27 5d2c 2074 7269 6d5f  .ext.do'], trim_
-00029b60: 626c 6f63 6b73 3d54 7275 652c 0a20 2020  blocks=True,.   
-00029b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029b80: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-00029b90: 7374 7269 705f 626c 6f63 6b73 3d54 7275  strip_blocks=Tru
-00029ba0: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-00029bb0: 2020 2074 656d 706c 203d 2065 6e76 2e67     templ = env.g
-00029bc0: 6574 5f74 656d 706c 6174 6528 6f73 2e70  et_template(os.p
-00029bd0: 6174 682e 6261 7365 6e61 6d65 2822 6967  ath.basename("ig
-00029be0: 6e69 7469 6f6e 2e6a 3222 2929 0a20 2020  nition.j2")).   
-00029bf0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00029c00: 686f 7374 735f 636f 6e74 656e 7420 6973  hosts_content is
-00029c10: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-00029c20: 2020 2020 2020 2020 2020 2020 2020 2068                 h
-00029c30: 6f73 7473 5f63 6f6e 7465 6e74 203d 2062  osts_content = b
-00029c40: 6173 6536 342e 6236 3465 6e63 6f64 6528  ase64.b64encode(
-00029c50: 686f 7374 735f 636f 6e74 656e 742e 656e  hosts_content.en
-00029c60: 636f 6465 2829 292e 6465 636f 6465 2822  code()).decode("
-00029c70: 5554 462d 3822 290a 2020 2020 2020 2020  UTF-8").        
-00029c80: 2020 2020 2020 2020 6966 2027 3a27 2069          if ':' i
-00029c90: 6e20 6170 695f 6970 3a20 2020 2320 4950  n api_ip:   # IP
-00029ca0: 7636 2061 6464 7265 7373 0a20 2020 2020  v6 address.     
-00029cb0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00029cc0: 676e 6974 696f 6e5f 7572 6c20 3d20 6622  gnition_url = f"
-00029cd0: 6874 7470 3a2f 2f5b 7b61 7069 5f69 707d  http://[{api_ip}
-00029ce0: 5d3a 3232 3632 342f 636f 6e66 6967 2f7b  ]:22624/config/{
-00029cf0: 726f 6c65 7d22 0a20 2020 2020 2020 2020  role}".         
-00029d00: 2020 2020 2020 2065 6c73 653a 2020 2020         else:    
-00029d10: 2020 2020 2020 2020 2020 2023 2049 5076             # IPv
-00029d20: 3420 6164 6472 6573 730a 2020 2020 2020  4 address.      
-00029d30: 2020 2020 2020 2020 2020 2020 2020 6967                ig
-00029d40: 6e69 7469 6f6e 5f75 726c 203d 2066 2268  nition_url = f"h
-00029d50: 7474 703a 2f2f 7b61 7069 5f69 707d 3a32  ttp://{api_ip}:2
-00029d60: 3236 3234 2f63 6f6e 6669 672f 7b72 6f6c  2624/config/{rol
-00029d70: 657d 220a 2020 2020 2020 2020 2020 2020  e}".            
-00029d80: 2020 2020 6669 6e61 6c64 6174 6120 3d20      finaldata = 
-00029d90: 7465 6d70 6c2e 7265 6e64 6572 2869 676e  templ.render(ign
-00029da0: 6974 696f 6e5f 7572 6c3d 6967 6e69 7469  ition_url=igniti
-00029db0: 6f6e 5f75 726c 2c20 686f 7374 735f 636f  on_url, hosts_co
-00029dc0: 6e74 656e 743d 686f 7374 735f 636f 6e74  ntent=hosts_cont
-00029dd0: 656e 742c 0a20 2020 2020 2020 2020 2020  ent,.           
-00029de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029df0: 2020 2020 2020 2020 2020 2020 2020 6967                ig
-00029e00: 6e69 7469 6f6e 5f76 6572 7369 6f6e 3d69  nition_version=i
-00029e10: 676e 6974 696f 6e5f 7665 7273 696f 6e29  gnition_version)
-00029e20: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00029e30: 6469 7265 6374 3a0a 2020 2020 2020 2020  direct:.        
-00029e40: 2020 2020 2020 2020 662e 7772 6974 6528          f.write(
-00029e50: 6669 6e61 6c64 6174 6129 0a20 2020 2020  finaldata).     
-00029e60: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00029e70: 2020 2020 2020 2020 2020 2020 205f 6669               _fi
-00029e80: 6c65 7320 3d20 5b7b 2270 6174 6822 3a20  les = [{"path": 
-00029e90: 222f 726f 6f74 2f63 6f6e 6669 672e 6967  "/root/config.ig
-00029ea0: 6e22 2c20 2263 6f6e 7465 6e74 223a 2066  n", "content": f
-00029eb0: 696e 616c 6461 7461 7d5d 0a20 2020 2020  inaldata}].     
-00029ec0: 2020 2020 2020 2020 2020 2069 6620 6f73             if os
-00029ed0: 2e70 6174 682e 6578 6973 7473 2827 6973  .path.exists('is
-00029ee0: 6f2e 7368 2729 3a0a 2020 2020 2020 2020  o.sh'):.        
-00029ef0: 2020 2020 2020 2020 2020 2020 7070 7269              ppri
-00029f00: 6e74 2822 5573 696e 6720 6c6f 6361 6c20  nt("Using local 
-00029f10: 6973 6f2e 7368 2073 6372 6970 7422 290a  iso.sh script").
-00029f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029f30: 2020 2020 6973 6f73 6372 6970 7420 3d20      isoscript = 
-00029f40: 2769 736f 2e73 6827 0a20 2020 2020 2020  'iso.sh'.       
-00029f50: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-00029f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029f70: 2020 2069 736f 7363 7269 7074 203d 2066     isoscript = f
-00029f80: 277b 706c 616e 6469 727d 2f69 736f 2e73  '{plandir}/iso.s
-00029f90: 6827 0a20 2020 2020 2020 2020 2020 2020  h'.             
-00029fa0: 2020 2069 6620 6f73 2e70 6174 682e 6578     if os.path.ex
-00029fb0: 6973 7473 2827 6d61 6373 2e74 7874 2729  ists('macs.txt')
-00029fc0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00029fd0: 2020 2020 2020 5f66 696c 6573 2e61 7070        _files.app
-00029fe0: 656e 6428 7b22 7061 7468 223a 2022 2f72  end({"path": "/r
-00029ff0: 6f6f 742f 6d61 6373 2e74 7874 222c 2022  oot/macs.txt", "
-0002a000: 6f72 6967 696e 223a 2027 6d61 6373 2e74  origin": 'macs.t
-0002a010: 7874 277d 290a 2020 2020 2020 2020 2020  xt'}).          
-0002a020: 2020 2020 2020 6973 6f5f 6f76 6572 7269        iso_overri
-0002a030: 6465 7320 3d20 7b27 7363 7269 7074 7327  des = {'scripts'
-0002a040: 3a20 5b69 736f 7363 7269 7074 5d2c 2027  : [isoscript], '
-0002a050: 6669 6c65 7327 3a20 5f66 696c 6573 2c20  files': _files, 
-0002a060: 276d 6574 616c 5f75 726c 273a 206d 6574  'metal_url': met
-0002a070: 616c 5f75 726c 2c20 276e 6f6e 616d 6527  al_url, 'noname'
-0002a080: 3a20 5472 7565 2c0a 2020 2020 2020 2020  : True,.        
-0002a090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a0a0: 2020 2020 2020 2020 2027 696d 6167 6527           'image'
-0002a0b0: 3a20 2772 6863 6f73 3430 3030 277d 0a20  : 'rhcos4000'}. 
-0002a0c0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0002a0d0: 6620 6d65 7461 6c5f 7572 6c20 6973 206e  f metal_url is n
-0002a0e0: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-0002a0f0: 2020 2020 2020 2020 2020 2020 2069 736f               iso
-0002a100: 5f6f 7665 7272 6964 6573 5b27 6e65 6564  _overrides['need
-0002a110: 5f6e 6574 776f 726b 275d 203d 2054 7275  _network'] = Tru
-0002a120: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-0002a130: 2020 6973 6f5f 6f76 6572 7269 6465 732e    iso_overrides.
-0002a140: 7570 6461 7465 286f 7665 7272 6964 6573  update(overrides
-0002a150: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0002a160: 2020 6966 2027 6e61 6d65 2720 696e 206f    if 'name' in o
-0002a170: 7665 7272 6964 6573 3a0a 2020 2020 2020  verrides:.      
-0002a180: 2020 2020 2020 2020 2020 2020 2020 6973                is
-0002a190: 6f5f 6e61 6d65 203d 206f 7665 7272 6964  o_name = overrid
-0002a1a0: 6573 5b27 6e61 6d65 275d 0a20 2020 2020  es['name'].     
-0002a1b0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0002a1c0: 736f 5f6f 7665 7272 6964 6573 5b27 6e6f  so_overrides['no
-0002a1d0: 6e61 6d65 275d 203d 2046 616c 7365 0a20  name'] = False. 
-0002a1e0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0002a1f0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0002a200: 2020 2020 2020 2020 2069 736f 5f6e 616d           iso_nam
-0002a210: 6520 3d20 2761 7574 6f69 6e73 7461 6c6c  e = 'autoinstall
-0002a220: 6572 270a 2020 2020 2020 2020 2020 2020  er'.            
-0002a230: 2020 2020 7265 7375 6c74 203d 2073 656c      result = sel
-0002a240: 662e 6372 6561 7465 5f76 6d28 6973 6f5f  f.create_vm(iso_
-0002a250: 6e61 6d65 2c20 6f76 6572 7269 6465 733d  name, overrides=
-0002a260: 6973 6f5f 6f76 6572 7269 6465 732c 206f  iso_overrides, o
-0002a270: 6e6c 7961 7373 6574 733d 5472 7565 290a  nlyassets=True).
-0002a280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a290: 6966 2027 7265 6173 6f6e 2720 696e 2072  if 'reason' in r
-0002a2a0: 6573 756c 743a 0a20 2020 2020 2020 2020  esult:.         
-0002a2b0: 2020 2020 2020 2020 2020 2065 7272 6f72             error
-0002a2c0: 2872 6573 756c 745b 2772 6561 736f 6e27  (result['reason'
-0002a2d0: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
-0002a2e0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0002a2f0: 2020 2020 2020 2020 2020 2020 2066 2e77               f.w
-0002a300: 7269 7465 2872 6573 756c 745b 2775 7365  rite(result['use
-0002a310: 7264 6174 6127 5d29 0a20 2020 2020 2020  rdata']).       
-0002a320: 2069 6620 6973 6f3a 0a20 2020 2020 2020   if iso:.       
-0002a330: 2020 2020 2069 6620 7365 6c66 2e74 7970       if self.typ
-0002a340: 6520 6e6f 7420 696e 205b 276b 766d 272c  e not in ['kvm',
-0002a350: 2027 6661 6b65 272c 2027 6b75 6265 7669   'fake', 'kubevi
-0002a360: 7274 272c 2027 7673 7068 6572 6527 2c20  rt', 'vsphere', 
-0002a370: 276f 7065 6e73 7461 636b 275d 3a0a 2020  'openstack']:.  
-0002a380: 2020 2020 2020 2020 2020 2020 2020 7761                wa
-0002a390: 726e 696e 6728 6622 4973 6f20 6765 6e65  rning(f"Iso gene
-0002a3a0: 7261 7469 6f6e 206e 6f74 2073 7570 706f  ration not suppo
-0002a3b0: 7274 6564 206f 6e20 7b73 656c 662e 7479  rted on {self.ty
-0002a3c0: 7065 7d22 290a 2020 2020 2020 2020 2020  pe}").          
-0002a3d0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0002a3e0: 2020 2020 2020 2020 6973 6f5f 706f 6f6c          iso_pool
-0002a3f0: 203d 206f 7665 7272 6964 6573 2e67 6574   = overrides.get
-0002a400: 2827 706f 6f6c 2729 206f 7220 7365 6c66  ('pool') or self
-0002a410: 2e70 6f6f 6c0a 2020 2020 2020 2020 2020  .pool.          
-0002a420: 2020 2020 2020 6765 6e65 7261 7465 5f72        generate_r
-0002a430: 6863 6f73 5f69 736f 2873 656c 662e 6b2c  hcos_iso(self.k,
-0002a440: 2066 227b 636c 7573 7465 727d 2d7b 726f   f"{cluster}-{ro
-0002a450: 6c65 7d22 2c20 6973 6f5f 706f 6f6c 2c20  le}", iso_pool, 
-0002a460: 7665 7273 696f 6e3d 6973 6f5f 7665 7273  version=iso_vers
-0002a470: 696f 6e2c 2070 6f64 6d61 6e3d 706f 646d  ion, podman=podm
-0002a480: 616e 2c0a 2020 2020 2020 2020 2020 2020  an,.            
-0002a490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a4a0: 2020 2020 2020 2069 6e73 7461 6c6c 6572         installer
-0002a4b0: 3d69 6e73 7461 6c6c 6572 290a 0a20 2020  =installer)..   
-0002a4c0: 2064 6566 2063 7265 6174 655f 6f70 656e   def create_open
-0002a4d0: 7368 6966 745f 6469 7363 6f6e 6e65 6374  shift_disconnect
-0002a4e0: 6564 2873 656c 662c 2070 6c61 6e2c 206f  ed(self, plan, o
-0002a4f0: 7665 7272 6964 6573 3d7b 7d29 3a0a 2020  verrides={}):.  
-0002a500: 2020 2020 2020 6461 7461 203d 206f 7665        data = ove
-0002a510: 7272 6964 6573 0a20 2020 2020 2020 2070  rrides.        p
-0002a520: 6c61 6e64 6972 203d 206f 732e 7061 7468  landir = os.path
-0002a530: 2e64 6972 6e61 6d65 286f 7065 6e73 6869  .dirname(openshi
-0002a540: 6674 2e63 7265 6174 652e 5f5f 636f 6465  ft.create.__code
-0002a550: 5f5f 2e63 6f5f 6669 6c65 6e61 6d65 290a  __.co_filename).
-0002a560: 2020 2020 2020 2020 636c 7573 7465 7220          cluster 
-0002a570: 3d20 6461 7461 2e67 6574 2827 636c 7573  = data.get('clus
-0002a580: 7465 7227 2c20 276d 796f 7065 6e73 6869  ter', 'myopenshi
-0002a590: 6674 2729 0a20 2020 2020 2020 2075 7073  ft').        ups
-0002a5a0: 7472 6561 6d20 3d20 6461 7461 2e67 6574  tream = data.get
-0002a5b0: 2827 7570 7374 7265 616d 272c 2046 616c  ('upstream', Fal
-0002a5c0: 7365 290a 2020 2020 2020 2020 7665 7273  se).        vers
-0002a5d0: 696f 6e20 3d20 6461 7461 2e67 6574 2827  ion = data.get('
-0002a5e0: 7665 7273 696f 6e27 2c20 2773 7461 626c  version', 'stabl
-0002a5f0: 6527 290a 2020 2020 2020 2020 7461 6720  e').        tag 
-0002a600: 3d20 6461 7461 2e67 6574 2827 7461 6727  = data.get('tag'
-0002a610: 2c20 4f50 454e 5348 4946 545f 5441 4729  , OPENSHIFT_TAG)
-0002a620: 0a20 2020 2020 2020 2070 7072 696e 7428  .        pprint(
-0002a630: 6622 5573 696e 6720 7665 7273 696f 6e20  f"Using version 
-0002a640: 7b76 6572 7369 6f6e 7d20 616e 6420 7461  {version} and ta
-0002a650: 6720 7b74 6167 7d22 290a 2020 2020 2020  g {tag}").      
-0002a660: 2020 6469 7363 6f6e 6e65 6374 6564 5f76    disconnected_v
-0002a670: 6d20 3d20 6622 7b63 6c75 7374 6572 7d2d  m = f"{cluster}-
-0002a680: 6469 7363 6f6e 6e65 6374 6564 220a 2020  disconnected".  
-0002a690: 2020 2020 2020 6469 7363 6f6e 6e65 6374        disconnect
-0002a6a0: 6564 5f72 6575 7365 203d 2064 6174 612e  ed_reuse = data.
-0002a6b0: 6765 7428 2764 6973 636f 6e6e 6563 7465  get('disconnecte
-0002a6c0: 645f 7265 7573 6527 2c20 4661 6c73 6529  d_reuse', False)
-0002a6d0: 0a20 2020 2020 2020 2064 6973 636f 6e6e  .        disconn
-0002a6e0: 6563 7465 645f 7379 6e63 203d 2064 6174  ected_sync = dat
-0002a6f0: 612e 6765 7428 2764 6973 636f 6e6e 6563  a.get('disconnec
-0002a700: 7465 645f 7379 6e63 272c 2054 7275 6529  ted_sync', True)
-0002a710: 0a20 2020 2020 2020 2070 7072 696e 7428  .        pprint(
-0002a720: 6622 4465 706c 6f79 696e 6720 6469 7363  f"Deploying disc
-0002a730: 6f6e 6e65 6374 6564 2076 6d20 7b64 6973  onnected vm {dis
-0002a740: 636f 6e6e 6563 7465 645f 766d 7d22 290a  connected_vm}").
-0002a750: 2020 2020 2020 2020 6966 2064 6973 636f          if disco
-0002a760: 6e6e 6563 7465 645f 7379 6e63 3a0a 2020  nnected_sync:.  
-0002a770: 2020 2020 2020 2020 2020 7075 6c6c 5f73            pull_s
-0002a780: 6563 7265 7420 3d20 7077 645f 7061 7468  ecret = pwd_path
-0002a790: 2864 6174 612e 6765 7428 2770 756c 6c5f  (data.get('pull_
-0002a7a0: 7365 6372 6574 2729 2920 6966 206e 6f74  secret')) if not
-0002a7b0: 2075 7073 7472 6561 6d20 656c 7365 2066   upstream else f
-0002a7c0: 227b 706c 616e 6469 727d 2f66 616b 655f  "{plandir}/fake_
-0002a7d0: 7075 6c6c 2e6a 736f 6e22 0a20 2020 2020  pull.json".     
-0002a7e0: 2020 2020 2020 2069 6620 6e6f 7420 7570         if not up
-0002a7f0: 7374 7265 616d 3a0a 2020 2020 2020 2020  stream:.        
-0002a800: 2020 2020 2020 2020 7075 6c6c 5f73 6563          pull_sec
-0002a810: 7265 7420 3d20 7077 645f 7061 7468 2864  ret = pwd_path(d
-0002a820: 6174 612e 6765 7428 2770 756c 6c5f 7365  ata.get('pull_se
-0002a830: 6372 6574 272c 2027 6f70 656e 7368 6966  cret', 'openshif
-0002a840: 745f 7075 6c6c 2e6a 736f 6e27 2929 0a20  t_pull.json')). 
-0002a850: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0002a860: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002a870: 2070 756c 6c5f 7365 6372 6574 203d 2066   pull_secret = f
-0002a880: 227b 706c 616e 6469 727d 2f66 616b 655f  "{plandir}/fake_
-0002a890: 7075 6c6c 2e6a 736f 6e22 0a20 2020 2020  pull.json".     
-0002a8a0: 2020 2020 2020 2069 6620 6e6f 7420 6f73         if not os
-0002a8b0: 2e70 6174 682e 6578 6973 7473 2870 756c  .path.exists(pul
-0002a8c0: 6c5f 7365 6372 6574 293a 0a20 2020 2020  l_secret):.     
-0002a8d0: 2020 2020 2020 2020 2020 2065 7272 6f72             error
-0002a8e0: 2866 224d 6973 7369 6e67 2070 756c 6c20  (f"Missing pull 
-0002a8f0: 7365 6372 6574 2066 696c 6520 7b70 756c  secret file {pul
-0002a900: 6c5f 7365 6372 6574 7d22 290a 2020 2020  l_secret}").    
-0002a910: 2020 2020 2020 2020 2020 2020 7379 732e              sys.
-0002a920: 6578 6974 2831 290a 2020 2020 2020 2020  exit(1).        
-0002a930: 2020 2020 6461 7461 5b27 7075 6c6c 5f73      data['pull_s
-0002a940: 6563 7265 7427 5d20 3d20 7265 2e73 7562  ecret'] = re.sub
-0002a950: 2872 225c 7322 2c20 2222 2c20 6f70 656e  (r"\s", "", open
-0002a960: 2870 756c 6c5f 7365 6372 6574 292e 7265  (pull_secret).re
-0002a970: 6164 2829 290a 2020 2020 2020 2020 6469  ad()).        di
-0002a980: 7363 6f6e 6e65 6374 6564 5f70 6c61 6e20  sconnected_plan 
-0002a990: 3d20 6622 7b70 6c61 6e7d 2d72 6575 7365  = f"{plan}-reuse
-0002a9a0: 2220 6966 2064 6973 636f 6e6e 6563 7465  " if disconnecte
-0002a9b0: 645f 7265 7573 6520 656c 7365 2070 6c61  d_reuse else pla
-0002a9c0: 6e0a 2020 2020 2020 2020 6966 2076 6572  n.        if ver
-0002a9d0: 7369 6f6e 203d 3d20 2763 6927 2061 6e64  sion == 'ci' and
-0002a9e0: 2027 6469 7363 6f6e 6e65 6374 6564 5f6f   'disconnected_o
-0002a9f0: 7269 6769 6e27 206e 6f74 2069 6e20 6f76  rigin' not in ov
-0002aa00: 6572 7269 6465 733a 0a20 2020 2020 2020  errides:.       
-0002aa10: 2020 2020 2072 6567 203d 2027 7265 6769       reg = 'regi
-0002aa20: 7374 7279 2e62 7569 6c64 3031 2e63 692e  stry.build01.ci.
-0002aa30: 6f70 656e 7368 6966 742e 6f72 6727 2069  openshift.org' i
-0002aa40: 6620 7374 7228 7461 6729 2e73 7461 7274  f str(tag).start
-0002aa50: 7377 6974 6828 2763 692d 2729 2065 6c73  swith('ci-') els
-0002aa60: 6520 2772 6567 6973 7472 792e 6369 2e6f  e 'registry.ci.o
-0002aa70: 7065 6e73 6869 6674 2e6f 7267 270a 2020  penshift.org'.  
-0002aa80: 2020 2020 2020 2020 2020 7761 726e 696e            warnin
-0002aa90: 6728 6622 466f 7263 696e 6720 6469 7363  g(f"Forcing disc
-0002aaa0: 6f6e 6e65 6374 6564 5f6f 7269 6769 6e20  onnected_origin 
-0002aab0: 746f 207b 7265 677d 2229 0a20 2020 2020  to {reg}").     
-0002aac0: 2020 2020 2020 2064 6174 615b 2764 6973         data['dis
-0002aad0: 636f 6e6e 6563 7465 645f 6f72 6967 696e  connected_origin
-0002aae0: 275d 203d 2072 6567 0a20 2020 2020 2020  '] = reg.       
-0002aaf0: 2072 6573 756c 7420 3d20 7365 6c66 2e70   result = self.p
-0002ab00: 6c61 6e28 6469 7363 6f6e 6e65 6374 6564  lan(disconnected
-0002ab10: 5f70 6c61 6e2c 2069 6e70 7574 6669 6c65  _plan, inputfile
-0002ab20: 3d66 277b 706c 616e 6469 727d 2f64 6973  =f'{plandir}/dis
-0002ab30: 636f 6e6e 6563 7465 642e 796d 6c27 2c20  connected.yml', 
-0002ab40: 6f76 6572 7269 6465 733d 6461 7461 290a  overrides=data).
-0002ab50: 2020 2020 2020 2020 6966 2072 6573 756c          if resul
-0002ab60: 745b 2772 6573 756c 7427 5d20 213d 2027  t['result'] != '
-0002ab70: 7375 6363 6573 7327 3a0a 2020 2020 2020  success':.      
-0002ab80: 2020 2020 2020 7379 732e 6578 6974 2831        sys.exit(1
-0002ab90: 290a 2020 2020 2020 2020 656c 6966 2064  ).        elif d
-0002aba0: 6973 636f 6e6e 6563 7465 645f 7379 6e63  isconnected_sync
-0002abb0: 3a0a 2020 2020 2020 2020 2020 2020 7070  :.            pp
-0002abc0: 7269 6e74 2822 5573 6520 7468 6520 666f  rint("Use the fo
-0002abd0: 6c6c 6f77 696e 6720 4f50 454e 5348 4946  llowing OPENSHIF
-0002abe0: 545f 494e 5354 414c 4c5f 5245 4c45 4153  T_INSTALL_RELEAS
-0002abf0: 455f 494d 4147 455f 4f56 4552 5249 4445  E_IMAGE_OVERRIDE
-0002ac00: 2229 0a20 2020 2020 2020 2020 2020 206e  ").            n
-0002ac10: 616d 6520 3d20 6461 7461 2e67 6574 2827  ame = data.get('
-0002ac20: 6469 7363 6f6e 6e65 6374 6564 5f72 6575  disconnected_reu
-0002ac30: 7365 5f6e 616d 6527 2920 6f72 2063 6c75  se_name') or clu
-0002ac40: 7374 6572 0a20 2020 2020 2020 2020 2020  ster.           
-0002ac50: 2069 702c 2076 6d70 6f72 7420 3d20 5f73   ip, vmport = _s
-0002ac60: 7368 5f63 7265 6465 6e74 6961 6c73 2873  sh_credentials(s
-0002ac70: 656c 662e 6b2c 2066 277b 6e61 6d65 7d2d  elf.k, f'{name}-
-0002ac80: 6469 7363 6f6e 6e65 6374 6564 2729 5b31  disconnected')[1
-0002ac90: 3a5d 0a20 2020 2020 2020 2020 2020 2063  :].            c
-0002aca0: 6d64 203d 2022 6361 7420 2f72 6f6f 742f  md = "cat /root/
-0002acb0: 7665 7273 696f 6e2e 7478 7422 0a20 2020  version.txt".   
-0002acc0: 2020 2020 2020 2020 2073 7368 636d 6420           sshcmd 
-0002acd0: 3d20 7373 6828 6e61 6d65 2c20 6970 3d69  = ssh(name, ip=i
-0002ace0: 702c 2075 7365 723d 2772 6f6f 7427 2c20  p, user='root', 
-0002acf0: 7475 6e6e 656c 3d73 656c 662e 7475 6e6e  tunnel=self.tunn
-0002ad00: 656c 2c0a 2020 2020 2020 2020 2020 2020  el,.            
-0002ad10: 2020 2020 2020 2020 2020 2020 2074 756e               tun
-0002ad20: 6e65 6c68 6f73 743d 7365 6c66 2e74 756e  nelhost=self.tun
-0002ad30: 6e65 6c68 6f73 742c 2074 756e 6e65 6c70  nelhost, tunnelp
-0002ad40: 6f72 743d 7365 6c66 2e74 756e 6e65 6c70  ort=self.tunnelp
-0002ad50: 6f72 742c 0a20 2020 2020 2020 2020 2020  ort,.           
-0002ad60: 2020 2020 2020 2020 2020 2020 2020 7475                tu
-0002ad70: 6e6e 656c 7573 6572 3d73 656c 662e 7475  nneluser=self.tu
-0002ad80: 6e6e 656c 7573 6572 2c20 696e 7365 6375  nneluser, insecu
-0002ad90: 7265 3d54 7275 652c 2063 6d64 3d63 6d64  re=True, cmd=cmd
-0002ada0: 2c20 766d 706f 7274 3d76 6d70 6f72 7429  , vmport=vmport)
-0002adb0: 0a20 2020 2020 2020 2020 2020 206f 732e  .            os.
-0002adc0: 7379 7374 656d 2873 7368 636d 6429 0a0a  system(sshcmd)..
-0002add0: 2020 2020 6465 6620 6861 6e64 6c65 5f66      def handle_f
-0002ade0: 696e 6973 6866 696c 6573 2873 656c 662c  inishfiles(self,
-0002adf0: 206e 616d 652c 2066 696e 6973 6866 696c   name, finishfil
-0002ae00: 6573 2c20 6964 656e 7469 7479 6669 6c65  es, identityfile
-0002ae10: 3d4e 6f6e 652c 2076 6d63 6c69 656e 743d  =None, vmclient=
-0002ae20: 4e6f 6e65 293a 0a20 2020 2020 2020 2063  None):.        c
-0002ae30: 6f6e 6669 6720 3d20 4b63 6f6e 6669 6728  onfig = Kconfig(
-0002ae40: 636c 6965 6e74 3d76 6d63 6c69 656e 7429  client=vmclient)
-0002ae50: 2069 6620 766d 636c 6965 6e74 2069 7320   if vmclient is 
-0002ae60: 6e6f 7420 4e6f 6e65 2065 6c73 6520 7365  not None else se
-0002ae70: 6c66 0a20 2020 2020 2020 206b 203d 2063  lf.        k = c
-0002ae80: 6f6e 6669 672e 6b0a 2020 2020 2020 2020  onfig.k.        
-0002ae90: 6375 7272 656e 745f 6970 203d 2063 6f6d  current_ip = com
-0002aea0: 6d6f 6e2e 5f73 7368 5f63 7265 6465 6e74  mon._ssh_credent
-0002aeb0: 6961 6c73 286b 2c20 6e61 6d65 295b 315d  ials(k, name)[1]
-0002aec0: 0a20 2020 2020 2020 2066 6f72 2066 696e  .        for fin
-0002aed0: 6973 6866 696c 6520 696e 2066 696e 6973  ishfile in finis
-0002aee0: 6866 696c 6573 3a0a 2020 2020 2020 2020  hfiles:.        
-0002aef0: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-0002af00: 6528 6669 6e69 7368 6669 6c65 2c20 7374  e(finishfile, st
-0002af10: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
-0002af20: 2020 2020 6465 7374 696e 6174 696f 6e20      destination 
-0002af30: 3d20 272e 270a 2020 2020 2020 2020 2020  = '.'.          
-0002af40: 2020 2020 2020 736f 7572 6365 203d 2066        source = f
-0002af50: 696e 6973 6866 696c 6520 6966 2027 2f27  inishfile if '/'
-0002af60: 2069 6e20 6669 6e69 7368 6669 6c65 2065   in finishfile e
-0002af70: 6c73 6520 6627 2f72 6f6f 742f 7b66 696e  lse f'/root/{fin
-0002af80: 6973 6866 696c 657d 270a 2020 2020 2020  ishfile}'.      
-0002af90: 2020 2020 2020 656c 6966 2069 7369 6e73        elif isins
-0002afa0: 7461 6e63 6528 6669 6e69 7368 6669 6c65  tance(finishfile
-0002afb0: 2c20 6469 6374 2920 616e 6420 276f 7269  , dict) and 'ori
-0002afc0: 6769 6e27 2069 6e20 6669 6e69 7368 6669  gin' in finishfi
-0002afd0: 6c65 2061 6e64 2027 7061 7468 2720 696e  le and 'path' in
-0002afe0: 2066 696e 6973 6866 696c 653a 0a20 2020   finishfile:.   
-0002aff0: 2020 2020 2020 2020 2020 2020 2073 6f75               sou
-0002b000: 7263 652c 2064 6573 7469 6e61 7469 6f6e  rce, destination
-0002b010: 203d 2066 696e 6973 6866 696c 652e 6765   = finishfile.ge
-0002b020: 7428 276f 7269 6769 6e27 292c 206f 732e  t('origin'), os.
-0002b030: 7061 7468 2e65 7870 616e 6475 7365 7228  path.expanduser(
-0002b040: 6669 6e69 7368 6669 6c65 2e67 6574 2827  finishfile.get('
-0002b050: 7061 7468 272c 2027 2e27 2929 0a20 2020  path', '.')).   
-0002b060: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-0002b070: 2020 2020 2020 2020 2020 2020 2020 2077                 w
-0002b080: 6172 6e69 6e67 2866 2249 6e63 6f72 7265  arning(f"Incorre
-0002b090: 6374 2066 696e 6973 6866 696c 6520 656e  ct finishfile en
-0002b0a0: 7472 7920 7b66 696e 6973 6866 696c 657d  try {finishfile}
-0002b0b0: 2e20 536b 6970 7069 6e67 2229 0a20 2020  . Skipping").   
-0002b0c0: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-0002b0d0: 7469 6e75 650a 2020 2020 2020 2020 2020  tinue.          
-0002b0e0: 2020 7363 7063 6d64 203d 2063 6f6d 6d6f    scpcmd = commo
-0002b0f0: 6e2e 7363 7028 6e61 6d65 2c20 6970 3d63  n.scp(name, ip=c
-0002b100: 7572 7265 6e74 5f69 702c 2075 7365 723d  urrent_ip, user=
-0002b110: 2772 6f6f 7427 2c20 736f 7572 6365 3d73  'root', source=s
-0002b120: 6f75 7263 652c 2064 6573 7469 6e61 7469  ource, destinati
-0002b130: 6f6e 3d64 6573 7469 6e61 7469 6f6e 2c0a  on=destination,.
-0002b140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b160: 7475 6e6e 656c 3d63 6f6e 6669 672e 7475  tunnel=config.tu
-0002b170: 6e6e 656c 2c20 7475 6e6e 656c 686f 7374  nnel, tunnelhost
-0002b180: 3d63 6f6e 6669 672e 7475 6e6e 656c 686f  =config.tunnelho
-0002b190: 7374 2c20 7475 6e6e 656c 706f 7274 3d63  st, tunnelport=c
-0002b1a0: 6f6e 6669 672e 7475 6e6e 656c 706f 7274  onfig.tunnelport
-0002b1b0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0002b1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b1d0: 2020 7475 6e6e 656c 7573 6572 3d73 656c    tunneluser=sel
-0002b1e0: 662e 7475 6e6e 656c 7573 6572 2c20 646f  f.tunneluser, do
-0002b1f0: 776e 6c6f 6164 3d54 7275 652c 2069 6e73  wnload=True, ins
-0002b200: 6563 7572 653d 5472 7565 2c20 6964 656e  ecure=True, iden
-0002b210: 7469 7479 6669 6c65 3d69 6465 6e74 6974  tityfile=identit
-0002b220: 7966 696c 6529 0a20 2020 2020 2020 2020  yfile).         
-0002b230: 2020 206f 732e 7379 7374 656d 2873 6370     os.system(scp
-0002b240: 636d 6429 0a0a 2020 2020 6465 6620 6861  cmd)..    def ha
-0002b250: 6e64 6c65 5f6e 6f74 6966 6963 6174 696f  ndle_notificatio
-0002b260: 6e73 2873 656c 662c 206e 616d 652c 206e  ns(self, name, n
-0002b270: 6f74 6966 796d 6574 686f 6473 3d5b 5d2c  otifymethods=[],
-0002b280: 2070 7573 6862 756c 6c65 7474 6f6b 656e   pushbullettoken
-0002b290: 3d4e 6f6e 652c 206e 6f74 6966 7973 6372  =None, notifyscr
-0002b2a0: 6970 743d 4e6f 6e65 2c20 6e6f 7469 6679  ipt=None, notify
-0002b2b0: 636d 643d 4e6f 6e65 2c0a 2020 2020 2020  cmd=None,.      
-0002b2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b2d0: 2020 2020 2020 2073 6c61 636b 6368 616e         slackchan
-0002b2e0: 6e65 6c3d 4e6f 6e65 2c20 736c 6163 6b74  nel=None, slackt
-0002b2f0: 6f6b 656e 3d4e 6f6e 652c 206d 6169 6c73  oken=None, mails
-0002b300: 6572 7665 723d 4e6f 6e65 2c20 6d61 696c  erver=None, mail
-0002b310: 6672 6f6d 3d4e 6f6e 652c 206d 6169 6c74  from=None, mailt
-0002b320: 6f3d 4e6f 6e65 2c0a 2020 2020 2020 2020  o=None,.        
-0002b330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b340: 2020 2020 2063 6c75 7374 6572 3d46 616c       cluster=Fal
-0002b350: 7365 293a 0a20 2020 2020 2020 205f 7479  se):.        _ty
-0002b360: 7065 203d 2027 436c 7573 7465 7227 2069  pe = 'Cluster' i
-0002b370: 6620 636c 7573 7465 7220 656c 7365 2027  f cluster else '
-0002b380: 566d 270a 2020 2020 2020 2020 7469 746c  Vm'.        titl
-0002b390: 6520 3d20 6622 7b5f 7479 7065 7d20 7b6e  e = f"{_type} {n
-0002b3a0: 616d 657d 206f 6e20 7b73 656c 662e 636c  ame} on {self.cl
-0002b3b0: 6965 6e74 7d20 7265 706f 7274 220a 2020  ient} report".  
-0002b3c0: 2020 2020 2020 636d 6473 2c20 6d61 696c        cmds, mail
-0002b3d0: 636f 6e74 656e 7420 3d20 5b5d 2c20 4e6f  content = [], No
-0002b3e0: 6e65 0a20 2020 2020 2020 2066 6f72 206e  ne.        for n
-0002b3f0: 6f74 6966 796d 6574 686f 6420 696e 2073  otifymethod in s
-0002b400: 6f72 7465 6428 6e6f 7469 6679 6d65 7468  orted(notifymeth
-0002b410: 6f64 732c 2072 6576 6572 7365 3d54 7275  ods, reverse=Tru
-0002b420: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
-0002b430: 6966 206e 6f74 6966 796d 6574 686f 6420  if notifymethod 
-0002b440: 3d3d 2027 7075 7368 6275 6c6c 6574 273a  == 'pushbullet':
-0002b450: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002b460: 2069 6620 7075 7368 6275 6c6c 6574 746f   if pushbulletto
-0002b470: 6b65 6e20 6973 204e 6f6e 653a 0a20 2020  ken is None:.   
-0002b480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b490: 2077 6172 6e69 6e67 2866 224e 6f74 6966   warning(f"Notif
-0002b4a0: 6963 6174 696f 6e20 7265 7175 6972 6564  ication required
-0002b4b0: 2066 6f72 207b 6e61 6d65 7d20 6275 7420   for {name} but 
-0002b4c0: 6d69 7373 696e 6720 7075 7368 6275 6c6c  missing pushbull
-0002b4d0: 6574 746f 6b65 6e22 290a 2020 2020 2020  ettoken").      
-0002b4e0: 2020 2020 2020 2020 2020 656c 6966 206e            elif n
-0002b4f0: 6f74 6966 7973 6372 6970 7420 6973 204e  otifyscript is N
-0002b500: 6f6e 6520 616e 6420 6e6f 7469 6679 636d  one and notifycm
-0002b510: 6420 6973 204e 6f6e 653a 0a20 2020 2020  d is None:.     
-0002b520: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0002b530: 6f6e 7469 6e75 650a 2020 2020 2020 2020  ontinue.        
-0002b540: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0002b550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b560: 2020 746f 6b65 6e20 3d20 7075 7368 6275    token = pushbu
-0002b570: 6c6c 6574 746f 6b65 6e0a 2020 2020 2020  llettoken.      
-0002b580: 2020 2020 2020 2020 2020 2020 2020 7062                pb
-0002b590: 636d 6420 3d20 2763 7572 6c20 2d73 7520  cmd = 'curl -su 
-0002b5a0: 2225 733a 2220 2d64 2074 7970 653d 226e  "%s:" -d type="n
-0002b5b0: 6f74 6522 202d 6420 626f 6479 3d22 6025  ote" -d body="`%
-0002b5c0: 7320 323e 2631 6022 202d 6420 7469 746c  s 2>&1`" -d titl
-0002b5d0: 653d 2225 7322 2027 2025 2028 746f 6b65  e="%s" ' % (toke
-0002b5e0: 6e2c 0a20 2020 2020 2020 2020 2020 2020  n,.             
-0002b5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028b60: 2020 2020 2062 7265 616b 0a0a 2020 2020       break..    
+00028b70: 6465 6620 6578 706f 7365 5f70 6c61 6e28  def expose_plan(
+00028b80: 7365 6c66 2c20 706c 616e 2c20 696e 7075  self, plan, inpu
+00028b90: 7466 696c 653d 4e6f 6e65 2c20 6f76 6572  tfile=None, over
+00028ba0: 7269 6465 733d 7b7d 2c20 706f 7274 3d39  rides={}, port=9
+00028bb0: 3030 302c 2070 666d 6f64 653d 4661 6c73  000, pfmode=Fals
+00028bc0: 652c 2063 6c75 7374 6572 3d46 616c 7365  e, cluster=False
+00028bd0: 293a 0a20 2020 2020 2020 2069 6e70 7574  ):.        input
+00028be0: 6669 6c65 203d 206f 732e 7061 7468 2e65  file = os.path.e
+00028bf0: 7870 616e 6475 7365 7228 696e 7075 7466  xpanduser(inputf
+00028c00: 696c 6529 0a20 2020 2020 2020 2069 6620  ile).        if 
+00028c10: 6e6f 7420 6f73 2e70 6174 682e 6578 6973  not os.path.exis
+00028c20: 7473 2869 6e70 7574 6669 6c65 293a 0a20  ts(inputfile):. 
+00028c30: 2020 2020 2020 2020 2020 2065 7272 6f72             error
+00028c40: 2822 4e6f 2069 6e70 7574 2066 696c 6520  ("No input file 
+00028c50: 666f 756e 6420 6e6f 7220 6465 6661 756c  found nor defaul
+00028c60: 7420 6b63 6c69 5f70 6c61 6e2e 796d 6c2e  t kcli_plan.yml.
+00028c70: 4c65 6176 696e 672e 2e2e 2e22 290a 2020  Leaving....").  
+00028c80: 2020 2020 2020 2020 2020 7379 732e 6578            sys.ex
+00028c90: 6974 2831 290a 2020 2020 2020 2020 7070  it(1).        pp
+00028ca0: 7269 6e74 2866 2248 616e 646c 696e 6720  rint(f"Handling 
+00028cb0: 6578 706f 7365 206f 6620 706c 616e 2077  expose of plan w
+00028cc0: 6974 6820 6e61 6d65 207b 706c 616e 7d20  ith name {plan} 
+00028cd0: 616e 6420 696e 7075 7466 696c 6520 7b69  and inputfile {i
+00028ce0: 6e70 7574 6669 6c65 7d22 290a 2020 2020  nputfile}").    
+00028cf0: 2020 2020 6b65 7870 6f73 6572 203d 204b      kexposer = K
+00028d00: 6578 706f 7365 7228 7365 6c66 2c20 706c  exposer(self, pl
+00028d10: 616e 2c20 696e 7075 7466 696c 652c 206f  an, inputfile, o
+00028d20: 7665 7272 6964 6573 3d6f 7665 7272 6964  verrides=overrid
+00028d30: 6573 2c20 706f 7274 3d70 6f72 742c 2070  es, port=port, p
+00028d40: 666d 6f64 653d 7066 6d6f 6465 2c20 636c  fmode=pfmode, cl
+00028d50: 7573 7465 723d 636c 7573 7465 7229 0a20  uster=cluster). 
+00028d60: 2020 2020 2020 206b 6578 706f 7365 722e         kexposer.
+00028d70: 7275 6e28 290a 0a20 2020 2064 6566 2063  run()..    def c
+00028d80: 7265 6174 655f 6f70 656e 7368 6966 745f  reate_openshift_
+00028d90: 6973 6f28 7365 6c66 2c20 636c 7573 7465  iso(self, cluste
+00028da0: 722c 206f 7665 7272 6964 6573 3d7b 7d2c  r, overrides={},
+00028db0: 2069 676e 6974 696f 6e66 696c 653d 4e6f   ignitionfile=No
+00028dc0: 6e65 2c20 706f 646d 616e 3d46 616c 7365  ne, podman=False
+00028dd0: 2c20 696e 7374 616c 6c65 723d 4661 6c73  , installer=Fals
+00028de0: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+00028df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028e00: 6469 7265 6374 3d46 616c 7365 293a 0a20  direct=False):. 
+00028e10: 2020 2020 2020 206d 6574 616c 5f75 726c         metal_url
+00028e20: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
+00028e30: 6973 6f5f 7665 7273 696f 6e20 3d20 7374  iso_version = st
+00028e40: 7228 6f76 6572 7269 6465 732e 6765 7428  r(overrides.get(
+00028e50: 2776 6572 7369 6f6e 272c 2027 6c61 7465  'version', 'late
+00028e60: 7374 2729 290a 2020 2020 2020 2020 6966  st')).        if
+00028e70: 206e 6f74 2069 6e73 7461 6c6c 6572 3a0a   not installer:.
+00028e80: 2020 2020 2020 2020 2020 2020 6966 2069              if i
+00028e90: 736f 5f76 6572 7369 6f6e 206e 6f74 2069  so_version not i
+00028ea0: 6e20 5b27 6c61 7465 7374 272c 2027 7072  n ['latest', 'pr
+00028eb0: 652d 7265 6c65 6173 6527 5d20 616e 6420  e-release'] and 
+00028ec0: 6e6f 7420 6973 6f5f 7665 7273 696f 6e2e  not iso_version.
+00028ed0: 7374 6172 7473 7769 7468 2827 342e 2729  startswith('4.')
+00028ee0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00028ef0: 2020 7761 726e 696e 6728 2246 6f72 6369    warning("Forci
+00028f00: 6e67 206c 6976 6520 6973 6f20 7665 7273  ng live iso vers
+00028f10: 696f 6e20 746f 206c 6174 6573 7422 290a  ion to latest").
+00028f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028f30: 6973 6f5f 7665 7273 696f 6e20 3d20 276c  iso_version = 'l
+00028f40: 6174 6573 7427 0a20 2020 2020 2020 2020  atest'.         
+00028f50: 2020 2065 6c69 6620 6973 6f5f 7665 7273     elif iso_vers
+00028f60: 696f 6e2e 7374 6172 7473 7769 7468 2827  ion.startswith('
+00028f70: 342e 2729 3a0a 2020 2020 2020 2020 2020  4.'):.          
+00028f80: 2020 2020 2020 6d69 6e6f 725f 7665 7273        minor_vers
+00028f90: 696f 6e20 3d20 6973 6f5f 7665 7273 696f  ion = iso_versio
+00028fa0: 6e2e 7370 6c69 7428 272e 2729 5b31 5d0a  n.split('.')[1].
+00028fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028fc0: 6966 206d 696e 6f72 5f76 6572 7369 6f6e  if minor_version
+00028fd0: 2e69 7364 6967 6974 2829 2061 6e64 2069  .isdigit() and i
+00028fe0: 6e74 286d 696e 6f72 5f76 6572 7369 6f6e  nt(minor_version
+00028ff0: 2920 3c20 363a 0a20 2020 2020 2020 2020  ) < 6:.         
+00029000: 2020 2020 2020 2020 2020 206d 6574 616c             metal
+00029010: 5f75 726c 203d 2066 2268 7474 7073 3a2f  _url = f"https:/
+00029020: 2f6d 6972 726f 722e 6f70 656e 7368 6966  /mirror.openshif
+00029030: 742e 636f 6d2f 7075 622f 6f70 656e 7368  t.com/pub/opensh
+00029040: 6966 742d 7634 2f64 6570 656e 6465 6e63  ift-v4/dependenc
+00029050: 6965 732f 7268 636f 732f 7b69 736f 5f76  ies/rhcos/{iso_v
+00029060: 6572 7369 6f6e 7d2f 6c61 7465 7374 220a  ersion}/latest".
+00029070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029080: 2020 2020 6d65 7461 6c5f 7572 6c20 2b3d      metal_url +=
+00029090: 2022 2f72 6863 6f73 2d6d 6574 616c 2e78   "/rhcos-metal.x
+000290a0: 3836 5f36 342e 7261 772e 677a 220a 2020  86_64.raw.gz".  
+000290b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000290c0: 2020 7761 726e 696e 6728 2245 6d62 6564    warning("Embed
+000290d0: 6469 6e67 206d 6574 616c 2075 726c 2069  ding metal url i
+000290e0: 6e20 6973 6f20 666f 7220 7461 7267 6574  n iso for target
+000290f0: 2076 6572 7369 6f6e 2061 6e64 2069 6e73   version and ins
+00029100: 7461 6c6c 696e 6720 7769 7468 2061 206d  talling with a m
+00029110: 6f72 6520 7265 6365 6e74 2069 736f 2229  ore recent iso")
+00029120: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00029130: 2069 736f 5f76 6572 7369 6f6e 203d 2027   iso_version = '
+00029140: 6c61 7465 7374 270a 2020 2020 2020 2020  latest'.        
+00029150: 6170 695f 6970 203d 206f 7665 7272 6964  api_ip = overrid
+00029160: 6573 2e67 6574 2827 6170 695f 6970 2729  es.get('api_ip')
+00029170: 0a20 2020 2020 2020 2069 676e 6974 696f  .        ignitio
+00029180: 6e5f 7665 7273 696f 6e20 3d20 6f76 6572  n_version = over
+00029190: 7269 6465 732e 6765 7428 2769 676e 6974  rides.get('ignit
+000291a0: 696f 6e5f 7665 7273 696f 6e27 2c0a 2020  ion_version',.  
+000291b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000291c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000291d0: 2020 2020 2020 2063 6f6d 6d6f 6e2e 6967         common.ig
+000291e0: 6e69 7469 6f6e 5f76 6572 7369 6f6e 2822  nition_version("
+000291f0: 7268 636f 732d 2573 2220 2520 6973 6f5f  rhcos-%s" % iso_
+00029200: 7665 7273 696f 6e2e 7265 706c 6163 6528  version.replace(
+00029210: 272e 272c 2027 2729 2929 0a20 2020 2020  '.', ''))).     
+00029220: 2020 2072 6f6c 6520 3d20 6f76 6572 7269     role = overri
+00029230: 6465 732e 6765 7428 2772 6f6c 6527 2c20  des.get('role', 
+00029240: 2777 6f72 6b65 7227 290a 2020 2020 2020  'worker').      
+00029250: 2020 6973 6f20 3d20 6f76 6572 7269 6465    iso = override
+00029260: 732e 6765 7428 2769 736f 272c 2054 7275  s.get('iso', Tru
+00029270: 6529 0a20 2020 2020 2020 2064 6f6d 6169  e).        domai
+00029280: 6e20 3d20 6f76 6572 7269 6465 732e 6765  n = overrides.ge
+00029290: 7428 2764 6f6d 6169 6e27 290a 2020 2020  t('domain').    
+000292a0: 2020 2020 6966 2027 2e27 2069 6e20 636c      if '.' in cl
+000292b0: 7573 7465 723a 0a20 2020 2020 2020 2020  uster:.         
+000292c0: 2020 2064 6f6d 6169 6e20 3d20 272e 272e     domain = '.'.
+000292d0: 6a6f 696e 2863 6c75 7374 6572 2e73 706c  join(cluster.spl
+000292e0: 6974 2827 2e27 295b 313a 5d29 0a20 2020  it('.')[1:]).   
+000292f0: 2020 2020 2020 2020 2070 7072 696e 7428           pprint(
+00029300: 6622 5573 696e 6720 646f 6d61 696e 207b  f"Using domain {
+00029310: 646f 6d61 696e 7d22 290a 2020 2020 2020  domain}").      
+00029320: 2020 2020 2020 636c 7573 7465 7220 3d20        cluster = 
+00029330: 636c 7573 7465 722e 7265 706c 6163 6528  cluster.replace(
+00029340: 6622 2e7b 646f 6d61 696e 7d22 2c20 2727  f".{domain}", ''
+00029350: 290a 2020 2020 2020 2020 6966 2063 6c75  ).        if clu
+00029360: 7374 6572 2e73 7461 7274 7377 6974 6828  ster.startswith(
+00029370: 2761 7069 2e27 293a 0a20 2020 2020 2020  'api.'):.       
+00029380: 2020 2020 2063 6c75 7374 6572 203d 2063       cluster = c
+00029390: 6c75 7374 6572 2e72 6570 6c61 6365 2822  luster.replace("
+000293a0: 6170 692e 222c 2027 2729 0a20 2020 2020  api.", '').     
+000293b0: 2020 2020 2020 2070 7072 696e 7428 6622         pprint(f"
+000293c0: 5573 696e 6720 636c 7573 7465 7220 7b63  Using cluster {c
+000293d0: 6c75 7374 6572 7d22 290a 2020 2020 2020  luster}").      
+000293e0: 2020 686f 7374 735f 636f 6e74 656e 7420    hosts_content 
+000293f0: 3d20 4e6f 6e65 0a20 2020 2020 2020 2066  = None.        f
+00029400: 696e 616c 6461 7461 203d 204e 6f6e 650a  inaldata = None.
+00029410: 2020 2020 2020 2020 6966 2069 676e 6974          if ignit
+00029420: 696f 6e66 696c 6520 6973 206e 6f74 204e  ionfile is not N
+00029430: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00029440: 2069 6620 6e6f 7420 6f73 2e70 6174 682e   if not os.path.
+00029450: 6578 6973 7473 2869 676e 6974 696f 6e66  exists(ignitionf
+00029460: 696c 6529 3a0a 2020 2020 2020 2020 2020  ile):.          
+00029470: 2020 2020 2020 6572 726f 7228 6622 7b69        error(f"{i
+00029480: 676e 6974 696f 6e66 696c 657d 206e 6f74  gnitionfile} not
+00029490: 2066 6f75 6e64 2229 0a20 2020 2020 2020   found").       
+000294a0: 2020 2020 2020 2020 2073 7973 2e65 7869           sys.exi
+000294b0: 7428 3129 0a20 2020 2020 2020 2020 2020  t(1).           
+000294c0: 2066 696e 616c 6461 7461 203d 206f 7065   finaldata = ope
+000294d0: 6e28 6967 6e69 7469 6f6e 6669 6c65 292e  n(ignitionfile).
+000294e0: 7265 6164 2829 0a20 2020 2020 2020 2065  read().        e
+000294f0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00029500: 2069 676e 6974 696f 6e66 696c 6520 3d20   ignitionfile = 
+00029510: 6622 7b72 6f6c 657d 2e69 676e 220a 2020  f"{role}.ign".  
+00029520: 2020 2020 2020 2020 2020 6966 206f 732e            if os.
+00029530: 7061 7468 2e65 7869 7374 7328 6967 6e69  path.exists(igni
+00029540: 7469 6f6e 6669 6c65 293a 0a20 2020 2020  tionfile):.     
+00029550: 2020 2020 2020 2020 2020 2077 6172 6e69             warni
+00029560: 6e67 2866 2255 7369 6e67 2065 7869 7374  ng(f"Using exist
+00029570: 696e 6720 7b69 676e 6974 696f 6e66 696c  ing {ignitionfil
+00029580: 657d 2229 0a20 2020 2020 2020 2020 2020  e}").           
+00029590: 2020 2020 2066 696e 616c 6461 7461 203d       finaldata =
+000295a0: 206f 7065 6e28 6967 6e69 7469 6f6e 6669   open(ignitionfi
+000295b0: 6c65 292e 7265 6164 2829 0a20 2020 2020  le).read().     
+000295c0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+000295d0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+000295e0: 6170 695f 6970 2069 7320 4e6f 6e65 3a0a  api_ip is None:.
+000295f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029600: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+00029610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029620: 2061 7069 5f69 7020 3d20 736f 636b 6574   api_ip = socket
+00029630: 2e67 6574 686f 7374 6279 6e61 6d65 2866  .gethostbyname(f
+00029640: 2761 7069 2e7b 636c 7573 7465 727d 2e7b  'api.{cluster}.{
+00029650: 646f 6d61 696e 7d27 290a 2020 2020 2020  domain}').      
+00029660: 2020 2020 2020 2020 2020 2020 2020 6578                ex
+00029670: 6365 7074 3a0a 2020 2020 2020 2020 2020  cept:.          
+00029680: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+00029690: 7373 0a20 2020 2020 2020 2020 2020 2020  ss.             
+000296a0: 2020 2069 6620 6170 695f 6970 2069 7320     if api_ip is 
+000296b0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+000296c0: 2020 2020 2020 2020 2020 6966 2064 6f6d            if dom
+000296d0: 6169 6e20 6973 204e 6f6e 653a 0a20 2020  ain is None:.   
+000296e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000296f0: 2020 2020 2065 7272 6f72 2822 436f 756c       error("Coul
+00029700: 646e 2774 2066 6967 7572 6520 6f75 7420  dn't figure out 
+00029710: 6170 695f 6970 206e 6f72 2072 656c 7920  api_ip nor rely 
+00029720: 6f6e 2064 6e73 2073 696e 6365 2064 6f6d  on dns since dom
+00029730: 6169 6e20 6973 206e 6f74 2073 6574 2229  ain is not set")
+00029740: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00029750: 2020 2020 2020 2020 2073 7973 2e65 7869           sys.exi
+00029760: 7428 3129 0a20 2020 2020 2020 2020 2020  t(1).           
+00029770: 2020 2020 2020 2020 2077 6172 6e69 6e67           warning
+00029780: 2822 436f 756c 646e 2774 2066 6967 7572  ("Couldn't figur
+00029790: 6520 6f75 7420 6170 695f 6970 2e20 5265  e out api_ip. Re
+000297a0: 6c79 696e 6720 6f6e 2064 6e73 2229 0a20  lying on dns"). 
+000297b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000297c0: 2020 2061 7069 5f69 7020 3d20 6622 6170     api_ip = f"ap
+000297d0: 692e 7b63 6c75 7374 6572 7d2e 7b64 6f6d  i.{cluster}.{dom
+000297e0: 6169 6e7d 220a 2020 2020 2020 2020 2020  ain}".          
+000297f0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00029800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029810: 686f 7374 735f 636f 6e74 656e 7420 3d20  hosts_content = 
+00029820: 2231 3237 2e30 2e30 2e31 2020 206c 6f63  "127.0.0.1   loc
+00029830: 616c 686f 7374 206c 6f63 616c 686f 7374  alhost localhost
+00029840: 2e6c 6f63 616c 646f 6d61 696e 206c 6f63  .localdomain loc
+00029850: 616c 686f 7374 3420 6c6f 6361 6c68 6f73  alhost4 localhos
+00029860: 7434 2e6c 6f63 616c 646f 6d61 696e 345c  t4.localdomain4\
+00029870: 6e22 0a20 2020 2020 2020 2020 2020 2020  n".             
+00029880: 2020 2020 2020 2068 6f73 7473 5f63 6f6e         hosts_con
+00029890: 7465 6e74 202b 3d20 223a 3a31 2020 2020  tent += "::1    
+000298a0: 2020 2020 206c 6f63 616c 686f 7374 206c       localhost l
+000298b0: 6f63 616c 686f 7374 2e6c 6f63 616c 646f  ocalhost.localdo
+000298c0: 6d61 696e 206c 6f63 616c 686f 7374 3620  main localhost6 
+000298d0: 6c6f 6361 6c68 6f73 7436 2e6c 6f63 616c  localhost6.local
+000298e0: 646f 6d61 696e 365c 6e22 0a20 2020 2020  domain6\n".     
+000298f0: 2020 2020 2020 2020 2020 2020 2020 2068                 h
+00029900: 6f73 7473 5f63 6f6e 7465 6e74 202b 3d20  osts_content += 
+00029910: 6622 7b61 7069 5f69 707d 2061 7069 2d69  f"{api_ip} api-i
+00029920: 6e74 2e7b 636c 7573 7465 727d 2e7b 646f  nt.{cluster}.{do
+00029930: 6d61 696e 7d20 6170 692e 7b63 6c75 7374  main} api.{clust
+00029940: 6572 7d2e 7b64 6f6d 6169 6e7d 220a 2020  er}.{domain}".  
+00029950: 2020 2020 2020 706c 616e 6469 7220 3d20        plandir = 
+00029960: 6f73 2e70 6174 682e 6469 726e 616d 6528  os.path.dirname(
+00029970: 6f70 656e 7368 6966 742e 6372 6561 7465  openshift.create
+00029980: 2e5f 5f63 6f64 655f 5f2e 636f 5f66 696c  .__code__.co_fil
+00029990: 656e 616d 6529 0a20 2020 2020 2020 2077  ename).        w
+000299a0: 6974 6820 6f70 656e 2822 6973 6f2e 6967  ith open("iso.ig
+000299b0: 6e22 2c20 2777 2729 2061 7320 663a 0a20  n", 'w') as f:. 
+000299c0: 2020 2020 2020 2020 2020 2066 756c 6c5f             full_
+000299d0: 6e61 6d65 203d 2066 277b 636c 7573 7465  name = f'{cluste
+000299e0: 727d 2e7b 646f 6d61 696e 7d27 2069 6620  r}.{domain}' if 
+000299f0: 646f 6d61 696e 2069 7320 6e6f 7420 4e6f  domain is not No
+00029a00: 6e65 2065 6c73 6520 636c 7573 7465 720a  ne else cluster.
+00029a10: 2020 2020 2020 2020 2020 2020 7070 7269              ppri
+00029a20: 6e74 2866 2257 7269 7469 6e67 2066 696c  nt(f"Writing fil
+00029a30: 6520 6973 6f2e 6967 6e20 666f 7220 7b72  e iso.ign for {r
+00029a40: 6f6c 657d 2069 6e20 7b66 756c 6c5f 6e61  ole} in {full_na
+00029a50: 6d65 7d22 290a 2020 2020 2020 2020 2020  me}").          
+00029a60: 2020 6973 6f64 6972 203d 206f 732e 7061    isodir = os.pa
+00029a70: 7468 2e64 6972 6e61 6d65 2863 6f6d 6d6f  th.dirname(commo
+00029a80: 6e2e 5f5f 6669 6c65 5f5f 290a 2020 2020  n.__file__).    
+00029a90: 2020 2020 2020 2020 6966 2066 696e 616c          if final
+00029aa0: 6461 7461 2069 7320 4e6f 6e65 3a0a 2020  data is None:.  
+00029ab0: 2020 2020 2020 2020 2020 2020 2020 656e                en
+00029ac0: 7620 3d20 456e 7669 726f 6e6d 656e 7428  v = Environment(
+00029ad0: 6c6f 6164 6572 3d46 696c 6553 7973 7465  loader=FileSyste
+00029ae0: 6d4c 6f61 6465 7228 6973 6f64 6972 292c  mLoader(isodir),
+00029af0: 2065 7874 656e 7369 6f6e 733d 5b27 6a69   extensions=['ji
+00029b00: 6e6a 6132 2e65 7874 2e64 6f27 5d2c 2074  nja2.ext.do'], t
+00029b10: 7269 6d5f 626c 6f63 6b73 3d54 7275 652c  rim_blocks=True,
+00029b20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00029b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029b40: 2020 206c 7374 7269 705f 626c 6f63 6b73     lstrip_blocks
+00029b50: 3d54 7275 6529 0a20 2020 2020 2020 2020  =True).         
+00029b60: 2020 2020 2020 2074 656d 706c 203d 2065         templ = e
+00029b70: 6e76 2e67 6574 5f74 656d 706c 6174 6528  nv.get_template(
+00029b80: 6f73 2e70 6174 682e 6261 7365 6e61 6d65  os.path.basename
+00029b90: 2822 6967 6e69 7469 6f6e 2e6a 3222 2929  ("ignition.j2"))
+00029ba0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00029bb0: 2069 6620 686f 7374 735f 636f 6e74 656e   if hosts_conten
+00029bc0: 7420 6973 206e 6f74 204e 6f6e 653a 0a20  t is not None:. 
+00029bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029be0: 2020 2068 6f73 7473 5f63 6f6e 7465 6e74     hosts_content
+00029bf0: 203d 2062 6173 6536 342e 6236 3465 6e63   = base64.b64enc
+00029c00: 6f64 6528 686f 7374 735f 636f 6e74 656e  ode(hosts_conten
+00029c10: 742e 656e 636f 6465 2829 292e 6465 636f  t.encode()).deco
+00029c20: 6465 2822 5554 462d 3822 290a 2020 2020  de("UTF-8").    
+00029c30: 2020 2020 2020 2020 2020 2020 6966 2027              if '
+00029c40: 3a27 2069 6e20 6170 695f 6970 3a20 2020  :' in api_ip:   
+00029c50: 2320 4950 7636 2061 6464 7265 7373 0a20  # IPv6 address. 
+00029c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029c70: 2020 2069 676e 6974 696f 6e5f 7572 6c20     ignition_url 
+00029c80: 3d20 6622 6874 7470 3a2f 2f5b 7b61 7069  = f"http://[{api
+00029c90: 5f69 707d 5d3a 3232 3632 342f 636f 6e66  _ip}]:22624/conf
+00029ca0: 6967 2f7b 726f 6c65 7d22 0a20 2020 2020  ig/{role}".     
+00029cb0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00029cc0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00029cd0: 2049 5076 3420 6164 6472 6573 730a 2020   IPv4 address.  
+00029ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029cf0: 2020 6967 6e69 7469 6f6e 5f75 726c 203d    ignition_url =
+00029d00: 2066 2268 7474 703a 2f2f 7b61 7069 5f69   f"http://{api_i
+00029d10: 707d 3a32 3236 3234 2f63 6f6e 6669 672f  p}:22624/config/
+00029d20: 7b72 6f6c 657d 220a 2020 2020 2020 2020  {role}".        
+00029d30: 2020 2020 2020 2020 6669 6e61 6c64 6174          finaldat
+00029d40: 6120 3d20 7465 6d70 6c2e 7265 6e64 6572  a = templ.render
+00029d50: 2869 676e 6974 696f 6e5f 7572 6c3d 6967  (ignition_url=ig
+00029d60: 6e69 7469 6f6e 5f75 726c 2c20 686f 7374  nition_url, host
+00029d70: 735f 636f 6e74 656e 743d 686f 7374 735f  s_content=hosts_
+00029d80: 636f 6e74 656e 742c 0a20 2020 2020 2020  content,.       
+00029d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029db0: 2020 6967 6e69 7469 6f6e 5f76 6572 7369    ignition_versi
+00029dc0: 6f6e 3d69 676e 6974 696f 6e5f 7665 7273  on=ignition_vers
+00029dd0: 696f 6e29 0a20 2020 2020 2020 2020 2020  ion).           
+00029de0: 2069 6620 6469 7265 6374 3a0a 2020 2020   if direct:.    
+00029df0: 2020 2020 2020 2020 2020 2020 662e 7772              f.wr
+00029e00: 6974 6528 6669 6e61 6c64 6174 6129 0a20  ite(finaldata). 
+00029e10: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00029e20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00029e30: 205f 6669 6c65 7320 3d20 5b7b 2270 6174   _files = [{"pat
+00029e40: 6822 3a20 222f 726f 6f74 2f63 6f6e 6669  h": "/root/confi
+00029e50: 672e 6967 6e22 2c20 2263 6f6e 7465 6e74  g.ign", "content
+00029e60: 223a 2066 696e 616c 6461 7461 7d5d 0a20  ": finaldata}]. 
+00029e70: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00029e80: 6620 6f73 2e70 6174 682e 6578 6973 7473  f os.path.exists
+00029e90: 2827 6973 6f2e 7368 2729 3a0a 2020 2020  ('iso.sh'):.    
+00029ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029eb0: 7070 7269 6e74 2822 5573 696e 6720 6c6f  pprint("Using lo
+00029ec0: 6361 6c20 6973 6f2e 7368 2073 6372 6970  cal iso.sh scrip
+00029ed0: 7422 290a 2020 2020 2020 2020 2020 2020  t").            
+00029ee0: 2020 2020 2020 2020 6973 6f73 6372 6970          isoscrip
+00029ef0: 7420 3d20 2769 736f 2e73 6827 0a20 2020  t = 'iso.sh'.   
+00029f00: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+00029f10: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00029f20: 2020 2020 2020 2069 736f 7363 7269 7074         isoscript
+00029f30: 203d 2066 277b 706c 616e 6469 727d 2f69   = f'{plandir}/i
+00029f40: 736f 2e73 6827 0a20 2020 2020 2020 2020  so.sh'.         
+00029f50: 2020 2020 2020 2069 6620 6f73 2e70 6174         if os.pat
+00029f60: 682e 6578 6973 7473 2827 6d61 6373 2e74  h.exists('macs.t
+00029f70: 7874 2729 3a0a 2020 2020 2020 2020 2020  xt'):.          
+00029f80: 2020 2020 2020 2020 2020 5f66 696c 6573            _files
+00029f90: 2e61 7070 656e 6428 7b22 7061 7468 223a  .append({"path":
+00029fa0: 2022 2f72 6f6f 742f 6d61 6373 2e74 7874   "/root/macs.txt
+00029fb0: 222c 2022 6f72 6967 696e 223a 2027 6d61  ", "origin": 'ma
+00029fc0: 6373 2e74 7874 277d 290a 2020 2020 2020  cs.txt'}).      
+00029fd0: 2020 2020 2020 2020 2020 6973 6f5f 6f76            iso_ov
+00029fe0: 6572 7269 6465 7320 3d20 7b27 7363 7269  errides = {'scri
+00029ff0: 7074 7327 3a20 5b69 736f 7363 7269 7074  pts': [isoscript
+0002a000: 5d2c 2027 6669 6c65 7327 3a20 5f66 696c  ], 'files': _fil
+0002a010: 6573 2c20 276d 6574 616c 5f75 726c 273a  es, 'metal_url':
+0002a020: 206d 6574 616c 5f75 726c 2c20 276e 6f6e   metal_url, 'non
+0002a030: 616d 6527 3a20 5472 7565 2c0a 2020 2020  ame': True,.    
+0002a040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a050: 2020 2020 2020 2020 2020 2020 2027 696d               'im
+0002a060: 6167 6527 3a20 2772 6863 6f73 3430 3030  age': 'rhcos4000
+0002a070: 277d 0a20 2020 2020 2020 2020 2020 2020  '}.             
+0002a080: 2020 2069 6620 6d65 7461 6c5f 7572 6c20     if metal_url 
+0002a090: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+0002a0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a0b0: 2069 736f 5f6f 7665 7272 6964 6573 5b27   iso_overrides['
+0002a0c0: 6e65 6564 5f6e 6574 776f 726b 275d 203d  need_network'] =
+0002a0d0: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
+0002a0e0: 2020 2020 2020 6973 6f5f 6f76 6572 7269        iso_overri
+0002a0f0: 6465 732e 7570 6461 7465 286f 7665 7272  des.update(overr
+0002a100: 6964 6573 290a 2020 2020 2020 2020 2020  ides).          
+0002a110: 2020 2020 2020 6966 2027 6e61 6d65 2720        if 'name' 
+0002a120: 696e 206f 7665 7272 6964 6573 3a0a 2020  in overrides:.  
+0002a130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a140: 2020 6973 6f5f 6e61 6d65 203d 206f 7665    iso_name = ove
+0002a150: 7272 6964 6573 5b27 6e61 6d65 275d 0a20  rrides['name']. 
+0002a160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a170: 2020 2069 736f 5f6f 7665 7272 6964 6573     iso_overrides
+0002a180: 5b27 6e6f 6e61 6d65 275d 203d 2046 616c  ['noname'] = Fal
+0002a190: 7365 0a20 2020 2020 2020 2020 2020 2020  se.             
+0002a1a0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0002a1b0: 2020 2020 2020 2020 2020 2020 2069 736f               iso
+0002a1c0: 5f6e 616d 6520 3d20 2761 7574 6f69 6e73  _name = 'autoins
+0002a1d0: 7461 6c6c 6572 270a 2020 2020 2020 2020  taller'.        
+0002a1e0: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
+0002a1f0: 2073 656c 662e 6372 6561 7465 5f76 6d28   self.create_vm(
+0002a200: 6973 6f5f 6e61 6d65 2c20 6f76 6572 7269  iso_name, overri
+0002a210: 6465 733d 6973 6f5f 6f76 6572 7269 6465  des=iso_override
+0002a220: 732c 206f 6e6c 7961 7373 6574 733d 5472  s, onlyassets=Tr
+0002a230: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
+0002a240: 2020 2020 6966 2027 7265 6173 6f6e 2720      if 'reason' 
+0002a250: 696e 2072 6573 756c 743a 0a20 2020 2020  in result:.     
+0002a260: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0002a270: 7272 6f72 2872 6573 756c 745b 2772 6561  rror(result['rea
+0002a280: 736f 6e27 5d29 0a20 2020 2020 2020 2020  son']).         
+0002a290: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0002a2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a2b0: 2066 2e77 7269 7465 2872 6573 756c 745b   f.write(result[
+0002a2c0: 2775 7365 7264 6174 6127 5d29 0a20 2020  'userdata']).   
+0002a2d0: 2020 2020 2069 6620 6973 6f3a 0a20 2020       if iso:.   
+0002a2e0: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+0002a2f0: 2e74 7970 6520 6e6f 7420 696e 205b 276b  .type not in ['k
+0002a300: 766d 272c 2027 6661 6b65 272c 2027 6b75  vm', 'fake', 'ku
+0002a310: 6265 7669 7274 272c 2027 7673 7068 6572  bevirt', 'vspher
+0002a320: 6527 2c20 276f 7065 6e73 7461 636b 275d  e', 'openstack']
+0002a330: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0002a340: 2020 7761 726e 696e 6728 6622 4973 6f20    warning(f"Iso 
+0002a350: 6765 6e65 7261 7469 6f6e 206e 6f74 2073  generation not s
+0002a360: 7570 706f 7274 6564 206f 6e20 7b73 656c  upported on {sel
+0002a370: 662e 7479 7065 7d22 290a 2020 2020 2020  f.type}").      
+0002a380: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0002a390: 2020 2020 2020 2020 2020 2020 6973 6f5f              iso_
+0002a3a0: 706f 6f6c 203d 206f 7665 7272 6964 6573  pool = overrides
+0002a3b0: 2e67 6574 2827 706f 6f6c 2729 206f 7220  .get('pool') or 
+0002a3c0: 7365 6c66 2e70 6f6f 6c0a 2020 2020 2020  self.pool.      
+0002a3d0: 2020 2020 2020 2020 2020 6765 6e65 7261            genera
+0002a3e0: 7465 5f72 6863 6f73 5f69 736f 2873 656c  te_rhcos_iso(sel
+0002a3f0: 662e 6b2c 2066 227b 636c 7573 7465 727d  f.k, f"{cluster}
+0002a400: 2d7b 726f 6c65 7d22 2c20 6973 6f5f 706f  -{role}", iso_po
+0002a410: 6f6c 2c20 7665 7273 696f 6e3d 6973 6f5f  ol, version=iso_
+0002a420: 7665 7273 696f 6e2c 2070 6f64 6d61 6e3d  version, podman=
+0002a430: 706f 646d 616e 2c0a 2020 2020 2020 2020  podman,.        
+0002a440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a450: 2020 2020 2020 2020 2020 2069 6e73 7461             insta
+0002a460: 6c6c 6572 3d69 6e73 7461 6c6c 6572 290a  ller=installer).
+0002a470: 0a20 2020 2064 6566 2063 7265 6174 655f  .    def create_
+0002a480: 6f70 656e 7368 6966 745f 6469 7363 6f6e  openshift_discon
+0002a490: 6e65 6374 6564 2873 656c 662c 2070 6c61  nected(self, pla
+0002a4a0: 6e2c 206f 7665 7272 6964 6573 3d7b 7d29  n, overrides={})
+0002a4b0: 3a0a 2020 2020 2020 2020 6461 7461 203d  :.        data =
+0002a4c0: 206f 7665 7272 6964 6573 0a20 2020 2020   overrides.     
+0002a4d0: 2020 2070 6c61 6e64 6972 203d 206f 732e     plandir = os.
+0002a4e0: 7061 7468 2e64 6972 6e61 6d65 286f 7065  path.dirname(ope
+0002a4f0: 6e73 6869 6674 2e63 7265 6174 652e 5f5f  nshift.create.__
+0002a500: 636f 6465 5f5f 2e63 6f5f 6669 6c65 6e61  code__.co_filena
+0002a510: 6d65 290a 2020 2020 2020 2020 636c 7573  me).        clus
+0002a520: 7465 7220 3d20 6461 7461 2e67 6574 2827  ter = data.get('
+0002a530: 636c 7573 7465 7227 2c20 276d 796f 7065  cluster', 'myope
+0002a540: 6e73 6869 6674 2729 0a20 2020 2020 2020  nshift').       
+0002a550: 2075 7073 7472 6561 6d20 3d20 6461 7461   upstream = data
+0002a560: 2e67 6574 2827 7570 7374 7265 616d 272c  .get('upstream',
+0002a570: 2046 616c 7365 290a 2020 2020 2020 2020   False).        
+0002a580: 7665 7273 696f 6e20 3d20 6461 7461 2e67  version = data.g
+0002a590: 6574 2827 7665 7273 696f 6e27 2c20 2773  et('version', 's
+0002a5a0: 7461 626c 6527 290a 2020 2020 2020 2020  table').        
+0002a5b0: 7461 6720 3d20 6461 7461 2e67 6574 2827  tag = data.get('
+0002a5c0: 7461 6727 2c20 4f50 454e 5348 4946 545f  tag', OPENSHIFT_
+0002a5d0: 5441 4729 0a20 2020 2020 2020 2070 7072  TAG).        ppr
+0002a5e0: 696e 7428 6622 5573 696e 6720 7665 7273  int(f"Using vers
+0002a5f0: 696f 6e20 7b76 6572 7369 6f6e 7d20 616e  ion {version} an
+0002a600: 6420 7461 6720 7b74 6167 7d22 290a 2020  d tag {tag}").  
+0002a610: 2020 2020 2020 6469 7363 6f6e 6e65 6374        disconnect
+0002a620: 6564 5f76 6d20 3d20 6622 7b63 6c75 7374  ed_vm = f"{clust
+0002a630: 6572 7d2d 6469 7363 6f6e 6e65 6374 6564  er}-disconnected
+0002a640: 220a 2020 2020 2020 2020 6469 7363 6f6e  ".        discon
+0002a650: 6e65 6374 6564 5f72 6575 7365 203d 2064  nected_reuse = d
+0002a660: 6174 612e 6765 7428 2764 6973 636f 6e6e  ata.get('disconn
+0002a670: 6563 7465 645f 7265 7573 6527 2c20 4661  ected_reuse', Fa
+0002a680: 6c73 6529 0a20 2020 2020 2020 2064 6973  lse).        dis
+0002a690: 636f 6e6e 6563 7465 645f 7379 6e63 203d  connected_sync =
+0002a6a0: 2064 6174 612e 6765 7428 2764 6973 636f   data.get('disco
+0002a6b0: 6e6e 6563 7465 645f 7379 6e63 272c 2054  nnected_sync', T
+0002a6c0: 7275 6529 0a20 2020 2020 2020 2070 7072  rue).        ppr
+0002a6d0: 696e 7428 6622 4465 706c 6f79 696e 6720  int(f"Deploying 
+0002a6e0: 6469 7363 6f6e 6e65 6374 6564 2076 6d20  disconnected vm 
+0002a6f0: 7b64 6973 636f 6e6e 6563 7465 645f 766d  {disconnected_vm
+0002a700: 7d22 290a 2020 2020 2020 2020 6966 2064  }").        if d
+0002a710: 6973 636f 6e6e 6563 7465 645f 7379 6e63  isconnected_sync
+0002a720: 3a0a 2020 2020 2020 2020 2020 2020 7075  :.            pu
+0002a730: 6c6c 5f73 6563 7265 7420 3d20 7077 645f  ll_secret = pwd_
+0002a740: 7061 7468 2864 6174 612e 6765 7428 2770  path(data.get('p
+0002a750: 756c 6c5f 7365 6372 6574 2729 2920 6966  ull_secret')) if
+0002a760: 206e 6f74 2075 7073 7472 6561 6d20 656c   not upstream el
+0002a770: 7365 2066 227b 706c 616e 6469 727d 2f66  se f"{plandir}/f
+0002a780: 616b 655f 7075 6c6c 2e6a 736f 6e22 0a20  ake_pull.json". 
+0002a790: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+0002a7a0: 7420 7570 7374 7265 616d 3a0a 2020 2020  t upstream:.    
+0002a7b0: 2020 2020 2020 2020 2020 2020 7075 6c6c              pull
+0002a7c0: 5f73 6563 7265 7420 3d20 7077 645f 7061  _secret = pwd_pa
+0002a7d0: 7468 2864 6174 612e 6765 7428 2770 756c  th(data.get('pul
+0002a7e0: 6c5f 7365 6372 6574 272c 2027 6f70 656e  l_secret', 'open
+0002a7f0: 7368 6966 745f 7075 6c6c 2e6a 736f 6e27  shift_pull.json'
+0002a800: 2929 0a20 2020 2020 2020 2020 2020 2065  )).            e
+0002a810: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0002a820: 2020 2020 2070 756c 6c5f 7365 6372 6574       pull_secret
+0002a830: 203d 2066 227b 706c 616e 6469 727d 2f66   = f"{plandir}/f
+0002a840: 616b 655f 7075 6c6c 2e6a 736f 6e22 0a20  ake_pull.json". 
+0002a850: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+0002a860: 7420 6f73 2e70 6174 682e 6578 6973 7473  t os.path.exists
+0002a870: 2870 756c 6c5f 7365 6372 6574 293a 0a20  (pull_secret):. 
+0002a880: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0002a890: 7272 6f72 2866 224d 6973 7369 6e67 2070  rror(f"Missing p
+0002a8a0: 756c 6c20 7365 6372 6574 2066 696c 6520  ull secret file 
+0002a8b0: 7b70 756c 6c5f 7365 6372 6574 7d22 290a  {pull_secret}").
+0002a8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a8d0: 7379 732e 6578 6974 2831 290a 2020 2020  sys.exit(1).    
+0002a8e0: 2020 2020 2020 2020 6461 7461 5b27 7075          data['pu
+0002a8f0: 6c6c 5f73 6563 7265 7427 5d20 3d20 7265  ll_secret'] = re
+0002a900: 2e73 7562 2872 225c 7322 2c20 2222 2c20  .sub(r"\s", "", 
+0002a910: 6f70 656e 2870 756c 6c5f 7365 6372 6574  open(pull_secret
+0002a920: 292e 7265 6164 2829 290a 2020 2020 2020  ).read()).      
+0002a930: 2020 6469 7363 6f6e 6e65 6374 6564 5f70    disconnected_p
+0002a940: 6c61 6e20 3d20 6622 7b70 6c61 6e7d 2d72  lan = f"{plan}-r
+0002a950: 6575 7365 2220 6966 2064 6973 636f 6e6e  euse" if disconn
+0002a960: 6563 7465 645f 7265 7573 6520 656c 7365  ected_reuse else
+0002a970: 2070 6c61 6e0a 2020 2020 2020 2020 6966   plan.        if
+0002a980: 2076 6572 7369 6f6e 203d 3d20 2763 6927   version == 'ci'
+0002a990: 2061 6e64 2027 6469 7363 6f6e 6e65 6374   and 'disconnect
+0002a9a0: 6564 5f6f 7269 6769 6e27 206e 6f74 2069  ed_origin' not i
+0002a9b0: 6e20 6f76 6572 7269 6465 733a 0a20 2020  n overrides:.   
+0002a9c0: 2020 2020 2020 2020 2072 6567 203d 2027           reg = '
+0002a9d0: 7265 6769 7374 7279 2e62 7569 6c64 3031  registry.build01
+0002a9e0: 2e63 692e 6f70 656e 7368 6966 742e 6f72  .ci.openshift.or
+0002a9f0: 6727 2069 6620 7374 7228 7461 6729 2e73  g' if str(tag).s
+0002aa00: 7461 7274 7377 6974 6828 2763 692d 2729  tartswith('ci-')
+0002aa10: 2065 6c73 6520 2772 6567 6973 7472 792e   else 'registry.
+0002aa20: 6369 2e6f 7065 6e73 6869 6674 2e6f 7267  ci.openshift.org
+0002aa30: 270a 2020 2020 2020 2020 2020 2020 7761  '.            wa
+0002aa40: 726e 696e 6728 6622 466f 7263 696e 6720  rning(f"Forcing 
+0002aa50: 6469 7363 6f6e 6e65 6374 6564 5f6f 7269  disconnected_ori
+0002aa60: 6769 6e20 746f 207b 7265 677d 2229 0a20  gin to {reg}"). 
+0002aa70: 2020 2020 2020 2020 2020 2064 6174 615b             data[
+0002aa80: 2764 6973 636f 6e6e 6563 7465 645f 6f72  'disconnected_or
+0002aa90: 6967 696e 275d 203d 2072 6567 0a20 2020  igin'] = reg.   
+0002aaa0: 2020 2020 2072 6573 756c 7420 3d20 7365       result = se
+0002aab0: 6c66 2e70 6c61 6e28 6469 7363 6f6e 6e65  lf.plan(disconne
+0002aac0: 6374 6564 5f70 6c61 6e2c 2069 6e70 7574  cted_plan, input
+0002aad0: 6669 6c65 3d66 277b 706c 616e 6469 727d  file=f'{plandir}
+0002aae0: 2f64 6973 636f 6e6e 6563 7465 642e 796d  /disconnected.ym
+0002aaf0: 6c27 2c20 6f76 6572 7269 6465 733d 6461  l', overrides=da
+0002ab00: 7461 290a 2020 2020 2020 2020 6966 2072  ta).        if r
+0002ab10: 6573 756c 745b 2772 6573 756c 7427 5d20  esult['result'] 
+0002ab20: 213d 2027 7375 6363 6573 7327 3a0a 2020  != 'success':.  
+0002ab30: 2020 2020 2020 2020 2020 7379 732e 6578            sys.ex
+0002ab40: 6974 2831 290a 2020 2020 2020 2020 656c  it(1).        el
+0002ab50: 6966 2064 6973 636f 6e6e 6563 7465 645f  if disconnected_
+0002ab60: 7379 6e63 3a0a 2020 2020 2020 2020 2020  sync:.          
+0002ab70: 2020 7070 7269 6e74 2822 5573 6520 7468    pprint("Use th
+0002ab80: 6520 666f 6c6c 6f77 696e 6720 4f50 454e  e following OPEN
+0002ab90: 5348 4946 545f 494e 5354 414c 4c5f 5245  SHIFT_INSTALL_RE
+0002aba0: 4c45 4153 455f 494d 4147 455f 4f56 4552  LEASE_IMAGE_OVER
+0002abb0: 5249 4445 2229 0a20 2020 2020 2020 2020  RIDE").         
+0002abc0: 2020 206e 616d 6520 3d20 6461 7461 2e67     name = data.g
+0002abd0: 6574 2827 6469 7363 6f6e 6e65 6374 6564  et('disconnected
+0002abe0: 5f72 6575 7365 5f6e 616d 6527 2920 6f72  _reuse_name') or
+0002abf0: 2063 6c75 7374 6572 0a20 2020 2020 2020   cluster.       
+0002ac00: 2020 2020 2069 702c 2076 6d70 6f72 7420       ip, vmport 
+0002ac10: 3d20 5f73 7368 5f63 7265 6465 6e74 6961  = _ssh_credentia
+0002ac20: 6c73 2873 656c 662e 6b2c 2066 277b 6e61  ls(self.k, f'{na
+0002ac30: 6d65 7d2d 6469 7363 6f6e 6e65 6374 6564  me}-disconnected
+0002ac40: 2729 5b31 3a5d 0a20 2020 2020 2020 2020  ')[1:].         
+0002ac50: 2020 2063 6d64 203d 2022 6361 7420 2f72     cmd = "cat /r
+0002ac60: 6f6f 742f 7665 7273 696f 6e2e 7478 7422  oot/version.txt"
+0002ac70: 0a20 2020 2020 2020 2020 2020 2073 7368  .            ssh
+0002ac80: 636d 6420 3d20 7373 6828 6e61 6d65 2c20  cmd = ssh(name, 
+0002ac90: 6970 3d69 702c 2075 7365 723d 2772 6f6f  ip=ip, user='roo
+0002aca0: 7427 2c20 7475 6e6e 656c 3d73 656c 662e  t', tunnel=self.
+0002acb0: 7475 6e6e 656c 2c0a 2020 2020 2020 2020  tunnel,.        
+0002acc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002acd0: 2074 756e 6e65 6c68 6f73 743d 7365 6c66   tunnelhost=self
+0002ace0: 2e74 756e 6e65 6c68 6f73 742c 2074 756e  .tunnelhost, tun
+0002acf0: 6e65 6c70 6f72 743d 7365 6c66 2e74 756e  nelport=self.tun
+0002ad00: 6e65 6c70 6f72 742c 0a20 2020 2020 2020  nelport,.       
+0002ad10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ad20: 2020 7475 6e6e 656c 7573 6572 3d73 656c    tunneluser=sel
+0002ad30: 662e 7475 6e6e 656c 7573 6572 2c20 696e  f.tunneluser, in
+0002ad40: 7365 6375 7265 3d54 7275 652c 2063 6d64  secure=True, cmd
+0002ad50: 3d63 6d64 2c20 766d 706f 7274 3d76 6d70  =cmd, vmport=vmp
+0002ad60: 6f72 7429 0a20 2020 2020 2020 2020 2020  ort).           
+0002ad70: 206f 732e 7379 7374 656d 2873 7368 636d   os.system(sshcm
+0002ad80: 6429 0a0a 2020 2020 6465 6620 6861 6e64  d)..    def hand
+0002ad90: 6c65 5f66 696e 6973 6866 696c 6573 2873  le_finishfiles(s
+0002ada0: 656c 662c 206e 616d 652c 2066 696e 6973  elf, name, finis
+0002adb0: 6866 696c 6573 2c20 6964 656e 7469 7479  hfiles, identity
+0002adc0: 6669 6c65 3d4e 6f6e 652c 2076 6d63 6c69  file=None, vmcli
+0002add0: 656e 743d 4e6f 6e65 293a 0a20 2020 2020  ent=None):.     
+0002ade0: 2020 2063 6f6e 6669 6720 3d20 4b63 6f6e     config = Kcon
+0002adf0: 6669 6728 636c 6965 6e74 3d76 6d63 6c69  fig(client=vmcli
+0002ae00: 656e 7429 2069 6620 766d 636c 6965 6e74  ent) if vmclient
+0002ae10: 2069 7320 6e6f 7420 4e6f 6e65 2065 6c73   is not None els
+0002ae20: 6520 7365 6c66 0a20 2020 2020 2020 206b  e self.        k
+0002ae30: 203d 2063 6f6e 6669 672e 6b0a 2020 2020   = config.k.    
+0002ae40: 2020 2020 6375 7272 656e 745f 6970 203d      current_ip =
+0002ae50: 2063 6f6d 6d6f 6e2e 5f73 7368 5f63 7265   common._ssh_cre
+0002ae60: 6465 6e74 6961 6c73 286b 2c20 6e61 6d65  dentials(k, name
+0002ae70: 295b 315d 0a20 2020 2020 2020 2066 6f72  )[1].        for
+0002ae80: 2066 696e 6973 6866 696c 6520 696e 2066   finishfile in f
+0002ae90: 696e 6973 6866 696c 6573 3a0a 2020 2020  inishfiles:.    
+0002aea0: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+0002aeb0: 7461 6e63 6528 6669 6e69 7368 6669 6c65  tance(finishfile
+0002aec0: 2c20 7374 7229 3a0a 2020 2020 2020 2020  , str):.        
+0002aed0: 2020 2020 2020 2020 6465 7374 696e 6174          destinat
+0002aee0: 696f 6e20 3d20 272e 270a 2020 2020 2020  ion = '.'.      
+0002aef0: 2020 2020 2020 2020 2020 736f 7572 6365            source
+0002af00: 203d 2066 696e 6973 6866 696c 6520 6966   = finishfile if
+0002af10: 2027 2f27 2069 6e20 6669 6e69 7368 6669   '/' in finishfi
+0002af20: 6c65 2065 6c73 6520 6627 2f72 6f6f 742f  le else f'/root/
+0002af30: 7b66 696e 6973 6866 696c 657d 270a 2020  {finishfile}'.  
+0002af40: 2020 2020 2020 2020 2020 656c 6966 2069            elif i
+0002af50: 7369 6e73 7461 6e63 6528 6669 6e69 7368  sinstance(finish
+0002af60: 6669 6c65 2c20 6469 6374 2920 616e 6420  file, dict) and 
+0002af70: 276f 7269 6769 6e27 2069 6e20 6669 6e69  'origin' in fini
+0002af80: 7368 6669 6c65 2061 6e64 2027 7061 7468  shfile and 'path
+0002af90: 2720 696e 2066 696e 6973 6866 696c 653a  ' in finishfile:
+0002afa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002afb0: 2073 6f75 7263 652c 2064 6573 7469 6e61   source, destina
+0002afc0: 7469 6f6e 203d 2066 696e 6973 6866 696c  tion = finishfil
+0002afd0: 652e 6765 7428 276f 7269 6769 6e27 292c  e.get('origin'),
+0002afe0: 206f 732e 7061 7468 2e65 7870 616e 6475   os.path.expandu
+0002aff0: 7365 7228 6669 6e69 7368 6669 6c65 2e67  ser(finishfile.g
+0002b000: 6574 2827 7061 7468 272c 2027 2e27 2929  et('path', '.'))
+0002b010: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+0002b020: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0002b030: 2020 2077 6172 6e69 6e67 2866 2249 6e63     warning(f"Inc
+0002b040: 6f72 7265 6374 2066 696e 6973 6866 696c  orrect finishfil
+0002b050: 6520 656e 7472 7920 7b66 696e 6973 6866  e entry {finishf
+0002b060: 696c 657d 2e20 536b 6970 7069 6e67 2229  ile}. Skipping")
+0002b070: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002b080: 2063 6f6e 7469 6e75 650a 2020 2020 2020   continue.      
+0002b090: 2020 2020 2020 7363 7063 6d64 203d 2063        scpcmd = c
+0002b0a0: 6f6d 6d6f 6e2e 7363 7028 6e61 6d65 2c20  ommon.scp(name, 
+0002b0b0: 6970 3d63 7572 7265 6e74 5f69 702c 2075  ip=current_ip, u
+0002b0c0: 7365 723d 2772 6f6f 7427 2c20 736f 7572  ser='root', sour
+0002b0d0: 6365 3d73 6f75 7263 652c 2064 6573 7469  ce=source, desti
+0002b0e0: 6e61 7469 6f6e 3d64 6573 7469 6e61 7469  nation=destinati
+0002b0f0: 6f6e 2c0a 2020 2020 2020 2020 2020 2020  on,.            
+0002b100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b110: 2020 2020 7475 6e6e 656c 3d63 6f6e 6669      tunnel=confi
+0002b120: 672e 7475 6e6e 656c 2c20 7475 6e6e 656c  g.tunnel, tunnel
+0002b130: 686f 7374 3d63 6f6e 6669 672e 7475 6e6e  host=config.tunn
+0002b140: 656c 686f 7374 2c20 7475 6e6e 656c 706f  elhost, tunnelpo
+0002b150: 7274 3d63 6f6e 6669 672e 7475 6e6e 656c  rt=config.tunnel
+0002b160: 706f 7274 2c0a 2020 2020 2020 2020 2020  port,.          
+0002b170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b180: 2020 2020 2020 7475 6e6e 656c 7573 6572        tunneluser
+0002b190: 3d73 656c 662e 7475 6e6e 656c 7573 6572  =self.tunneluser
+0002b1a0: 2c20 646f 776e 6c6f 6164 3d54 7275 652c  , download=True,
+0002b1b0: 2069 6e73 6563 7572 653d 5472 7565 2c20   insecure=True, 
+0002b1c0: 6964 656e 7469 7479 6669 6c65 3d69 6465  identityfile=ide
+0002b1d0: 6e74 6974 7966 696c 6529 0a20 2020 2020  ntityfile).     
+0002b1e0: 2020 2020 2020 206f 732e 7379 7374 656d         os.system
+0002b1f0: 2873 6370 636d 6429 0a0a 2020 2020 6465  (scpcmd)..    de
+0002b200: 6620 6861 6e64 6c65 5f6e 6f74 6966 6963  f handle_notific
+0002b210: 6174 696f 6e73 2873 656c 662c 206e 616d  ations(self, nam
+0002b220: 652c 206e 6f74 6966 796d 6574 686f 6473  e, notifymethods
+0002b230: 3d5b 5d2c 2070 7573 6862 756c 6c65 7474  =[], pushbullett
+0002b240: 6f6b 656e 3d4e 6f6e 652c 206e 6f74 6966  oken=None, notif
+0002b250: 7973 6372 6970 743d 4e6f 6e65 2c20 6e6f  yscript=None, no
+0002b260: 7469 6679 636d 643d 4e6f 6e65 2c0a 2020  tifycmd=None,.  
+0002b270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b280: 2020 2020 2020 2020 2020 2073 6c61 636b             slack
+0002b290: 6368 616e 6e65 6c3d 4e6f 6e65 2c20 736c  channel=None, sl
+0002b2a0: 6163 6b74 6f6b 656e 3d4e 6f6e 652c 206d  acktoken=None, m
+0002b2b0: 6169 6c73 6572 7665 723d 4e6f 6e65 2c20  ailserver=None, 
+0002b2c0: 6d61 696c 6672 6f6d 3d4e 6f6e 652c 206d  mailfrom=None, m
+0002b2d0: 6169 6c74 6f3d 4e6f 6e65 2c0a 2020 2020  ailto=None,.    
+0002b2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b2f0: 2020 2020 2020 2020 2063 6c75 7374 6572           cluster
+0002b300: 3d46 616c 7365 293a 0a20 2020 2020 2020  =False):.       
+0002b310: 205f 7479 7065 203d 2027 436c 7573 7465   _type = 'Cluste
+0002b320: 7227 2069 6620 636c 7573 7465 7220 656c  r' if cluster el
+0002b330: 7365 2027 566d 270a 2020 2020 2020 2020  se 'Vm'.        
+0002b340: 7469 746c 6520 3d20 6622 7b5f 7479 7065  title = f"{_type
+0002b350: 7d20 7b6e 616d 657d 206f 6e20 7b73 656c  } {name} on {sel
+0002b360: 662e 636c 6965 6e74 7d20 7265 706f 7274  f.client} report
+0002b370: 220a 2020 2020 2020 2020 636d 6473 2c20  ".        cmds, 
+0002b380: 6d61 696c 636f 6e74 656e 7420 3d20 5b5d  mailcontent = []
+0002b390: 2c20 4e6f 6e65 0a20 2020 2020 2020 2066  , None.        f
+0002b3a0: 6f72 206e 6f74 6966 796d 6574 686f 6420  or notifymethod 
+0002b3b0: 696e 2073 6f72 7465 6428 6e6f 7469 6679  in sorted(notify
+0002b3c0: 6d65 7468 6f64 732c 2072 6576 6572 7365  methods, reverse
+0002b3d0: 3d54 7275 6529 3a0a 2020 2020 2020 2020  =True):.        
+0002b3e0: 2020 2020 6966 206e 6f74 6966 796d 6574      if notifymet
+0002b3f0: 686f 6420 3d3d 2027 7075 7368 6275 6c6c  hod == 'pushbull
+0002b400: 6574 273a 0a20 2020 2020 2020 2020 2020  et':.           
+0002b410: 2020 2020 2069 6620 7075 7368 6275 6c6c       if pushbull
+0002b420: 6574 746f 6b65 6e20 6973 204e 6f6e 653a  ettoken is None:
+0002b430: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002b440: 2020 2020 2077 6172 6e69 6e67 2866 224e       warning(f"N
+0002b450: 6f74 6966 6963 6174 696f 6e20 7265 7175  otification requ
+0002b460: 6972 6564 2066 6f72 207b 6e61 6d65 7d20  ired for {name} 
+0002b470: 6275 7420 6d69 7373 696e 6720 7075 7368  but missing push
+0002b480: 6275 6c6c 6574 746f 6b65 6e22 290a 2020  bullettoken").  
+0002b490: 2020 2020 2020 2020 2020 2020 2020 656c                el
+0002b4a0: 6966 206e 6f74 6966 7973 6372 6970 7420  if notifyscript 
+0002b4b0: 6973 204e 6f6e 6520 616e 6420 6e6f 7469  is None and noti
+0002b4c0: 6679 636d 6420 6973 204e 6f6e 653a 0a20  fycmd is None:. 
+0002b4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b4e0: 2020 2063 6f6e 7469 6e75 650a 2020 2020     continue.    
+0002b4f0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0002b500: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0002b510: 2020 2020 2020 746f 6b65 6e20 3d20 7075        token = pu
+0002b520: 7368 6275 6c6c 6574 746f 6b65 6e0a 2020  shbullettoken.  
+0002b530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b540: 2020 7062 636d 6420 3d20 2763 7572 6c20    pbcmd = 'curl 
+0002b550: 2d73 7520 2225 733a 2220 2d64 2074 7970  -su "%s:" -d typ
+0002b560: 653d 226e 6f74 6522 202d 6420 626f 6479  e="note" -d body
+0002b570: 3d22 6025 7320 323e 2631 6022 202d 6420  ="`%s 2>&1`" -d 
+0002b580: 7469 746c 653d 2225 7322 2027 2025 2028  title="%s" ' % (
+0002b590: 746f 6b65 6e2c 0a20 2020 2020 2020 2020  token,.         
+0002b5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b5f0: 2020 2020 2020 2020 206e 6f74 6966 7963           notifyc
+0002b600: 6d64 2c0a 2020 2020 2020 2020 2020 2020  md,.            
 0002b610: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0002b620: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0002b630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b640: 2020 2020 206e 6f74 6966 7963 6d64 2c0a       notifycmd,.
+0002b640: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0002b650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b660: 2020 2020 2020 7469 746c 6529 0a20 2020        title).   
 0002b670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b6b0: 2020 7469 746c 6529 0a20 2020 2020 2020    title).       
-0002b6c0: 2020 2020 2020 2020 2020 2020 2070 6263               pbc
-0002b6d0: 6d64 202b 3d20 2768 7474 7073 3a2f 2f61  md += 'https://a
-0002b6e0: 7069 2e70 7573 6862 756c 6c65 742e 636f  pi.pushbullet.co
-0002b6f0: 6d2f 7632 2f70 7573 6865 7327 0a20 2020  m/v2/pushes'.   
-0002b700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b710: 2063 6d64 732e 6170 7065 6e64 2870 6263   cmds.append(pbc
-0002b720: 6d64 290a 2020 2020 2020 2020 2020 2020  md).            
-0002b730: 656c 6966 206e 6f74 6966 796d 6574 686f  elif notifymetho
-0002b740: 6420 3d3d 2027 736c 6163 6b27 3a0a 2020  d == 'slack':.  
-0002b750: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0002b760: 2073 6c61 636b 6368 616e 6e65 6c20 6973   slackchannel is
-0002b770: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-0002b780: 2020 2020 2020 2020 2020 2077 6172 6e69             warni
-0002b790: 6e67 2866 224e 6f74 6966 6963 6174 696f  ng(f"Notificatio
-0002b7a0: 6e20 7265 7175 6972 6564 2066 6f72 207b  n required for {
-0002b7b0: 6e61 6d65 7d20 6275 7420 6d69 7373 696e  name} but missin
-0002b7c0: 6720 736c 6163 6b20 6368 616e 6e65 6c22  g slack channel"
-0002b7d0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0002b7e0: 2020 656c 6966 2073 6c61 636b 746f 6b65    elif slacktoke
-0002b7f0: 6e20 6973 204e 6f6e 653a 0a20 2020 2020  n is None:.     
-0002b800: 2020 2020 2020 2020 2020 2020 2020 2077                 w
-0002b810: 6172 6e69 6e67 2866 224e 6f74 6966 6963  arning(f"Notific
-0002b820: 6174 696f 6e20 7265 7175 6972 6564 2066  ation required f
-0002b830: 6f72 207b 6e61 6d65 7d20 6275 7420 6d69  or {name} but mi
-0002b840: 7373 696e 6720 736c 6163 6b74 6f6b 656e  ssing slacktoken
-0002b850: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-0002b860: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0002b870: 2020 2020 2020 2020 2020 2020 2073 6c61               sla
-0002b880: 636b 636d 6420 3d20 6622 696e 666f 3d60  ckcmd = f"info=`
-0002b890: 7b6e 6f74 6966 7963 6d64 7d20 323e 2631  {notifycmd} 2>&1
-0002b8a0: 207c 2073 6564 2027 732f 5c5c 7832 2f20   | sed 's/\\x2/ 
-0002b8b0: 2f67 2760 3b22 0a20 2020 2020 2020 2020  /g'`;".         
-0002b8c0: 2020 2020 2020 2020 2020 2073 6c61 636b             slack
-0002b8d0: 636d 6420 2b3d 2022 2222 6375 726c 202d  cmd += """curl -
-0002b8e0: 5820 504f 5354 202d 4820 2741 7574 686f  X POST -H 'Autho
-0002b8f0: 7269 7a61 7469 6f6e 3a20 4265 6172 6572  rization: Bearer
-0002b900: 2025 7327 0a20 2d48 2027 436f 6e74 656e   %s'. -H 'Conten
-0002b910: 742d 7479 7065 3a20 6170 706c 6963 6174  t-type: applicat
-0002b920: 696f 6e2f 6a73 6f6e 3b20 6368 6172 7365  ion/json; charse
-0002b930: 743d 7574 662d 3827 0a20 2d2d 6461 7461  t=utf-8'. --data
-0002b940: 2027 7b22 6368 616e 6e65 6c22 3a22 2573   '{"channel":"%s
-0002b950: 222c 2274 6578 7422 3a22 2573 222c 2261  ","text":"%s","a
-0002b960: 7474 6163 686d 656e 7473 223a 205b 7b22  ttachments": [{"
-0002b970: 7465 7874 223a 2227 2224 696e 666f 2227  text":"'"$info"'
-0002b980: 222c 2266 616c 6c62 6163 6b22 3a22 6e6f  ","fallback":"no
-0002b990: 7468 696e 6722 2c0a 2263 6f6c 6f72 223a  thing",."color":
-0002b9a0: 2223 3341 4133 4533 222c 2261 7474 6163  "#3AA3E3","attac
-0002b9b0: 686d 656e 745f 7479 7065 223a 2264 6566  hment_type":"def
-0002b9c0: 6175 6c74 227d 5d7d 2720 6874 7470 733a  ault"}]}' https:
-0002b9d0: 2f2f 736c 6163 6b2e 636f 6d2f 6170 692f  //slack.com/api/
-0002b9e0: 6368 6174 2e70 6f73 744d 6573 7361 6765  chat.postMessage
-0002b9f0: 2222 2220 2520 2873 6c61 636b 746f 6b65  """ % (slacktoke
-0002ba00: 6e2c 0a20 2020 2020 2020 2020 2020 2020  n,.             
-0002ba10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ba20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ba30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ba40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ba50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ba60: 2020 736c 6163 6b63 6861 6e6e 656c 2c20    slackchannel, 
-0002ba70: 7469 746c 6529 0a20 2020 2020 2020 2020  title).         
-0002ba80: 2020 2020 2020 2020 2020 2073 6c61 636b             slack
-0002ba90: 636d 6420 3d20 736c 6163 6b63 6d64 2e72  cmd = slackcmd.r
-0002baa0: 6570 6c61 6365 2827 5c6e 272c 2027 2729  eplace('\n', '')
-0002bab0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002bac0: 2020 2020 2063 6d64 732e 6170 7065 6e64       cmds.append
-0002bad0: 2873 6c61 636b 636d 6429 0a20 2020 2020  (slackcmd).     
-0002bae0: 2020 2020 2020 2065 6c69 6620 6e6f 7469         elif noti
-0002baf0: 6679 6d65 7468 6f64 203d 3d20 276d 6169  fymethod == 'mai
-0002bb00: 6c27 3a0a 2020 2020 2020 2020 2020 2020  l':.            
-0002bb10: 2020 2020 6966 206d 6169 6c73 6572 7665      if mailserve
-0002bb20: 7220 6973 204e 6f6e 653a 0a20 2020 2020  r is None:.     
-0002bb30: 2020 2020 2020 2020 2020 2020 2020 2077                 w
-0002bb40: 6172 6e69 6e67 2866 224e 6f74 6966 6963  arning(f"Notific
-0002bb50: 6174 696f 6e20 7265 7175 6972 6564 2066  ation required f
-0002bb60: 6f72 207b 6e61 6d65 7d20 6275 7420 6d69  or {name} but mi
-0002bb70: 7373 696e 6720 6d61 696c 7365 7276 6572  ssing mailserver
-0002bb80: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-0002bb90: 2020 2065 6c69 6620 6d61 696c 6672 6f6d     elif mailfrom
-0002bba0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-0002bbb0: 2020 2020 2020 2020 2020 2020 2020 7761                wa
-0002bbc0: 726e 696e 6728 6622 4e6f 7469 6669 6361  rning(f"Notifica
-0002bbd0: 7469 6f6e 2072 6571 7569 7265 6420 666f  tion required fo
-0002bbe0: 7220 7b6e 616d 657d 2062 7574 206d 6973  r {name} but mis
-0002bbf0: 7369 6e67 206d 6169 6c66 726f 6d22 290a  sing mailfrom").
-0002bc00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002bc10: 656c 6966 206e 6f74 206d 6169 6c74 6f3a  elif not mailto:
-0002bc20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002bc30: 2020 2020 2077 6172 6e69 6e67 2866 224e       warning(f"N
-0002bc40: 6f74 6966 6963 6174 696f 6e20 7265 7175  otification requ
-0002bc50: 6972 6564 2066 6f72 207b 6e61 6d65 7d20  ired for {name} 
-0002bc60: 6275 7420 6d69 7373 696e 6720 6d61 696c  but missing mail
-0002bc70: 746f 2229 0a20 2020 2020 2020 2020 2020  to").           
-0002bc80: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0002bc90: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-0002bca0: 6f77 203d 2064 6174 6574 696d 652e 6e6f  ow = datetime.no
-0002bcb0: 7728 290a 2020 2020 2020 2020 2020 2020  w().            
-0002bcc0: 2020 2020 2020 2020 6e6f 7720 3d20 6e6f          now = no
-0002bcd0: 772e 2073 7472 6674 696d 6528 2225 612c  w. strftime("%a,
-0002bce0: 2564 2025 6220 2559 2025 483a 254d 3a25  %d %b %Y %H:%M:%
-0002bcf0: 5322 290a 2020 2020 2020 2020 2020 2020  S").            
-0002bd00: 2020 2020 2020 2020 746f 7320 3d20 272c          tos = ',
-0002bd10: 272e 6a6f 696e 285b 6622 3c7b 746f 7d3e  '.join([f"<{to}>
-0002bd20: 2220 666f 7220 746f 2069 6e20 6d61 696c  " for to in mail
-0002bd30: 746f 5d29 0a20 2020 2020 2020 2020 2020  to]).           
-0002bd40: 2020 2020 2020 2020 206d 6169 6c63 6f6e           mailcon
-0002bd50: 7465 6e74 203d 2066 2246 726f 6d3a 207b  tent = f"From: {
-0002bd60: 6d61 696c 6672 6f6d 7d20 3c7b 6d61 696c  mailfrom} <{mail
-0002bd70: 6672 6f6d 7d3e 5c6e 546f 3a20 7b74 6f73  from}>\nTo: {tos
-0002bd80: 7d5c 6e44 6174 653a 207b 6e6f 777d 5c6e  }\nDate: {now}\n
-0002bd90: 5375 626a 6563 743a 207b 7469 746c 657d  Subject: {title}
-0002bda0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0002bdb0: 2020 2020 2020 6d61 696c 636d 6420 3d20        mailcmd = 
-0002bdc0: 5b5d 0a20 2020 2020 2020 2020 2020 2020  [].             
-0002bdd0: 2020 2020 2020 2069 6620 6e6f 7420 636c         if not cl
-0002bde0: 7573 7465 723a 0a20 2020 2020 2020 2020  uster:.         
-0002bdf0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-0002be00: 6169 6c63 6d64 2e61 7070 656e 6428 2774  ailcmd.append('t
-0002be10: 6573 7420 2d66 202f 6574 632f 6465 6269  est -f /etc/debi
-0002be20: 616e 5f76 6572 7369 6f6e 2026 2620 6170  an_version && ap
-0002be30: 742d 6765 7420 2d79 2069 6e73 7461 6c6c  t-get -y install
-0002be40: 2063 7572 6c27 290a 2020 2020 2020 2020   curl').        
-0002be50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002be60: 6d61 696c 636d 642e 6170 7065 6e64 2827  mailcmd.append('
-0002be70: 6563 686f 2022 2220 3e3e 202f 7661 722f  echo "" >> /var/
-0002be80: 746d 702f 6d61 696c 2e74 7874 2729 0a20  tmp/mail.txt'). 
+0002b680: 2070 6263 6d64 202b 3d20 2768 7474 7073   pbcmd += 'https
+0002b690: 3a2f 2f61 7069 2e70 7573 6862 756c 6c65  ://api.pushbulle
+0002b6a0: 742e 636f 6d2f 7632 2f70 7573 6865 7327  t.com/v2/pushes'
+0002b6b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002b6c0: 2020 2020 2063 6d64 732e 6170 7065 6e64       cmds.append
+0002b6d0: 2870 6263 6d64 290a 2020 2020 2020 2020  (pbcmd).        
+0002b6e0: 2020 2020 656c 6966 206e 6f74 6966 796d      elif notifym
+0002b6f0: 6574 686f 6420 3d3d 2027 736c 6163 6b27  ethod == 'slack'
+0002b700: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0002b710: 2020 6966 2073 6c61 636b 6368 616e 6e65    if slackchanne
+0002b720: 6c20 6973 204e 6f6e 653a 0a20 2020 2020  l is None:.     
+0002b730: 2020 2020 2020 2020 2020 2020 2020 2077                 w
+0002b740: 6172 6e69 6e67 2866 224e 6f74 6966 6963  arning(f"Notific
+0002b750: 6174 696f 6e20 7265 7175 6972 6564 2066  ation required f
+0002b760: 6f72 207b 6e61 6d65 7d20 6275 7420 6d69  or {name} but mi
+0002b770: 7373 696e 6720 736c 6163 6b20 6368 616e  ssing slack chan
+0002b780: 6e65 6c22 290a 2020 2020 2020 2020 2020  nel").          
+0002b790: 2020 2020 2020 656c 6966 2073 6c61 636b        elif slack
+0002b7a0: 746f 6b65 6e20 6973 204e 6f6e 653a 0a20  token is None:. 
+0002b7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b7c0: 2020 2077 6172 6e69 6e67 2866 224e 6f74     warning(f"Not
+0002b7d0: 6966 6963 6174 696f 6e20 7265 7175 6972  ification requir
+0002b7e0: 6564 2066 6f72 207b 6e61 6d65 7d20 6275  ed for {name} bu
+0002b7f0: 7420 6d69 7373 696e 6720 736c 6163 6b74  t missing slackt
+0002b800: 6f6b 656e 2229 0a20 2020 2020 2020 2020  oken").         
+0002b810: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0002b820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b830: 2073 6c61 636b 636d 6420 3d20 6622 696e   slackcmd = f"in
+0002b840: 666f 3d60 7b6e 6f74 6966 7963 6d64 7d20  fo=`{notifycmd} 
+0002b850: 323e 2631 207c 2073 6564 2027 732f 5c5c  2>&1 | sed 's/\\
+0002b860: 7832 2f20 2f67 2760 3b22 0a20 2020 2020  x2/ /g'`;".     
+0002b870: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0002b880: 6c61 636b 636d 6420 2b3d 2022 2222 6375  lackcmd += """cu
+0002b890: 726c 202d 5820 504f 5354 202d 4820 2741  rl -X POST -H 'A
+0002b8a0: 7574 686f 7269 7a61 7469 6f6e 3a20 4265  uthorization: Be
+0002b8b0: 6172 6572 2025 7327 0a20 2d48 2027 436f  arer %s'. -H 'Co
+0002b8c0: 6e74 656e 742d 7479 7065 3a20 6170 706c  ntent-type: appl
+0002b8d0: 6963 6174 696f 6e2f 6a73 6f6e 3b20 6368  ication/json; ch
+0002b8e0: 6172 7365 743d 7574 662d 3827 0a20 2d2d  arset=utf-8'. --
+0002b8f0: 6461 7461 2027 7b22 6368 616e 6e65 6c22  data '{"channel"
+0002b900: 3a22 2573 222c 2274 6578 7422 3a22 2573  :"%s","text":"%s
+0002b910: 222c 2261 7474 6163 686d 656e 7473 223a  ","attachments":
+0002b920: 205b 7b22 7465 7874 223a 2227 2224 696e   [{"text":"'"$in
+0002b930: 666f 2227 222c 2266 616c 6c62 6163 6b22  fo"'","fallback"
+0002b940: 3a22 6e6f 7468 696e 6722 2c0a 2263 6f6c  :"nothing",."col
+0002b950: 6f72 223a 2223 3341 4133 4533 222c 2261  or":"#3AA3E3","a
+0002b960: 7474 6163 686d 656e 745f 7479 7065 223a  ttachment_type":
+0002b970: 2264 6566 6175 6c74 227d 5d7d 2720 6874  "default"}]}' ht
+0002b980: 7470 733a 2f2f 736c 6163 6b2e 636f 6d2f  tps://slack.com/
+0002b990: 6170 692f 6368 6174 2e70 6f73 744d 6573  api/chat.postMes
+0002b9a0: 7361 6765 2222 2220 2520 2873 6c61 636b  sage""" % (slack
+0002b9b0: 746f 6b65 6e2c 0a20 2020 2020 2020 2020  token,.         
+0002b9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ba00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ba10: 2020 2020 2020 736c 6163 6b63 6861 6e6e        slackchann
+0002ba20: 656c 2c20 7469 746c 6529 0a20 2020 2020  el, title).     
+0002ba30: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0002ba40: 6c61 636b 636d 6420 3d20 736c 6163 6b63  lackcmd = slackc
+0002ba50: 6d64 2e72 6570 6c61 6365 2827 5c6e 272c  md.replace('\n',
+0002ba60: 2027 2729 0a20 2020 2020 2020 2020 2020   '').           
+0002ba70: 2020 2020 2020 2020 2063 6d64 732e 6170           cmds.ap
+0002ba80: 7065 6e64 2873 6c61 636b 636d 6429 0a20  pend(slackcmd). 
+0002ba90: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+0002baa0: 6e6f 7469 6679 6d65 7468 6f64 203d 3d20  notifymethod == 
+0002bab0: 276d 6169 6c27 3a0a 2020 2020 2020 2020  'mail':.        
+0002bac0: 2020 2020 2020 2020 6966 206d 6169 6c73          if mails
+0002bad0: 6572 7665 7220 6973 204e 6f6e 653a 0a20  erver is None:. 
+0002bae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002baf0: 2020 2077 6172 6e69 6e67 2866 224e 6f74     warning(f"Not
+0002bb00: 6966 6963 6174 696f 6e20 7265 7175 6972  ification requir
+0002bb10: 6564 2066 6f72 207b 6e61 6d65 7d20 6275  ed for {name} bu
+0002bb20: 7420 6d69 7373 696e 6720 6d61 696c 7365  t missing mailse
+0002bb30: 7276 6572 2229 0a20 2020 2020 2020 2020  rver").         
+0002bb40: 2020 2020 2020 2065 6c69 6620 6d61 696c         elif mail
+0002bb50: 6672 6f6d 2069 7320 4e6f 6e65 3a0a 2020  from is None:.  
+0002bb60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002bb70: 2020 7761 726e 696e 6728 6622 4e6f 7469    warning(f"Noti
+0002bb80: 6669 6361 7469 6f6e 2072 6571 7569 7265  fication require
+0002bb90: 6420 666f 7220 7b6e 616d 657d 2062 7574  d for {name} but
+0002bba0: 206d 6973 7369 6e67 206d 6169 6c66 726f   missing mailfro
+0002bbb0: 6d22 290a 2020 2020 2020 2020 2020 2020  m").            
+0002bbc0: 2020 2020 656c 6966 206e 6f74 206d 6169      elif not mai
+0002bbd0: 6c74 6f3a 0a20 2020 2020 2020 2020 2020  lto:.           
+0002bbe0: 2020 2020 2020 2020 2077 6172 6e69 6e67           warning
+0002bbf0: 2866 224e 6f74 6966 6963 6174 696f 6e20  (f"Notification 
+0002bc00: 7265 7175 6972 6564 2066 6f72 207b 6e61  required for {na
+0002bc10: 6d65 7d20 6275 7420 6d69 7373 696e 6720  me} but missing 
+0002bc20: 6d61 696c 746f 2229 0a20 2020 2020 2020  mailto").       
+0002bc30: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+0002bc40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002bc50: 2020 206e 6f77 203d 2064 6174 6574 696d     now = datetim
+0002bc60: 652e 6e6f 7728 290a 2020 2020 2020 2020  e.now().        
+0002bc70: 2020 2020 2020 2020 2020 2020 6e6f 7720              now 
+0002bc80: 3d20 6e6f 772e 2073 7472 6674 696d 6528  = now. strftime(
+0002bc90: 2225 612c 2564 2025 6220 2559 2025 483a  "%a,%d %b %Y %H:
+0002bca0: 254d 3a25 5322 290a 2020 2020 2020 2020  %M:%S").        
+0002bcb0: 2020 2020 2020 2020 2020 2020 746f 7320              tos 
+0002bcc0: 3d20 272c 272e 6a6f 696e 285b 6622 3c7b  = ','.join([f"<{
+0002bcd0: 746f 7d3e 2220 666f 7220 746f 2069 6e20  to}>" for to in 
+0002bce0: 6d61 696c 746f 5d29 0a20 2020 2020 2020  mailto]).       
+0002bcf0: 2020 2020 2020 2020 2020 2020 206d 6169               mai
+0002bd00: 6c63 6f6e 7465 6e74 203d 2066 2246 726f  lcontent = f"Fro
+0002bd10: 6d3a 207b 6d61 696c 6672 6f6d 7d20 3c7b  m: {mailfrom} <{
+0002bd20: 6d61 696c 6672 6f6d 7d3e 5c6e 546f 3a20  mailfrom}>\nTo: 
+0002bd30: 7b74 6f73 7d5c 6e44 6174 653a 207b 6e6f  {tos}\nDate: {no
+0002bd40: 777d 5c6e 5375 626a 6563 743a 207b 7469  w}\nSubject: {ti
+0002bd50: 746c 657d 220a 2020 2020 2020 2020 2020  tle}".          
+0002bd60: 2020 2020 2020 2020 2020 6d61 696c 636d            mailcm
+0002bd70: 6420 3d20 5b5d 0a20 2020 2020 2020 2020  d = [].         
+0002bd80: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+0002bd90: 7420 636c 7573 7465 723a 0a20 2020 2020  t cluster:.     
+0002bda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002bdb0: 2020 206d 6169 6c63 6d64 2e61 7070 656e     mailcmd.appen
+0002bdc0: 6428 2774 6573 7420 2d66 202f 6574 632f  d('test -f /etc/
+0002bdd0: 6465 6269 616e 5f76 6572 7369 6f6e 2026  debian_version &
+0002bde0: 2620 6170 742d 6765 7420 2d79 2069 6e73  & apt-get -y ins
+0002bdf0: 7461 6c6c 2063 7572 6c27 290a 2020 2020  tall curl').    
+0002be00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002be10: 2020 2020 6d61 696c 636d 642e 6170 7065      mailcmd.appe
+0002be20: 6e64 2827 6563 686f 2022 2220 3e3e 202f  nd('echo "" >> /
+0002be30: 7661 722f 746d 702f 6d61 696c 2e74 7874  var/tmp/mail.txt
+0002be40: 2729 0a20 2020 2020 2020 2020 2020 2020  ').             
+0002be50: 2020 2020 2020 206d 6169 6c63 6d64 2e61         mailcmd.a
+0002be60: 7070 656e 6428 6627 7b6e 6f74 6966 7963  ppend(f'{notifyc
+0002be70: 6d64 7d20 323e 2631 203e 3e20 2f76 6172  md} 2>&1 >> /var
+0002be80: 2f74 6d70 2f6d 6169 6c2e 7478 7427 290a  /tmp/mail.txt').
 0002be90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002bea0: 2020 206d 6169 6c63 6d64 2e61 7070 656e     mailcmd.appen
-0002beb0: 6428 6627 7b6e 6f74 6966 7963 6d64 7d20  d(f'{notifycmd} 
-0002bec0: 323e 2631 203e 3e20 2f76 6172 2f74 6d70  2>&1 >> /var/tmp
-0002bed0: 2f6d 6169 6c2e 7478 7427 290a 2020 2020  /mail.txt').    
-0002bee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002bef0: 6375 726c 636d 6420 3d20 6622 6375 726c  curlcmd = f"curl
-0002bf00: 202d 2d73 696c 656e 7420 2d2d 7572 6c20   --silent --url 
-0002bf10: 736d 7470 3a2f 2f7b 6d61 696c 7365 7276  smtp://{mailserv
-0002bf20: 6572 7d3a 3235 202d 2d6d 6169 6c2d 6672  er}:25 --mail-fr
-0002bf30: 6f6d 207b 6d61 696c 6672 6f6d 7d22 0a20  om {mailfrom}". 
-0002bf40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002bf50: 2020 2066 6f72 2061 6464 7265 7373 2069     for address i
-0002bf60: 6e20 6d61 696c 746f 3a0a 2020 2020 2020  n mailto:.      
-0002bf70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002bf80: 2020 6375 726c 636d 6420 2b3d 2066 2220    curlcmd += f" 
-0002bf90: 2d2d 6d61 696c 2d72 6370 7420 7b61 6464  --mail-rcpt {add
-0002bfa0: 7265 7373 7d20 220a 2020 2020 2020 2020  ress} ".        
-0002bfb0: 2020 2020 2020 2020 2020 2020 6966 2063              if c
-0002bfc0: 6c75 7374 6572 3a0a 2020 2020 2020 2020  luster:.        
-0002bfd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002bfe0: 6d61 696c 636f 6e74 656e 7420 3d20 2222  mailcontent = ""
-0002bff0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002c000: 2020 2020 2020 2020 206b 7562 6563 6f6e           kubecon
-0002c010: 6669 6720 3d20 6627 2f65 7463 2f6b 7562  fig = f'/etc/kub
-0002c020: 6572 6e65 7465 732f 6b75 6265 636f 6e66  ernetes/kubeconf
-0002c030: 6967 2e7b 6e61 6d65 7d27 0a20 2020 2020  ig.{name}'.     
-0002c040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c050: 2020 2063 7572 6c63 6d64 202b 3d20 6627     curlcmd += f'
-0002c060: 202d 4820 2253 7562 6a65 6374 3a20 7b74   -H "Subject: {t
-0002c070: 6974 6c65 7d22 202d 4820 2246 726f 6d3a  itle}" -H "From:
-0002c080: 207b 6d61 696c 6672 6f6d 7d20 3c7b 6d61   {mailfrom} <{ma
-0002c090: 696c 6672 6f6d 7d3e 2227 0a20 2020 2020  ilfrom}>"'.     
-0002c0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c0b0: 2020 2066 6f72 2061 6464 7265 7373 2069     for address i
-0002c0c0: 6e20 6d61 696c 746f 3a0a 2020 2020 2020  n mailto:.      
+0002bea0: 2020 2020 6375 726c 636d 6420 3d20 6622      curlcmd = f"
+0002beb0: 6375 726c 202d 2d73 696c 656e 7420 2d2d  curl --silent --
+0002bec0: 7572 6c20 736d 7470 3a2f 2f7b 6d61 696c  url smtp://{mail
+0002bed0: 7365 7276 6572 7d3a 3235 202d 2d6d 6169  server}:25 --mai
+0002bee0: 6c2d 6672 6f6d 207b 6d61 696c 6672 6f6d  l-from {mailfrom
+0002bef0: 7d22 0a20 2020 2020 2020 2020 2020 2020  }".             
+0002bf00: 2020 2020 2020 2066 6f72 2061 6464 7265         for addre
+0002bf10: 7373 2069 6e20 6d61 696c 746f 3a0a 2020  ss in mailto:.  
+0002bf20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002bf30: 2020 2020 2020 6375 726c 636d 6420 2b3d        curlcmd +=
+0002bf40: 2066 2220 2d2d 6d61 696c 2d72 6370 7420   f" --mail-rcpt 
+0002bf50: 7b61 6464 7265 7373 7d20 220a 2020 2020  {address} ".    
+0002bf60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002bf70: 6966 2063 6c75 7374 6572 3a0a 2020 2020  if cluster:.    
+0002bf80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002bf90: 2020 2020 6d61 696c 636f 6e74 656e 7420      mailcontent 
+0002bfa0: 3d20 2222 0a20 2020 2020 2020 2020 2020  = "".           
+0002bfb0: 2020 2020 2020 2020 2020 2020 206b 7562               kub
+0002bfc0: 6563 6f6e 6669 6720 3d20 6627 2f65 7463  econfig = f'/etc
+0002bfd0: 2f6b 7562 6572 6e65 7465 732f 6b75 6265  /kubernetes/kube
+0002bfe0: 636f 6e66 6967 2e7b 6e61 6d65 7d27 0a20  config.{name}'. 
+0002bff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c000: 2020 2020 2020 2063 7572 6c63 6d64 202b         curlcmd +
+0002c010: 3d20 6627 202d 4820 2253 7562 6a65 6374  = f' -H "Subject
+0002c020: 3a20 7b74 6974 6c65 7d22 202d 4820 2246  : {title}" -H "F
+0002c030: 726f 6d3a 207b 6d61 696c 6672 6f6d 7d20  rom: {mailfrom} 
+0002c040: 3c7b 6d61 696c 6672 6f6d 7d3e 2227 0a20  <{mailfrom}>"'. 
+0002c050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c060: 2020 2020 2020 2066 6f72 2061 6464 7265         for addre
+0002c070: 7373 2069 6e20 6d61 696c 746f 3a0a 2020  ss in mailto:.  
+0002c080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c090: 2020 2020 2020 2020 2020 6375 726c 636d            curlcm
+0002c0a0: 6420 2b3d 2066 2720 2d48 2022 546f 3a20  d += f' -H "To: 
+0002c0b0: 7b61 6464 7265 7373 7d20 3c7b 6164 6472  {address} <{addr
+0002c0c0: 6573 737d 3e22 270a 2020 2020 2020 2020  ess}>"'.        
 0002c0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c0e0: 2020 2020 2020 6375 726c 636d 6420 2b3d        curlcmd +=
-0002c0f0: 2066 2720 2d48 2022 546f 3a20 7b61 6464   f' -H "To: {add
-0002c100: 7265 7373 7d20 3c7b 6164 6472 6573 737d  ress} <{address}
-0002c110: 3e22 270a 2020 2020 2020 2020 2020 2020  >"'.            
-0002c120: 2020 2020 2020 2020 2020 2020 6375 726c              curl
-0002c130: 636d 6420 2b3d 2027 202d 4620 223d 283b  cmd += ' -F "=(;
-0002c140: 7479 7065 3d6d 756c 7469 7061 7274 2f6d  type=multipart/m
-0002c150: 6978 6564 2220 2d46 2022 3d24 2863 6174  ixed" -F "=$(cat
-0002c160: 202f 7661 722f 746d 702f 6d61 696c 2e74   /var/tmp/mail.t
-0002c170: 7874 293b 7479 7065 3d74 6578 742f 706c  xt);type=text/pl
-0002c180: 6169 6e22 270a 2020 2020 2020 2020 2020  ain"'.          
-0002c190: 2020 2020 2020 2020 2020 2020 2020 6375                cu
-0002c1a0: 726c 636d 6420 2b3d 2066 2720 2d46 2022  rlcmd += f' -F "
-0002c1b0: 6669 6c65 3d40 7b6b 7562 6563 6f6e 6669  file=@{kubeconfi
-0002c1c0: 677d 3b74 7970 653d 7465 7874 2f70 6c61  g};type=text/pla
-0002c1d0: 696e 3b65 6e63 6f64 6572 3d62 6173 6536  in;encoder=base6
-0002c1e0: 3422 202d 4620 223d 2922 270a 2020 2020  4" -F "=)"'.    
-0002c1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c200: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0002c210: 2020 2020 2020 2020 2020 2020 2020 6375                cu
-0002c220: 726c 636d 6420 2b3d 2022 202d 2d75 706c  rlcmd += " --upl
-0002c230: 6f61 642d 6669 6c65 202f 7661 722f 746d  oad-file /var/tm
-0002c240: 702f 6d61 696c 2e74 7874 220a 2020 2020  p/mail.txt".    
-0002c250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c260: 6d61 696c 636d 642e 6170 7065 6e64 2863  mailcmd.append(c
-0002c270: 7572 6c63 6d64 290a 2020 2020 2020 2020  urlcmd).        
-0002c280: 2020 2020 2020 2020 2020 2020 636d 6473              cmds
-0002c290: 2e65 7874 656e 6428 6d61 696c 636d 6429  .extend(mailcmd)
-0002c2a0: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-0002c2b0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0002c2c0: 2020 2065 7272 6f72 2866 2249 6e76 616c     error(f"Inval
-0002c2d0: 6964 206d 6574 686f 6420 7b6e 6f74 6966  id method {notif
-0002c2e0: 796d 6574 686f 647d 2229 0a20 2020 2020  ymethod}").     
-0002c2f0: 2020 2072 6574 7572 6e20 636d 6473 2c20     return cmds, 
-0002c300: 6d61 696c 636f 6e74 656e 740a 0a20 2020  mailcontent..   
-0002c310: 2064 6566 2068 616e 646c 655f 766d 5f72   def handle_vm_r
-0002c320: 6573 756c 7428 7365 6c66 2c20 6e61 6d65  esult(self, name
-0002c330: 2c20 7072 6f66 696c 652c 2072 6573 756c  , profile, resul
-0002c340: 742c 206e 6577 766d 732c 2066 6169 6c65  t, newvms, faile
-0002c350: 6476 6d73 2c20 6173 796e 6377 6169 7476  dvms, asyncwaitv
-0002c360: 6d73 2c20 6f6e 6c79 6173 7365 7473 3d46  ms, onlyassets=F
-0002c370: 616c 7365 2c20 6e65 7761 7373 6574 733d  alse, newassets=
-0002c380: 5b5d 2c0a 2020 2020 2020 2020 2020 2020  [],.            
-0002c390: 2020 2020 2020 2020 2020 2020 2076 6d63               vmc
-0002c3a0: 6c69 656e 743d 4e6f 6e65 293a 0a20 2020  lient=None):.   
-0002c3b0: 2020 2020 2069 6620 2772 6573 756c 7427       if 'result'
-0002c3c0: 2069 6e20 7265 7375 6c74 2061 6e64 2072   in result and r
-0002c3d0: 6573 756c 745b 2772 6573 756c 7427 5d20  esult['result'] 
-0002c3e0: 3d3d 2027 7375 6363 6573 7327 3a0a 2020  == 'success':.  
-0002c3f0: 2020 2020 2020 2020 2020 6e65 7776 6d73            newvms
-0002c400: 2e61 7070 656e 6428 6e61 6d65 290a 2020  .append(name).  
-0002c410: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0002c420: 2020 2020 2020 2020 6661 696c 6564 766d          failedvm
-0002c430: 732e 6170 7065 6e64 287b 276e 616d 6527  s.append({'name'
-0002c440: 3a20 6e61 6d65 2c20 2772 6561 736f 6e27  : name, 'reason'
-0002c450: 3a20 7265 7375 6c74 5b27 7265 6173 6f6e  : result['reason
-0002c460: 275d 7d29 0a20 2020 2020 2020 2073 7461  ']}).        sta
-0002c470: 7274 203d 2070 726f 6669 6c65 2e67 6574  rt = profile.get
-0002c480: 2827 7374 6172 7427 2c20 5472 7565 290a  ('start', True).
-0002c490: 2020 2020 2020 2020 636c 6f75 6469 6e69          cloudini
-0002c4a0: 7420 3d20 7072 6f66 696c 652e 6765 7428  t = profile.get(
-0002c4b0: 2763 6c6f 7564 696e 6974 272c 2054 7275  'cloudinit', Tru
-0002c4c0: 6529 0a20 2020 2020 2020 2061 7379 6e63  e).        async
-0002c4d0: 7761 6974 203d 2070 726f 6669 6c65 2e67  wait = profile.g
-0002c4e0: 6574 2827 6173 796e 6377 6169 7427 2c20  et('asyncwait', 
-0002c4f0: 4661 6c73 6529 0a20 2020 2020 2020 2066  False).        f
-0002c500: 696e 6973 6866 696c 6573 203d 2070 726f  inishfiles = pro
-0002c510: 6669 6c65 2e67 6574 2827 6669 6e69 7368  file.get('finish
-0002c520: 6669 6c65 7327 2c20 5b5d 290a 2020 2020  files', []).    
-0002c530: 2020 2020 6966 206f 6e6c 7961 7373 6574      if onlyasset
-0002c540: 733a 0a20 2020 2020 2020 2020 2020 2069  s:.            i
-0002c550: 6620 2764 6174 6127 2069 6e20 7265 7375  f 'data' in resu
-0002c560: 6c74 3a0a 2020 2020 2020 2020 2020 2020  lt:.            
-0002c570: 2020 2020 6e65 7761 7373 6574 732e 6170      newassets.ap
-0002c580: 7065 6e64 2872 6573 756c 745b 2764 6174  pend(result['dat
-0002c590: 6127 5d29 0a20 2020 2020 2020 2020 2020  a']).           
-0002c5a0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0002c5b0: 2020 2020 2020 2065 7272 6f72 2872 6573         error(res
-0002c5c0: 756c 745b 2772 6561 736f 6e27 5d29 0a20  ult['reason']). 
-0002c5d0: 2020 2020 2020 2069 6620 6e6f 7420 6173         if not as
-0002c5e0: 796e 6377 6169 743a 0a20 2020 2020 2020  yncwait:.       
-0002c5f0: 2020 2020 2072 6574 7572 6e0a 2020 2020       return.    
-0002c600: 2020 2020 656c 6966 206e 6f74 2073 7461      elif not sta
-0002c610: 7274 206f 7220 6e6f 7420 636c 6f75 6469  rt or not cloudi
-0002c620: 6e69 7420 6f72 2070 726f 6669 6c65 2e67  nit or profile.g
-0002c630: 6574 2827 696d 6167 6527 2920 6973 204e  et('image') is N
-0002c640: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-0002c650: 2070 7072 696e 7428 6622 536b 6970 7069   pprint(f"Skippi
-0002c660: 6e67 2077 6169 7420 6f6e 207b 6e61 6d65  ng wait on {name
-0002c670: 7d22 290a 2020 2020 2020 2020 656c 7365  }").        else
-0002c680: 3a0a 2020 2020 2020 2020 2020 2020 7761  :.            wa
-0002c690: 6974 636f 6d6d 616e 6420 3d20 7072 6f66  itcommand = prof
-0002c6a0: 696c 652e 6765 7428 2777 6169 7463 6f6d  ile.get('waitcom
-0002c6b0: 6d61 6e64 2729 0a20 2020 2020 2020 2020  mand').         
-0002c6c0: 2020 2077 6169 7474 696d 656f 7574 203d     waittimeout =
-0002c6d0: 2070 726f 6669 6c65 2e67 6574 2827 7761   profile.get('wa
-0002c6e0: 6974 7469 6d65 6f75 7427 2c20 3029 0a20  ittimeout', 0). 
-0002c6f0: 2020 2020 2020 2020 2020 2061 7379 6e63             async
-0002c700: 7761 6974 766d 203d 207b 276e 616d 6527  waitvm = {'name'
-0002c710: 3a20 6e61 6d65 2c20 2766 696e 6973 6866  : name, 'finishf
-0002c720: 696c 6573 273a 2066 696e 6973 6866 696c  iles': finishfil
-0002c730: 6573 2c20 2777 6169 7463 6f6d 6d61 6e64  es, 'waitcommand
-0002c740: 273a 2077 6169 7463 6f6d 6d61 6e64 2c0a  ': waitcommand,.
-0002c750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c760: 2020 2020 2020 2020 2020 2027 7761 6974             'wait
-0002c770: 7469 6d65 6f75 7427 3a20 7761 6974 7469  timeout': waitti
-0002c780: 6d65 6f75 742c 2027 766d 636c 6965 6e74  meout, 'vmclient
-0002c790: 273a 2076 6d63 6c69 656e 747d 0a20 2020  ': vmclient}.   
-0002c7a0: 2020 2020 2020 2020 2061 7379 6e63 7761           asyncwa
-0002c7b0: 6974 766d 732e 6170 7065 6e64 2861 7379  itvms.append(asy
-0002c7c0: 6e63 7761 6974 766d 290a 0a20 2020 2064  ncwaitvm)..    d
-0002c7d0: 6566 2074 6872 6561 6465 645f 6372 6561  ef threaded_crea
-0002c7e0: 7465 5f76 6d28 7365 6c66 2c20 6e61 6d65  te_vm(self, name
-0002c7f0: 2c20 7072 6f66 696c 656e 616d 652c 2063  , profilename, c
-0002c800: 7572 7265 6e74 6f76 6572 7269 6465 732c  urrentoverrides,
-0002c810: 2070 726f 6669 6c65 2c20 7a2c 2070 6c61   profile, z, pla
-0002c820: 6e2c 2063 7572 7265 6e74 706c 616e 6469  n, currentplandi
-0002c830: 722c 2076 6d63 6c69 656e 742c 0a20 2020  r, vmclient,.   
-0002c840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c850: 2020 2020 2020 2020 6f6e 666c 792c 206f          onfly, o
-0002c860: 6e6c 7961 7373 6574 732c 206e 6577 766d  nlyassets, newvm
-0002c870: 732c 2066 6169 6c65 6476 6d73 2c20 6173  s, failedvms, as
-0002c880: 796e 6377 6169 7476 6d73 2c20 6e65 7761  yncwaitvms, newa
-0002c890: 7373 6574 7329 3a0a 2020 2020 2020 2020  ssets):.        
-0002c8a0: 7265 7375 6c74 203d 2073 656c 662e 6372  result = self.cr
-0002c8b0: 6561 7465 5f76 6d28 6e61 6d65 2c20 7072  eate_vm(name, pr
-0002c8c0: 6f66 696c 656e 616d 652c 206f 7665 7272  ofilename, overr
-0002c8d0: 6964 6573 3d63 7572 7265 6e74 6f76 6572  ides=currentover
-0002c8e0: 7269 6465 732c 2063 7573 746f 6d70 726f  rides, custompro
-0002c8f0: 6669 6c65 3d70 726f 6669 6c65 2c20 6b3d  file=profile, k=
-0002c900: 7a2c 0a20 2020 2020 2020 2020 2020 2020  z,.             
-0002c910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c920: 2020 2070 6c61 6e3d 706c 616e 2c20 6261     plan=plan, ba
-0002c930: 7365 6469 723d 6375 7272 656e 7470 6c61  sedir=currentpla
-0002c940: 6e64 6972 2c20 636c 6965 6e74 3d76 6d63  ndir, client=vmc
-0002c950: 6c69 656e 742c 206f 6e66 6c79 3d6f 6e66  lient, onfly=onf
-0002c960: 6c79 2c0a 2020 2020 2020 2020 2020 2020  ly,.            
-0002c970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c980: 2020 2020 6f6e 6c79 6173 7365 7473 3d6f      onlyassets=o
-0002c990: 6e6c 7961 7373 6574 7329 0a20 2020 2020  nlyassets).     
-0002c9a0: 2020 2069 6620 6e6f 7420 6f6e 6c79 6173     if not onlyas
-0002c9b0: 7365 7473 3a0a 2020 2020 2020 2020 2020  sets:.          
-0002c9c0: 2020 636f 6d6d 6f6e 2e68 616e 646c 655f    common.handle_
-0002c9d0: 7265 7370 6f6e 7365 2872 6573 756c 742c  response(result,
-0002c9e0: 206e 616d 652c 2063 6c69 656e 743d 766d   name, client=vm
-0002c9f0: 636c 6965 6e74 290a 2020 2020 2020 2020  client).        
-0002ca00: 7365 6c66 2e68 616e 646c 655f 766d 5f72  self.handle_vm_r
-0002ca10: 6573 756c 7428 6e61 6d65 2c20 7072 6f66  esult(name, prof
-0002ca20: 696c 652c 2072 6573 756c 743d 7265 7375  ile, result=resu
-0002ca30: 6c74 2c20 6e65 7776 6d73 3d6e 6577 766d  lt, newvms=newvm
-0002ca40: 732c 2066 6169 6c65 6476 6d73 3d66 6169  s, failedvms=fai
-0002ca50: 6c65 6476 6d73 2c0a 2020 2020 2020 2020  ledvms,.        
-0002ca60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ca70: 2020 2020 2020 6173 796e 6377 6169 7476        asyncwaitv
-0002ca80: 6d73 3d61 7379 6e63 7761 6974 766d 732c  ms=asyncwaitvms,
-0002ca90: 206f 6e6c 7961 7373 6574 733d 6f6e 6c79   onlyassets=only
-0002caa0: 6173 7365 7473 2c20 6e65 7761 7373 6574  assets, newasset
-0002cab0: 733d 6e65 7761 7373 6574 732c 2076 6d63  s=newassets, vmc
-0002cac0: 6c69 656e 743d 766d 636c 6965 6e74 290a  lient=vmclient).
-0002cad0: 0a20 2020 2064 6566 2070 6172 7365 5f66  .    def parse_f
-0002cae0: 696c 6573 2873 656c 662c 206e 616d 652c  iles(self, name,
-0002caf0: 2066 696c 6573 2c20 6261 7365 6469 723d   files, basedir=
-0002cb00: 272e 272c 206f 6e66 6c79 3d4e 6f6e 6529  '.', onfly=None)
-0002cb10: 3a0a 2020 2020 2020 2020 6966 206e 6f74  :.        if not
-0002cb20: 2066 696c 6573 3a0a 2020 2020 2020 2020   files:.        
-0002cb30: 2020 2020 7265 7475 726e 0a20 2020 2020      return.     
-0002cb40: 2020 2066 6f72 2069 6e64 6578 2c20 6669     for index, fi
-0002cb50: 6c20 696e 2065 6e75 6d65 7261 7465 2866  l in enumerate(f
-0002cb60: 696c 6573 293a 0a20 2020 2020 2020 2020  iles):.         
-0002cb70: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
-0002cb80: 2866 696c 2c20 7374 7229 3a0a 2020 2020  (fil, str):.    
-0002cb90: 2020 2020 2020 2020 2020 2020 7061 7468              path
-0002cba0: 203d 2066 222f 726f 6f74 2f7b 6669 6c7d   = f"/root/{fil}
-0002cbb0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0002cbc0: 2020 6966 2062 6173 6564 6972 2021 3d20    if basedir != 
-0002cbd0: 272e 273a 0a20 2020 2020 2020 2020 2020  '.':.           
-0002cbe0: 2020 2020 2020 2020 206f 7269 6769 6e20           origin 
-0002cbf0: 3d20 6622 7b62 6173 6564 6972 7d2f 7b70  = f"{basedir}/{p
-0002cc00: 6174 687d 220a 2020 2020 2020 2020 2020  ath}".          
-0002cc10: 2020 2020 2020 6f72 6967 696e 203d 2066        origin = f
-0002cc20: 696c 0a20 2020 2020 2020 2020 2020 2020  il.             
-0002cc30: 2020 2063 6f6e 7465 6e74 203d 204e 6f6e     content = Non
-0002cc40: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-0002cc50: 2020 6669 6c65 735b 696e 6465 785d 203d    files[index] =
-0002cc60: 207b 2770 6174 6827 3a20 7061 7468 2c20   {'path': path, 
-0002cc70: 276f 7269 6769 6e27 3a20 6f72 6967 696e  'origin': origin
-0002cc80: 7d0a 2020 2020 2020 2020 2020 2020 656c  }.            el
-0002cc90: 6966 2069 7369 6e73 7461 6e63 6528 6669  if isinstance(fi
-0002cca0: 6c2c 2064 6963 7429 3a0a 2020 2020 2020  l, dict):.      
-0002ccb0: 2020 2020 2020 2020 2020 6f72 6967 696e            origin
-0002ccc0: 203d 2066 696c 2e67 6574 2827 6f72 6967   = fil.get('orig
-0002ccd0: 696e 2729 0a20 2020 2020 2020 2020 2020  in').           
-0002cce0: 2020 2020 2063 6f6e 7465 6e74 203d 2066       content = f
-0002ccf0: 696c 2e67 6574 2827 636f 6e74 656e 7427  il.get('content'
-0002cd00: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0002cd10: 2020 7061 7468 203d 2066 696c 2e67 6574    path = fil.get
-0002cd20: 2827 7061 7468 2729 0a20 2020 2020 2020  ('path').       
-0002cd30: 2020 2020 2020 2020 2069 6620 7061 7468           if path
-0002cd40: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-0002cd50: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0002cd60: 206f 7269 6769 6e20 6973 206e 6f74 204e   origin is not N
-0002cd70: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-0002cd80: 2020 2020 2020 2020 2020 2020 2066 696c               fil
-0002cd90: 6573 5b69 6e64 6578 5d5b 2770 6174 6827  es[index]['path'
-0002cda0: 5d20 3d20 6622 2f72 6f6f 742f 7b6f 7269  ] = f"/root/{ori
-0002cdb0: 6769 6e7d 220a 2020 2020 2020 2020 2020  gin}".          
-0002cdc0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-0002cdd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002cde0: 2020 2020 2020 2020 6572 726f 7228 6622          error(f"
-0002cdf0: 496e 636f 7272 6563 7420 656e 7472 7920  Incorrect entry 
-0002ce00: 7b66 696c 7d2e 4c65 6176 696e 672e 2e2e  {fil}.Leaving...
-0002ce10: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-0002ce20: 2020 2020 2020 2020 2020 2073 7973 2e65             sys.e
-0002ce30: 7869 7428 3129 0a20 2020 2020 2020 2020  xit(1).         
-0002ce40: 2020 2020 2020 2065 6c69 6620 6e6f 7420         elif not 
-0002ce50: 7061 7468 2e73 7461 7274 7377 6974 6828  path.startswith(
-0002ce60: 272f 2729 3a0a 2020 2020 2020 2020 2020  '/'):.          
-0002ce70: 2020 2020 2020 2020 2020 6572 726f 7228            error(
-0002ce80: 6622 496e 636f 7272 6563 7420 7061 7468  f"Incorrect path
-0002ce90: 207b 7061 7468 7d2e 4c65 6176 696e 672e   {path}.Leaving.
-0002cea0: 2e2e 2229 0a20 2020 2020 2020 2020 2020  ..").           
-0002ceb0: 2020 2020 2020 2020 2073 7973 2e65 7869           sys.exi
-0002cec0: 7428 3129 0a20 2020 2020 2020 2020 2020  t(1).           
-0002ced0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0002cee0: 2020 2020 2020 2072 6574 7572 6e20 7b27         return {'
-0002cef0: 7265 7375 6c74 273a 2027 6661 696c 7572  result': 'failur
-0002cf00: 6527 2c20 2772 6561 736f 6e27 3a20 2249  e', 'reason': "I
-0002cf10: 6e63 6f72 7265 6374 2066 696c 6520 656e  ncorrect file en
-0002cf20: 7472 7922 7d0a 2020 2020 2020 2020 2020  try"}.          
-0002cf30: 2020 6966 206f 7269 6769 6e20 6973 206e    if origin is n
-0002cf40: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-0002cf50: 2020 2020 2020 2020 2069 6620 6f6e 666c           if onfl
-0002cf60: 7920 6973 206e 6f74 204e 6f6e 6520 616e  y is not None an
-0002cf70: 6420 277e 2720 6e6f 7420 696e 206f 7269  d '~' not in ori
+0002c0e0: 6375 726c 636d 6420 2b3d 2027 202d 4620  curlcmd += ' -F 
+0002c0f0: 223d 283b 7479 7065 3d6d 756c 7469 7061  "=(;type=multipa
+0002c100: 7274 2f6d 6978 6564 2220 2d46 2022 3d24  rt/mixed" -F "=$
+0002c110: 2863 6174 202f 7661 722f 746d 702f 6d61  (cat /var/tmp/ma
+0002c120: 696c 2e74 7874 293b 7479 7065 3d74 6578  il.txt);type=tex
+0002c130: 742f 706c 6169 6e22 270a 2020 2020 2020  t/plain"'.      
+0002c140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c150: 2020 6375 726c 636d 6420 2b3d 2066 2720    curlcmd += f' 
+0002c160: 2d46 2022 6669 6c65 3d40 7b6b 7562 6563  -F "file=@{kubec
+0002c170: 6f6e 6669 677d 3b74 7970 653d 7465 7874  onfig};type=text
+0002c180: 2f70 6c61 696e 3b65 6e63 6f64 6572 3d62  /plain;encoder=b
+0002c190: 6173 6536 3422 202d 4620 223d 2922 270a  ase64" -F "=)"'.
+0002c1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c1b0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0002c1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c1d0: 2020 6375 726c 636d 6420 2b3d 2022 202d    curlcmd += " -
+0002c1e0: 2d75 706c 6f61 642d 6669 6c65 202f 7661  -upload-file /va
+0002c1f0: 722f 746d 702f 6d61 696c 2e74 7874 220a  r/tmp/mail.txt".
+0002c200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c210: 2020 2020 6d61 696c 636d 642e 6170 7065      mailcmd.appe
+0002c220: 6e64 2863 7572 6c63 6d64 290a 2020 2020  nd(curlcmd).    
+0002c230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c240: 636d 6473 2e65 7874 656e 6428 6d61 696c  cmds.extend(mail
+0002c250: 636d 6429 0a20 2020 2020 2020 2020 2020  cmd).           
+0002c260: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0002c270: 2020 2020 2020 2065 7272 6f72 2866 2249         error(f"I
+0002c280: 6e76 616c 6964 206d 6574 686f 6420 7b6e  nvalid method {n
+0002c290: 6f74 6966 796d 6574 686f 647d 2229 0a20  otifymethod}"). 
+0002c2a0: 2020 2020 2020 2072 6574 7572 6e20 636d         return cm
+0002c2b0: 6473 2c20 6d61 696c 636f 6e74 656e 740a  ds, mailcontent.
+0002c2c0: 0a20 2020 2064 6566 2068 616e 646c 655f  .    def handle_
+0002c2d0: 766d 5f72 6573 756c 7428 7365 6c66 2c20  vm_result(self, 
+0002c2e0: 6e61 6d65 2c20 7072 6f66 696c 652c 2072  name, profile, r
+0002c2f0: 6573 756c 742c 206e 6577 766d 732c 2066  esult, newvms, f
+0002c300: 6169 6c65 6476 6d73 2c20 6173 796e 6377  ailedvms, asyncw
+0002c310: 6169 7476 6d73 2c20 6f6e 6c79 6173 7365  aitvms, onlyasse
+0002c320: 7473 3d46 616c 7365 2c20 6e65 7761 7373  ts=False, newass
+0002c330: 6574 733d 5b5d 2c0a 2020 2020 2020 2020  ets=[],.        
+0002c340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c350: 2076 6d63 6c69 656e 743d 4e6f 6e65 293a   vmclient=None):
+0002c360: 0a20 2020 2020 2020 2069 6620 2772 6573  .        if 'res
+0002c370: 756c 7427 2069 6e20 7265 7375 6c74 2061  ult' in result a
+0002c380: 6e64 2072 6573 756c 745b 2772 6573 756c  nd result['resul
+0002c390: 7427 5d20 3d3d 2027 7375 6363 6573 7327  t'] == 'success'
+0002c3a0: 3a0a 2020 2020 2020 2020 2020 2020 6e65  :.            ne
+0002c3b0: 7776 6d73 2e61 7070 656e 6428 6e61 6d65  wvms.append(name
+0002c3c0: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
+0002c3d0: 2020 2020 2020 2020 2020 2020 6661 696c              fail
+0002c3e0: 6564 766d 732e 6170 7065 6e64 287b 276e  edvms.append({'n
+0002c3f0: 616d 6527 3a20 6e61 6d65 2c20 2772 6561  ame': name, 'rea
+0002c400: 736f 6e27 3a20 7265 7375 6c74 5b27 7265  son': result['re
+0002c410: 6173 6f6e 275d 7d29 0a20 2020 2020 2020  ason']}).       
+0002c420: 2073 7461 7274 203d 2070 726f 6669 6c65   start = profile
+0002c430: 2e67 6574 2827 7374 6172 7427 2c20 5472  .get('start', Tr
+0002c440: 7565 290a 2020 2020 2020 2020 636c 6f75  ue).        clou
+0002c450: 6469 6e69 7420 3d20 7072 6f66 696c 652e  dinit = profile.
+0002c460: 6765 7428 2763 6c6f 7564 696e 6974 272c  get('cloudinit',
+0002c470: 2054 7275 6529 0a20 2020 2020 2020 2061   True).        a
+0002c480: 7379 6e63 7761 6974 203d 2070 726f 6669  syncwait = profi
+0002c490: 6c65 2e67 6574 2827 6173 796e 6377 6169  le.get('asyncwai
+0002c4a0: 7427 2c20 4661 6c73 6529 0a20 2020 2020  t', False).     
+0002c4b0: 2020 2066 696e 6973 6866 696c 6573 203d     finishfiles =
+0002c4c0: 2070 726f 6669 6c65 2e67 6574 2827 6669   profile.get('fi
+0002c4d0: 6e69 7368 6669 6c65 7327 2c20 5b5d 290a  nishfiles', []).
+0002c4e0: 2020 2020 2020 2020 6966 206f 6e6c 7961          if onlya
+0002c4f0: 7373 6574 733a 0a20 2020 2020 2020 2020  ssets:.         
+0002c500: 2020 2069 6620 2764 6174 6127 2069 6e20     if 'data' in 
+0002c510: 7265 7375 6c74 3a0a 2020 2020 2020 2020  result:.        
+0002c520: 2020 2020 2020 2020 6e65 7761 7373 6574          newasset
+0002c530: 732e 6170 7065 6e64 2872 6573 756c 745b  s.append(result[
+0002c540: 2764 6174 6127 5d29 0a20 2020 2020 2020  'data']).       
+0002c550: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0002c560: 2020 2020 2020 2020 2020 2065 7272 6f72             error
+0002c570: 2872 6573 756c 745b 2772 6561 736f 6e27  (result['reason'
+0002c580: 5d29 0a20 2020 2020 2020 2069 6620 6e6f  ]).        if no
+0002c590: 7420 6173 796e 6377 6169 743a 0a20 2020  t asyncwait:.   
+0002c5a0: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
+0002c5b0: 2020 2020 2020 2020 656c 6966 206e 6f74          elif not
+0002c5c0: 2073 7461 7274 206f 7220 6e6f 7420 636c   start or not cl
+0002c5d0: 6f75 6469 6e69 7420 6f72 2070 726f 6669  oudinit or profi
+0002c5e0: 6c65 2e67 6574 2827 696d 6167 6527 2920  le.get('image') 
+0002c5f0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+0002c600: 2020 2020 2070 7072 696e 7428 6622 536b       pprint(f"Sk
+0002c610: 6970 7069 6e67 2077 6169 7420 6f6e 207b  ipping wait on {
+0002c620: 6e61 6d65 7d22 290a 2020 2020 2020 2020  name}").        
+0002c630: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0002c640: 2020 7761 6974 636f 6d6d 616e 6420 3d20    waitcommand = 
+0002c650: 7072 6f66 696c 652e 6765 7428 2777 6169  profile.get('wai
+0002c660: 7463 6f6d 6d61 6e64 2729 0a20 2020 2020  tcommand').     
+0002c670: 2020 2020 2020 2077 6169 7474 696d 656f         waittimeo
+0002c680: 7574 203d 2070 726f 6669 6c65 2e67 6574  ut = profile.get
+0002c690: 2827 7761 6974 7469 6d65 6f75 7427 2c20  ('waittimeout', 
+0002c6a0: 3029 0a20 2020 2020 2020 2020 2020 2061  0).            a
+0002c6b0: 7379 6e63 7761 6974 766d 203d 207b 276e  syncwaitvm = {'n
+0002c6c0: 616d 6527 3a20 6e61 6d65 2c20 2766 696e  ame': name, 'fin
+0002c6d0: 6973 6866 696c 6573 273a 2066 696e 6973  ishfiles': finis
+0002c6e0: 6866 696c 6573 2c20 2777 6169 7463 6f6d  hfiles, 'waitcom
+0002c6f0: 6d61 6e64 273a 2077 6169 7463 6f6d 6d61  mand': waitcomma
+0002c700: 6e64 2c0a 2020 2020 2020 2020 2020 2020  nd,.            
+0002c710: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+0002c720: 7761 6974 7469 6d65 6f75 7427 3a20 7761  waittimeout': wa
+0002c730: 6974 7469 6d65 6f75 742c 2027 766d 636c  ittimeout, 'vmcl
+0002c740: 6965 6e74 273a 2076 6d63 6c69 656e 747d  ient': vmclient}
+0002c750: 0a20 2020 2020 2020 2020 2020 2061 7379  .            asy
+0002c760: 6e63 7761 6974 766d 732e 6170 7065 6e64  ncwaitvms.append
+0002c770: 2861 7379 6e63 7761 6974 766d 290a 0a20  (asyncwaitvm).. 
+0002c780: 2020 2064 6566 2074 6872 6561 6465 645f     def threaded_
+0002c790: 6372 6561 7465 5f76 6d28 7365 6c66 2c20  create_vm(self, 
+0002c7a0: 6e61 6d65 2c20 7072 6f66 696c 656e 616d  name, profilenam
+0002c7b0: 652c 2063 7572 7265 6e74 6f76 6572 7269  e, currentoverri
+0002c7c0: 6465 732c 2070 726f 6669 6c65 2c20 7a2c  des, profile, z,
+0002c7d0: 2070 6c61 6e2c 2063 7572 7265 6e74 706c   plan, currentpl
+0002c7e0: 616e 6469 722c 2076 6d63 6c69 656e 742c  andir, vmclient,
+0002c7f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002c800: 2020 2020 2020 2020 2020 2020 6f6e 666c              onfl
+0002c810: 792c 206f 6e6c 7961 7373 6574 732c 206e  y, onlyassets, n
+0002c820: 6577 766d 732c 2066 6169 6c65 6476 6d73  ewvms, failedvms
+0002c830: 2c20 6173 796e 6377 6169 7476 6d73 2c20  , asyncwaitvms, 
+0002c840: 6e65 7761 7373 6574 7329 3a0a 2020 2020  newassets):.    
+0002c850: 2020 2020 7265 7375 6c74 203d 2073 656c      result = sel
+0002c860: 662e 6372 6561 7465 5f76 6d28 6e61 6d65  f.create_vm(name
+0002c870: 2c20 7072 6f66 696c 656e 616d 652c 206f  , profilename, o
+0002c880: 7665 7272 6964 6573 3d63 7572 7265 6e74  verrides=current
+0002c890: 6f76 6572 7269 6465 732c 2063 7573 746f  overrides, custo
+0002c8a0: 6d70 726f 6669 6c65 3d70 726f 6669 6c65  mprofile=profile
+0002c8b0: 2c20 6b3d 7a2c 0a20 2020 2020 2020 2020  , k=z,.         
+0002c8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c8d0: 2020 2020 2020 2070 6c61 6e3d 706c 616e         plan=plan
+0002c8e0: 2c20 6261 7365 6469 723d 6375 7272 656e  , basedir=curren
+0002c8f0: 7470 6c61 6e64 6972 2c20 636c 6965 6e74  tplandir, client
+0002c900: 3d76 6d63 6c69 656e 742c 206f 6e66 6c79  =vmclient, onfly
+0002c910: 3d6f 6e66 6c79 2c0a 2020 2020 2020 2020  =onfly,.        
+0002c920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c930: 2020 2020 2020 2020 6f6e 6c79 6173 7365          onlyasse
+0002c940: 7473 3d6f 6e6c 7961 7373 6574 7329 0a20  ts=onlyassets). 
+0002c950: 2020 2020 2020 2069 6620 6e6f 7420 6f6e         if not on
+0002c960: 6c79 6173 7365 7473 3a0a 2020 2020 2020  lyassets:.      
+0002c970: 2020 2020 2020 636f 6d6d 6f6e 2e68 616e        common.han
+0002c980: 646c 655f 7265 7370 6f6e 7365 2872 6573  dle_response(res
+0002c990: 756c 742c 206e 616d 652c 2063 6c69 656e  ult, name, clien
+0002c9a0: 743d 766d 636c 6965 6e74 290a 2020 2020  t=vmclient).    
+0002c9b0: 2020 2020 7365 6c66 2e68 616e 646c 655f      self.handle_
+0002c9c0: 766d 5f72 6573 756c 7428 6e61 6d65 2c20  vm_result(name, 
+0002c9d0: 7072 6f66 696c 652c 2072 6573 756c 743d  profile, result=
+0002c9e0: 7265 7375 6c74 2c20 6e65 7776 6d73 3d6e  result, newvms=n
+0002c9f0: 6577 766d 732c 2066 6169 6c65 6476 6d73  ewvms, failedvms
+0002ca00: 3d66 6169 6c65 6476 6d73 2c0a 2020 2020  =failedvms,.    
+0002ca10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ca20: 2020 2020 2020 2020 2020 6173 796e 6377            asyncw
+0002ca30: 6169 7476 6d73 3d61 7379 6e63 7761 6974  aitvms=asyncwait
+0002ca40: 766d 732c 206f 6e6c 7961 7373 6574 733d  vms, onlyassets=
+0002ca50: 6f6e 6c79 6173 7365 7473 2c20 6e65 7761  onlyassets, newa
+0002ca60: 7373 6574 733d 6e65 7761 7373 6574 732c  ssets=newassets,
+0002ca70: 2076 6d63 6c69 656e 743d 766d 636c 6965   vmclient=vmclie
+0002ca80: 6e74 290a 0a20 2020 2064 6566 2070 6172  nt)..    def par
+0002ca90: 7365 5f66 696c 6573 2873 656c 662c 206e  se_files(self, n
+0002caa0: 616d 652c 2066 696c 6573 2c20 6261 7365  ame, files, base
+0002cab0: 6469 723d 272e 272c 206f 6e66 6c79 3d4e  dir='.', onfly=N
+0002cac0: 6f6e 6529 3a0a 2020 2020 2020 2020 6966  one):.        if
+0002cad0: 206e 6f74 2066 696c 6573 3a0a 2020 2020   not files:.    
+0002cae0: 2020 2020 2020 2020 7265 7475 726e 0a20          return. 
+0002caf0: 2020 2020 2020 2066 6f72 2069 6e64 6578         for index
+0002cb00: 2c20 6669 6c20 696e 2065 6e75 6d65 7261  , fil in enumera
+0002cb10: 7465 2866 696c 6573 293a 0a20 2020 2020  te(files):.     
+0002cb20: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
+0002cb30: 616e 6365 2866 696c 2c20 7374 7229 3a0a  ance(fil, str):.
+0002cb40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002cb50: 7061 7468 203d 2066 222f 726f 6f74 2f7b  path = f"/root/{
+0002cb60: 6669 6c7d 220a 2020 2020 2020 2020 2020  fil}".          
+0002cb70: 2020 2020 2020 6966 2062 6173 6564 6972        if basedir
+0002cb80: 2021 3d20 272e 273a 0a20 2020 2020 2020   != '.':.       
+0002cb90: 2020 2020 2020 2020 2020 2020 206f 7269               ori
+0002cba0: 6769 6e20 3d20 6622 7b62 6173 6564 6972  gin = f"{basedir
+0002cbb0: 7d2f 7b70 6174 687d 220a 2020 2020 2020  }/{path}".      
+0002cbc0: 2020 2020 2020 2020 2020 6f72 6967 696e            origin
+0002cbd0: 203d 2066 696c 0a20 2020 2020 2020 2020   = fil.         
+0002cbe0: 2020 2020 2020 2063 6f6e 7465 6e74 203d         content =
+0002cbf0: 204e 6f6e 650a 2020 2020 2020 2020 2020   None.          
+0002cc00: 2020 2020 2020 6669 6c65 735b 696e 6465        files[inde
+0002cc10: 785d 203d 207b 2770 6174 6827 3a20 7061  x] = {'path': pa
+0002cc20: 7468 2c20 276f 7269 6769 6e27 3a20 6f72  th, 'origin': or
+0002cc30: 6967 696e 7d0a 2020 2020 2020 2020 2020  igin}.          
+0002cc40: 2020 656c 6966 2069 7369 6e73 7461 6e63    elif isinstanc
+0002cc50: 6528 6669 6c2c 2064 6963 7429 3a0a 2020  e(fil, dict):.  
+0002cc60: 2020 2020 2020 2020 2020 2020 2020 6f72                or
+0002cc70: 6967 696e 203d 2066 696c 2e67 6574 2827  igin = fil.get('
+0002cc80: 6f72 6967 696e 2729 0a20 2020 2020 2020  origin').       
+0002cc90: 2020 2020 2020 2020 2063 6f6e 7465 6e74           content
+0002cca0: 203d 2066 696c 2e67 6574 2827 636f 6e74   = fil.get('cont
+0002ccb0: 656e 7427 290a 2020 2020 2020 2020 2020  ent').          
+0002ccc0: 2020 2020 2020 7061 7468 203d 2066 696c        path = fil
+0002ccd0: 2e67 6574 2827 7061 7468 2729 0a20 2020  .get('path').   
+0002cce0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0002ccf0: 7061 7468 2069 7320 4e6f 6e65 3a0a 2020  path is None:.  
+0002cd00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002cd10: 2020 6966 206f 7269 6769 6e20 6973 206e    if origin is n
+0002cd20: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+0002cd30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002cd40: 2066 696c 6573 5b69 6e64 6578 5d5b 2770   files[index]['p
+0002cd50: 6174 6827 5d20 3d20 6622 2f72 6f6f 742f  ath'] = f"/root/
+0002cd60: 7b6f 7269 6769 6e7d 220a 2020 2020 2020  {origin}".      
+0002cd70: 2020 2020 2020 2020 2020 2020 2020 656c                el
+0002cd80: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0002cd90: 2020 2020 2020 2020 2020 2020 6572 726f              erro
+0002cda0: 7228 6622 496e 636f 7272 6563 7420 656e  r(f"Incorrect en
+0002cdb0: 7472 7920 7b66 696c 7d2e 4c65 6176 696e  try {fil}.Leavin
+0002cdc0: 672e 2e2e 2229 0a20 2020 2020 2020 2020  g...").         
+0002cdd0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0002cde0: 7973 2e65 7869 7428 3129 0a20 2020 2020  ys.exit(1).     
+0002cdf0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+0002ce00: 6e6f 7420 7061 7468 2e73 7461 7274 7377  not path.startsw
+0002ce10: 6974 6828 272f 2729 3a0a 2020 2020 2020  ith('/'):.      
+0002ce20: 2020 2020 2020 2020 2020 2020 2020 6572                er
+0002ce30: 726f 7228 6622 496e 636f 7272 6563 7420  ror(f"Incorrect 
+0002ce40: 7061 7468 207b 7061 7468 7d2e 4c65 6176  path {path}.Leav
+0002ce50: 696e 672e 2e2e 2229 0a20 2020 2020 2020  ing...").       
+0002ce60: 2020 2020 2020 2020 2020 2020 2073 7973               sys
+0002ce70: 2e65 7869 7428 3129 0a20 2020 2020 2020  .exit(1).       
+0002ce80: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0002ce90: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0002cea0: 6e20 7b27 7265 7375 6c74 273a 2027 6661  n {'result': 'fa
+0002ceb0: 696c 7572 6527 2c20 2772 6561 736f 6e27  ilure', 'reason'
+0002cec0: 3a20 2249 6e63 6f72 7265 6374 2066 696c  : "Incorrect fil
+0002ced0: 6520 656e 7472 7922 7d0a 2020 2020 2020  e entry"}.      
+0002cee0: 2020 2020 2020 6966 206f 7269 6769 6e20        if origin 
+0002cef0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+0002cf00: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0002cf10: 6f6e 666c 7920 6973 206e 6f74 204e 6f6e  onfly is not Non
+0002cf20: 6520 616e 6420 277e 2720 6e6f 7420 696e  e and '~' not in
+0002cf30: 206f 7269 6769 6e3a 0a20 2020 2020 2020   origin:.       
+0002cf40: 2020 2020 2020 2020 2020 2020 2064 6573               des
+0002cf50: 7464 6972 203d 2062 6173 6564 6972 0a20  tdir = basedir. 
+0002cf60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002cf70: 2020 2069 6620 272f 2720 696e 206f 7269     if '/' in ori
 0002cf80: 6769 6e3a 0a20 2020 2020 2020 2020 2020  gin:.           
-0002cf90: 2020 2020 2020 2020 2064 6573 7464 6972           destdir
-0002cfa0: 203d 2062 6173 6564 6972 0a20 2020 2020   = basedir.     
-0002cfb0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0002cfc0: 6620 272f 2720 696e 206f 7269 6769 6e3a  f '/' in origin:
-0002cfd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002cfe0: 2020 2020 2020 2020 2064 6573 7464 6972           destdir
-0002cff0: 203d 206f 732e 7061 7468 2e64 6972 6e61   = os.path.dirna
-0002d000: 6d65 286f 7269 6769 6e29 0a20 2020 2020  me(origin).     
-0002d010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d020: 2020 206f 732e 6d61 6b65 6469 7273 2864     os.makedirs(d
-0002d030: 6573 7464 6972 2c20 6578 6973 745f 6f6b  estdir, exist_ok
-0002d040: 3d54 7275 6529 0a20 2020 2020 2020 2020  =True).         
-0002d050: 2020 2020 2020 2020 2020 2063 6f6d 6d6f             commo
-0002d060: 6e2e 6665 7463 6828 6622 7b6f 6e66 6c79  n.fetch(f"{onfly
-0002d070: 7d2f 7b6f 7269 6769 6e7d 222c 2064 6573  }/{origin}", des
-0002d080: 7464 6972 290a 2020 2020 2020 2020 2020  tdir).          
-0002d090: 2020 2020 2020 6f72 6967 696e 203d 206f        origin = o
-0002d0a0: 732e 7061 7468 2e65 7870 616e 6475 7365  s.path.expanduse
-0002d0b0: 7228 6f72 6967 696e 290a 2020 2020 2020  r(origin).      
-0002d0c0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-0002d0d0: 206f 732e 7061 7468 2e69 7361 6273 286f   os.path.isabs(o
-0002d0e0: 7269 6769 6e29 3a0a 2020 2020 2020 2020  rigin):.        
-0002d0f0: 2020 2020 2020 2020 2020 2020 6966 2069              if i
-0002d100: 7369 6e73 7461 6e63 6528 6669 6c2c 2064  sinstance(fil, d
-0002d110: 6963 7429 2061 6e64 2066 696c 2e67 6574  ict) and fil.get
-0002d120: 2827 6375 7272 656e 7464 6972 272c 2046  ('currentdir', F
-0002d130: 616c 7365 293a 0a20 2020 2020 2020 2020  alse):.         
-0002d140: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-0002d150: 7269 6769 6e20 3d20 6622 7b6f 732e 6765  rigin = f"{os.ge
-0002d160: 7463 7764 2829 7d2f 7b6f 7269 6769 6e7d  tcwd()}/{origin}
-0002d170: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0002d180: 2020 2020 2020 2020 2020 6669 6c65 735b            files[
-0002d190: 696e 6465 785d 5b27 6f72 6967 696e 275d  index]['origin']
-0002d1a0: 203d 206f 7269 6769 6e0a 2020 2020 2020   = origin.      
-0002d1b0: 2020 2020 2020 2020 2020 2020 2020 656c                el
-0002d1c0: 6966 2062 6173 6564 6972 2021 3d20 272e  if basedir != '.
-0002d1d0: 2720 616e 6420 6e6f 7420 6f72 6967 696e  ' and not origin
-0002d1e0: 2e73 7461 7274 7377 6974 6828 272e 2f27  .startswith('./'
-0002d1f0: 2920 616e 6420 6e6f 7420 6f72 6967 696e  ) and not origin
-0002d200: 2e73 7461 7274 7377 6974 6828 272f 776f  .startswith('/wo
-0002d210: 726b 6469 722f 2729 3a0a 2020 2020 2020  rkdir/'):.      
-0002d220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d230: 2020 6f72 6967 696e 203d 2066 227b 6261    origin = f"{ba
-0002d240: 7365 6469 727d 2f7b 6f72 6967 696e 7d22  sedir}/{origin}"
-0002d250: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002d260: 2020 2020 2020 2020 2066 696c 6573 5b69           files[i
-0002d270: 6e64 6578 5d5b 276f 7269 6769 6e27 5d20  ndex]['origin'] 
-0002d280: 3d20 6f72 6967 696e 0a20 2020 2020 2020  = origin.       
-0002d290: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-0002d2a0: 6f73 2e70 6174 682e 6578 6973 7473 286f  os.path.exists(o
-0002d2b0: 7269 6769 6e29 3a0a 2020 2020 2020 2020  rigin):.        
-0002d2c0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0002d2d0: 726e 207b 2772 6573 756c 7427 3a20 2766  rn {'result': 'f
-0002d2e0: 6169 6c75 7265 272c 2027 7265 6173 6f6e  ailure', 'reason
-0002d2f0: 273a 2066 224f 7269 6769 6e20 6669 6c65  ': f"Origin file
-0002d300: 207b 6f72 6967 696e 7d20 6e6f 7420 666f   {origin} not fo
-0002d310: 756e 6420 666f 7220 7b6e 616d 657d 227d  und for {name}"}
-0002d320: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
-0002d330: 6620 636f 6e74 656e 7420 6973 204e 6f6e  f content is Non
-0002d340: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0002d350: 2020 2072 6574 7572 6e20 7b27 7265 7375     return {'resu
-0002d360: 6c74 273a 2027 6661 696c 7572 6527 2c20  lt': 'failure', 
-0002d370: 2772 6561 736f 6e27 3a20 6622 436f 6e74  'reason': f"Cont
-0002d380: 656e 7420 6f66 2066 696c 6520 7b70 6174  ent of file {pat
-0002d390: 687d 206e 6f74 2066 6f75 6e64 2066 6f72  h} not found for
-0002d3a0: 207b 6e61 6d65 7d22 7d0a 0a20 2020 2064   {name}"}..    d
-0002d3b0: 6566 2070 7265 7065 6e64 5f69 6e70 7574  ef prepend_input
-0002d3c0: 5f64 6972 2873 656c 662c 206e 6577 6669  _dir(self, newfi
-0002d3d0: 6c65 732c 2069 6e70 7574 6469 7229 3a0a  les, inputdir):.
-0002d3e0: 2020 2020 2020 2020 7265 7375 6c74 7320          results 
-0002d3f0: 3d20 5b5d 0a20 2020 2020 2020 2066 6f72  = [].        for
-0002d400: 2066 6963 2069 6e20 6e65 7766 696c 6573   fic in newfiles
-0002d410: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-0002d420: 2069 7369 6e73 7461 6e63 6528 6669 632c   isinstance(fic,
-0002d430: 2073 7472 2920 616e 6420 6e6f 7420 6f73   str) and not os
-0002d440: 2e70 6174 682e 6973 6162 7328 6669 6329  .path.isabs(fic)
-0002d450: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0002d460: 2020 6e65 775f 6669 6320 3d20 6622 7b69    new_fic = f"{i
-0002d470: 6e70 7574 6469 727d 2f7b 6669 637d 220a  nputdir}/{fic}".
-0002d480: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-0002d490: 2069 7369 6e73 7461 6e63 6528 6669 632c   isinstance(fic,
-0002d4a0: 2064 6963 7429 2061 6e64 2027 6f72 6967   dict) and 'orig
-0002d4b0: 696e 2720 696e 2066 6963 2061 6e64 206e  in' in fic and n
-0002d4c0: 6f74 206f 732e 7061 7468 2e69 7361 6273  ot os.path.isabs
-0002d4d0: 286f 732e 7061 7468 2e65 7870 616e 6475  (os.path.expandu
-0002d4e0: 7365 7228 6669 635b 276f 7269 6769 6e27  ser(fic['origin'
-0002d4f0: 5d29 293a 0a20 2020 2020 2020 2020 2020  ])):.           
-0002d500: 2020 2020 206e 6577 5f66 6963 203d 2066       new_fic = f
-0002d510: 6963 2e63 6f70 7928 290a 2020 2020 2020  ic.copy().      
-0002d520: 2020 2020 2020 2020 2020 6e65 775f 6669            new_fi
-0002d530: 635b 276f 7269 6769 6e27 5d20 3d20 6622  c['origin'] = f"
-0002d540: 7b69 6e70 7574 6469 727d 2f7b 6669 635b  {inputdir}/{fic[
-0002d550: 276f 7269 6769 6e27 5d7d 220a 2020 2020  'origin']}".    
-0002d560: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0002d570: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
-0002d580: 775f 6669 6320 3d20 6669 630a 2020 2020  w_fic = fic.    
-0002d590: 2020 2020 2020 2020 7265 7375 6c74 732e          results.
-0002d5a0: 6170 7065 6e64 286e 6577 5f66 6963 290a  append(new_fic).
-0002d5b0: 2020 2020 2020 2020 7265 7475 726e 2072          return r
-0002d5c0: 6573 756c 7473 0a0a 2020 2020 6465 6620  esults..    def 
-0002d5d0: 7265 6d65 6469 6174 655f 6669 6c65 7328  remediate_files(
-0002d5e0: 7365 6c66 2c20 6e61 6d65 2c20 6e65 7766  self, name, newf
-0002d5f0: 696c 6573 2c20 6f76 6572 7269 6465 733d  iles, overrides=
-0002d600: 7b7d 2c20 696e 7075 7464 6972 3d27 2e27  {}, inputdir='.'
-0002d610: 293a 0a20 2020 2020 2020 2075 7064 6174  ):.        updat
-0002d620: 6564 5f66 696c 6573 203d 205b 5d0a 2020  ed_files = [].  
-0002d630: 2020 2020 2020 6970 2c20 766d 706f 7274        ip, vmport
-0002d640: 203d 205f 7373 685f 6372 6564 656e 7469   = _ssh_credenti
-0002d650: 616c 7328 7365 6c66 2e6b 2c20 6e61 6d65  als(self.k, name
-0002d660: 295b 313a 5d0a 2020 2020 2020 2020 6966  )[1:].        if
-0002d670: 2069 6e70 7574 6469 7220 213d 2027 2e27   inputdir != '.'
-0002d680: 3a0a 2020 2020 2020 2020 2020 2020 6e65  :.            ne
-0002d690: 7766 696c 6573 203d 2073 656c 662e 7072  wfiles = self.pr
-0002d6a0: 6570 656e 645f 696e 7075 745f 6469 7228  epend_input_dir(
-0002d6b0: 6e65 7766 696c 6573 2c20 696e 7075 7464  newfiles, inputd
-0002d6c0: 6972 290a 2020 2020 2020 2020 7365 6c66  ir).        self
-0002d6d0: 2e70 6172 7365 5f66 696c 6573 286e 616d  .parse_files(nam
-0002d6e0: 652c 206e 6577 6669 6c65 7329 0a20 2020  e, newfiles).   
-0002d6f0: 2020 2020 206f 7665 7272 6964 6573 5f66       overrides_f
-0002d700: 696c 6573 203d 206f 7665 7272 6964 6573  iles = overrides
-0002d710: 2e63 6f70 7928 290a 2020 2020 2020 2020  .copy().        
-0002d720: 6f76 6572 7269 6465 735f 6669 6c65 735b  overrides_files[
-0002d730: 276e 616d 6527 5d20 3d20 6e61 6d65 0a20  'name'] = name. 
-0002d740: 2020 2020 2020 2064 6174 6120 3d20 7072         data = pr
-0002d750: 6f63 6573 735f 6669 6c65 7328 6669 6c65  ocess_files(file
-0002d760: 733d 6e65 7766 696c 6573 2c20 6f76 6572  s=newfiles, over
-0002d770: 7269 6465 733d 6f76 6572 7269 6465 735f  rides=overrides_
-0002d780: 6669 6c65 732c 2072 656d 6564 6961 7465  files, remediate
-0002d790: 3d54 7275 6529 0a20 2020 2020 2020 2064  =True).        d
-0002d7a0: 6174 6164 6972 7320 3d20 7b7d 0a20 2020  atadirs = {}.   
-0002d7b0: 2020 2020 2077 6974 6820 5465 6d70 6f72       with Tempor
-0002d7c0: 6172 7944 6972 6563 746f 7279 2829 2061  aryDirectory() a
-0002d7d0: 7320 746d 7064 6972 3a0a 2020 2020 2020  s tmpdir:.      
-0002d7e0: 2020 2020 2020 666f 7220 696e 6465 782c        for index,
-0002d7f0: 2065 6e74 7279 2069 6e20 656e 756d 6572   entry in enumer
-0002d800: 6174 6528 6461 7461 293a 0a20 2020 2020  ate(data):.     
-0002d810: 2020 2020 2020 2020 2020 2064 6573 7469             desti
-0002d820: 6e61 7469 6f6e 203d 2065 6e74 7279 5b27  nation = entry['
-0002d830: 7061 7468 275d 0a20 2020 2020 2020 2020  path'].         
-0002d840: 2020 2020 2020 2070 6174 6864 6972 203d         pathdir =
-0002d850: 206f 732e 7061 7468 2e64 6972 6e61 6d65   os.path.dirname
-0002d860: 2864 6573 7469 6e61 7469 6f6e 290a 2020  (destination).  
-0002d870: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0002d880: 2070 6174 6864 6972 206e 6f74 2069 6e20   pathdir not in 
-0002d890: 6461 7461 6469 7273 3a0a 2020 2020 2020  datadirs:.      
-0002d8a0: 2020 2020 2020 2020 2020 2020 2020 7061                pa
-0002d8b0: 7468 6469 7263 6d64 203d 2066 276c 7320  thdircmd = f'ls 
-0002d8c0: 2d61 207b 7061 7468 6469 727d 2032 3e26  -a {pathdir} 2>&
-0002d8d0: 3127 0a20 2020 2020 2020 2020 2020 2020  1'.             
-0002d8e0: 2020 2020 2020 2070 6174 6864 6972 636d         pathdircm
-0002d8f0: 6420 3d20 7373 6828 6e61 6d65 2c20 6970  d = ssh(name, ip
-0002d900: 3d69 702c 2075 7365 723d 2772 6f6f 7427  =ip, user='root'
-0002d910: 2c20 7475 6e6e 656c 3d73 656c 662e 7475  , tunnel=self.tu
-0002d920: 6e6e 656c 2c20 7475 6e6e 656c 686f 7374  nnel, tunnelhost
-0002d930: 3d73 656c 662e 7475 6e6e 656c 686f 7374  =self.tunnelhost
-0002d940: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0002d950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d960: 2020 2020 2020 2074 756e 6e65 6c70 6f72         tunnelpor
-0002d970: 743d 7365 6c66 2e74 756e 6e65 6c70 6f72  t=self.tunnelpor
-0002d980: 742c 2074 756e 6e65 6c75 7365 723d 7365  t, tunneluser=se
-0002d990: 6c66 2e74 756e 6e65 6c75 7365 722c 2069  lf.tunneluser, i
-0002d9a0: 6e73 6563 7572 653d 5472 7565 2c0a 2020  nsecure=True,.  
-0002d9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d9d0: 2020 2063 6d64 3d70 6174 6864 6972 636d     cmd=pathdircm
-0002d9e0: 642c 2076 6d70 6f72 743d 766d 706f 7274  d, vmport=vmport
-0002d9f0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0002da00: 2020 2020 2020 7061 7468 6469 7266 696c        pathdirfil
-0002da10: 6573 203d 206f 732e 706f 7065 6e28 7061  es = os.popen(pa
-0002da20: 7468 6469 7263 6d64 292e 7265 6164 6c69  thdircmd).readli
-0002da30: 6e65 7328 290a 2020 2020 2020 2020 2020  nes().          
-0002da40: 2020 2020 2020 2020 2020 6966 206c 656e            if len
-0002da50: 2870 6174 6864 6972 6669 6c65 7329 203d  (pathdirfiles) =
-0002da60: 3d20 3120 616e 6420 274e 6f20 7375 6368  = 1 and 'No such
-0002da70: 2066 696c 6520 6f72 2064 6972 6563 746f   file or directo
-0002da80: 7279 2720 696e 2070 6174 6864 6972 6669  ry' in pathdirfi
-0002da90: 6c65 735b 305d 3a0a 2020 2020 2020 2020  les[0]:.        
-0002daa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002dab0: 6372 6561 7465 6469 7263 6d64 203d 2066  createdircmd = f
-0002dac0: 276d 6b64 6972 202d 7020 7b70 6174 6864  'mkdir -p {pathd
-0002dad0: 6972 7d27 0a20 2020 2020 2020 2020 2020  ir}'.           
-0002dae0: 2020 2020 2020 2020 2020 2020 2063 7265               cre
-0002daf0: 6174 6564 6972 636d 6420 3d20 7373 6828  atedircmd = ssh(
-0002db00: 6e61 6d65 2c20 6970 3d69 702c 2075 7365  name, ip=ip, use
-0002db10: 723d 2772 6f6f 7427 2c20 7475 6e6e 656c  r='root', tunnel
-0002db20: 3d73 656c 662e 7475 6e6e 656c 2c20 7475  =self.tunnel, tu
-0002db30: 6e6e 656c 686f 7374 3d73 656c 662e 7475  nnelhost=self.tu
-0002db40: 6e6e 656c 686f 7374 2c0a 2020 2020 2020  nnelhost,.      
-0002db50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002db60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002db70: 2020 2020 2074 756e 6e65 6c70 6f72 743d       tunnelport=
-0002db80: 7365 6c66 2e74 756e 6e65 6c70 6f72 742c  self.tunnelport,
-0002db90: 2074 756e 6e65 6c75 7365 723d 7365 6c66   tunneluser=self
-0002dba0: 2e74 756e 6e65 6c75 7365 722c 2069 6e73  .tunneluser, ins
-0002dbb0: 6563 7572 653d 5472 7565 2c0a 2020 2020  ecure=True,.    
+0002cf90: 2020 2020 2020 2020 2020 2020 2064 6573               des
+0002cfa0: 7464 6972 203d 206f 732e 7061 7468 2e64  tdir = os.path.d
+0002cfb0: 6972 6e61 6d65 286f 7269 6769 6e29 0a20  irname(origin). 
+0002cfc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002cfd0: 2020 2020 2020 206f 732e 6d61 6b65 6469         os.makedi
+0002cfe0: 7273 2864 6573 7464 6972 2c20 6578 6973  rs(destdir, exis
+0002cff0: 745f 6f6b 3d54 7275 6529 0a20 2020 2020  t_ok=True).     
+0002d000: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0002d010: 6f6d 6d6f 6e2e 6665 7463 6828 6622 7b6f  ommon.fetch(f"{o
+0002d020: 6e66 6c79 7d2f 7b6f 7269 6769 6e7d 222c  nfly}/{origin}",
+0002d030: 2064 6573 7464 6972 290a 2020 2020 2020   destdir).      
+0002d040: 2020 2020 2020 2020 2020 6f72 6967 696e            origin
+0002d050: 203d 206f 732e 7061 7468 2e65 7870 616e   = os.path.expan
+0002d060: 6475 7365 7228 6f72 6967 696e 290a 2020  duser(origin).  
+0002d070: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0002d080: 206e 6f74 206f 732e 7061 7468 2e69 7361   not os.path.isa
+0002d090: 6273 286f 7269 6769 6e29 3a0a 2020 2020  bs(origin):.    
+0002d0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d0b0: 6966 2069 7369 6e73 7461 6e63 6528 6669  if isinstance(fi
+0002d0c0: 6c2c 2064 6963 7429 2061 6e64 2066 696c  l, dict) and fil
+0002d0d0: 2e67 6574 2827 6375 7272 656e 7464 6972  .get('currentdir
+0002d0e0: 272c 2046 616c 7365 293a 0a20 2020 2020  ', False):.     
+0002d0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d100: 2020 206f 7269 6769 6e20 3d20 6622 7b6f     origin = f"{o
+0002d110: 732e 6765 7463 7764 2829 7d2f 7b6f 7269  s.getcwd()}/{ori
+0002d120: 6769 6e7d 220a 2020 2020 2020 2020 2020  gin}".          
+0002d130: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+0002d140: 6c65 735b 696e 6465 785d 5b27 6f72 6967  les[index]['orig
+0002d150: 696e 275d 203d 206f 7269 6769 6e0a 2020  in'] = origin.  
+0002d160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d170: 2020 656c 6966 2062 6173 6564 6972 2021    elif basedir !
+0002d180: 3d20 272e 2720 616e 6420 6e6f 7420 6f72  = '.' and not or
+0002d190: 6967 696e 2e73 7461 7274 7377 6974 6828  igin.startswith(
+0002d1a0: 272e 2f27 2920 616e 6420 6e6f 7420 6f72  './') and not or
+0002d1b0: 6967 696e 2e73 7461 7274 7377 6974 6828  igin.startswith(
+0002d1c0: 272f 776f 726b 6469 722f 2729 3a0a 2020  '/workdir/'):.  
+0002d1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d1e0: 2020 2020 2020 6f72 6967 696e 203d 2066        origin = f
+0002d1f0: 227b 6261 7365 6469 727d 2f7b 6f72 6967  "{basedir}/{orig
+0002d200: 696e 7d22 0a20 2020 2020 2020 2020 2020  in}".           
+0002d210: 2020 2020 2020 2020 2020 2020 2066 696c               fil
+0002d220: 6573 5b69 6e64 6578 5d5b 276f 7269 6769  es[index]['origi
+0002d230: 6e27 5d20 3d20 6f72 6967 696e 0a20 2020  n'] = origin.   
+0002d240: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0002d250: 6e6f 7420 6f73 2e70 6174 682e 6578 6973  not os.path.exis
+0002d260: 7473 286f 7269 6769 6e29 3a0a 2020 2020  ts(origin):.    
+0002d270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d280: 7265 7475 726e 207b 2772 6573 756c 7427  return {'result'
+0002d290: 3a20 2766 6169 6c75 7265 272c 2027 7265  : 'failure', 're
+0002d2a0: 6173 6f6e 273a 2066 224f 7269 6769 6e20  ason': f"Origin 
+0002d2b0: 6669 6c65 207b 6f72 6967 696e 7d20 6e6f  file {origin} no
+0002d2c0: 7420 666f 756e 6420 666f 7220 7b6e 616d  t found for {nam
+0002d2d0: 657d 227d 0a20 2020 2020 2020 2020 2020  e}"}.           
+0002d2e0: 2065 6c69 6620 636f 6e74 656e 7420 6973   elif content is
+0002d2f0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+0002d300: 2020 2020 2020 2072 6574 7572 6e20 7b27         return {'
+0002d310: 7265 7375 6c74 273a 2027 6661 696c 7572  result': 'failur
+0002d320: 6527 2c20 2772 6561 736f 6e27 3a20 6622  e', 'reason': f"
+0002d330: 436f 6e74 656e 7420 6f66 2066 696c 6520  Content of file 
+0002d340: 7b70 6174 687d 206e 6f74 2066 6f75 6e64  {path} not found
+0002d350: 2066 6f72 207b 6e61 6d65 7d22 7d0a 0a20   for {name}"}.. 
+0002d360: 2020 2064 6566 2070 7265 7065 6e64 5f69     def prepend_i
+0002d370: 6e70 7574 5f64 6972 2873 656c 662c 206e  nput_dir(self, n
+0002d380: 6577 6669 6c65 732c 2069 6e70 7574 6469  ewfiles, inputdi
+0002d390: 7229 3a0a 2020 2020 2020 2020 7265 7375  r):.        resu
+0002d3a0: 6c74 7320 3d20 5b5d 0a20 2020 2020 2020  lts = [].       
+0002d3b0: 2066 6f72 2066 6963 2069 6e20 6e65 7766   for fic in newf
+0002d3c0: 696c 6573 3a0a 2020 2020 2020 2020 2020  iles:.          
+0002d3d0: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+0002d3e0: 6669 632c 2073 7472 2920 616e 6420 6e6f  fic, str) and no
+0002d3f0: 7420 6f73 2e70 6174 682e 6973 6162 7328  t os.path.isabs(
+0002d400: 6669 6329 3a0a 2020 2020 2020 2020 2020  fic):.          
+0002d410: 2020 2020 2020 6e65 775f 6669 6320 3d20        new_fic = 
+0002d420: 6622 7b69 6e70 7574 6469 727d 2f7b 6669  f"{inputdir}/{fi
+0002d430: 637d 220a 2020 2020 2020 2020 2020 2020  c}".            
+0002d440: 656c 6966 2069 7369 6e73 7461 6e63 6528  elif isinstance(
+0002d450: 6669 632c 2064 6963 7429 2061 6e64 2027  fic, dict) and '
+0002d460: 6f72 6967 696e 2720 696e 2066 6963 2061  origin' in fic a
+0002d470: 6e64 206e 6f74 206f 732e 7061 7468 2e69  nd not os.path.i
+0002d480: 7361 6273 286f 732e 7061 7468 2e65 7870  sabs(os.path.exp
+0002d490: 616e 6475 7365 7228 6669 635b 276f 7269  anduser(fic['ori
+0002d4a0: 6769 6e27 5d29 293a 0a20 2020 2020 2020  gin'])):.       
+0002d4b0: 2020 2020 2020 2020 206e 6577 5f66 6963           new_fic
+0002d4c0: 203d 2066 6963 2e63 6f70 7928 290a 2020   = fic.copy().  
+0002d4d0: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
+0002d4e0: 775f 6669 635b 276f 7269 6769 6e27 5d20  w_fic['origin'] 
+0002d4f0: 3d20 6622 7b69 6e70 7574 6469 727d 2f7b  = f"{inputdir}/{
+0002d500: 6669 635b 276f 7269 6769 6e27 5d7d 220a  fic['origin']}".
+0002d510: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0002d520: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0002d530: 2020 6e65 775f 6669 6320 3d20 6669 630a    new_fic = fic.
+0002d540: 2020 2020 2020 2020 2020 2020 7265 7375              resu
+0002d550: 6c74 732e 6170 7065 6e64 286e 6577 5f66  lts.append(new_f
+0002d560: 6963 290a 2020 2020 2020 2020 7265 7475  ic).        retu
+0002d570: 726e 2072 6573 756c 7473 0a0a 2020 2020  rn results..    
+0002d580: 6465 6620 7265 6d65 6469 6174 655f 6669  def remediate_fi
+0002d590: 6c65 7328 7365 6c66 2c20 6e61 6d65 2c20  les(self, name, 
+0002d5a0: 6e65 7766 696c 6573 2c20 6f76 6572 7269  newfiles, overri
+0002d5b0: 6465 733d 7b7d 2c20 696e 7075 7464 6972  des={}, inputdir
+0002d5c0: 3d27 2e27 293a 0a20 2020 2020 2020 2075  ='.'):.        u
+0002d5d0: 7064 6174 6564 5f66 696c 6573 203d 205b  pdated_files = [
+0002d5e0: 5d0a 2020 2020 2020 2020 6970 2c20 766d  ].        ip, vm
+0002d5f0: 706f 7274 203d 205f 7373 685f 6372 6564  port = _ssh_cred
+0002d600: 656e 7469 616c 7328 7365 6c66 2e6b 2c20  entials(self.k, 
+0002d610: 6e61 6d65 295b 313a 5d0a 2020 2020 2020  name)[1:].      
+0002d620: 2020 6966 2069 6e70 7574 6469 7220 213d    if inputdir !=
+0002d630: 2027 2e27 3a0a 2020 2020 2020 2020 2020   '.':.          
+0002d640: 2020 6e65 7766 696c 6573 203d 2073 656c    newfiles = sel
+0002d650: 662e 7072 6570 656e 645f 696e 7075 745f  f.prepend_input_
+0002d660: 6469 7228 6e65 7766 696c 6573 2c20 696e  dir(newfiles, in
+0002d670: 7075 7464 6972 290a 2020 2020 2020 2020  putdir).        
+0002d680: 7365 6c66 2e70 6172 7365 5f66 696c 6573  self.parse_files
+0002d690: 286e 616d 652c 206e 6577 6669 6c65 7329  (name, newfiles)
+0002d6a0: 0a20 2020 2020 2020 206f 7665 7272 6964  .        overrid
+0002d6b0: 6573 5f66 696c 6573 203d 206f 7665 7272  es_files = overr
+0002d6c0: 6964 6573 2e63 6f70 7928 290a 2020 2020  ides.copy().    
+0002d6d0: 2020 2020 6f76 6572 7269 6465 735f 6669      overrides_fi
+0002d6e0: 6c65 735b 276e 616d 6527 5d20 3d20 6e61  les['name'] = na
+0002d6f0: 6d65 0a20 2020 2020 2020 2064 6174 6120  me.        data 
+0002d700: 3d20 7072 6f63 6573 735f 6669 6c65 7328  = process_files(
+0002d710: 6669 6c65 733d 6e65 7766 696c 6573 2c20  files=newfiles, 
+0002d720: 6f76 6572 7269 6465 733d 6f76 6572 7269  overrides=overri
+0002d730: 6465 735f 6669 6c65 732c 2072 656d 6564  des_files, remed
+0002d740: 6961 7465 3d54 7275 6529 0a20 2020 2020  iate=True).     
+0002d750: 2020 2064 6174 6164 6972 7320 3d20 7b7d     datadirs = {}
+0002d760: 0a20 2020 2020 2020 2077 6974 6820 5465  .        with Te
+0002d770: 6d70 6f72 6172 7944 6972 6563 746f 7279  mporaryDirectory
+0002d780: 2829 2061 7320 746d 7064 6972 3a0a 2020  () as tmpdir:.  
+0002d790: 2020 2020 2020 2020 2020 666f 7220 696e            for in
+0002d7a0: 6465 782c 2065 6e74 7279 2069 6e20 656e  dex, entry in en
+0002d7b0: 756d 6572 6174 6528 6461 7461 293a 0a20  umerate(data):. 
+0002d7c0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+0002d7d0: 6573 7469 6e61 7469 6f6e 203d 2065 6e74  estination = ent
+0002d7e0: 7279 5b27 7061 7468 275d 0a20 2020 2020  ry['path'].     
+0002d7f0: 2020 2020 2020 2020 2020 2070 6174 6864             pathd
+0002d800: 6972 203d 206f 732e 7061 7468 2e64 6972  ir = os.path.dir
+0002d810: 6e61 6d65 2864 6573 7469 6e61 7469 6f6e  name(destination
+0002d820: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0002d830: 2020 6966 2070 6174 6864 6972 206e 6f74    if pathdir not
+0002d840: 2069 6e20 6461 7461 6469 7273 3a0a 2020   in datadirs:.  
+0002d850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d860: 2020 7061 7468 6469 7263 6d64 203d 2066    pathdircmd = f
+0002d870: 276c 7320 2d61 207b 7061 7468 6469 727d  'ls -a {pathdir}
+0002d880: 2032 3e26 3127 0a20 2020 2020 2020 2020   2>&1'.         
+0002d890: 2020 2020 2020 2020 2020 2070 6174 6864             pathd
+0002d8a0: 6972 636d 6420 3d20 7373 6828 6e61 6d65  ircmd = ssh(name
+0002d8b0: 2c20 6970 3d69 702c 2075 7365 723d 2772  , ip=ip, user='r
+0002d8c0: 6f6f 7427 2c20 7475 6e6e 656c 3d73 656c  oot', tunnel=sel
+0002d8d0: 662e 7475 6e6e 656c 2c20 7475 6e6e 656c  f.tunnel, tunnel
+0002d8e0: 686f 7374 3d73 656c 662e 7475 6e6e 656c  host=self.tunnel
+0002d8f0: 686f 7374 2c0a 2020 2020 2020 2020 2020  host,.          
+0002d900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d910: 2020 2020 2020 2020 2020 2074 756e 6e65             tunne
+0002d920: 6c70 6f72 743d 7365 6c66 2e74 756e 6e65  lport=self.tunne
+0002d930: 6c70 6f72 742c 2074 756e 6e65 6c75 7365  lport, tunneluse
+0002d940: 723d 7365 6c66 2e74 756e 6e65 6c75 7365  r=self.tunneluse
+0002d950: 722c 2069 6e73 6563 7572 653d 5472 7565  r, insecure=True
+0002d960: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0002d970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d980: 2020 2020 2020 2063 6d64 3d70 6174 6864         cmd=pathd
+0002d990: 6972 636d 642c 2076 6d70 6f72 743d 766d  ircmd, vmport=vm
+0002d9a0: 706f 7274 290a 2020 2020 2020 2020 2020  port).          
+0002d9b0: 2020 2020 2020 2020 2020 7061 7468 6469            pathdi
+0002d9c0: 7266 696c 6573 203d 206f 732e 706f 7065  rfiles = os.pope
+0002d9d0: 6e28 7061 7468 6469 7263 6d64 292e 7265  n(pathdircmd).re
+0002d9e0: 6164 6c69 6e65 7328 290a 2020 2020 2020  adlines().      
+0002d9f0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0002da00: 206c 656e 2870 6174 6864 6972 6669 6c65   len(pathdirfile
+0002da10: 7329 203d 3d20 3120 616e 6420 274e 6f20  s) == 1 and 'No 
+0002da20: 7375 6368 2066 696c 6520 6f72 2064 6972  such file or dir
+0002da30: 6563 746f 7279 2720 696e 2070 6174 6864  ectory' in pathd
+0002da40: 6972 6669 6c65 735b 305d 3a0a 2020 2020  irfiles[0]:.    
+0002da50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002da60: 2020 2020 6372 6561 7465 6469 7263 6d64      createdircmd
+0002da70: 203d 2066 276d 6b64 6972 202d 7020 7b70   = f'mkdir -p {p
+0002da80: 6174 6864 6972 7d27 0a20 2020 2020 2020  athdir}'.       
+0002da90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002daa0: 2063 7265 6174 6564 6972 636d 6420 3d20   createdircmd = 
+0002dab0: 7373 6828 6e61 6d65 2c20 6970 3d69 702c  ssh(name, ip=ip,
+0002dac0: 2075 7365 723d 2772 6f6f 7427 2c20 7475   user='root', tu
+0002dad0: 6e6e 656c 3d73 656c 662e 7475 6e6e 656c  nnel=self.tunnel
+0002dae0: 2c20 7475 6e6e 656c 686f 7374 3d73 656c  , tunnelhost=sel
+0002daf0: 662e 7475 6e6e 656c 686f 7374 2c0a 2020  f.tunnelhost,.  
+0002db00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002db10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002db20: 2020 2020 2020 2020 2074 756e 6e65 6c70           tunnelp
+0002db30: 6f72 743d 7365 6c66 2e74 756e 6e65 6c70  ort=self.tunnelp
+0002db40: 6f72 742c 2074 756e 6e65 6c75 7365 723d  ort, tunneluser=
+0002db50: 7365 6c66 2e74 756e 6e65 6c75 7365 722c  self.tunneluser,
+0002db60: 2069 6e73 6563 7572 653d 5472 7565 2c0a   insecure=True,.
+0002db70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002db80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002db90: 2020 2020 2020 2020 2020 2063 6d64 3d63             cmd=c
+0002dba0: 7265 6174 6564 6972 636d 642c 2076 6d70  reatedircmd, vmp
+0002dbb0: 6f72 743d 766d 706f 7274 290a 2020 2020  ort=vmport).    
 0002dbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002dbd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002dbe0: 2020 2020 2020 2063 6d64 3d63 7265 6174         cmd=creat
-0002dbf0: 6564 6972 636d 642c 2076 6d70 6f72 743d  edircmd, vmport=
-0002dc00: 766d 706f 7274 290a 2020 2020 2020 2020  vmport).        
-0002dc10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002dc20: 6f73 2e70 6f70 656e 2863 7265 6174 6564  os.popen(created
-0002dc30: 6972 636d 6429 0a20 2020 2020 2020 2020  ircmd).         
-0002dc40: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0002dc50: 6174 6864 6972 6669 6c65 7320 3d20 5b5d  athdirfiles = []
-0002dc60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002dc70: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0002dc80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002dc90: 2020 2070 6174 6864 6972 6669 6c65 7320     pathdirfiles 
-0002dca0: 3d20 5b78 2e73 7472 6970 2829 2066 6f72  = [x.strip() for
-0002dcb0: 2078 2069 6e20 7061 7468 6469 7266 696c   x in pathdirfil
-0002dcc0: 6573 5d0a 2020 2020 2020 2020 2020 2020  es].            
-0002dcd0: 2020 2020 2020 2020 6461 7461 6469 7273          datadirs
-0002dce0: 5b70 6174 6864 6972 5d20 3d20 7061 7468  [pathdir] = path
-0002dcf0: 6469 7266 696c 6573 0a20 2020 2020 2020  dirfiles.       
-0002dd00: 2020 2020 2020 2020 2069 6620 6f73 2e70           if os.p
-0002dd10: 6174 682e 6261 7365 6e61 6d65 2864 6573  ath.basename(des
-0002dd20: 7469 6e61 7469 6f6e 2920 6e6f 7420 696e  tination) not in
-0002dd30: 2064 6174 6164 6972 735b 7061 7468 6469   datadirs[pathdi
-0002dd40: 725d 3a0a 2020 2020 2020 2020 2020 2020  r]:.            
-0002dd50: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
-0002dd60: 2255 7064 6174 696e 6720 7b64 6573 7469  "Updating {desti
-0002dd70: 6e61 7469 6f6e 7d20 696e 207b 6e61 6d65  nation} in {name
-0002dd80: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
-0002dd90: 2020 2020 2020 2020 736f 7572 6365 203d          source =
-0002dda0: 2066 227b 746d 7064 6972 7d2f 6669 637b   f"{tmpdir}/fic{
-0002ddb0: 696e 6465 787d 220a 2020 2020 2020 2020  index}".        
-0002ddc0: 2020 2020 2020 2020 2020 2020 7769 7468              with
-0002ddd0: 206f 7065 6e28 736f 7572 6365 2c20 2777   open(source, 'w
-0002dde0: 2729 2061 7320 663a 0a20 2020 2020 2020  ') as f:.       
-0002ddf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002de00: 2066 2e77 7269 7465 2865 6e74 7279 5b27   f.write(entry['
-0002de10: 636f 6e74 656e 7427 5d29 0a20 2020 2020  content']).     
-0002de20: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0002de30: 6370 636d 6420 3d20 7363 7028 6e61 6d65  cpcmd = scp(name
-0002de40: 2c20 6970 3d69 702c 2075 7365 723d 2772  , ip=ip, user='r
-0002de50: 6f6f 7427 2c20 736f 7572 6365 3d73 6f75  oot', source=sou
-0002de60: 7263 652c 2064 6573 7469 6e61 7469 6f6e  rce, destination
-0002de70: 3d64 6573 7469 6e61 7469 6f6e 2c20 7475  =destination, tu
-0002de80: 6e6e 656c 3d73 656c 662e 7475 6e6e 656c  nnel=self.tunnel
-0002de90: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0002dea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002deb0: 2020 2074 756e 6e65 6c68 6f73 743d 7365     tunnelhost=se
-0002dec0: 6c66 2e74 756e 6e65 6c68 6f73 742c 2074  lf.tunnelhost, t
-0002ded0: 756e 6e65 6c70 6f72 743d 7365 6c66 2e74  unnelport=self.t
-0002dee0: 756e 6e65 6c70 6f72 742c 2074 756e 6e65  unnelport, tunne
-0002def0: 6c75 7365 723d 7365 6c66 2e74 756e 6e65  luser=self.tunne
-0002df00: 6c75 7365 722c 0a20 2020 2020 2020 2020  luser,.         
-0002df10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002df20: 2020 2020 2020 2020 646f 776e 6c6f 6164          download
-0002df30: 3d46 616c 7365 2c20 696e 7365 6375 7265  =False, insecure
-0002df40: 3d54 7275 652c 2076 6d70 6f72 743d 766d  =True, vmport=vm
-0002df50: 706f 7274 290a 2020 2020 2020 2020 2020  port).          
-0002df60: 2020 2020 2020 2020 2020 6f73 2e73 7973            os.sys
-0002df70: 7465 6d28 7363 7063 6d64 290a 2020 2020  tem(scpcmd).    
-0002df80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002df90: 7570 6461 7465 645f 6669 6c65 732e 6170  updated_files.ap
-0002dfa0: 7065 6e64 2864 6573 7469 6e61 7469 6f6e  pend(destination
-0002dfb0: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-0002dfc0: 2075 7064 6174 6564 5f66 696c 6573 0a0a   updated_files..
-0002dfd0: 2020 2020 6465 6620 696e 666f 5f73 7065      def info_spe
-0002dfe0: 6369 6669 635f 706c 616e 2873 656c 662c  cific_plan(self,
-0002dff0: 2070 6c61 6e29 3a0a 2020 2020 2020 2020   plan):.        
-0002e000: 7070 7269 6e74 2866 2250 726f 7669 6469  pprint(f"Providi
-0002e010: 6e67 2069 6e66 6f72 6d61 7469 6f6e 2061  ng information a
-0002e020: 626f 7574 2070 6c61 6e20 7b70 6c61 6e7d  bout plan {plan}
-0002e030: 2229 0a20 2020 2020 2020 206b 203d 2073  ").        k = s
-0002e040: 656c 662e 6b0a 2020 2020 2020 2020 7265  elf.k.        re
-0002e050: 7375 6c74 7320 3d20 5b5d 0a20 2020 2020  sults = [].     
-0002e060: 2020 2066 6f72 2076 6d20 696e 206b 2e6c     for vm in k.l
-0002e070: 6973 7428 293a 0a20 2020 2020 2020 2020  ist():.         
-0002e080: 2020 2069 6620 766d 2e67 6574 2827 706c     if vm.get('pl
-0002e090: 616e 272c 2027 2729 203d 3d20 706c 616e  an', '') == plan
-0002e0a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0002e0b0: 2020 7265 7375 6c74 732e 6170 7065 6e64    results.append
-0002e0c0: 2876 6d29 0a20 2020 2020 2020 2072 6574  (vm).        ret
-0002e0d0: 7572 6e20 7265 7375 6c74 730a 0a20 2020  urn results..   
-0002e0e0: 2064 6566 2061 7574 6f73 6361 6c65 5f63   def autoscale_c
-0002e0f0: 6c75 7374 6572 2873 656c 662c 206b 7562  luster(self, kub
-0002e100: 652c 206b 7562 6574 7970 652c 2077 6f72  e, kubetype, wor
-0002e110: 6b65 7273 2c20 7468 7265 7368 6f6c 642c  kers, threshold,
-0002e120: 2069 646c 6529 3a0a 2020 2020 2020 2020   idle):.        
-0002e130: 6966 2074 6872 6573 686f 6c64 203e 2039  if threshold > 9
-0002e140: 3939 393a 0a20 2020 2020 2020 2020 2020  999:.           
-0002e150: 2070 7072 696e 7428 6622 536b 6970 7069   pprint(f"Skippi
-0002e160: 6e67 2061 7574 6f73 6361 6c69 6e67 2075  ng autoscaling u
-0002e170: 7020 6368 6563 6b73 2066 6f72 2063 6c75  p checks for clu
-0002e180: 7374 6572 207b 6b75 6265 7d20 6173 2070  ster {kube} as p
-0002e190: 6572 2074 6872 6573 686f 6c64 207b 7468  er threshold {th
-0002e1a0: 7265 7368 6f6c 647d 2229 0a20 2020 2020  reshold}").     
-0002e1b0: 2020 2020 2020 2072 6574 7572 6e20 7b27         return {'
-0002e1c0: 7265 7375 6c74 273a 2027 7375 6363 6573  result': 'succes
-0002e1d0: 7327 2c20 2777 6f72 6b65 7273 273a 2077  s', 'workers': w
-0002e1e0: 6f72 6b65 7273 7d0a 2020 2020 2020 2020  orkers}.        
-0002e1f0: 6966 2069 646c 6520 3c20 313a 0a20 2020  if idle < 1:.   
-0002e200: 2020 2020 2020 2020 2070 7072 696e 7428           pprint(
-0002e210: 6622 536b 6970 7069 6e67 2061 7574 6f73  f"Skipping autos
-0002e220: 6361 6c69 6e67 2064 6f77 6e20 6368 6563  caling down chec
-0002e230: 6b73 2066 6f72 2063 6c75 7374 6572 207b  ks for cluster {
-0002e240: 6b75 6265 7d20 6173 2070 6572 2069 646c  kube} as per idl
-0002e250: 6520 7b69 646c 657d 2229 0a20 2020 2020  e {idle}").     
-0002e260: 2020 2020 2020 2072 6574 7572 6e20 7b27         return {'
-0002e270: 7265 7375 6c74 273a 2027 7375 6363 6573  result': 'succes
-0002e280: 7327 2c20 2777 6f72 6b65 7273 273a 2077  s', 'workers': w
-0002e290: 6f72 6b65 7273 7d0a 2020 2020 2020 2020  orkers}.        
-0002e2a0: 7070 7269 6e74 2866 2243 6865 636b 696e  pprint(f"Checkin
-0002e2b0: 6720 6e6f 6e20 7363 6865 6475 6c65 6420  g non scheduled 
-0002e2c0: 706f 6473 2063 6f75 6e74 206f 6e20 636c  pods count on cl
-0002e2d0: 7573 7465 7220 7b6b 7562 657d 2229 0a20  uster {kube}"). 
-0002e2e0: 2020 2020 2020 2073 656c 6563 746f 7220         selector 
-0002e2f0: 3d20 2221 6e6f 6465 2d72 6f6c 652e 6b75  = "!node-role.ku
-0002e300: 6265 726e 6574 6573 2e69 6f2f 636f 6e74  bernetes.io/cont
-0002e310: 726f 6c2d 706c 616e 652c 6e6f 6465 2d72  rol-plane,node-r
-0002e320: 6f6c 652e 6b75 6265 726e 6574 6573 2e69  ole.kubernetes.i
-0002e330: 6f2f 776f 726b 6572 220a 2020 2020 2020  o/worker".      
-0002e340: 2020 6375 7272 656e 7463 6d64 203d 2066    currentcmd = f
-0002e350: 226b 7562 6563 746c 2067 6574 206e 6f64  "kubectl get nod
-0002e360: 6520 2d2d 7365 6c65 6374 6f72 3d27 7b73  e --selector='{s
-0002e370: 656c 6563 746f 727d 2722 0a20 2020 2020  elector}'".     
-0002e380: 2020 2063 7572 7265 6e74 636d 6420 2b3d     currentcmd +=
-0002e390: 2022 207c 2067 7265 7020 2720 5265 6164   " | grep ' Read
-0002e3a0: 7927 220a 2020 2020 2020 2020 776f 726b  y'".        work
-0002e3b0: 6572 7320 3d20 6c65 6e28 6f73 2e70 6f70  ers = len(os.pop
-0002e3c0: 656e 2863 7572 7265 6e74 636d 6429 2e72  en(currentcmd).r
-0002e3d0: 6561 646c 696e 6573 2829 290a 2020 2020  eadlines()).    
-0002e3e0: 2020 2020 7065 6e64 696e 6763 6d64 203d      pendingcmd =
-0002e3f0: 2022 6b75 6265 6374 6c20 6765 7420 706f   "kubectl get po
-0002e400: 6473 202d 4120 2d2d 6669 656c 642d 7365  ds -A --field-se
-0002e410: 6c65 6374 6f72 3d73 7461 7475 732e 7068  lector=status.ph
-0002e420: 6173 653d 5065 6e64 696e 6720 2d6f 2079  ase=Pending -o y
-0002e430: 616d 6c22 0a20 2020 2020 2020 2070 656e  aml".        pen
-0002e440: 6469 6e67 5f70 6f64 7320 3d20 7961 6d6c  ding_pods = yaml
-0002e450: 2e73 6166 655f 6c6f 6164 286f 732e 706f  .safe_load(os.po
-0002e460: 7065 6e28 7065 6e64 696e 6763 6d64 292e  pen(pendingcmd).
-0002e470: 7265 6164 2829 295b 2769 7465 6d73 275d  read())['items']
-0002e480: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
-0002e490: 7065 6e64 696e 675f 706f 6473 2920 3e20  pending_pods) > 
-0002e4a0: 7468 7265 7368 6f6c 643a 0a20 2020 2020  threshold:.     
-0002e4b0: 2020 2020 2020 2070 7072 696e 7428 6622         pprint(f"
-0002e4c0: 5472 6967 6765 7269 6e67 2073 6361 6c69  Triggering scali
-0002e4d0: 6e67 2075 7020 666f 7220 636c 7573 7465  ng up for cluste
-0002e4e0: 7220 7b6b 7562 657d 2061 7320 7468 6572  r {kube} as ther
-0002e4f0: 6520 6172 6520 7b6c 656e 2870 656e 6469  e are {len(pendi
-0002e500: 6e67 5f70 6f64 7329 7d20 7065 6e64 696e  ng_pods)} pendin
-0002e510: 6720 706f 6473 2229 0a20 2020 2020 2020  g pods").       
-0002e520: 2020 2020 2077 6f72 6b65 7273 202b 3d20       workers += 
-0002e530: 310a 2020 2020 2020 2020 2020 2020 7070  1.            pp
-0002e540: 7269 6e74 2822 5363 616c 696e 6720 7570  rint("Scaling up
-0002e550: 2063 6c75 7374 6572 207b 6b75 6265 7d20   cluster {kube} 
-0002e560: 746f 207b 776f 726b 6572 737d 2077 6f72  to {workers} wor
-0002e570: 6b65 7273 2229 0a20 2020 2020 2020 2020  kers").         
-0002e580: 2020 2072 6573 756c 7420 3d20 7365 6c66     result = self
-0002e590: 2e73 6361 6c65 5f6b 7562 6528 6b75 6265  .scale_kube(kube
-0002e5a0: 2c20 6b75 6265 7479 7065 2c20 6f76 6572  , kubetype, over
-0002e5b0: 7269 6465 733d 7b27 776f 726b 6572 7327  rides={'workers'
-0002e5c0: 3a20 776f 726b 6572 737d 290a 2020 2020  : workers}).    
-0002e5d0: 2020 2020 2020 2020 7265 7375 6c74 5b27          result['
-0002e5e0: 776f 726b 6572 7327 5d20 3d20 776f 726b  workers'] = work
-0002e5f0: 6572 730a 2020 2020 2020 2020 2020 2020  ers.            
-0002e600: 7265 7475 726e 2072 6573 756c 740a 2020  return result.  
-0002e610: 2020 2020 2020 6e6f 6465 7320 3d20 7b7d        nodes = {}
-0002e620: 0a20 2020 2020 2020 2063 7572 7265 6e74  .        current
-0002e630: 636d 6420 3d20 226b 7562 6563 746c 2067  cmd = "kubectl g
-0002e640: 6574 2070 6f64 202d 4120 2d6f 2079 616d  et pod -A -o yam
-0002e650: 6c22 0a20 2020 2020 2020 2061 6c6c 706f  l".        allpo
-0002e660: 6473 203d 2079 616d 6c2e 7361 6665 5f6c  ds = yaml.safe_l
-0002e670: 6f61 6428 6f73 2e70 6f70 656e 2863 7572  oad(os.popen(cur
-0002e680: 7265 6e74 636d 6429 2e72 6561 6428 2929  rentcmd).read())
-0002e690: 5b27 6974 656d 7327 5d0a 2020 2020 2020  ['items'].      
-0002e6a0: 2020 666f 7220 706f 6420 696e 2061 6c6c    for pod in all
-0002e6b0: 706f 6473 3a0a 2020 2020 2020 2020 2020  pods:.          
-0002e6c0: 2020 6e6f 6465 6e61 6d65 203d 2070 6f64    nodename = pod
-0002e6d0: 5b27 7370 6563 275d 5b27 6e6f 6465 4e61  ['spec']['nodeNa
-0002e6e0: 6d65 275d 0a20 2020 2020 2020 2020 2020  me'].           
-0002e6f0: 2073 7461 7475 7320 3d20 706f 645b 2773   status = pod['s
-0002e700: 7461 7475 7327 5d5b 2770 6861 7365 275d  tatus']['phase']
-0002e710: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0002e720: 7374 6174 7573 2021 3d20 2752 756e 6e69  status != 'Runni
-0002e730: 6e67 273a 0a20 2020 2020 2020 2020 2020  ng':.           
-0002e740: 2020 2020 2063 6f6e 7469 6e75 650a 2020       continue.  
-0002e750: 2020 2020 2020 2020 2020 6966 206e 6f64            if nod
-0002e760: 656e 616d 6520 6e6f 7420 696e 206e 6f64  ename not in nod
-0002e770: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
-0002e780: 2020 2020 6e6f 6465 735b 6e6f 6465 6e61      nodes[nodena
-0002e790: 6d65 5d20 3d20 310a 2020 2020 2020 2020  me] = 1.        
-0002e7a0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0002e7b0: 2020 2020 2020 2020 2020 6e6f 6465 735b            nodes[
-0002e7c0: 6e6f 6465 6e61 6d65 5d20 2b3d 2031 0a20  nodename] += 1. 
-0002e7d0: 2020 2020 2020 2074 6f64 656c 6574 6520         todelete 
-0002e7e0: 3d20 300a 2020 2020 2020 2020 666f 7220  = 0.        for 
-0002e7f0: 6e6f 6465 2069 6e20 6e6f 6465 733a 0a20  node in nodes:. 
-0002e800: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-0002e810: 6465 735b 6e6f 6465 5d20 3c20 6964 6c65  des[node] < idle
-0002e820: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0002e830: 2020 7070 7269 6e74 2866 226e 6f64 6520    pprint(f"node 
-0002e840: 7b6e 6f64 657d 2074 6f20 6265 2072 656d  {node} to be rem
-0002e850: 6f76 6564 2073 696e 6365 2069 7420 6f6e  oved since it on
-0002e860: 6c79 2068 6173 2074 6865 2066 6f6c 6c6f  ly has the follo
-0002e870: 7769 6e67 2070 6f64 733a 207b 6e6f 6465  wing pods: {node
-0002e880: 735b 6e6f 6465 5d7d 2229 0a20 2020 2020  s[node]}").     
-0002e890: 2020 2020 2020 2020 2020 2074 6f64 656c             todel
-0002e8a0: 6574 6520 2b3d 2031 0a20 2020 2020 2020  ete += 1.       
-0002e8b0: 2069 6620 746f 6465 6c65 7465 203e 2030   if todelete > 0
-0002e8c0: 3a0a 2020 2020 2020 2020 2020 2020 7070  :.            pp
-0002e8d0: 7269 6e74 2866 2254 7269 6767 6572 696e  rint(f"Triggerin
-0002e8e0: 6720 7363 616c 696e 6720 646f 776e 2066  g scaling down f
-0002e8f0: 6f72 2063 6c75 7374 6572 207b 6b75 6265  or cluster {kube
-0002e900: 7d20 6173 2074 6865 7265 2061 7265 207b  } as there are {
-0002e910: 746f 6465 6c65 7465 7d20 6964 6c65 206e  todelete} idle n
-0002e920: 6f64 6573 2229 0a20 2020 2020 2020 2020  odes").         
-0002e930: 2020 2077 6f72 6b65 7273 203d 2077 6f72     workers = wor
-0002e940: 6b65 7273 202d 2074 6f64 656c 6574 650a  kers - todelete.
-0002e950: 2020 2020 2020 2020 2020 2020 7070 7269              ppri
-0002e960: 6e74 2866 2253 6361 6c69 6e67 2064 6f77  nt(f"Scaling dow
-0002e970: 6e20 636c 7573 7465 7220 7b6b 7562 657d  n cluster {kube}
-0002e980: 2074 6f20 7b77 6f72 6b65 7273 7d20 776f   to {workers} wo
-0002e990: 726b 6572 7322 290a 2020 2020 2020 2020  rkers").        
-0002e9a0: 2020 2020 7265 7375 6c74 203d 2073 656c      result = sel
-0002e9b0: 662e 7363 616c 655f 6b75 6265 286b 7562  f.scale_kube(kub
-0002e9c0: 652c 206b 7562 6574 7970 652c 206f 7665  e, kubetype, ove
-0002e9d0: 7272 6964 6573 3d7b 2777 6f72 6b65 7273  rrides={'workers
-0002e9e0: 273a 2077 6f72 6b65 7273 7d29 0a20 2020  ': workers}).   
-0002e9f0: 2020 2020 2020 2020 2072 6573 756c 745b           result[
-0002ea00: 2777 6f72 6b65 7273 275d 203d 2077 6f72  'workers'] = wor
-0002ea10: 6b65 7273 0a20 2020 2020 2020 2020 2020  kers.           
-0002ea20: 2072 6574 7572 6e20 7265 7375 6c74 0a20   return result. 
-0002ea30: 2020 2020 2020 2072 6574 7572 6e20 7b27         return {'
-0002ea40: 7265 7375 6c74 273a 2027 7375 6363 6573  result': 'succes
-0002ea50: 7327 2c20 2777 6f72 6b65 7273 273a 2077  s', 'workers': w
-0002ea60: 6f72 6b65 7273 7d0a 0a20 2020 2064 6566  orkers}..    def
-0002ea70: 206c 6f6f 705f 6175 746f 7363 616c 655f   loop_autoscale_
-0002ea80: 636c 7573 7465 7228 7365 6c66 2c20 6b75  cluster(self, ku
-0002ea90: 6265 2c20 6b75 6265 7479 7065 2c20 776f  be, kubetype, wo
-0002eaa0: 726b 6572 732c 2074 6872 6573 686f 6c64  rkers, threshold
-0002eab0: 2c20 6964 6c65 293a 0a20 2020 2020 2020  , idle):.       
-0002eac0: 2070 7072 696e 7428 6622 5374 6172 7469   pprint(f"Starti
-0002ead0: 6e67 2077 6974 6820 7b77 6f72 6b65 7273  ng with {workers
-0002eae0: 7d20 776f 726b 6572 7322 290a 2020 2020  } workers").    
-0002eaf0: 2020 2020 6966 2077 6869 6368 2827 6b75      if which('ku
-0002eb00: 6265 6374 6c27 2920 6973 204e 6f6e 653a  bectl') is None:
-0002eb10: 0a20 2020 2020 2020 2020 2020 2063 6f6d  .            com
-0002eb20: 6d6f 6e2e 6765 745f 6b75 6265 6374 6c28  mon.get_kubectl(
-0002eb30: 290a 2020 2020 2020 2020 2020 2020 6f73  ).            os
-0002eb40: 2e65 6e76 6972 6f6e 5b27 5041 5448 275d  .environ['PATH']
-0002eb50: 202b 3d20 273a 2e27 0a20 2020 2020 2020   += ':.'.       
-0002eb60: 2077 6869 6c65 2054 7275 653a 0a20 2020   while True:.   
-0002eb70: 2020 2020 2020 2020 2073 656c 6563 746f           selecto
-0002eb80: 7220 3d20 2221 6e6f 6465 2d72 6f6c 652e  r = "!node-role.
-0002eb90: 6b75 6265 726e 6574 6573 2e69 6f2f 636f  kubernetes.io/co
-0002eba0: 6e74 726f 6c2d 706c 616e 652c 6e6f 6465  ntrol-plane,node
-0002ebb0: 2d72 6f6c 652e 6b75 6265 726e 6574 6573  -role.kubernetes
-0002ebc0: 2e69 6f2f 776f 726b 6572 220a 2020 2020  .io/worker".    
-0002ebd0: 2020 2020 2020 2020 6375 7272 656e 7463          currentc
-0002ebe0: 6d64 203d 2066 226b 7562 6563 746c 2067  md = f"kubectl g
-0002ebf0: 6574 206e 6f64 6520 2d2d 7365 6c65 6374  et node --select
-0002ec00: 6f72 3d27 7b73 656c 6563 746f 727d 2722  or='{selector}'"
-0002ec10: 0a20 2020 2020 2020 2020 2020 2063 7572  .            cur
-0002ec20: 7265 6e74 636d 6420 2b3d 2022 207c 2067  rentcmd += " | g
-0002ec30: 7265 7020 2720 5265 6164 7927 220a 2020  rep ' Ready'".  
-0002ec40: 2020 2020 2020 2020 2020 6375 7272 656e            curren
-0002ec50: 746e 6f64 6573 203d 206f 732e 706f 7065  tnodes = os.pope
-0002ec60: 6e28 6375 7272 656e 7463 6d64 292e 7265  n(currentcmd).re
-0002ec70: 6164 6c69 6e65 7328 290a 2020 2020 2020  adlines().      
-0002ec80: 2020 2020 2020 6966 206c 656e 2863 7572        if len(cur
-0002ec90: 7265 6e74 6e6f 6465 7329 2021 3d20 776f  rentnodes) != wo
-0002eca0: 726b 6572 733a 0a20 2020 2020 2020 2020  rkers:.         
-0002ecb0: 2020 2020 2020 2070 7072 696e 7428 6622         pprint(f"
-0002ecc0: 4f6e 676f 696e 6720 7363 616c 696e 6720  Ongoing scaling 
-0002ecd0: 6f70 6572 6174 696f 6e20 6f6e 2063 6c75  operation on clu
-0002ece0: 7374 6572 207b 6b75 6265 7d22 290a 2020  ster {kube}").  
-0002ecf0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-0002ed00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ed10: 7265 7375 6c74 203d 2073 656c 662e 6175  result = self.au
-0002ed20: 746f 7363 616c 655f 636c 7573 7465 7228  toscale_cluster(
-0002ed30: 6b75 6265 2c20 6b75 6265 7479 7065 2c20  kube, kubetype, 
-0002ed40: 776f 726b 6572 732c 2074 6872 6573 686f  workers, thresho
-0002ed50: 6c64 2c20 6964 6c65 290a 2020 2020 2020  ld, idle).      
-0002ed60: 2020 2020 2020 2020 2020 6966 2072 6573            if res
-0002ed70: 756c 745b 2772 6573 756c 7427 5d20 213d  ult['result'] !=
-0002ed80: 2027 7375 6363 6573 7327 3a0a 2020 2020   'success':.    
-0002ed90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002eda0: 7265 7475 726e 2072 6573 756c 740a 2020  return result.  
-0002edb0: 2020 2020 2020 2020 2020 2020 2020 656c                el
-0002edc0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0002edd0: 2020 2020 2020 2020 776f 726b 6572 7320          workers 
-0002ede0: 3d20 7265 7375 6c74 5b27 776f 726b 6572  = result['worker
-0002edf0: 7327 5d0a 2020 2020 2020 2020 2020 2020  s'].            
-0002ee00: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
-0002ee10: 2243 7572 7265 6e74 2077 6f72 6b65 7273  "Current workers
-0002ee20: 206e 756d 6265 7220 6465 7369 7265 643a   number desired:
-0002ee30: 207b 776f 726b 6572 737d 2229 0a20 2020   {workers}").   
-0002ee40: 2020 2020 2020 2020 2073 6c65 6570 2836           sleep(6
-0002ee50: 3029 0a0a 2020 2020 6465 6620 7468 7265  0)..    def thre
-0002ee60: 6164 6564 5f77 6562 5f63 6f6e 736f 6c65  aded_web_console
-0002ee70: 2873 656c 662c 2070 6f72 742c 206e 616d  (self, port, nam
-0002ee80: 6529 3a0a 2020 2020 2020 2020 636f 6e73  e):.        cons
-0002ee90: 6f6c 6520 3d20 4b6d 696e 6963 6f6e 736f  ole = Kminiconso
-0002eea0: 6c65 2863 6f6e 6669 673d 7365 6c66 2c20  le(config=self, 
-0002eeb0: 706f 7274 3d70 6f72 742c 206e 616d 653d  port=port, name=
-0002eec0: 6e61 6d65 290a 2020 2020 2020 2020 636f  name).        co
-0002eed0: 6e73 6f6c 652e 7275 6e28 290a 0a20 2020  nsole.run()..   
-0002eee0: 2064 6566 2077 6562 636f 6e73 6f6c 6528   def webconsole(
-0002eef0: 7365 6c66 2c20 6e61 6d65 293a 0a20 2020  self, name):.   
-0002ef00: 2020 2020 2070 6f72 7420 3d20 6765 745f       port = get_
-0002ef10: 6672 6565 5f70 6f72 7428 290a 2020 2020  free_port().    
-0002ef20: 2020 2020 7420 3d20 7468 7265 6164 696e      t = threadin
-0002ef30: 672e 5468 7265 6164 2874 6172 6765 743d  g.Thread(target=
-0002ef40: 7365 6c66 2e74 6872 6561 6465 645f 7765  self.threaded_we
-0002ef50: 625f 636f 6e73 6f6c 652c 2061 7267 733d  b_console, args=
-0002ef60: 2870 6f72 742c 206e 616d 652c 2929 0a20  (port, name,)). 
-0002ef70: 2020 2020 2020 2074 2e73 7461 7274 2829         t.start()
-0002ef80: 0a20 2020 2020 2020 2077 6562 6272 6f77  .        webbrow
-0002ef90: 7365 722e 6f70 656e 2866 2268 7474 703a  ser.open(f"http:
-0002efa0: 2f2f 3132 372e 302e 302e 313a 7b70 6f72  //127.0.0.1:{por
-0002efb0: 747d 222c 206e 6577 3d32 2c20 6175 746f  t}", new=2, auto
-0002efc0: 7261 6973 653d 5472 7565 290a 0a20 2020  raise=True)..   
-0002efd0: 2064 6566 2069 6e66 6f5f 7370 6563 6966   def info_specif
-0002efe0: 6963 5f65 6b73 2873 656c 662c 2063 6c75  ic_eks(self, clu
-0002eff0: 7374 6572 293a 0a20 2020 2020 2020 2066  ster):.        f
-0002f000: 726f 6d20 6b76 6972 742e 636c 7573 7465  rom kvirt.cluste
-0002f010: 722e 656b 7320 696d 706f 7274 2069 6e66  r.eks import inf
-0002f020: 6f20 6173 2065 6b73 5f69 6e66 6f0a 2020  o as eks_info.  
-0002f030: 2020 2020 2020 7265 7475 726e 2065 6b73        return eks
-0002f040: 5f69 6e66 6f28 7365 6c66 2c20 636c 7573  _info(self, clus
-0002f050: 7465 722c 2073 656c 662e 6465 6275 6729  ter, self.debug)
-0002f060: 0a0a 2020 2020 6465 6620 696e 666f 5f6b  ..    def info_k
-0002f070: 7562 655f 656b 7328 7365 6c66 2c20 7175  ube_eks(self, qu
-0002f080: 6965 742c 2077 6562 3d46 616c 7365 293a  iet, web=False):
-0002f090: 0a20 2020 2020 2020 2066 726f 6d20 6b76  .        from kv
-0002f0a0: 6972 742e 636c 7573 7465 7220 696d 706f  irt.cluster impo
-0002f0b0: 7274 2065 6b73 0a20 2020 2020 2020 2070  rt eks.        p
-0002f0c0: 6c61 6e64 6972 203d 206f 732e 7061 7468  landir = os.path
-0002f0d0: 2e64 6972 6e61 6d65 2865 6b73 2e63 7265  .dirname(eks.cre
-0002f0e0: 6174 652e 5f5f 636f 6465 5f5f 2e63 6f5f  ate.__code__.co_
-0002f0f0: 6669 6c65 6e61 6d65 290a 2020 2020 2020  filename).      
-0002f100: 2020 696e 7075 7466 696c 6520 3d20 6627    inputfile = f'
-0002f110: 7b70 6c61 6e64 6972 7d2f 6661 6b65 2e79  {plandir}/fake.y
-0002f120: 6d6c 270a 2020 2020 2020 2020 7365 6c66  ml'.        self
-0002f130: 2e69 6e66 6f5f 706c 616e 2869 6e70 7574  .info_plan(input
-0002f140: 6669 6c65 2c20 7175 6965 743d 7175 6965  file, quiet=quie
-0002f150: 742c 2077 6562 3d77 6562 290a 2020 2020  t, web=web).    
-0002f160: 2020 2020 656b 732e 696e 666f 5f73 6572      eks.info_ser
-0002f170: 7669 6365 2873 656c 6629 0a0a 2020 2020  vice(self)..    
-0002f180: 6465 6620 696e 666f 5f73 7065 6369 6669  def info_specifi
-0002f190: 635f 676b 6528 7365 6c66 2c20 636c 7573  c_gke(self, clus
-0002f1a0: 7465 7229 3a0a 2020 2020 2020 2020 6672  ter):.        fr
-0002f1b0: 6f6d 206b 7669 7274 2e63 6c75 7465 722e  om kvirt.cluter.
-0002f1c0: 676b 6520 696d 706f 7274 2069 6e66 6f20  gke import info 
-0002f1d0: 6173 2067 6b65 5f69 6e66 6f0a 2020 2020  as gke_info.    
-0002f1e0: 2020 2020 7265 7475 726e 2067 6b65 5f69      return gke_i
-0002f1f0: 6e66 6f28 7365 6c66 2c20 636c 7573 7465  nfo(self, cluste
-0002f200: 722c 2073 656c 662e 6465 6275 6729 0a0a  r, self.debug)..
-0002f210: 2020 2020 6465 6620 696e 666f 5f6b 7562      def info_kub
-0002f220: 655f 676b 6528 7365 6c66 2c20 7175 6965  e_gke(self, quie
-0002f230: 742c 2077 6562 3d46 616c 7365 293a 0a20  t, web=False):. 
-0002f240: 2020 2020 2020 2066 726f 6d20 6b76 6972         from kvir
-0002f250: 742e 636c 7573 7465 7220 696d 706f 7274  t.cluster import
-0002f260: 2067 6b65 0a20 2020 2020 2020 2070 6c61   gke.        pla
-0002f270: 6e64 6972 203d 206f 732e 7061 7468 2e64  ndir = os.path.d
-0002f280: 6972 6e61 6d65 2867 6b65 2e63 7265 6174  irname(gke.creat
-0002f290: 652e 5f5f 636f 6465 5f5f 2e63 6f5f 6669  e.__code__.co_fi
-0002f2a0: 6c65 6e61 6d65 290a 2020 2020 2020 2020  lename).        
-0002f2b0: 696e 7075 7466 696c 6520 3d20 6627 7b70  inputfile = f'{p
-0002f2c0: 6c61 6e64 6972 7d2f 6661 6b65 2e79 6d6c  landir}/fake.yml
-0002f2d0: 270a 2020 2020 2020 2020 7365 6c66 2e69  '.        self.i
-0002f2e0: 6e66 6f5f 706c 616e 2869 6e70 7574 6669  nfo_plan(inputfi
-0002f2f0: 6c65 2c20 7175 6965 743d 7175 6965 742c  le, quiet=quiet,
-0002f300: 2077 6562 3d77 6562 290a 2020 2020 2020   web=web).      
-0002f310: 2020 676b 652e 696e 666f 5f73 6572 7669    gke.info_servi
-0002f320: 6365 2873 656c 6629 0a                   ce(self).
+0002dbd0: 2020 2020 6f73 2e70 6f70 656e 2863 7265      os.popen(cre
+0002dbe0: 6174 6564 6972 636d 6429 0a20 2020 2020  atedircmd).     
+0002dbf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002dc00: 2020 2070 6174 6864 6972 6669 6c65 7320     pathdirfiles 
+0002dc10: 3d20 5b5d 0a20 2020 2020 2020 2020 2020  = [].           
+0002dc20: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+0002dc30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002dc40: 2020 2020 2020 2070 6174 6864 6972 6669         pathdirfi
+0002dc50: 6c65 7320 3d20 5b78 2e73 7472 6970 2829  les = [x.strip()
+0002dc60: 2066 6f72 2078 2069 6e20 7061 7468 6469   for x in pathdi
+0002dc70: 7266 696c 6573 5d0a 2020 2020 2020 2020  rfiles].        
+0002dc80: 2020 2020 2020 2020 2020 2020 6461 7461              data
+0002dc90: 6469 7273 5b70 6174 6864 6972 5d20 3d20  dirs[pathdir] = 
+0002dca0: 7061 7468 6469 7266 696c 6573 0a20 2020  pathdirfiles.   
+0002dcb0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0002dcc0: 6f73 2e70 6174 682e 6261 7365 6e61 6d65  os.path.basename
+0002dcd0: 2864 6573 7469 6e61 7469 6f6e 2920 6e6f  (destination) no
+0002dce0: 7420 696e 2064 6174 6164 6972 735b 7061  t in datadirs[pa
+0002dcf0: 7468 6469 725d 3a0a 2020 2020 2020 2020  thdir]:.        
+0002dd00: 2020 2020 2020 2020 2020 2020 7070 7269              ppri
+0002dd10: 6e74 2866 2255 7064 6174 696e 6720 7b64  nt(f"Updating {d
+0002dd20: 6573 7469 6e61 7469 6f6e 7d20 696e 207b  estination} in {
+0002dd30: 6e61 6d65 7d22 290a 2020 2020 2020 2020  name}").        
+0002dd40: 2020 2020 2020 2020 2020 2020 736f 7572              sour
+0002dd50: 6365 203d 2066 227b 746d 7064 6972 7d2f  ce = f"{tmpdir}/
+0002dd60: 6669 637b 696e 6465 787d 220a 2020 2020  fic{index}".    
+0002dd70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002dd80: 7769 7468 206f 7065 6e28 736f 7572 6365  with open(source
+0002dd90: 2c20 2777 2729 2061 7320 663a 0a20 2020  , 'w') as f:.   
+0002dda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ddb0: 2020 2020 2066 2e77 7269 7465 2865 6e74       f.write(ent
+0002ddc0: 7279 5b27 636f 6e74 656e 7427 5d29 0a20  ry['content']). 
+0002ddd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002dde0: 2020 2073 6370 636d 6420 3d20 7363 7028     scpcmd = scp(
+0002ddf0: 6e61 6d65 2c20 6970 3d69 702c 2075 7365  name, ip=ip, use
+0002de00: 723d 2772 6f6f 7427 2c20 736f 7572 6365  r='root', source
+0002de10: 3d73 6f75 7263 652c 2064 6573 7469 6e61  =source, destina
+0002de20: 7469 6f6e 3d64 6573 7469 6e61 7469 6f6e  tion=destination
+0002de30: 2c20 7475 6e6e 656c 3d73 656c 662e 7475  , tunnel=self.tu
+0002de40: 6e6e 656c 2c0a 2020 2020 2020 2020 2020  nnel,.          
+0002de50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002de60: 2020 2020 2020 2074 756e 6e65 6c68 6f73         tunnelhos
+0002de70: 743d 7365 6c66 2e74 756e 6e65 6c68 6f73  t=self.tunnelhos
+0002de80: 742c 2074 756e 6e65 6c70 6f72 743d 7365  t, tunnelport=se
+0002de90: 6c66 2e74 756e 6e65 6c70 6f72 742c 2074  lf.tunnelport, t
+0002dea0: 756e 6e65 6c75 7365 723d 7365 6c66 2e74  unneluser=self.t
+0002deb0: 756e 6e65 6c75 7365 722c 0a20 2020 2020  unneluser,.     
+0002dec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ded0: 2020 2020 2020 2020 2020 2020 646f 776e              down
+0002dee0: 6c6f 6164 3d46 616c 7365 2c20 696e 7365  load=False, inse
+0002def0: 6375 7265 3d54 7275 652c 2076 6d70 6f72  cure=True, vmpor
+0002df00: 743d 766d 706f 7274 290a 2020 2020 2020  t=vmport).      
+0002df10: 2020 2020 2020 2020 2020 2020 2020 6f73                os
+0002df20: 2e73 7973 7465 6d28 7363 7063 6d64 290a  .system(scpcmd).
+0002df30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002df40: 2020 2020 7570 6461 7465 645f 6669 6c65      updated_file
+0002df50: 732e 6170 7065 6e64 2864 6573 7469 6e61  s.append(destina
+0002df60: 7469 6f6e 290a 2020 2020 2020 2020 7265  tion).        re
+0002df70: 7475 726e 2075 7064 6174 6564 5f66 696c  turn updated_fil
+0002df80: 6573 0a0a 2020 2020 6465 6620 696e 666f  es..    def info
+0002df90: 5f73 7065 6369 6669 635f 706c 616e 2873  _specific_plan(s
+0002dfa0: 656c 662c 2070 6c61 6e29 3a0a 2020 2020  elf, plan):.    
+0002dfb0: 2020 2020 7070 7269 6e74 2866 2250 726f      pprint(f"Pro
+0002dfc0: 7669 6469 6e67 2069 6e66 6f72 6d61 7469  viding informati
+0002dfd0: 6f6e 2061 626f 7574 2070 6c61 6e20 7b70  on about plan {p
+0002dfe0: 6c61 6e7d 2229 0a20 2020 2020 2020 206b  lan}").        k
+0002dff0: 203d 2073 656c 662e 6b0a 2020 2020 2020   = self.k.      
+0002e000: 2020 7265 7375 6c74 7320 3d20 5b5d 0a20    results = []. 
+0002e010: 2020 2020 2020 2066 6f72 2076 6d20 696e         for vm in
+0002e020: 206b 2e6c 6973 7428 293a 0a20 2020 2020   k.list():.     
+0002e030: 2020 2020 2020 2069 6620 766d 2e67 6574         if vm.get
+0002e040: 2827 706c 616e 272c 2027 2729 203d 3d20  ('plan', '') == 
+0002e050: 706c 616e 3a0a 2020 2020 2020 2020 2020  plan:.          
+0002e060: 2020 2020 2020 7265 7375 6c74 732e 6170        results.ap
+0002e070: 7065 6e64 2876 6d29 0a20 2020 2020 2020  pend(vm).       
+0002e080: 2072 6574 7572 6e20 7265 7375 6c74 730a   return results.
+0002e090: 0a20 2020 2064 6566 2061 7574 6f73 6361  .    def autosca
+0002e0a0: 6c65 5f63 6c75 7374 6572 2873 656c 662c  le_cluster(self,
+0002e0b0: 206b 7562 652c 206b 7562 6574 7970 652c   kube, kubetype,
+0002e0c0: 2077 6f72 6b65 7273 2c20 7468 7265 7368   workers, thresh
+0002e0d0: 6f6c 642c 2069 646c 6529 3a0a 2020 2020  old, idle):.    
+0002e0e0: 2020 2020 6966 2074 6872 6573 686f 6c64      if threshold
+0002e0f0: 203e 2039 3939 393a 0a20 2020 2020 2020   > 9999:.       
+0002e100: 2020 2020 2070 7072 696e 7428 6622 536b       pprint(f"Sk
+0002e110: 6970 7069 6e67 2061 7574 6f73 6361 6c69  ipping autoscali
+0002e120: 6e67 2075 7020 6368 6563 6b73 2066 6f72  ng up checks for
+0002e130: 2063 6c75 7374 6572 207b 6b75 6265 7d20   cluster {kube} 
+0002e140: 6173 2070 6572 2074 6872 6573 686f 6c64  as per threshold
+0002e150: 207b 7468 7265 7368 6f6c 647d 2229 0a20   {threshold}"). 
+0002e160: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0002e170: 6e20 7b27 7265 7375 6c74 273a 2027 7375  n {'result': 'su
+0002e180: 6363 6573 7327 2c20 2777 6f72 6b65 7273  ccess', 'workers
+0002e190: 273a 2077 6f72 6b65 7273 7d0a 2020 2020  ': workers}.    
+0002e1a0: 2020 2020 6966 2069 646c 6520 3c20 313a      if idle < 1:
+0002e1b0: 0a20 2020 2020 2020 2020 2020 2070 7072  .            ppr
+0002e1c0: 696e 7428 6622 536b 6970 7069 6e67 2061  int(f"Skipping a
+0002e1d0: 7574 6f73 6361 6c69 6e67 2064 6f77 6e20  utoscaling down 
+0002e1e0: 6368 6563 6b73 2066 6f72 2063 6c75 7374  checks for clust
+0002e1f0: 6572 207b 6b75 6265 7d20 6173 2070 6572  er {kube} as per
+0002e200: 2069 646c 6520 7b69 646c 657d 2229 0a20   idle {idle}"). 
+0002e210: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0002e220: 6e20 7b27 7265 7375 6c74 273a 2027 7375  n {'result': 'su
+0002e230: 6363 6573 7327 2c20 2777 6f72 6b65 7273  ccess', 'workers
+0002e240: 273a 2077 6f72 6b65 7273 7d0a 2020 2020  ': workers}.    
+0002e250: 2020 2020 7070 7269 6e74 2866 2243 6865      pprint(f"Che
+0002e260: 636b 696e 6720 6e6f 6e20 7363 6865 6475  cking non schedu
+0002e270: 6c65 6420 706f 6473 2063 6f75 6e74 206f  led pods count o
+0002e280: 6e20 636c 7573 7465 7220 7b6b 7562 657d  n cluster {kube}
+0002e290: 2229 0a20 2020 2020 2020 2073 656c 6563  ").        selec
+0002e2a0: 746f 7220 3d20 2221 6e6f 6465 2d72 6f6c  tor = "!node-rol
+0002e2b0: 652e 6b75 6265 726e 6574 6573 2e69 6f2f  e.kubernetes.io/
+0002e2c0: 636f 6e74 726f 6c2d 706c 616e 652c 6e6f  control-plane,no
+0002e2d0: 6465 2d72 6f6c 652e 6b75 6265 726e 6574  de-role.kubernet
+0002e2e0: 6573 2e69 6f2f 776f 726b 6572 220a 2020  es.io/worker".  
+0002e2f0: 2020 2020 2020 6375 7272 656e 7463 6d64        currentcmd
+0002e300: 203d 2066 226b 7562 6563 746c 2067 6574   = f"kubectl get
+0002e310: 206e 6f64 6520 2d2d 7365 6c65 6374 6f72   node --selector
+0002e320: 3d27 7b73 656c 6563 746f 727d 2722 0a20  ='{selector}'". 
+0002e330: 2020 2020 2020 2063 7572 7265 6e74 636d         currentcm
+0002e340: 6420 2b3d 2022 207c 2067 7265 7020 2720  d += " | grep ' 
+0002e350: 5265 6164 7927 220a 2020 2020 2020 2020  Ready'".        
+0002e360: 776f 726b 6572 7320 3d20 6c65 6e28 6f73  workers = len(os
+0002e370: 2e70 6f70 656e 2863 7572 7265 6e74 636d  .popen(currentcm
+0002e380: 6429 2e72 6561 646c 696e 6573 2829 290a  d).readlines()).
+0002e390: 2020 2020 2020 2020 7065 6e64 696e 6763          pendingc
+0002e3a0: 6d64 203d 2022 6b75 6265 6374 6c20 6765  md = "kubectl ge
+0002e3b0: 7420 706f 6473 202d 4120 2d2d 6669 656c  t pods -A --fiel
+0002e3c0: 642d 7365 6c65 6374 6f72 3d73 7461 7475  d-selector=statu
+0002e3d0: 732e 7068 6173 653d 5065 6e64 696e 6720  s.phase=Pending 
+0002e3e0: 2d6f 2079 616d 6c22 0a20 2020 2020 2020  -o yaml".       
+0002e3f0: 2070 656e 6469 6e67 5f70 6f64 7320 3d20   pending_pods = 
+0002e400: 7961 6d6c 2e73 6166 655f 6c6f 6164 286f  yaml.safe_load(o
+0002e410: 732e 706f 7065 6e28 7065 6e64 696e 6763  s.popen(pendingc
+0002e420: 6d64 292e 7265 6164 2829 295b 2769 7465  md).read())['ite
+0002e430: 6d73 275d 0a20 2020 2020 2020 2069 6620  ms'].        if 
+0002e440: 6c65 6e28 7065 6e64 696e 675f 706f 6473  len(pending_pods
+0002e450: 2920 3e20 7468 7265 7368 6f6c 643a 0a20  ) > threshold:. 
+0002e460: 2020 2020 2020 2020 2020 2070 7072 696e             pprin
+0002e470: 7428 6622 5472 6967 6765 7269 6e67 2073  t(f"Triggering s
+0002e480: 6361 6c69 6e67 2075 7020 666f 7220 636c  caling up for cl
+0002e490: 7573 7465 7220 7b6b 7562 657d 2061 7320  uster {kube} as 
+0002e4a0: 7468 6572 6520 6172 6520 7b6c 656e 2870  there are {len(p
+0002e4b0: 656e 6469 6e67 5f70 6f64 7329 7d20 7065  ending_pods)} pe
+0002e4c0: 6e64 696e 6720 706f 6473 2229 0a20 2020  nding pods").   
+0002e4d0: 2020 2020 2020 2020 2077 6f72 6b65 7273           workers
+0002e4e0: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
+0002e4f0: 2020 7070 7269 6e74 2822 5363 616c 696e    pprint("Scalin
+0002e500: 6720 7570 2063 6c75 7374 6572 207b 6b75  g up cluster {ku
+0002e510: 6265 7d20 746f 207b 776f 726b 6572 737d  be} to {workers}
+0002e520: 2077 6f72 6b65 7273 2229 0a20 2020 2020   workers").     
+0002e530: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
+0002e540: 7365 6c66 2e73 6361 6c65 5f6b 7562 6528  self.scale_kube(
+0002e550: 6b75 6265 2c20 6b75 6265 7479 7065 2c20  kube, kubetype, 
+0002e560: 6f76 6572 7269 6465 733d 7b27 776f 726b  overrides={'work
+0002e570: 6572 7327 3a20 776f 726b 6572 737d 290a  ers': workers}).
+0002e580: 2020 2020 2020 2020 2020 2020 7265 7375              resu
+0002e590: 6c74 5b27 776f 726b 6572 7327 5d20 3d20  lt['workers'] = 
+0002e5a0: 776f 726b 6572 730a 2020 2020 2020 2020  workers.        
+0002e5b0: 2020 2020 7265 7475 726e 2072 6573 756c      return resul
+0002e5c0: 740a 2020 2020 2020 2020 6e6f 6465 7320  t.        nodes 
+0002e5d0: 3d20 7b7d 0a20 2020 2020 2020 2063 7572  = {}.        cur
+0002e5e0: 7265 6e74 636d 6420 3d20 226b 7562 6563  rentcmd = "kubec
+0002e5f0: 746c 2067 6574 2070 6f64 202d 4120 2d6f  tl get pod -A -o
+0002e600: 2079 616d 6c22 0a20 2020 2020 2020 2061   yaml".        a
+0002e610: 6c6c 706f 6473 203d 2079 616d 6c2e 7361  llpods = yaml.sa
+0002e620: 6665 5f6c 6f61 6428 6f73 2e70 6f70 656e  fe_load(os.popen
+0002e630: 2863 7572 7265 6e74 636d 6429 2e72 6561  (currentcmd).rea
+0002e640: 6428 2929 5b27 6974 656d 7327 5d0a 2020  d())['items'].  
+0002e650: 2020 2020 2020 666f 7220 706f 6420 696e        for pod in
+0002e660: 2061 6c6c 706f 6473 3a0a 2020 2020 2020   allpods:.      
+0002e670: 2020 2020 2020 6e6f 6465 6e61 6d65 203d        nodename =
+0002e680: 2070 6f64 5b27 7370 6563 275d 5b27 6e6f   pod['spec']['no
+0002e690: 6465 4e61 6d65 275d 0a20 2020 2020 2020  deName'].       
+0002e6a0: 2020 2020 2073 7461 7475 7320 3d20 706f       status = po
+0002e6b0: 645b 2773 7461 7475 7327 5d5b 2770 6861  d['status']['pha
+0002e6c0: 7365 275d 0a20 2020 2020 2020 2020 2020  se'].           
+0002e6d0: 2069 6620 7374 6174 7573 2021 3d20 2752   if status != 'R
+0002e6e0: 756e 6e69 6e67 273a 0a20 2020 2020 2020  unning':.       
+0002e6f0: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
+0002e700: 650a 2020 2020 2020 2020 2020 2020 6966  e.            if
+0002e710: 206e 6f64 656e 616d 6520 6e6f 7420 696e   nodename not in
+0002e720: 206e 6f64 6573 3a0a 2020 2020 2020 2020   nodes:.        
+0002e730: 2020 2020 2020 2020 6e6f 6465 735b 6e6f          nodes[no
+0002e740: 6465 6e61 6d65 5d20 3d20 310a 2020 2020  dename] = 1.    
+0002e750: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0002e760: 2020 2020 2020 2020 2020 2020 2020 6e6f                no
+0002e770: 6465 735b 6e6f 6465 6e61 6d65 5d20 2b3d  des[nodename] +=
+0002e780: 2031 0a20 2020 2020 2020 2074 6f64 656c   1.        todel
+0002e790: 6574 6520 3d20 300a 2020 2020 2020 2020  ete = 0.        
+0002e7a0: 666f 7220 6e6f 6465 2069 6e20 6e6f 6465  for node in node
+0002e7b0: 733a 0a20 2020 2020 2020 2020 2020 2069  s:.            i
+0002e7c0: 6620 6e6f 6465 735b 6e6f 6465 5d20 3c20  f nodes[node] < 
+0002e7d0: 6964 6c65 3a0a 2020 2020 2020 2020 2020  idle:.          
+0002e7e0: 2020 2020 2020 7070 7269 6e74 2866 226e        pprint(f"n
+0002e7f0: 6f64 6520 7b6e 6f64 657d 2074 6f20 6265  ode {node} to be
+0002e800: 2072 656d 6f76 6564 2073 696e 6365 2069   removed since i
+0002e810: 7420 6f6e 6c79 2068 6173 2074 6865 2066  t only has the f
+0002e820: 6f6c 6c6f 7769 6e67 2070 6f64 733a 207b  ollowing pods: {
+0002e830: 6e6f 6465 735b 6e6f 6465 5d7d 2229 0a20  nodes[node]}"). 
+0002e840: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0002e850: 6f64 656c 6574 6520 2b3d 2031 0a20 2020  odelete += 1.   
+0002e860: 2020 2020 2069 6620 746f 6465 6c65 7465       if todelete
+0002e870: 203e 2030 3a0a 2020 2020 2020 2020 2020   > 0:.          
+0002e880: 2020 7070 7269 6e74 2866 2254 7269 6767    pprint(f"Trigg
+0002e890: 6572 696e 6720 7363 616c 696e 6720 646f  ering scaling do
+0002e8a0: 776e 2066 6f72 2063 6c75 7374 6572 207b  wn for cluster {
+0002e8b0: 6b75 6265 7d20 6173 2074 6865 7265 2061  kube} as there a
+0002e8c0: 7265 207b 746f 6465 6c65 7465 7d20 6964  re {todelete} id
+0002e8d0: 6c65 206e 6f64 6573 2229 0a20 2020 2020  le nodes").     
+0002e8e0: 2020 2020 2020 2077 6f72 6b65 7273 203d         workers =
+0002e8f0: 2077 6f72 6b65 7273 202d 2074 6f64 656c   workers - todel
+0002e900: 6574 650a 2020 2020 2020 2020 2020 2020  ete.            
+0002e910: 7070 7269 6e74 2866 2253 6361 6c69 6e67  pprint(f"Scaling
+0002e920: 2064 6f77 6e20 636c 7573 7465 7220 7b6b   down cluster {k
+0002e930: 7562 657d 2074 6f20 7b77 6f72 6b65 7273  ube} to {workers
+0002e940: 7d20 776f 726b 6572 7322 290a 2020 2020  } workers").    
+0002e950: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
+0002e960: 2073 656c 662e 7363 616c 655f 6b75 6265   self.scale_kube
+0002e970: 286b 7562 652c 206b 7562 6574 7970 652c  (kube, kubetype,
+0002e980: 206f 7665 7272 6964 6573 3d7b 2777 6f72   overrides={'wor
+0002e990: 6b65 7273 273a 2077 6f72 6b65 7273 7d29  kers': workers})
+0002e9a0: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
+0002e9b0: 756c 745b 2777 6f72 6b65 7273 275d 203d  ult['workers'] =
+0002e9c0: 2077 6f72 6b65 7273 0a20 2020 2020 2020   workers.       
+0002e9d0: 2020 2020 2072 6574 7572 6e20 7265 7375       return resu
+0002e9e0: 6c74 0a20 2020 2020 2020 2072 6574 7572  lt.        retur
+0002e9f0: 6e20 7b27 7265 7375 6c74 273a 2027 7375  n {'result': 'su
+0002ea00: 6363 6573 7327 2c20 2777 6f72 6b65 7273  ccess', 'workers
+0002ea10: 273a 2077 6f72 6b65 7273 7d0a 0a20 2020  ': workers}..   
+0002ea20: 2064 6566 206c 6f6f 705f 6175 746f 7363   def loop_autosc
+0002ea30: 616c 655f 636c 7573 7465 7228 7365 6c66  ale_cluster(self
+0002ea40: 2c20 6b75 6265 2c20 6b75 6265 7479 7065  , kube, kubetype
+0002ea50: 2c20 776f 726b 6572 732c 2074 6872 6573  , workers, thres
+0002ea60: 686f 6c64 2c20 6964 6c65 293a 0a20 2020  hold, idle):.   
+0002ea70: 2020 2020 2070 7072 696e 7428 6622 5374       pprint(f"St
+0002ea80: 6172 7469 6e67 2077 6974 6820 7b77 6f72  arting with {wor
+0002ea90: 6b65 7273 7d20 776f 726b 6572 7322 290a  kers} workers").
+0002eaa0: 2020 2020 2020 2020 6966 2077 6869 6368          if which
+0002eab0: 2827 6b75 6265 6374 6c27 2920 6973 204e  ('kubectl') is N
+0002eac0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0002ead0: 2063 6f6d 6d6f 6e2e 6765 745f 6b75 6265   common.get_kube
+0002eae0: 6374 6c28 290a 2020 2020 2020 2020 2020  ctl().          
+0002eaf0: 2020 6f73 2e65 6e76 6972 6f6e 5b27 5041    os.environ['PA
+0002eb00: 5448 275d 202b 3d20 273a 2e27 0a20 2020  TH'] += ':.'.   
+0002eb10: 2020 2020 2077 6869 6c65 2054 7275 653a       while True:
+0002eb20: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0002eb30: 6563 746f 7220 3d20 2221 6e6f 6465 2d72  ector = "!node-r
+0002eb40: 6f6c 652e 6b75 6265 726e 6574 6573 2e69  ole.kubernetes.i
+0002eb50: 6f2f 636f 6e74 726f 6c2d 706c 616e 652c  o/control-plane,
+0002eb60: 6e6f 6465 2d72 6f6c 652e 6b75 6265 726e  node-role.kubern
+0002eb70: 6574 6573 2e69 6f2f 776f 726b 6572 220a  etes.io/worker".
+0002eb80: 2020 2020 2020 2020 2020 2020 6375 7272              curr
+0002eb90: 656e 7463 6d64 203d 2066 226b 7562 6563  entcmd = f"kubec
+0002eba0: 746c 2067 6574 206e 6f64 6520 2d2d 7365  tl get node --se
+0002ebb0: 6c65 6374 6f72 3d27 7b73 656c 6563 746f  lector='{selecto
+0002ebc0: 727d 2722 0a20 2020 2020 2020 2020 2020  r}'".           
+0002ebd0: 2063 7572 7265 6e74 636d 6420 2b3d 2022   currentcmd += "
+0002ebe0: 207c 2067 7265 7020 2720 5265 6164 7927   | grep ' Ready'
+0002ebf0: 220a 2020 2020 2020 2020 2020 2020 6375  ".            cu
+0002ec00: 7272 656e 746e 6f64 6573 203d 206f 732e  rrentnodes = os.
+0002ec10: 706f 7065 6e28 6375 7272 656e 7463 6d64  popen(currentcmd
+0002ec20: 292e 7265 6164 6c69 6e65 7328 290a 2020  ).readlines().  
+0002ec30: 2020 2020 2020 2020 2020 6966 206c 656e            if len
+0002ec40: 2863 7572 7265 6e74 6e6f 6465 7329 2021  (currentnodes) !
+0002ec50: 3d20 776f 726b 6572 733a 0a20 2020 2020  = workers:.     
+0002ec60: 2020 2020 2020 2020 2020 2070 7072 696e             pprin
+0002ec70: 7428 6622 4f6e 676f 696e 6720 7363 616c  t(f"Ongoing scal
+0002ec80: 696e 6720 6f70 6572 6174 696f 6e20 6f6e  ing operation on
+0002ec90: 2063 6c75 7374 6572 207b 6b75 6265 7d22   cluster {kube}"
+0002eca0: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
+0002ecb0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0002ecc0: 2020 2020 7265 7375 6c74 203d 2073 656c      result = sel
+0002ecd0: 662e 6175 746f 7363 616c 655f 636c 7573  f.autoscale_clus
+0002ece0: 7465 7228 6b75 6265 2c20 6b75 6265 7479  ter(kube, kubety
+0002ecf0: 7065 2c20 776f 726b 6572 732c 2074 6872  pe, workers, thr
+0002ed00: 6573 686f 6c64 2c20 6964 6c65 290a 2020  eshold, idle).  
+0002ed10: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0002ed20: 2072 6573 756c 745b 2772 6573 756c 7427   result['result'
+0002ed30: 5d20 213d 2027 7375 6363 6573 7327 3a0a  ] != 'success':.
+0002ed40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ed50: 2020 2020 7265 7475 726e 2072 6573 756c      return resul
+0002ed60: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
+0002ed70: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0002ed80: 2020 2020 2020 2020 2020 2020 776f 726b              work
+0002ed90: 6572 7320 3d20 7265 7375 6c74 5b27 776f  ers = result['wo
+0002eda0: 726b 6572 7327 5d0a 2020 2020 2020 2020  rkers'].        
+0002edb0: 2020 2020 2020 2020 2020 2020 7070 7269              ppri
+0002edc0: 6e74 2866 2243 7572 7265 6e74 2077 6f72  nt(f"Current wor
+0002edd0: 6b65 7273 206e 756d 6265 7220 6465 7369  kers number desi
+0002ede0: 7265 643a 207b 776f 726b 6572 737d 2229  red: {workers}")
+0002edf0: 0a20 2020 2020 2020 2020 2020 2073 6c65  .            sle
+0002ee00: 6570 2836 3029 0a0a 2020 2020 6465 6620  ep(60)..    def 
+0002ee10: 7468 7265 6164 6564 5f77 6562 5f63 6f6e  threaded_web_con
+0002ee20: 736f 6c65 2873 656c 662c 2070 6f72 742c  sole(self, port,
+0002ee30: 206e 616d 6529 3a0a 2020 2020 2020 2020   name):.        
+0002ee40: 636f 6e73 6f6c 6520 3d20 4b6d 696e 6963  console = Kminic
+0002ee50: 6f6e 736f 6c65 2863 6f6e 6669 673d 7365  onsole(config=se
+0002ee60: 6c66 2c20 706f 7274 3d70 6f72 742c 206e  lf, port=port, n
+0002ee70: 616d 653d 6e61 6d65 290a 2020 2020 2020  ame=name).      
+0002ee80: 2020 636f 6e73 6f6c 652e 7275 6e28 290a    console.run().
+0002ee90: 0a20 2020 2064 6566 2077 6562 636f 6e73  .    def webcons
+0002eea0: 6f6c 6528 7365 6c66 2c20 6e61 6d65 293a  ole(self, name):
+0002eeb0: 0a20 2020 2020 2020 2070 6f72 7420 3d20  .        port = 
+0002eec0: 6765 745f 6672 6565 5f70 6f72 7428 290a  get_free_port().
+0002eed0: 2020 2020 2020 2020 7420 3d20 7468 7265          t = thre
+0002eee0: 6164 696e 672e 5468 7265 6164 2874 6172  ading.Thread(tar
+0002eef0: 6765 743d 7365 6c66 2e74 6872 6561 6465  get=self.threade
+0002ef00: 645f 7765 625f 636f 6e73 6f6c 652c 2061  d_web_console, a
+0002ef10: 7267 733d 2870 6f72 742c 206e 616d 652c  rgs=(port, name,
+0002ef20: 2929 0a20 2020 2020 2020 2074 2e73 7461  )).        t.sta
+0002ef30: 7274 2829 0a20 2020 2020 2020 2077 6562  rt().        web
+0002ef40: 6272 6f77 7365 722e 6f70 656e 2866 2268  browser.open(f"h
+0002ef50: 7474 703a 2f2f 3132 372e 302e 302e 313a  ttp://127.0.0.1:
+0002ef60: 7b70 6f72 747d 222c 206e 6577 3d32 2c20  {port}", new=2, 
+0002ef70: 6175 746f 7261 6973 653d 5472 7565 290a  autoraise=True).
+0002ef80: 0a20 2020 2064 6566 2069 6e66 6f5f 7370  .    def info_sp
+0002ef90: 6563 6966 6963 5f65 6b73 2873 656c 662c  ecific_eks(self,
+0002efa0: 2063 6c75 7374 6572 293a 0a20 2020 2020   cluster):.     
+0002efb0: 2020 2066 726f 6d20 6b76 6972 742e 636c     from kvirt.cl
+0002efc0: 7573 7465 722e 656b 7320 696d 706f 7274  uster.eks import
+0002efd0: 2069 6e66 6f20 6173 2065 6b73 5f69 6e66   info as eks_inf
+0002efe0: 6f0a 2020 2020 2020 2020 7265 7475 726e  o.        return
+0002eff0: 2065 6b73 5f69 6e66 6f28 7365 6c66 2c20   eks_info(self, 
+0002f000: 636c 7573 7465 722c 2073 656c 662e 6465  cluster, self.de
+0002f010: 6275 6729 0a0a 2020 2020 6465 6620 696e  bug)..    def in
+0002f020: 666f 5f6b 7562 655f 656b 7328 7365 6c66  fo_kube_eks(self
+0002f030: 2c20 7175 6965 742c 2077 6562 3d46 616c  , quiet, web=Fal
+0002f040: 7365 293a 0a20 2020 2020 2020 2066 726f  se):.        fro
+0002f050: 6d20 6b76 6972 742e 636c 7573 7465 7220  m kvirt.cluster 
+0002f060: 696d 706f 7274 2065 6b73 0a20 2020 2020  import eks.     
+0002f070: 2020 2070 6c61 6e64 6972 203d 206f 732e     plandir = os.
+0002f080: 7061 7468 2e64 6972 6e61 6d65 2865 6b73  path.dirname(eks
+0002f090: 2e63 7265 6174 652e 5f5f 636f 6465 5f5f  .create.__code__
+0002f0a0: 2e63 6f5f 6669 6c65 6e61 6d65 290a 2020  .co_filename).  
+0002f0b0: 2020 2020 2020 696e 7075 7466 696c 6520        inputfile 
+0002f0c0: 3d20 6627 7b70 6c61 6e64 6972 7d2f 6661  = f'{plandir}/fa
+0002f0d0: 6b65 2e79 6d6c 270a 2020 2020 2020 2020  ke.yml'.        
+0002f0e0: 7365 6c66 2e69 6e66 6f5f 706c 616e 2869  self.info_plan(i
+0002f0f0: 6e70 7574 6669 6c65 2c20 7175 6965 743d  nputfile, quiet=
+0002f100: 7175 6965 742c 2077 6562 3d77 6562 290a  quiet, web=web).
+0002f110: 2020 2020 2020 2020 656b 732e 696e 666f          eks.info
+0002f120: 5f73 6572 7669 6365 2873 656c 6629 0a0a  _service(self)..
+0002f130: 2020 2020 6465 6620 696e 666f 5f73 7065      def info_spe
+0002f140: 6369 6669 635f 676b 6528 7365 6c66 2c20  cific_gke(self, 
+0002f150: 636c 7573 7465 7229 3a0a 2020 2020 2020  cluster):.      
+0002f160: 2020 6672 6f6d 206b 7669 7274 2e63 6c75    from kvirt.clu
+0002f170: 7465 722e 676b 6520 696d 706f 7274 2069  ter.gke import i
+0002f180: 6e66 6f20 6173 2067 6b65 5f69 6e66 6f0a  nfo as gke_info.
+0002f190: 2020 2020 2020 2020 7265 7475 726e 2067          return g
+0002f1a0: 6b65 5f69 6e66 6f28 7365 6c66 2c20 636c  ke_info(self, cl
+0002f1b0: 7573 7465 722c 2073 656c 662e 6465 6275  uster, self.debu
+0002f1c0: 6729 0a0a 2020 2020 6465 6620 696e 666f  g)..    def info
+0002f1d0: 5f6b 7562 655f 676b 6528 7365 6c66 2c20  _kube_gke(self, 
+0002f1e0: 7175 6965 742c 2077 6562 3d46 616c 7365  quiet, web=False
+0002f1f0: 293a 0a20 2020 2020 2020 2066 726f 6d20  ):.        from 
+0002f200: 6b76 6972 742e 636c 7573 7465 7220 696d  kvirt.cluster im
+0002f210: 706f 7274 2067 6b65 0a20 2020 2020 2020  port gke.       
+0002f220: 2070 6c61 6e64 6972 203d 206f 732e 7061   plandir = os.pa
+0002f230: 7468 2e64 6972 6e61 6d65 2867 6b65 2e63  th.dirname(gke.c
+0002f240: 7265 6174 652e 5f5f 636f 6465 5f5f 2e63  reate.__code__.c
+0002f250: 6f5f 6669 6c65 6e61 6d65 290a 2020 2020  o_filename).    
+0002f260: 2020 2020 696e 7075 7466 696c 6520 3d20      inputfile = 
+0002f270: 6627 7b70 6c61 6e64 6972 7d2f 6661 6b65  f'{plandir}/fake
+0002f280: 2e79 6d6c 270a 2020 2020 2020 2020 7365  .yml'.        se
+0002f290: 6c66 2e69 6e66 6f5f 706c 616e 2869 6e70  lf.info_plan(inp
+0002f2a0: 7574 6669 6c65 2c20 7175 6965 743d 7175  utfile, quiet=qu
+0002f2b0: 6965 742c 2077 6562 3d77 6562 290a 2020  iet, web=web).  
+0002f2c0: 2020 2020 2020 676b 652e 696e 666f 5f73        gke.info_s
+0002f2d0: 6572 7669 6365 2873 656c 6629 0a         ervice(self).
```

## kvirt/examples.py

```diff
@@ -49,14 +49,21 @@
 # Add a proxmox host
 $ kcil create host proxmox -H 192.168.1.4 --insecure -u root@pam -p pass --pool local-lvm myproxmox
 
 # Add a host group
 $ kcli create host group --members [hypervisor1,hypervisor2] --algorithm random mygroup
 """
 
+providercreate = """# Install aws provider dependencies
+$ kcli install provider aws
+
+# Install vsphere provider dependencies through pip
+$ kcli install provider vsphere -p
+"""
+
 _list = """# Get list of vms
 $ kcli list vm
 
 # Get list of vms from all hosts/clients
 $ kcli -C all list vm
 
 # Get list of products
```

## kvirt/common/__init__.py

```diff
@@ -2265,7 +2265,59 @@
     target = os.path.basename(origin).replace('.yml', '').replace('.yaml', '')
     with open(origin) as o:
         data = yaml.safe_load_all(o)
         for index, entry in enumerate(data):
             with open(f'{basedir}/{target}-{index}.yaml', 'w') as t:
                 yaml.safe_dump(entry, t)
     os.remove(origin)
+
+
+def install_provider(provider, pip=False):
+    if provider == 'kvm':
+        warning("Nothing needed")
+        sys.exit(0)
+    pkgmgr = None
+    if which('dnf') is not None:
+        pkgmgr = 'dnf'
+    elif which('yum') is not None:
+        pkgmgr = 'yum'
+    elif which('apt-get') is not None:
+        pkgmgr = 'apt-get'
+    if not pip and pkgmgr is None:
+        error("Package based installation requires either dnf or apt-get")
+        sys.exit(1)
+    if provider == 'aws':
+        cmd = 'pip3 install boto3' if pip else f'{pkgmgr} -y install python3-boto3'
+    elif provider == 'gcp':
+        if not pip:
+            warning("Using pip as this is the only way for this provider")
+        cmd = 'pip3 install google-api-python-client google-auth-httplib2 google-cloud-dns google-cloud-storage '
+        cmd += 'google-cloud-container'
+    elif provider == 'ibm':
+        if not pip:
+            warning("Using pip as this is the only way for this provider")
+        cmd = 'pip3 install ibm_vpc ibm-cos-sdk ibm-platform-services ibm-cloud-networking-services'
+    elif provider == 'kubevirt':
+        cmd = 'pip3 install kubernetes' if pip else f'{pkgmgr} -y install python3-kubernetes'
+    elif provider == 'openstack':
+        if pip:
+            cmd = 'pip3 install python-cinderclient python-neutronclient python-glanceclient python-keystoneclient '
+            cmd += 'python-novaclient python-swiftclient'
+        else:
+            cmd = f'{pkgmgr} -y install python3-keystoneclient python3-glanceclient python3-cinderclient '
+            cmd += 'python3-neutronclient python3-novaclient python3-swiftclient'
+    elif provider == 'ovirt':
+        cmd = 'pip3 install ovirt-engine-sdk-python' if pip else f'{pkgmgr} -y install python3-ovirt-engine-sdk4'
+    elif provider == 'packet':
+        if not pip:
+            warning("Using pip as this is the only way for this provider")
+        cmd = 'pip3 install packet-python'
+    elif provider == 'proxmox':
+        if not pip:
+            warning("Using pip as this is the only way for this provider")
+        cmd = 'pip3 install proxmoxer'
+    elif provider == 'vsphere':
+        if pip:
+            cmd = 'pip3 install pyvmomi cryptography'
+        else:
+            cmd = f'{pkgmgr} -y install python3-pyvmomi python3-cryptography'
+    call(cmd, shell=True)
```

## kvirt/version/git

```diff
@@ -1 +1 @@
-e64909e 2023/07/05
+75c7114 2023/07/05
```

## Comparing `kcli-99.0.202307050850.dist-info/LICENSE` & `kcli-99.0.202307051011.dist-info/LICENSE`

 * *Files identical despite different names*

## Comparing `kcli-99.0.202307050850.dist-info/METADATA` & `kcli-99.0.202307051011.dist-info/METADATA`

 * *Files 4% similar despite different names*

```diff
@@ -1,24 +1,25 @@
 Metadata-Version: 2.1
 Name: kcli
-Version: 99.0.202307050850
+Version: 99.0.202307051011
 Summary: Provisioner/Manager for Libvirt/Vsphere/Aws/Gcp/Kubevirt/Ovirt/Openstack/IBM Cloud and containers
 Home-page: http://github.com/karmab/kcli
 Author: Karim Boumedhel
 Author-email: karimboumedhel@gmail.com
 License: ASL
 Platform: UNKNOWN
 License-File: LICENSE
 Requires-Dist: PyYAML
 Requires-Dist: argcomplete
 Requires-Dist: jinja2
 Requires-Dist: libvirt-python (>=2.0.0)
 Requires-Dist: prettytable
 Provides-Extra: all
 Requires-Dist: boto3 ; extra == 'all'
+Requires-Dist: cryptography ; extra == 'all'
 Requires-Dist: docker (>=2.0) ; extra == 'all'
 Requires-Dist: google-api-python-client ; extra == 'all'
 Requires-Dist: google-auth-httplib2 ; extra == 'all'
 Requires-Dist: google-cloud-container ; extra == 'all'
 Requires-Dist: google-cloud-dns ; extra == 'all'
 Requires-Dist: google-cloud-storage ; extra == 'all'
 Requires-Dist: google-crc32c (==1.1.2) ; extra == 'all'
@@ -61,11 +62,12 @@
 Requires-Dist: python-keystoneclient ; extra == 'openstack'
 Requires-Dist: python-neutronclient ; extra == 'openstack'
 Requires-Dist: python-novaclient ; extra == 'openstack'
 Requires-Dist: python-swiftclient ; extra == 'openstack'
 Provides-Extra: ovirt
 Requires-Dist: ovirt-engine-sdk-python ; extra == 'ovirt'
 Provides-Extra: vsphere
+Requires-Dist: cryptography ; extra == 'vsphere'
 Requires-Dist: pyvmomi ; extra == 'vsphere'
 
 Provisioner/Manager for Libvirt/Vsphere/Aws/Gcp/Kubevirt/Ovirt/Openstack/IBM Cloud and containers
```

## Comparing `kcli-99.0.202307050850.dist-info/RECORD` & `kcli-99.0.202307051011.dist-info/RECORD`

 * *Files 1% similar despite different names*

```diff
@@ -1,16 +1,16 @@
 kvirt/__init__.py,sha256=eoZ6GfifbqhMLNzjlqRDVil-yyBkOmVN9ujSgJWNBlY,15
 kvirt/baseconfig.py,sha256=SVs4GB-vHzKaa29ERsSHTDDcUUPAM3UfZ5IkP95VCb4,100420
 kvirt/bottle.py,sha256=DMuCINuwVog8XC-D6nPFVzRmo6lnJZ1H3sNK2VICKKE,171487
-kvirt/cli.py,sha256=P0xfd-Vzd-Gm57shzGeVEfQqfXylodGFVRLDk43u82A,254136
-kvirt/config.py,sha256=J84kmuI37r4UfGVrUZjrBsKpupj76dKEb4zIykP2UEI,193321
+kvirt/cli.py,sha256=S7ImlyhrLb8rQTfaG8YaHOSwl7eQrvi0s7Vl2cbWJ-I,259525
+kvirt/config.py,sha256=z2-ctpAshH7J7qijBXV7Qiwr0SDh7q0NI-M_v9-Uy5o,193245
 kvirt/containerconfig.py,sha256=Pfp1wWU1u1S6S0IT00mWFEAa8FlbTV2qrFE21_cquWA,2851
 kvirt/defaults.py,sha256=I1d1gKipNnKx6-oDP6NzDgANA6m7MrR_yQ3R5dzy_DM,11612
 kvirt/ekstoken.py,sha256=MjK_tcLFl2VKxqgTSB4ve_kybZw5dBj2H6BezGGtBpM,1475
-kvirt/examples.py,sha256=KWa6roRYg9OKQ0_Zn6IgIy4hNQVAaECqeq86bp5VqnU,21066
+kvirt/examples.py,sha256=uFFwcid37csxIfJmHQQ8po1QF90V4GZ31WHX6vY8XFs,21243
 kvirt/gketoken.py,sha256=tufCvrSBE_L2HEt8CjePvBXes7wkj7auUVJXbgZBblI,1047
 kvirt/ignitionmerger.py,sha256=K22COM_XqYOG28ezUJzoRjQL-jbJqpFWgm7lUwDiVbE,4333
 kvirt/keywords.yaml,sha256=HG5nGzsC2pPwWy86XQjL-UoDw_j8IIy4dVZeGIMP3k0,9871
 kvirt/klist.py,sha256=6rUa1Z7aH-Yx8MAVW-7TvB2DzteGkquBBlPQmei1p8E,3487
 kvirt/ansibleutils/__init__.py,sha256=uxy2it8uvuhDZSIlKOimpqPZtFTPsZ0AX_DLs5y7fSo,6009
 kvirt/cluster/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 kvirt/cluster/sampleprovider.py,sha256=OA414n2t54Bd6EIV1K1hXpe3KndPBtRzoYTZRH5JWu4,204
@@ -278,15 +278,15 @@
 kvirt/cluster/profiles/sample-kubeadm-default.yml,sha256=nSVV2Q5610SHemeErWF6eXqYAko3M2euNMPk_KYkvOc,193
 kvirt/cluster/profiles/sample-openshift-compact.yml,sha256=sYA9UXAnSFaiXJLPvA6A8_TY--A3xEp3fiWFBr3pA_Y,135
 kvirt/cluster/profiles/sample-openshift-contrail.yml,sha256=BRIQ9q5KdsklWBtCcUo56XP7N5-ZKVGxpTEYyA063ug,210
 kvirt/cluster/profiles/sample-openshift-ipv6.yml,sha256=L_kajan3FQQtUTJutGZlqqoENum6smQ11iet18mPAo8,157
 kvirt/cluster/profiles/sample-openshift-sno-bm.yml,sha256=bOx8AtKWv_ukKaXJ450oe6p2NUz9CI1oqYJXQJU1LGY,55
 kvirt/cluster/profiles/sample-openshift-sno.yml,sha256=U2I9t5DFLWIDagj7sHS6WNNw6FExsm2shUUJegCoCuY,148
 kvirt/common/Jenkinsfile.j2,sha256=FOK7002eP_nUoinIZZVhNo3SeKKwU8nVOAn0EVfZLRk,3377
-kvirt/common/__init__.py,sha256=yBOAzjlPRAydcHydvAc6cWNe_H9pH8pJJ3BvXpAXIV4,96580
+kvirt/common/__init__.py,sha256=molX3zhSZjO_YB25Hfz37wjK_oRD1dcBfB293VFTaWQ,98898
 kvirt/common/autoscale.yaml.j2,sha256=fCKt-ooHIr0oeAIZWQLlIcVJD0msW5A7BkNyVbO6Dj0,1406
 kvirt/common/fake_kubeconfig.json,sha256=XxFI3MSxrYbA6-4U8W5vSVFxrQmOeTOxAVzc7e1ngNc,8945
 kvirt/common/ignition.j2,sha256=eZN_uM9itflZCvrakYU25HFdQLdLxqZAN9pEzYmEDCE,669
 kvirt/common/kubevirt_kcli_conf.j2,sha256=OCwVN8OoymNKZ9BBooKabCR6RSbU58XfUtj9tttXdmE,125
 kvirt/common/local_kcli_conf.j2,sha256=_HqXYt5pCe5JK7y8UPR7BVm7RoC9vJGlrltnKz-J1vs,99
 kvirt/common/pipeline.yml.j2,sha256=c7QUmTo82zJtH0AQVdKw-Y7MpWGeiejw5npQIUIXtRU,3068
 kvirt/common/pipeline_kube.yml.j2,sha256=zLxvWIz9z0rlhxzUkZXj96fEndcm0DoO6KIzjRqOiGs,2377
@@ -359,15 +359,15 @@
 kvirt/providers/packet/__init__.py,sha256=z71vF3yFtt36u2xcIlDdpLtQ0Tvv30acFyllwPZ2qOo,31230
 kvirt/providers/proxmox/__init__.py,sha256=hW84JyLK7t7Zsqwrx1hYniqAxp38IyCnxRnTAyoWnIw,29262
 kvirt/providers/vsphere/__init__.py,sha256=-Yap7VbRjUjWI9mrvDnvGks5rW37UolJl7_wphBsnck,73215
 kvirt/providers/vsphere/helpers.py,sha256=F1rB_AHISd8TFYQ6eRolQmCVqU8KFAa36CCwjDj-vqw,13655
 kvirt/providers/vsphere/tagging.py,sha256=7RqFIUETSzHAjS0F_8-j145-_8lca7aDUsCxs4DhQVQ,4893
 kvirt/providers/web/__init__.py,sha256=5fTs7xbQ2TT9uCUp6TtYWQVl6ywsB-efH7_PgX1wrZI,21420
 kvirt/version/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
-kvirt/version/git,sha256=VEWuw0ClEYcq0HXM2bXATLbWi3DVj9dsd50oshqf-is,19
+kvirt/version/git,sha256=EdU-AqMmx3jaOgeu97wwaoNWqxmGMJXx6WjvJkzhBBU,19
 kvirt/web/__init__.py,sha256=mz6UtxtapEZzgWy-6KWw5pwNQUhUxWyHqFOh1HUlQZk,46652
 kvirt/web/main.py,sha256=DIb6tW3ce7wCc83kD9HBCG4ALJuLItp9uaP6tzdsm_Y,261
 kvirt/web/static/css/bootstrap-notify.css,sha256=ibUTW-jDj-F8d1T1KZ4DOujRmVTFfvMKL9y14QgEaPQ,408
 kvirt/web/static/css/bootstrap-theme.min.css,sha256=ZT4HPpdCOt2lvDkXokHuhJfdOKSPFLzeAJik5U_Q-l4,23409
 kvirt/web/static/css/bootstrap.min.css,sha256=E-dwlJxOS7dOrKCvR-5WCqiHCbIHLl59MMDVsfU4oiU,121125
 kvirt/web/static/css/dataTables.checkboxes.css,sha256=H-x4lWeyX3jMsghnkCUUTO2lXjRpJ8pxhUj3YAqaBrQ,399
 kvirt/web/static/css/jquery.dataTables.min.css,sha256=-Z1rYa3ys5OdZNUck5G7lBvb8A13OrYwvf-d8PfEaHQ,13587
@@ -601,13 +601,13 @@
 kvirt/web/templates/repos.html,sha256=HaFCTQjX3zSaqyV05Y_wG0vSkOWDpc-wj6Uj5TLbiFg,475
 kvirt/web/templates/repostable.html,sha256=6HH8sgdppR-yojQspdcI59ju4e9HZYVvV6uvnPxqbeo,1203
 kvirt/web/templates/vmcreate.html,sha256=FG3OoQEKTpeo8spJ1WiqYVkOp672saYRQKujNWOA3uQ,958
 kvirt/web/templates/vmprofiles.html,sha256=T65Cv7povhBtD2dyuWkWJE6byaA9EYtLSk5gtcQlHIU,486
 kvirt/web/templates/vmprofilestable.html,sha256=-8viNOqSvN_yzimENxq7Q0187zbflOn8p8zpgx0Vyek,1420
 kvirt/web/templates/vms.html,sha256=k2ptKeiLFdpzgfbk6xi__sduu0UALYXXrnrmDEmAfaQ,470
 kvirt/web/templates/vmstable.html,sha256=ikuYkIm_ocvGIBXFyJt1-tBjwQWCyqkgC08leoXgR54,4894
-kcli-99.0.202307050850.dist-info/LICENSE,sha256=z8d0m5b2O9McPEK1xHG_dWgUBT6EfBDz6wA0F7xSPTA,11358
-kcli-99.0.202307050850.dist-info/METADATA,sha256=iWyVWDeh6uQYfOq7-gFYUsETaketSXyQgUD0mfXYU48,3024
-kcli-99.0.202307050850.dist-info/WHEEL,sha256=G16H4A3IeoQmnOrYV4ueZGKSjhipXx8zc8nu9FGlvMA,92
-kcli-99.0.202307050850.dist-info/entry_points.txt,sha256=BrQuU8qI-1nidLF1G4COY5zxOvhu4akPk_teiSsx2D0,281
-kcli-99.0.202307050850.dist-info/top_level.txt,sha256=FwVTxtMIWdr8QBk5mTfd0f_GheFlRR_vn4zl6p5N57s,6
-kcli-99.0.202307050850.dist-info/RECORD,,
+kcli-99.0.202307051011.dist-info/LICENSE,sha256=z8d0m5b2O9McPEK1xHG_dWgUBT6EfBDz6wA0F7xSPTA,11358
+kcli-99.0.202307051011.dist-info/METADATA,sha256=ST88ss8b1aTyyJsGIYjrx1ySCQLRmGDZLCm-QSjYaq4,3118
+kcli-99.0.202307051011.dist-info/WHEEL,sha256=G16H4A3IeoQmnOrYV4ueZGKSjhipXx8zc8nu9FGlvMA,92
+kcli-99.0.202307051011.dist-info/entry_points.txt,sha256=BrQuU8qI-1nidLF1G4COY5zxOvhu4akPk_teiSsx2D0,281
+kcli-99.0.202307051011.dist-info/top_level.txt,sha256=FwVTxtMIWdr8QBk5mTfd0f_GheFlRR_vn4zl6p5N57s,6
+kcli-99.0.202307051011.dist-info/RECORD,,
```

